<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10980719</article-id>
    <article-id pub-id-type="pmid">38553478</article-id>
    <article-id pub-id-type="publisher-id">47158</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-024-47158-y</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8376-4089</contrib-id>
        <name>
          <surname>Eisele</surname>
          <given-names>A. S.</given-names>
        </name>
        <address>
          <email>almut.eisele@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0556-2531</contrib-id>
        <name>
          <surname>Tarbier</surname>
          <given-names>M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dormann</surname>
          <given-names>A. A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9415-788X</contrib-id>
        <name>
          <surname>Pelechano</surname>
          <given-names>V.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5644-4899</contrib-id>
        <name>
          <surname>Suter</surname>
          <given-names>D. M.</given-names>
        </name>
        <address>
          <email>david.suter@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/02s376052</institution-id><institution-id institution-id-type="GRID">grid.5333.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2183 9049</institution-id><institution>Ecole Polytechnique Fédérale de Lausanne, School of Life Sciences, </institution><institution>Institute of Bioengineering, </institution></institution-wrap>Lausanne, Switzerland </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.465198.7</institution-id><institution>Science for Life Laboratory, Department of Microbiology, Tumor and Cell Biology, </institution><institution>Karolinska Institute, </institution></institution-wrap>Solna, Sweden </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>2744</elocation-id>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024, corrected publication 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Assigning single cell transcriptomes to cellular lineage trees by lineage tracing has transformed our understanding of differentiation during development, regeneration, and disease. However, lineage tracing is technically demanding, often restricted in time-resolution, and most scRNA-seq datasets are devoid of lineage information. Here we introduce <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference (GEMLI), a computational tool allowing to robustly identify small to medium-sized cell lineages solely from scRNA-seq datasets. GEMLI allows to study heritable gene expression, to discriminate symmetric and asymmetric cell fate decisions and to reconstruct individual multicellular structures from pooled scRNA-seq datasets. In human breast cancer biopsies, GEMLI reveals previously unknown gene expression changes at the onset of cancer invasiveness. The universal applicability of GEMLI allows studying the role of small cell lineages in a wide range of physiological and pathological contexts, notably in vivo. GEMLI is available as an R package on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>).</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Combining experimental lineage tracing with single cell transcriptomics is technically demanding. Here, authors present GEMLI, a computational tool to annotate cell lineages in single cell RNA sequencing data solely based on gene expression.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Epigenetic memory</kwd>
      <kwd>Gene expression profiling</kwd>
      <kwd>Computational models</kwd>
      <kwd>Gene ontology</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100001711</institution-id>
            <institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung (Swiss National Science Foundation)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>CRSK-3_195097</award-id>
        <principal-award-recipient>
          <name>
            <surname>Suter</surname>
            <given-names>D. M.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">In multicellular organisms, each cell belongs to a lineage tree that determines its relatedness to other cells. Cell lineage relationships are of fundamental biological relevance as they directly impact a broad range of cellular behaviors, such as cancer resistance to drugs<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR7">7</xref></sup>, disease onset<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and differentiation in development, homeostasis, and regeneration<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR15">15</xref></sup>. Dissecting early gene expression changes that occur during cell fate switches is essential to understand the mechanistic bases of these processes. This requires to focus on small cell lineages in which cell fate decisions occur. While cellular characterization by scRNA-seq provides rich molecular information, it is intrinsically devoid of lineage information. Therefore, there is considerable interest in identifying cell lineages in scRNA-seq datasets.</p>
    <p id="Par4">The most widely used technique to assign individual transcriptomes to given lineages is cellular barcoding, which involves the introduction of heritable, expressed DNA barcodes in individual cells that can be retrieved in scRNA-seq data<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR19">19</xref></sup>. Other approaches involve hand-picking of related cells visualized by microscopy or microfluidic devices to compartmentalize cell lineages before scRNA-seq<sup><xref ref-type="bibr" rid="CR20">20</xref>–<xref ref-type="bibr" rid="CR25">25</xref></sup>. However, all these techniques suffer from important technical limitations such as the requirement for dedicated devices, extensive cell handling and/or culture, or genetic engineering.</p>
    <p id="Par5">Natural genetic marks such as mitochondrial mutations, copy number variants, and somatic mutations have been used to identify related cells in scRNA-seq datasets, mainly after enrichment for desired transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Still, the scarcity of spontaneously occurring genetic marks restricts their application to a fraction of cells that harbor these marks and to the identification of large cell lineages. These approaches are therefore not suited to analyze small and mid-sized lineages and poorly resolve branching points during divergent cell fate decisions. In particular, identifying close lineage relationships to study cell fate decisions in vivo and in human samples remains challenging.</p>
    <p id="Par6">Here, we quantitatively dissect the maintenance of gene expression in cell lineages for a broad range of cell types. We leverage genes with particularly stable expression over time to develop Gene Expression Memory-based Lineage Inference or GEMLI, a computational tool that allows identifying cell lineages related to several cell divisions based solely on scRNA-seq data.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Cells belonging to the same lineage tree are similar in their gene expression profiles</title>
      <p id="Par7">We analyzed the transcriptome-wide stability of gene expression over around 1-5 cell divisions using lineage-annotated scRNA-seq datasets of mouse embryonic stem cells (mESCs; Fig. <xref rid="MOESM1" ref-type="media">S1a–c</xref>), primary mouse embryonic fibroblasts (MEF)<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, primary mouse CD8+T-lymphocytes (CD8)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, lymphocytic leukemia cells (L1210)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, primary mouse hematopoietic stem and progenitor cells (HSPC; differentiating into &gt;10 mature cell types)<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, mouse hematopoietic stem cells (HSC) <sup>23</sup>, and human melanoma cells (WM989)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, grown for 2–14 days in various culture conditions (Supplementary Data File <xref rid="MOESM4" ref-type="media">1</xref> and Fig. <xref rid="MOESM1" ref-type="media">S1d, e</xref> for culture times, conditions and dataset sizes, over 120 datasets in total). Two datasets contained specifically sister cells, in all other datasets 2-cell lineages corresponded to random samples from larger lineages (Fig. <xref rid="MOESM1" ref-type="media">S1f–g</xref>). For all cell types analyzed, we observed a higher correlation (lower correlation distance) of the whole transcriptome for related cells as compared to randomly sampled cells (Fig. <xref rid="Fig1" ref-type="fig">1a, b</xref>). Related cells were also more similar in their transcriptomic velocity<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, complexity (number of expressed genes), and cell cycle phase (Fig. <xref rid="MOESM1" ref-type="media">S2a–g</xref>). Importantly, for differentiating HSPC, both lineages composed of a single cell type (symmetric) and lineages made of several cell types (asymmetric) were more similar in their transcriptome than random cells (Fig. <xref rid="Fig1" ref-type="fig">1c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S2h</xref>). To further determine the time spans of transcriptomic similarity persistence, we analyzed lineage-annotated data of MEF cultured for up to 30 days. Gene expression correlation of related cells remained high for extended timespans (&gt;20 days) (Fig. <xref rid="MOESM1" ref-type="media">S2i</xref>), in line with recent reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. In summary, both self-renewing and differentiating cells exhibit substantial gene expression memory over several cell generations.<fig id="Fig1"><label>Fig. 1</label><caption><title>Memory genes drive the transcriptomic similarity of related cells across cell types.</title><p><bold>a</bold> UMAP of the lineage-annotated mESC scRNA-seq dataset with 25 random colored lineages. <bold>b</bold> Boxplot of the correlation distance for related cells (blue), and randomly sampled cells (gray; 100 repetitions) in different cell types (<italic>n</italic> = 1 dataset for each cell type). <bold>c</bold> Boxplot as in <bold>b</bold> for lineages encompassing one single cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric, asym.) for one HSPC dataset. <bold>d</bold> Illustration of the temporal pattern of expression levels and variability of quantitative memory genes, qualitative memory genes, and non-memory genes across cell generations and lineages, respectively. <bold>e</bold> Percentage of expressed genes (gray) that are categorized as quantitative (green) and qualitative (blue) memory genes across cell types (<italic>n</italic> = 1 dataset for each). <bold>f</bold> Relation of CV<sup>2</sup> and mean gene expression in the mESC dataset. The different memory gene categories are colored as in <bold>e</bold>. <bold>g</bold> Mean gene expression for different memory gene categories and all genes across cell types as in (<bold>b</bold>; <italic>n</italic> = 7 datasets, qual=qualitative, quant=quantitative). <bold>h</bold> Same representation as in <bold>g</bold> for CV<sup>2</sup> of gene expression. <bold>i</bold> Memory genes as a percentage of expressed genes for lineages being composed of one cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric; asym) at day 4 of HSPC differentiation (<italic>n</italic> = 22 datasets). <bold>j</bold> The overlap between memory genes of day 2 and day 5–30 over the course of MEF reprogramming. Overlap is the percentage of the memory gene number at day 5–30, respectively (<italic>n</italic> = 2 dataset for each timepoint). Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig1_HTML" id="d33e449"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Gene expression memory increases gene expression variability in large cell populations</title>
      <p id="Par8">We next asked to which extent transcriptome similarity of small cell lineages impacts gene expression variability in the whole cell population. To do so, we fitted a linear model to compute the total variation for each gene from the variation across pooled lineages. We then used this model to estimate the total variation in a control dataset with permuted lineage labels, and compared the total variation of the real and the control datasets. We found that transcriptomic similarity of cell lineages had a substantial impact on gene expression variability in all cell types, in particular for highly expressed genes (Fig. <xref rid="MOESM1" ref-type="media">S3a</xref>), with the median standard deviation being on average 4.2% higher (+/– S.D. 3.3) overall transcripts and 19.1% higher (+/– S.D. 15) for highly abundant genes (Fig. <xref rid="MOESM1" ref-type="media">S3b</xref>). Therefore, while gene expression memory limits gene expression variability within small cell lineages, it is an important source of gene expression variability in large cell populations.</p>
    </sec>
    <sec id="Sec5">
      <title>Thousands of memory genes display stable gene expression levels through cell division</title>
      <p id="Par9">The transcriptomic correlation of closely related cells was driven by ca 20% of expressed genes (on average 3668 +/– S.D. 1131) with particularly stable gene expression levels across cell divisions, which we called memory genes (Fig. <xref rid="Fig1" ref-type="fig">1d, e</xref>). We defined memory genes as genes having a significantly higher (<italic>p</italic> &lt; =0.05) variability (coefficient of variation squared (CV<sup>2</sup>)) in their mean expression across cell lineages compared to random cell samples. Memory genes were only partly overlapping but shared characteristic expression distributions across datasets. Some memory genes were widely and highly expressed but showed very conserved expression levels within individual cell lineages (2286 +/– S.D. 890). Other memory genes were highly variable, and only expressed in a small number of cell lineages (1382 +/– S.D. 413). We named these quantitative and qualitative memory genes, respectively (Fig. <xref rid="Fig1" ref-type="fig">1f–h</xref>; Figs. <xref rid="MOESM1" ref-type="media">S4</xref> and <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM5" ref-type="media">2</xref>). Memory genes, and in particular quantitative memory genes, were enriched for housekeeping functions (Fig. <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM6" ref-type="media">3</xref>). Memory genes were also present for lineages encompassing several cell types (Fig. <xref rid="Fig1" ref-type="fig">1i</xref>), highly shared across cell types within a culture condition (Fig. <xref rid="MOESM1" ref-type="media">S4f–g</xref>), and present over longer culture time spans (&gt;20 days; Fig. <xref rid="Fig1" ref-type="fig">1j</xref> and Fig. <xref rid="MOESM1" ref-type="media">S4h</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>GEMLI uses shared memory gene characteristics for de novo lineage predictions from scRNA-seq datasets</title>
      <p id="Par10">Based on the characteristic expression distributions of memory genes across cell types, we developed GEMLI (for <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference) to predict cell lineages related over several cell divisions de novo in scRNA-seq datasets (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). First, genes with a high expression mean and high variability (mean-corrected CV<sup>2</sup>) are selected. This highly enriches memory genes (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, for comparison to genes used in standard scRNA-seq analysis and optimization of gene selection see Figs. <xref rid="MOESM1" ref-type="media">S6 and 7</xref>; and Methods). Next, a custom repetitive, iterative hierarchical clustering allows estimating whether cells belong to the same lineage (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>; see Table <xref rid="MOESM1" ref-type="media">S1</xref> for the main conceptual differences between GEMLI and other clustering algorithms). Briefly, cells are clustered iteratively on random subsets of the selected genes until being assigned to a cluster of predefined size (lineage size parameter; default 2–3 cells). By repeating this clustering, every cell pair is assigned a level of confidence for belonging to the same lineage, based on the number of times it clusters together across individual predictions. Finally, a confidence level threshold is set to define multi-cellular lineages (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Importantly, lineages are not technically restricted in size and can be larger than the cluster size of 2–3 cells. When applying this approach to different datasets, the precision and sensitivity of small cell lineage predictions reached on average 80% +/– S.D. 15%, and 22% +/– S.D. 12%, respectively, at a confidence level of 50. The false positive rate (FPR) of predictions stayed consistently under 1% with an average of 0.07% +/– S.D. 0.08% at a confidence level of 50 (Fig. <xref rid="Fig2" ref-type="fig">2c–e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). GEMLI performed consistently better than other gene selection and lineage assignment strategies, including a k-nearest neighbor (kNN) clustering and the training of a neural network (Fig. <xref rid="MOESM1" ref-type="media">S7c, g</xref> and Fig. <xref rid="MOESM1" ref-type="media">S9</xref>). Crucially, as GEMLI allows to predict cell lineages for cells in which cellular barcoding fails, the number of lineage-annotated cells was either comparable or substantially increased as compared to barcode-based approaches (Fig. <xref rid="Fig2" ref-type="fig">2f</xref>). Changing prediction parameters, such as the fraction of genes sampled for each clustering (Fig. <xref rid="MOESM1" ref-type="media">S10</xref>), can further optimize precision at the expense of sensitivity or vice versa, depending on which measure is deemed more important for the downstream analysis. GEMLI allows the identification of both symmetric and asymmetric lineages, i.e., lineages in which cells belong to one or different cell types (Fig. <xref rid="Fig2" ref-type="fig">2g, h</xref> and Fig. <xref rid="MOESM1" ref-type="media">S11</xref>) and lineages of different sizes (Figs. <xref rid="MOESM1" ref-type="media">S12</xref> and <xref rid="MOESM1" ref-type="media">S13</xref>). Furthermore, lineage predictions were also possible over extended time spans at high precision but with a decreasing recovery, in line with a gradual decline of gene expression memory over time (Figs. <xref rid="MOESM1" ref-type="media">S14</xref> and <xref rid="MOESM1" ref-type="media">S4h</xref>; and Fig. <xref rid="Fig1" ref-type="fig">1j</xref>). GEMLI performed well for datasets within the recommended size and sequencing depth ranges. Notably, GEMLI performed well in datasets with a sequencing depth &gt;5000 reads/cell (all but the HSPC datasets; Fig. <xref rid="MOESM1" ref-type="media">S15</xref>)<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup>. Altogether, GEMLI allows for accurate prediction of cell lineages related over several cell divisions solely from scRNA-seq datasets.<fig id="Fig2"><label>Fig. 2</label><caption><title>GEMLI predicts cell lineages from gene expression within and across cell types.</title><p><bold>a</bold> Schematic of the GEMLI lineage prediction pipeline. <bold>b</bold> Fraction of memory genes selected based on variability and mean expression in the indicated cell types (<italic>n</italic> = 1 dataset for each). <bold>c</bold> Precision-sensitivity curves of lineage predictions in different cell types as in <bold>b</bold>. <bold>d</bold> Precision, sensitivity (left) and FPR (right) of lineage predictions at confidence level 50 for datasets as in (<bold>b</bold>; <italic>n</italic> = 7 datasets). <bold>e</bold> Correct and false (line color) predicted lineages with respect to the barcode lineages (fill color) at different confidence levels in the mESC dataset. A random subset of the lineage predictions is shown. <bold>f</bold> Pie chart of datasets colored according to the presence of barcode- (left) and GEMLI- (right) lineage annotation at a confidence level of 50 (<italic>n</italic> = 1 for each cell type). The number of recovered lineages is indicated. <bold>g</bold> Precision-sensitivity curve for predictions of lineages composed of one cell type (symmetric) or two cell types (asymmetric) in the HSPC (<italic>n</italic> = 44) and WM989 datasets (<italic>n</italic> = 8). Mean is represented. <bold>h</bold> Precision (left), sensitivity (middle), and FPR (right) of lineage predictions at confidence level 50 for symmetric (sym.) and asymmetric (asym.) lineages in the HSPC and WM989 datasets as in <bold>g</bold>. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig2_HTML" id="d33e653"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>GEMLI identifies memory gene categories, cell fate decisions, and associated gene expression programs</title>
      <p id="Par11">We then asked how reliably GEMLI identifies categories of genes displaying gene expression memory in small lineages. To do so, we compared memory genes and associated GO-terms from GEMLI predictions and ground truth lineage annotation and found them to be highly correlated for all datasets (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>; Fig. <xref rid="MOESM1" ref-type="media">S16a–c</xref> and Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>). Next, we tested the ability of GEMLI to identify symmetric vs. asymmetric cell fate decisions. In both WM989 melanoma cell and HSPC datasets (total of 52 datasets, low sequencing depth for HSPCs), the fraction of related cells among different symmetric and asymmetric cell pairs correlated well for GEMLI and barcode lineages (Fig. <xref rid="Fig3" ref-type="fig">3b, c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S16d–j</xref>). The prevalence of related cells among drug-susceptible and -resistant melanoma cells, as well as 10 possible hematopoietic cell types could be distinguished. Also, differentially expressed genes (DEG) between asymmetric and symmetric cell type pairs were recovered well by analyzing GEMLI lineages (Fig. <xref rid="Fig3" ref-type="fig">3d, e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S17</xref>). In the HSPC data, DEG called between undifferentiated cells in symmetric undifferentiated and asymmetric undifferentiated-neutrophil cell pairs in the ground truth and predictions correlated highly (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>). In the WM989 cells, DEG analysis of GEMLI lineages identified genes specifically expressed in drug-susceptible cells being part of lineages with drug-susceptible and drug-resistant members, i.e., lineages in which cells recently switched to a resistant phenotype (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). While kNN performed similarly to GEMLI in identifying the prevalence of cell pairs, it performed less so for the recovery of correct DEGs (Figs. <xref rid="MOESM1" ref-type="media">S16i, j</xref> and  <xref rid="MOESM1" ref-type="media">S17a–d</xref>). For both analyses, GEMLI performed much better than random cell pair selections (Figs. <xref rid="MOESM1" ref-type="media">S16g, h</xref> and <xref rid="MOESM1" ref-type="media">S17a–f</xref>). In line with recent reports<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, a trajectory analysis did not recover asymmetric lineage-associated DEG (Fig. <xref rid="MOESM1" ref-type="media">S17g–j</xref>). This highlights the utility of GEMLI for downstream analyses that are commonly restricted to barcoded datasets, even in the case of datasets with a low sequencing depth.<fig id="Fig3"><label>Fig. 3</label><caption><title>GEMLI lineage predictions allow retrieving memory GO-terms and quantifying diverging cell-fate decisions.</title><p><bold>a</bold> Top 10 enriched GO-terms in memory genes called on barcode or predicted lineages (pred.) at confidence level 30 in different cell types (<italic>n</italic> = 1 dataset each). All terms that are among the top 10 in any cell type are shown. Spearman rank correlation is indicated. Proc.=process. <bold>b</bold> SPRING graph of HSPC datasets (<italic>n</italic> = 44) annotated by cell types (top), highlighting ground truth undifferentiated symmetric (beige) and undifferentiated-neutrophil asymmetric (pink) lineages (middle), or highlighting undifferentiated-neutrophil asymmetric lineage predictions at confidence level 70 (bottom). <bold>c</bold> The number (sum) of cell pairs in the barcode (top right) and predicted (bottom left) cell lineages in all cell type combinations in the HSPC datasets as in <bold>b</bold>. <bold>d</bold> Average log2 fold-change for DEG called between barcode and predicted undifferentiated cells in symmetric and asymmetric cell lineages in one day 4 HSPC dataset. Dots represent DEGs. Spearman rank correlation is given. The 20 highest and 10 lowest enriched genes are named. Gray: undifferentiated, blue: neutrophil. <bold>e</bold> Average log2 fold-change for DEG called between barcode and predicted drug-susceptible cells in symmetric and asymmetric cell lineages across WM989 datasets (<italic>n</italic> = 8). Green: drug-resistant, blue: drug-susceptible. A confidence level of predictions in <bold>c</bold>–<bold>e</bold> is 50. For the full spelling of abbreviated cell type names mentioned in panels <bold>b</bold>, <bold>c</bold>, see Methods. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig3_HTML" id="d33e766"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>GEMLI predicts lineages in lung metastases of pancreatic cancer</title>
      <p id="Par12">Next, we tested whether GEMLI could identify small and mid-sized lineages in vivo. We used data from mouse pancreatic cancer lung metastases, which have been traced through evolvable CRISPR barcoding over a short timespan<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. As barcodes here had only four weeks to evolve, CRISPR editing frequency of barcodes is high and the lung metastases develop late, this ground-truth data is suitable for comparison with GEMLI predictions. At a confidence level of 80, GEMLI reached 100% precision while assigning more cells to lineages than the barcoding data (Fig. <xref rid="Fig4" ref-type="fig">4a–c</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>GEMLI correctly assigns cells to individual metastases, crypts, and mitochondrial variant-defined lineages in vivo.</title><p><bold>a</bold> Scheme of GEMLI lung metastasis predictions. <bold>b</bold> Precision (line) and sensitivity (dotted line) as a function of confidence level for GEMLI predictions in lung metastases of two mice tested against the CRISPR barcode lineage information. Line: mean; Shade: S.D. <bold>c</bold> Pie chart of the lung metastases data of two mice (M1, M2) as in <bold>b</bold> colored according to the presence of CRISPR barcode- (left) and GEMLI- lineage annotation at a confidence level of 50 (middle) and 80 (right). The number of recovered lineages is indicated. Conf=confidence level. <bold>d</bold> Schematic of GEMLI crypt predictions. <bold>e</bold> Percentage of cells predicted as individual lineages for each crypt in the crypt dataset (<italic>n</italic> = 1) at confidence level 70. <bold>f</bold> Predictions of crypts at confidence level 70. <bold>g</bold> Precision-sensitivity curve for predictions in the crypt dataset. <bold>h</bold> Precision-sensitivity curve for predictions of cell pairs composed of one cell type (symmetric) or two cell types (asymmetric) in the crypt dataset. <bold>i</bold> The percentage of cells (size) belonging to the indicated cell type (color) for individual crypts (top) and for predicted lineages at confidence level 50 (bottom) aligned to their crypt of origin. <bold>j</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages (<italic>n</italic> = 3 datasets). Line: mean; Shade: S.D. <bold>k</bold> Precision-sensitivity curves of lineage predictions in K562 cells (<italic>n</italic> = 1 dataset) as in <bold>j</bold>. <bold>l</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages as in <bold>j</bold> with lineage size parameters up to the maximal ground truth lineage size. Line: mean; Shades: S.D. All crypt predictions are of 5-40 cells and were run with a lineage size parameter of 2–40. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig4_HTML" id="d33e841"/></fig></p>
    </sec>
    <sec id="Sec9">
      <title>GEMLI assigns cells to individual in vivo-derived crypts and organoids</title>
      <p id="Par13">Further, we tested GEMLIs ability to reconstruct in vivo and in vitro-derived multicellular structures that originate from a single or few stem cells using scRNA-seq data of intestinal organoids and crypts, for which the individual structure of origin (crypt or organoid) is known for each cell (ref. <sup><xref ref-type="bibr" rid="CR43">43</xref></sup>, Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). We ran GEMLI on the pooled scRNA-seq datasets and analyzed whether inferred lineages fall within individual crypts and organoids. GEMLI resulted in high percentages of cells correctly assigned to their crypt or organoid of origin with default lineage size parameters and parameters in the ground truth lineage size range, allowing the recovery of mid-sized lineages (Fig. <xref rid="Fig4" ref-type="fig">4d–g</xref>; Figs. <xref rid="MOESM1" ref-type="media">S12a, d</xref> and <xref rid="MOESM1" ref-type="media">S18</xref> for organoids). As ground truth lineage sizes might be unknown when applying GEMLI, we tested the stability of predictions for different lineage size parameters. Taking the maximal ground truth lineage size as the upper lineage size parameter value coincided with a maximal cluster stability of predictions, allowing us to estimate the size distribution of crypts and organoids de novo (Fig. <xref rid="MOESM1" ref-type="media">S19</xref>). GEMLI predictions allowed highly reliable inference of the cell type composition of individual structures by identifying both symmetric and asymmetric cell pairs (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref> and Fig. <xref rid="MOESM1" ref-type="media">S20</xref>). This demonstrates that GEMLI can recover the cellular composition of individuals in vivo and in vitro segregated mid-sized multicellular structures from pooled datasets.</p>
    </sec>
    <sec id="Sec10">
      <title>GEMLI can be combined with other lineage-tracing approaches</title>
      <p id="Par14">We next combined GEMLI with lineage inference based on mitochondrial variants to study lineages at broader time scales. Mitochondrial variants allow identifying cell lineages in 3’ scRNA-seq datasets after enrichment of mitochondrial transcripts<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. The scarce occurrence of mitochondrial mutations however restricts this approach to the assignment of cells to large lineages, i.e., cells related over long time spans (weeks to months). We tested if GEMLI could refine lineage trees inferred from mitochondrial variants on datasets of primary human bone marrow cells and K562 myelogenous leukemia cells<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. Importantly, in these experiments only a small sample from a large population was sequenced, resulting in the loss of a large fraction of cells from small lineages and thus inherently limiting their identification. Nevertheless, GEMLI recovered small cell lineages in all datasets and these fell with high precision within the large mitochondrial-variant inferred lineages (Fig. <xref rid="Fig4" ref-type="fig">4j, k</xref>). The precision stayed also high for predictions up to the maximal size of the mitochondrial-variant inferred lineages, confirming GEMLIs utility in refining lineage trees obtained with other techniques (Fig. <xref rid="Fig4" ref-type="fig">4l</xref>).</p>
    </sec>
    <sec id="Sec11">
      <title>GEMLI characterizes gene expression memory in human breast cancer</title>
      <p id="Par15">Next, we applied GEMLI to a primary human breast cancer tissue sample dataset<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, in which other lineage tracing approaches (such as cellular barcoding) cannot be applied or would only call large lineages (mitochondrial-variant-based lineage inference). The dataset was generated from formalin-fixed, paraffin-embedded breast cancer tissue and encompasses scRNA-seq (31,364 expressed genes) and Xenium in situ sequencing data (313 genes) of serial sections<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. We assigned 10 cell types identified in the Xenium data to the scRNA-seq data using supervised machine learning (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>), and applied GEMLI to ductal carcinoma in situ (DCIS) and invasive tumor cells separately (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>). Prediction stability for DCIS cells suggested lineage sizes up to 50 cells, in line with their nodule character and size in the spatial data, and resembled the multicellular crypt or organoid profiles (Fig. <xref rid="Fig5" ref-type="fig">5a</xref> and Fig. <xref rid="MOESM1" ref-type="media">S21</xref>, size considering 2,3% recovery of DCIS cells in scRNA-seq). In contrast, cluster stability of predicted invasive tumor cell lineages was more similar to cultured cells without a clear spatial organization (Fig. <xref rid="MOESM1" ref-type="media">S21a</xref>). Memory genes called on predicted DCIS and invasive tumor cell lineages (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>) were characterized by distinct GO terms, such as response to estrogen or cell-substrate adhesion, respectively (Fig. <xref rid="MOESM1" ref-type="media">S22a</xref>). Memory genes for which Xenium in situ data was available showed visible patches of similar gene expression, in line with lineage-specific expression (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Crucially, the spatial distribution of highly variable, non-memory genes was characterized by a “salt and pepper” aspect (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>), in line with both gene groups only partly overlapping (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>GEMLI predictions identify lineages in breast cancer nodules.</title><p><bold>a</bold> Breast cancer Xenium in situ sequencing map colored by cell type. <bold>b</bold> A random subset of predicted lineages within the DCIS cells of the breast cancer scRNA-seq dataset at confidence level 50. <bold>c</bold> Percentage of expressed genes categorized as quantitative (quant.) and qualitative (qual.) memory genes in the breast cancer scRNA-seq dataset as in <bold>b</bold>. <bold>d</bold> In situ map of breast cancer Xenium data for ESR1 and SCD expression which are memory genes in DCIS and invasive tumor lineages respectively. <bold>e</bold> Maps as in <bold>d</bold> for two variable genes. <bold>f</bold> Overlap of memory and variable genes in the breast cancer scRNA-seq dataset. All predictions in b-e are with lineage size parameters of 2–20 cells. The invasive tumor is abbreviated as the inv tumor in all panels. In <bold>a</bold> T-cell dendr. = T-cell dendritic cell and Myoepithel. = Myoepithelial cell. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig5_HTML" id="d33e969"/></fig></p>
    </sec>
    <sec id="Sec12">
      <title>GEMLI allows identifying early stages of progression to invasive cancer in vivo</title>
      <p id="Par16">Finally, we applied GEMLI to predict lineages on the whole breast cancer scRNA-seq dataset to study progression towards invasiveness. While most GEMLI lineages were confined within one cell type or shared with apoptotic cells, GEMLI also predicted lineages with both DCIS and invasive tumor cell members (Fig. <xref rid="Fig6" ref-type="fig">6a, b</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22b, c</xref>, around 10% of cancer cell lineages). We hypothesized that these asymmetric lineages contained cells that recently switched to an invasive phenotype. We analyzed genes characterizing these lineages by calling DEG on DCIS cells within asymmetric and symmetric lineages, as well as DEG between lineage types of later stages in cancer progression (Fig. <xref rid="Fig6" ref-type="fig">6c, d</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22d</xref>). Genes enriched in DCIS cells from asymmetric lineages included known markers of cancer invasiveness such as <italic>CDH2</italic><sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, but also genes with unknown roles in cancer progression, such as <italic>DCAF7</italic> and <italic>LINC01999</italic> (Fig. <xref rid="Fig6" ref-type="fig">6d</xref>). While, e.g., <italic>DCAF7</italic> and <italic>CDH2</italic> displayed continuous changes across lineage types occurring during cancer progression, others such as <italic>TCIM</italic> or <italic>BRIP1</italic> were expressed transiently at higher levels in asymmetric or only in symmetric (i.e., only invasive tumor cell) lineages, respectively (Fig. <xref rid="Fig6" ref-type="fig">6e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22e</xref>). This demonstrates the unique ability of GEMLI in dissecting lineage identities and gene expression changes in specific lineage types occurring during the progression of human tumors towards invasiveness.<fig id="Fig6"><label>Fig. 6</label><caption><title>GEMLI identifies breast cancer cells in lineages switching to an invasive phenotype.</title><p><bold>a</bold> A subset of predicted lineages with respect to cell type annotation at confidence level 50 in the breast cancer scRNA-seq dataset. Gray and red lines indicate lineage relationships within one or across several cell types, respectively. <bold>b</bold> Number of DCIS and invasive tumor lineages with members belonging to other cell types for lineage predictions as in <bold>a</bold>. <bold>c</bold> Scheme of lineage cell type identities occurring during breast cancer progression towards invasiveness (green: DCIS, blue: invasive tumor). <bold>d</bold> Volcano plots for DEG called between DCIS and invasive tumor cells predicted to be part of symmetric and asymmetric (asym.) cell lineages in the breast cancer scRNA-seq dataset as indicated. The top 9 highest and lowest enriched genes are named. Predictions at confidence level 50. The <italic>p</italic>-value indicated was generated by Seurats FindMarker function based on a Wilcoxon Rank Sum Test. <bold>e</bold> Expression of selected DEG as in <bold>d</bold> across DCIS and invasive tumor cells part of symmetric and asymmetric (asym.) lineages as indicated. All predictions are with lineage size parameters of 2–20 cells. Invasive tumor is abbreviated as ‘inv tumor’ or ‘inv tu’ in all panels. Arb. units = arbitrary units. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig6_HTML" id="d33e1053"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec13" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par17">GEMLI allows predicting small to medium-sized cell lineages related over several generations solely from scRNA-seq datasets, based on genes that maintain their expression level through cell divisions. This is a shift away from experimental lineage tracing techniques based on genetic marks or physical cell lineage separation and extends lineage annotations of small and medium-sized lineages to in vivo settings.</p>
    <p id="Par18">GEMLI is applicable to any scRNA-seq dataset and requires only exonic reads. This alleviates the need for experimental lineage assignment procedures implemented prior to sequencing and thereby expands lineage annotation to contexts where cellular barcoding or other lineage assignment approaches are challenging or prohibitive, such as primary cells or human biopsies. It also avoids cellular stress caused by cell picking or genetic engineering required for manual and cellular-barcoding-based lineage tracing, respectively. GEMLI is particularly promising for its ability to identify small lineages in which cells are related over about 1-5 cell divisions. However, GEMLI will generally perform less robustly in cell populations that contain only distantly related cells. Some systems might allow for a longer gene-expression memory-based lineage tracing<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. While GEMLI performed well on intestinal organoids that are highly variable in size, we cannot exclude that large variability in growth rates between lineages may decrease its performance.</p>
    <p id="Par19">We show that in line with individual reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>, gene expression memory is present in various cell types and populations in both self-renewal and differentiation conditions. GEMLI is therefore applicable to all cells of a scRNA-seq dataset, in contrast to cellular barcoding-based approaches which are limited to cells that (i) express the barcode and (ii) for which the barcode is recovered. GEMLI thus allows to recovery of a comparable or higher number of lineages than in public cellular barcoding scRNA-seq datasets. GEMLI also compares favorably to cell-picking approaches, which are difficult to scale up and therefore mostly encompass small cell numbers<sup><xref ref-type="bibr" rid="CR21">21</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR25">25</xref></sup>.</p>
    <p id="Par20">Lineage inference approaches based on naturally occurring genetic marks can identify lineages over time spans of weeks or months but require high coverage and sequencing depths or the enrichment of specific transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Trajectory inference algorithms can predict gene expression changes on the order of hours but do not predict lineages<sup><xref ref-type="bibr" rid="CR34">34</xref>,<xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. GEMLI thus fills a methodological gap and shall become a powerful tool to refine lineage trees in combination with other lineage tracing approaches.</p>
    <p id="Par21">With its resolution at the scale of several cell divisions, GEMLI is ideally suited to assess cell fate decisions during differentiation, response to stimulus, homeostasis, and regeneration, and allows correctly assigning a broad diversity of cell types to individual complex structures such as intestinal crypts and organoids. In these cases, the physical proximity of lineage-related cells allows the sharing of a similar microenvironment, which may further increase GEMLIs performance. GEMLI is therefore promising to reconstruct other structures emerging from a common ancestor or a small pool of stem cells, such as glands or spatially restricted areas of the skin. In the context of human breast cancer, we illustrate GEMLIs applications by identifying DCIS nodules, as well as determining previously unknown gene expression changes in lineages encompassing cells at the transition towards an invasive phenotype. Altogether, GEMLI opens new perspectives in interrogating the impact of close lineage relationships in a broad range of biological contexts in vivo.</p>
  </sec>
  <sec id="Sec14">
    <title>Methods</title>
    <sec id="Sec15">
      <title>Cell culture</title>
      <p id="Par22">CGR8 ES cells (Sigma, Cat307032901-1VL) were routinely cultured at 37 °C and 5% CO<sub>2</sub> on 10 cm dishes coated with 0.1% gelatin type B (Sigma, Cat#G9391-100G) in 10 ml GMEM (Sigma, Cat#G5154‐500 ML) supplemented with 10% ES cell‐qualified fetal bovine serum (Gibco, Cat#16141‐079), 1% nonessential amino acids (Gibco, Cat#11140‐050), 2 mM l‐glutamine (Gibco, Cat#25030‐024) and sodium pyruvate (Sigma, Cat#S8636‐100 ML), 100 μM 2‐mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), 1% penicillin and streptomycin (Pen/Strep) (BioConcept, Cat#4‐01F00‐H), homemade leukemia inhibitory factor (LIF), CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat#PZ0181‐25MG) at 0.8 μM. Cells were passaged by trypsinization (2 ml of trypsin, Sigma, Cat#T4049‐100 ML) every 2–3 days at a ratio of 1:10. For scRNA-seq experiments, cells were switched to N2B27 + 2i/LIF medium 2 passages beforehand. N2B27 + 2i/LIF medium was composed of a 1:1 mix of DMEM/F12 (Gibco, Cat#11320‐033) and Neurobasal medium (Gibco, Cat#21103‐049), supplemented with N2 (Gibco, Cat#17502‐001), B27 (Gibco, Cat#17504‐001), 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H), 2 mM L-glutamine (Gibco, Cat#25030‐024), 100 μM 2-mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), LIF, CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat# PZ0181‐25MG) at 0.8 μM. Cells were split every 2–3 days at a ratio of 1:10, using 2 ml of accutase (Innovative Cell Technologies, Cat#31195) and centrifugation. HEK293T cells were routinely cultured at 37 °C and 5% CO<sub>2</sub> on dishes in DMEM high glucose medium (Gibco, Cat#41966) supplemented with 10% Fetal bovine serum (Life Technologies, Cat#10270-106) and 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H).</p>
    </sec>
    <sec id="Sec16">
      <title>Lentiviral barcoding library production</title>
      <p id="Par23">The LARRY lentiviral barcoding library<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was purchased from Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>). The barcodes of the library are composed of 40 base pairs (bp) with 28 random bp separated by 6 fixed bp doublets and are located in the 3’ untranslated region of <italic>EGFP</italic> expressed from the <italic>EF-1ɑ</italic> promoter. The library was amplified and the lentiviral vector was produced according to the associated protocol with small modifications. Briefly, plasmids were introduced into ElectroMAX Stbl4 Competent Cells (Life technologies, Cat#11635018) using MicroPulser Electroporator (Bio-Rad, Cat#1652100) EcoRI program. Cells were incubated for 1 h at 37 °C and spread over 20 large (24.5 × 14.5 cm) Agar+Ampicillin plates (Ampicillin at 100 ug/ml, AppliChem, Cat# A08390025). After 24 h, colonies were harvested through scraping using pre-warmed LB medium supplemented with 100 ug/ml Ampicillin. The resulting 1.5 L bacterial culture was incubated at 37 °C for 2 h and a Maxiprep was performed using a Qiagen MaxiPlus kit (Qiagen, Cat#12963) to a resulting 1 mg of plasmid DNA. A lentiviral vector was produced by transforming the produced LARRY plasmid into HEK293T cells using the Trans-IT 293 transfection reagent (Mirus, Cat#MIR2700). For each of eighteen 10 cm dishes of HEK293T cells, 1.5 ml Opti-MEM (Gibco, Cat#51935), 16 μg plasmid (8 μg LARRY plasmid, 6 μg psPAX2 (Addgene, PRID: Addgene_12260), 2 μg pMD2.G (Addgene, PRID: Addgene_12259)) were mixed with 45 μl TransIT 293 transfection reagent, incubated for 15-30 min at RT, and added to the cells dropwise. Lentiviral vector particles were harvested 48 h and 72 h after transfection. Medium was collected and filtered through a 0.45 μm PVDF filter (Millipore, Cat#SLHV033RS), and centrifuged in a Beckman Optima XL-80K Ultracentrifuge (Beckman, Cat#8043-30-1211) at 140,000 × <italic>g</italic> for 1h 30 min at 4 °C. The supernatant was removed, and pellets were resuspended with 100 μl of GMEM with serum and all additives as above but without 2i/LIF. The lentiviral vector preparation was incubated on ice for 30 min, aliquoted, and stored at –80 °C. Titration of the lentiviral barcoding library was performed on CGR8 cells cultured in GMEM+2i/LIF, with a read-out 5 days after infection.</p>
    </sec>
    <sec id="Sec17">
      <title>Barcode reference library generation</title>
      <p id="Par24">A reference library was made through the sequencing of PCR-amplified barcodes from the LARRY plasmid library in triplicates. 500 ng of LARRY plasmids were taken as input for a two-step PCR using Phusion high-fidelity DNA polymerase (Thermo Fisher, Cat#F-5305) adapted for LARRY from ref. <sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. The first step amplifies the barcodes and adds Illumina Read1 and Read2 sequences (5’ACACTCTTTCCCTACACG ACGCTCTTCCGATCTTGTGACGTCACAGGTCGACACCAGTCTCATT3′ and 5’GTGACTGGAGTTCAG ACGTGTGCTCTTCCGATCGAGTAACCGTTGCTAGGAGAGACCATA3′). The second step adds the P5 and P7 flow cell attachment sequences and a sample index of 7 bp (P5 5’AATGATA CGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT3′ and P7 5’CAAGCAGA</p>
      <p id="Par25">AGACGGCATACGAGANNNNNNNGTGACTGGAGTTCAGACGTGCTCTTCCGATC3′). 200 ng of PCR1 product was taken as input for PCR2. (PCR programs: 98 °C 2 min, 15 cycles of 98 °C 10 s, 67.2 °C (PCR1), 72 °C (PCR2) 30 s, 72 °C 30 s, followed by final elongation 72 °C 5 min and 4 °C indefinitely). In between PCR1 and PCR2 and after PCR2, PCR purification was performed using the QIAquick PCR purification kit (Qiagen, Cat#28106). The mix of the three samples was sequenced on a MiSeq instrument (Illumina) at the Gene Expression Core Facility of EPFL. Sequencing results were first filtered for a perfect match to the plate index pattern using XCALIBR (<ext-link ext-link-type="uri" xlink:href="https://github.com/NKI-GCF/xcalibr">https://github.com/NKI-GCF/xcalibr</ext-link><underline>)</underline>. The resulting read files were filtered for a perfect match to the barcode pattern using customized R scripts. The resulting list and the LARRY “barcode_list” available on Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>) were merged and used as a reference list.</p>
    </sec>
    <sec id="Sec18">
      <title>mESCs scRNA-seq memory experiment run</title>
      <p id="Par26">CGR8 cells were transduced with 3 ul of the lentiviral LARRY barcoding library per 10 cm dish with 10 ml medium to obtain roughly 1% of GFP<sup>+</sup> cells. 72 h after infection, live GFP<sup>+</sup> cells (Fig. <xref rid="MOESM1" ref-type="media">S1a</xref>; live stain 1:500 propidium iodide solution (BioLegend, Cat#421301)) were sorted on an FACSAria III (BD) at the Flow Cytometry Core Facility of EPFL into Cellcarrier 96-Ultra 96-well plates (PerkinElmer, Cat#6055308). Plates were coated with recombinant human E-cadherin-Fc chimera (BioLegend, Cat#BLG-779904-25ug) to reduce colony formation and thereby limit the potential impact of paracrine and direct cell signaling in regulating gene expression of related cells<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. Coating was performed at 10 μg/ml for 1 h at 37 °C. After washing the plates with PBS, 1,200 cells were sorted into two wells and both were collected after 48 h for sequencing. Before collection, cells were imaged on an IN Cell analyzer 2200 (GE Healthcare) at the Biomolecular Screening facility of EPFL. ScRNA-seq library preparation was performed on a 10X Genomics Chromium platform of the Gene Expression Core Facility of EPFL using the SingleCell 3’ Reagent Kit v3.1. The sample was sequenced on a Hiseq4000 instrument (Illumina). The experiment was performed once.</p>
    </sec>
    <sec id="Sec19">
      <title>mESC scRNA-seq data processing and cell lineage inference</title>
      <p id="Par27">ScRNA-seq data was analyzed using 10X Genomics Cell Ranger (v. 5.0.1), Seurat (v. 4.1.0), customized R (v. 4.0.2), and Python (v. 3.9.7) scripts. Raw sequencing reads were processed using 10X Genomics Cell Ranger (v. 5.0.1) using default parameters and refdata-gex-mm10-2020-A as reference genome, with or without the <italic>include-introns</italic> option. Cell Ranger outputs a unique molecular identifier (UMI) corrected read count matrix. Cells with a percentage of mitochondrial reads between 1.75 and 7.5 and with more than 10,000 reads were further analyzed. Data was normalized to 40,000 reads per cell (similar to RPM, one normalized count equals one read on median). Lineage barcodes were extracted from the data using the CellTag pipeline<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> available for download at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>) and adapted to the LARRY barcode design. Briefly, the CellTag pipeline extracts reads containing a CellTag motif from the processed, filtered, and unmapped reads BAM files produced in intermediate steps of the 10X Genomics Cell Ranger pipeline. To extract LARRY barcodes, the CellTag motif was changed to “([ACTG]{4}TG[ACTG]{4}CA[ACTG]{4}AC[ACTG]{4}GA[ACTG]{4}GT [ACTG]{4}</p>
      <p id="Par28">AG[ACTG] {4})” in all scripts. Barcodes with reads from only one UMI, and without perfect match to the reference library were filtered out. A Jaccard similarity score of &gt;0.7 was used to identify cell lineages. No filtering on the number of barcodes expressed per cell was performed. Lineages were called on unfiltered data. For the mESC dataset, 6 lineages had sizes above 5 cells, which is larger than expected based on cell cluster sizes after 48 h of culture and the expected loss of cell lineage members in the preparation for scRNA-seq. They were therefore excluded from further analysis.</p>
    </sec>
    <sec id="Sec20">
      <title>Processing of public scRNA-seq data</title>
      <p id="Par29">Data from Biddy et al.<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> was extracted as a BAM file from SRA links specified under <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>. BAM files were converted back to fastq format using 10X Genomics’ bamtofastq (v. 1.3.2) and Cell Ranger (v. 5.0.1) was run on the resulting data as described above with or without the <italic>include-introns</italic> option. Cells were filtered on the percentage of mitochondrial reads and the number of reads as indicated in Table <xref rid="MOESM1" ref-type="media">S2</xref>. Data was normalized to 40,000 reads per cell. Cell lineages were assigned using the CellTag pipeline as specified above with the original CellTag motif of “(GGT([ACTG]{8})GAATTC)”(V1), “(GTGATG([ACTG]{8})GAATTC)”(V2) or “(TGTACG([ACTG]{8})GAATTC)”(V3) and the respective whitelists and sample-specific cell barcodes available at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>). As in the original publication, cells with &gt;20 or &lt;2 CellTags expressed were not considered for lineage assignment. Lineages were called on unfiltered data using a Jaccard similarity score of &gt;0.7. Cell lineages were called on individual datasets for all analyses of a single time point. Data from Kimmerling et al.<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> is GSE74923_L1210_CD8_processed_data.txt from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GEO</ext-link>. Ground truth cell lineage information was extracted from the GSE74923_series_matrix.txt file. Data from Weinreb et al.<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was downloaded from (<ext-link ext-link-type="uri" xlink:href="https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md">https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md</ext-link>). Data from Jindal et al. was directly obtained from the authors in the form of Seurat objects including the unnormalized but filtered count matrix and a metadata file comprising the lineage information. All datasets were RPM normalized to 40,000 reads/cell. Data from Wehling et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> was directly obtained from the authors in the form of an unnormalized count matrix and the metadata file (available on GEO GSE167317 asGSE167317_CountMatrix_Seq5.csv, GSE167317_CountMatrix_Seq4.csv, GSE167317_Metadata_Seq5.csv, GSE167317_Metadata_Seq4.csv). Cells with under 100,000 reads were removed and data was normalized to 40,000 reads per cell. Lineage information was extracted from the metadata file. Data from Harmange et al. was downloaded from <ext-link ext-link-type="uri" xlink:href="https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing">https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing</ext-link> (accessed begin July 2022) in the form of 10×1_Filterd_BatchCor_unnorm_sctrans.rds from experiment one. Lineages were assigned using the corresponding script section in the file 10×1_r1_r2_Analysis_unorm_sctrans.Rmd. During filtering, cells with &lt;3% of mitochondrial reads, and cells with &lt;4000 reads were removed. Data was normalized to 40,000 reads/cell. Data from Simeonov et al.<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> was obtained in the form of CellRanger output files for the lung metastasis scRNA-seq data of mouse 1 and 2 from GEO (GSE173958; GSM5283486 and GSM5283491). scRNA-seq data was normalized to 40,000 reads/cell. Lineage annotation was obtained from Mendeley data (DOI: 10.17632/t98pjcd7t6.1) in the form of “Barcodes-of-barcodes” files for all clones. This metadata was then filtered for the annotations of clones present in the scRNA-seq datasets of the lung metastases of mouse 1 and 2. Data from Bues et al.,<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> was directly obtained from the authors in the form of a Seurat Object including a normalized count matrix with crypt and organoid annotation. Briefly, organoids were generated by sorting single Lgr5<sup>+</sup> intestinal stem cells from dissociated organoids into a Matrigel matrix. After culture for 3, 4, 5, or 6 days, single organoids were hand-picked and dissociated individually before loading for scRNA-seq. Organoids are derived from 3 batches. Lgr5<sup>+</sup> intestinal stem cells seeded can be derived from the same organoid. Crypts were collected over 5 batches of 3 pooled mice from 10 mm sections of the ileum. Crypts within the same batch can be derived from the same mouse but were several mm apart in the ileum. Data and scripts from Miller et al.<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/vangalenlab/MAESTER-2021">https://github.com/vangalenlab/MAESTER-2021</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://vangalenlab.bwh.harvard.edu/resources/maester-2021/">https://vangalenlab.bwh.harvard.edu/resources/maester-2021/</ext-link> as TenX_CellLineMix_cells.rds, TenX_CellLineMix_All_mr3_maegatk.rds, TenX_CellLineMix_Seurat_Keep.rds (for the K562 dataset) and BPDCN712_Maegatk_Final.rds, BPDCN712_Seurat_Final.rds, 4.2_vois.txt (for the primary human bone marrow cells). Lineage assignment was performed as in the scripts 3.4_TenX_K562_clones.R and 4.3_variants_Of_Interest.R for K562 and bone marrow cells respectively. “GroupIDs” were then unlisted to extract the cell-barcode lineage correspondence. The count-matrix for the K562 dataset was extracted from the TenX_CellLine_Mix Seurat object by filtering for K562 cells. For the primary bone marrow cells, the BPDCN712 Seurat object was split out by replicate to generate the GEMLI input count matrices. For both cell types, lineages were filtered to be defined by a single informative mitochondrial variant. Data from Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast">https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast</ext-link>. The scRNA-seq dataset was filtered to a &gt; 1000 reads/cell and a mitochondrial fraction of 1-50%. Cell types were annotated through supervised machine learning. In brief, a UMAP was built upon a linear discriminant analysis (LDA; R package ‘MASS’ (v. 7.3-58.3) performed on log molecule numbers) which in turn was based on provided cluster annotations for Xenium data in situ sequencing data. Single-cell RNA-seq Chromium data was then projected onto this LDA-UMAP to assign cell types. Assignments were specific and unique. Finally, each cluster was assigned its cell type annotation through the assessment of marker genes provided in Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>.</p>
    </sec>
    <sec id="Sec21">
      <title>ScRNA-seq data representation</title>
      <p id="Par30">ScRNA-seq data is represented as tSNE, UMAP, or SPRING graph. tSNE embeddings were generated using a custom function based on the tSNE R package (v. 0.1-3.1) on exonic, or both intronic and exonic reads. PCA was calculated on the 3,000 top variable expressed genes. Subsequently, a tSNE was computed on the PCAs top 10 components. SPRING graphs were generated from precalculated values in public datasets (HSPC data was represented as SPRING graph)). UMAPS (mESC, crypts, and organoid datasets) were generated in a standard Seurat analysis. Briefly, variable features were called using the FindVariableFeatures function (parameters selection.method =”vst”, and number of features = 2000), data was scaled using the ScaleData function on all genes, and a PCA was run using the RunPCA function on variable features. Subsequently, a UMAP was built using the RunUMAP function on the top 14 components.</p>
    </sec>
    <sec id="Sec22">
      <title>Assessment of gene expression similarity</title>
      <p id="Par31">Gene expression correlation within cell lineages or random samples for the whole transcriptome was calculated as Pearson correlation. Correlation distance is calculated as 1- the correlation value. To assess the similarity of related cells with respect to cell cycle, genes were classified as cell cycle-dependent or independent using a cell cycle assignment by the cyclone function within scran (v. 1.18.7). Dependence of gene expression on the cyclone assigned cell cycle phases (numerized) was tested using Hoeffding’s D statistics. Gene expression correlation was then calculated using only genes classified as cell-cycle dependent. To assess the similarity in the velocity of related cells, velocity analysis was performed using the velocyto package (v. 0.6). Velocity momenti were extracted for each cell, and their Pearson correlation was calculated. Complexity was defined as the number of genes expressed in a cell and the complexity range within cell lineages was calculated for analysis. For all metrics (transcriptomic similarity in all genes, in cell-cycle dependent genes, similarity in velocity momenti, and in complexity) values between related cells (all lineage sizes) and repeated (100x) random samples of cells of the same size were compared. For the scoring of transcriptomic similarity in symmetric and asymmetric lineages, symmetric and asymmetric lineages were defined based on entire lineages.</p>
    </sec>
    <sec id="Sec23">
      <title>Estimation of variation mediated by cell lineages</title>
      <p id="Par32">Assuming that the variation (here CV<sup>2</sup>) within each lineage is independent of cross-lineage effects, we built a linear model using the <italic>stats</italic> package (v. 3.6.2) to capture the relationship of the variation across lineages (variation of means of each lineage) and total variation (variation across all cells). We then generated mock lineages through the permutation of ground truth lineages and used our model to estimate the total variation in these control sets. Lineages of sizes 3–5 for mESCs and WM989 cells, of size 4 for CD8 and L1210, and of size 2 for all other cell types were considered. This ensured to inclusion of around 90% of the cells in each dataset.</p>
    </sec>
    <sec id="Sec24">
      <title>Memory-gene identification and categorization</title>
      <p id="Par33">We defined memory genes as genes with high variability (coefficient of variability squared; CV<sup>2</sup>) in mean gene expression in different cell lineages. We compared the lineage value to the distribution of values from repeated (20x) random size-matched samples of cells to calculate a p-value. Memory genes were defined as genes with a significantly (p &lt; =0.05) higher variability between lineages as compared to random samples. To categorize memory genes into quantitative and qualitative memory genes, we used the <italic>skewness</italic> function of the R package <italic>moments</italic> (v. 0.14.1). We defined a quantitative memory gene as a gene with a skewness in expression level of under 3, and a qualitative memory gene, as a gene with a skewness in expression level equal or above 3. Memory genes were called on cell lineages of 3–5 (mESCs), 2 members (invasive tumor), or 2–5 members (all other cell types). All predicted cell lineages were used when calling memory genes on these. Other criteria to call memory genes resulted in highly overlapping gene sets (Fig. <xref rid="MOESM1" ref-type="media">S6a, b</xref>). These additional memory gene selection criteria included a high correlation in gene expression within cell lineages and a low variability (CV<sup>2</sup>) in gene expression between cells of the same cell lineage (intra-lineage CV<sup>2</sup>; intraCV<sup>2</sup>). Furthermore, we analyzed marker genes of cell lineages using the Seurat FindMarker function with a range of <italic>test.use</italic> parameters (<italic>bimod, roc, t</italic> (T-test)<italic>, negbinom, poisson, LR, MAST</italic>). We then considered as memory genes the markers with a high sharing across cell lineages, using thresholds defined independently for each <italic>FindMarker</italic> run to optimize the Pearson correlation in gene expression within cell lineages. Finally, to identify memory genes using machine learning, we used common dimension reduction methods, mutual information maximizer (MIM), and ANOVA F-test feature selection (ANOVA). Other feature selection techniques frequently used in the literature were also investigated, but MIM and ANOVA outperformed all the other methods. For both, each gene was attributed a memory score either by computing the mutual information or ANOVA <italic>F</italic>-test of the gene expression across cells. To determine the ideal number of genes N to include in the final gene set, we predicted cell lineages using the top N genes with the highest memory score. Each of the resulting clusters was evaluated and the number of genes N with the best precision was chosen as the optimal number of memory genes. For the comparison of memory genes and variable genes in the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, memory genes were called on lineages predicted at confidence level 50 with a lineage size parameter of 2–20 in each cell type independently. Genes were considered to be variable when having a residual to a least total square fit on mean expression and CV² above zero.</p>
    </sec>
    <sec id="Sec25">
      <title>GO-term enrichment analysis</title>
      <p id="Par34">GO-term enrichment analysis was performed on memory genes called using the lineage ground truth (derived from cellular barcoding, microfluidics, or sister cell picking), and on memory genes called using predicted cell lineages. The <italic>topGO</italic> R package (v. 2.42.0) was used with the GO category “biological process”. Memory genes and background (all genes detected) were considered to be binary. The top 10, 20, 100, or 500 enriched GOs from each set were visualized as indicated. Spearman rank correlation between GO-term enrichment values was calculated for memory genes called on-ground truth and predicted cell lineages. For GO-term enrichment of memory genes called based on predicted lineages in the Janesick data, GO-terms were further compared to expression-matched random gene sets. Enriched terms were significant (Fisher’s exact test, <italic>p</italic> &lt; 0.001) and enriched over 100 expression-matched random gene sets (estimated <italic>p</italic> &lt; 0.05). A selection of terms is shown in Fig. <xref rid="MOESM1" ref-type="media">S22a</xref> and the full list can be found in Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec26">
      <title>Gene selection for GEMLI predictions</title>
      <p id="Par35">Genes for cell lineage predictions were selected to enrich memory genes based on the quantiles of the mean and variability of gene expression. The variability of gene expression was defined as mean-corrected CV<sup>2</sup> calculated in the form of the residual of the CV<sup>2</sup> to a linear fit of CV<sup>2</sup> and mean expression. The genes selected for lineage predictions are the 2% highest expressed genes, the 60% most variable among the 10% highest expressed genes, and the 10% most variable among the 40% highest expressed genes: (mean quantile &gt;= 98) or (mean quantile &gt;= 90 and variability quantile &gt;= 40) or (mean quantile &gt;= 60 &amp; and variability quantile &gt;= 90)). The selected genes are taken as input for the repetitive iterative clustering algorithm. The selected genes do only partly overlap with highly variable genes and cell type markers called during a standard Seurat-based scRNA-seq analysis (Figs. <xref rid="MOESM1" ref-type="media">S4f</xref> and  <xref rid="MOESM1" ref-type="media">S7f</xref>). For this comparison, highly variable genes were called as top 2000 variable genes with standard Seurat parameters. Cell type markers were called using Seurat’s FindMarkers function for each cell type present with at least 5 cells. Also using machine learning to select genes based on variability and mean gene expression did not further enrich memory genes (Fig. <xref rid="MOESM1" ref-type="media">S7c</xref>). Briefly, different models were trained including logistic regression with L2 regularization (LR), support-vector machine (SVM) with the radial basis function (RBF) kernel, and a neural network. The mESC and Biddy et al. MEF datasets of 48 h and 72 h culture time (<italic>n</italic> = 1 and <italic>n</italic> = 6, respectively) were used for model training, the datasets of CD8, L1210 (<italic>n</italic> = 1 each), and HSPC (48 h; <italic>n</italic> = 22) were used for model validation. The mean expression outliers in each dataset were removed using the inter-quartile range (IQR) method. All the outliers were considered to be memory genes and were added in the final gene selection. Then, the data was normalized to a range between 0 and 1. Each dataset was preprocessed individually. The LR and SVM models were trained using their sklearn (v. 1.1.1) implementation. The neural network was optimized using the Pytorch framework (v. 1.11.0). To optimize the model, a balanced version of the binary cross entropy loss and accuracy was used to account for the fact that the proportion of memory genes is low in all datasets while most machine learning models assume that the data has approximately the same number of samples of both classes. To take this into account, a bigger weight was given to a misclassification of the minority class, the memory genes. To find the optimal hyperparameters for the LR and SVM a grid search and cross-validation were performed. Based on this, the L2 regularization was adjusted to 10<sup>3</sup> and 10<sup>5</sup> for LR and SVM respectively. For the neural network, cross-validation was deemed too computationally expensive, and the Optuna Python package (v. 2.10.0) was used to perform a random search for the optimal hyperparameters on training and validation set (Supplementary Data file <xref rid="MOESM9" ref-type="media">6</xref>). The best performing model was the neural network and its results are show in the Supplementary Figs.</p>
    </sec>
    <sec id="Sec27">
      <title>GEMLI cell lineage prediction algorithm</title>
      <p id="Par36">The GEMLI algorithm is a repetitive iterative clustering approach to predict cell lineages (Scheme in Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, see Table <xref rid="MOESM1" ref-type="media">S1</xref> for a comparison to other clustering algorithms), taking a gene set as input. For de novo cell lineage predictions on scRNA-seq data without lineage annotation the gene set is selected based on mean gene expression and variability (see previous section). Also other gene sets can be used as input, notably memory genes when a ground truth lineage annotation is available (see below). During each iterative clustering, the input gene set is randomly subsampled to 75% (sampling value parameter; see section on GEMLI parameters below). This gene set subsample is then used to cluster the cells of the dataset iteratively as follows. During the first iteration, two clusters (cluster cut parameter; see below) are generated using <italic>cutree</italic> function from the dendextend (v.1.16.0) R package and the <italic>hclust</italic> hierarchical clustering function of the R package stats (v.4.0.2) on the gene expression correlation distance using the agglomeration method ward.D2. In every subsequent iteration round, the cells of each previously defined cluster are clustered again into two clusters using the same procedure. The iteration is ended for clusters meeting a predetermined size of 2–3 cells (lineage size parameter, see below). This results in a cell-by-cell matrix indicating for each cell-pair if it did cluster together in the final cluster of 2–3 cells. This iterative hierarchical clustering represents one-cell lineage prediction. It is repeated 100 times (repetition number parameter, see below) to generate a confidence level for the lineage predictions. More in detail, the cell-by-cell matrices generated in the 100 repetitions of the iterative hierarchical clustering are summed into a confidence level cell-by-cell matrix. Two cells ending up in the same cluster in 30 of the 100 predictions will here for example receive the value of 30. Setting a threshold on the confidence level can then be used for lineage assignment. Cell lineages are assigned as cell groups of which members are clustering together above a confidence level threshold. Lineage assignments are scored against the ground truth lineages (barcode, microfluidic, or sister-cell picking) on precision (true positives (TP)/(TP+ false positives (FP))), sensitivity (TP/(TP+ false negatives (FN))) and false positive rate (FPR; FP/(FP+ true negatives (TN))). All are calculated for each confidence level X by comparing the predictions with a confidence level &gt;=X to the ground truth cell lineage relationships. Thereby precision, sensitivity and FPR are calculated on cell pairs. For the majority of datasets, also AUC values were calculated using the R package Metrics (v. 0.1.4) by the confidence level of predictions as a probability value.</p>
    </sec>
    <sec id="Sec28">
      <title>Comparison of GEMLI to other lineage assignment approaches</title>
      <p id="Par37">To test the performance of GEMLI predictions, characteristics-based gene selection was compared to other starting gene sets, as all genes and memory genes called using the lineage ground truth (from cellular barcoding, microfluidics, or sister cell picking). Further, different memory gene definitions (see above) and Seurat’s highly variable genes (see above) were tested as input gene sets. Finally, memory gene enriched gene sets selected based on mean expression and variability using a neural network (see above) were tested in predictions. GEMLI predictions had a slightly lower precision and sensitivity than predictions using memory genes, but performed better than all genes (Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). FPR was comparable between all three genesets (GEMLI, memory genes, all genes) and consistently very low (&lt;1%) at confidence levels &gt;=50. Other memory gene definitions did not improve prediction performance (Fig. <xref rid="MOESM1" ref-type="media">S6c–h</xref>). Also, gene selection based on a neural network did not improve lineage predictions as compared to GEMLI (Fig. <xref rid="MOESM1" ref-type="media">S9d</xref>). Seurat’s highly variable genes likewise performed worse than the GEMLI gene selection (Fig. <xref rid="MOESM1" ref-type="media">S9f</xref>). Furthermore, the use of a memory gene set called using the ground truth lineage information in one dataset, did also not allow for improved predictions in other datasets of the same or related/other starting cell type and culture condition (Fig. <xref rid="MOESM1" ref-type="media">S9e</xref>). Finally, GEMLI performance was also compared to other lineage assignment approaches, namely random cell pair assignment and kNN-clustering-based lineage assignments. GEMLI predictions on randomly lineage-assigned cells had as expected a very low precision and sensitivity and a high FPR (Fig. <xref rid="MOESM1" ref-type="media">S9a</xref>). Furthermore, cell pairs generated using kNN-clustering with different inputs (Seurat top 2000 variable genes, top 14 components of a PCA on these genes, UMAP on this PCA) resulted in a very low precision, comparable sensitivity, and higher FPR than GEMLI predictions (Fig. <xref rid="MOESM1" ref-type="media">S9b, c</xref>).</p>
    </sec>
    <sec id="Sec29">
      <title>GEMLI predictions for symmetric and asymmetric lineages and different lineage sizes</title>
      <p id="Par38">Scoring predictions for symmetric (one cell type) and asymmetric (several cell types) lineages were performed in three ways. First, only two-cell lineages were scored, which can be unequivocally defined as symmetric (both members of one cell type) and asymmetric (each member of another cell type). Second, lineages of all sizes were scored for which symmetry was defined considering all cell members. Lineages with all members in one cell type were here considered symmetric. Lineages in which any members were part of two different cell types were considered to be asymmetric. Third, cell pairs were scored on the entire prediction matrix by taking pairs where both cells are of the same cell type as symmetric lineage, and pairs where both cells are of a different cell type as asymmetric lineage, respectively. For lineage size analyses the prediction matrix was stratified to only score pairs in which one or both cells are members of a lineage of the indicated ground truth lineage size.</p>
    </sec>
    <sec id="Sec30">
      <title>KNN-clustering-based lineage assignments for comparison to GEMLI predictions</title>
      <p id="Par39">For kNN analysis a standard Seurat pipeline was used. Data was normalized and the 2000 most variable features were extracted using default parameters. The data was then scaled, a PCA was performed on previously defined variable genes and a UMAP was conducted on the first 14 principal components. The kNN analysis was then performed using the dbscan package (v. 1.1-11) with <italic>k</italic> = 1 or 2 as indicated, on either the scaled data for variable features, the 14 first principal components or the UMAP embedding. Pairs of nearest neighbors were used as the lineage for comparison with GEMLI predictions.</p>
    </sec>
    <sec id="Sec31">
      <title>GEMLI prediction algorithm parameters</title>
      <p id="Par40">Several parameters can be set during GEMLI predictions: (1) the sampling value (which fraction of genes is selected for each repetition of the iterative hierarchical clustering), (2) the number of repetitions of the iterative clustering (based on which the confidence level is calculated), (3) the number of clusters in which clusters are split during each iteration (“cluster cut”) and (4) the size of clusters at which clustering iterations are stopped (“lineage size parameter”). The default values used throughout the main figures are a sampling value of 75%, 100 repetitions, splitting clusters into 2 during each iteration, and lineage size parameter of 2–3 cell members unless otherwise indicated. The influence of changes in single parameters on predictions was tested on the unique mESC, CD8, L1210, and one HSPC, WM989, and HSC dataset (Figs. <xref rid="MOESM1" ref-type="media">S10</xref> and  <xref rid="MOESM1" ref-type="media">S12</xref>). A lower sampling value increased precision while decreasing sensitivity (Fig. <xref rid="MOESM1" ref-type="media">S10a, b</xref>). When the number of clusters into which each cluster is split is higher than the maximal lineage size to be predicted, precision values increase and sensitivity decreases (Fig. <xref rid="MOESM1" ref-type="media">S10c, d</xref>). The number of repetitions did only had a small effect on precision and sensitivity values, with higher repetition numbers increasing precision and decreasing sensitivity of the predictions (Fig. <xref rid="MOESM1" ref-type="media">S12e, f</xref>). Also, the lineage size parameter, meaning the size of clusters at which clustering iterations are stopped influences both precision and sensitivity. Precision will be high for predictions with a lineage size parameter of 2–3 until the average size of ground truth lineages is present (Fig. <xref rid="MOESM1" ref-type="media">S12</xref>). FPR stayed low throughout. Only a size parameter greatly exceeding the average ground truth lineage size (Fig. <xref rid="MOESM1" ref-type="media">S12c–e</xref>) can increase FPR to values &gt; 1%, but still &lt;5%. For predictions of multicellular structures (intestinal crypts and organoids) for which related cells are in spatial proximity to each other, the cluster stability of lineages predicted at increasing lineage size parameters, (cluster stability calculated using the sc3 package within the R package clustree (v.0.5.0)), reflected well the ground truth lineage size and plateaued when reaching the maximal ground truth lineage size present. In contrast, for predictions in datasets with primarily small lineages without a spatial proximity or confinement, sc3 cluster stability of predictions increased gradually with increasing lineage size parameter and did not plateau. This allowed for a de novo estimation of the lineage size until which prediction could be performed with high precision in datasets with multicellular structures (fig. <xref rid="MOESM1" ref-type="media">S19</xref>). Depending on the aim of cell lineage predictions and the dataset characteristics (see next section), parameters and confidence level threshold can thereby be adjusted to increase precision or sensitivity respectively.</p>
    </sec>
    <sec id="Sec32">
      <title>Influence of sequencing depth and cell number on GEMLI predictions</title>
      <p id="Par41">To estimate the influence of sequencing depth and dataset size on lineage predictions, GEMLI predictions were performed after downsampling the number of reads or cells in the mESC dataset, and one MEF and HSPC dataset (Fig. <xref rid="MOESM1" ref-type="media">S15</xref> and Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). For read downsampling, all reads of a given cell were vectorized, and subsequently, a fraction (66%, 50%, 33%, 10%) of these reads were sampled. Cells were subsampled separately to 66%, 50%, 33%, and 10% of the initial cell numbers. Cells without lineage assignment or being the only member of a cell lineage were subsampled directly to the desired fraction. Cells that were members of cell lineages with several members were subsampled together with their respective cell lineage members. Sensitivity of lineage predictions decreased with decreasing sequencing depth but the precision of lineage predictions stayed high above values of 5000–8000 reads/cell as commonly recommended for available scRNA-seq technologies<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup> (Fig. <xref rid="MOESM1" ref-type="media">S15a, b</xref>). Subsamples with fewer cells generally had a slightly better precision and sensitivity, especially for very low read counts (Fig. <xref rid="MOESM1" ref-type="media">S15c, d</xref>). FPR stayed &lt;1% for all conditions.</p>
    </sec>
    <sec id="Sec33">
      <title>Cell fate decision analysis</title>
      <p id="Par42">To assess how well GEMLI can recapitulate the prevalence of different types of cell fate decisions, the HSPC (N = 44) and WM989 (N = 8) datasets were analyzed. HSPCs datasets are derived from cells cultured in myeloid differentiation conditions and are annotated according to their cell type as basophil (Baso), eosinophil (Eosino), erythroid, lymphoid (Lymph), megakaryocyte (Meg), monocyte (Mono), neutrophil (Neutro), mast cell, plasmacytoid dendritic cell (pDC (1/2)), migratory dendritic cell (Ccr7<sup>+</sup>), classic dendritic cell (cDC) or undifferentiated (Undiff) cells (published metadata<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>). Only certain cell type combinations of related cells exist and all have a different prevalence, meaning that HSPCs are restricted in their fate decisions. For each possible cell type combination (for example, erythroid-eosinophil or undifferentiated-mast cell) the number of cell pairs in barcode and GEMLI lineages was determined and summed for all datasets. WM989 cells are annotated as drug-susceptible or drug-resistant (published metadata<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>). Members of each cell lineage are either entirely in one of these two states (symmetric cell pairs) or distributed between these two states (asymmetric cell pairs), with the latter implying that cells recently switched fate. We compared the number of barcodes- and GEMLI-predicted related cell pairs being entirely drug-susceptible, primed, or distributed between the two states. Both for HSPC and WM989 datasets, also DEGs called between different related asymmetric and symmetric cell pairs were compared in barcode and GEMLI lineages. DEG was called using the <italic>FindMarkers</italic> function of Seurat with parameters min.pct=0.05 (HSPC) or 0.25 (WM989) and logfc.threshold=0.1. For HSPCs, not all comparisons of cell type pairs allowed DEG identification. To compare GEMLI and barcode lineages, the Spearman rank correlation between enrichment scores was calculated. The performance of GEMLI in recapitulating the prevalence of lineages and encompassing different cell types (HSPC) of states (WM989) was also compared to random cell lineage assignments for HSPC and WM989 datasets. For the HSPC datasets, it was further compared to a kNN-clustering based lineage assignment. Likewise, the performance of GEMLI in recovering DEG specific to cells in lineages composed of specific cell types or states was also compared to random cell type and kNN-based lineage assignments as follows. For the DEG analysis in Fig. <xref rid="Fig3" ref-type="fig">3e–d</xref> the correlation between the enrichment of DEG in ground truth lineages and predicted lineages for which members were exchanged against random cells of the same cell type was calculated (Fig. <xref rid="MOESM1" ref-type="media">S17e, f</xref>). For the HSPC datasets, DEG analysis was also performed for random cell samples and kNN-based lineage assignments in all datasets (Fig. <xref rid="MOESM1" ref-type="media">S17a, d</xref>). Cell-type combinations predicted by GEMLI were scored and compared. Trajectory analyses were performed using the <italic>scran</italic> (v. 1.28.2) and <italic>slingshot</italic> (2.8.0) packages. Analyses were performed on the 200 (HSPC) or 2000 (WM989) most variable genes on a UMAP with cluster annotation based on a nearest-neighbor graph. Cells in transition was identified based on pseudo-time as those cells of each type that are located close to the transition point between undifferentiated cells and neutrophil cells (HSPC) or drug-susceptible and primed cells (drug-resistant; WM989) respectively. To analyze cell fate decisions in the human breast cancer cell subsets of the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, DEG were called as described above for all cell pairs being members of lineages predicted with lineage size parameter 2–20 cells at confidence level 50 annotated as encompassing only DCIS or invasive tumor cells (symmetric DCIS and symmetric invasive tumor lineages respectively) or being members of lineages encompassing both cell types (asymmetric lineages). For the latter category, only DCIS or invasive tumor cells were considered when indicated.</p>
    </sec>
    <sec id="Sec34">
      <title>Datasets considered for analysis</title>
      <p id="Par43">For datasets considered in each figure and analysis see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>. For all figures in which one dataset of seven cell types is represented the unique mESC, CD8, L1210, as well as the MEF dataset BIDDY_D0_2, the WM989 dataset WM989_well1, the HSC dataset HSC_seq2, and the HSPC dataset LK_D2_exp1_library_d2_2 are represented. To show a dataset encompassing a large number of asymmetric lineages, the dataset LK_D4_well1_exp1_library_d4_1_2 is used in Fig. <xref rid="Fig3" ref-type="fig">3e</xref>. For other panels see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>.</p>
    </sec>
    <sec id="Sec35">
      <title>Statistics and reproducibility</title>
      <p id="Par44">A two-sided Mann–Whitney <italic>U</italic>-test, which does not require normally distributed data, was used to test statistical significance when indicated. No statistical method was used to predetermine sample sizes. No data were excluded from the analyses. The experiments were not randomized. The investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec36">
      <title>Reporting summary</title>
      <p id="Par45">Further information on research design is available in the <xref rid="MOESM10" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec37">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2024_47158_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Material</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2024_47158_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2024_47158_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2024_47158_MOESM4_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2024_47158_MOESM5_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2024_47158_MOESM6_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2024_47158_MOESM7_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 4</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2024_47158_MOESM8_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 5</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM9">
          <media xlink:href="41467_2024_47158_MOESM9_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 6</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM10">
          <media xlink:href="41467_2024_47158_MOESM10_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec38">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM11">
          <media xlink:href="41467_2024_47158_MOESM11_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: A. S. Eisele, M. Tarbier.</p>
    </fn>
    <fn>
      <p>
        <bold>Change history</bold>
      </p>
      <p>6/4/2024</p>
      <p>A Correction to this paper has been published: 10.1038/s41467-024-48978-8</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-024-47158-y.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank the Gene Expression Core Facility, Flow Cytometry Core Facility, Biomolecular Screening Facility, and Scientific IT &amp; Application Support of EPFL. Computational analysis was partially performed on resources provided by the SNIC through UPPMAX. We thank Theo Maffei and Imane Ben M’Rad as students of the EPFL Machine Learning Master course CS-433, as well as Bart Deplancke, Gioele La Manno, Nicholas Phillips, Vincent Gardeux, Johannes Bues, Jörn Pezoldt, Nikolay Oskolkov, Gustavo Jeuken, and the Friedländer, Kutter and Pelechano labs for their helpful input. We are thankful for funding by Swiss National Science Foundation grant#CRSII5_189910 to D.M.S., Novartis Foundation for Medical-Biological Research grant#20A023 to D.M.S., OE och Edla Johanssons Research Foundation to M.T. and A.S.E., The Swedish Research Council (VR 2021-06112 and 2020-01480) to V.P., Knut and Alice Wallenberg Foundation (KAW 2021.0167) to V.P., Ragnar Söderberg Foundation (S12/20) to V.P.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Conceptualization: A.S.E. and D.M.S. Supervision: D.M.S. and V.P. Generation ES cell data: A.S.E. Data analysis: A.S.E., M.T., A.D. Writing R package: A.S.E., M.T. Funding acquisition: D.M.S., V.P., M.T., A.S.E. Writing of the revised manuscript: A.S.E., D.M.S., M.T.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par46"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. CGR8 mESC scRNA-seq data generated in this study has been deposited on GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE226169">GSE226169</ext-link>. The MEF datasets used in this paper are available at GEO under accession codes <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>, The CD8 and L1210 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GSE74923</ext-link>. The HSC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM5101733">GSE167317</ext-link>. The WM989 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE237228">GSE237228</ext-link>. The pancreatic cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE173958">GSE173958</ext-link>. The intestinal crypt and organoid datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE148093">GSE148093</ext-link>. The HSPC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE140802">GSE140802</ext-link>. The human bone marrow and K562 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE182685">GSE182685</ext-link>. The human breast cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE243280">GSE243280</ext-link>. Source data are provided with this paper<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The GEMLI R package and its documentation are available on GitHub at <ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>. A <italic>Zenodo</italic> repository has been created for the GitHub GEMLI package v1.0.0 under doi:10.5281/zenodo.10673334<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. The code to produce all main figures of the paper is available on <italic>Zenodo</italic> doi: 10.5281/zenodo.10581737<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par47">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chang</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ontogeny and vulnerabilities of drug-tolerant persisters in HER2+ breast cancer</article-title>
        <source>Cancer Discov.</source>
        <year>2022</year>
        <volume>12</volume>
        <fpage>1022</fpage>
        <lpage>1045</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-1265</pub-id>
        <?supplied-pmid 34911733?>
        <pub-id pub-id-type="pmid">34911733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Emert</surname>
            <given-names>BL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Variability within rare cell states enables multiple paths toward drug resistance</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>865</fpage>
        <lpage>876</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00837-3</pub-id>
        <?supplied-pmid 33619394?>
        <pub-id pub-id-type="pmid">33619394</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fennell</surname>
            <given-names>KA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Non-genetic determinants of malignant clonal fitness at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>601</volume>
        <fpage>125</fpage>
        <lpage>131</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-04206-7</pub-id>
        <?supplied-pmid 34880496?>
        <pub-id pub-id-type="pmid">34880496</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harmange</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Disrupting cellular memory to overcome drug resistance</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>7130</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-41811-8</pub-id>
        <?supplied-pmid 37932277?>
        <pub-id pub-id-type="pmid">37932277</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <mixed-citation publication-type="other">Meir, Z., Mukamel, Z., Chomsky, E., Lifshitz, A. &amp; Tanay, A. Single-cell analysis of clonal maintenance of transcriptional and epigenetic states in cancer cells. <italic>Nat. Genet</italic>. 10.1038/s41588-020-0645-y (2020).</mixed-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oren</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cycling cancer persister cells arise from lineages with distinct programs</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>576</fpage>
        <lpage>582</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03796-6</pub-id>
        <?supplied-pmid 34381210?>
        <pub-id pub-id-type="pmid">34381210</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Shaffer, S. M. et al. Memory sequencing reveals heritable single-cell gene expression programs associated with distinct cellular behaviors. <italic>Cell</italic>10.1016/j.cell.2020.07.003. (2020).</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dar</surname>
            <given-names>RD</given-names>
          </name>
        </person-group>
        <article-title>A transient heritable memory regulates HIV reactivation from latency</article-title>
        <source>iScience</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>102291</fpage>
        <pub-id pub-id-type="doi">10.1016/j.isci.2021.102291</pub-id>
        <?supplied-pmid 33889814?>
        <pub-id pub-id-type="pmid">33889814</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Biddy, B. A. et al. Single-cell mapping of lineage and identity in direct reprogramming. <italic>Nature</italic>10.1038/s41586-018-0744-4 (2018).</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Mold, J. E. et al. Clonally heritable gene expression imparts a layer of diversity within cell types. <italic>Cell Systems</italic>10.1016/j.cels.2024.01.004 (2024).</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tian</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal multi-omics reveals Bcor as a negative regulator of emergency dendritic cell development</article-title>
        <source>Immunity</source>
        <year>2021</year>
        <volume>54</volume>
        <fpage>1338</fpage>
        <lpage>1351.e9</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2021.03.012</pub-id>
        <?supplied-pmid 33862015?>
        <pub-id pub-id-type="pmid">33862015</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Weinreb, C., Rodriguez-Fraticelli, A., Camargo, F. D. &amp; Klein, A. M. Lineage tracing on transcriptional landscapes links state to fate during differentiation. <italic>Science</italic>10.1126/science.aaw3381 (2020).</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oki</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Epigenetic memory underlies cell-autonomous heterogeneous behavior of hematopoietic stem cells</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>167</volume>
        <fpage>1310</fpage>
        <lpage>1322.e17</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.10.045</pub-id>
        <?supplied-pmid 27863245?>
        <pub-id pub-id-type="pmid">27863245</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriguez-Fraticelli</surname>
            <given-names>AE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing unveils a role for TCF15 in haematopoiesis</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>585</fpage>
        <lpage>589</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2503-6</pub-id>
        <?supplied-pmid 32669716?>
        <pub-id pub-id-type="pmid">32669716</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Richman</surname>
            <given-names>LP</given-names>
          </name>
          <name>
            <surname>Goyal</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ClonoCluster: a method for using clonal origin to inform transcriptome clustering</article-title>
        <source>Cell Genomics</source>
        <year>2023</year>
        <volume>3</volume>
        <fpage>100247</fpage>
        <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100247</pub-id>
        <?supplied-pmid 36819662?>
        <pub-id pub-id-type="pmid">36819662</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alemany</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Florescu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Baron</surname>
            <given-names>CS</given-names>
          </name>
          <name>
            <surname>Peterson-Maduro</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Whole-organism clone tracing using single-cell sequencing</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>556</volume>
        <fpage>108</fpage>
        <lpage>112</lpage>
        <pub-id pub-id-type="doi">10.1038/nature25969</pub-id>
        <?supplied-pmid 29590089?>
        <pub-id pub-id-type="pmid">29590089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lederer</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>The emergence and promise of single-cell temporal-omics approaches</article-title>
        <source>Curr. Opin. Biotechnol.</source>
        <year>2020</year>
        <volume>63</volume>
        <fpage>70</fpage>
        <lpage>78</lpage>
        <pub-id pub-id-type="doi">10.1016/j.copbio.2019.12.005</pub-id>
        <?supplied-pmid 31918114?>
        <pub-id pub-id-type="pmid">31918114</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Raj</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous single-cell profiling of lineages and cell types in the vertebrate brain</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>442</fpage>
        <lpage>450</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4103</pub-id>
        <?supplied-pmid 29608178?>
        <pub-id pub-id-type="pmid">29608178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spanjaard</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous lineage tracing and cell-type identification using CrIsPr-Cas9-induced genetic scars</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>469</fpage>
        <lpage>473</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4124</pub-id>
        <?supplied-pmid 29644996?>
        <pub-id pub-id-type="pmid">29644996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Frieda, K. L. et al. Synthetic recording and in situ readout of lineage information in single cells. <italic>Nature</italic>10.1038/nature20777. (2017).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Kimmerling, R. J. et al. A microfluidic platform enabling single-cell RNA-seq of multigenerational lineages. <italic>Nat. Commun</italic>. 10.1038/ncomms10220 (2016).</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Kumar, R. M. et al. Deconstructing transcriptional heterogeneity in pluripotent stem cells. <italic>Nature</italic>10.1038/nature13920 (2014).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Wehling, A. et al. Combined single-cell tracking and omics improves blood stem cell fate regulator identification. <italic>Blood</italic>10.1182/blood.2022016880 (2022).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wheat</surname>
            <given-names>JC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-molecule imaging of transcription dynamics in somatic stem cells</article-title>
        <source>Nature</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2432-4</pub-id>
        <?supplied-pmid 32581360?>
        <pub-id pub-id-type="pmid">32581360</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florian</surname>
            <given-names>MC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Aging alters the epigenetic asymmetry of HSC division</article-title>
        <source>PLoS Biol.</source>
        <year>2018</year>
        <volume>16</volume>
        <fpage>e2003389</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.2003389</pub-id>
        <?supplied-pmid 30235201?>
        <pub-id pub-id-type="pmid">30235201</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>LINEAGE: label-free identification of endogenous informative single-cell mitochondrial RNA mutation for lineage analysis</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2022</year>
        <volume>119</volume>
        <fpage>e2119767119</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2119767119</pub-id>
        <?supplied-pmid 35086932?>
        <pub-id pub-id-type="pmid">35086932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Miller, T. E. et al. Mitochondrial variant enrichment from high-throughput single-cell RNA sequencing resolves clonal populations. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-022-01210-8. (2022).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beneyto-Calabuig</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Müller-Tidow</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Velten</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Clonally resolved single-cell multi-omics identifies routes of cellular differentiation in acute myeloid leukemia</article-title>
        <source>Cell Stem Cell</source>
        <year>2023</year>
        <volume>30</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2023.04.001</pub-id>
        <?supplied-pmid 37098346?>
        <pub-id pub-id-type="pmid">37098346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Ludwig, L. S. et al. Lineage Tracing in Humans Enabled by Mitochondrial Mutations and Single-Cell Genomics. <italic>Cell</italic> 1–15 10.1016/j.cell.2019.01.022 (2019).</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell mitochondrial DNA genotyping and chromatin profiling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>451</fpage>
        <lpage>461</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0645-6</pub-id>
        <?supplied-pmid 32788668?>
        <pub-id pub-id-type="pmid">32788668</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kwok</surname>
            <given-names>AWC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MQuad enables clonal substructure discovery using single cell mitochondrial variants</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-28845-0</pub-id>
        <pub-id pub-id-type="pmid">34983933</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-00795-2</pub-id>
        <?supplied-pmid 33462507?>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Jindal, K. et al. Single-cell lineage capture across genomic modalities with CellTag-multi reveals fate-specific gene regulatory changes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01931-4 (2023).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNA velocity of single cells</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>560</volume>
        <fpage>494</fpage>
        <lpage>498</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0414-6</pub-id>
        <?supplied-pmid 30089906?>
        <pub-id pub-id-type="pmid">30089906</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Phillips</surname>
            <given-names>NE</given-names>
          </name>
          <name>
            <surname>Mandic</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Omidi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Naef</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Suter</surname>
            <given-names>DM</given-names>
          </name>
        </person-group>
        <article-title>Memory and relatedness of transcriptional activity in mammalian cell lineages</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1208</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-09189-8</pub-id>
        <?supplied-pmid 30872573?>
        <pub-id pub-id-type="pmid">30872573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rückert</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Mashreghi</surname>
            <given-names>M-F</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>LS</given-names>
          </name>
          <name>
            <surname>Romagnani</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Clonal expansion and epigenetic inheritance of long-lasting NK cell memory</article-title>
        <source>Nat. Immunol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>1551</fpage>
        <lpage>1563</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-022-01327-7</pub-id>
        <?supplied-pmid 36289449?>
        <pub-id pub-id-type="pmid">36289449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Ntranos</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Tse</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Determining sequencing depth in a single-cell RNA-seq experiment</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Svensson, V., Da Veiga Beltrame, E. &amp; Pachter, L. Quantifying the tradeoff between sequencing depth and cell number in single-cell RNA-seq. <italic>bioRxiv</italic>10.1101/762773 (2019).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pollen</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Low-coverage single-cell mRNA sequencing reveals cellular heterogeneity and activated signaling pathways in developing cerebral cortex</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2967</pub-id>
        <?supplied-pmid 25086649?>
        <pub-id pub-id-type="pmid">25086649</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>LineageOT is a unified framework for tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Wang, K. et al. PhyloVelo enhances transcriptomic velocity field mapping using monotonically expressed genes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01887-5 (2023).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simeonov</surname>
            <given-names>KP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing of metastatic cancer reveals selection of hybrid EMT states</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1150</fpage>
        <lpage>1162</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.05.005</pub-id>
        <?supplied-pmid 34115987?>
        <pub-id pub-id-type="pmid">34115987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Bues, J. et al. Deterministic scRNA-seq captures variation in intestinal crypt and organoid composition. <italic>Nat. Methods</italic>10.1038/s41592-021-01391-1 (2022).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Janesick</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High resolution mapping of the tumor microenvironment using integrated single-cell, spatial and in situ analysis</article-title>
        <source>Nat. Commun</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>8353</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-43458-x</pub-id>
        <?supplied-pmid 38114474?>
        <pub-id pub-id-type="pmid">38114474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guvakova</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CDH2/N-cadherin and early diagnosis of invasion in patients with ductal carcinoma in situ</article-title>
        <source>Breast Cancer Res. Treat.</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>333</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1007/s10549-020-05797-x</pub-id>
        <?supplied-pmid 32683564?>
        <pub-id pub-id-type="pmid">32683564</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergen</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Lange</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Peidli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Generalizing RNA velocity to transient cell states through dynamical modeling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>1408</fpage>
        <lpage>1414</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0591-3</pub-id>
        <?supplied-pmid 32747759?>
        <pub-id pub-id-type="pmid">32747759</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saelens</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cannoodt</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Todorov</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A comparison of single-cell trajectory inference methods</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0071-9</pub-id>
        <?supplied-pmid 30936559?>
        <pub-id pub-id-type="pmid">30936559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eisele</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Erythropoietin directly remodels the clonal composition of murine hematopoietic multipotent progenitor cells</article-title>
        <source>Elife</source>
        <year>2022</year>
        <volume>11</volume>
        <fpage>e66922</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.66922</pub-id>
        <?supplied-pmid 35166672?>
        <pub-id pub-id-type="pmid">35166672</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nagaoka</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>E-Cadherin-Coated Plates Maintain Pluripotent ES Cells without Colony Formation</article-title>
        <source>PLoS ONE</source>
        <year>2006</year>
        <volume>1</volume>
        <fpage>e15</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0000015</pub-id>
        <?supplied-pmid 17183641?>
        <pub-id pub-id-type="pmid">17183641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Barcode-free prediction of cell lineages from scRNA-seq datasets. GEO, <italic>GSE226169</italic>10.1101/2022.09.20.508646 (2024).</mixed-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets. GEMLI v1.0.0. <italic>Zenodo</italic>, 10.5281/zenodo.10673334 (2024).</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based lineage prediction of cell lineages from scRNA-seq datasets. <italic>Zenodo</italic>10.5281/zenodo.10581737 (2024).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10980719</article-id>
    <article-id pub-id-type="pmid">38553478</article-id>
    <article-id pub-id-type="publisher-id">47158</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-024-47158-y</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8376-4089</contrib-id>
        <name>
          <surname>Eisele</surname>
          <given-names>A. S.</given-names>
        </name>
        <address>
          <email>almut.eisele@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0556-2531</contrib-id>
        <name>
          <surname>Tarbier</surname>
          <given-names>M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dormann</surname>
          <given-names>A. A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9415-788X</contrib-id>
        <name>
          <surname>Pelechano</surname>
          <given-names>V.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5644-4899</contrib-id>
        <name>
          <surname>Suter</surname>
          <given-names>D. M.</given-names>
        </name>
        <address>
          <email>david.suter@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/02s376052</institution-id><institution-id institution-id-type="GRID">grid.5333.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2183 9049</institution-id><institution>Ecole Polytechnique Fédérale de Lausanne, School of Life Sciences, </institution><institution>Institute of Bioengineering, </institution></institution-wrap>Lausanne, Switzerland </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.465198.7</institution-id><institution>Science for Life Laboratory, Department of Microbiology, Tumor and Cell Biology, </institution><institution>Karolinska Institute, </institution></institution-wrap>Solna, Sweden </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>2744</elocation-id>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024, corrected publication 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Assigning single cell transcriptomes to cellular lineage trees by lineage tracing has transformed our understanding of differentiation during development, regeneration, and disease. However, lineage tracing is technically demanding, often restricted in time-resolution, and most scRNA-seq datasets are devoid of lineage information. Here we introduce <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference (GEMLI), a computational tool allowing to robustly identify small to medium-sized cell lineages solely from scRNA-seq datasets. GEMLI allows to study heritable gene expression, to discriminate symmetric and asymmetric cell fate decisions and to reconstruct individual multicellular structures from pooled scRNA-seq datasets. In human breast cancer biopsies, GEMLI reveals previously unknown gene expression changes at the onset of cancer invasiveness. The universal applicability of GEMLI allows studying the role of small cell lineages in a wide range of physiological and pathological contexts, notably in vivo. GEMLI is available as an R package on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>).</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Combining experimental lineage tracing with single cell transcriptomics is technically demanding. Here, authors present GEMLI, a computational tool to annotate cell lineages in single cell RNA sequencing data solely based on gene expression.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Epigenetic memory</kwd>
      <kwd>Gene expression profiling</kwd>
      <kwd>Computational models</kwd>
      <kwd>Gene ontology</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100001711</institution-id>
            <institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung (Swiss National Science Foundation)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>CRSK-3_195097</award-id>
        <principal-award-recipient>
          <name>
            <surname>Suter</surname>
            <given-names>D. M.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">In multicellular organisms, each cell belongs to a lineage tree that determines its relatedness to other cells. Cell lineage relationships are of fundamental biological relevance as they directly impact a broad range of cellular behaviors, such as cancer resistance to drugs<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR7">7</xref></sup>, disease onset<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and differentiation in development, homeostasis, and regeneration<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR15">15</xref></sup>. Dissecting early gene expression changes that occur during cell fate switches is essential to understand the mechanistic bases of these processes. This requires to focus on small cell lineages in which cell fate decisions occur. While cellular characterization by scRNA-seq provides rich molecular information, it is intrinsically devoid of lineage information. Therefore, there is considerable interest in identifying cell lineages in scRNA-seq datasets.</p>
    <p id="Par4">The most widely used technique to assign individual transcriptomes to given lineages is cellular barcoding, which involves the introduction of heritable, expressed DNA barcodes in individual cells that can be retrieved in scRNA-seq data<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR19">19</xref></sup>. Other approaches involve hand-picking of related cells visualized by microscopy or microfluidic devices to compartmentalize cell lineages before scRNA-seq<sup><xref ref-type="bibr" rid="CR20">20</xref>–<xref ref-type="bibr" rid="CR25">25</xref></sup>. However, all these techniques suffer from important technical limitations such as the requirement for dedicated devices, extensive cell handling and/or culture, or genetic engineering.</p>
    <p id="Par5">Natural genetic marks such as mitochondrial mutations, copy number variants, and somatic mutations have been used to identify related cells in scRNA-seq datasets, mainly after enrichment for desired transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Still, the scarcity of spontaneously occurring genetic marks restricts their application to a fraction of cells that harbor these marks and to the identification of large cell lineages. These approaches are therefore not suited to analyze small and mid-sized lineages and poorly resolve branching points during divergent cell fate decisions. In particular, identifying close lineage relationships to study cell fate decisions in vivo and in human samples remains challenging.</p>
    <p id="Par6">Here, we quantitatively dissect the maintenance of gene expression in cell lineages for a broad range of cell types. We leverage genes with particularly stable expression over time to develop Gene Expression Memory-based Lineage Inference or GEMLI, a computational tool that allows identifying cell lineages related to several cell divisions based solely on scRNA-seq data.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Cells belonging to the same lineage tree are similar in their gene expression profiles</title>
      <p id="Par7">We analyzed the transcriptome-wide stability of gene expression over around 1-5 cell divisions using lineage-annotated scRNA-seq datasets of mouse embryonic stem cells (mESCs; Fig. <xref rid="MOESM1" ref-type="media">S1a–c</xref>), primary mouse embryonic fibroblasts (MEF)<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, primary mouse CD8+T-lymphocytes (CD8)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, lymphocytic leukemia cells (L1210)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, primary mouse hematopoietic stem and progenitor cells (HSPC; differentiating into &gt;10 mature cell types)<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, mouse hematopoietic stem cells (HSC) <sup>23</sup>, and human melanoma cells (WM989)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, grown for 2–14 days in various culture conditions (Supplementary Data File <xref rid="MOESM4" ref-type="media">1</xref> and Fig. <xref rid="MOESM1" ref-type="media">S1d, e</xref> for culture times, conditions and dataset sizes, over 120 datasets in total). Two datasets contained specifically sister cells, in all other datasets 2-cell lineages corresponded to random samples from larger lineages (Fig. <xref rid="MOESM1" ref-type="media">S1f–g</xref>). For all cell types analyzed, we observed a higher correlation (lower correlation distance) of the whole transcriptome for related cells as compared to randomly sampled cells (Fig. <xref rid="Fig1" ref-type="fig">1a, b</xref>). Related cells were also more similar in their transcriptomic velocity<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, complexity (number of expressed genes), and cell cycle phase (Fig. <xref rid="MOESM1" ref-type="media">S2a–g</xref>). Importantly, for differentiating HSPC, both lineages composed of a single cell type (symmetric) and lineages made of several cell types (asymmetric) were more similar in their transcriptome than random cells (Fig. <xref rid="Fig1" ref-type="fig">1c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S2h</xref>). To further determine the time spans of transcriptomic similarity persistence, we analyzed lineage-annotated data of MEF cultured for up to 30 days. Gene expression correlation of related cells remained high for extended timespans (&gt;20 days) (Fig. <xref rid="MOESM1" ref-type="media">S2i</xref>), in line with recent reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. In summary, both self-renewing and differentiating cells exhibit substantial gene expression memory over several cell generations.<fig id="Fig1"><label>Fig. 1</label><caption><title>Memory genes drive the transcriptomic similarity of related cells across cell types.</title><p><bold>a</bold> UMAP of the lineage-annotated mESC scRNA-seq dataset with 25 random colored lineages. <bold>b</bold> Boxplot of the correlation distance for related cells (blue), and randomly sampled cells (gray; 100 repetitions) in different cell types (<italic>n</italic> = 1 dataset for each cell type). <bold>c</bold> Boxplot as in <bold>b</bold> for lineages encompassing one single cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric, asym.) for one HSPC dataset. <bold>d</bold> Illustration of the temporal pattern of expression levels and variability of quantitative memory genes, qualitative memory genes, and non-memory genes across cell generations and lineages, respectively. <bold>e</bold> Percentage of expressed genes (gray) that are categorized as quantitative (green) and qualitative (blue) memory genes across cell types (<italic>n</italic> = 1 dataset for each). <bold>f</bold> Relation of CV<sup>2</sup> and mean gene expression in the mESC dataset. The different memory gene categories are colored as in <bold>e</bold>. <bold>g</bold> Mean gene expression for different memory gene categories and all genes across cell types as in (<bold>b</bold>; <italic>n</italic> = 7 datasets, qual=qualitative, quant=quantitative). <bold>h</bold> Same representation as in <bold>g</bold> for CV<sup>2</sup> of gene expression. <bold>i</bold> Memory genes as a percentage of expressed genes for lineages being composed of one cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric; asym) at day 4 of HSPC differentiation (<italic>n</italic> = 22 datasets). <bold>j</bold> The overlap between memory genes of day 2 and day 5–30 over the course of MEF reprogramming. Overlap is the percentage of the memory gene number at day 5–30, respectively (<italic>n</italic> = 2 dataset for each timepoint). Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig1_HTML" id="d33e449"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Gene expression memory increases gene expression variability in large cell populations</title>
      <p id="Par8">We next asked to which extent transcriptome similarity of small cell lineages impacts gene expression variability in the whole cell population. To do so, we fitted a linear model to compute the total variation for each gene from the variation across pooled lineages. We then used this model to estimate the total variation in a control dataset with permuted lineage labels, and compared the total variation of the real and the control datasets. We found that transcriptomic similarity of cell lineages had a substantial impact on gene expression variability in all cell types, in particular for highly expressed genes (Fig. <xref rid="MOESM1" ref-type="media">S3a</xref>), with the median standard deviation being on average 4.2% higher (+/– S.D. 3.3) overall transcripts and 19.1% higher (+/– S.D. 15) for highly abundant genes (Fig. <xref rid="MOESM1" ref-type="media">S3b</xref>). Therefore, while gene expression memory limits gene expression variability within small cell lineages, it is an important source of gene expression variability in large cell populations.</p>
    </sec>
    <sec id="Sec5">
      <title>Thousands of memory genes display stable gene expression levels through cell division</title>
      <p id="Par9">The transcriptomic correlation of closely related cells was driven by ca 20% of expressed genes (on average 3668 +/– S.D. 1131) with particularly stable gene expression levels across cell divisions, which we called memory genes (Fig. <xref rid="Fig1" ref-type="fig">1d, e</xref>). We defined memory genes as genes having a significantly higher (<italic>p</italic> &lt; =0.05) variability (coefficient of variation squared (CV<sup>2</sup>)) in their mean expression across cell lineages compared to random cell samples. Memory genes were only partly overlapping but shared characteristic expression distributions across datasets. Some memory genes were widely and highly expressed but showed very conserved expression levels within individual cell lineages (2286 +/– S.D. 890). Other memory genes were highly variable, and only expressed in a small number of cell lineages (1382 +/– S.D. 413). We named these quantitative and qualitative memory genes, respectively (Fig. <xref rid="Fig1" ref-type="fig">1f–h</xref>; Figs. <xref rid="MOESM1" ref-type="media">S4</xref> and <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM5" ref-type="media">2</xref>). Memory genes, and in particular quantitative memory genes, were enriched for housekeeping functions (Fig. <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM6" ref-type="media">3</xref>). Memory genes were also present for lineages encompassing several cell types (Fig. <xref rid="Fig1" ref-type="fig">1i</xref>), highly shared across cell types within a culture condition (Fig. <xref rid="MOESM1" ref-type="media">S4f–g</xref>), and present over longer culture time spans (&gt;20 days; Fig. <xref rid="Fig1" ref-type="fig">1j</xref> and Fig. <xref rid="MOESM1" ref-type="media">S4h</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>GEMLI uses shared memory gene characteristics for de novo lineage predictions from scRNA-seq datasets</title>
      <p id="Par10">Based on the characteristic expression distributions of memory genes across cell types, we developed GEMLI (for <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference) to predict cell lineages related over several cell divisions de novo in scRNA-seq datasets (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). First, genes with a high expression mean and high variability (mean-corrected CV<sup>2</sup>) are selected. This highly enriches memory genes (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, for comparison to genes used in standard scRNA-seq analysis and optimization of gene selection see Figs. <xref rid="MOESM1" ref-type="media">S6 and 7</xref>; and Methods). Next, a custom repetitive, iterative hierarchical clustering allows estimating whether cells belong to the same lineage (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>; see Table <xref rid="MOESM1" ref-type="media">S1</xref> for the main conceptual differences between GEMLI and other clustering algorithms). Briefly, cells are clustered iteratively on random subsets of the selected genes until being assigned to a cluster of predefined size (lineage size parameter; default 2–3 cells). By repeating this clustering, every cell pair is assigned a level of confidence for belonging to the same lineage, based on the number of times it clusters together across individual predictions. Finally, a confidence level threshold is set to define multi-cellular lineages (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Importantly, lineages are not technically restricted in size and can be larger than the cluster size of 2–3 cells. When applying this approach to different datasets, the precision and sensitivity of small cell lineage predictions reached on average 80% +/– S.D. 15%, and 22% +/– S.D. 12%, respectively, at a confidence level of 50. The false positive rate (FPR) of predictions stayed consistently under 1% with an average of 0.07% +/– S.D. 0.08% at a confidence level of 50 (Fig. <xref rid="Fig2" ref-type="fig">2c–e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). GEMLI performed consistently better than other gene selection and lineage assignment strategies, including a k-nearest neighbor (kNN) clustering and the training of a neural network (Fig. <xref rid="MOESM1" ref-type="media">S7c, g</xref> and Fig. <xref rid="MOESM1" ref-type="media">S9</xref>). Crucially, as GEMLI allows to predict cell lineages for cells in which cellular barcoding fails, the number of lineage-annotated cells was either comparable or substantially increased as compared to barcode-based approaches (Fig. <xref rid="Fig2" ref-type="fig">2f</xref>). Changing prediction parameters, such as the fraction of genes sampled for each clustering (Fig. <xref rid="MOESM1" ref-type="media">S10</xref>), can further optimize precision at the expense of sensitivity or vice versa, depending on which measure is deemed more important for the downstream analysis. GEMLI allows the identification of both symmetric and asymmetric lineages, i.e., lineages in which cells belong to one or different cell types (Fig. <xref rid="Fig2" ref-type="fig">2g, h</xref> and Fig. <xref rid="MOESM1" ref-type="media">S11</xref>) and lineages of different sizes (Figs. <xref rid="MOESM1" ref-type="media">S12</xref> and <xref rid="MOESM1" ref-type="media">S13</xref>). Furthermore, lineage predictions were also possible over extended time spans at high precision but with a decreasing recovery, in line with a gradual decline of gene expression memory over time (Figs. <xref rid="MOESM1" ref-type="media">S14</xref> and <xref rid="MOESM1" ref-type="media">S4h</xref>; and Fig. <xref rid="Fig1" ref-type="fig">1j</xref>). GEMLI performed well for datasets within the recommended size and sequencing depth ranges. Notably, GEMLI performed well in datasets with a sequencing depth &gt;5000 reads/cell (all but the HSPC datasets; Fig. <xref rid="MOESM1" ref-type="media">S15</xref>)<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup>. Altogether, GEMLI allows for accurate prediction of cell lineages related over several cell divisions solely from scRNA-seq datasets.<fig id="Fig2"><label>Fig. 2</label><caption><title>GEMLI predicts cell lineages from gene expression within and across cell types.</title><p><bold>a</bold> Schematic of the GEMLI lineage prediction pipeline. <bold>b</bold> Fraction of memory genes selected based on variability and mean expression in the indicated cell types (<italic>n</italic> = 1 dataset for each). <bold>c</bold> Precision-sensitivity curves of lineage predictions in different cell types as in <bold>b</bold>. <bold>d</bold> Precision, sensitivity (left) and FPR (right) of lineage predictions at confidence level 50 for datasets as in (<bold>b</bold>; <italic>n</italic> = 7 datasets). <bold>e</bold> Correct and false (line color) predicted lineages with respect to the barcode lineages (fill color) at different confidence levels in the mESC dataset. A random subset of the lineage predictions is shown. <bold>f</bold> Pie chart of datasets colored according to the presence of barcode- (left) and GEMLI- (right) lineage annotation at a confidence level of 50 (<italic>n</italic> = 1 for each cell type). The number of recovered lineages is indicated. <bold>g</bold> Precision-sensitivity curve for predictions of lineages composed of one cell type (symmetric) or two cell types (asymmetric) in the HSPC (<italic>n</italic> = 44) and WM989 datasets (<italic>n</italic> = 8). Mean is represented. <bold>h</bold> Precision (left), sensitivity (middle), and FPR (right) of lineage predictions at confidence level 50 for symmetric (sym.) and asymmetric (asym.) lineages in the HSPC and WM989 datasets as in <bold>g</bold>. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig2_HTML" id="d33e653"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>GEMLI identifies memory gene categories, cell fate decisions, and associated gene expression programs</title>
      <p id="Par11">We then asked how reliably GEMLI identifies categories of genes displaying gene expression memory in small lineages. To do so, we compared memory genes and associated GO-terms from GEMLI predictions and ground truth lineage annotation and found them to be highly correlated for all datasets (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>; Fig. <xref rid="MOESM1" ref-type="media">S16a–c</xref> and Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>). Next, we tested the ability of GEMLI to identify symmetric vs. asymmetric cell fate decisions. In both WM989 melanoma cell and HSPC datasets (total of 52 datasets, low sequencing depth for HSPCs), the fraction of related cells among different symmetric and asymmetric cell pairs correlated well for GEMLI and barcode lineages (Fig. <xref rid="Fig3" ref-type="fig">3b, c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S16d–j</xref>). The prevalence of related cells among drug-susceptible and -resistant melanoma cells, as well as 10 possible hematopoietic cell types could be distinguished. Also, differentially expressed genes (DEG) between asymmetric and symmetric cell type pairs were recovered well by analyzing GEMLI lineages (Fig. <xref rid="Fig3" ref-type="fig">3d, e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S17</xref>). In the HSPC data, DEG called between undifferentiated cells in symmetric undifferentiated and asymmetric undifferentiated-neutrophil cell pairs in the ground truth and predictions correlated highly (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>). In the WM989 cells, DEG analysis of GEMLI lineages identified genes specifically expressed in drug-susceptible cells being part of lineages with drug-susceptible and drug-resistant members, i.e., lineages in which cells recently switched to a resistant phenotype (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). While kNN performed similarly to GEMLI in identifying the prevalence of cell pairs, it performed less so for the recovery of correct DEGs (Figs. <xref rid="MOESM1" ref-type="media">S16i, j</xref> and  <xref rid="MOESM1" ref-type="media">S17a–d</xref>). For both analyses, GEMLI performed much better than random cell pair selections (Figs. <xref rid="MOESM1" ref-type="media">S16g, h</xref> and <xref rid="MOESM1" ref-type="media">S17a–f</xref>). In line with recent reports<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, a trajectory analysis did not recover asymmetric lineage-associated DEG (Fig. <xref rid="MOESM1" ref-type="media">S17g–j</xref>). This highlights the utility of GEMLI for downstream analyses that are commonly restricted to barcoded datasets, even in the case of datasets with a low sequencing depth.<fig id="Fig3"><label>Fig. 3</label><caption><title>GEMLI lineage predictions allow retrieving memory GO-terms and quantifying diverging cell-fate decisions.</title><p><bold>a</bold> Top 10 enriched GO-terms in memory genes called on barcode or predicted lineages (pred.) at confidence level 30 in different cell types (<italic>n</italic> = 1 dataset each). All terms that are among the top 10 in any cell type are shown. Spearman rank correlation is indicated. Proc.=process. <bold>b</bold> SPRING graph of HSPC datasets (<italic>n</italic> = 44) annotated by cell types (top), highlighting ground truth undifferentiated symmetric (beige) and undifferentiated-neutrophil asymmetric (pink) lineages (middle), or highlighting undifferentiated-neutrophil asymmetric lineage predictions at confidence level 70 (bottom). <bold>c</bold> The number (sum) of cell pairs in the barcode (top right) and predicted (bottom left) cell lineages in all cell type combinations in the HSPC datasets as in <bold>b</bold>. <bold>d</bold> Average log2 fold-change for DEG called between barcode and predicted undifferentiated cells in symmetric and asymmetric cell lineages in one day 4 HSPC dataset. Dots represent DEGs. Spearman rank correlation is given. The 20 highest and 10 lowest enriched genes are named. Gray: undifferentiated, blue: neutrophil. <bold>e</bold> Average log2 fold-change for DEG called between barcode and predicted drug-susceptible cells in symmetric and asymmetric cell lineages across WM989 datasets (<italic>n</italic> = 8). Green: drug-resistant, blue: drug-susceptible. A confidence level of predictions in <bold>c</bold>–<bold>e</bold> is 50. For the full spelling of abbreviated cell type names mentioned in panels <bold>b</bold>, <bold>c</bold>, see Methods. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig3_HTML" id="d33e766"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>GEMLI predicts lineages in lung metastases of pancreatic cancer</title>
      <p id="Par12">Next, we tested whether GEMLI could identify small and mid-sized lineages in vivo. We used data from mouse pancreatic cancer lung metastases, which have been traced through evolvable CRISPR barcoding over a short timespan<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. As barcodes here had only four weeks to evolve, CRISPR editing frequency of barcodes is high and the lung metastases develop late, this ground-truth data is suitable for comparison with GEMLI predictions. At a confidence level of 80, GEMLI reached 100% precision while assigning more cells to lineages than the barcoding data (Fig. <xref rid="Fig4" ref-type="fig">4a–c</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>GEMLI correctly assigns cells to individual metastases, crypts, and mitochondrial variant-defined lineages in vivo.</title><p><bold>a</bold> Scheme of GEMLI lung metastasis predictions. <bold>b</bold> Precision (line) and sensitivity (dotted line) as a function of confidence level for GEMLI predictions in lung metastases of two mice tested against the CRISPR barcode lineage information. Line: mean; Shade: S.D. <bold>c</bold> Pie chart of the lung metastases data of two mice (M1, M2) as in <bold>b</bold> colored according to the presence of CRISPR barcode- (left) and GEMLI- lineage annotation at a confidence level of 50 (middle) and 80 (right). The number of recovered lineages is indicated. Conf=confidence level. <bold>d</bold> Schematic of GEMLI crypt predictions. <bold>e</bold> Percentage of cells predicted as individual lineages for each crypt in the crypt dataset (<italic>n</italic> = 1) at confidence level 70. <bold>f</bold> Predictions of crypts at confidence level 70. <bold>g</bold> Precision-sensitivity curve for predictions in the crypt dataset. <bold>h</bold> Precision-sensitivity curve for predictions of cell pairs composed of one cell type (symmetric) or two cell types (asymmetric) in the crypt dataset. <bold>i</bold> The percentage of cells (size) belonging to the indicated cell type (color) for individual crypts (top) and for predicted lineages at confidence level 50 (bottom) aligned to their crypt of origin. <bold>j</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages (<italic>n</italic> = 3 datasets). Line: mean; Shade: S.D. <bold>k</bold> Precision-sensitivity curves of lineage predictions in K562 cells (<italic>n</italic> = 1 dataset) as in <bold>j</bold>. <bold>l</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages as in <bold>j</bold> with lineage size parameters up to the maximal ground truth lineage size. Line: mean; Shades: S.D. All crypt predictions are of 5-40 cells and were run with a lineage size parameter of 2–40. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig4_HTML" id="d33e841"/></fig></p>
    </sec>
    <sec id="Sec9">
      <title>GEMLI assigns cells to individual in vivo-derived crypts and organoids</title>
      <p id="Par13">Further, we tested GEMLIs ability to reconstruct in vivo and in vitro-derived multicellular structures that originate from a single or few stem cells using scRNA-seq data of intestinal organoids and crypts, for which the individual structure of origin (crypt or organoid) is known for each cell (ref. <sup><xref ref-type="bibr" rid="CR43">43</xref></sup>, Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). We ran GEMLI on the pooled scRNA-seq datasets and analyzed whether inferred lineages fall within individual crypts and organoids. GEMLI resulted in high percentages of cells correctly assigned to their crypt or organoid of origin with default lineage size parameters and parameters in the ground truth lineage size range, allowing the recovery of mid-sized lineages (Fig. <xref rid="Fig4" ref-type="fig">4d–g</xref>; Figs. <xref rid="MOESM1" ref-type="media">S12a, d</xref> and <xref rid="MOESM1" ref-type="media">S18</xref> for organoids). As ground truth lineage sizes might be unknown when applying GEMLI, we tested the stability of predictions for different lineage size parameters. Taking the maximal ground truth lineage size as the upper lineage size parameter value coincided with a maximal cluster stability of predictions, allowing us to estimate the size distribution of crypts and organoids de novo (Fig. <xref rid="MOESM1" ref-type="media">S19</xref>). GEMLI predictions allowed highly reliable inference of the cell type composition of individual structures by identifying both symmetric and asymmetric cell pairs (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref> and Fig. <xref rid="MOESM1" ref-type="media">S20</xref>). This demonstrates that GEMLI can recover the cellular composition of individuals in vivo and in vitro segregated mid-sized multicellular structures from pooled datasets.</p>
    </sec>
    <sec id="Sec10">
      <title>GEMLI can be combined with other lineage-tracing approaches</title>
      <p id="Par14">We next combined GEMLI with lineage inference based on mitochondrial variants to study lineages at broader time scales. Mitochondrial variants allow identifying cell lineages in 3’ scRNA-seq datasets after enrichment of mitochondrial transcripts<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. The scarce occurrence of mitochondrial mutations however restricts this approach to the assignment of cells to large lineages, i.e., cells related over long time spans (weeks to months). We tested if GEMLI could refine lineage trees inferred from mitochondrial variants on datasets of primary human bone marrow cells and K562 myelogenous leukemia cells<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. Importantly, in these experiments only a small sample from a large population was sequenced, resulting in the loss of a large fraction of cells from small lineages and thus inherently limiting their identification. Nevertheless, GEMLI recovered small cell lineages in all datasets and these fell with high precision within the large mitochondrial-variant inferred lineages (Fig. <xref rid="Fig4" ref-type="fig">4j, k</xref>). The precision stayed also high for predictions up to the maximal size of the mitochondrial-variant inferred lineages, confirming GEMLIs utility in refining lineage trees obtained with other techniques (Fig. <xref rid="Fig4" ref-type="fig">4l</xref>).</p>
    </sec>
    <sec id="Sec11">
      <title>GEMLI characterizes gene expression memory in human breast cancer</title>
      <p id="Par15">Next, we applied GEMLI to a primary human breast cancer tissue sample dataset<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, in which other lineage tracing approaches (such as cellular barcoding) cannot be applied or would only call large lineages (mitochondrial-variant-based lineage inference). The dataset was generated from formalin-fixed, paraffin-embedded breast cancer tissue and encompasses scRNA-seq (31,364 expressed genes) and Xenium in situ sequencing data (313 genes) of serial sections<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. We assigned 10 cell types identified in the Xenium data to the scRNA-seq data using supervised machine learning (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>), and applied GEMLI to ductal carcinoma in situ (DCIS) and invasive tumor cells separately (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>). Prediction stability for DCIS cells suggested lineage sizes up to 50 cells, in line with their nodule character and size in the spatial data, and resembled the multicellular crypt or organoid profiles (Fig. <xref rid="Fig5" ref-type="fig">5a</xref> and Fig. <xref rid="MOESM1" ref-type="media">S21</xref>, size considering 2,3% recovery of DCIS cells in scRNA-seq). In contrast, cluster stability of predicted invasive tumor cell lineages was more similar to cultured cells without a clear spatial organization (Fig. <xref rid="MOESM1" ref-type="media">S21a</xref>). Memory genes called on predicted DCIS and invasive tumor cell lineages (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>) were characterized by distinct GO terms, such as response to estrogen or cell-substrate adhesion, respectively (Fig. <xref rid="MOESM1" ref-type="media">S22a</xref>). Memory genes for which Xenium in situ data was available showed visible patches of similar gene expression, in line with lineage-specific expression (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Crucially, the spatial distribution of highly variable, non-memory genes was characterized by a “salt and pepper” aspect (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>), in line with both gene groups only partly overlapping (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>GEMLI predictions identify lineages in breast cancer nodules.</title><p><bold>a</bold> Breast cancer Xenium in situ sequencing map colored by cell type. <bold>b</bold> A random subset of predicted lineages within the DCIS cells of the breast cancer scRNA-seq dataset at confidence level 50. <bold>c</bold> Percentage of expressed genes categorized as quantitative (quant.) and qualitative (qual.) memory genes in the breast cancer scRNA-seq dataset as in <bold>b</bold>. <bold>d</bold> In situ map of breast cancer Xenium data for ESR1 and SCD expression which are memory genes in DCIS and invasive tumor lineages respectively. <bold>e</bold> Maps as in <bold>d</bold> for two variable genes. <bold>f</bold> Overlap of memory and variable genes in the breast cancer scRNA-seq dataset. All predictions in b-e are with lineage size parameters of 2–20 cells. The invasive tumor is abbreviated as the inv tumor in all panels. In <bold>a</bold> T-cell dendr. = T-cell dendritic cell and Myoepithel. = Myoepithelial cell. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig5_HTML" id="d33e969"/></fig></p>
    </sec>
    <sec id="Sec12">
      <title>GEMLI allows identifying early stages of progression to invasive cancer in vivo</title>
      <p id="Par16">Finally, we applied GEMLI to predict lineages on the whole breast cancer scRNA-seq dataset to study progression towards invasiveness. While most GEMLI lineages were confined within one cell type or shared with apoptotic cells, GEMLI also predicted lineages with both DCIS and invasive tumor cell members (Fig. <xref rid="Fig6" ref-type="fig">6a, b</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22b, c</xref>, around 10% of cancer cell lineages). We hypothesized that these asymmetric lineages contained cells that recently switched to an invasive phenotype. We analyzed genes characterizing these lineages by calling DEG on DCIS cells within asymmetric and symmetric lineages, as well as DEG between lineage types of later stages in cancer progression (Fig. <xref rid="Fig6" ref-type="fig">6c, d</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22d</xref>). Genes enriched in DCIS cells from asymmetric lineages included known markers of cancer invasiveness such as <italic>CDH2</italic><sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, but also genes with unknown roles in cancer progression, such as <italic>DCAF7</italic> and <italic>LINC01999</italic> (Fig. <xref rid="Fig6" ref-type="fig">6d</xref>). While, e.g., <italic>DCAF7</italic> and <italic>CDH2</italic> displayed continuous changes across lineage types occurring during cancer progression, others such as <italic>TCIM</italic> or <italic>BRIP1</italic> were expressed transiently at higher levels in asymmetric or only in symmetric (i.e., only invasive tumor cell) lineages, respectively (Fig. <xref rid="Fig6" ref-type="fig">6e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22e</xref>). This demonstrates the unique ability of GEMLI in dissecting lineage identities and gene expression changes in specific lineage types occurring during the progression of human tumors towards invasiveness.<fig id="Fig6"><label>Fig. 6</label><caption><title>GEMLI identifies breast cancer cells in lineages switching to an invasive phenotype.</title><p><bold>a</bold> A subset of predicted lineages with respect to cell type annotation at confidence level 50 in the breast cancer scRNA-seq dataset. Gray and red lines indicate lineage relationships within one or across several cell types, respectively. <bold>b</bold> Number of DCIS and invasive tumor lineages with members belonging to other cell types for lineage predictions as in <bold>a</bold>. <bold>c</bold> Scheme of lineage cell type identities occurring during breast cancer progression towards invasiveness (green: DCIS, blue: invasive tumor). <bold>d</bold> Volcano plots for DEG called between DCIS and invasive tumor cells predicted to be part of symmetric and asymmetric (asym.) cell lineages in the breast cancer scRNA-seq dataset as indicated. The top 9 highest and lowest enriched genes are named. Predictions at confidence level 50. The <italic>p</italic>-value indicated was generated by Seurats FindMarker function based on a Wilcoxon Rank Sum Test. <bold>e</bold> Expression of selected DEG as in <bold>d</bold> across DCIS and invasive tumor cells part of symmetric and asymmetric (asym.) lineages as indicated. All predictions are with lineage size parameters of 2–20 cells. Invasive tumor is abbreviated as ‘inv tumor’ or ‘inv tu’ in all panels. Arb. units = arbitrary units. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig6_HTML" id="d33e1053"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec13" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par17">GEMLI allows predicting small to medium-sized cell lineages related over several generations solely from scRNA-seq datasets, based on genes that maintain their expression level through cell divisions. This is a shift away from experimental lineage tracing techniques based on genetic marks or physical cell lineage separation and extends lineage annotations of small and medium-sized lineages to in vivo settings.</p>
    <p id="Par18">GEMLI is applicable to any scRNA-seq dataset and requires only exonic reads. This alleviates the need for experimental lineage assignment procedures implemented prior to sequencing and thereby expands lineage annotation to contexts where cellular barcoding or other lineage assignment approaches are challenging or prohibitive, such as primary cells or human biopsies. It also avoids cellular stress caused by cell picking or genetic engineering required for manual and cellular-barcoding-based lineage tracing, respectively. GEMLI is particularly promising for its ability to identify small lineages in which cells are related over about 1-5 cell divisions. However, GEMLI will generally perform less robustly in cell populations that contain only distantly related cells. Some systems might allow for a longer gene-expression memory-based lineage tracing<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. While GEMLI performed well on intestinal organoids that are highly variable in size, we cannot exclude that large variability in growth rates between lineages may decrease its performance.</p>
    <p id="Par19">We show that in line with individual reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>, gene expression memory is present in various cell types and populations in both self-renewal and differentiation conditions. GEMLI is therefore applicable to all cells of a scRNA-seq dataset, in contrast to cellular barcoding-based approaches which are limited to cells that (i) express the barcode and (ii) for which the barcode is recovered. GEMLI thus allows to recovery of a comparable or higher number of lineages than in public cellular barcoding scRNA-seq datasets. GEMLI also compares favorably to cell-picking approaches, which are difficult to scale up and therefore mostly encompass small cell numbers<sup><xref ref-type="bibr" rid="CR21">21</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR25">25</xref></sup>.</p>
    <p id="Par20">Lineage inference approaches based on naturally occurring genetic marks can identify lineages over time spans of weeks or months but require high coverage and sequencing depths or the enrichment of specific transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Trajectory inference algorithms can predict gene expression changes on the order of hours but do not predict lineages<sup><xref ref-type="bibr" rid="CR34">34</xref>,<xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. GEMLI thus fills a methodological gap and shall become a powerful tool to refine lineage trees in combination with other lineage tracing approaches.</p>
    <p id="Par21">With its resolution at the scale of several cell divisions, GEMLI is ideally suited to assess cell fate decisions during differentiation, response to stimulus, homeostasis, and regeneration, and allows correctly assigning a broad diversity of cell types to individual complex structures such as intestinal crypts and organoids. In these cases, the physical proximity of lineage-related cells allows the sharing of a similar microenvironment, which may further increase GEMLIs performance. GEMLI is therefore promising to reconstruct other structures emerging from a common ancestor or a small pool of stem cells, such as glands or spatially restricted areas of the skin. In the context of human breast cancer, we illustrate GEMLIs applications by identifying DCIS nodules, as well as determining previously unknown gene expression changes in lineages encompassing cells at the transition towards an invasive phenotype. Altogether, GEMLI opens new perspectives in interrogating the impact of close lineage relationships in a broad range of biological contexts in vivo.</p>
  </sec>
  <sec id="Sec14">
    <title>Methods</title>
    <sec id="Sec15">
      <title>Cell culture</title>
      <p id="Par22">CGR8 ES cells (Sigma, Cat307032901-1VL) were routinely cultured at 37 °C and 5% CO<sub>2</sub> on 10 cm dishes coated with 0.1% gelatin type B (Sigma, Cat#G9391-100G) in 10 ml GMEM (Sigma, Cat#G5154‐500 ML) supplemented with 10% ES cell‐qualified fetal bovine serum (Gibco, Cat#16141‐079), 1% nonessential amino acids (Gibco, Cat#11140‐050), 2 mM l‐glutamine (Gibco, Cat#25030‐024) and sodium pyruvate (Sigma, Cat#S8636‐100 ML), 100 μM 2‐mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), 1% penicillin and streptomycin (Pen/Strep) (BioConcept, Cat#4‐01F00‐H), homemade leukemia inhibitory factor (LIF), CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat#PZ0181‐25MG) at 0.8 μM. Cells were passaged by trypsinization (2 ml of trypsin, Sigma, Cat#T4049‐100 ML) every 2–3 days at a ratio of 1:10. For scRNA-seq experiments, cells were switched to N2B27 + 2i/LIF medium 2 passages beforehand. N2B27 + 2i/LIF medium was composed of a 1:1 mix of DMEM/F12 (Gibco, Cat#11320‐033) and Neurobasal medium (Gibco, Cat#21103‐049), supplemented with N2 (Gibco, Cat#17502‐001), B27 (Gibco, Cat#17504‐001), 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H), 2 mM L-glutamine (Gibco, Cat#25030‐024), 100 μM 2-mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), LIF, CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat# PZ0181‐25MG) at 0.8 μM. Cells were split every 2–3 days at a ratio of 1:10, using 2 ml of accutase (Innovative Cell Technologies, Cat#31195) and centrifugation. HEK293T cells were routinely cultured at 37 °C and 5% CO<sub>2</sub> on dishes in DMEM high glucose medium (Gibco, Cat#41966) supplemented with 10% Fetal bovine serum (Life Technologies, Cat#10270-106) and 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H).</p>
    </sec>
    <sec id="Sec16">
      <title>Lentiviral barcoding library production</title>
      <p id="Par23">The LARRY lentiviral barcoding library<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was purchased from Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>). The barcodes of the library are composed of 40 base pairs (bp) with 28 random bp separated by 6 fixed bp doublets and are located in the 3’ untranslated region of <italic>EGFP</italic> expressed from the <italic>EF-1ɑ</italic> promoter. The library was amplified and the lentiviral vector was produced according to the associated protocol with small modifications. Briefly, plasmids were introduced into ElectroMAX Stbl4 Competent Cells (Life technologies, Cat#11635018) using MicroPulser Electroporator (Bio-Rad, Cat#1652100) EcoRI program. Cells were incubated for 1 h at 37 °C and spread over 20 large (24.5 × 14.5 cm) Agar+Ampicillin plates (Ampicillin at 100 ug/ml, AppliChem, Cat# A08390025). After 24 h, colonies were harvested through scraping using pre-warmed LB medium supplemented with 100 ug/ml Ampicillin. The resulting 1.5 L bacterial culture was incubated at 37 °C for 2 h and a Maxiprep was performed using a Qiagen MaxiPlus kit (Qiagen, Cat#12963) to a resulting 1 mg of plasmid DNA. A lentiviral vector was produced by transforming the produced LARRY plasmid into HEK293T cells using the Trans-IT 293 transfection reagent (Mirus, Cat#MIR2700). For each of eighteen 10 cm dishes of HEK293T cells, 1.5 ml Opti-MEM (Gibco, Cat#51935), 16 μg plasmid (8 μg LARRY plasmid, 6 μg psPAX2 (Addgene, PRID: Addgene_12260), 2 μg pMD2.G (Addgene, PRID: Addgene_12259)) were mixed with 45 μl TransIT 293 transfection reagent, incubated for 15-30 min at RT, and added to the cells dropwise. Lentiviral vector particles were harvested 48 h and 72 h after transfection. Medium was collected and filtered through a 0.45 μm PVDF filter (Millipore, Cat#SLHV033RS), and centrifuged in a Beckman Optima XL-80K Ultracentrifuge (Beckman, Cat#8043-30-1211) at 140,000 × <italic>g</italic> for 1h 30 min at 4 °C. The supernatant was removed, and pellets were resuspended with 100 μl of GMEM with serum and all additives as above but without 2i/LIF. The lentiviral vector preparation was incubated on ice for 30 min, aliquoted, and stored at –80 °C. Titration of the lentiviral barcoding library was performed on CGR8 cells cultured in GMEM+2i/LIF, with a read-out 5 days after infection.</p>
    </sec>
    <sec id="Sec17">
      <title>Barcode reference library generation</title>
      <p id="Par24">A reference library was made through the sequencing of PCR-amplified barcodes from the LARRY plasmid library in triplicates. 500 ng of LARRY plasmids were taken as input for a two-step PCR using Phusion high-fidelity DNA polymerase (Thermo Fisher, Cat#F-5305) adapted for LARRY from ref. <sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. The first step amplifies the barcodes and adds Illumina Read1 and Read2 sequences (5’ACACTCTTTCCCTACACG ACGCTCTTCCGATCTTGTGACGTCACAGGTCGACACCAGTCTCATT3′ and 5’GTGACTGGAGTTCAG ACGTGTGCTCTTCCGATCGAGTAACCGTTGCTAGGAGAGACCATA3′). The second step adds the P5 and P7 flow cell attachment sequences and a sample index of 7 bp (P5 5’AATGATA CGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT3′ and P7 5’CAAGCAGA</p>
      <p id="Par25">AGACGGCATACGAGANNNNNNNGTGACTGGAGTTCAGACGTGCTCTTCCGATC3′). 200 ng of PCR1 product was taken as input for PCR2. (PCR programs: 98 °C 2 min, 15 cycles of 98 °C 10 s, 67.2 °C (PCR1), 72 °C (PCR2) 30 s, 72 °C 30 s, followed by final elongation 72 °C 5 min and 4 °C indefinitely). In between PCR1 and PCR2 and after PCR2, PCR purification was performed using the QIAquick PCR purification kit (Qiagen, Cat#28106). The mix of the three samples was sequenced on a MiSeq instrument (Illumina) at the Gene Expression Core Facility of EPFL. Sequencing results were first filtered for a perfect match to the plate index pattern using XCALIBR (<ext-link ext-link-type="uri" xlink:href="https://github.com/NKI-GCF/xcalibr">https://github.com/NKI-GCF/xcalibr</ext-link><underline>)</underline>. The resulting read files were filtered for a perfect match to the barcode pattern using customized R scripts. The resulting list and the LARRY “barcode_list” available on Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>) were merged and used as a reference list.</p>
    </sec>
    <sec id="Sec18">
      <title>mESCs scRNA-seq memory experiment run</title>
      <p id="Par26">CGR8 cells were transduced with 3 ul of the lentiviral LARRY barcoding library per 10 cm dish with 10 ml medium to obtain roughly 1% of GFP<sup>+</sup> cells. 72 h after infection, live GFP<sup>+</sup> cells (Fig. <xref rid="MOESM1" ref-type="media">S1a</xref>; live stain 1:500 propidium iodide solution (BioLegend, Cat#421301)) were sorted on an FACSAria III (BD) at the Flow Cytometry Core Facility of EPFL into Cellcarrier 96-Ultra 96-well plates (PerkinElmer, Cat#6055308). Plates were coated with recombinant human E-cadherin-Fc chimera (BioLegend, Cat#BLG-779904-25ug) to reduce colony formation and thereby limit the potential impact of paracrine and direct cell signaling in regulating gene expression of related cells<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. Coating was performed at 10 μg/ml for 1 h at 37 °C. After washing the plates with PBS, 1,200 cells were sorted into two wells and both were collected after 48 h for sequencing. Before collection, cells were imaged on an IN Cell analyzer 2200 (GE Healthcare) at the Biomolecular Screening facility of EPFL. ScRNA-seq library preparation was performed on a 10X Genomics Chromium platform of the Gene Expression Core Facility of EPFL using the SingleCell 3’ Reagent Kit v3.1. The sample was sequenced on a Hiseq4000 instrument (Illumina). The experiment was performed once.</p>
    </sec>
    <sec id="Sec19">
      <title>mESC scRNA-seq data processing and cell lineage inference</title>
      <p id="Par27">ScRNA-seq data was analyzed using 10X Genomics Cell Ranger (v. 5.0.1), Seurat (v. 4.1.0), customized R (v. 4.0.2), and Python (v. 3.9.7) scripts. Raw sequencing reads were processed using 10X Genomics Cell Ranger (v. 5.0.1) using default parameters and refdata-gex-mm10-2020-A as reference genome, with or without the <italic>include-introns</italic> option. Cell Ranger outputs a unique molecular identifier (UMI) corrected read count matrix. Cells with a percentage of mitochondrial reads between 1.75 and 7.5 and with more than 10,000 reads were further analyzed. Data was normalized to 40,000 reads per cell (similar to RPM, one normalized count equals one read on median). Lineage barcodes were extracted from the data using the CellTag pipeline<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> available for download at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>) and adapted to the LARRY barcode design. Briefly, the CellTag pipeline extracts reads containing a CellTag motif from the processed, filtered, and unmapped reads BAM files produced in intermediate steps of the 10X Genomics Cell Ranger pipeline. To extract LARRY barcodes, the CellTag motif was changed to “([ACTG]{4}TG[ACTG]{4}CA[ACTG]{4}AC[ACTG]{4}GA[ACTG]{4}GT [ACTG]{4}</p>
      <p id="Par28">AG[ACTG] {4})” in all scripts. Barcodes with reads from only one UMI, and without perfect match to the reference library were filtered out. A Jaccard similarity score of &gt;0.7 was used to identify cell lineages. No filtering on the number of barcodes expressed per cell was performed. Lineages were called on unfiltered data. For the mESC dataset, 6 lineages had sizes above 5 cells, which is larger than expected based on cell cluster sizes after 48 h of culture and the expected loss of cell lineage members in the preparation for scRNA-seq. They were therefore excluded from further analysis.</p>
    </sec>
    <sec id="Sec20">
      <title>Processing of public scRNA-seq data</title>
      <p id="Par29">Data from Biddy et al.<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> was extracted as a BAM file from SRA links specified under <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>. BAM files were converted back to fastq format using 10X Genomics’ bamtofastq (v. 1.3.2) and Cell Ranger (v. 5.0.1) was run on the resulting data as described above with or without the <italic>include-introns</italic> option. Cells were filtered on the percentage of mitochondrial reads and the number of reads as indicated in Table <xref rid="MOESM1" ref-type="media">S2</xref>. Data was normalized to 40,000 reads per cell. Cell lineages were assigned using the CellTag pipeline as specified above with the original CellTag motif of “(GGT([ACTG]{8})GAATTC)”(V1), “(GTGATG([ACTG]{8})GAATTC)”(V2) or “(TGTACG([ACTG]{8})GAATTC)”(V3) and the respective whitelists and sample-specific cell barcodes available at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>). As in the original publication, cells with &gt;20 or &lt;2 CellTags expressed were not considered for lineage assignment. Lineages were called on unfiltered data using a Jaccard similarity score of &gt;0.7. Cell lineages were called on individual datasets for all analyses of a single time point. Data from Kimmerling et al.<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> is GSE74923_L1210_CD8_processed_data.txt from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GEO</ext-link>. Ground truth cell lineage information was extracted from the GSE74923_series_matrix.txt file. Data from Weinreb et al.<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was downloaded from (<ext-link ext-link-type="uri" xlink:href="https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md">https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md</ext-link>). Data from Jindal et al. was directly obtained from the authors in the form of Seurat objects including the unnormalized but filtered count matrix and a metadata file comprising the lineage information. All datasets were RPM normalized to 40,000 reads/cell. Data from Wehling et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> was directly obtained from the authors in the form of an unnormalized count matrix and the metadata file (available on GEO GSE167317 asGSE167317_CountMatrix_Seq5.csv, GSE167317_CountMatrix_Seq4.csv, GSE167317_Metadata_Seq5.csv, GSE167317_Metadata_Seq4.csv). Cells with under 100,000 reads were removed and data was normalized to 40,000 reads per cell. Lineage information was extracted from the metadata file. Data from Harmange et al. was downloaded from <ext-link ext-link-type="uri" xlink:href="https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing">https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing</ext-link> (accessed begin July 2022) in the form of 10×1_Filterd_BatchCor_unnorm_sctrans.rds from experiment one. Lineages were assigned using the corresponding script section in the file 10×1_r1_r2_Analysis_unorm_sctrans.Rmd. During filtering, cells with &lt;3% of mitochondrial reads, and cells with &lt;4000 reads were removed. Data was normalized to 40,000 reads/cell. Data from Simeonov et al.<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> was obtained in the form of CellRanger output files for the lung metastasis scRNA-seq data of mouse 1 and 2 from GEO (GSE173958; GSM5283486 and GSM5283491). scRNA-seq data was normalized to 40,000 reads/cell. Lineage annotation was obtained from Mendeley data (DOI: 10.17632/t98pjcd7t6.1) in the form of “Barcodes-of-barcodes” files for all clones. This metadata was then filtered for the annotations of clones present in the scRNA-seq datasets of the lung metastases of mouse 1 and 2. Data from Bues et al.,<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> was directly obtained from the authors in the form of a Seurat Object including a normalized count matrix with crypt and organoid annotation. Briefly, organoids were generated by sorting single Lgr5<sup>+</sup> intestinal stem cells from dissociated organoids into a Matrigel matrix. After culture for 3, 4, 5, or 6 days, single organoids were hand-picked and dissociated individually before loading for scRNA-seq. Organoids are derived from 3 batches. Lgr5<sup>+</sup> intestinal stem cells seeded can be derived from the same organoid. Crypts were collected over 5 batches of 3 pooled mice from 10 mm sections of the ileum. Crypts within the same batch can be derived from the same mouse but were several mm apart in the ileum. Data and scripts from Miller et al.<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/vangalenlab/MAESTER-2021">https://github.com/vangalenlab/MAESTER-2021</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://vangalenlab.bwh.harvard.edu/resources/maester-2021/">https://vangalenlab.bwh.harvard.edu/resources/maester-2021/</ext-link> as TenX_CellLineMix_cells.rds, TenX_CellLineMix_All_mr3_maegatk.rds, TenX_CellLineMix_Seurat_Keep.rds (for the K562 dataset) and BPDCN712_Maegatk_Final.rds, BPDCN712_Seurat_Final.rds, 4.2_vois.txt (for the primary human bone marrow cells). Lineage assignment was performed as in the scripts 3.4_TenX_K562_clones.R and 4.3_variants_Of_Interest.R for K562 and bone marrow cells respectively. “GroupIDs” were then unlisted to extract the cell-barcode lineage correspondence. The count-matrix for the K562 dataset was extracted from the TenX_CellLine_Mix Seurat object by filtering for K562 cells. For the primary bone marrow cells, the BPDCN712 Seurat object was split out by replicate to generate the GEMLI input count matrices. For both cell types, lineages were filtered to be defined by a single informative mitochondrial variant. Data from Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast">https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast</ext-link>. The scRNA-seq dataset was filtered to a &gt; 1000 reads/cell and a mitochondrial fraction of 1-50%. Cell types were annotated through supervised machine learning. In brief, a UMAP was built upon a linear discriminant analysis (LDA; R package ‘MASS’ (v. 7.3-58.3) performed on log molecule numbers) which in turn was based on provided cluster annotations for Xenium data in situ sequencing data. Single-cell RNA-seq Chromium data was then projected onto this LDA-UMAP to assign cell types. Assignments were specific and unique. Finally, each cluster was assigned its cell type annotation through the assessment of marker genes provided in Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>.</p>
    </sec>
    <sec id="Sec21">
      <title>ScRNA-seq data representation</title>
      <p id="Par30">ScRNA-seq data is represented as tSNE, UMAP, or SPRING graph. tSNE embeddings were generated using a custom function based on the tSNE R package (v. 0.1-3.1) on exonic, or both intronic and exonic reads. PCA was calculated on the 3,000 top variable expressed genes. Subsequently, a tSNE was computed on the PCAs top 10 components. SPRING graphs were generated from precalculated values in public datasets (HSPC data was represented as SPRING graph)). UMAPS (mESC, crypts, and organoid datasets) were generated in a standard Seurat analysis. Briefly, variable features were called using the FindVariableFeatures function (parameters selection.method =”vst”, and number of features = 2000), data was scaled using the ScaleData function on all genes, and a PCA was run using the RunPCA function on variable features. Subsequently, a UMAP was built using the RunUMAP function on the top 14 components.</p>
    </sec>
    <sec id="Sec22">
      <title>Assessment of gene expression similarity</title>
      <p id="Par31">Gene expression correlation within cell lineages or random samples for the whole transcriptome was calculated as Pearson correlation. Correlation distance is calculated as 1- the correlation value. To assess the similarity of related cells with respect to cell cycle, genes were classified as cell cycle-dependent or independent using a cell cycle assignment by the cyclone function within scran (v. 1.18.7). Dependence of gene expression on the cyclone assigned cell cycle phases (numerized) was tested using Hoeffding’s D statistics. Gene expression correlation was then calculated using only genes classified as cell-cycle dependent. To assess the similarity in the velocity of related cells, velocity analysis was performed using the velocyto package (v. 0.6). Velocity momenti were extracted for each cell, and their Pearson correlation was calculated. Complexity was defined as the number of genes expressed in a cell and the complexity range within cell lineages was calculated for analysis. For all metrics (transcriptomic similarity in all genes, in cell-cycle dependent genes, similarity in velocity momenti, and in complexity) values between related cells (all lineage sizes) and repeated (100x) random samples of cells of the same size were compared. For the scoring of transcriptomic similarity in symmetric and asymmetric lineages, symmetric and asymmetric lineages were defined based on entire lineages.</p>
    </sec>
    <sec id="Sec23">
      <title>Estimation of variation mediated by cell lineages</title>
      <p id="Par32">Assuming that the variation (here CV<sup>2</sup>) within each lineage is independent of cross-lineage effects, we built a linear model using the <italic>stats</italic> package (v. 3.6.2) to capture the relationship of the variation across lineages (variation of means of each lineage) and total variation (variation across all cells). We then generated mock lineages through the permutation of ground truth lineages and used our model to estimate the total variation in these control sets. Lineages of sizes 3–5 for mESCs and WM989 cells, of size 4 for CD8 and L1210, and of size 2 for all other cell types were considered. This ensured to inclusion of around 90% of the cells in each dataset.</p>
    </sec>
    <sec id="Sec24">
      <title>Memory-gene identification and categorization</title>
      <p id="Par33">We defined memory genes as genes with high variability (coefficient of variability squared; CV<sup>2</sup>) in mean gene expression in different cell lineages. We compared the lineage value to the distribution of values from repeated (20x) random size-matched samples of cells to calculate a p-value. Memory genes were defined as genes with a significantly (p &lt; =0.05) higher variability between lineages as compared to random samples. To categorize memory genes into quantitative and qualitative memory genes, we used the <italic>skewness</italic> function of the R package <italic>moments</italic> (v. 0.14.1). We defined a quantitative memory gene as a gene with a skewness in expression level of under 3, and a qualitative memory gene, as a gene with a skewness in expression level equal or above 3. Memory genes were called on cell lineages of 3–5 (mESCs), 2 members (invasive tumor), or 2–5 members (all other cell types). All predicted cell lineages were used when calling memory genes on these. Other criteria to call memory genes resulted in highly overlapping gene sets (Fig. <xref rid="MOESM1" ref-type="media">S6a, b</xref>). These additional memory gene selection criteria included a high correlation in gene expression within cell lineages and a low variability (CV<sup>2</sup>) in gene expression between cells of the same cell lineage (intra-lineage CV<sup>2</sup>; intraCV<sup>2</sup>). Furthermore, we analyzed marker genes of cell lineages using the Seurat FindMarker function with a range of <italic>test.use</italic> parameters (<italic>bimod, roc, t</italic> (T-test)<italic>, negbinom, poisson, LR, MAST</italic>). We then considered as memory genes the markers with a high sharing across cell lineages, using thresholds defined independently for each <italic>FindMarker</italic> run to optimize the Pearson correlation in gene expression within cell lineages. Finally, to identify memory genes using machine learning, we used common dimension reduction methods, mutual information maximizer (MIM), and ANOVA F-test feature selection (ANOVA). Other feature selection techniques frequently used in the literature were also investigated, but MIM and ANOVA outperformed all the other methods. For both, each gene was attributed a memory score either by computing the mutual information or ANOVA <italic>F</italic>-test of the gene expression across cells. To determine the ideal number of genes N to include in the final gene set, we predicted cell lineages using the top N genes with the highest memory score. Each of the resulting clusters was evaluated and the number of genes N with the best precision was chosen as the optimal number of memory genes. For the comparison of memory genes and variable genes in the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, memory genes were called on lineages predicted at confidence level 50 with a lineage size parameter of 2–20 in each cell type independently. Genes were considered to be variable when having a residual to a least total square fit on mean expression and CV² above zero.</p>
    </sec>
    <sec id="Sec25">
      <title>GO-term enrichment analysis</title>
      <p id="Par34">GO-term enrichment analysis was performed on memory genes called using the lineage ground truth (derived from cellular barcoding, microfluidics, or sister cell picking), and on memory genes called using predicted cell lineages. The <italic>topGO</italic> R package (v. 2.42.0) was used with the GO category “biological process”. Memory genes and background (all genes detected) were considered to be binary. The top 10, 20, 100, or 500 enriched GOs from each set were visualized as indicated. Spearman rank correlation between GO-term enrichment values was calculated for memory genes called on-ground truth and predicted cell lineages. For GO-term enrichment of memory genes called based on predicted lineages in the Janesick data, GO-terms were further compared to expression-matched random gene sets. Enriched terms were significant (Fisher’s exact test, <italic>p</italic> &lt; 0.001) and enriched over 100 expression-matched random gene sets (estimated <italic>p</italic> &lt; 0.05). A selection of terms is shown in Fig. <xref rid="MOESM1" ref-type="media">S22a</xref> and the full list can be found in Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec26">
      <title>Gene selection for GEMLI predictions</title>
      <p id="Par35">Genes for cell lineage predictions were selected to enrich memory genes based on the quantiles of the mean and variability of gene expression. The variability of gene expression was defined as mean-corrected CV<sup>2</sup> calculated in the form of the residual of the CV<sup>2</sup> to a linear fit of CV<sup>2</sup> and mean expression. The genes selected for lineage predictions are the 2% highest expressed genes, the 60% most variable among the 10% highest expressed genes, and the 10% most variable among the 40% highest expressed genes: (mean quantile &gt;= 98) or (mean quantile &gt;= 90 and variability quantile &gt;= 40) or (mean quantile &gt;= 60 &amp; and variability quantile &gt;= 90)). The selected genes are taken as input for the repetitive iterative clustering algorithm. The selected genes do only partly overlap with highly variable genes and cell type markers called during a standard Seurat-based scRNA-seq analysis (Figs. <xref rid="MOESM1" ref-type="media">S4f</xref> and  <xref rid="MOESM1" ref-type="media">S7f</xref>). For this comparison, highly variable genes were called as top 2000 variable genes with standard Seurat parameters. Cell type markers were called using Seurat’s FindMarkers function for each cell type present with at least 5 cells. Also using machine learning to select genes based on variability and mean gene expression did not further enrich memory genes (Fig. <xref rid="MOESM1" ref-type="media">S7c</xref>). Briefly, different models were trained including logistic regression with L2 regularization (LR), support-vector machine (SVM) with the radial basis function (RBF) kernel, and a neural network. The mESC and Biddy et al. MEF datasets of 48 h and 72 h culture time (<italic>n</italic> = 1 and <italic>n</italic> = 6, respectively) were used for model training, the datasets of CD8, L1210 (<italic>n</italic> = 1 each), and HSPC (48 h; <italic>n</italic> = 22) were used for model validation. The mean expression outliers in each dataset were removed using the inter-quartile range (IQR) method. All the outliers were considered to be memory genes and were added in the final gene selection. Then, the data was normalized to a range between 0 and 1. Each dataset was preprocessed individually. The LR and SVM models were trained using their sklearn (v. 1.1.1) implementation. The neural network was optimized using the Pytorch framework (v. 1.11.0). To optimize the model, a balanced version of the binary cross entropy loss and accuracy was used to account for the fact that the proportion of memory genes is low in all datasets while most machine learning models assume that the data has approximately the same number of samples of both classes. To take this into account, a bigger weight was given to a misclassification of the minority class, the memory genes. To find the optimal hyperparameters for the LR and SVM a grid search and cross-validation were performed. Based on this, the L2 regularization was adjusted to 10<sup>3</sup> and 10<sup>5</sup> for LR and SVM respectively. For the neural network, cross-validation was deemed too computationally expensive, and the Optuna Python package (v. 2.10.0) was used to perform a random search for the optimal hyperparameters on training and validation set (Supplementary Data file <xref rid="MOESM9" ref-type="media">6</xref>). The best performing model was the neural network and its results are show in the Supplementary Figs.</p>
    </sec>
    <sec id="Sec27">
      <title>GEMLI cell lineage prediction algorithm</title>
      <p id="Par36">The GEMLI algorithm is a repetitive iterative clustering approach to predict cell lineages (Scheme in Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, see Table <xref rid="MOESM1" ref-type="media">S1</xref> for a comparison to other clustering algorithms), taking a gene set as input. For de novo cell lineage predictions on scRNA-seq data without lineage annotation the gene set is selected based on mean gene expression and variability (see previous section). Also other gene sets can be used as input, notably memory genes when a ground truth lineage annotation is available (see below). During each iterative clustering, the input gene set is randomly subsampled to 75% (sampling value parameter; see section on GEMLI parameters below). This gene set subsample is then used to cluster the cells of the dataset iteratively as follows. During the first iteration, two clusters (cluster cut parameter; see below) are generated using <italic>cutree</italic> function from the dendextend (v.1.16.0) R package and the <italic>hclust</italic> hierarchical clustering function of the R package stats (v.4.0.2) on the gene expression correlation distance using the agglomeration method ward.D2. In every subsequent iteration round, the cells of each previously defined cluster are clustered again into two clusters using the same procedure. The iteration is ended for clusters meeting a predetermined size of 2–3 cells (lineage size parameter, see below). This results in a cell-by-cell matrix indicating for each cell-pair if it did cluster together in the final cluster of 2–3 cells. This iterative hierarchical clustering represents one-cell lineage prediction. It is repeated 100 times (repetition number parameter, see below) to generate a confidence level for the lineage predictions. More in detail, the cell-by-cell matrices generated in the 100 repetitions of the iterative hierarchical clustering are summed into a confidence level cell-by-cell matrix. Two cells ending up in the same cluster in 30 of the 100 predictions will here for example receive the value of 30. Setting a threshold on the confidence level can then be used for lineage assignment. Cell lineages are assigned as cell groups of which members are clustering together above a confidence level threshold. Lineage assignments are scored against the ground truth lineages (barcode, microfluidic, or sister-cell picking) on precision (true positives (TP)/(TP+ false positives (FP))), sensitivity (TP/(TP+ false negatives (FN))) and false positive rate (FPR; FP/(FP+ true negatives (TN))). All are calculated for each confidence level X by comparing the predictions with a confidence level &gt;=X to the ground truth cell lineage relationships. Thereby precision, sensitivity and FPR are calculated on cell pairs. For the majority of datasets, also AUC values were calculated using the R package Metrics (v. 0.1.4) by the confidence level of predictions as a probability value.</p>
    </sec>
    <sec id="Sec28">
      <title>Comparison of GEMLI to other lineage assignment approaches</title>
      <p id="Par37">To test the performance of GEMLI predictions, characteristics-based gene selection was compared to other starting gene sets, as all genes and memory genes called using the lineage ground truth (from cellular barcoding, microfluidics, or sister cell picking). Further, different memory gene definitions (see above) and Seurat’s highly variable genes (see above) were tested as input gene sets. Finally, memory gene enriched gene sets selected based on mean expression and variability using a neural network (see above) were tested in predictions. GEMLI predictions had a slightly lower precision and sensitivity than predictions using memory genes, but performed better than all genes (Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). FPR was comparable between all three genesets (GEMLI, memory genes, all genes) and consistently very low (&lt;1%) at confidence levels &gt;=50. Other memory gene definitions did not improve prediction performance (Fig. <xref rid="MOESM1" ref-type="media">S6c–h</xref>). Also, gene selection based on a neural network did not improve lineage predictions as compared to GEMLI (Fig. <xref rid="MOESM1" ref-type="media">S9d</xref>). Seurat’s highly variable genes likewise performed worse than the GEMLI gene selection (Fig. <xref rid="MOESM1" ref-type="media">S9f</xref>). Furthermore, the use of a memory gene set called using the ground truth lineage information in one dataset, did also not allow for improved predictions in other datasets of the same or related/other starting cell type and culture condition (Fig. <xref rid="MOESM1" ref-type="media">S9e</xref>). Finally, GEMLI performance was also compared to other lineage assignment approaches, namely random cell pair assignment and kNN-clustering-based lineage assignments. GEMLI predictions on randomly lineage-assigned cells had as expected a very low precision and sensitivity and a high FPR (Fig. <xref rid="MOESM1" ref-type="media">S9a</xref>). Furthermore, cell pairs generated using kNN-clustering with different inputs (Seurat top 2000 variable genes, top 14 components of a PCA on these genes, UMAP on this PCA) resulted in a very low precision, comparable sensitivity, and higher FPR than GEMLI predictions (Fig. <xref rid="MOESM1" ref-type="media">S9b, c</xref>).</p>
    </sec>
    <sec id="Sec29">
      <title>GEMLI predictions for symmetric and asymmetric lineages and different lineage sizes</title>
      <p id="Par38">Scoring predictions for symmetric (one cell type) and asymmetric (several cell types) lineages were performed in three ways. First, only two-cell lineages were scored, which can be unequivocally defined as symmetric (both members of one cell type) and asymmetric (each member of another cell type). Second, lineages of all sizes were scored for which symmetry was defined considering all cell members. Lineages with all members in one cell type were here considered symmetric. Lineages in which any members were part of two different cell types were considered to be asymmetric. Third, cell pairs were scored on the entire prediction matrix by taking pairs where both cells are of the same cell type as symmetric lineage, and pairs where both cells are of a different cell type as asymmetric lineage, respectively. For lineage size analyses the prediction matrix was stratified to only score pairs in which one or both cells are members of a lineage of the indicated ground truth lineage size.</p>
    </sec>
    <sec id="Sec30">
      <title>KNN-clustering-based lineage assignments for comparison to GEMLI predictions</title>
      <p id="Par39">For kNN analysis a standard Seurat pipeline was used. Data was normalized and the 2000 most variable features were extracted using default parameters. The data was then scaled, a PCA was performed on previously defined variable genes and a UMAP was conducted on the first 14 principal components. The kNN analysis was then performed using the dbscan package (v. 1.1-11) with <italic>k</italic> = 1 or 2 as indicated, on either the scaled data for variable features, the 14 first principal components or the UMAP embedding. Pairs of nearest neighbors were used as the lineage for comparison with GEMLI predictions.</p>
    </sec>
    <sec id="Sec31">
      <title>GEMLI prediction algorithm parameters</title>
      <p id="Par40">Several parameters can be set during GEMLI predictions: (1) the sampling value (which fraction of genes is selected for each repetition of the iterative hierarchical clustering), (2) the number of repetitions of the iterative clustering (based on which the confidence level is calculated), (3) the number of clusters in which clusters are split during each iteration (“cluster cut”) and (4) the size of clusters at which clustering iterations are stopped (“lineage size parameter”). The default values used throughout the main figures are a sampling value of 75%, 100 repetitions, splitting clusters into 2 during each iteration, and lineage size parameter of 2–3 cell members unless otherwise indicated. The influence of changes in single parameters on predictions was tested on the unique mESC, CD8, L1210, and one HSPC, WM989, and HSC dataset (Figs. <xref rid="MOESM1" ref-type="media">S10</xref> and  <xref rid="MOESM1" ref-type="media">S12</xref>). A lower sampling value increased precision while decreasing sensitivity (Fig. <xref rid="MOESM1" ref-type="media">S10a, b</xref>). When the number of clusters into which each cluster is split is higher than the maximal lineage size to be predicted, precision values increase and sensitivity decreases (Fig. <xref rid="MOESM1" ref-type="media">S10c, d</xref>). The number of repetitions did only had a small effect on precision and sensitivity values, with higher repetition numbers increasing precision and decreasing sensitivity of the predictions (Fig. <xref rid="MOESM1" ref-type="media">S12e, f</xref>). Also, the lineage size parameter, meaning the size of clusters at which clustering iterations are stopped influences both precision and sensitivity. Precision will be high for predictions with a lineage size parameter of 2–3 until the average size of ground truth lineages is present (Fig. <xref rid="MOESM1" ref-type="media">S12</xref>). FPR stayed low throughout. Only a size parameter greatly exceeding the average ground truth lineage size (Fig. <xref rid="MOESM1" ref-type="media">S12c–e</xref>) can increase FPR to values &gt; 1%, but still &lt;5%. For predictions of multicellular structures (intestinal crypts and organoids) for which related cells are in spatial proximity to each other, the cluster stability of lineages predicted at increasing lineage size parameters, (cluster stability calculated using the sc3 package within the R package clustree (v.0.5.0)), reflected well the ground truth lineage size and plateaued when reaching the maximal ground truth lineage size present. In contrast, for predictions in datasets with primarily small lineages without a spatial proximity or confinement, sc3 cluster stability of predictions increased gradually with increasing lineage size parameter and did not plateau. This allowed for a de novo estimation of the lineage size until which prediction could be performed with high precision in datasets with multicellular structures (fig. <xref rid="MOESM1" ref-type="media">S19</xref>). Depending on the aim of cell lineage predictions and the dataset characteristics (see next section), parameters and confidence level threshold can thereby be adjusted to increase precision or sensitivity respectively.</p>
    </sec>
    <sec id="Sec32">
      <title>Influence of sequencing depth and cell number on GEMLI predictions</title>
      <p id="Par41">To estimate the influence of sequencing depth and dataset size on lineage predictions, GEMLI predictions were performed after downsampling the number of reads or cells in the mESC dataset, and one MEF and HSPC dataset (Fig. <xref rid="MOESM1" ref-type="media">S15</xref> and Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). For read downsampling, all reads of a given cell were vectorized, and subsequently, a fraction (66%, 50%, 33%, 10%) of these reads were sampled. Cells were subsampled separately to 66%, 50%, 33%, and 10% of the initial cell numbers. Cells without lineage assignment or being the only member of a cell lineage were subsampled directly to the desired fraction. Cells that were members of cell lineages with several members were subsampled together with their respective cell lineage members. Sensitivity of lineage predictions decreased with decreasing sequencing depth but the precision of lineage predictions stayed high above values of 5000–8000 reads/cell as commonly recommended for available scRNA-seq technologies<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup> (Fig. <xref rid="MOESM1" ref-type="media">S15a, b</xref>). Subsamples with fewer cells generally had a slightly better precision and sensitivity, especially for very low read counts (Fig. <xref rid="MOESM1" ref-type="media">S15c, d</xref>). FPR stayed &lt;1% for all conditions.</p>
    </sec>
    <sec id="Sec33">
      <title>Cell fate decision analysis</title>
      <p id="Par42">To assess how well GEMLI can recapitulate the prevalence of different types of cell fate decisions, the HSPC (N = 44) and WM989 (N = 8) datasets were analyzed. HSPCs datasets are derived from cells cultured in myeloid differentiation conditions and are annotated according to their cell type as basophil (Baso), eosinophil (Eosino), erythroid, lymphoid (Lymph), megakaryocyte (Meg), monocyte (Mono), neutrophil (Neutro), mast cell, plasmacytoid dendritic cell (pDC (1/2)), migratory dendritic cell (Ccr7<sup>+</sup>), classic dendritic cell (cDC) or undifferentiated (Undiff) cells (published metadata<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>). Only certain cell type combinations of related cells exist and all have a different prevalence, meaning that HSPCs are restricted in their fate decisions. For each possible cell type combination (for example, erythroid-eosinophil or undifferentiated-mast cell) the number of cell pairs in barcode and GEMLI lineages was determined and summed for all datasets. WM989 cells are annotated as drug-susceptible or drug-resistant (published metadata<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>). Members of each cell lineage are either entirely in one of these two states (symmetric cell pairs) or distributed between these two states (asymmetric cell pairs), with the latter implying that cells recently switched fate. We compared the number of barcodes- and GEMLI-predicted related cell pairs being entirely drug-susceptible, primed, or distributed between the two states. Both for HSPC and WM989 datasets, also DEGs called between different related asymmetric and symmetric cell pairs were compared in barcode and GEMLI lineages. DEG was called using the <italic>FindMarkers</italic> function of Seurat with parameters min.pct=0.05 (HSPC) or 0.25 (WM989) and logfc.threshold=0.1. For HSPCs, not all comparisons of cell type pairs allowed DEG identification. To compare GEMLI and barcode lineages, the Spearman rank correlation between enrichment scores was calculated. The performance of GEMLI in recapitulating the prevalence of lineages and encompassing different cell types (HSPC) of states (WM989) was also compared to random cell lineage assignments for HSPC and WM989 datasets. For the HSPC datasets, it was further compared to a kNN-clustering based lineage assignment. Likewise, the performance of GEMLI in recovering DEG specific to cells in lineages composed of specific cell types or states was also compared to random cell type and kNN-based lineage assignments as follows. For the DEG analysis in Fig. <xref rid="Fig3" ref-type="fig">3e–d</xref> the correlation between the enrichment of DEG in ground truth lineages and predicted lineages for which members were exchanged against random cells of the same cell type was calculated (Fig. <xref rid="MOESM1" ref-type="media">S17e, f</xref>). For the HSPC datasets, DEG analysis was also performed for random cell samples and kNN-based lineage assignments in all datasets (Fig. <xref rid="MOESM1" ref-type="media">S17a, d</xref>). Cell-type combinations predicted by GEMLI were scored and compared. Trajectory analyses were performed using the <italic>scran</italic> (v. 1.28.2) and <italic>slingshot</italic> (2.8.0) packages. Analyses were performed on the 200 (HSPC) or 2000 (WM989) most variable genes on a UMAP with cluster annotation based on a nearest-neighbor graph. Cells in transition was identified based on pseudo-time as those cells of each type that are located close to the transition point between undifferentiated cells and neutrophil cells (HSPC) or drug-susceptible and primed cells (drug-resistant; WM989) respectively. To analyze cell fate decisions in the human breast cancer cell subsets of the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, DEG were called as described above for all cell pairs being members of lineages predicted with lineage size parameter 2–20 cells at confidence level 50 annotated as encompassing only DCIS or invasive tumor cells (symmetric DCIS and symmetric invasive tumor lineages respectively) or being members of lineages encompassing both cell types (asymmetric lineages). For the latter category, only DCIS or invasive tumor cells were considered when indicated.</p>
    </sec>
    <sec id="Sec34">
      <title>Datasets considered for analysis</title>
      <p id="Par43">For datasets considered in each figure and analysis see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>. For all figures in which one dataset of seven cell types is represented the unique mESC, CD8, L1210, as well as the MEF dataset BIDDY_D0_2, the WM989 dataset WM989_well1, the HSC dataset HSC_seq2, and the HSPC dataset LK_D2_exp1_library_d2_2 are represented. To show a dataset encompassing a large number of asymmetric lineages, the dataset LK_D4_well1_exp1_library_d4_1_2 is used in Fig. <xref rid="Fig3" ref-type="fig">3e</xref>. For other panels see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>.</p>
    </sec>
    <sec id="Sec35">
      <title>Statistics and reproducibility</title>
      <p id="Par44">A two-sided Mann–Whitney <italic>U</italic>-test, which does not require normally distributed data, was used to test statistical significance when indicated. No statistical method was used to predetermine sample sizes. No data were excluded from the analyses. The experiments were not randomized. The investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec36">
      <title>Reporting summary</title>
      <p id="Par45">Further information on research design is available in the <xref rid="MOESM10" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec37">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2024_47158_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Material</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2024_47158_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2024_47158_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2024_47158_MOESM4_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2024_47158_MOESM5_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2024_47158_MOESM6_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2024_47158_MOESM7_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 4</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2024_47158_MOESM8_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 5</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM9">
          <media xlink:href="41467_2024_47158_MOESM9_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 6</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM10">
          <media xlink:href="41467_2024_47158_MOESM10_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec38">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM11">
          <media xlink:href="41467_2024_47158_MOESM11_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: A. S. Eisele, M. Tarbier.</p>
    </fn>
    <fn>
      <p>
        <bold>Change history</bold>
      </p>
      <p>6/4/2024</p>
      <p>A Correction to this paper has been published: 10.1038/s41467-024-48978-8</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-024-47158-y.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank the Gene Expression Core Facility, Flow Cytometry Core Facility, Biomolecular Screening Facility, and Scientific IT &amp; Application Support of EPFL. Computational analysis was partially performed on resources provided by the SNIC through UPPMAX. We thank Theo Maffei and Imane Ben M’Rad as students of the EPFL Machine Learning Master course CS-433, as well as Bart Deplancke, Gioele La Manno, Nicholas Phillips, Vincent Gardeux, Johannes Bues, Jörn Pezoldt, Nikolay Oskolkov, Gustavo Jeuken, and the Friedländer, Kutter and Pelechano labs for their helpful input. We are thankful for funding by Swiss National Science Foundation grant#CRSII5_189910 to D.M.S., Novartis Foundation for Medical-Biological Research grant#20A023 to D.M.S., OE och Edla Johanssons Research Foundation to M.T. and A.S.E., The Swedish Research Council (VR 2021-06112 and 2020-01480) to V.P., Knut and Alice Wallenberg Foundation (KAW 2021.0167) to V.P., Ragnar Söderberg Foundation (S12/20) to V.P.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Conceptualization: A.S.E. and D.M.S. Supervision: D.M.S. and V.P. Generation ES cell data: A.S.E. Data analysis: A.S.E., M.T., A.D. Writing R package: A.S.E., M.T. Funding acquisition: D.M.S., V.P., M.T., A.S.E. Writing of the revised manuscript: A.S.E., D.M.S., M.T.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par46"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. CGR8 mESC scRNA-seq data generated in this study has been deposited on GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE226169">GSE226169</ext-link>. The MEF datasets used in this paper are available at GEO under accession codes <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>, The CD8 and L1210 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GSE74923</ext-link>. The HSC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM5101733">GSE167317</ext-link>. The WM989 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE237228">GSE237228</ext-link>. The pancreatic cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE173958">GSE173958</ext-link>. The intestinal crypt and organoid datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE148093">GSE148093</ext-link>. The HSPC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE140802">GSE140802</ext-link>. The human bone marrow and K562 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE182685">GSE182685</ext-link>. The human breast cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE243280">GSE243280</ext-link>. Source data are provided with this paper<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The GEMLI R package and its documentation are available on GitHub at <ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>. A <italic>Zenodo</italic> repository has been created for the GitHub GEMLI package v1.0.0 under doi:10.5281/zenodo.10673334<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. The code to produce all main figures of the paper is available on <italic>Zenodo</italic> doi: 10.5281/zenodo.10581737<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par47">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chang</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ontogeny and vulnerabilities of drug-tolerant persisters in HER2+ breast cancer</article-title>
        <source>Cancer Discov.</source>
        <year>2022</year>
        <volume>12</volume>
        <fpage>1022</fpage>
        <lpage>1045</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-1265</pub-id>
        <?supplied-pmid 34911733?>
        <pub-id pub-id-type="pmid">34911733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Emert</surname>
            <given-names>BL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Variability within rare cell states enables multiple paths toward drug resistance</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>865</fpage>
        <lpage>876</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00837-3</pub-id>
        <?supplied-pmid 33619394?>
        <pub-id pub-id-type="pmid">33619394</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fennell</surname>
            <given-names>KA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Non-genetic determinants of malignant clonal fitness at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>601</volume>
        <fpage>125</fpage>
        <lpage>131</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-04206-7</pub-id>
        <?supplied-pmid 34880496?>
        <pub-id pub-id-type="pmid">34880496</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harmange</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Disrupting cellular memory to overcome drug resistance</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>7130</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-41811-8</pub-id>
        <?supplied-pmid 37932277?>
        <pub-id pub-id-type="pmid">37932277</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <mixed-citation publication-type="other">Meir, Z., Mukamel, Z., Chomsky, E., Lifshitz, A. &amp; Tanay, A. Single-cell analysis of clonal maintenance of transcriptional and epigenetic states in cancer cells. <italic>Nat. Genet</italic>. 10.1038/s41588-020-0645-y (2020).</mixed-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oren</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cycling cancer persister cells arise from lineages with distinct programs</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>576</fpage>
        <lpage>582</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03796-6</pub-id>
        <?supplied-pmid 34381210?>
        <pub-id pub-id-type="pmid">34381210</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Shaffer, S. M. et al. Memory sequencing reveals heritable single-cell gene expression programs associated with distinct cellular behaviors. <italic>Cell</italic>10.1016/j.cell.2020.07.003. (2020).</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dar</surname>
            <given-names>RD</given-names>
          </name>
        </person-group>
        <article-title>A transient heritable memory regulates HIV reactivation from latency</article-title>
        <source>iScience</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>102291</fpage>
        <pub-id pub-id-type="doi">10.1016/j.isci.2021.102291</pub-id>
        <?supplied-pmid 33889814?>
        <pub-id pub-id-type="pmid">33889814</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Biddy, B. A. et al. Single-cell mapping of lineage and identity in direct reprogramming. <italic>Nature</italic>10.1038/s41586-018-0744-4 (2018).</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Mold, J. E. et al. Clonally heritable gene expression imparts a layer of diversity within cell types. <italic>Cell Systems</italic>10.1016/j.cels.2024.01.004 (2024).</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tian</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal multi-omics reveals Bcor as a negative regulator of emergency dendritic cell development</article-title>
        <source>Immunity</source>
        <year>2021</year>
        <volume>54</volume>
        <fpage>1338</fpage>
        <lpage>1351.e9</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2021.03.012</pub-id>
        <?supplied-pmid 33862015?>
        <pub-id pub-id-type="pmid">33862015</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Weinreb, C., Rodriguez-Fraticelli, A., Camargo, F. D. &amp; Klein, A. M. Lineage tracing on transcriptional landscapes links state to fate during differentiation. <italic>Science</italic>10.1126/science.aaw3381 (2020).</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oki</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Epigenetic memory underlies cell-autonomous heterogeneous behavior of hematopoietic stem cells</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>167</volume>
        <fpage>1310</fpage>
        <lpage>1322.e17</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.10.045</pub-id>
        <?supplied-pmid 27863245?>
        <pub-id pub-id-type="pmid">27863245</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriguez-Fraticelli</surname>
            <given-names>AE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing unveils a role for TCF15 in haematopoiesis</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>585</fpage>
        <lpage>589</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2503-6</pub-id>
        <?supplied-pmid 32669716?>
        <pub-id pub-id-type="pmid">32669716</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Richman</surname>
            <given-names>LP</given-names>
          </name>
          <name>
            <surname>Goyal</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ClonoCluster: a method for using clonal origin to inform transcriptome clustering</article-title>
        <source>Cell Genomics</source>
        <year>2023</year>
        <volume>3</volume>
        <fpage>100247</fpage>
        <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100247</pub-id>
        <?supplied-pmid 36819662?>
        <pub-id pub-id-type="pmid">36819662</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alemany</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Florescu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Baron</surname>
            <given-names>CS</given-names>
          </name>
          <name>
            <surname>Peterson-Maduro</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Whole-organism clone tracing using single-cell sequencing</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>556</volume>
        <fpage>108</fpage>
        <lpage>112</lpage>
        <pub-id pub-id-type="doi">10.1038/nature25969</pub-id>
        <?supplied-pmid 29590089?>
        <pub-id pub-id-type="pmid">29590089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lederer</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>The emergence and promise of single-cell temporal-omics approaches</article-title>
        <source>Curr. Opin. Biotechnol.</source>
        <year>2020</year>
        <volume>63</volume>
        <fpage>70</fpage>
        <lpage>78</lpage>
        <pub-id pub-id-type="doi">10.1016/j.copbio.2019.12.005</pub-id>
        <?supplied-pmid 31918114?>
        <pub-id pub-id-type="pmid">31918114</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Raj</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous single-cell profiling of lineages and cell types in the vertebrate brain</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>442</fpage>
        <lpage>450</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4103</pub-id>
        <?supplied-pmid 29608178?>
        <pub-id pub-id-type="pmid">29608178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spanjaard</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous lineage tracing and cell-type identification using CrIsPr-Cas9-induced genetic scars</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>469</fpage>
        <lpage>473</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4124</pub-id>
        <?supplied-pmid 29644996?>
        <pub-id pub-id-type="pmid">29644996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Frieda, K. L. et al. Synthetic recording and in situ readout of lineage information in single cells. <italic>Nature</italic>10.1038/nature20777. (2017).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Kimmerling, R. J. et al. A microfluidic platform enabling single-cell RNA-seq of multigenerational lineages. <italic>Nat. Commun</italic>. 10.1038/ncomms10220 (2016).</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Kumar, R. M. et al. Deconstructing transcriptional heterogeneity in pluripotent stem cells. <italic>Nature</italic>10.1038/nature13920 (2014).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Wehling, A. et al. Combined single-cell tracking and omics improves blood stem cell fate regulator identification. <italic>Blood</italic>10.1182/blood.2022016880 (2022).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wheat</surname>
            <given-names>JC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-molecule imaging of transcription dynamics in somatic stem cells</article-title>
        <source>Nature</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2432-4</pub-id>
        <?supplied-pmid 32581360?>
        <pub-id pub-id-type="pmid">32581360</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florian</surname>
            <given-names>MC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Aging alters the epigenetic asymmetry of HSC division</article-title>
        <source>PLoS Biol.</source>
        <year>2018</year>
        <volume>16</volume>
        <fpage>e2003389</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.2003389</pub-id>
        <?supplied-pmid 30235201?>
        <pub-id pub-id-type="pmid">30235201</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>LINEAGE: label-free identification of endogenous informative single-cell mitochondrial RNA mutation for lineage analysis</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2022</year>
        <volume>119</volume>
        <fpage>e2119767119</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2119767119</pub-id>
        <?supplied-pmid 35086932?>
        <pub-id pub-id-type="pmid">35086932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Miller, T. E. et al. Mitochondrial variant enrichment from high-throughput single-cell RNA sequencing resolves clonal populations. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-022-01210-8. (2022).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beneyto-Calabuig</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Müller-Tidow</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Velten</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Clonally resolved single-cell multi-omics identifies routes of cellular differentiation in acute myeloid leukemia</article-title>
        <source>Cell Stem Cell</source>
        <year>2023</year>
        <volume>30</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2023.04.001</pub-id>
        <?supplied-pmid 37098346?>
        <pub-id pub-id-type="pmid">37098346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Ludwig, L. S. et al. Lineage Tracing in Humans Enabled by Mitochondrial Mutations and Single-Cell Genomics. <italic>Cell</italic> 1–15 10.1016/j.cell.2019.01.022 (2019).</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell mitochondrial DNA genotyping and chromatin profiling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>451</fpage>
        <lpage>461</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0645-6</pub-id>
        <?supplied-pmid 32788668?>
        <pub-id pub-id-type="pmid">32788668</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kwok</surname>
            <given-names>AWC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MQuad enables clonal substructure discovery using single cell mitochondrial variants</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-28845-0</pub-id>
        <pub-id pub-id-type="pmid">34983933</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-00795-2</pub-id>
        <?supplied-pmid 33462507?>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Jindal, K. et al. Single-cell lineage capture across genomic modalities with CellTag-multi reveals fate-specific gene regulatory changes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01931-4 (2023).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNA velocity of single cells</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>560</volume>
        <fpage>494</fpage>
        <lpage>498</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0414-6</pub-id>
        <?supplied-pmid 30089906?>
        <pub-id pub-id-type="pmid">30089906</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Phillips</surname>
            <given-names>NE</given-names>
          </name>
          <name>
            <surname>Mandic</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Omidi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Naef</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Suter</surname>
            <given-names>DM</given-names>
          </name>
        </person-group>
        <article-title>Memory and relatedness of transcriptional activity in mammalian cell lineages</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1208</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-09189-8</pub-id>
        <?supplied-pmid 30872573?>
        <pub-id pub-id-type="pmid">30872573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rückert</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Mashreghi</surname>
            <given-names>M-F</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>LS</given-names>
          </name>
          <name>
            <surname>Romagnani</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Clonal expansion and epigenetic inheritance of long-lasting NK cell memory</article-title>
        <source>Nat. Immunol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>1551</fpage>
        <lpage>1563</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-022-01327-7</pub-id>
        <?supplied-pmid 36289449?>
        <pub-id pub-id-type="pmid">36289449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Ntranos</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Tse</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Determining sequencing depth in a single-cell RNA-seq experiment</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Svensson, V., Da Veiga Beltrame, E. &amp; Pachter, L. Quantifying the tradeoff between sequencing depth and cell number in single-cell RNA-seq. <italic>bioRxiv</italic>10.1101/762773 (2019).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pollen</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Low-coverage single-cell mRNA sequencing reveals cellular heterogeneity and activated signaling pathways in developing cerebral cortex</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2967</pub-id>
        <?supplied-pmid 25086649?>
        <pub-id pub-id-type="pmid">25086649</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>LineageOT is a unified framework for tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Wang, K. et al. PhyloVelo enhances transcriptomic velocity field mapping using monotonically expressed genes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01887-5 (2023).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simeonov</surname>
            <given-names>KP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing of metastatic cancer reveals selection of hybrid EMT states</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1150</fpage>
        <lpage>1162</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.05.005</pub-id>
        <?supplied-pmid 34115987?>
        <pub-id pub-id-type="pmid">34115987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Bues, J. et al. Deterministic scRNA-seq captures variation in intestinal crypt and organoid composition. <italic>Nat. Methods</italic>10.1038/s41592-021-01391-1 (2022).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Janesick</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High resolution mapping of the tumor microenvironment using integrated single-cell, spatial and in situ analysis</article-title>
        <source>Nat. Commun</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>8353</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-43458-x</pub-id>
        <?supplied-pmid 38114474?>
        <pub-id pub-id-type="pmid">38114474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guvakova</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CDH2/N-cadherin and early diagnosis of invasion in patients with ductal carcinoma in situ</article-title>
        <source>Breast Cancer Res. Treat.</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>333</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1007/s10549-020-05797-x</pub-id>
        <?supplied-pmid 32683564?>
        <pub-id pub-id-type="pmid">32683564</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergen</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Lange</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Peidli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Generalizing RNA velocity to transient cell states through dynamical modeling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>1408</fpage>
        <lpage>1414</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0591-3</pub-id>
        <?supplied-pmid 32747759?>
        <pub-id pub-id-type="pmid">32747759</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saelens</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cannoodt</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Todorov</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A comparison of single-cell trajectory inference methods</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0071-9</pub-id>
        <?supplied-pmid 30936559?>
        <pub-id pub-id-type="pmid">30936559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eisele</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Erythropoietin directly remodels the clonal composition of murine hematopoietic multipotent progenitor cells</article-title>
        <source>Elife</source>
        <year>2022</year>
        <volume>11</volume>
        <fpage>e66922</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.66922</pub-id>
        <?supplied-pmid 35166672?>
        <pub-id pub-id-type="pmid">35166672</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nagaoka</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>E-Cadherin-Coated Plates Maintain Pluripotent ES Cells without Colony Formation</article-title>
        <source>PLoS ONE</source>
        <year>2006</year>
        <volume>1</volume>
        <fpage>e15</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0000015</pub-id>
        <?supplied-pmid 17183641?>
        <pub-id pub-id-type="pmid">17183641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Barcode-free prediction of cell lineages from scRNA-seq datasets. GEO, <italic>GSE226169</italic>10.1101/2022.09.20.508646 (2024).</mixed-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets. GEMLI v1.0.0. <italic>Zenodo</italic>, 10.5281/zenodo.10673334 (2024).</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based lineage prediction of cell lineages from scRNA-seq datasets. <italic>Zenodo</italic>10.5281/zenodo.10581737 (2024).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10980719</article-id>
    <article-id pub-id-type="pmid">38553478</article-id>
    <article-id pub-id-type="publisher-id">47158</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-024-47158-y</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8376-4089</contrib-id>
        <name>
          <surname>Eisele</surname>
          <given-names>A. S.</given-names>
        </name>
        <address>
          <email>almut.eisele@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0556-2531</contrib-id>
        <name>
          <surname>Tarbier</surname>
          <given-names>M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dormann</surname>
          <given-names>A. A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9415-788X</contrib-id>
        <name>
          <surname>Pelechano</surname>
          <given-names>V.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5644-4899</contrib-id>
        <name>
          <surname>Suter</surname>
          <given-names>D. M.</given-names>
        </name>
        <address>
          <email>david.suter@epfl.ch</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/02s376052</institution-id><institution-id institution-id-type="GRID">grid.5333.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2183 9049</institution-id><institution>Ecole Polytechnique Fédérale de Lausanne, School of Life Sciences, </institution><institution>Institute of Bioengineering, </institution></institution-wrap>Lausanne, Switzerland </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.465198.7</institution-id><institution>Science for Life Laboratory, Department of Microbiology, Tumor and Cell Biology, </institution><institution>Karolinska Institute, </institution></institution-wrap>Solna, Sweden </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>29</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>15</volume>
    <elocation-id>2744</elocation-id>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024, corrected publication 2024</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Assigning single cell transcriptomes to cellular lineage trees by lineage tracing has transformed our understanding of differentiation during development, regeneration, and disease. However, lineage tracing is technically demanding, often restricted in time-resolution, and most scRNA-seq datasets are devoid of lineage information. Here we introduce <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference (GEMLI), a computational tool allowing to robustly identify small to medium-sized cell lineages solely from scRNA-seq datasets. GEMLI allows to study heritable gene expression, to discriminate symmetric and asymmetric cell fate decisions and to reconstruct individual multicellular structures from pooled scRNA-seq datasets. In human breast cancer biopsies, GEMLI reveals previously unknown gene expression changes at the onset of cancer invasiveness. The universal applicability of GEMLI allows studying the role of small cell lineages in a wide range of physiological and pathological contexts, notably in vivo. GEMLI is available as an R package on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>).</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Combining experimental lineage tracing with single cell transcriptomics is technically demanding. Here, authors present GEMLI, a computational tool to annotate cell lineages in single cell RNA sequencing data solely based on gene expression.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Epigenetic memory</kwd>
      <kwd>Gene expression profiling</kwd>
      <kwd>Computational models</kwd>
      <kwd>Gene ontology</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100001711</institution-id>
            <institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung (Swiss National Science Foundation)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>CRSK-3_195097</award-id>
        <principal-award-recipient>
          <name>
            <surname>Suter</surname>
            <given-names>D. M.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">In multicellular organisms, each cell belongs to a lineage tree that determines its relatedness to other cells. Cell lineage relationships are of fundamental biological relevance as they directly impact a broad range of cellular behaviors, such as cancer resistance to drugs<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR7">7</xref></sup>, disease onset<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and differentiation in development, homeostasis, and regeneration<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR15">15</xref></sup>. Dissecting early gene expression changes that occur during cell fate switches is essential to understand the mechanistic bases of these processes. This requires to focus on small cell lineages in which cell fate decisions occur. While cellular characterization by scRNA-seq provides rich molecular information, it is intrinsically devoid of lineage information. Therefore, there is considerable interest in identifying cell lineages in scRNA-seq datasets.</p>
    <p id="Par4">The most widely used technique to assign individual transcriptomes to given lineages is cellular barcoding, which involves the introduction of heritable, expressed DNA barcodes in individual cells that can be retrieved in scRNA-seq data<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR19">19</xref></sup>. Other approaches involve hand-picking of related cells visualized by microscopy or microfluidic devices to compartmentalize cell lineages before scRNA-seq<sup><xref ref-type="bibr" rid="CR20">20</xref>–<xref ref-type="bibr" rid="CR25">25</xref></sup>. However, all these techniques suffer from important technical limitations such as the requirement for dedicated devices, extensive cell handling and/or culture, or genetic engineering.</p>
    <p id="Par5">Natural genetic marks such as mitochondrial mutations, copy number variants, and somatic mutations have been used to identify related cells in scRNA-seq datasets, mainly after enrichment for desired transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Still, the scarcity of spontaneously occurring genetic marks restricts their application to a fraction of cells that harbor these marks and to the identification of large cell lineages. These approaches are therefore not suited to analyze small and mid-sized lineages and poorly resolve branching points during divergent cell fate decisions. In particular, identifying close lineage relationships to study cell fate decisions in vivo and in human samples remains challenging.</p>
    <p id="Par6">Here, we quantitatively dissect the maintenance of gene expression in cell lineages for a broad range of cell types. We leverage genes with particularly stable expression over time to develop Gene Expression Memory-based Lineage Inference or GEMLI, a computational tool that allows identifying cell lineages related to several cell divisions based solely on scRNA-seq data.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Cells belonging to the same lineage tree are similar in their gene expression profiles</title>
      <p id="Par7">We analyzed the transcriptome-wide stability of gene expression over around 1-5 cell divisions using lineage-annotated scRNA-seq datasets of mouse embryonic stem cells (mESCs; Fig. <xref rid="MOESM1" ref-type="media">S1a–c</xref>), primary mouse embryonic fibroblasts (MEF)<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, primary mouse CD8+T-lymphocytes (CD8)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, lymphocytic leukemia cells (L1210)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, primary mouse hematopoietic stem and progenitor cells (HSPC; differentiating into &gt;10 mature cell types)<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup>, mouse hematopoietic stem cells (HSC) <sup>23</sup>, and human melanoma cells (WM989)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, grown for 2–14 days in various culture conditions (Supplementary Data File <xref rid="MOESM4" ref-type="media">1</xref> and Fig. <xref rid="MOESM1" ref-type="media">S1d, e</xref> for culture times, conditions and dataset sizes, over 120 datasets in total). Two datasets contained specifically sister cells, in all other datasets 2-cell lineages corresponded to random samples from larger lineages (Fig. <xref rid="MOESM1" ref-type="media">S1f–g</xref>). For all cell types analyzed, we observed a higher correlation (lower correlation distance) of the whole transcriptome for related cells as compared to randomly sampled cells (Fig. <xref rid="Fig1" ref-type="fig">1a, b</xref>). Related cells were also more similar in their transcriptomic velocity<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, complexity (number of expressed genes), and cell cycle phase (Fig. <xref rid="MOESM1" ref-type="media">S2a–g</xref>). Importantly, for differentiating HSPC, both lineages composed of a single cell type (symmetric) and lineages made of several cell types (asymmetric) were more similar in their transcriptome than random cells (Fig. <xref rid="Fig1" ref-type="fig">1c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S2h</xref>). To further determine the time spans of transcriptomic similarity persistence, we analyzed lineage-annotated data of MEF cultured for up to 30 days. Gene expression correlation of related cells remained high for extended timespans (&gt;20 days) (Fig. <xref rid="MOESM1" ref-type="media">S2i</xref>), in line with recent reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. In summary, both self-renewing and differentiating cells exhibit substantial gene expression memory over several cell generations.<fig id="Fig1"><label>Fig. 1</label><caption><title>Memory genes drive the transcriptomic similarity of related cells across cell types.</title><p><bold>a</bold> UMAP of the lineage-annotated mESC scRNA-seq dataset with 25 random colored lineages. <bold>b</bold> Boxplot of the correlation distance for related cells (blue), and randomly sampled cells (gray; 100 repetitions) in different cell types (<italic>n</italic> = 1 dataset for each cell type). <bold>c</bold> Boxplot as in <bold>b</bold> for lineages encompassing one single cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric, asym.) for one HSPC dataset. <bold>d</bold> Illustration of the temporal pattern of expression levels and variability of quantitative memory genes, qualitative memory genes, and non-memory genes across cell generations and lineages, respectively. <bold>e</bold> Percentage of expressed genes (gray) that are categorized as quantitative (green) and qualitative (blue) memory genes across cell types (<italic>n</italic> = 1 dataset for each). <bold>f</bold> Relation of CV<sup>2</sup> and mean gene expression in the mESC dataset. The different memory gene categories are colored as in <bold>e</bold>. <bold>g</bold> Mean gene expression for different memory gene categories and all genes across cell types as in (<bold>b</bold>; <italic>n</italic> = 7 datasets, qual=qualitative, quant=quantitative). <bold>h</bold> Same representation as in <bold>g</bold> for CV<sup>2</sup> of gene expression. <bold>i</bold> Memory genes as a percentage of expressed genes for lineages being composed of one cell type (symmetric; sym.) and lineages encompassing several cell types (asymmetric; asym) at day 4 of HSPC differentiation (<italic>n</italic> = 22 datasets). <bold>j</bold> The overlap between memory genes of day 2 and day 5–30 over the course of MEF reprogramming. Overlap is the percentage of the memory gene number at day 5–30, respectively (<italic>n</italic> = 2 dataset for each timepoint). Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig1_HTML" id="d33e449"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Gene expression memory increases gene expression variability in large cell populations</title>
      <p id="Par8">We next asked to which extent transcriptome similarity of small cell lineages impacts gene expression variability in the whole cell population. To do so, we fitted a linear model to compute the total variation for each gene from the variation across pooled lineages. We then used this model to estimate the total variation in a control dataset with permuted lineage labels, and compared the total variation of the real and the control datasets. We found that transcriptomic similarity of cell lineages had a substantial impact on gene expression variability in all cell types, in particular for highly expressed genes (Fig. <xref rid="MOESM1" ref-type="media">S3a</xref>), with the median standard deviation being on average 4.2% higher (+/– S.D. 3.3) overall transcripts and 19.1% higher (+/– S.D. 15) for highly abundant genes (Fig. <xref rid="MOESM1" ref-type="media">S3b</xref>). Therefore, while gene expression memory limits gene expression variability within small cell lineages, it is an important source of gene expression variability in large cell populations.</p>
    </sec>
    <sec id="Sec5">
      <title>Thousands of memory genes display stable gene expression levels through cell division</title>
      <p id="Par9">The transcriptomic correlation of closely related cells was driven by ca 20% of expressed genes (on average 3668 +/– S.D. 1131) with particularly stable gene expression levels across cell divisions, which we called memory genes (Fig. <xref rid="Fig1" ref-type="fig">1d, e</xref>). We defined memory genes as genes having a significantly higher (<italic>p</italic> &lt; =0.05) variability (coefficient of variation squared (CV<sup>2</sup>)) in their mean expression across cell lineages compared to random cell samples. Memory genes were only partly overlapping but shared characteristic expression distributions across datasets. Some memory genes were widely and highly expressed but showed very conserved expression levels within individual cell lineages (2286 +/– S.D. 890). Other memory genes were highly variable, and only expressed in a small number of cell lineages (1382 +/– S.D. 413). We named these quantitative and qualitative memory genes, respectively (Fig. <xref rid="Fig1" ref-type="fig">1f–h</xref>; Figs. <xref rid="MOESM1" ref-type="media">S4</xref> and <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM5" ref-type="media">2</xref>). Memory genes, and in particular quantitative memory genes, were enriched for housekeeping functions (Fig. <xref rid="MOESM1" ref-type="media">S5</xref> and Supplementary Data file <xref rid="MOESM6" ref-type="media">3</xref>). Memory genes were also present for lineages encompassing several cell types (Fig. <xref rid="Fig1" ref-type="fig">1i</xref>), highly shared across cell types within a culture condition (Fig. <xref rid="MOESM1" ref-type="media">S4f–g</xref>), and present over longer culture time spans (&gt;20 days; Fig. <xref rid="Fig1" ref-type="fig">1j</xref> and Fig. <xref rid="MOESM1" ref-type="media">S4h</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>GEMLI uses shared memory gene characteristics for de novo lineage predictions from scRNA-seq datasets</title>
      <p id="Par10">Based on the characteristic expression distributions of memory genes across cell types, we developed GEMLI (for <underline>G</underline>ene <underline>E</underline>xpression <underline>M</underline>emory-based <underline>L</underline>ineage <underline>I</underline>nference) to predict cell lineages related over several cell divisions de novo in scRNA-seq datasets (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). First, genes with a high expression mean and high variability (mean-corrected CV<sup>2</sup>) are selected. This highly enriches memory genes (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, for comparison to genes used in standard scRNA-seq analysis and optimization of gene selection see Figs. <xref rid="MOESM1" ref-type="media">S6 and 7</xref>; and Methods). Next, a custom repetitive, iterative hierarchical clustering allows estimating whether cells belong to the same lineage (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>; see Table <xref rid="MOESM1" ref-type="media">S1</xref> for the main conceptual differences between GEMLI and other clustering algorithms). Briefly, cells are clustered iteratively on random subsets of the selected genes until being assigned to a cluster of predefined size (lineage size parameter; default 2–3 cells). By repeating this clustering, every cell pair is assigned a level of confidence for belonging to the same lineage, based on the number of times it clusters together across individual predictions. Finally, a confidence level threshold is set to define multi-cellular lineages (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Importantly, lineages are not technically restricted in size and can be larger than the cluster size of 2–3 cells. When applying this approach to different datasets, the precision and sensitivity of small cell lineage predictions reached on average 80% +/– S.D. 15%, and 22% +/– S.D. 12%, respectively, at a confidence level of 50. The false positive rate (FPR) of predictions stayed consistently under 1% with an average of 0.07% +/– S.D. 0.08% at a confidence level of 50 (Fig. <xref rid="Fig2" ref-type="fig">2c–e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). GEMLI performed consistently better than other gene selection and lineage assignment strategies, including a k-nearest neighbor (kNN) clustering and the training of a neural network (Fig. <xref rid="MOESM1" ref-type="media">S7c, g</xref> and Fig. <xref rid="MOESM1" ref-type="media">S9</xref>). Crucially, as GEMLI allows to predict cell lineages for cells in which cellular barcoding fails, the number of lineage-annotated cells was either comparable or substantially increased as compared to barcode-based approaches (Fig. <xref rid="Fig2" ref-type="fig">2f</xref>). Changing prediction parameters, such as the fraction of genes sampled for each clustering (Fig. <xref rid="MOESM1" ref-type="media">S10</xref>), can further optimize precision at the expense of sensitivity or vice versa, depending on which measure is deemed more important for the downstream analysis. GEMLI allows the identification of both symmetric and asymmetric lineages, i.e., lineages in which cells belong to one or different cell types (Fig. <xref rid="Fig2" ref-type="fig">2g, h</xref> and Fig. <xref rid="MOESM1" ref-type="media">S11</xref>) and lineages of different sizes (Figs. <xref rid="MOESM1" ref-type="media">S12</xref> and <xref rid="MOESM1" ref-type="media">S13</xref>). Furthermore, lineage predictions were also possible over extended time spans at high precision but with a decreasing recovery, in line with a gradual decline of gene expression memory over time (Figs. <xref rid="MOESM1" ref-type="media">S14</xref> and <xref rid="MOESM1" ref-type="media">S4h</xref>; and Fig. <xref rid="Fig1" ref-type="fig">1j</xref>). GEMLI performed well for datasets within the recommended size and sequencing depth ranges. Notably, GEMLI performed well in datasets with a sequencing depth &gt;5000 reads/cell (all but the HSPC datasets; Fig. <xref rid="MOESM1" ref-type="media">S15</xref>)<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup>. Altogether, GEMLI allows for accurate prediction of cell lineages related over several cell divisions solely from scRNA-seq datasets.<fig id="Fig2"><label>Fig. 2</label><caption><title>GEMLI predicts cell lineages from gene expression within and across cell types.</title><p><bold>a</bold> Schematic of the GEMLI lineage prediction pipeline. <bold>b</bold> Fraction of memory genes selected based on variability and mean expression in the indicated cell types (<italic>n</italic> = 1 dataset for each). <bold>c</bold> Precision-sensitivity curves of lineage predictions in different cell types as in <bold>b</bold>. <bold>d</bold> Precision, sensitivity (left) and FPR (right) of lineage predictions at confidence level 50 for datasets as in (<bold>b</bold>; <italic>n</italic> = 7 datasets). <bold>e</bold> Correct and false (line color) predicted lineages with respect to the barcode lineages (fill color) at different confidence levels in the mESC dataset. A random subset of the lineage predictions is shown. <bold>f</bold> Pie chart of datasets colored according to the presence of barcode- (left) and GEMLI- (right) lineage annotation at a confidence level of 50 (<italic>n</italic> = 1 for each cell type). The number of recovered lineages is indicated. <bold>g</bold> Precision-sensitivity curve for predictions of lineages composed of one cell type (symmetric) or two cell types (asymmetric) in the HSPC (<italic>n</italic> = 44) and WM989 datasets (<italic>n</italic> = 8). Mean is represented. <bold>h</bold> Precision (left), sensitivity (middle), and FPR (right) of lineage predictions at confidence level 50 for symmetric (sym.) and asymmetric (asym.) lineages in the HSPC and WM989 datasets as in <bold>g</bold>. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig2_HTML" id="d33e653"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>GEMLI identifies memory gene categories, cell fate decisions, and associated gene expression programs</title>
      <p id="Par11">We then asked how reliably GEMLI identifies categories of genes displaying gene expression memory in small lineages. To do so, we compared memory genes and associated GO-terms from GEMLI predictions and ground truth lineage annotation and found them to be highly correlated for all datasets (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>; Fig. <xref rid="MOESM1" ref-type="media">S16a–c</xref> and Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>). Next, we tested the ability of GEMLI to identify symmetric vs. asymmetric cell fate decisions. In both WM989 melanoma cell and HSPC datasets (total of 52 datasets, low sequencing depth for HSPCs), the fraction of related cells among different symmetric and asymmetric cell pairs correlated well for GEMLI and barcode lineages (Fig. <xref rid="Fig3" ref-type="fig">3b, c</xref> and Fig. <xref rid="MOESM1" ref-type="media">S16d–j</xref>). The prevalence of related cells among drug-susceptible and -resistant melanoma cells, as well as 10 possible hematopoietic cell types could be distinguished. Also, differentially expressed genes (DEG) between asymmetric and symmetric cell type pairs were recovered well by analyzing GEMLI lineages (Fig. <xref rid="Fig3" ref-type="fig">3d, e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S17</xref>). In the HSPC data, DEG called between undifferentiated cells in symmetric undifferentiated and asymmetric undifferentiated-neutrophil cell pairs in the ground truth and predictions correlated highly (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>). In the WM989 cells, DEG analysis of GEMLI lineages identified genes specifically expressed in drug-susceptible cells being part of lineages with drug-susceptible and drug-resistant members, i.e., lineages in which cells recently switched to a resistant phenotype (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). While kNN performed similarly to GEMLI in identifying the prevalence of cell pairs, it performed less so for the recovery of correct DEGs (Figs. <xref rid="MOESM1" ref-type="media">S16i, j</xref> and  <xref rid="MOESM1" ref-type="media">S17a–d</xref>). For both analyses, GEMLI performed much better than random cell pair selections (Figs. <xref rid="MOESM1" ref-type="media">S16g, h</xref> and <xref rid="MOESM1" ref-type="media">S17a–f</xref>). In line with recent reports<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, a trajectory analysis did not recover asymmetric lineage-associated DEG (Fig. <xref rid="MOESM1" ref-type="media">S17g–j</xref>). This highlights the utility of GEMLI for downstream analyses that are commonly restricted to barcoded datasets, even in the case of datasets with a low sequencing depth.<fig id="Fig3"><label>Fig. 3</label><caption><title>GEMLI lineage predictions allow retrieving memory GO-terms and quantifying diverging cell-fate decisions.</title><p><bold>a</bold> Top 10 enriched GO-terms in memory genes called on barcode or predicted lineages (pred.) at confidence level 30 in different cell types (<italic>n</italic> = 1 dataset each). All terms that are among the top 10 in any cell type are shown. Spearman rank correlation is indicated. Proc.=process. <bold>b</bold> SPRING graph of HSPC datasets (<italic>n</italic> = 44) annotated by cell types (top), highlighting ground truth undifferentiated symmetric (beige) and undifferentiated-neutrophil asymmetric (pink) lineages (middle), or highlighting undifferentiated-neutrophil asymmetric lineage predictions at confidence level 70 (bottom). <bold>c</bold> The number (sum) of cell pairs in the barcode (top right) and predicted (bottom left) cell lineages in all cell type combinations in the HSPC datasets as in <bold>b</bold>. <bold>d</bold> Average log2 fold-change for DEG called between barcode and predicted undifferentiated cells in symmetric and asymmetric cell lineages in one day 4 HSPC dataset. Dots represent DEGs. Spearman rank correlation is given. The 20 highest and 10 lowest enriched genes are named. Gray: undifferentiated, blue: neutrophil. <bold>e</bold> Average log2 fold-change for DEG called between barcode and predicted drug-susceptible cells in symmetric and asymmetric cell lineages across WM989 datasets (<italic>n</italic> = 8). Green: drug-resistant, blue: drug-susceptible. A confidence level of predictions in <bold>c</bold>–<bold>e</bold> is 50. For the full spelling of abbreviated cell type names mentioned in panels <bold>b</bold>, <bold>c</bold>, see Methods. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig3_HTML" id="d33e766"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>GEMLI predicts lineages in lung metastases of pancreatic cancer</title>
      <p id="Par12">Next, we tested whether GEMLI could identify small and mid-sized lineages in vivo. We used data from mouse pancreatic cancer lung metastases, which have been traced through evolvable CRISPR barcoding over a short timespan<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. As barcodes here had only four weeks to evolve, CRISPR editing frequency of barcodes is high and the lung metastases develop late, this ground-truth data is suitable for comparison with GEMLI predictions. At a confidence level of 80, GEMLI reached 100% precision while assigning more cells to lineages than the barcoding data (Fig. <xref rid="Fig4" ref-type="fig">4a–c</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>GEMLI correctly assigns cells to individual metastases, crypts, and mitochondrial variant-defined lineages in vivo.</title><p><bold>a</bold> Scheme of GEMLI lung metastasis predictions. <bold>b</bold> Precision (line) and sensitivity (dotted line) as a function of confidence level for GEMLI predictions in lung metastases of two mice tested against the CRISPR barcode lineage information. Line: mean; Shade: S.D. <bold>c</bold> Pie chart of the lung metastases data of two mice (M1, M2) as in <bold>b</bold> colored according to the presence of CRISPR barcode- (left) and GEMLI- lineage annotation at a confidence level of 50 (middle) and 80 (right). The number of recovered lineages is indicated. Conf=confidence level. <bold>d</bold> Schematic of GEMLI crypt predictions. <bold>e</bold> Percentage of cells predicted as individual lineages for each crypt in the crypt dataset (<italic>n</italic> = 1) at confidence level 70. <bold>f</bold> Predictions of crypts at confidence level 70. <bold>g</bold> Precision-sensitivity curve for predictions in the crypt dataset. <bold>h</bold> Precision-sensitivity curve for predictions of cell pairs composed of one cell type (symmetric) or two cell types (asymmetric) in the crypt dataset. <bold>i</bold> The percentage of cells (size) belonging to the indicated cell type (color) for individual crypts (top) and for predicted lineages at confidence level 50 (bottom) aligned to their crypt of origin. <bold>j</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages (<italic>n</italic> = 3 datasets). Line: mean; Shade: S.D. <bold>k</bold> Precision-sensitivity curves of lineage predictions in K562 cells (<italic>n</italic> = 1 dataset) as in <bold>j</bold>. <bold>l</bold> Precision-sensitivity curves of lineage predictions in bone marrow cells using mitochondrial variants as ground truth lineages as in <bold>j</bold> with lineage size parameters up to the maximal ground truth lineage size. Line: mean; Shades: S.D. All crypt predictions are of 5-40 cells and were run with a lineage size parameter of 2–40. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig4_HTML" id="d33e841"/></fig></p>
    </sec>
    <sec id="Sec9">
      <title>GEMLI assigns cells to individual in vivo-derived crypts and organoids</title>
      <p id="Par13">Further, we tested GEMLIs ability to reconstruct in vivo and in vitro-derived multicellular structures that originate from a single or few stem cells using scRNA-seq data of intestinal organoids and crypts, for which the individual structure of origin (crypt or organoid) is known for each cell (ref. <sup><xref ref-type="bibr" rid="CR43">43</xref></sup>, Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). We ran GEMLI on the pooled scRNA-seq datasets and analyzed whether inferred lineages fall within individual crypts and organoids. GEMLI resulted in high percentages of cells correctly assigned to their crypt or organoid of origin with default lineage size parameters and parameters in the ground truth lineage size range, allowing the recovery of mid-sized lineages (Fig. <xref rid="Fig4" ref-type="fig">4d–g</xref>; Figs. <xref rid="MOESM1" ref-type="media">S12a, d</xref> and <xref rid="MOESM1" ref-type="media">S18</xref> for organoids). As ground truth lineage sizes might be unknown when applying GEMLI, we tested the stability of predictions for different lineage size parameters. Taking the maximal ground truth lineage size as the upper lineage size parameter value coincided with a maximal cluster stability of predictions, allowing us to estimate the size distribution of crypts and organoids de novo (Fig. <xref rid="MOESM1" ref-type="media">S19</xref>). GEMLI predictions allowed highly reliable inference of the cell type composition of individual structures by identifying both symmetric and asymmetric cell pairs (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref> and Fig. <xref rid="MOESM1" ref-type="media">S20</xref>). This demonstrates that GEMLI can recover the cellular composition of individuals in vivo and in vitro segregated mid-sized multicellular structures from pooled datasets.</p>
    </sec>
    <sec id="Sec10">
      <title>GEMLI can be combined with other lineage-tracing approaches</title>
      <p id="Par14">We next combined GEMLI with lineage inference based on mitochondrial variants to study lineages at broader time scales. Mitochondrial variants allow identifying cell lineages in 3’ scRNA-seq datasets after enrichment of mitochondrial transcripts<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. The scarce occurrence of mitochondrial mutations however restricts this approach to the assignment of cells to large lineages, i.e., cells related over long time spans (weeks to months). We tested if GEMLI could refine lineage trees inferred from mitochondrial variants on datasets of primary human bone marrow cells and K562 myelogenous leukemia cells<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. Importantly, in these experiments only a small sample from a large population was sequenced, resulting in the loss of a large fraction of cells from small lineages and thus inherently limiting their identification. Nevertheless, GEMLI recovered small cell lineages in all datasets and these fell with high precision within the large mitochondrial-variant inferred lineages (Fig. <xref rid="Fig4" ref-type="fig">4j, k</xref>). The precision stayed also high for predictions up to the maximal size of the mitochondrial-variant inferred lineages, confirming GEMLIs utility in refining lineage trees obtained with other techniques (Fig. <xref rid="Fig4" ref-type="fig">4l</xref>).</p>
    </sec>
    <sec id="Sec11">
      <title>GEMLI characterizes gene expression memory in human breast cancer</title>
      <p id="Par15">Next, we applied GEMLI to a primary human breast cancer tissue sample dataset<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, in which other lineage tracing approaches (such as cellular barcoding) cannot be applied or would only call large lineages (mitochondrial-variant-based lineage inference). The dataset was generated from formalin-fixed, paraffin-embedded breast cancer tissue and encompasses scRNA-seq (31,364 expressed genes) and Xenium in situ sequencing data (313 genes) of serial sections<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. We assigned 10 cell types identified in the Xenium data to the scRNA-seq data using supervised machine learning (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>), and applied GEMLI to ductal carcinoma in situ (DCIS) and invasive tumor cells separately (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>). Prediction stability for DCIS cells suggested lineage sizes up to 50 cells, in line with their nodule character and size in the spatial data, and resembled the multicellular crypt or organoid profiles (Fig. <xref rid="Fig5" ref-type="fig">5a</xref> and Fig. <xref rid="MOESM1" ref-type="media">S21</xref>, size considering 2,3% recovery of DCIS cells in scRNA-seq). In contrast, cluster stability of predicted invasive tumor cell lineages was more similar to cultured cells without a clear spatial organization (Fig. <xref rid="MOESM1" ref-type="media">S21a</xref>). Memory genes called on predicted DCIS and invasive tumor cell lineages (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>) were characterized by distinct GO terms, such as response to estrogen or cell-substrate adhesion, respectively (Fig. <xref rid="MOESM1" ref-type="media">S22a</xref>). Memory genes for which Xenium in situ data was available showed visible patches of similar gene expression, in line with lineage-specific expression (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Crucially, the spatial distribution of highly variable, non-memory genes was characterized by a “salt and pepper” aspect (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>), in line with both gene groups only partly overlapping (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>GEMLI predictions identify lineages in breast cancer nodules.</title><p><bold>a</bold> Breast cancer Xenium in situ sequencing map colored by cell type. <bold>b</bold> A random subset of predicted lineages within the DCIS cells of the breast cancer scRNA-seq dataset at confidence level 50. <bold>c</bold> Percentage of expressed genes categorized as quantitative (quant.) and qualitative (qual.) memory genes in the breast cancer scRNA-seq dataset as in <bold>b</bold>. <bold>d</bold> In situ map of breast cancer Xenium data for ESR1 and SCD expression which are memory genes in DCIS and invasive tumor lineages respectively. <bold>e</bold> Maps as in <bold>d</bold> for two variable genes. <bold>f</bold> Overlap of memory and variable genes in the breast cancer scRNA-seq dataset. All predictions in b-e are with lineage size parameters of 2–20 cells. The invasive tumor is abbreviated as the inv tumor in all panels. In <bold>a</bold> T-cell dendr. = T-cell dendritic cell and Myoepithel. = Myoepithelial cell. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig5_HTML" id="d33e969"/></fig></p>
    </sec>
    <sec id="Sec12">
      <title>GEMLI allows identifying early stages of progression to invasive cancer in vivo</title>
      <p id="Par16">Finally, we applied GEMLI to predict lineages on the whole breast cancer scRNA-seq dataset to study progression towards invasiveness. While most GEMLI lineages were confined within one cell type or shared with apoptotic cells, GEMLI also predicted lineages with both DCIS and invasive tumor cell members (Fig. <xref rid="Fig6" ref-type="fig">6a, b</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22b, c</xref>, around 10% of cancer cell lineages). We hypothesized that these asymmetric lineages contained cells that recently switched to an invasive phenotype. We analyzed genes characterizing these lineages by calling DEG on DCIS cells within asymmetric and symmetric lineages, as well as DEG between lineage types of later stages in cancer progression (Fig. <xref rid="Fig6" ref-type="fig">6c, d</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22d</xref>). Genes enriched in DCIS cells from asymmetric lineages included known markers of cancer invasiveness such as <italic>CDH2</italic><sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, but also genes with unknown roles in cancer progression, such as <italic>DCAF7</italic> and <italic>LINC01999</italic> (Fig. <xref rid="Fig6" ref-type="fig">6d</xref>). While, e.g., <italic>DCAF7</italic> and <italic>CDH2</italic> displayed continuous changes across lineage types occurring during cancer progression, others such as <italic>TCIM</italic> or <italic>BRIP1</italic> were expressed transiently at higher levels in asymmetric or only in symmetric (i.e., only invasive tumor cell) lineages, respectively (Fig. <xref rid="Fig6" ref-type="fig">6e</xref> and Fig. <xref rid="MOESM1" ref-type="media">S22e</xref>). This demonstrates the unique ability of GEMLI in dissecting lineage identities and gene expression changes in specific lineage types occurring during the progression of human tumors towards invasiveness.<fig id="Fig6"><label>Fig. 6</label><caption><title>GEMLI identifies breast cancer cells in lineages switching to an invasive phenotype.</title><p><bold>a</bold> A subset of predicted lineages with respect to cell type annotation at confidence level 50 in the breast cancer scRNA-seq dataset. Gray and red lines indicate lineage relationships within one or across several cell types, respectively. <bold>b</bold> Number of DCIS and invasive tumor lineages with members belonging to other cell types for lineage predictions as in <bold>a</bold>. <bold>c</bold> Scheme of lineage cell type identities occurring during breast cancer progression towards invasiveness (green: DCIS, blue: invasive tumor). <bold>d</bold> Volcano plots for DEG called between DCIS and invasive tumor cells predicted to be part of symmetric and asymmetric (asym.) cell lineages in the breast cancer scRNA-seq dataset as indicated. The top 9 highest and lowest enriched genes are named. Predictions at confidence level 50. The <italic>p</italic>-value indicated was generated by Seurats FindMarker function based on a Wilcoxon Rank Sum Test. <bold>e</bold> Expression of selected DEG as in <bold>d</bold> across DCIS and invasive tumor cells part of symmetric and asymmetric (asym.) lineages as indicated. All predictions are with lineage size parameters of 2–20 cells. Invasive tumor is abbreviated as ‘inv tumor’ or ‘inv tu’ in all panels. Arb. units = arbitrary units. Boxes: intervals between the 25th and 75th percentile and median (horizontal line). Error bars: 1.5-fold the interquartile range or the closest data point when no data point is outside this range. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2024_47158_Fig6_HTML" id="d33e1053"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec13" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par17">GEMLI allows predicting small to medium-sized cell lineages related over several generations solely from scRNA-seq datasets, based on genes that maintain their expression level through cell divisions. This is a shift away from experimental lineage tracing techniques based on genetic marks or physical cell lineage separation and extends lineage annotations of small and medium-sized lineages to in vivo settings.</p>
    <p id="Par18">GEMLI is applicable to any scRNA-seq dataset and requires only exonic reads. This alleviates the need for experimental lineage assignment procedures implemented prior to sequencing and thereby expands lineage annotation to contexts where cellular barcoding or other lineage assignment approaches are challenging or prohibitive, such as primary cells or human biopsies. It also avoids cellular stress caused by cell picking or genetic engineering required for manual and cellular-barcoding-based lineage tracing, respectively. GEMLI is particularly promising for its ability to identify small lineages in which cells are related over about 1-5 cell divisions. However, GEMLI will generally perform less robustly in cell populations that contain only distantly related cells. Some systems might allow for a longer gene-expression memory-based lineage tracing<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>. While GEMLI performed well on intestinal organoids that are highly variable in size, we cannot exclude that large variability in growth rates between lineages may decrease its performance.</p>
    <p id="Par19">We show that in line with individual reports<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR35">35</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>, gene expression memory is present in various cell types and populations in both self-renewal and differentiation conditions. GEMLI is therefore applicable to all cells of a scRNA-seq dataset, in contrast to cellular barcoding-based approaches which are limited to cells that (i) express the barcode and (ii) for which the barcode is recovered. GEMLI thus allows to recovery of a comparable or higher number of lineages than in public cellular barcoding scRNA-seq datasets. GEMLI also compares favorably to cell-picking approaches, which are difficult to scale up and therefore mostly encompass small cell numbers<sup><xref ref-type="bibr" rid="CR21">21</xref>,<xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR25">25</xref></sup>.</p>
    <p id="Par20">Lineage inference approaches based on naturally occurring genetic marks can identify lineages over time spans of weeks or months but require high coverage and sequencing depths or the enrichment of specific transcripts<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR32">32</xref></sup>. Trajectory inference algorithms can predict gene expression changes on the order of hours but do not predict lineages<sup><xref ref-type="bibr" rid="CR34">34</xref>,<xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. GEMLI thus fills a methodological gap and shall become a powerful tool to refine lineage trees in combination with other lineage tracing approaches.</p>
    <p id="Par21">With its resolution at the scale of several cell divisions, GEMLI is ideally suited to assess cell fate decisions during differentiation, response to stimulus, homeostasis, and regeneration, and allows correctly assigning a broad diversity of cell types to individual complex structures such as intestinal crypts and organoids. In these cases, the physical proximity of lineage-related cells allows the sharing of a similar microenvironment, which may further increase GEMLIs performance. GEMLI is therefore promising to reconstruct other structures emerging from a common ancestor or a small pool of stem cells, such as glands or spatially restricted areas of the skin. In the context of human breast cancer, we illustrate GEMLIs applications by identifying DCIS nodules, as well as determining previously unknown gene expression changes in lineages encompassing cells at the transition towards an invasive phenotype. Altogether, GEMLI opens new perspectives in interrogating the impact of close lineage relationships in a broad range of biological contexts in vivo.</p>
  </sec>
  <sec id="Sec14">
    <title>Methods</title>
    <sec id="Sec15">
      <title>Cell culture</title>
      <p id="Par22">CGR8 ES cells (Sigma, Cat307032901-1VL) were routinely cultured at 37 °C and 5% CO<sub>2</sub> on 10 cm dishes coated with 0.1% gelatin type B (Sigma, Cat#G9391-100G) in 10 ml GMEM (Sigma, Cat#G5154‐500 ML) supplemented with 10% ES cell‐qualified fetal bovine serum (Gibco, Cat#16141‐079), 1% nonessential amino acids (Gibco, Cat#11140‐050), 2 mM l‐glutamine (Gibco, Cat#25030‐024) and sodium pyruvate (Sigma, Cat#S8636‐100 ML), 100 μM 2‐mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), 1% penicillin and streptomycin (Pen/Strep) (BioConcept, Cat#4‐01F00‐H), homemade leukemia inhibitory factor (LIF), CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat#PZ0181‐25MG) at 0.8 μM. Cells were passaged by trypsinization (2 ml of trypsin, Sigma, Cat#T4049‐100 ML) every 2–3 days at a ratio of 1:10. For scRNA-seq experiments, cells were switched to N2B27 + 2i/LIF medium 2 passages beforehand. N2B27 + 2i/LIF medium was composed of a 1:1 mix of DMEM/F12 (Gibco, Cat#11320‐033) and Neurobasal medium (Gibco, Cat#21103‐049), supplemented with N2 (Gibco, Cat#17502‐001), B27 (Gibco, Cat#17504‐001), 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H), 2 mM L-glutamine (Gibco, Cat#25030‐024), 100 μM 2-mercaptoethanol (Sigma, Cat#63689‐25 ML‐F), LIF, CHIR99021 (Merck, Cat#361559‐5MG) at 3 μM and PD184352 (Sigma, Cat# PZ0181‐25MG) at 0.8 μM. Cells were split every 2–3 days at a ratio of 1:10, using 2 ml of accutase (Innovative Cell Technologies, Cat#31195) and centrifugation. HEK293T cells were routinely cultured at 37 °C and 5% CO<sub>2</sub> on dishes in DMEM high glucose medium (Gibco, Cat#41966) supplemented with 10% Fetal bovine serum (Life Technologies, Cat#10270-106) and 1% Pen/Strep (BioConcept, Cat#4‐01F00‐H).</p>
    </sec>
    <sec id="Sec16">
      <title>Lentiviral barcoding library production</title>
      <p id="Par23">The LARRY lentiviral barcoding library<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was purchased from Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>). The barcodes of the library are composed of 40 base pairs (bp) with 28 random bp separated by 6 fixed bp doublets and are located in the 3’ untranslated region of <italic>EGFP</italic> expressed from the <italic>EF-1ɑ</italic> promoter. The library was amplified and the lentiviral vector was produced according to the associated protocol with small modifications. Briefly, plasmids were introduced into ElectroMAX Stbl4 Competent Cells (Life technologies, Cat#11635018) using MicroPulser Electroporator (Bio-Rad, Cat#1652100) EcoRI program. Cells were incubated for 1 h at 37 °C and spread over 20 large (24.5 × 14.5 cm) Agar+Ampicillin plates (Ampicillin at 100 ug/ml, AppliChem, Cat# A08390025). After 24 h, colonies were harvested through scraping using pre-warmed LB medium supplemented with 100 ug/ml Ampicillin. The resulting 1.5 L bacterial culture was incubated at 37 °C for 2 h and a Maxiprep was performed using a Qiagen MaxiPlus kit (Qiagen, Cat#12963) to a resulting 1 mg of plasmid DNA. A lentiviral vector was produced by transforming the produced LARRY plasmid into HEK293T cells using the Trans-IT 293 transfection reagent (Mirus, Cat#MIR2700). For each of eighteen 10 cm dishes of HEK293T cells, 1.5 ml Opti-MEM (Gibco, Cat#51935), 16 μg plasmid (8 μg LARRY plasmid, 6 μg psPAX2 (Addgene, PRID: Addgene_12260), 2 μg pMD2.G (Addgene, PRID: Addgene_12259)) were mixed with 45 μl TransIT 293 transfection reagent, incubated for 15-30 min at RT, and added to the cells dropwise. Lentiviral vector particles were harvested 48 h and 72 h after transfection. Medium was collected and filtered through a 0.45 μm PVDF filter (Millipore, Cat#SLHV033RS), and centrifuged in a Beckman Optima XL-80K Ultracentrifuge (Beckman, Cat#8043-30-1211) at 140,000 × <italic>g</italic> for 1h 30 min at 4 °C. The supernatant was removed, and pellets were resuspended with 100 μl of GMEM with serum and all additives as above but without 2i/LIF. The lentiviral vector preparation was incubated on ice for 30 min, aliquoted, and stored at –80 °C. Titration of the lentiviral barcoding library was performed on CGR8 cells cultured in GMEM+2i/LIF, with a read-out 5 days after infection.</p>
    </sec>
    <sec id="Sec17">
      <title>Barcode reference library generation</title>
      <p id="Par24">A reference library was made through the sequencing of PCR-amplified barcodes from the LARRY plasmid library in triplicates. 500 ng of LARRY plasmids were taken as input for a two-step PCR using Phusion high-fidelity DNA polymerase (Thermo Fisher, Cat#F-5305) adapted for LARRY from ref. <sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. The first step amplifies the barcodes and adds Illumina Read1 and Read2 sequences (5’ACACTCTTTCCCTACACG ACGCTCTTCCGATCTTGTGACGTCACAGGTCGACACCAGTCTCATT3′ and 5’GTGACTGGAGTTCAG ACGTGTGCTCTTCCGATCGAGTAACCGTTGCTAGGAGAGACCATA3′). The second step adds the P5 and P7 flow cell attachment sequences and a sample index of 7 bp (P5 5’AATGATA CGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT3′ and P7 5’CAAGCAGA</p>
      <p id="Par25">AGACGGCATACGAGANNNNNNNGTGACTGGAGTTCAGACGTGCTCTTCCGATC3′). 200 ng of PCR1 product was taken as input for PCR2. (PCR programs: 98 °C 2 min, 15 cycles of 98 °C 10 s, 67.2 °C (PCR1), 72 °C (PCR2) 30 s, 72 °C 30 s, followed by final elongation 72 °C 5 min and 4 °C indefinitely). In between PCR1 and PCR2 and after PCR2, PCR purification was performed using the QIAquick PCR purification kit (Qiagen, Cat#28106). The mix of the three samples was sequenced on a MiSeq instrument (Illumina) at the Gene Expression Core Facility of EPFL. Sequencing results were first filtered for a perfect match to the plate index pattern using XCALIBR (<ext-link ext-link-type="uri" xlink:href="https://github.com/NKI-GCF/xcalibr">https://github.com/NKI-GCF/xcalibr</ext-link><underline>)</underline>. The resulting read files were filtered for a perfect match to the barcode pattern using customized R scripts. The resulting list and the LARRY “barcode_list” available on Addgene (<ext-link ext-link-type="uri" xlink:href="https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/">https://www.addgene.org/pooled-library/camargo-plarry-egfp-barcoding-v1/</ext-link>) were merged and used as a reference list.</p>
    </sec>
    <sec id="Sec18">
      <title>mESCs scRNA-seq memory experiment run</title>
      <p id="Par26">CGR8 cells were transduced with 3 ul of the lentiviral LARRY barcoding library per 10 cm dish with 10 ml medium to obtain roughly 1% of GFP<sup>+</sup> cells. 72 h after infection, live GFP<sup>+</sup> cells (Fig. <xref rid="MOESM1" ref-type="media">S1a</xref>; live stain 1:500 propidium iodide solution (BioLegend, Cat#421301)) were sorted on an FACSAria III (BD) at the Flow Cytometry Core Facility of EPFL into Cellcarrier 96-Ultra 96-well plates (PerkinElmer, Cat#6055308). Plates were coated with recombinant human E-cadherin-Fc chimera (BioLegend, Cat#BLG-779904-25ug) to reduce colony formation and thereby limit the potential impact of paracrine and direct cell signaling in regulating gene expression of related cells<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. Coating was performed at 10 μg/ml for 1 h at 37 °C. After washing the plates with PBS, 1,200 cells were sorted into two wells and both were collected after 48 h for sequencing. Before collection, cells were imaged on an IN Cell analyzer 2200 (GE Healthcare) at the Biomolecular Screening facility of EPFL. ScRNA-seq library preparation was performed on a 10X Genomics Chromium platform of the Gene Expression Core Facility of EPFL using the SingleCell 3’ Reagent Kit v3.1. The sample was sequenced on a Hiseq4000 instrument (Illumina). The experiment was performed once.</p>
    </sec>
    <sec id="Sec19">
      <title>mESC scRNA-seq data processing and cell lineage inference</title>
      <p id="Par27">ScRNA-seq data was analyzed using 10X Genomics Cell Ranger (v. 5.0.1), Seurat (v. 4.1.0), customized R (v. 4.0.2), and Python (v. 3.9.7) scripts. Raw sequencing reads were processed using 10X Genomics Cell Ranger (v. 5.0.1) using default parameters and refdata-gex-mm10-2020-A as reference genome, with or without the <italic>include-introns</italic> option. Cell Ranger outputs a unique molecular identifier (UMI) corrected read count matrix. Cells with a percentage of mitochondrial reads between 1.75 and 7.5 and with more than 10,000 reads were further analyzed. Data was normalized to 40,000 reads per cell (similar to RPM, one normalized count equals one read on median). Lineage barcodes were extracted from the data using the CellTag pipeline<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> available for download at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>) and adapted to the LARRY barcode design. Briefly, the CellTag pipeline extracts reads containing a CellTag motif from the processed, filtered, and unmapped reads BAM files produced in intermediate steps of the 10X Genomics Cell Ranger pipeline. To extract LARRY barcodes, the CellTag motif was changed to “([ACTG]{4}TG[ACTG]{4}CA[ACTG]{4}AC[ACTG]{4}GA[ACTG]{4}GT [ACTG]{4}</p>
      <p id="Par28">AG[ACTG] {4})” in all scripts. Barcodes with reads from only one UMI, and without perfect match to the reference library were filtered out. A Jaccard similarity score of &gt;0.7 was used to identify cell lineages. No filtering on the number of barcodes expressed per cell was performed. Lineages were called on unfiltered data. For the mESC dataset, 6 lineages had sizes above 5 cells, which is larger than expected based on cell cluster sizes after 48 h of culture and the expected loss of cell lineage members in the preparation for scRNA-seq. They were therefore excluded from further analysis.</p>
    </sec>
    <sec id="Sec20">
      <title>Processing of public scRNA-seq data</title>
      <p id="Par29">Data from Biddy et al.<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> was extracted as a BAM file from SRA links specified under <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>. BAM files were converted back to fastq format using 10X Genomics’ bamtofastq (v. 1.3.2) and Cell Ranger (v. 5.0.1) was run on the resulting data as described above with or without the <italic>include-introns</italic> option. Cells were filtered on the percentage of mitochondrial reads and the number of reads as indicated in Table <xref rid="MOESM1" ref-type="media">S2</xref>. Data was normalized to 40,000 reads per cell. Cell lineages were assigned using the CellTag pipeline as specified above with the original CellTag motif of “(GGT([ACTG]{8})GAATTC)”(V1), “(GTGATG([ACTG]{8})GAATTC)”(V2) or “(TGTACG([ACTG]{8})GAATTC)”(V3) and the respective whitelists and sample-specific cell barcodes available at (<ext-link ext-link-type="uri" xlink:href="https://github.com/morris-lab/BiddyetalWorkflow">https://github.com/morris-lab/BiddyetalWorkflow</ext-link>). As in the original publication, cells with &gt;20 or &lt;2 CellTags expressed were not considered for lineage assignment. Lineages were called on unfiltered data using a Jaccard similarity score of &gt;0.7. Cell lineages were called on individual datasets for all analyses of a single time point. Data from Kimmerling et al.<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> is GSE74923_L1210_CD8_processed_data.txt from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GEO</ext-link>. Ground truth cell lineage information was extracted from the GSE74923_series_matrix.txt file. Data from Weinreb et al.<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> was downloaded from (<ext-link ext-link-type="uri" xlink:href="https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md">https://github.com/AllonKleinLab/paper-data/blob/master/Lineage_tracing_on_transcriptional_landscapes_links_state_to_fate_during_differentiation/README.md</ext-link>). Data from Jindal et al. was directly obtained from the authors in the form of Seurat objects including the unnormalized but filtered count matrix and a metadata file comprising the lineage information. All datasets were RPM normalized to 40,000 reads/cell. Data from Wehling et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> was directly obtained from the authors in the form of an unnormalized count matrix and the metadata file (available on GEO GSE167317 asGSE167317_CountMatrix_Seq5.csv, GSE167317_CountMatrix_Seq4.csv, GSE167317_Metadata_Seq5.csv, GSE167317_Metadata_Seq4.csv). Cells with under 100,000 reads were removed and data was normalized to 40,000 reads per cell. Lineage information was extracted from the metadata file. Data from Harmange et al. was downloaded from <ext-link ext-link-type="uri" xlink:href="https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing">https://drive.google.com/drive/folders/1-C78090Z43w5kGb1ZW8pXgysjha35jlU?usp=sharing</ext-link> (accessed begin July 2022) in the form of 10×1_Filterd_BatchCor_unnorm_sctrans.rds from experiment one. Lineages were assigned using the corresponding script section in the file 10×1_r1_r2_Analysis_unorm_sctrans.Rmd. During filtering, cells with &lt;3% of mitochondrial reads, and cells with &lt;4000 reads were removed. Data was normalized to 40,000 reads/cell. Data from Simeonov et al.<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> was obtained in the form of CellRanger output files for the lung metastasis scRNA-seq data of mouse 1 and 2 from GEO (GSE173958; GSM5283486 and GSM5283491). scRNA-seq data was normalized to 40,000 reads/cell. Lineage annotation was obtained from Mendeley data (DOI: 10.17632/t98pjcd7t6.1) in the form of “Barcodes-of-barcodes” files for all clones. This metadata was then filtered for the annotations of clones present in the scRNA-seq datasets of the lung metastases of mouse 1 and 2. Data from Bues et al.,<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> was directly obtained from the authors in the form of a Seurat Object including a normalized count matrix with crypt and organoid annotation. Briefly, organoids were generated by sorting single Lgr5<sup>+</sup> intestinal stem cells from dissociated organoids into a Matrigel matrix. After culture for 3, 4, 5, or 6 days, single organoids were hand-picked and dissociated individually before loading for scRNA-seq. Organoids are derived from 3 batches. Lgr5<sup>+</sup> intestinal stem cells seeded can be derived from the same organoid. Crypts were collected over 5 batches of 3 pooled mice from 10 mm sections of the ileum. Crypts within the same batch can be derived from the same mouse but were several mm apart in the ileum. Data and scripts from Miller et al.<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/vangalenlab/MAESTER-2021">https://github.com/vangalenlab/MAESTER-2021</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://vangalenlab.bwh.harvard.edu/resources/maester-2021/">https://vangalenlab.bwh.harvard.edu/resources/maester-2021/</ext-link> as TenX_CellLineMix_cells.rds, TenX_CellLineMix_All_mr3_maegatk.rds, TenX_CellLineMix_Seurat_Keep.rds (for the K562 dataset) and BPDCN712_Maegatk_Final.rds, BPDCN712_Seurat_Final.rds, 4.2_vois.txt (for the primary human bone marrow cells). Lineage assignment was performed as in the scripts 3.4_TenX_K562_clones.R and 4.3_variants_Of_Interest.R for K562 and bone marrow cells respectively. “GroupIDs” were then unlisted to extract the cell-barcode lineage correspondence. The count-matrix for the K562 dataset was extracted from the TenX_CellLine_Mix Seurat object by filtering for K562 cells. For the primary bone marrow cells, the BPDCN712 Seurat object was split out by replicate to generate the GEMLI input count matrices. For both cell types, lineages were filtered to be defined by a single informative mitochondrial variant. Data from Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast">https://www.10xgenomics.com/products/xenium-in-situ/preview-dataset-human-breast</ext-link>. The scRNA-seq dataset was filtered to a &gt; 1000 reads/cell and a mitochondrial fraction of 1-50%. Cell types were annotated through supervised machine learning. In brief, a UMAP was built upon a linear discriminant analysis (LDA; R package ‘MASS’ (v. 7.3-58.3) performed on log molecule numbers) which in turn was based on provided cluster annotations for Xenium data in situ sequencing data. Single-cell RNA-seq Chromium data was then projected onto this LDA-UMAP to assign cell types. Assignments were specific and unique. Finally, each cluster was assigned its cell type annotation through the assessment of marker genes provided in Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>.</p>
    </sec>
    <sec id="Sec21">
      <title>ScRNA-seq data representation</title>
      <p id="Par30">ScRNA-seq data is represented as tSNE, UMAP, or SPRING graph. tSNE embeddings were generated using a custom function based on the tSNE R package (v. 0.1-3.1) on exonic, or both intronic and exonic reads. PCA was calculated on the 3,000 top variable expressed genes. Subsequently, a tSNE was computed on the PCAs top 10 components. SPRING graphs were generated from precalculated values in public datasets (HSPC data was represented as SPRING graph)). UMAPS (mESC, crypts, and organoid datasets) were generated in a standard Seurat analysis. Briefly, variable features were called using the FindVariableFeatures function (parameters selection.method =”vst”, and number of features = 2000), data was scaled using the ScaleData function on all genes, and a PCA was run using the RunPCA function on variable features. Subsequently, a UMAP was built using the RunUMAP function on the top 14 components.</p>
    </sec>
    <sec id="Sec22">
      <title>Assessment of gene expression similarity</title>
      <p id="Par31">Gene expression correlation within cell lineages or random samples for the whole transcriptome was calculated as Pearson correlation. Correlation distance is calculated as 1- the correlation value. To assess the similarity of related cells with respect to cell cycle, genes were classified as cell cycle-dependent or independent using a cell cycle assignment by the cyclone function within scran (v. 1.18.7). Dependence of gene expression on the cyclone assigned cell cycle phases (numerized) was tested using Hoeffding’s D statistics. Gene expression correlation was then calculated using only genes classified as cell-cycle dependent. To assess the similarity in the velocity of related cells, velocity analysis was performed using the velocyto package (v. 0.6). Velocity momenti were extracted for each cell, and their Pearson correlation was calculated. Complexity was defined as the number of genes expressed in a cell and the complexity range within cell lineages was calculated for analysis. For all metrics (transcriptomic similarity in all genes, in cell-cycle dependent genes, similarity in velocity momenti, and in complexity) values between related cells (all lineage sizes) and repeated (100x) random samples of cells of the same size were compared. For the scoring of transcriptomic similarity in symmetric and asymmetric lineages, symmetric and asymmetric lineages were defined based on entire lineages.</p>
    </sec>
    <sec id="Sec23">
      <title>Estimation of variation mediated by cell lineages</title>
      <p id="Par32">Assuming that the variation (here CV<sup>2</sup>) within each lineage is independent of cross-lineage effects, we built a linear model using the <italic>stats</italic> package (v. 3.6.2) to capture the relationship of the variation across lineages (variation of means of each lineage) and total variation (variation across all cells). We then generated mock lineages through the permutation of ground truth lineages and used our model to estimate the total variation in these control sets. Lineages of sizes 3–5 for mESCs and WM989 cells, of size 4 for CD8 and L1210, and of size 2 for all other cell types were considered. This ensured to inclusion of around 90% of the cells in each dataset.</p>
    </sec>
    <sec id="Sec24">
      <title>Memory-gene identification and categorization</title>
      <p id="Par33">We defined memory genes as genes with high variability (coefficient of variability squared; CV<sup>2</sup>) in mean gene expression in different cell lineages. We compared the lineage value to the distribution of values from repeated (20x) random size-matched samples of cells to calculate a p-value. Memory genes were defined as genes with a significantly (p &lt; =0.05) higher variability between lineages as compared to random samples. To categorize memory genes into quantitative and qualitative memory genes, we used the <italic>skewness</italic> function of the R package <italic>moments</italic> (v. 0.14.1). We defined a quantitative memory gene as a gene with a skewness in expression level of under 3, and a qualitative memory gene, as a gene with a skewness in expression level equal or above 3. Memory genes were called on cell lineages of 3–5 (mESCs), 2 members (invasive tumor), or 2–5 members (all other cell types). All predicted cell lineages were used when calling memory genes on these. Other criteria to call memory genes resulted in highly overlapping gene sets (Fig. <xref rid="MOESM1" ref-type="media">S6a, b</xref>). These additional memory gene selection criteria included a high correlation in gene expression within cell lineages and a low variability (CV<sup>2</sup>) in gene expression between cells of the same cell lineage (intra-lineage CV<sup>2</sup>; intraCV<sup>2</sup>). Furthermore, we analyzed marker genes of cell lineages using the Seurat FindMarker function with a range of <italic>test.use</italic> parameters (<italic>bimod, roc, t</italic> (T-test)<italic>, negbinom, poisson, LR, MAST</italic>). We then considered as memory genes the markers with a high sharing across cell lineages, using thresholds defined independently for each <italic>FindMarker</italic> run to optimize the Pearson correlation in gene expression within cell lineages. Finally, to identify memory genes using machine learning, we used common dimension reduction methods, mutual information maximizer (MIM), and ANOVA F-test feature selection (ANOVA). Other feature selection techniques frequently used in the literature were also investigated, but MIM and ANOVA outperformed all the other methods. For both, each gene was attributed a memory score either by computing the mutual information or ANOVA <italic>F</italic>-test of the gene expression across cells. To determine the ideal number of genes N to include in the final gene set, we predicted cell lineages using the top N genes with the highest memory score. Each of the resulting clusters was evaluated and the number of genes N with the best precision was chosen as the optimal number of memory genes. For the comparison of memory genes and variable genes in the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, memory genes were called on lineages predicted at confidence level 50 with a lineage size parameter of 2–20 in each cell type independently. Genes were considered to be variable when having a residual to a least total square fit on mean expression and CV² above zero.</p>
    </sec>
    <sec id="Sec25">
      <title>GO-term enrichment analysis</title>
      <p id="Par34">GO-term enrichment analysis was performed on memory genes called using the lineage ground truth (derived from cellular barcoding, microfluidics, or sister cell picking), and on memory genes called using predicted cell lineages. The <italic>topGO</italic> R package (v. 2.42.0) was used with the GO category “biological process”. Memory genes and background (all genes detected) were considered to be binary. The top 10, 20, 100, or 500 enriched GOs from each set were visualized as indicated. Spearman rank correlation between GO-term enrichment values was calculated for memory genes called on-ground truth and predicted cell lineages. For GO-term enrichment of memory genes called based on predicted lineages in the Janesick data, GO-terms were further compared to expression-matched random gene sets. Enriched terms were significant (Fisher’s exact test, <italic>p</italic> &lt; 0.001) and enriched over 100 expression-matched random gene sets (estimated <italic>p</italic> &lt; 0.05). A selection of terms is shown in Fig. <xref rid="MOESM1" ref-type="media">S22a</xref> and the full list can be found in Supplementary Data file <xref rid="MOESM8" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="Sec26">
      <title>Gene selection for GEMLI predictions</title>
      <p id="Par35">Genes for cell lineage predictions were selected to enrich memory genes based on the quantiles of the mean and variability of gene expression. The variability of gene expression was defined as mean-corrected CV<sup>2</sup> calculated in the form of the residual of the CV<sup>2</sup> to a linear fit of CV<sup>2</sup> and mean expression. The genes selected for lineage predictions are the 2% highest expressed genes, the 60% most variable among the 10% highest expressed genes, and the 10% most variable among the 40% highest expressed genes: (mean quantile &gt;= 98) or (mean quantile &gt;= 90 and variability quantile &gt;= 40) or (mean quantile &gt;= 60 &amp; and variability quantile &gt;= 90)). The selected genes are taken as input for the repetitive iterative clustering algorithm. The selected genes do only partly overlap with highly variable genes and cell type markers called during a standard Seurat-based scRNA-seq analysis (Figs. <xref rid="MOESM1" ref-type="media">S4f</xref> and  <xref rid="MOESM1" ref-type="media">S7f</xref>). For this comparison, highly variable genes were called as top 2000 variable genes with standard Seurat parameters. Cell type markers were called using Seurat’s FindMarkers function for each cell type present with at least 5 cells. Also using machine learning to select genes based on variability and mean gene expression did not further enrich memory genes (Fig. <xref rid="MOESM1" ref-type="media">S7c</xref>). Briefly, different models were trained including logistic regression with L2 regularization (LR), support-vector machine (SVM) with the radial basis function (RBF) kernel, and a neural network. The mESC and Biddy et al. MEF datasets of 48 h and 72 h culture time (<italic>n</italic> = 1 and <italic>n</italic> = 6, respectively) were used for model training, the datasets of CD8, L1210 (<italic>n</italic> = 1 each), and HSPC (48 h; <italic>n</italic> = 22) were used for model validation. The mean expression outliers in each dataset were removed using the inter-quartile range (IQR) method. All the outliers were considered to be memory genes and were added in the final gene selection. Then, the data was normalized to a range between 0 and 1. Each dataset was preprocessed individually. The LR and SVM models were trained using their sklearn (v. 1.1.1) implementation. The neural network was optimized using the Pytorch framework (v. 1.11.0). To optimize the model, a balanced version of the binary cross entropy loss and accuracy was used to account for the fact that the proportion of memory genes is low in all datasets while most machine learning models assume that the data has approximately the same number of samples of both classes. To take this into account, a bigger weight was given to a misclassification of the minority class, the memory genes. To find the optimal hyperparameters for the LR and SVM a grid search and cross-validation were performed. Based on this, the L2 regularization was adjusted to 10<sup>3</sup> and 10<sup>5</sup> for LR and SVM respectively. For the neural network, cross-validation was deemed too computationally expensive, and the Optuna Python package (v. 2.10.0) was used to perform a random search for the optimal hyperparameters on training and validation set (Supplementary Data file <xref rid="MOESM9" ref-type="media">6</xref>). The best performing model was the neural network and its results are show in the Supplementary Figs.</p>
    </sec>
    <sec id="Sec27">
      <title>GEMLI cell lineage prediction algorithm</title>
      <p id="Par36">The GEMLI algorithm is a repetitive iterative clustering approach to predict cell lineages (Scheme in Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, see Table <xref rid="MOESM1" ref-type="media">S1</xref> for a comparison to other clustering algorithms), taking a gene set as input. For de novo cell lineage predictions on scRNA-seq data without lineage annotation the gene set is selected based on mean gene expression and variability (see previous section). Also other gene sets can be used as input, notably memory genes when a ground truth lineage annotation is available (see below). During each iterative clustering, the input gene set is randomly subsampled to 75% (sampling value parameter; see section on GEMLI parameters below). This gene set subsample is then used to cluster the cells of the dataset iteratively as follows. During the first iteration, two clusters (cluster cut parameter; see below) are generated using <italic>cutree</italic> function from the dendextend (v.1.16.0) R package and the <italic>hclust</italic> hierarchical clustering function of the R package stats (v.4.0.2) on the gene expression correlation distance using the agglomeration method ward.D2. In every subsequent iteration round, the cells of each previously defined cluster are clustered again into two clusters using the same procedure. The iteration is ended for clusters meeting a predetermined size of 2–3 cells (lineage size parameter, see below). This results in a cell-by-cell matrix indicating for each cell-pair if it did cluster together in the final cluster of 2–3 cells. This iterative hierarchical clustering represents one-cell lineage prediction. It is repeated 100 times (repetition number parameter, see below) to generate a confidence level for the lineage predictions. More in detail, the cell-by-cell matrices generated in the 100 repetitions of the iterative hierarchical clustering are summed into a confidence level cell-by-cell matrix. Two cells ending up in the same cluster in 30 of the 100 predictions will here for example receive the value of 30. Setting a threshold on the confidence level can then be used for lineage assignment. Cell lineages are assigned as cell groups of which members are clustering together above a confidence level threshold. Lineage assignments are scored against the ground truth lineages (barcode, microfluidic, or sister-cell picking) on precision (true positives (TP)/(TP+ false positives (FP))), sensitivity (TP/(TP+ false negatives (FN))) and false positive rate (FPR; FP/(FP+ true negatives (TN))). All are calculated for each confidence level X by comparing the predictions with a confidence level &gt;=X to the ground truth cell lineage relationships. Thereby precision, sensitivity and FPR are calculated on cell pairs. For the majority of datasets, also AUC values were calculated using the R package Metrics (v. 0.1.4) by the confidence level of predictions as a probability value.</p>
    </sec>
    <sec id="Sec28">
      <title>Comparison of GEMLI to other lineage assignment approaches</title>
      <p id="Par37">To test the performance of GEMLI predictions, characteristics-based gene selection was compared to other starting gene sets, as all genes and memory genes called using the lineage ground truth (from cellular barcoding, microfluidics, or sister cell picking). Further, different memory gene definitions (see above) and Seurat’s highly variable genes (see above) were tested as input gene sets. Finally, memory gene enriched gene sets selected based on mean expression and variability using a neural network (see above) were tested in predictions. GEMLI predictions had a slightly lower precision and sensitivity than predictions using memory genes, but performed better than all genes (Fig. <xref rid="MOESM1" ref-type="media">S8</xref>). FPR was comparable between all three genesets (GEMLI, memory genes, all genes) and consistently very low (&lt;1%) at confidence levels &gt;=50. Other memory gene definitions did not improve prediction performance (Fig. <xref rid="MOESM1" ref-type="media">S6c–h</xref>). Also, gene selection based on a neural network did not improve lineage predictions as compared to GEMLI (Fig. <xref rid="MOESM1" ref-type="media">S9d</xref>). Seurat’s highly variable genes likewise performed worse than the GEMLI gene selection (Fig. <xref rid="MOESM1" ref-type="media">S9f</xref>). Furthermore, the use of a memory gene set called using the ground truth lineage information in one dataset, did also not allow for improved predictions in other datasets of the same or related/other starting cell type and culture condition (Fig. <xref rid="MOESM1" ref-type="media">S9e</xref>). Finally, GEMLI performance was also compared to other lineage assignment approaches, namely random cell pair assignment and kNN-clustering-based lineage assignments. GEMLI predictions on randomly lineage-assigned cells had as expected a very low precision and sensitivity and a high FPR (Fig. <xref rid="MOESM1" ref-type="media">S9a</xref>). Furthermore, cell pairs generated using kNN-clustering with different inputs (Seurat top 2000 variable genes, top 14 components of a PCA on these genes, UMAP on this PCA) resulted in a very low precision, comparable sensitivity, and higher FPR than GEMLI predictions (Fig. <xref rid="MOESM1" ref-type="media">S9b, c</xref>).</p>
    </sec>
    <sec id="Sec29">
      <title>GEMLI predictions for symmetric and asymmetric lineages and different lineage sizes</title>
      <p id="Par38">Scoring predictions for symmetric (one cell type) and asymmetric (several cell types) lineages were performed in three ways. First, only two-cell lineages were scored, which can be unequivocally defined as symmetric (both members of one cell type) and asymmetric (each member of another cell type). Second, lineages of all sizes were scored for which symmetry was defined considering all cell members. Lineages with all members in one cell type were here considered symmetric. Lineages in which any members were part of two different cell types were considered to be asymmetric. Third, cell pairs were scored on the entire prediction matrix by taking pairs where both cells are of the same cell type as symmetric lineage, and pairs where both cells are of a different cell type as asymmetric lineage, respectively. For lineage size analyses the prediction matrix was stratified to only score pairs in which one or both cells are members of a lineage of the indicated ground truth lineage size.</p>
    </sec>
    <sec id="Sec30">
      <title>KNN-clustering-based lineage assignments for comparison to GEMLI predictions</title>
      <p id="Par39">For kNN analysis a standard Seurat pipeline was used. Data was normalized and the 2000 most variable features were extracted using default parameters. The data was then scaled, a PCA was performed on previously defined variable genes and a UMAP was conducted on the first 14 principal components. The kNN analysis was then performed using the dbscan package (v. 1.1-11) with <italic>k</italic> = 1 or 2 as indicated, on either the scaled data for variable features, the 14 first principal components or the UMAP embedding. Pairs of nearest neighbors were used as the lineage for comparison with GEMLI predictions.</p>
    </sec>
    <sec id="Sec31">
      <title>GEMLI prediction algorithm parameters</title>
      <p id="Par40">Several parameters can be set during GEMLI predictions: (1) the sampling value (which fraction of genes is selected for each repetition of the iterative hierarchical clustering), (2) the number of repetitions of the iterative clustering (based on which the confidence level is calculated), (3) the number of clusters in which clusters are split during each iteration (“cluster cut”) and (4) the size of clusters at which clustering iterations are stopped (“lineage size parameter”). The default values used throughout the main figures are a sampling value of 75%, 100 repetitions, splitting clusters into 2 during each iteration, and lineage size parameter of 2–3 cell members unless otherwise indicated. The influence of changes in single parameters on predictions was tested on the unique mESC, CD8, L1210, and one HSPC, WM989, and HSC dataset (Figs. <xref rid="MOESM1" ref-type="media">S10</xref> and  <xref rid="MOESM1" ref-type="media">S12</xref>). A lower sampling value increased precision while decreasing sensitivity (Fig. <xref rid="MOESM1" ref-type="media">S10a, b</xref>). When the number of clusters into which each cluster is split is higher than the maximal lineage size to be predicted, precision values increase and sensitivity decreases (Fig. <xref rid="MOESM1" ref-type="media">S10c, d</xref>). The number of repetitions did only had a small effect on precision and sensitivity values, with higher repetition numbers increasing precision and decreasing sensitivity of the predictions (Fig. <xref rid="MOESM1" ref-type="media">S12e, f</xref>). Also, the lineage size parameter, meaning the size of clusters at which clustering iterations are stopped influences both precision and sensitivity. Precision will be high for predictions with a lineage size parameter of 2–3 until the average size of ground truth lineages is present (Fig. <xref rid="MOESM1" ref-type="media">S12</xref>). FPR stayed low throughout. Only a size parameter greatly exceeding the average ground truth lineage size (Fig. <xref rid="MOESM1" ref-type="media">S12c–e</xref>) can increase FPR to values &gt; 1%, but still &lt;5%. For predictions of multicellular structures (intestinal crypts and organoids) for which related cells are in spatial proximity to each other, the cluster stability of lineages predicted at increasing lineage size parameters, (cluster stability calculated using the sc3 package within the R package clustree (v.0.5.0)), reflected well the ground truth lineage size and plateaued when reaching the maximal ground truth lineage size present. In contrast, for predictions in datasets with primarily small lineages without a spatial proximity or confinement, sc3 cluster stability of predictions increased gradually with increasing lineage size parameter and did not plateau. This allowed for a de novo estimation of the lineage size until which prediction could be performed with high precision in datasets with multicellular structures (fig. <xref rid="MOESM1" ref-type="media">S19</xref>). Depending on the aim of cell lineage predictions and the dataset characteristics (see next section), parameters and confidence level threshold can thereby be adjusted to increase precision or sensitivity respectively.</p>
    </sec>
    <sec id="Sec32">
      <title>Influence of sequencing depth and cell number on GEMLI predictions</title>
      <p id="Par41">To estimate the influence of sequencing depth and dataset size on lineage predictions, GEMLI predictions were performed after downsampling the number of reads or cells in the mESC dataset, and one MEF and HSPC dataset (Fig. <xref rid="MOESM1" ref-type="media">S15</xref> and Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>). For read downsampling, all reads of a given cell were vectorized, and subsequently, a fraction (66%, 50%, 33%, 10%) of these reads were sampled. Cells were subsampled separately to 66%, 50%, 33%, and 10% of the initial cell numbers. Cells without lineage assignment or being the only member of a cell lineage were subsampled directly to the desired fraction. Cells that were members of cell lineages with several members were subsampled together with their respective cell lineage members. Sensitivity of lineage predictions decreased with decreasing sequencing depth but the precision of lineage predictions stayed high above values of 5000–8000 reads/cell as commonly recommended for available scRNA-seq technologies<sup><xref ref-type="bibr" rid="CR37">37</xref>–<xref ref-type="bibr" rid="CR39">39</xref></sup> (Fig. <xref rid="MOESM1" ref-type="media">S15a, b</xref>). Subsamples with fewer cells generally had a slightly better precision and sensitivity, especially for very low read counts (Fig. <xref rid="MOESM1" ref-type="media">S15c, d</xref>). FPR stayed &lt;1% for all conditions.</p>
    </sec>
    <sec id="Sec33">
      <title>Cell fate decision analysis</title>
      <p id="Par42">To assess how well GEMLI can recapitulate the prevalence of different types of cell fate decisions, the HSPC (N = 44) and WM989 (N = 8) datasets were analyzed. HSPCs datasets are derived from cells cultured in myeloid differentiation conditions and are annotated according to their cell type as basophil (Baso), eosinophil (Eosino), erythroid, lymphoid (Lymph), megakaryocyte (Meg), monocyte (Mono), neutrophil (Neutro), mast cell, plasmacytoid dendritic cell (pDC (1/2)), migratory dendritic cell (Ccr7<sup>+</sup>), classic dendritic cell (cDC) or undifferentiated (Undiff) cells (published metadata<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>). Only certain cell type combinations of related cells exist and all have a different prevalence, meaning that HSPCs are restricted in their fate decisions. For each possible cell type combination (for example, erythroid-eosinophil or undifferentiated-mast cell) the number of cell pairs in barcode and GEMLI lineages was determined and summed for all datasets. WM989 cells are annotated as drug-susceptible or drug-resistant (published metadata<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>). Members of each cell lineage are either entirely in one of these two states (symmetric cell pairs) or distributed between these two states (asymmetric cell pairs), with the latter implying that cells recently switched fate. We compared the number of barcodes- and GEMLI-predicted related cell pairs being entirely drug-susceptible, primed, or distributed between the two states. Both for HSPC and WM989 datasets, also DEGs called between different related asymmetric and symmetric cell pairs were compared in barcode and GEMLI lineages. DEG was called using the <italic>FindMarkers</italic> function of Seurat with parameters min.pct=0.05 (HSPC) or 0.25 (WM989) and logfc.threshold=0.1. For HSPCs, not all comparisons of cell type pairs allowed DEG identification. To compare GEMLI and barcode lineages, the Spearman rank correlation between enrichment scores was calculated. The performance of GEMLI in recapitulating the prevalence of lineages and encompassing different cell types (HSPC) of states (WM989) was also compared to random cell lineage assignments for HSPC and WM989 datasets. For the HSPC datasets, it was further compared to a kNN-clustering based lineage assignment. Likewise, the performance of GEMLI in recovering DEG specific to cells in lineages composed of specific cell types or states was also compared to random cell type and kNN-based lineage assignments as follows. For the DEG analysis in Fig. <xref rid="Fig3" ref-type="fig">3e–d</xref> the correlation between the enrichment of DEG in ground truth lineages and predicted lineages for which members were exchanged against random cells of the same cell type was calculated (Fig. <xref rid="MOESM1" ref-type="media">S17e, f</xref>). For the HSPC datasets, DEG analysis was also performed for random cell samples and kNN-based lineage assignments in all datasets (Fig. <xref rid="MOESM1" ref-type="media">S17a, d</xref>). Cell-type combinations predicted by GEMLI were scored and compared. Trajectory analyses were performed using the <italic>scran</italic> (v. 1.28.2) and <italic>slingshot</italic> (2.8.0) packages. Analyses were performed on the 200 (HSPC) or 2000 (WM989) most variable genes on a UMAP with cluster annotation based on a nearest-neighbor graph. Cells in transition was identified based on pseudo-time as those cells of each type that are located close to the transition point between undifferentiated cells and neutrophil cells (HSPC) or drug-susceptible and primed cells (drug-resistant; WM989) respectively. To analyze cell fate decisions in the human breast cancer cell subsets of the Janesick et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> dataset, DEG were called as described above for all cell pairs being members of lineages predicted with lineage size parameter 2–20 cells at confidence level 50 annotated as encompassing only DCIS or invasive tumor cells (symmetric DCIS and symmetric invasive tumor lineages respectively) or being members of lineages encompassing both cell types (asymmetric lineages). For the latter category, only DCIS or invasive tumor cells were considered when indicated.</p>
    </sec>
    <sec id="Sec34">
      <title>Datasets considered for analysis</title>
      <p id="Par43">For datasets considered in each figure and analysis see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>. For all figures in which one dataset of seven cell types is represented the unique mESC, CD8, L1210, as well as the MEF dataset BIDDY_D0_2, the WM989 dataset WM989_well1, the HSC dataset HSC_seq2, and the HSPC dataset LK_D2_exp1_library_d2_2 are represented. To show a dataset encompassing a large number of asymmetric lineages, the dataset LK_D4_well1_exp1_library_d4_1_2 is used in Fig. <xref rid="Fig3" ref-type="fig">3e</xref>. For other panels see Supplementary Data file <xref rid="MOESM4" ref-type="media">1</xref>.</p>
    </sec>
    <sec id="Sec35">
      <title>Statistics and reproducibility</title>
      <p id="Par44">A two-sided Mann–Whitney <italic>U</italic>-test, which does not require normally distributed data, was used to test statistical significance when indicated. No statistical method was used to predetermine sample sizes. No data were excluded from the analyses. The experiments were not randomized. The investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec36">
      <title>Reporting summary</title>
      <p id="Par45">Further information on research design is available in the <xref rid="MOESM10" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec37">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2024_47158_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Material</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2024_47158_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2024_47158_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2024_47158_MOESM4_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2024_47158_MOESM5_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2024_47158_MOESM6_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2024_47158_MOESM7_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 4</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2024_47158_MOESM8_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 5</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM9">
          <media xlink:href="41467_2024_47158_MOESM9_ESM.xlsb">
            <caption>
              <p>Supplementary Data file 6</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM10">
          <media xlink:href="41467_2024_47158_MOESM10_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec38">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM11">
          <media xlink:href="41467_2024_47158_MOESM11_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: A. S. Eisele, M. Tarbier.</p>
    </fn>
    <fn>
      <p>
        <bold>Change history</bold>
      </p>
      <p>6/4/2024</p>
      <p>A Correction to this paper has been published: 10.1038/s41467-024-48978-8</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-024-47158-y.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank the Gene Expression Core Facility, Flow Cytometry Core Facility, Biomolecular Screening Facility, and Scientific IT &amp; Application Support of EPFL. Computational analysis was partially performed on resources provided by the SNIC through UPPMAX. We thank Theo Maffei and Imane Ben M’Rad as students of the EPFL Machine Learning Master course CS-433, as well as Bart Deplancke, Gioele La Manno, Nicholas Phillips, Vincent Gardeux, Johannes Bues, Jörn Pezoldt, Nikolay Oskolkov, Gustavo Jeuken, and the Friedländer, Kutter and Pelechano labs for their helpful input. We are thankful for funding by Swiss National Science Foundation grant#CRSII5_189910 to D.M.S., Novartis Foundation for Medical-Biological Research grant#20A023 to D.M.S., OE och Edla Johanssons Research Foundation to M.T. and A.S.E., The Swedish Research Council (VR 2021-06112 and 2020-01480) to V.P., Knut and Alice Wallenberg Foundation (KAW 2021.0167) to V.P., Ragnar Söderberg Foundation (S12/20) to V.P.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Conceptualization: A.S.E. and D.M.S. Supervision: D.M.S. and V.P. Generation ES cell data: A.S.E. Data analysis: A.S.E., M.T., A.D. Writing R package: A.S.E., M.T. Funding acquisition: D.M.S., V.P., M.T., A.S.E. Writing of the revised manuscript: A.S.E., D.M.S., M.T.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par46"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. CGR8 mESC scRNA-seq data generated in this study has been deposited on GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE226169">GSE226169</ext-link>. The MEF datasets used in this paper are available at GEO under accession codes <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE99915">GSE99915</ext-link>, The CD8 and L1210 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE74923">GSE74923</ext-link>. The HSC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM5101733">GSE167317</ext-link>. The WM989 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE237228">GSE237228</ext-link>. The pancreatic cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE173958">GSE173958</ext-link>. The intestinal crypt and organoid datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE148093">GSE148093</ext-link>. The HSPC datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE140802">GSE140802</ext-link>. The human bone marrow and K562 cell datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE182685">GSE182685</ext-link>. The human breast cancer datasets used in this paper are available at GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE243280">GSE243280</ext-link>. Source data are provided with this paper<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The GEMLI R package and its documentation are available on GitHub at <ext-link ext-link-type="uri" xlink:href="https://github.com/UPSUTER/GEMLI">https://github.com/UPSUTER/GEMLI</ext-link>. A <italic>Zenodo</italic> repository has been created for the GitHub GEMLI package v1.0.0 under doi:10.5281/zenodo.10673334<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. The code to produce all main figures of the paper is available on <italic>Zenodo</italic> doi: 10.5281/zenodo.10581737<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par47">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chang</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ontogeny and vulnerabilities of drug-tolerant persisters in HER2+ breast cancer</article-title>
        <source>Cancer Discov.</source>
        <year>2022</year>
        <volume>12</volume>
        <fpage>1022</fpage>
        <lpage>1045</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-1265</pub-id>
        <?supplied-pmid 34911733?>
        <pub-id pub-id-type="pmid">34911733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Emert</surname>
            <given-names>BL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Variability within rare cell states enables multiple paths toward drug resistance</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>865</fpage>
        <lpage>876</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00837-3</pub-id>
        <?supplied-pmid 33619394?>
        <pub-id pub-id-type="pmid">33619394</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fennell</surname>
            <given-names>KA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Non-genetic determinants of malignant clonal fitness at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>601</volume>
        <fpage>125</fpage>
        <lpage>131</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-04206-7</pub-id>
        <?supplied-pmid 34880496?>
        <pub-id pub-id-type="pmid">34880496</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harmange</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Disrupting cellular memory to overcome drug resistance</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>7130</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-41811-8</pub-id>
        <?supplied-pmid 37932277?>
        <pub-id pub-id-type="pmid">37932277</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <mixed-citation publication-type="other">Meir, Z., Mukamel, Z., Chomsky, E., Lifshitz, A. &amp; Tanay, A. Single-cell analysis of clonal maintenance of transcriptional and epigenetic states in cancer cells. <italic>Nat. Genet</italic>. 10.1038/s41588-020-0645-y (2020).</mixed-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oren</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cycling cancer persister cells arise from lineages with distinct programs</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>576</fpage>
        <lpage>582</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03796-6</pub-id>
        <?supplied-pmid 34381210?>
        <pub-id pub-id-type="pmid">34381210</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Shaffer, S. M. et al. Memory sequencing reveals heritable single-cell gene expression programs associated with distinct cellular behaviors. <italic>Cell</italic>10.1016/j.cell.2020.07.003. (2020).</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dar</surname>
            <given-names>RD</given-names>
          </name>
        </person-group>
        <article-title>A transient heritable memory regulates HIV reactivation from latency</article-title>
        <source>iScience</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>102291</fpage>
        <pub-id pub-id-type="doi">10.1016/j.isci.2021.102291</pub-id>
        <?supplied-pmid 33889814?>
        <pub-id pub-id-type="pmid">33889814</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Biddy, B. A. et al. Single-cell mapping of lineage and identity in direct reprogramming. <italic>Nature</italic>10.1038/s41586-018-0744-4 (2018).</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Mold, J. E. et al. Clonally heritable gene expression imparts a layer of diversity within cell types. <italic>Cell Systems</italic>10.1016/j.cels.2024.01.004 (2024).</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tian</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal multi-omics reveals Bcor as a negative regulator of emergency dendritic cell development</article-title>
        <source>Immunity</source>
        <year>2021</year>
        <volume>54</volume>
        <fpage>1338</fpage>
        <lpage>1351.e9</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2021.03.012</pub-id>
        <?supplied-pmid 33862015?>
        <pub-id pub-id-type="pmid">33862015</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Weinreb, C., Rodriguez-Fraticelli, A., Camargo, F. D. &amp; Klein, A. M. Lineage tracing on transcriptional landscapes links state to fate during differentiation. <italic>Science</italic>10.1126/science.aaw3381 (2020).</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oki</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Epigenetic memory underlies cell-autonomous heterogeneous behavior of hematopoietic stem cells</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>167</volume>
        <fpage>1310</fpage>
        <lpage>1322.e17</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2016.10.045</pub-id>
        <?supplied-pmid 27863245?>
        <pub-id pub-id-type="pmid">27863245</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriguez-Fraticelli</surname>
            <given-names>AE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing unveils a role for TCF15 in haematopoiesis</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>583</volume>
        <fpage>585</fpage>
        <lpage>589</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2503-6</pub-id>
        <?supplied-pmid 32669716?>
        <pub-id pub-id-type="pmid">32669716</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Richman</surname>
            <given-names>LP</given-names>
          </name>
          <name>
            <surname>Goyal</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ClonoCluster: a method for using clonal origin to inform transcriptome clustering</article-title>
        <source>Cell Genomics</source>
        <year>2023</year>
        <volume>3</volume>
        <fpage>100247</fpage>
        <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100247</pub-id>
        <?supplied-pmid 36819662?>
        <pub-id pub-id-type="pmid">36819662</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alemany</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Florescu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Baron</surname>
            <given-names>CS</given-names>
          </name>
          <name>
            <surname>Peterson-Maduro</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Whole-organism clone tracing using single-cell sequencing</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>556</volume>
        <fpage>108</fpage>
        <lpage>112</lpage>
        <pub-id pub-id-type="doi">10.1038/nature25969</pub-id>
        <?supplied-pmid 29590089?>
        <pub-id pub-id-type="pmid">29590089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lederer</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>The emergence and promise of single-cell temporal-omics approaches</article-title>
        <source>Curr. Opin. Biotechnol.</source>
        <year>2020</year>
        <volume>63</volume>
        <fpage>70</fpage>
        <lpage>78</lpage>
        <pub-id pub-id-type="doi">10.1016/j.copbio.2019.12.005</pub-id>
        <?supplied-pmid 31918114?>
        <pub-id pub-id-type="pmid">31918114</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Raj</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous single-cell profiling of lineages and cell types in the vertebrate brain</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>442</fpage>
        <lpage>450</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4103</pub-id>
        <?supplied-pmid 29608178?>
        <pub-id pub-id-type="pmid">29608178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spanjaard</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous lineage tracing and cell-type identification using CrIsPr-Cas9-induced genetic scars</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>469</fpage>
        <lpage>473</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4124</pub-id>
        <?supplied-pmid 29644996?>
        <pub-id pub-id-type="pmid">29644996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Frieda, K. L. et al. Synthetic recording and in situ readout of lineage information in single cells. <italic>Nature</italic>10.1038/nature20777. (2017).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Kimmerling, R. J. et al. A microfluidic platform enabling single-cell RNA-seq of multigenerational lineages. <italic>Nat. Commun</italic>. 10.1038/ncomms10220 (2016).</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Kumar, R. M. et al. Deconstructing transcriptional heterogeneity in pluripotent stem cells. <italic>Nature</italic>10.1038/nature13920 (2014).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Wehling, A. et al. Combined single-cell tracking and omics improves blood stem cell fate regulator identification. <italic>Blood</italic>10.1182/blood.2022016880 (2022).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wheat</surname>
            <given-names>JC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-molecule imaging of transcription dynamics in somatic stem cells</article-title>
        <source>Nature</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2432-4</pub-id>
        <?supplied-pmid 32581360?>
        <pub-id pub-id-type="pmid">32581360</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florian</surname>
            <given-names>MC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Aging alters the epigenetic asymmetry of HSC division</article-title>
        <source>PLoS Biol.</source>
        <year>2018</year>
        <volume>16</volume>
        <fpage>e2003389</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.2003389</pub-id>
        <?supplied-pmid 30235201?>
        <pub-id pub-id-type="pmid">30235201</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>LINEAGE: label-free identification of endogenous informative single-cell mitochondrial RNA mutation for lineage analysis</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2022</year>
        <volume>119</volume>
        <fpage>e2119767119</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2119767119</pub-id>
        <?supplied-pmid 35086932?>
        <pub-id pub-id-type="pmid">35086932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Miller, T. E. et al. Mitochondrial variant enrichment from high-throughput single-cell RNA sequencing resolves clonal populations. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-022-01210-8. (2022).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beneyto-Calabuig</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Müller-Tidow</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Velten</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Clonally resolved single-cell multi-omics identifies routes of cellular differentiation in acute myeloid leukemia</article-title>
        <source>Cell Stem Cell</source>
        <year>2023</year>
        <volume>30</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2023.04.001</pub-id>
        <?supplied-pmid 37098346?>
        <pub-id pub-id-type="pmid">37098346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Ludwig, L. S. et al. Lineage Tracing in Humans Enabled by Mitochondrial Mutations and Single-Cell Genomics. <italic>Cell</italic> 1–15 10.1016/j.cell.2019.01.022 (2019).</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell mitochondrial DNA genotyping and chromatin profiling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>451</fpage>
        <lpage>461</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0645-6</pub-id>
        <?supplied-pmid 32788668?>
        <pub-id pub-id-type="pmid">32788668</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kwok</surname>
            <given-names>AWC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MQuad enables clonal substructure discovery using single cell mitochondrial variants</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-28845-0</pub-id>
        <pub-id pub-id-type="pmid">34983933</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-00795-2</pub-id>
        <?supplied-pmid 33462507?>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Jindal, K. et al. Single-cell lineage capture across genomic modalities with CellTag-multi reveals fate-specific gene regulatory changes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01931-4 (2023).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNA velocity of single cells</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>560</volume>
        <fpage>494</fpage>
        <lpage>498</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0414-6</pub-id>
        <?supplied-pmid 30089906?>
        <pub-id pub-id-type="pmid">30089906</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Phillips</surname>
            <given-names>NE</given-names>
          </name>
          <name>
            <surname>Mandic</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Omidi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Naef</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Suter</surname>
            <given-names>DM</given-names>
          </name>
        </person-group>
        <article-title>Memory and relatedness of transcriptional activity in mammalian cell lineages</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1208</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-09189-8</pub-id>
        <?supplied-pmid 30872573?>
        <pub-id pub-id-type="pmid">30872573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rückert</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Mashreghi</surname>
            <given-names>M-F</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>LS</given-names>
          </name>
          <name>
            <surname>Romagnani</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Clonal expansion and epigenetic inheritance of long-lasting NK cell memory</article-title>
        <source>Nat. Immunol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>1551</fpage>
        <lpage>1563</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-022-01327-7</pub-id>
        <?supplied-pmid 36289449?>
        <pub-id pub-id-type="pmid">36289449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Ntranos</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Tse</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Determining sequencing depth in a single-cell RNA-seq experiment</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
        <pub-id pub-id-type="pmid">31911652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Svensson, V., Da Veiga Beltrame, E. &amp; Pachter, L. Quantifying the tradeoff between sequencing depth and cell number in single-cell RNA-seq. <italic>bioRxiv</italic>10.1101/762773 (2019).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pollen</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Low-coverage single-cell mRNA sequencing reveals cellular heterogeneity and activated signaling pathways in developing cerebral cortex</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2967</pub-id>
        <?supplied-pmid 25086649?>
        <pub-id pub-id-type="pmid">25086649</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>LineageOT is a unified framework for tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Wang, K. et al. PhyloVelo enhances transcriptomic velocity field mapping using monotonically expressed genes. <italic>Nat. Biotechnol</italic>. 10.1038/s41587-023-01887-5 (2023).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Simeonov</surname>
            <given-names>KP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell lineage tracing of metastatic cancer reveals selection of hybrid EMT states</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1150</fpage>
        <lpage>1162</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.05.005</pub-id>
        <?supplied-pmid 34115987?>
        <pub-id pub-id-type="pmid">34115987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Bues, J. et al. Deterministic scRNA-seq captures variation in intestinal crypt and organoid composition. <italic>Nat. Methods</italic>10.1038/s41592-021-01391-1 (2022).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Janesick</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High resolution mapping of the tumor microenvironment using integrated single-cell, spatial and in situ analysis</article-title>
        <source>Nat. Commun</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>8353</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-023-43458-x</pub-id>
        <?supplied-pmid 38114474?>
        <pub-id pub-id-type="pmid">38114474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guvakova</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CDH2/N-cadherin and early diagnosis of invasion in patients with ductal carcinoma in situ</article-title>
        <source>Breast Cancer Res. Treat.</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>333</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1007/s10549-020-05797-x</pub-id>
        <?supplied-pmid 32683564?>
        <pub-id pub-id-type="pmid">32683564</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergen</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Lange</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Peidli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Generalizing RNA velocity to transient cell states through dynamical modeling</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>1408</fpage>
        <lpage>1414</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0591-3</pub-id>
        <?supplied-pmid 32747759?>
        <pub-id pub-id-type="pmid">32747759</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saelens</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cannoodt</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Todorov</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A comparison of single-cell trajectory inference methods</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0071-9</pub-id>
        <?supplied-pmid 30936559?>
        <pub-id pub-id-type="pmid">30936559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eisele</surname>
            <given-names>AS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Erythropoietin directly remodels the clonal composition of murine hematopoietic multipotent progenitor cells</article-title>
        <source>Elife</source>
        <year>2022</year>
        <volume>11</volume>
        <fpage>e66922</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.66922</pub-id>
        <?supplied-pmid 35166672?>
        <pub-id pub-id-type="pmid">35166672</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nagaoka</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>E-Cadherin-Coated Plates Maintain Pluripotent ES Cells without Colony Formation</article-title>
        <source>PLoS ONE</source>
        <year>2006</year>
        <volume>1</volume>
        <fpage>e15</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0000015</pub-id>
        <?supplied-pmid 17183641?>
        <pub-id pub-id-type="pmid">17183641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Barcode-free prediction of cell lineages from scRNA-seq datasets. GEO, <italic>GSE226169</italic>10.1101/2022.09.20.508646 (2024).</mixed-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based prediction of cell lineages from scRNA-seq datasets. GEMLI v1.0.0. <italic>Zenodo</italic>, 10.5281/zenodo.10673334 (2024).</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Eisele, A. S. et al. Gene-expression memory-based lineage prediction of cell lineages from scRNA-seq datasets. <italic>Zenodo</italic>10.5281/zenodo.10581737 (2024).</mixed-citation>
    </ref>
  </ref-list>
</back>
