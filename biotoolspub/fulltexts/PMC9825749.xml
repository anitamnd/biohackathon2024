<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9825749</article-id>
    <article-id pub-id-type="pmid">36469345</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac781</article-id>
    <article-id pub-id-type="publisher-id">btac781</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Microbiome Toolbox: methodological approaches to derive and visualize microbiome trajectories</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-7373-4150</contrib-id>
        <name>
          <surname>Banjac</surname>
          <given-names>Jelena</given-names>
        </name>
        <aff><institution>Data Science, Swiss Federal Institute of Technology Lausanne (EPFL)</institution>, Lausanne 1015, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4880-2750</contrib-id>
        <name>
          <surname>Sprenger</surname>
          <given-names>Norbert</given-names>
        </name>
        <aff><institution>Department of Gastrointestinal Health, Nestlé Institute of Health Sciences, Nestlé Research, Société des Produits Nestlé S.A</institution>, Lausanne 1000, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-2987-4313</contrib-id>
        <name>
          <surname>Dogra</surname>
          <given-names>Shaillay Kumar</given-names>
        </name>
        <aff><institution>Department of Gastrointestinal Health, Nestlé Institute of Health Sciences, Nestlé Research, Société des Produits Nestlé S.A</institution>, Lausanne 1000, <country country="CH">Switzerland</country></aff>
        <xref rid="btac781-cor1" ref-type="corresp"/>
        <!--ShaillayKumar.Dogra@rd.nestle.com-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Marschall</surname>
          <given-names>Tobias</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac781-cor1">To whom correspondence should be addressed. <email>ShaillayKumar.Dogra@rd.nestle.com</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-12-05">
      <day>05</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>05</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <volume>39</volume>
    <issue>1</issue>
    <elocation-id>btac781</elocation-id>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>7</month>
        <year>2021</year>
      </date>
      <date date-type="rev-recd">
        <day>21</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>28</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>02</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>15</day>
        <month>12</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac781.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>The gut microbiome changes rapidly under the influence of different factors such as age, dietary changes or medications to name just a few. To analyze and understand such changes, we present a Microbiome Toolbox. We implemented several methods for analysis and exploration to provide interactive visualizations for easy comprehension and reporting of longitudinal microbiome data.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Based on the abundance of microbiome features such as taxa as well as functional capacity modules, and with the corresponding metadata per sample, the Microbiome Toolbox includes methods for (i) data analysis and exploration, (ii) data preparation including dataset-specific preprocessing and transformation, (iii) best feature selection for log-ratio denominators, (iv) two-group analysis, (v) microbiome trajectory prediction with feature importance over time, (vi) spline and linear regression statistical analysis for testing universality across different groups and differentiation of two trajectories, (vii) longitudinal anomaly detection on the microbiome trajectory and (viii) simulated intervention to return anomaly back to a reference trajectory.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The software tools are open source and implemented in Python. For developers interested in additional functionality of the Microbiome Toolbox, it is modular allowing for further extension with custom methods and analysis. The code, python package and the link to the interactive dashboard of Microbiome Toolbox are available on GitHub <ext-link xlink:href="https://github.com/JelenaBanjac/microbiome-toolbox" ext-link-type="uri">https://github.com/JelenaBanjac/microbiome-toolbox</ext-link></p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Nestlé Research, Société des Produits Nestlé S.A., Switzerland</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Microbiome as a concept usually refers to the composition and function of myriads of bacteria in an ecosystem, such as the gut or other body sites of humans or animals (<xref rid="btac781-B3" ref-type="bibr">Dogra <italic toggle="yes">et al.</italic>, 2020</xref>). The gut microbiome is particularly dynamic during early life development yet is still susceptible to change and malleable and it reaches a stable state at around 2–3 years of age (<xref rid="btac781-B1" ref-type="bibr">Cher and Yassour, 2020</xref>). Diet is a major factor affecting the microbiome throughout life. For example, the adult microbiome was shown to change in response to drastic changes in diet such as a high-fat or ketogenic diet (<xref rid="btac781-B2" ref-type="bibr">David <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btac781-B7" ref-type="bibr">Mardinoglu <italic toggle="yes">et al.</italic>, 2018</xref>). Not surprisingly, as a response to antibiotics, the gut microbiome is also drastically impacted but recovers subsequently to a large extent (<xref rid="btac781-B8" ref-type="bibr">Palleja <italic toggle="yes">et al.</italic>, 2018</xref>).</p>
    <p>Exploring and understanding changes in the microbiome in relation to different factors such as time or age, changes in the environment and diet, as well as medications, are of great interest especially as these relate to health conditions. In early life, an age-appropriate microbiome is understood to be critically important for appropriate immune competence development (<xref rid="btac781-B4" ref-type="bibr">Dogra <italic toggle="yes">et al.</italic>, 2015</xref>). Equally, numerous examples relate adult gut microbiome features to health conditions (<xref rid="btac781-B3" ref-type="bibr">Dogra <italic toggle="yes">et al.</italic>, 2020</xref>). Hence, the importance of a Microbiome Toolbox that allows the identification of the key microbiome features that characterize an appropriate microbiome versus one that deviates.</p>
    <p>Here, we present a Microbiome Toolbox to facilitate such explorations and understanding that can be employed as is for efficient dataset analysis or customized for further data exploitation. Beyond the customary data visualizations and explorations, we implement some specific methods for exploring the microbiome trajectories. Besides working with relative abundances, a key aspect of the calculations is using log ratios to integrate relevant algorithms. We take a machine-learning-based approach to derive a microbiome trajectory. We define on- and off- the trajectory based on various criteria, and we identify key determining features that place a sample on- or off- the trajectory. Furthermore, we suggest what changes can bring a sample back onto the trajectory. An overview of the Microbiome Toolbox is presented in <xref rid="btac781-F1" ref-type="fig">Figure 1</xref>.</p>
    <fig position="float" id="btac781-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Microbiome Toolbox has multiple components for (<bold>a</bold>) exploration of microbiome data, (<bold>b</bold>) preparing data for subsequent analyses, (<bold>c</bold>) constructing microbiome trajectories, (<bold>d</bold>) determining who is an outlier or within a trajectory and (<bold>e</bold>) identifying important features as possibilities to return an outlier sample back on to the trajectory. The data used to illustrate the functionalities of this Microbiome Toolbox is from the R-package—metagenomeSeq (<xref rid="btac781-B9" ref-type="bibr">Paulson <italic toggle="yes">et al.</italic>, 2013</xref>). Briefly, 12 germ-free mice fed a low-fat, plant polysaccharide-rich diet, were inoculated with adult human fecal material by gavage. Mice remained on the same diet for 4 weeks before a subset of six mice were switched to a high-fat, high-sugar diet for an additional 8 weeks</p>
      </caption>
      <graphic xlink:href="btac781f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Data analysis and exploration</title>
      <p>To get an overview and understanding of the data, Microbiome Toolbox has the plot to visualize the sampling statistics (<xref rid="btac781-F1" ref-type="fig">Fig. 1a</xref>). The example data used here, briefly described in the legend of <xref rid="btac781-F1" ref-type="fig">Figure 1</xref>, is from the R-package—metagenomeSeq (<xref rid="btac781-B9" ref-type="bibr">Paulson <italic toggle="yes">et al.</italic>, 2013</xref>), and its source is pointed to in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref> under ‘mouseData’. We can visualize the microbiome data in an ultra-dense manner. Feature abundances, such as taxa, can be visualized over time as a heatmap or as a median or mean with error bars. Diversity indices such as Shannon or Simpson can be calculated. Embedding plots can be used to visualize the multi-dimensional data in a low-dimensional latent space. Outlier clusters can be identified and further analyzed to identify discriminating features distinguishing these outliers from the rest of the group.</p>
    </sec>
    <sec>
      <title>2.2 Data preparation</title>
      <p>Besides having feature abundances, one can perform a log-ratio transformation (<xref rid="btac781-F1" ref-type="fig">Fig. 1b</xref>). For the purpose of calculating this log-ratio, we can identify a suitable bacterium to go in the denominator by using methods such as the least number of crossings, bacteria with very low or very high differential rankings, or choosing the bacteria with the best model performance when used as a denominator. We can also make a ‘hybrid model’ by applying the domain knowledge to incorporate features in addition to the ones identified as important by the model. Next, we can define a reference or control group to be used as a basis for setting the trajectory. We can then classify all other samples into a non-reference group or use an unsupervised novelty detection algorithm to decide whether the observed sample belongs to the reference. Before deriving microbiome trajectories, we first need to prepare the data by removing correlated or low-variance features. We can also choose the subset of taxa the model will be trained on and still achieve an optimal performance.</p>
    </sec>
    <sec>
      <title>2.3 Microbiome trajectory</title>
      <p>Using machine-learning algorithms, we predict a Microbiome Maturation Index (MMI) as a function of time (<xref rid="btac781-F1" ref-type="fig">Fig. 1c</xref>). A smooth fit is then used to obtain the trajectory. To interpret the predictions of the model we use SHapley Additive exPlanation (SHAP) values analysis (<xref rid="btac781-B6" ref-type="bibr">Lundberg <italic toggle="yes">et al.</italic>, 2020</xref>). A confidence interval or prediction interval can be utilized to check the nature of the spread of points on the trajectory. Comparison between groups or references can be made by fitting lines specific to each group and then running statistical tests to determine if these are significantly different. Additionally, we can evaluate trajectory performance using more than 40 different models including a custom-made deep learning model for the dataset—also, different models can be chosen individually for different datasets.</p>
    </sec>
    <sec>
      <title>2.4 Outlier discovery</title>
      <p>Outliers can be identified by various methods such as being outside the prediction interval or by longitudinal anomaly detection algorithms such as a low-pass filter or Isolation Forest (<xref rid="btac781-B5" ref-type="bibr">Liu et al. 2008</xref>) implemented using a rolling average window. We can then use a machine-learning ensemble model, discriminating between the outliers and the (subsampled) rest of the dataset, to classify these outliers. We can interpret the predictions using SHAP analysis to identify the bacteria or metadata factors that differentiate the outliers from the (subsampled) rest.</p>
    </sec>
    <sec>
      <title>2.5 Important features and intervention simulation</title>
      <p>Lastly, we can identify the key bacteria that are important per the user-defined time window in the trajectory (<xref rid="btac781-F1" ref-type="fig">Fig. 1e</xref>). For outliers, some of these key features are out of the normal range causing the deviation from the trajectory. In a simulation setting, by restoring these numbers to be the same as for the key features in the reference group, we can make the outliers move closer to the trajectory. Additionally, we can see what features are shared between the detected outlier samples and compare whether they can be differentiated from the non-outlier samples. This then provides insights into how external factors affect our samples and what could be possible key interventions in real life, such as nutrition-based inteventions, to reposition these outliers back to normal.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Conclusions</title>
    <p>We present here a Microbiome Toolbox to depict microbiome change as trajectories under different conditions such as time, diet changes or perturbations. While the Microbiome Toolbox has implemented intricate methods and complex algorithms, it also provides a rich variety of plots for easy visual comprehension and reporting. We hope that microbiome researchers will find this Microbiome Toolbox particularly useful for the examination of their data and for deriving meaningful insights.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac781_Supplementary_Data</label>
      <media xlink:href="btac781_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors kindly acknowledge Francis Foata for data preparation and Dr. Irene Vasallo for useful statistical inputs.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by Nestlé Research, Société des Produits Nestlé S.A., Switzerland.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac781-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Cher</surname><given-names>A.</given-names></string-name>, <string-name><surname>Yassour</surname><given-names>M.</given-names></string-name></person-group> (<year>2020</year>) <part-title>Chapter 8 - The compositional development of the microbiome in early life</part-title>. <source>The Human Microbiome in Early Life: Implications to Health and Disease</source>., <fpage>177</fpage>–<lpage>195</lpage>.</mixed-citation>
    </ref>
    <ref id="btac781-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>David</surname><given-names>L.A.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Diet rapidly and reproducibly alters the human gut microbiome</article-title>. <source>Nature</source>, <volume>505</volume>, <fpage>559</fpage>–<lpage>563</lpage>.<pub-id pub-id-type="pmid">24336217</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dogra</surname><given-names>S.K.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Gut microbiota resilience: definition, link to health and strategies for intervention</article-title>. <source>Front. Microbiol</source>., <volume>11</volume>, <fpage>572921</fpage>.<pub-id pub-id-type="pmid">33042082</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dogra</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2015</year>) <article-title>Rate of establishing the gut microbiota in infancy has consequences for future health</article-title>. <source>Gut Microbes</source>, <volume>6</volume>, <fpage>321</fpage>–<lpage>325</lpage>.<pub-id pub-id-type="pmid">26516657</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>F.</given-names></string-name></person-group><etal>et al</etal> (<year>2008</year>) Isolation forest. In: <italic toggle="yes">Eighth IEEE International Conference on Data Mining, ICDM’08, Pisa, Italy.</italic></mixed-citation>
    </ref>
    <ref id="btac781-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lundberg</surname><given-names>S.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>From local explanations to global understanding with explainable AI for trees</article-title>. <source>Nat. Mach. Intell</source>., <volume>2</volume>, <fpage>56</fpage>–<lpage>67</lpage>.<pub-id pub-id-type="pmid">32607472</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mardinoglu</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>An integrated understanding of the rapid metabolic benefits of a Carbohydrate-Restricted diet on hepatic steatosis in humans</article-title>. <source>Cell Metab</source>., <volume>27</volume>, <fpage>559</fpage>–<lpage>571.e5</lpage>.<pub-id pub-id-type="pmid">29456073</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palleja</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Recovery of gut microbiota of healthy adults following antibiotic exposure</article-title>. <source>Nat. Microbiol</source>., <volume>3</volume>, <fpage>1255</fpage>–<lpage>1265</lpage>.<pub-id pub-id-type="pmid">30349083</pub-id></mixed-citation>
    </ref>
    <ref id="btac781-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Paulson</surname><given-names>J.N.</given-names></string-name></person-group><etal>et al</etal> (<year>2013</year>) <article-title>Differential abundance analysis for microbial marker-gene surveys</article-title>. <source>Nat. Methods</source>, <volume>10</volume>, <fpage>1200</fpage>–<lpage>1202</lpage>.<pub-id pub-id-type="pmid">24076764</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
