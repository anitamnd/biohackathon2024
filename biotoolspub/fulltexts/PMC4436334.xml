<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archivearticle1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4436334</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-15-06443</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0127659</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>QuantiFly: Robust Trainable Software for Automated <italic>Drosophila</italic> Egg Counting</article-title>
      <alt-title alt-title-type="running-head">QuantiFly: Automatic Egg Counter</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Waithe</surname>
          <given-names>Dominic</given-names>
        </name>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rennert</surname>
          <given-names>Peter</given-names>
        </name>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brostow</surname>
          <given-names>Gabriel</given-names>
        </name>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Piper</surname>
          <given-names>Matthew D. W.</given-names>
        </name>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of Computer Science, University College London, Gower St, London, WC1E 6BT, United Kingdom</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Wolfson Imaging Centre, Weatherall Institute of Molecular Medicine, University of Oxford, John Radcliffe Hospital, Oxford, OX3 9DS, United Kingdom</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Institute of Healthy Ageing and Department of Genetics, Evolution and Environment, University College London, Gower St, London, WC1E 6BT, United Kingdom</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Gilestro</surname>
          <given-names>Giorgio F</given-names>
        </name>
        <role>Academic Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Imperial College London, UNITED KINGDOM</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <fn fn-type="con" id="contrib001">
        <p>Conceived and designed the experiments: DW PR GB MDWP. Performed the experiments: DW PR. Analyzed the data: DW. Contributed reagents/materials/analysis tools: DW PR MDWP. Wrote the paper: DW GB MDWP.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>g.brostow@cs.ucl.ac.uk</email> (GB); <email>m.piper@ucl.ac.uk</email> (MDWP)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>5</month>
      <year>2015</year>
    </pub-date>
    <volume>10</volume>
    <issue>5</issue>
    <elocation-id>e0127659</elocation-id>
    <history>
      <date date-type="received">
        <day>11</day>
        <month>2</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>4</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Â© 2015 Waithe et al</copyright-statement>
      <copyright-year>2015</copyright-year>
      <copyright-holder>Waithe et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are properly credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:type="simple" xlink:href="pone.0127659.pdf"/>
    <abstract>
      <p>We report the development and testing of software called QuantiFly: an automated tool to quantify <italic>Drosophila</italic> egg laying. Many laboratories count <italic>Drosophila</italic> eggs as a marker of fitness. The existing method requires laboratory researchers to count eggs manually while looking down a microscope. This technique is both time-consuming and tedious, especially when experiments require daily counts of hundreds of vials. The basis of the QuantiFly software is an algorithm which applies and improves upon an existing advanced pattern recognition and machine-learning routine. The accuracy of the baseline algorithm is additionally increased in this study through correction of bias observed in the algorithm output. The QuantiFly software, which includes the refined algorithm, has been designed to be immediately accessible to scientists through an intuitive and responsive user-friendly graphical interface. The software is also open-source, self-contained, has no dependencies and is easily installed (<ext-link ext-link-type="uri" xlink:href="https://github.com/dwaithe/quantifly">https://github.com/dwaithe/quantifly</ext-link>). Compared to manual egg counts made from digital images, QuantiFly achieved average accuracies of 94% and 85% for eggs laid on transparent (defined) and opaque (yeast-based) fly media. Thus, the software is capable of detecting experimental differences in most experimental situations. Significantly, the advanced feature recognition capabilities of the software proved to be robust to food surface artefacts like bubbles and crevices. The user experience involves image acquisition, algorithm training by labelling a subset of eggs in images of some of the vials, followed by a batch analysis mode in which new images are automatically assessed for egg numbers. Initial training typically requires approximately 10 minutes, while subsequent image evaluation by the software is performed in just a few seconds. Given the average time per vial for manual counting is approximately 40 seconds, our software introduces a timesaving advantage for experiments starting with as few as 20 vials. We also describe an optional acrylic box to be used as a digital camera mount and to provide controlled lighting during image acquisition which will guarantee the conditions used in this study.</p>
    </abstract>
    <funding-group>
      <funding-statement>Work was funded by the Biotechnology and Biological Sciences Research Council <ext-link ext-link-type="uri" xlink:href="http://www.bbsrc.ac.uk/home/home.aspx">http://www.bbsrc.ac.uk/home/home.aspx</ext-link> (BBI011544/1, M.D.W.P) and the Royal Society <ext-link ext-link-type="uri" xlink:href="https://royalsociety.org/">https://royalsociety.org/</ext-link> (UF100158 &amp; RG110303, M.D.W.P), the UCL Crucible, <ext-link ext-link-type="uri" xlink:href="http://crucible.cege.ucl.ac.uk/homepage/">http://crucible.cege.ucl.ac.uk/homepage/</ext-link>, a multi research-council initiative by the BBSRC, EPSRC, ESRC and MRC (#G0700729, G.B., M.D.W.P), and the Engineering and Physical Sciences Research Council, <ext-link ext-link-type="uri" xlink:href="https://www.epsrc.ac.uk">https://www.epsrc.ac.uk</ext-link> (EP/K023578/1, G.B.).</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="2"/>
      <page-count count="16"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>All data are available in the supplementary section of this paper.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>All data are available in the supplementary section of this paper.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>The fruitfly <italic>Drosophila melanogaster</italic> is a widely used model organism for research. One of the most commonly measured metrics of adult physiology is female egg laying. Quantifying egg laying is a laborious and onerous task that requires the experimenter to score eggs using a dissecting microscope and a hand-held tally counter. Given the advances in computer vision and machine learning, we have developed an automated solution for this task.</p>
    <p>In the imaging sciences, microscopy based experiments are often automated using software and custom macros which optimise acquisition and/or analysis of raw data [<xref rid="pone.0127659.ref001" ref-type="bibr">1</xref>â<xref rid="pone.0127659.ref004" ref-type="bibr">4</xref>]. So far, there is no analysis solution that can do this robustly and accurately for <italic>Drosophila</italic> eggs. Identifying and counting eggs automatically from digital images is a challenging problem due to a number of factors. For example, <italic>Drosophila</italic> may or may not lay their eggs uniformly across the surface of the food, resulting in clumping and eggs varying in orientation. Another significant challenge is that the food surface can often be cracked or rough, partially obscuring eggs because flies take advantage of these features when laying. Furthermore, different media formulations can optically change the appearance of the eggs. More intelligent and powerful computer vision (CV) algorithms, some of which mimic the human visual system, are now becoming available which can intepret even highly complex imagery [<xref rid="pone.0127659.ref005" ref-type="bibr">5</xref>]. These CV techniques often have a large number of parameters which require tuning for a given task (e.g. egg counting). Machine learning (ML) algorithms are often employed alongside CV algorithms because the ML component automates the parameter optimisation freeing the user from the task. The role of the user in this paradigm is to provide training material to the algorithm which allows the machine learning algorithm to refine the parameters accordingly. These algorithms are finding new application in the biosciences with many successful applications [<xref rid="pone.0127659.ref006" ref-type="bibr">6</xref>â<xref rid="pone.0127659.ref008" ref-type="bibr">8</xref>]. There is however still a lot of work to do to bring these techniques into the life sciences as these approaches require substantial validation in the biological domain as well as further attention applied to how user-friendly they are, and how they are distributed.</p>
    <p>The goal of this study was to automate and optimize the task of counting eggs laid by female fruitflies. The standard manual technique is labor intensive and time consuming, meaning it is costly in terms of human resources, subject to user bias and fatigue errors. Manual counting takes between 30 s to 2 minutes per vial and a typical experiment will contain between 50â100 vials meaning that longitudinal studies of egg laying (e.g. [<xref rid="pone.0127659.ref009" ref-type="bibr">9</xref>]) require hundreds of hours committed to egg counting. Automation should enable experiments to be performed with greater ease and efficiency improving speed and reproducibility without accuracy tradeoffs. Here, we report the design and validation of a versatile and highly accurate piece of software that we call QuantiFly, that automates egg counting after a brief training period. This solution has the following features: 1) it is sufficiently quick and robust to compete with the existing manual method for accuracy and ease of use; 2) it is compatible with readily available digital capture equipment so that any laboratory can employ it without difficultly, and; 3) it is simple to deploy and interpret so that it is accessible to research scientists without computer science expertise. We additionally report the blueprints for a simple and easily fabricated physical apparatus for image acquisition to enhance speed, reproducibility and robustness and which can be used to replicate the results of this study.</p>
  </sec>
  <sec sec-type="materials|methods" id="sec002">
    <title>Materials and Methods</title>
    <sec id="sec003">
      <title>Algorithm Implementation</title>
      <p>The QuantiFly software utilises the density estimation approach first proposed in Lempitsky et al. (2010) [<xref rid="pone.0127659.ref010" ref-type="bibr">10</xref>] and later refined by Fiaschi et al (2012) [<xref rid="pone.0127659.ref011" ref-type="bibr">11</xref>]. We chose this approach because it is robust to changes in the appearance of eggs including those caused by clustering or altered orientation as well as overlooking irregularities in the egg laying surfaces. In this paradigm objects are represented as 2d gaussian probablility distributions with a distribution centred on each object in the scene. During the training phase the user is asked to click on the location of objects to be counted (in this case eggs), creating a sparse representation of instance locations within the image. The density value for pixels within the object are then generated through convolution of the grid with a gaussian of specific width (sigma). The sigma of the kernel should be chosen so that the output kernel is less than the size of the object, in this case (sigma = 1.0). Pixels close to an object will contain a density value which represents the probability of that pixel being the center of an egg. Summation of these pixel values for the whole image results in an overall count of eggs within the scene. Features for each pixel in the input image are then generated using basic image filters to decompose the scene into its visual components in a method which purportly mimics the mammalian visual system [<xref rid="pone.0127659.ref012" ref-type="bibr">12</xref>] by describing the structures within digital images at several scales of detail [<xref rid="pone.0127659.ref013" ref-type="bibr">13</xref>â<xref rid="pone.0127659.ref015" ref-type="bibr">15</xref>]. Subsequent to feature processing, each pixel in an input image is described by a feature vector, with each element of the vector corresponding to a different filter output. The features calculated within the QuantiFly software include Gaussian magnitude and derivative of Gaussian filters across multiple scales and also the minimum and maximum eigenvalues of a structural tensor calculated at each pixel location very similar to Fiaschi et al. [<xref rid="pone.0127659.ref011" ref-type="bibr">11</xref>]. In this paper we use as a feature desciptor with 5 different scales (sigma = 0.8, 1.6, 3.2, 6.4, 12.8) and apply it to the the red, green and blue channel of the input image, this technique is described throughout this paper as the âbaselineâ approach.</p>
      <p>The machine learning challenge for the density estimation approach is to organise and group pixel feature vectors and their output labels so that density interpretations can be predicted quickly and accurately for unlabelled input images. In this study, an ensemble of decision trees was used for solving this learning objective [<xref rid="pone.0127659.ref016" ref-type="bibr">16</xref>], in particular the Extremely Randomized Trees (ERT) framework [<xref rid="pone.0127659.ref017" ref-type="bibr">17</xref>]. The ERT framework takes the input image feature vectors and learns to associate them with output densities, which are supplied by the user during training. The ERT framework is highly accurate, but requires little or no optimisation when compared to other decision tree frameworks and so is less computationally demanding and faster to train [<xref rid="pone.0127659.ref018" ref-type="bibr">18</xref>]. Decision tree models utilise structures known as trees which are generated from the training data and represent a hierarchy of node splits. At each node of the tree, a random subset of features is chosen, along with a random threshold value for which to assess this feature between the minimum and maximum possible values. The population of input pixels at this node (which in the case of the top node, is all the training input pixels) is then used to assess which feature is most appropriate to parse the associated pixel output labels (in this case density values) for the population of input pixels. The goal of the algorithm is to pick the feature and associated threshold which reduces the entropy (variance in density labels) associated with the two output groups resulting from each node split. This process is repeated recursively until either the density values in a node are consistent or there are only a small number of values remaining at each node. The resulting structure is called a tree, at each level of the tree the input pixels are split into smaller and smaller groups. Tree generation is repeated multiple times (in this case 30 x) to produce an ensemble of decision trees. For an input image, the output class for each pixel is calculated from each tree in the ensemble, the average response from each tree for each pixel is then calculated and a density image generated. With this framework in place, new images can be processed, features calculated and output densities predicted for each pixel. To find the output egg count for a given image, all the output pixels are summed from the density image created from the ERT framework.</p>
      <p>The QuantiFly software includes a novel training interface which allows the user to interactively train the system. In the results section it is shown how many labelled images are required to obtain a certain degree of accuracy, but from the outset it is informative and useful for the user who is training the system to see feedback in an iterative fashion to the training data, as they generate it. The user does this by selecting Regions of Interest (ROI) within the training image dataset and then provides labels for the location of each object (in this case the <italic>Drosophila</italic> eggs) by clicking on its position within this region. Once the system is trained the user can evaluate test images and obtain a prediction for the number of eggs present in this image. It is essential that the user mark the location of all the eggs within the training material, but with the ROI system it is possible to label just one region from an image and then evaluate the whole image and any other images using the available training data. This system allows users to gain a quick sense of how the software operates, before committing to larger scale training.</p>
      <p>We found during this study that the accuracy of the original algorithm could be improved by applying a corrective transformation to the data. The parameters of the linear transform are established from minimsing the error resulting from comparing the number of labels for regions in the training set with their estimated number upon model evaluation:
<disp-formula id="pone.0127659.e001"><alternatives><graphic xlink:href="pone.0127659.e001.jpg" id="pone.0127659.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi>Î²</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>c</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>Î²</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:munderover><mml:mo>â</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow/></mml:munderover><mml:munderover><mml:mo>â</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow/></mml:munderover><mml:mrow><mml:mo>(</mml:mo><mml:mi>Î²</mml:mi><mml:mi>P</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>c</mml:mi><mml:mo>-</mml:mo><mml:mi>A</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
</p>
      <p>Where <italic>PC</italic>
<sub><italic>ij</italic></sub> represents the predicted count estimated for each region (j) of each image (i) and ACij is the actual ground-truth count provided by the user for corresponding region and image. The gradient <italic>Î²</italic> and the offset c are calculated using the python NumPy polyfit function which performs the least-squares minimisation. Subsequently, the predicted counts of test images are corrected according to:
<disp-formula id="pone.0127659.e002"><alternatives><graphic xlink:href="pone.0127659.e002.jpg" id="pone.0127659.e002g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M2"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>Î²</mml:mi><mml:mi>P</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Where <italic>CC</italic>
<sub><italic>i</italic></sub> represents the corrected count for the image i.</p>
    </sec>
    <sec id="sec004">
      <title>Software and Distribution</title>
      <p>The QuantiFly software source code and binary distributions for linux, Mac and Windows are available to download (<ext-link ext-link-type="uri" xlink:href="https://github.com/dwaithe/quantifly">https://github.com/dwaithe/quantifly</ext-link>). The software was developed using python 2.7.8 [<xref rid="pone.0127659.ref019" ref-type="bibr">19</xref>]. The ERT learning framework was implemented using the scikit-learn python library (v 0.13.1) [<xref rid="pone.0127659.ref020" ref-type="bibr">20</xref>]. The training interface technology was developed using the python PyQT4 (v4.10.3) python library. The image features (gaussian gradient magnitude, laplacian of guassian, structure tensor eigenvalues) were calculated using the python bindings of the VIGRA image processing library [<xref rid="pone.0127659.ref021" ref-type="bibr">21</xref>]. Other essential python libraries used in the QuantiFly software include: SciPy (v0.14.0), NumPy (v1.8.2) and PyInstaller (v.2.1).</p>
    </sec>
    <sec id="sec005">
      <title>Flies, media and egg laying</title>
      <p>For all work, we used our laboratory strain of <italic>Drosophila melanogaster</italic> Dahomey. In general, 5 to 10 female flies were allowed to lay eggs on media in glass vials for up to 20 hours, at which point flies were transferred to new media. The vials were then counted immediately or frozen at -20 C for counting at a later time. The eggs in each vial were counted using a dissecting microscope and hand-held tally counter. The time taken to process a batch of vials was recorded. A photo of each of the vials was then captured using a Logitech c920 webcam mounted on an adjustable stand or in the camera-housing enclosure described below. For acquisition we used the linux GTK+ UVC viewer software, although the default software for any webcam would be suitable. All media designated as opaque is sugar/yeast (SY) food, which was prepared at 1x concentration (SYBrewers in Bass et al [<xref rid="pone.0127659.ref022" ref-type="bibr">22</xref>]) and the translucent media correspond to the holidic, or defined, medium (DM) described in Piper et al [<xref rid="pone.0127659.ref023" ref-type="bibr">23</xref>].</p>
    </sec>
    <sec id="sec006">
      <title>Digital ground-truths and accuracy calculation</title>
      <p>To assess the performance of different algorithms used in this study and to train the system in a reproducible way, digital ground-truth data was required in addition to the conventional manual assessment of egg counts in each image. Vial images were imported into Fiji one at a time and then annotated using the point tool [<xref rid="pone.0127659.ref002" ref-type="bibr">2</xref>]. Annotated images were then exported as binary images and then imported with an evaluation script to train the algorithm and to evaluate its performance. Throughout this study the accuracy of the algorithms are evaluated as percent accuracy, which represents the absolute difference of the ground-truth and the predicted count over the ground-truth count:
<disp-formula id="pone.0127659.e003"><alternatives><graphic xlink:href="pone.0127659.e003.jpg" id="pone.0127659.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>A</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mi>u</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mo>%</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mo>â</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mo>(</mml:mo><mml:mo>|</mml:mo><mml:mi>P</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:mi>G</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>/</mml:mo><mml:mi>G</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:mn>100</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
where n is the total number of images in the dataset and GT represents the ground truth count for each image. The package GraphPad Prism (v6,0d) was used for performing the statistics in this study. The vial images and ground-truth annotations used in this study are available through the software website (<ext-link ext-link-type="uri" xlink:href="https://github.com/dwaithe/quantifly">https://github.com/dwaithe/quantifly</ext-link>).</p>
    </sec>
    <sec id="sec007">
      <title>Camera Housing</title>
      <p>In order to assist the long-term use of QuantiFly by a variety of users, we have also constructed a camera-housing box consisting of a mounted web-cam, physical guides to control the vial position in the centre of the image and an array of LEDs to provide consistent and repeatable illumination of the food surface from above for opaque media and underneath for transparent media. Both image acquisition and control over illumination is achieved by an in-built arduino chip connected to a computer. Please enquire for the blueprints. The camera-housing box was developed in collaboration with, and manufactured by Luis Garcia of Polygonal Tree (<ext-link ext-link-type="uri" xlink:href="http://polygonaltree.github.io/egg_counter">http://polygonaltree.github.io/egg_counter</ext-link>).</p>
    </sec>
  </sec>
  <sec id="sec008">
    <title>Results and Discussion</title>
    <sec id="sec009">
      <title>Core Algorithm</title>
      <p>Due to the non-trivial nature of the imaging and counting problems associated with automating fly egg counting, we used an advanced computer vision and machine learning strategy using a density estimation model [<xref rid="pone.0127659.ref010" ref-type="bibr">10</xref>, <xref rid="pone.0127659.ref011" ref-type="bibr">11</xref>]. As an initial check of the appropriateness of this technique, we trained the baseline algorithm by exhaustively labelling eggs in an image of eggs laid on transparent fly food and then used the trained algorithm to evaluate the same image, the procedure was then repeated for eggs laid on opaque fly food. Visually comparing the algorithms density output (Fig <xref ref-type="fig" rid="pone.0127659.g001">1B</xref> and <xref ref-type="fig" rid="pone.0127659.g001">1D</xref>) with the original image (Fig <xref ref-type="fig" rid="pone.0127659.g001">1A</xref> and <xref ref-type="fig" rid="pone.0127659.g001">1C</xref>) showed the eggs were well represented as areas of higher density, even when they varied in orientation, intensity and some were found in clusters. Furthermore, the density estimation approach is tolerant to a number of visual artefacts that appear in vial images, such as marks on the container that appear in the periphery of the images, reflected images of eggs, and bubbles in the medium surface (<xref ref-type="fig" rid="pone.0127659.g001">Fig 1</xref>).</p>
      <fig id="pone.0127659.g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>Typical vial images illustrating varying lighting conditions and irregularities in media surface.</title>
          <p>Original vial image (A) and egg density representation from QuantiFly (B) for transparent defined medium (DM). Original vial image (C) and egg density representation (D) for opaque sugar/yeast (SY) medium. Red arrows highlight artefacts present in images: (1) clumped eggs; (2) marks on vial base; (3) bubble artefacts in media; (4) specular reflection from vial surface, and; (5) clumped eggs on food surface. Colour bar represents pixel density estimate of an egg.</p>
        </caption>
        <graphic xlink:href="pone.0127659.g001"/>
      </fig>
      <p>An inherent feature of using an extremely random decision tree framework for learning is that training involves a degree of randomness such that for repeated rounds of algorithm training on a labelled image, a slightly different learned model is created. Subsequently, when these models are directed to assess the number of eggs in a new image, each will yield a slightly different count. Once trained however, a single ensemble model becomes fixed and it will always evaluate an image in the same way. To assess the effect of this variation on our final count data, we took a single image of eggs on translucent fly medium, exhaustively labeled the eggs and trained 100 x naÃ¯ve models on the labeled image. The distribution of derived counts was broadly Gaussian, generating an average prediction of 214.8 Â± 15.4 (s.d.), which was an accurate representation of the ground truth count of 213. Thus the variation introduced into counting by the variation in model training is less than 10% of the actual ground truth number for a single training image. This is a small amount given the expected biological variation and with additional training images the variation drops further (e.g with 5 images s.d. is 3%).</p>
    </sec>
    <sec id="sec010">
      <title>Addressing Bias in Algorithm Predictions</title>
      <p>We next asked how sensitive is the algorithm to the range of egg densities experienced during training. To do this, we selected images of 8 vials with translucent media and egg numbers ranging in density from â¼15 to â¼410 eggs per vial. After training the algorithm on each of these images, we assessed its ability to retrieve the number of eggs in the same 8 vials (<xref ref-type="fig" rid="pone.0127659.g002">Fig 2</xref>; also see <xref ref-type="supplementary-material" rid="pone.0127659.s001">S1 Fig</xref> for all raw images used to generate all data in this manuscript). We noticed that for a given vial, the predictive accuracy of the baseline algorithm worsened as the corresponding ground truth for that vial deviated more from the mean of the eight vials used for training (<xref ref-type="fig" rid="pone.0127659.g002">Fig 2A</xref>) such that those with ground-truths less than the mean tended to be over-estimated and those with ground-truths above the mean tended to be under-estimated. This effect was also apparent when we repeated the analysis on eight vials containing opaque medium (<xref ref-type="fig" rid="pone.0127659.g002">Fig 2B</xref>). For both media types, there was a strong positive linear correlation between the prediction error and the vial ground-truth count (p &lt; 0.001, linear regression t-test) intersecting the x-axis at the mean of the ground-truth counts for the 8 vials. The bias-variance dilemma is a well-known phenomenon in machine learning and is known to exist in the extremely random decision tree framework [<xref rid="pone.0127659.ref017" ref-type="bibr">17</xref>, <xref rid="pone.0127659.ref024" ref-type="bibr">24</xref>]. Bias results from using a model and/or features which are not perfectly suited to the data being fit. In this case we believe that the bias stems from slight insufficiences in the feature detector, in its ability to discriminate image features that are from eggs partially occluded in clusters. The feature vector although still correlated with density becomes diluted, and so pixels from high density areas will become reduced and pixels from low density areas will become eleviated. Fortunately, the predictable nature of this bias means that knowledge from the training data can be used to apply corrections to the output counts to enhance their accuracy.</p>
      <fig id="pone.0127659.g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>Bias in baseline algorithm predictions can be corrected using linear transformation.</title>
          <p>The baseline algorithm tends to over-estimate low egg counts and under-estimate high egg counts with the error polarity and magnitude related to the mean of the training set. (A-B) error associated with egg counts (y-axis) from a set of vials containing transparent (A) or opaque (B) media selected to span a broad range of ground-truth values (x-axis). There is a significant linear correlation with an x-axis intercept close to the mean of the distribution in these two datasets, confidence interval (95%) is indicated as dashed coloured lines. (C) Through calculating bias correction during training it is possible to correct the baseline predictive estimate for vial counts. The accuracy was improved for 10 different datasets when bias correction was applied, depicted in panel (transparent media; a-e) and (opaque media; f-j). (D) Summary comparison of transparent media datasets without correction (light-blue) and with bias correction (dark-blue) and of opaque media without correction (yellow-orange) and with correction (dark-orange). Bias correction increased accuracy in both media types. Each dataset was captured independently and contains 8 vial images with the exception of e and j which represent the vials depicted in A and B repectively. A Leave-one-out cross-validation strategy was performed for each vial (7 in and 1 out). Accuracy represents average of five statistical replicates, error bars represent SE (n = 5, statistical replicates); * represents P&lt;0.05, Mann-Whitney one-tailed test.</p>
        </caption>
        <graphic xlink:href="pone.0127659.g002"/>
      </fig>
      <p>We assessed the performance of this simple adjustment by using 7 of the 8 images for training and bias calculation and then evaluating the performance on the remaining 8th image, this was repeated for each image in the dataset. This approach was applied to 8 different datasets (a-d, f-j) comprising of independent vial images and datasets (e and j) which represent the data in Fig <xref ref-type="fig" rid="pone.0127659.g002">2A</xref>â<xref ref-type="fig" rid="pone.0127659.g002">2B</xref> respectively. The bias correction improved the algorithm performance for estimating the true egg counts (<xref ref-type="fig" rid="pone.0127659.g002">Fig 2C</xref>) as well as improving the accuracy of the group average (for all the transparent and opaque media datasets) from 89.6% to 93.5% and 76.9% to 85.0% for the transparent and opaque media respectively (<xref ref-type="fig" rid="pone.0127659.g002">Fig 2D</xref>; p&lt;0.01, Wilcoxon 1-tailed pair-wise test) (<xref rid="pone.0127659.t001" ref-type="table">Table 1</xref>).</p>
      <table-wrap id="pone.0127659.t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Performance of algorithm on defined media and SY-media datasets.</title>
        </caption>
        <alternatives>
          <graphic id="pone.0127659.t001g" xlink:href="pone.0127659.t001"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
            </colgroup>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">Media:</td>
                <td align="center" colspan="5" rowspan="1">Defined Media (transparent)</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Dataset:</td>
                <td align="left" rowspan="1" colspan="1">a</td>
                <td align="left" rowspan="1" colspan="1">b</td>
                <td align="left" rowspan="1" colspan="1">c</td>
                <td align="left" rowspan="1" colspan="1">d</td>
                <td align="left" rowspan="1" colspan="1">e</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of vials:</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of eggs:</td>
                <td align="left" rowspan="1" colspan="1">848</td>
                <td align="left" rowspan="1" colspan="1">1847</td>
                <td align="left" rowspan="1" colspan="1">1534</td>
                <td align="left" rowspan="1" colspan="1">505</td>
                <td align="left" rowspan="1" colspan="1">1407</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Baseline Accuracy:</td>
                <td align="left" rowspan="1" colspan="1">93.5 Â± 0.5%</td>
                <td align="left" rowspan="1" colspan="1">86.5 Â± 0.6%</td>
                <td align="left" rowspan="1" colspan="1">93.7 Â± 0.8%</td>
                <td align="left" rowspan="1" colspan="1">91.0 Â± 0.4%</td>
                <td align="left" rowspan="1" colspan="1">83.5 Â± 0.6%</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">QuantiFly Accuracy:</td>
                <td align="left" rowspan="1" colspan="1">94.8 Â± 0.3%</td>
                <td align="left" rowspan="1" colspan="1">93.5 Â± 0.2%</td>
                <td align="left" rowspan="1" colspan="1">96.6 Â± 0.1%</td>
                <td align="left" rowspan="1" colspan="1">92.9 Â± 0.3%</td>
                <td align="left" rowspan="1" colspan="1">89.8 Â± 0.5%</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Media:</td>
                <td align="center" colspan="5" rowspan="1">SY Media (opaque)</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Dataset:</td>
                <td align="left" rowspan="1" colspan="1">f</td>
                <td align="left" rowspan="1" colspan="1">g</td>
                <td align="left" rowspan="1" colspan="1">h</td>
                <td align="left" rowspan="1" colspan="1">i</td>
                <td align="left" rowspan="1" colspan="1">j</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of vials:</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">8</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of eggs:</td>
                <td align="left" rowspan="1" colspan="1">1119</td>
                <td align="left" rowspan="1" colspan="1">671</td>
                <td align="left" rowspan="1" colspan="1">720</td>
                <td align="left" rowspan="1" colspan="1">1533</td>
                <td align="left" rowspan="1" colspan="1">1432</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Baseline Accuracy:</td>
                <td align="left" rowspan="1" colspan="1">85.1 Â± 0.7%</td>
                <td align="left" rowspan="1" colspan="1">75.4 Â± 1.2%</td>
                <td align="left" rowspan="1" colspan="1">81.7 Â± 0.7%</td>
                <td align="left" rowspan="1" colspan="1">76.3 Â± 0.7%</td>
                <td align="left" rowspan="1" colspan="1">65.9 Â± 0.7%</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">QuantiFly Accuracy:</td>
                <td align="left" rowspan="1" colspan="1">86.9 Â± 0.2%</td>
                <td align="left" rowspan="1" colspan="1">89.1 Â± 0.3%</td>
                <td align="left" rowspan="1" colspan="1">82.2 Â± 0.3%</td>
                <td align="left" rowspan="1" colspan="1">85.7 Â± 0.3%</td>
                <td align="left" rowspan="1" colspan="1">83.0 Â± 0.6%</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="t001fn001">
            <p>Datasets contain 8 vial images. A Leave-one-out cross-validation strategy was performed for each vial (7 in and 1 out). Standard error was generated from n = 5 trials (statistical replicates). QuantiFly Accuracy represents the baseline algorithm with the bias correction.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec id="sec011">
      <title>Introducing QuantiFly Software</title>
      <p>To implement the described technique in a user-friendly form, we developed a software package called QuantiFly. This consists of the baseline algorithm with the bias correction, along with a novel ROI labelling interface. Although the software can in principle be tuned to any counting task, such as cells in microscopy images or microbial colonies on plates, the parameters and user interface of our software have been developed for the task of <italic>Drosophila</italic> egg counting. A full user manual is available in <xref ref-type="supplementary-material" rid="pone.0127659.s002">S1 Text</xref>.</p>
      <p>The workflow for QuantiFly training involves two stages: first the user is required to train the algorithm by identifying eggs within a few ROIs on several exemplar images, and; second, the software uses the model trained from step 1 to identify eggs in a batch of images. To initiate training, the user loads an image via a conventional file-menu interface, selects a rectangular ROI within the image to annotate and then identifies and labels instances of eggs within that region (<xref ref-type="fig" rid="pone.0127659.g003">Fig 3</xref>). Once a sufficient number of regions have been selected and labelled (see <xref ref-type="fig" rid="pone.0127659.g004">Fig 4</xref>), the algorithm is trained and the input image evaluated. The evaluated image is presented to the user as a density interpretation of the original image. After inspection of this image the user can alter the corresponding training labels, either to be more inclusive by selecting areas that are poorly represented, or more conservative by excluding points that the user does not want counted (e.g. artefacts or miss-clicks). Once three or more ROI have been labelled it is then possible to correct for bias in the image. The corrected output count is displayed along with confidence intervals (95%) which provide some feed-back as to the effectiveness of the correction. The more narrow the confidence interval is around the predicted count the more certain the user can be that the correction is having a positive impact on the given image. Once this tuning phase is complete, the refined algorithm can be used to evaluate a batch of images and the data is returned to the user as counts in a spreadsheet.</p>
      <fig id="pone.0127659.g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>Schematic illustration of training and evaluation modes of QuantiFly software.</title>
          <p>(Left) Training mode: steps required to train a QuantiFly model to recognise eggs in an image scene. (Right) Evaluation mode: steps involved with evaluating a bulk number of images with a pre-trained model. Blue circles depict points at which a user must provide information to the system, either specifying input/output locations of files or through labelling eggs in images.</p>
        </caption>
        <graphic xlink:href="pone.0127659.g003"/>
      </fig>
      <fig id="pone.0127659.g004" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>Characterisation of the quantity of training material required to achieve high prediction accuracy with QuantiFly software.</title>
          <p>The QuantiFly software accuracy was compared on transparent and opaque media datasets after training with 1â7 training images. (A) Average accuracy of algorithm when compared to digital ground-truth for transparent media datasets (a-e). (B) Average number of eggs labelled for each level of training for transparent media dataset. (C) Average accuracy of algorithm when compared to digital ground-truth for opaque media datasets (f-j) (D) Average number of eggs labelled for each level of training for opaque media dataset. Each level of training was performed on every image in the dataset and repeated 5 x. for each dataset and the accuracy averaged across all data. Error bars are SE. Students t-test paired two-way analysis was performed on data (p&lt;0.05)</p>
        </caption>
        <graphic xlink:href="pone.0127659.g004"/>
      </fig>
    </sec>
    <sec id="sec012">
      <title>Training Requirements of QuantiFly Software</title>
      <p>The flexible QuantiFly training interface allows whole images or sub-regions of images to be labeled and submitted for training. For a given image or media type however, it is desirable to know how much training is required to achieve top predictive performance. To assess this, we took 8 images with corresponding ground-truths and used a cross validation strategy to characterise the accuracy. For this, one of the 8 images in a group was omitted from training and an increasing number of the remaining 7 images was used to train a different naÃ¯ve model. With each of these 7 trained models, the system was used to evaluate the unseen 8th image and the accuracy of the prediction calculated by comparing it to the ground-truth count for that vial. This whole process was then repeated seven more times with the unseen test image being rotated for each iteration. Finally, the entire sequence was repeated for each of 10 different sets of 8 vials: 5 sets with transparent media (<xref ref-type="fig" rid="pone.0127659.g004">Fig 4a</xref>; groups a-e), and; 5 sets with opaque media (<xref ref-type="fig" rid="pone.0127659.g004">Fig 4A</xref>; groups f-j).</p>
      <p>The quality of the QuantiFly software prediction varied depending on the number of images used in the training. In most cases the performance of the algorithm increased dramatically when the training was increased from one image to two images while a few of the datasets required only one dataset for high quality predictions (<xref ref-type="fig" rid="pone.0127659.g004">Fig 4A</xref> groups a, b, e). Training on more than two images produced significant improvements in two of the 10 groups of vials tested (<xref ref-type="fig" rid="pone.0127659.g004">Fig 4C</xref>, groups h and j)(p&lt;0.05, Students t-test). To assure high accuracy for all types of media, we recommend 5 or more images to be used for training, which for the vials in this example, corresponded to approximately 600 labelled eggs (Fig <xref ref-type="fig" rid="pone.0127659.g004">4B</xref> and <xref ref-type="fig" rid="pone.0127659.g004">4D</xref>). Although QuantiFly can provide highly accurate output predictions from a modest amount of training data it is important to highlight that experiments should be designed with biological variation in mind. To this end, it is important, for a given condition, that at least 10 vials be used and potentially more depending on the magnitude of the differences expected between the conditions being studied. This level of replication should account for outliers and variation originating from biological noise and vial preparation differences.</p>
    </sec>
    <sec id="sec013">
      <title>Performance Compared to Human Counters</title>
      <p>The current standard for quantifying egg laying involves a laboratory researcher inspecting individual vials under a dissecting microscope and scoring eggs with a hand-held tally counter. To compare the performance of QuantiFly to that of a human, we recreated an experiment we would normally perform in our laboratory. For each of four nutritionally different translucent media, we prepared 10 vials (40 vials, <xref ref-type="fig" rid="pone.0127659.g005">Fig 5A</xref>) and for 4 different opaque media we prepared 5 vials (20 vials, <xref ref-type="fig" rid="pone.0127659.g005">Fig 5B</xref>). In each of these vials, 5 mated females were maintained for â¼18 hours, at which point the flies were removed and the eggs scored manually. The vials were then photographed under controlled lighting conditions and two randomly chosen images from each condition (8 in total) were used to train the system. In each case, a skilled human operator annotated the eggs on screen in the eight training images and used these annotations to train the system. When comparing the performance of QuantiFly versus the human manual count to assess the number of eggs per vial for all vials, we found that the data were highly similar, such that for the translucent media, all four conditions were distributed in the same way for both counting methods. Moreover, the absolute values between conditions were highly similar (<xref rid="pone.0127659.t002" ref-type="table">Table 2</xref>). Similarly, for the opaque media, we found good concordance between QuantiFly and manual counts although at very high egg densities (200â400 eggs per vial) QuantiFly scored fewer eggs than the manual counter. (<xref rid="pone.0127659.t002" ref-type="table">Table 2</xref>). To investigate the source of these differences, we generated a comprehensive digital on-screen count for each vial and compared these data with the manual count and QuantiFly estimates (Fig <xref ref-type="fig" rid="pone.0127659.g005">5a</xref> and <xref ref-type="fig" rid="pone.0127659.g005">5b</xref>). This revealed that the QuantiFly output more closely resembled the digital human counts than the manual counts (<xref rid="pone.0127659.t002" ref-type="table">Table 2</xref>). These differences could arise due to the process of image capture obscuring some eggs that can only be counted manually, and / or, the accuracy of manual counting decreasing at very high egg densities due to egg clustering (e.g. <xref ref-type="fig" rid="pone.0127659.g005">Fig 5c</xref>) and counter fatigue.</p>
      <fig id="pone.0127659.g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>Comparison of QuantiFly performance when compared to human counter.</title>
          <p>Digital images were captured for four nutritionally different transparent media (A; C1-C4) and 4 different opaque media (B; D1-4). Estimates of the eggs in each vial were compared for the following methods: automated counts from QuantiFly algorithm; manual counts from a human and a digital on-screen ground-truth count (grey). (C) Image of opaque media vial with densely clustered eggs, red arrow 2 shows region with high-level of clustering. Error bars represent standard error of differences in vial densities in each condition (C1-4, n = 8; D1-4, n = 5 vials per condition).</p>
        </caption>
        <graphic xlink:href="pone.0127659.g005"/>
      </fig>
      <table-wrap id="pone.0127659.t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Performance of QuantiFly on transparent and opaque media compared to human manual counts and digital ground-truth counts for each dataset.</title>
        </caption>
        <alternatives>
          <graphic id="pone.0127659.t002g" xlink:href="pone.0127659.t002"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
              <col align="left" valign="top" span="1"/>
            </colgroup>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">Media:</td>
                <td align="center" colspan="10" rowspan="1">Defined Media (transparent)</td>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: C1</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 10 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">78.1 Â± 9.5</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1">0.92</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.05</td>
                <td align="left" rowspan="1" colspan="1">0.78</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">75.2 Â± 5.0</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.04</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1">0.05</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.42</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">72.1 Â± 5.1</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">1.08</td>
                <td align="left" rowspan="1" colspan="1">1.04</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.78</td>
                <td align="left" rowspan="1" colspan="1">0.42</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: C2</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 10 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">111.3 Â± 10.4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.87</td>
                <td align="left" rowspan="1" colspan="1">0.80</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.89</td>
                <td align="left" rowspan="1" colspan="1">0.88</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">96.6 Â± 8.4</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.15</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.92</td>
                <td align="left" rowspan="1" colspan="1">0.89</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.83</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">88.8 Â± 6.7</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">1.25</td>
                <td align="left" rowspan="1" colspan="1">1.09</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.88</td>
                <td align="left" rowspan="1" colspan="1">0.83</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: C3</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 10 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">185.5 Â± 5.8</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.05</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">1.17</td>
                <td align="left" rowspan="1" colspan="1">1.01</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.57</td>
                <td align="left" rowspan="1" colspan="1">0.65</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">216.6 Â± 11.9</td>
                <td align="left" rowspan="1" colspan="1">0.05</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">0.86</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.87</td>
                <td align="left" rowspan="1" colspan="1">0.57</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.90</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">187.7 Â± 6.8</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.99</td>
                <td align="left" rowspan="1" colspan="1">1.15</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.65</td>
                <td align="left" rowspan="1" colspan="1">0.90</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: C4</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 10 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">22.6 Â± 6.2</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">1.69</td>
                <td align="left" rowspan="1" colspan="1">1.51</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.95</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">38.1 Â± 5.6</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">0.59</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.90</td>
                <td align="left" rowspan="1" colspan="1">0.95</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.97</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">34.2 Â± 5.2</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.66</td>
                <td align="left" rowspan="1" colspan="1">1.11</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1">0.97</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Media:</td>
                <td align="center" colspan="10" rowspan="1">SY Media (opaque)</td>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: D1</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 5 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">80.6 Â± 13.5</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.78</td>
                <td align="left" rowspan="1" colspan="1">0.76</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.98</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">62.8 Â± 7.6</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.28</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.98</td>
                <td align="left" rowspan="1" colspan="1">0.98</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.98</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">61.6 Â± 6.6</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">1.31</td>
                <td align="left" rowspan="1" colspan="1">1.02</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.98</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: D2</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 5 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">72.1 Â± 25.7</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1">0.82</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.97</td>
                <td align="left" rowspan="1" colspan="1">0.97</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">69.0 Â± 11.4</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.04</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.86</td>
                <td align="left" rowspan="1" colspan="1">0.97</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.96</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">59.4 Â± 10.4</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">1.21</td>
                <td align="left" rowspan="1" colspan="1">1.16</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1">0.96</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: D3</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 5 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">233.4 Â± 17.6</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">1.41</td>
                <td align="left" rowspan="1" colspan="1">1.18</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.91</td>
                <td align="left" rowspan="1" colspan="1">0.75</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">329.2 Â± 29.2</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">0.71</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.83</td>
                <td align="left" rowspan="1" colspan="1">0.91</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.94</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">274.6 Â± 36.9</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.85</td>
                <td align="left" rowspan="1" colspan="1">1.20</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.75</td>
                <td align="left" rowspan="1" colspan="1">0.94</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="center" colspan="2" rowspan="1">Condition: D4</td>
                <td align="center" colspan="3" rowspan="1">Pairwise</td>
                <td align="center" colspan="3" rowspan="1">Fold Difference</td>
                <td align="center" colspan="3" rowspan="1">correlation</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">(countÂ±SE; 5 vials)</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">D</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Q</td>
                <td align="left" rowspan="1" colspan="1">282.8 Â± 47.2</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">1.51</td>
                <td align="left" rowspan="1" colspan="1">1.13</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.67</td>
                <td align="left" rowspan="1" colspan="1">0.56</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">M</td>
                <td align="left" rowspan="1" colspan="1">428.2 Â±18.4</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">0.66</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.75</td>
                <td align="left" rowspan="1" colspan="1">0.67</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.77</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">D</td>
                <td align="left" rowspan="1" colspan="1">320.2 Â± 44.1</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1">ns</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">0.88</td>
                <td align="left" rowspan="1" colspan="1">1.34</td>
                <td align="left" rowspan="1" colspan="1">1.00</td>
                <td align="left" rowspan="1" colspan="1">0.56</td>
                <td align="left" rowspan="1" colspan="1">0.77</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="t002fn001">
            <p>Q:QuantiFly prediction, M: Manual human counts, D: Digital ground-truth counts. Pairwise: Tukeys pairwise comparison; Fold Difference; the fold difference between counts; Correlation, Pearsons correlation coefficient for each comparison.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec id="sec014">
      <title>Sample Size Calculation and Time Analysis</title>
      <p>A major advantage to an automated system for egg counting is its ability to save time. For the transparent media shown in <xref ref-type="fig" rid="pone.0127659.g005">Fig 5A</xref>, the human manual counts took on average 48.9 Â± 3.9 s for each vial, taking 33 min in total for all 40 vials. In contrast, for the QuantiFly software, 10 min was required to annotate images and to train the software and only a few seconds was then required for the software to evaluate each image in the dataset. Thus, we achieved a significant time saving with only a relatively small experiment and since the time investment into training is only made once, the user would save an additional â¼45 seconds for each additional vial added to the experiment.</p>
      <p>To illustrate this saving, we found the relationship between the average vial count and the standard deviation for each condition in <xref ref-type="fig" rid="pone.0127659.g005">Fig 5</xref> and calculated the number of replicates required to achieve significance for a 1.1 fold egg count difference (<xref ref-type="fig" rid="pone.0127659.g006">Fig 6A</xref>). For a researcher to distinguish conditions, which for example are 50 and 45, would take 70 replicates for manual counts and 80 replicates for QuantiFly. This would take a human counter approximately one hour of consistent counting whereas this experiment would take approximately 13 minutes using QuantiFly (<xref ref-type="fig" rid="pone.0127659.g006">Fig 6B</xref>). In fact, we predict QuantiFly should save time for any single food type experiment in which more than 13 vials need to be counted (<xref ref-type="fig" rid="pone.0127659.g006">Fig 6B</xref>). Furthermore, given that the main overhead with the QuantiFly software is the training phase, we have made it possible to evaluate the performance of more than one pre-saved model on the given data without significant investment of time. If a batch of models had been saved from previous training data then it is straight-forward with the software to evaluate more than one model and to compare the results. If acquisition settings are particularly consistent over-time then it may be possible to reuse models from previous experiments without the need to retrain each time, thus saving additional time.</p>
      <fig id="pone.0127659.g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0127659.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <title>Sample size calculation.</title>
          <p>(A) The number of replicates required to achieve a confidence interval of below 0.05 was calculated for the manual human count compared to the QuantiFly software using population standard deviation calculated from Fig <xref ref-type="fig" rid="pone.0127659.g005">5A</xref> and <xref ref-type="fig" rid="pone.0127659.g005">5C</xref>. Plot represents the number of replicates required to separate conditions which differ by 1.1 fold. (B) Projected time requirements for counting vials for a single condition using the existing manual approach or the QuantiFly software.</p>
        </caption>
        <graphic xlink:href="pone.0127659.g006"/>
      </fig>
    </sec>
    <sec id="sec015">
      <title>Conclusions</title>
      <p>We report the testing, optimisation and implementation of a machine-learning technique for the task of automating <italic>Drosophila</italic> egg counting. In doing so, we transformed a conceptual algorithm accessible only to computer scientists, into a user-friendly piece of software called QuantiFly. During this process we identified a limitation in the baseline algorithm and corrected for it with a simple transformation improving the accuracy of the algorithm. The software is available and compiled for the three major operating systems and the only additional equipment required is to provide a means to capture digital images of the eggs. For this purpose, we have also designed a box that serves as a camera mount and offers controlled lighting conditions. For plans and pictures of this hardware, as well as the possibility of ordering it, please visit:<ext-link ext-link-type="uri" xlink:href="http://polygonaltree.github.io/egg_counter/">http://polygonaltree.github.io/egg_counter/</ext-link>. QuantiFly is both accurate and offers enormous timesaving potential to any individual facing the unenviable task of counting fly eggs.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="sec016">
    <title>Supporting Information</title>
    <supplementary-material content-type="local-data" id="pone.0127659.s001">
      <label>S1 Fig</label>
      <caption>
        <title>Vial Images used in study.</title>
        <p>Images of vials used in datasets a-j and in conditions C1-C4 and D1-D4 for human manual count versus QuantiFly predictions.</p>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pone.0127659.s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0127659.s002">
      <label>S1 Text</label>
      <caption>
        <title>User manual for using QuantiFly software.</title>
        <p>Step-by-step instructions for the training of QuantiFly software and also how to perform bulk evaluation of images.</p>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pone.0127659.s002.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We acknowledge the contribution of Ms Xiaoli He and Dr Sahar Emran for contributing food and manual egg counts. We acknowledge Luis Garcia for his work towards designing and constructing the illumination box for image acquisition.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0127659.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Eliceiri</surname><given-names>KW</given-names></name>, <name><surname>Berthold</surname><given-names>MR</given-names></name>, <name><surname>Goldberg</surname><given-names>IG</given-names></name>, <name><surname>IbaÅáº½z</surname><given-names>L</given-names></name>, <name><surname>Manjunath</surname><given-names>B</given-names></name>, <name><surname>Martone</surname><given-names>ME</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>Biological imaging software tools</article-title>. <source>Nature methods</source>
<volume>9</volume>: <fpage>697</fpage>â<lpage>710</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.2084</pub-id>
<?supplied-pmid 22743775?><pub-id pub-id-type="pmid">22743775</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0127659.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Schindelin</surname><given-names>J</given-names></name>, <name><surname>Arganda-Carreras</surname><given-names>I</given-names></name>, <name><surname>Frise</surname><given-names>E</given-names></name>, <name><surname>Kaynig</surname><given-names>V</given-names></name>, <name><surname>Longair</surname><given-names>M</given-names></name>, <name><surname>Pietzsch</surname><given-names>T</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>Fiji: an open-source platform for biological-image analysis</article-title>. <source>Nature methods</source>
<volume>9</volume>: <fpage>676</fpage>â<lpage>682</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id>
<?supplied-pmid 22743772?><pub-id pub-id-type="pmid">22743772</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0127659.ref003">
      <label>3</label>
      <mixed-citation publication-type="book"><name><surname>Kanade</surname><given-names>T</given-names></name>, <name><surname>Yin</surname><given-names>Z</given-names></name>, <name><surname>Bise</surname><given-names>R</given-names></name>, <name><surname>Huh</surname><given-names>S</given-names></name>, <name><surname>Eom</surname><given-names>S</given-names></name>, <name><surname>Sandboth</surname><given-names>MF</given-names></name>, <etal>et al</etal> (<year>2011</year>) <chapter-title>Cell image analysis: Algorithms, system and applications</chapter-title> In: <source>Applications of Computer Vision (WACV), 2011 IEEE Workshop on</source>. <publisher-name>IEEE</publisher-name>, pp. <fpage>374</fpage>â<lpage>381</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Schneider</surname><given-names>CA</given-names></name>, <name><surname>Rasband</surname><given-names>WS</given-names></name>, <name><surname>Eliceiri</surname><given-names>KW</given-names></name>, <name><surname>Schindelin</surname><given-names>J</given-names></name>, <name><surname>Arganda-Carreras</surname><given-names>I</given-names></name>, <name><surname>Frise</surname><given-names>E</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>671 nih image to imagej: 25 years of image analysis</article-title>. <source>Nature methods</source>
<volume>9</volume>: <fpage>671675</fpage>
<pub-id pub-id-type="doi">10.1038/nmeth.2089</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref005">
      <label>5</label>
      <mixed-citation publication-type="other">Lee H, Grosse R, Ranganath R, Ng AY (2009) Convolutional deep belief networks for scalable unsupervised learning of hierarchical representations. In: Proceedings of the 26th Annual International Conference on Machine Learning. ACM, pp. 609â616.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref006">
      <label>6</label>
      <mixed-citation publication-type="other">OÅeilly M, Roth A, HÃ¤usser M, Griffin LD (2011) A circle-based method for detection of neural fibre cross-sections in classically stained 2d electron micrographs.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref007">
      <label>7</label>
      <mixed-citation publication-type="book"><name><surname>Arteta</surname><given-names>C</given-names></name>, <name><surname>Lempitsky</surname><given-names>V</given-names></name>, <name><surname>Noble</surname><given-names>JA</given-names></name>, <name><surname>Zisserman</surname><given-names>A</given-names></name> (<year>2012</year>) <source>Learning to detect cells using non-overlapping extremal regions</source>, <publisher-name>MICCAI</publisher-name> pp. <fpage>348</fpage>â<lpage>356</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Huh</surname><given-names>S</given-names></name>, <name><surname>Ker</surname><given-names>DFE</given-names></name>, <name><surname>Bise</surname><given-names>R</given-names></name>, <name><surname>Chen</surname><given-names>M</given-names></name>, <name><surname>Kanade</surname><given-names>T</given-names></name> (<year>2011</year>) <article-title>Automated mitosis detection of stem cell populations in phase-contrast microscopy images</article-title>. <source>Medical Imaging, IEEE Transactions on</source>
<volume>30</volume>: <fpage>586</fpage>â<lpage>596</lpage>. <pub-id pub-id-type="doi">10.1109/TMI.2010.2089384</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Grandison</surname><given-names>RC</given-names></name>, <name><surname>Piper</surname><given-names>MD</given-names></name>, <name><surname>Partridge</surname><given-names>L</given-names></name> (<year>2009</year>) <article-title>Amino-acid imbalance explains extension of lifespan by dietary restriction in Drosophila</article-title>. <source>Nature</source>
<volume>462</volume>: <fpage>10611064</fpage>
<pub-id pub-id-type="doi">10.1038/nature08619</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref010">
      <label>10</label>
      <mixed-citation publication-type="book"><name><surname>Lempitsky</surname><given-names>V</given-names></name>, <name><surname>Zisserman</surname><given-names>A</given-names></name> (<year>2010</year>) <source>Learning to count objects in images</source>. <publisher-name>NIPS</publisher-name>: <fpage>1324</fpage>â<lpage>1332</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref011">
      <label>11</label>
      <mixed-citation publication-type="book"><name><surname>Fiaschi</surname><given-names>L</given-names></name>, <name><surname>Koethe</surname><given-names>U</given-names></name>, <name><surname>Nair</surname><given-names>R</given-names></name>, <name><surname>Hamprecht</surname><given-names>FA</given-names></name> (<year>2012</year>). <source>Learning to count with regression forest and structured labels</source>. <publisher-name>ICPR</publisher-name>, <fpage>2685</fpage>â<lpage>2688</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Julesz</surname><given-names>B</given-names></name> (<year>1981</year>) <article-title>Textons, the elements of texture perception, and their interactions</article-title>. <source>Nature</source>
<volume>290</volume>: <fpage>91</fpage>â<lpage>97</lpage>. <pub-id pub-id-type="doi">10.1038/290091a0</pub-id>
<?supplied-pmid 7207603?><pub-id pub-id-type="pmid">7207603</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0127659.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Daugman</surname><given-names>JG</given-names></name> (<year>1985</year>) <article-title>Uncertainty relation for resolution in space, spatial frequency, and orientation optimized by two-dimensional visual cortical filters</article-title>. <source>JOSA A</source>
<volume>2</volume>: <fpage>1160</fpage>â<lpage>1169</lpage>. <pub-id pub-id-type="doi">10.1364/JOSAA.2.001160</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Simoncelli</surname><given-names>EP</given-names></name>, <name><surname>Freeman</surname><given-names>WT</given-names></name>, <name><surname>Adelson</surname><given-names>EH</given-names></name>, <name><surname>Heeger</surname><given-names>DJ</given-names></name> (<year>1992</year>) <article-title>Shiftable multiscale transforms</article-title>. <source>Information Theory, IEEE Transactions on</source>
<volume>38</volume>: <fpage>587</fpage>â<lpage>607</lpage>. <pub-id pub-id-type="doi">10.1109/18.119725</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Varma</surname><given-names>M</given-names></name>, <name><surname>Zisserman</surname><given-names>A</given-names></name> (<year>2005</year>) <article-title>A statistical approach to texture classification from single images</article-title>. <source>International Journal of Computer Vision</source>
<volume>62</volume>: <fpage>61</fpage>â<lpage>81</lpage>. <pub-id pub-id-type="doi">10.1023/B:VISI.0000046589.39864.ee</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref016">
      <label>16</label>
      <mixed-citation publication-type="other">Dietterich TG (2000) Ensemble methods in machine learning, Lecture Notes in Computer Science Volume 1857. pp. 1â15.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Geurts</surname><given-names>P</given-names></name>, <name><surname>Ernst</surname><given-names>D</given-names></name>, <name><surname>Wehenkel</surname><given-names>L</given-names></name> (<year>2006</year>) <article-title>Extremely randomized trees</article-title>. <source>Machine learning</source>
<volume>63</volume>: <fpage>3</fpage>â<lpage>42</lpage>. <pub-id pub-id-type="doi">10.1007/s10994-006-6226-1</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref018">
      <label>18</label>
      <mixed-citation publication-type="other">Criminisi A, Shotton J, Konukoglu E (2011) Decision forests for classification, regression, density estimation, manifold learning and semi-supervised learning.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref019">
      <label>19</label>
      <mixed-citation publication-type="other">Rossum G (1995) Python tutorial.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Piper</surname><given-names>MD</given-names></name>, <name><surname>Partridge</surname><given-names>L</given-names></name>, <name><surname>Raubenheimer</surname><given-names>D</given-names></name>, <name><surname>Simpson</surname><given-names>SJ</given-names></name> (<year>2011</year>) <article-title>Dietary restriction and aging: A unifying perspective</article-title>. <source>Cell Metabolism</source>
<volume>14</volume>: <fpage>154</fpage>â<lpage>160</lpage>. <pub-id pub-id-type="doi">10.1016/j.cmet.2011.06.013</pub-id>
<?supplied-pmid 21803286?><pub-id pub-id-type="pmid">21803286</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0127659.ref021">
      <label>21</label>
      <mixed-citation publication-type="other">KÃ¶the U (1999) 6 reusable software in computer vision.</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Bass</surname><given-names>TM</given-names></name>, <name><surname>Grandison</surname><given-names>RC</given-names></name>, <name><surname>Wong</surname><given-names>R</given-names></name>, <name><surname>Martinez</surname><given-names>P</given-names></name>, <name><surname>Partridge</surname><given-names>L</given-names></name>, <name><surname>Piper</surname><given-names>M</given-names></name> (<year>2007</year>) <article-title>Optimization of dietary restriction protocols in drosophila</article-title>. <source>The Journals of Gerontology Series A: Biological Sciences and Medical Sciences</source>
<volume>62</volume>: <fpage>1071</fpage>â<lpage>1081</lpage>. <pub-id pub-id-type="doi">10.1093/gerona/62.10.1071</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Piper</surname><given-names>MD</given-names></name>, <name><surname>Blanc</surname><given-names>E</given-names></name>, <name><surname>Leit ao-Gon calves</surname><given-names>R</given-names></name>, <name><surname>Yang</surname><given-names>M</given-names></name>, <name><surname>He</surname><given-names>X</given-names></name>, <name><surname>Linford</surname><given-names>NJ</given-names></name> (<year>2013</year>) <article-title>A holidic medium for drosophila melanogaster</article-title>. <source>Nature methods</source>
<volume>11</volume>(<issue>9</issue>):<fpage>971</fpage>
<pub-id pub-id-type="doi">10.1038/nmeth0914-971c</pub-id>
</mixed-citation>
    </ref>
    <ref id="pone.0127659.ref024">
      <label>24</label>
      <mixed-citation publication-type="book"><name><surname>Hastie</surname><given-names>T</given-names></name>, <name><surname>Tibshirani</surname><given-names>R</given-names></name>, <name><surname>Friedman</surname><given-names>J</given-names></name>, <name><surname>Hastie</surname><given-names>T</given-names></name>, <name><surname>Friedman</surname><given-names>J</given-names></name>, <name><surname>Tibshirani</surname><given-names>R</given-names></name> (<year>2009</year>) <source>The elements of statistical learning</source>, <volume>volume 2</volume>
<publisher-name>Springer</publisher-name>.</mixed-citation>
    </ref>
  </ref-list>
</back>
