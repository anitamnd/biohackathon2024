<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6791524</article-id>
    <article-id pub-id-type="pmid">31501545</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-019-0535-3</article-id>
    <article-id pub-id-type="manuscript">nihpa1534578</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Supervised classification enables rapid annotation of cell atlases</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Pliner</surname>
          <given-names>Hannah A.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Shendure</surname>
          <given-names>Jay</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
        <xref rid="CR1" ref-type="corresp">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Trapnell</surname>
          <given-names>Cole</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A4">4</xref>
        <xref rid="CR1" ref-type="corresp">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Genome Sciences, University of Washington, Seattle, WA 98195, USA</aff>
    <aff id="A2"><label>2</label>Brotman Baty Institute for Precision Medicine, Seattle, WA 98195, USA</aff>
    <aff id="A3"><label>3</label>Howard Hughes Medical Institute, Seattle, WA 98195, USA</aff>
    <aff id="A4"><label>4</label>Allen Discovery Center for Cell Lineage Tracing, Seattle, WA 98195, USA</aff>
    <author-notes>
      <fn fn-type="con" id="FN1">
        <p id="P1">Author Contributions</p>
        <p id="P2">C.T. and J.S. conceived the project. H.A.P. wrote Garnett and led data analysis. H.A.P., C.T. and J.S. wrote the manuscript.</p>
      </fn>
      <corresp id="CR1"><label>*</label>Corresponding authors <email>shendure@uw.edu</email><email>coletrap@uw.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>18</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>09</day>
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>09</day>
      <month>3</month>
      <year>2020</year>
    </pub-date>
    <volume>16</volume>
    <issue>10</issue>
    <fpage>983</fpage>
    <lpage>986</lpage>
    <!--elocation-id from pubmed: 10.1038/s41592-019-0535-3-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<uri xlink:type="simple" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract id="ABS1">
      <p id="P3">Single cell molecular profiling technologies are gaining rapid traction, but the manual process by which resulting cell types are typically annotated is labor-intensive and rate-limiting. We describe Garnett, an algorithm and accompanying software for rapidly annotating cell types in scRNA-seq and scATAC-seq datasets, based on an interpretable, hierarchical markup language of cell type-specific genes. Garnett successfully classifies cell types in tissue and whole organism datasets, as well as across species.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P4">Single-cell transcriptional profiling (scRNA-seq) is a powerful means of cataloging the myriad cell types present in multicellular organisms<sup><xref rid="R1" ref-type="bibr">1</xref></sup>. The computational steps of constructing a cell atlas typically include unsupervised clustering of cells based on their gene expression profiles, followed by annotation of known cell types amongst the resulting clusters<sup><xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref></sup>. For the latter task, there are at least four key challenges. First, cell type annotation is labor intensive, requiring extensive literature review of cluster-specific genes<sup><xref rid="R4" ref-type="bibr">4</xref></sup>. Second, any revision to the analysis (<italic>e.g</italic>. additional data, parameter adjustment) necessitates manual reevaluation of all previous annotations. Third, annotations are not easily transferred between datasets generated by independent groups on related tissues, resulting in wasteful repetition of effort. Finally, annotation labels are typically <italic>ad hoc</italic>; although ontologies of cell types exist<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R6" ref-type="bibr">6</xref></sup>, we lack tools for systematically applying these ontologies to scRNA-seq data. Collectively, these challenges hinder progress towards a consensus framework for cell types and the features that define them.</p>
  <p id="P5">Towards addressing these challenges, we devised Garnett (<xref rid="F1" ref-type="fig">Figure 1A</xref>). Garnett consists of four components. First, Garnett defines a markup language for specifying cell types using the genes that they specifically express. The markup language is hierarchical in that a cell type can have subtypes (<italic>e.g</italic>. CD4+ and CD8+ are subsets of T cells). Second, Garnett includes a parser that processes the markup file together with a single-cell dataset, identifying representative cells bearing markers that unambiguously identify them as one of the cell types defined in the file. Third, Garnett trains a classifier that recognizes additional cells as belonging to each cell type based on their similarity to representative cells, similar to an approach that our groups recently developed for annotating a single cell mouse atlas of chromatin accessibility<sup><xref rid="R7" ref-type="bibr">7</xref></sup>. Importantly, Garnett does not require that cells be organized into clusters, but it can optionally extend classifications to additional cells using either its own internal clustering routines or those of other tools. Finally, Garnett provides a method for applying a markup file together with a classifier trained on one dataset to rapidly annotate additional datasets.</p>
  <p id="P6">We tested Garnett on a benchmark scRNA-seq dataset comprising 94,571 immunophenotyped peripheral blood mononuclear cells (PBMCs), generated with the 10X Chromium platform<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. Garnett requires ≥1 marker gene for each cell type. To classify the PBMCs, we populated a marker file including each of the expected cell types using literature-based markers. As a supervised method, Garnett’s accuracy will be dependent on these markers, so we devised a measure of each marker’s usefulness for the purposes of Garnett classification (see <xref rid="S1" ref-type="sec">Methods</xref>). We used this quality metric to exclude poorly scoring markers (ambiguity &gt; 0.5) before proceeding with classification (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1A</xref>).</p>
  <p id="P7">Garnett assigned 71% (3% incorrect, 26% unclassified) of cells to the correct type (“cluster-agnostic type”), with 34% of T cells also receiving a correct subtype classification (41% not subclassified, 23% unclassified, 2% incorrect) (<xref rid="F1" ref-type="fig">Figure 1B</xref>–<xref rid="F1" ref-type="fig">C</xref>). Cells remaining unlabeled were comparably distributed amongst immunophenotypes. Moreover, by expanding cell type assignments to nearby cells using Louvain clustering<sup><xref rid="R9" ref-type="bibr">9</xref></sup> (“cluster-extended type”), correct assignments increased to 94% (2% incorrect, 4% unclassified), with 91% of T cells also receiving a correct subtype classification (8% not subclassified, &lt;1% unclassified, &lt;1% incorrect).</p>
  <p id="P8">We next evaluated Garnett’s ability to classify data not seen during training by analyzing PBMCs that were profiled to a higher molecular depth with a different library preparation method and a different Chromium system (“V2”) (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1B</xref>). Because these cells were unsorted, we manually assigned cell types to clusters based on classic markers (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1C</xref>–<xref rid="SD3" ref-type="supplementary-material">D</xref>). Although trained on sparser molecular data from a different method and instrument, classification accuracy remained high, with 80% (3% incorrect, 17% unclassified) of cells correctly labeled with cluster-agnostic type and 95% (3% incorrect, 2% unclassified) with cluster-extended type (<xref rid="F1" ref-type="fig">Figure 1D</xref>–<xref rid="F1" ref-type="fig">E</xref>). Of note, when trained on these more deeply profiled V2 cells, Garnett also accurately classified the more sparsely profiled V1 cells (83% correct with cluster-agnostic type and 95% correct with cluster-extended) (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1E</xref>–<xref rid="SD3" ref-type="supplementary-material">G</xref>). We furthermore used the PBMC datasets to explore the limits of Garnett and found that the algorithm was robust to rare and missing cell types and low data quality (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figures 2</xref> and <xref rid="SD3" ref-type="supplementary-material">3</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
  <p id="P9">To assess Garnett’s ability to catalog cell types in complex solid tissues, we analyzed lung tissue data from two recently reported cell atlases, the Mouse Cell Atlas (MCA)<sup><xref rid="R3" ref-type="bibr">3</xref></sup> and Tabula Muris (TM)<sup><xref rid="R2" ref-type="bibr">2</xref></sup>. We defined a single hierarchy of expected lung cell types based on those studies and compiled marker genes from literature to recognize them in each dataset (marker files are <xref rid="SD1" ref-type="supplementary-material">Supplementary Files</xref>, consensus cell type names in <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). Overall, Garnett’s classifications agreed with both the MCA (58% correct, 29% unclassified with cluster-agnostic type; 65% correct, 23% unclassified with cluster-extended type; <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 4A</xref>–<xref rid="SD3" ref-type="supplementary-material">B</xref>) and TM (71% correct, 22% unclassified with cluster-agnostic type; 87% correct, 8% unclassified with cluster-extended type; <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 4C</xref>–<xref rid="SD3" ref-type="supplementary-material">D</xref>) annotations, which were derived by manual inspection of genes enriched in each cluster. Moreover, a Garnett model trained on the MCA accurately classified the TM cells and vice versa (trained on MCA: 82% correct, 5% unclassified with cluster-agnostic type; 86% correct, 2% unclassified with cluster-extended type; trained on TM: 46% correct, 30% unclassified with cluster-agnostic type; 56% correct, 21% unclassified with cluster-extended type; <xref rid="SD3" ref-type="supplementary-material">Supplementary Figures 4E</xref>–<xref rid="SD3" ref-type="supplementary-material">H</xref>).</p>
  <p id="P10">We next sought to evaluate whether Garnett was similarly useful for annotating single-cell chromatin accessibility (scATAC-seq) datasets, which we have generally found to be more challenging to manually annotate than scRNA-seq datasets. We and colleagues recently used regularized, multinomial regression to classify clusters of cells based on chromatin accessibility<sup><xref rid="R7" ref-type="bibr">7</xref></sup>. We adapted Garnett to classify cells based on scATAC-seq-derived “gene activity scores”, a measure of open chromatin around each gene<sup><xref rid="R10" ref-type="bibr">10</xref></sup>. Applying it to our recent scATAC-seq atlas of the mouse<sup><xref rid="R7" ref-type="bibr">7</xref></sup>, Garnett labeled 39% of cells concordantly with our previous assignments (cluster-extended; 22% incorrect; 39% unclassified) (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 5</xref>). A caveat is that the marker file was informed by our previous literature-based annotation of the dataset by a related method, but these analyses nonetheless illustrate the potential of Garnett to enable the rapid annotation of not only scRNA-seq but also scATAC-seq datasets.</p>
  <p id="P11">We next applied Garnett to the task of discriminating all cell types of a whole animal, L2 stage <italic>C. elegans</italic><sup><xref rid="R11" ref-type="bibr">11</xref></sup>. We defined a cell hierarchy that discriminated 29 major cell types, as well as subtypes of neurons, using the marker genes from the original study. Of cells previously assigned, Garnett labeled 87% of cells concordantly for major cell type (cluster-extended; 8% incorrect; 5% unclassified), with rectum cells being frequently mislabeled as non-seam hypodermis (<xref rid="F2" ref-type="fig">Figure 2A</xref>–<xref rid="F2" ref-type="fig">B</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Figures 6</xref>–<xref rid="SD3" ref-type="supplementary-material">7</xref>). Of 4,186 neurons originally assigned subtypes, 53% were subtyped correctly, and a further 18% were labeled as neurons of unknown subtype (cluster-agnostic; 8% incorrect) (<xref rid="F2" ref-type="fig">Figure 2C</xref>). These analyses demonstrate Garnett can scale to classifying the cell types found in a whole animal.</p>
  <p id="P12">To evaluate how Garnett would perform on a complex system with a deep hierarchy, we generated a 4-level classifier with 144 cell definitions for mouse nervous system based on the data and taxonomy presented in ref<sup><xref rid="R12" ref-type="bibr">12</xref></sup> (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 8</xref>). We found Garnett performed very well at the higher levels, but often under-classified cells at the lower, more specific levels (<italic>e.g</italic>., classifying a cerebellum neuron as a neuron) (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 9A</xref>–<xref rid="SD3" ref-type="supplementary-material">E</xref>; <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 10</xref>). The size and complexity of this hierarchy facilitated exploration of the properties of markers chosen by the elastic-net regression to discriminate amongst cell types. Garnett tended to select genes that were more highly expressed and more specific than other genes (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 11</xref>).</p>
  <p id="P13">Finally, as tissue-specific gene expression patterns are largely conserved across vertebrates<sup><xref rid="R13" ref-type="bibr">13</xref></sup>, we wondered whether Garnett models trained on mouse data could be used to classify human cell types. We applied the Garnett model trained on the MCA lung dataset to scRNA-seq data from human lung tumors<sup><xref rid="R14" ref-type="bibr">14</xref></sup> (<xref rid="F3" ref-type="fig">Figure 3A</xref>–<xref rid="F3" ref-type="fig">B</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 12</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). Over 92% of alveolar, B cells, T cells, epithelial (ciliated) cells, endothelial cells, and fibroblasts were accurately assigned by the Garnett MCA model. Of the 9,756 cells annotated as myeloid<sup><xref rid="R14" ref-type="bibr">14</xref></sup>, Garnett labeled 44% as monocyte/macrophage/dendritic cell and a further 16% granulocytes, leaving 34% unclassified. 22% of the dataset was labeled “unknown”, of which 55% were identified as tumor cells in the original study. As expected, given that they are not represented in the original marker file nor in the MCA lung dataset, 88% of all cells annotated as tumor cells in the original study were labeled as “unknown” by Garnett. These analyses demonstrate that Garnett has the potential to operate across related species, and is not necessarily confounded by the presence of pathological cell states when trained on normal healthy tissue.</p>
  <p id="P14">Cell type annotation is a critical and rate-limiting step in cell type atlas construction, as illustrated by recent studies that resorted to labor-intensive, <italic>ad hoc</italic> literature review to achieve this end<sup><xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R7" ref-type="bibr">7</xref>,<xref rid="R11" ref-type="bibr">11</xref>,<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R15" ref-type="bibr">15</xref></sup> Garnett is an algorithm and accompanying software that automates and standardizes the process of classifying cells based on marker genes. While other algorithms for automated cell type assignment have been published<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R16" ref-type="bibr">16</xref></sup> we believe that Garnett’s ease-of-use and lack of requirement of pre-classified training datasets will make it an asset for future cell type annotation. One existing method, scMCA, trained a model using Mouse Cell Atlas data that can be applied to newly sequenced mouse tissues. scMCA reported slightly higher accuracy than Garnett<sup><xref rid="R3" ref-type="bibr">3</xref></sup>, likely owing to a training procedure that relies on manual annotation of cell clusters. . But a key distinction is that the hierarchical marker files on which Garnett is based are interpretable to biologists and explicitly relatable to the existing literature. Furthermore, together with these markup files, Garnett classifiers trained on one dataset are easily shared and applied to new datasets, and are robust to differences in depth, methods, and species.</p>
  <p id="P15">We anticipate the potential for an “ecosystem” of Garnett marker files and pre-trained classifiers that: 1) enable the rapid, automated, reproducible annotation of cell types in any newly generated dataset. 2) minimize redundancy of effort, by allowing for marker gene hierarchies to be easily described, compared, and evaluated. 3) facilitate a systematic framework and shared language for specifying, organizing, and reaching consensus on a catalog of molecularly defined cell types. To these ends, in addition to releasing the Garnett software, we have made the marker files and pre-trained classifiers described in this manuscript available at a wiki-like website that facilitates further community contributions, together with a web-based interface for applying Garnett to user datasets (<ext-link ext-link-type="uri" xlink:href="https://cole-trapnell-lab.github.io/garnett/">https://cole-trapnell-lab.github.io/garnett</ext-link>).</p>
  <sec id="S1">
    <title>Online Methods</title>
    <sec id="S2">
      <title>Garnett</title>
      <p id="P16">Garnett is designed to simplify, standardize, and automate the classification of cells by type and subtype. To train a new model with Garnett, the user must specify a cell hierarchy of cell types and subtypes, which may be organized into a tree of arbitrary depth; there is no limit to the number of cell types allowed in the hierarchy. For each cell type and subtype, the user must specify at least one marker gene that is taken as positive evidence that the cell is of that type. Garnett includes a simple language for specifying these marker genes, in order to make the software more accessible to users unfamiliar with statistical regression. Negative marker genes, <italic>i.e</italic>. taken as evidence against a cell being of a given type, can also be specified. In addition, Garnett includes tools for selecting and checking the quality of markers. Garnett uses the marker information provided to select cells that are then used to train a regression-based classifier, similar to the approach taken in ref<sup><xref rid="R7" ref-type="bibr">7</xref></sup>. After a classifier is trained, it can be applied to other single cell datasets run on the same or different platforms. Algorithmic details are provided below.</p>
    </sec>
    <sec id="S3">
      <title>Constructing marker files</title>
      <p id="P17">Garnett uses a marker file to allow users to specify cell type definitions. These definitions are then used to choose representative cells from each cell type to use when training the classifier. Full details describing the syntax of the marker file are provided as part of the software package. Briefly, the marker file consists of a series of cell type entries, beginning with a cell type name, followed by lists of expressed markers and metadata. In addition, cell types can be specified to be a subtype of another defined type, <italic>i.e</italic>. hierarchical definitions. Marker files also have the capability to hold literature references for the chosen marker genes that are then included as metadata in the classifier.</p>
      <p id="P18">Because only markers that are expressed specifically in a given cell type are useful for Garnett classification’ we also provide functions for assessing the value of each of the provided marker genes. These functions estimate the number of cells that a given marker nominates for their cell type, the number of cells that become “ambiguously” nominated to multiple cell types in a given level of the hierarchy when the marker is included, and an overall marker score <italic>G</italic>, defined as:
<disp-formula id="FD1"><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:mi>G</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo>+</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>*</mml:mo><mml:mfrac><mml:mi>b</mml:mi><mml:mi>n</mml:mi></mml:mfrac></mml:mrow></mml:math></disp-formula>
where <italic>a</italic> is the fraction of cells of the cells nominated by the given marker that are made ambiguous by that marker, <italic>p</italic> is a small pseudocount, <italic>b</italic> is the number of cells nominated by the marker, and <italic>n</italic> is the total number of cells nominated for that cell type. In addition to estimating these values, Garnett will plot a diagnostic chart to aid the user in choosing markers (<italic>e.g</italic>. <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 1A</xref>).</p>
    </sec>
    <sec id="S4">
      <title>Training the classifier</title>
      <p id="P19">Garnett’s first step in training a cell type classifier is to choose representative cells to train on. Let <italic>M</italic> be an <italic>m</italic> by <italic>n</italic> matrix of input gene expression data. First, <italic>M</italic><sub><italic>i,j</italic></sub> is normalized by size factor (the geometric mean of the total UMIs expressed for each cell <italic>j</italic>) to adjust for read depth, resulting in a normalized <italic>m</italic> by <italic>n</italic> matrix <italic>N</italic>. In addition, the gene IDs of the expression data are converted to Ensembl IDs using correspondence tables from a Bioconductor AnnotationDbi-class<sup><xref rid="R18" ref-type="bibr">18</xref></sup> package. Next, the input marker file is parsed and the gene IDs are also converted to Ensembl IDs as above. Finally, a tree representation of the marker file is constructed, with any designated subtypes placed as children of the parent cell type in the tree. In addition to the tree, a dataset-wide size factor is generated and saved to the tree to allow normalization to new datasets for later classification (see classifying cells section below).</p>
      <p id="P20">For each parent node in the tree, the following steps are taken: First, cells are scored as “expressed” or “not expressed” for each of the provided markers and an aggregate marker score is derived for each cell type for each cell (details on scoring below). Next, any metadata or hard expression cutoffs are applied to exclude a subset of cells from consideration. Lastly, outgroup samples are chosen (see below). After choosing the training sample, the classifier is trained (see below), and a preliminary classification is made in order to further train downstream nodes.</p>
    </sec>
    <sec id="S5">
      <title>Aggregated marker scores</title>
      <p id="P21">We devised an aggregated marker scoring system to address two challenges of single-cell RNA-seq data for the purposes of identifying representative cell types based on markers. The first challenge when choosing cells is that of differing levels of expression of different markers. If a lowly expressed but specific marker is found in a cell profile, this is better evidence of cell type than a highly expressed and less specific marker. To address this, we use the term frequency-inverse document frequency<sup><xref rid="R19" ref-type="bibr">19</xref></sup> (TF-IDF) transformation when generating aggregate marker scores. The TF-IDF transformed matrix is defined by,
<disp-formula id="FD2"><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mstyle><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac><mml:mo>*</mml:mo><mml:mtext mathvariant="italic">log</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
where <italic>N</italic><sub><italic>i,j</italic></sub> is the <italic>m</italic> by <italic>n</italic> normalized gene expression matrix defined above.</p>
      <p id="P22">The second challenge we addressed in our aggregate marker score calculation was that highly expressed genes have been known to leak into the transcriptional profiles of other cells. For example, in samples including hepatocytes, albumin transcripts are often found in low copy numbers in non-hepatocyte profiles. To address this, we assign a cutoff above which a gene is considered expressed in that cell. To determine this cutoff we use a heuristic measure defined as
<disp-formula id="FD3"><mml:math display="block" id="M3" overflow="scroll"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.25</mml:mn><mml:mo>*</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula>
where <italic>c</italic><sub><italic>i</italic></sub> is the gene cutoff for gene <italic>i</italic> and <italic>q</italic><sub><italic>i</italic></sub> is the 95th percentile of <italic>T</italic> for gene <italic>i</italic>. Any gene <italic>i</italic> in cell <italic>j</italic> with a value <italic>T</italic><sub><italic>i,j</italic></sub> below <italic>c</italic><sub><italic>i</italic></sub> is set to 0 for the purposes of generating aggregated marker scores.</p>
      <p id="P23">After these transformations, the aggregated marker score is defined by a simple sum of the genes defined as markers in the cell marker file,
<disp-formula id="FD4"><mml:math display="block" id="M4" overflow="scroll"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mstyle><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula>
where <italic>S</italic><sub><italic>c,j</italic></sub> is the aggregated score for cell type <italic>c</italic> and cell <italic>j</italic>, and <italic>G</italic><sub><italic>c</italic></sub> is the list of marker genes for cell type <italic>c</italic>. Cells in the 75th percentile and above for aggregated marker score <italic>S</italic> in only 1 cell type are chosen as good representatives. Any metadata specifications (<italic>e.g</italic>. the requirement that a cell type have come from a particular tissue), provided in the marker file are then used to exclude cells and generate a final training dataset.</p>
    </sec>
    <sec id="S6">
      <title>Choosing outgroup cells</title>
      <p id="P24">When choosing outgroup samples for training, we wanted to make sure that the outgroup set is not dominated by the most abundant cell type. So instead, we cluster a random subset of potential outgroup cells and choose equal numbers of random cells from each cluster to make up the outgroup. Specifically, we first calculate the first 50 principal components using principal components analysis (PCA) as implemented by the irlba<sup><xref rid="R20" ref-type="bibr">20</xref></sup> R package. Next, we calculate jaccard coefficients on a k-nearest-neighbors (kNN) graph generated using k = 20. Lastly, we generate clusters using Louvain community detection on the resulting cell-cell map of jaccard coefficients. A random set of cells from each resulting community is then combined to create the outgroup.</p>
    </sec>
    <sec id="S7">
      <title>Training with GLMnet</title>
      <p id="P25">The classifier is trained on the normalized expression matrix <italic>N</italic> for cells chosen as representatives and for all genes expressed in greater than 5% of cells in at least one training set and not expressed in the 90th percentile of TF-IDF transformed expression in all cell types. This last filter prevents ubiquitously expressed genes from being chosen as features. The classifier is trained using genes as features and cells as observations with a grouped multinomial elastic net regularized (alpha = 0.3) generalized linear model using the package GLMnet<sup><xref rid="R21" ref-type="bibr">21</xref></sup> in R. Observations are weighted by the geometric mean of the counts in each of the training groups. The GLMnet regularization parameter <italic>λ</italic> is chosen using 3-fold cross validation. Genes provided in the marker files are required to be included in the model not regularized.</p>
    </sec>
    <sec id="S8">
      <title>Classifying cells</title>
      <p id="P26">Because we wished to be able to use pre-trained classifiers to classify cells across datasets and platforms, we include a dataset size factor <italic>D</italic> for the training data with the classifier object. <italic>D</italic> is the geometric mean of the total read counts per cell divided by the median number of genes expressed above zero per cell. Formally, <italic>D</italic> is defined by
<disp-formula id="FD5"><mml:math display="block" id="M5" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:munderover><mml:mstyle><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD6"><mml:math display="block" id="M6" overflow="scroll"><mml:mrow><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>p</mml:mi></mml:mfrac><mml:munderover><mml:mstyle><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>p</mml:mi></mml:munderover><mml:mtext>ln </mml:mtext><mml:msub><mml:mi>a</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mtext>median</mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mi>g</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
where <italic>g</italic> is the number of genes expressed above zero per cell. When applying an existing classifier to a new dataset, we can then transform the new expression data, an <italic>m</italic>′ by <italic>n</italic>′ matrix <italic>M</italic>′, to the scale of the training data using <italic>D</italic>,
<disp-formula id="FD7"><mml:math display="block" id="M7" overflow="scroll"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mstyle><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msup><mml:mi>m</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:munderover><mml:msubsup><mml:mi>M</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mo>*</mml:mo><mml:mtext>median</mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:msup><mml:mi>g</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD8"><mml:math display="block" id="M8" overflow="scroll"><mml:mrow><mml:msup><mml:mi>N</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mi>M</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
where <italic>g</italic>′ is the number of genes expressed above zero per cell in the new data.</p>
      <p id="P27">After normalization, gene IDs for the new dataset are also converted to Ensembl IDs. At each internal node in the classifier, the multinomial model for that node is applied to the data, the output probabilities of each class are normalized by dividing by the maximum probability for each cell, and the ratio of the top scoring cell type to the second best scoring cell type is calculated. If this odds ratio is greater than the user-specified rank probability ratio (in this paper and by default, we use 1.5), the top type is assigned, otherwise the cell type is set to “Unknown”. Optionally, Garnett will add a second set of classifications which classify an entire cluster of cells if: greater than 90% of assigned cells within a cluster are the same type and greater than 5% of all cells in the cluster are classified (not “Unknown”), and greater than 5 cells in the cluster are classified. Cluster labels can be provided by the user or generated by Garnett using Louvain community detection in the top 50 principal components of the expression matrix.</p>
      <sec id="S9">
        <title>10x Genomics Peripheral Blood Mononuclear Cells (PBMCs)</title>
        <p id="P28">10x PBMC datasets from both version 1 (V1) and version 2 (V2) chemistry were downloaded from the 10x Genomics website. The V1 cells are a combination of each of the pure cell type populations isolated by 10x Genomics using FACS sorting (CD14+ Monocytes, CD19+ B cells, CD34+ cells, CD4+ Helper T cells, CD4+/CD25+ Regulatory T cells, CD4+/CD45RA+/CD25- Naive T cells, CD4+/CD45RO+ Memory T cells, CD56+ Natural killer cells, CD8+ Cytotoxic T cells and CD8+/CD45RA+ Naive cytotoxic T cells) preprocessed using CellRanger 1.1.0 and published in Zheng et. al. The V2 cells are the V2 chemistry distributed demonstration dataset labelled “8k PBMCs from a healthy donor”, preprocessed using CellRanger 2.1.0. Markers for PBMCs were those often cited in the literature. Using Garnett’s marker scoring system, we excluded the markers with high ambiguity (&gt;0.5). The final PBMC marker file used is available as <xref rid="SD1" ref-type="supplementary-material">Supplementary Data File 1</xref>. Garnett classification for V1 and V2 was run using default parameter values defined in the preceding sections. For testing the limits of Garnett (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 2</xref>), we used a 1-level marker file with no T cell subtypes defined. To downsample the reads in training and classification datasets (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figures 2D</xref>–<xref rid="SD3" ref-type="supplementary-material">E</xref>), we used the downsampleMatrix function from the DropletUtils<sup><xref rid="R22" ref-type="bibr">22</xref>,<xref rid="R23" ref-type="bibr">23</xref></sup> R package which uses sampling without replacement per cell so that the total reads in that cell is reduced by the specified proportion. For the T cell ablation experiment (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 2G</xref>–<xref rid="SD3" ref-type="supplementary-material">H</xref>) we removed the T cells from the matrix and also set all values of the T cell marker genes to zero.</p>
      </sec>
      <sec id="S10">
        <title>Tabula muris and mouse cell atlas MCA lung analysis</title>
        <p id="P29">The Tabula muris FACS dataset from ref<sup><xref rid="R2" ref-type="bibr">2</xref></sup> was downloaded from their figshare website. The MCA dataset from ref<sup><xref rid="R3" ref-type="bibr">3</xref></sup> was downloaded from their figshare website. For the purposes of this analysis, only data derived from lung tissue from both datasets were used. To facilitate comparisons between each of the lung datasets used, a set of consensus cell type names were used as described in Table 1. The marker file used is available as <xref rid="SD4" ref-type="supplementary-material">Supplementary Data File 2</xref>. Garnett classification was run using default parameter values for both datasets.</p>
      </sec>
      <sec id="S11">
        <title>sci-ATAC-seq analysis</title>
        <p id="P30">The sci-ATAC-seq data was downloaded from the website associated with ref<sup><xref rid="R7" ref-type="bibr">7</xref></sup>. The input to Garnett was the previously calculated Cicero gene activity scores presented in the original publication. The final marker file used is available as <xref rid="SD5" ref-type="supplementary-material">Supplementary Data File 3</xref>. Garnett classification was run using default parameter values.</p>
      </sec>
      <sec id="S12">
        <title>Worm analysis</title>
        <p id="P31">The worm data was downloaded from the website associated with ref<sup><xref rid="R11" ref-type="bibr">11</xref></sup>. Markers were those used by the original publication to identify cell types. Using Garnett’s marker scoring system, we excluded the markers with high ambiguity (<xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 6</xref>). The final marker file used is available as <xref rid="SD6" ref-type="supplementary-material">Supplementary Data File 4</xref>. Garnett classification was run using default parameter values.</p>
      </sec>
      <sec id="S13">
        <title>Human lung tumor analysis</title>
        <p id="P32">The human lung tumor data was downloaded from the ArrayExpress database entry associated with ref<sup><xref rid="R14" ref-type="bibr">14</xref></sup>. Because expression data were log-transformed, we first exponentiated the expression data before classification. To allow for cross-species classification, we first converted the human expression data to mouse gene labels by creating a correspondence table using the biomaRt hsapiens_gene_ensembl and mmusculus_gene_ensembl databases. Only unique rows (one-to-one correspondences) were used. Ultimately 15,336 of the original 22,180 human genes could be converted to mouse labels including 89 percent of the genes in the MCA classifier with non-zero coefficients. The final marker file used is available as <xref rid="SD7" ref-type="supplementary-material">Supplementary Data File 5</xref>. Garnett classification was run using default parameter values.</p>
      </sec>
      <sec id="S14">
        <title>Mouse nervous system analysis</title>
        <p id="P33">The mouse nervous system data and potential marker genes were downloaded from the website associated with ref<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. The final marker file used is available as <xref rid="SD8" ref-type="supplementary-material">Supplementary Data File 6</xref>.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="data-availability" id="S15">
    <title>Data Availability</title>
    <p id="P34">No new data was generated for this study. All data used in this study is publicly available.</p>
  </sec>
  <sec id="S16">
    <title>Software Availability</title>
    <p id="P35">Garnett is an R package available through github.</p>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS1534578-supplement-1.txt" orientation="portrait" xlink:type="simple" id="d36e1123" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS1534578-supplement-2.pdf" orientation="portrait" xlink:type="simple" id="d36e1127" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>3</label>
      <media xlink:href="NIHMS1534578-supplement-3.docx" orientation="portrait" xlink:type="simple" id="d36e1131" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>4</label>
      <media xlink:href="NIHMS1534578-supplement-4.txt" orientation="portrait" xlink:type="simple" id="d36e1135" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>5</label>
      <media xlink:href="NIHMS1534578-supplement-5.txt" orientation="portrait" xlink:type="simple" id="d36e1139" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD6">
      <label>6</label>
      <media xlink:href="NIHMS1534578-supplement-6.txt" orientation="portrait" xlink:type="simple" id="d36e1143" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD7">
      <label>7</label>
      <media xlink:href="NIHMS1534578-supplement-7.txt" orientation="portrait" xlink:type="simple" id="d36e1147" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD8">
      <label>8</label>
      <media xlink:href="NIHMS1534578-supplement-8.txt" orientation="portrait" xlink:type="simple" id="d36e1151" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD9">
      <label>9</label>
      <media xlink:href="NIHMS1534578-supplement-9.png" orientation="portrait" xlink:type="simple" id="d36e1155" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S17">
    <title>Acknowledgements</title>
    <p id="P36">We gratefully acknowledge S. Tapscott, W. Noble, and D. Witten as well as members of the Shendure and Trapnell labs, particularly A. Hill, for their advice. Z. Pliner named the software. This work was supported by the following funding: NIH grant U54DK107979 to JS and CT; NIH grant DP2HD088158, RC2DK114777 and R01HL118342 to CT; NIH grants DP1HG007811 and R01HG006283 to JS; and the Paul G. Allen Frontiers Group to JS and CT. JS is an Investigator of the Howard Hughes Medical Institute. CT is partly supported by an Alfred P. Sloan Foundation Research Fellowship. HAP was supported by the National Science Foundation Graduate Research Fellowship under Grant No. (DGE-1256082).</p>
  </ack>
  <fn-group>
    <fn fn-type="COI-statement" id="FN3">
      <p id="P37">Competing Financial Interests Statement</p>
      <p id="P38">The authors declare no competing interests.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="R1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><name><surname>Svensson</surname><given-names>V</given-names></name>, <name><surname>Vento-Tormo</surname><given-names>R</given-names></name> &amp; <name><surname>Teichmann</surname><given-names>SA</given-names></name>
<article-title>Exponential scaling of single-cell RNA-seq in the past decade</article-title>. <source>Nat. Protoc</source>
<volume>13</volume>, <fpage>599</fpage>–<lpage>604</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29494575</pub-id></mixed-citation>
    </ref>
    <ref id="R2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><name><surname>Tabula Muris</surname><given-names>Consortium</given-names></name><etal/><article-title>Single-cell transcriptomics of 20 mouse organs creates a Tabula Muris</article-title>. <source>Nature</source><volume>562</volume>, <fpage>367</fpage>–<lpage>372</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">30283141</pub-id></mixed-citation>
    </ref>
    <ref id="R3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><name><surname>Han</surname><given-names>X</given-names></name><etal/><article-title>Mapping the Mouse Cell Atlas by Microwell-Seq</article-title>. <source>Cell</source><volume>173</volume>, <fpage>1307</fpage>(<year>2018</year>).<pub-id pub-id-type="pmid">29775597</pub-id></mixed-citation>
    </ref>
    <ref id="R4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><name><surname>Zhang</surname><given-names>X</given-names></name><etal/><article-title>CellMarker: a manually curated resource of cell markers in human and mouse</article-title>. <source>Nucleic Acids Res</source>. <volume>47</volume>, <fpage>D721</fpage>–<lpage>D728</lpage> (<year>2019</year>).<pub-id pub-id-type="pmid">30289549</pub-id></mixed-citation>
    </ref>
    <ref id="R5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><name><surname>Diehl</surname><given-names>AD</given-names></name><etal/><article-title>The Cell Ontology 2016: enhanced content, modularization, and ontology interoperability</article-title>. <source>J. Biomed. Semantics</source><volume>7</volume>, <fpage>44</fpage>(<year>2016</year>).<pub-id pub-id-type="pmid">27377652</pub-id></mixed-citation>
    </ref>
    <ref id="R6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><name><surname>Bard</surname><given-names>J</given-names></name>, <name><surname>Rhee</surname><given-names>SY</given-names></name> &amp; <name><surname>Ashburner</surname><given-names>M</given-names></name>
<article-title>An ontology for cell types</article-title>. <source>Genome Biol</source>. <volume>6</volume>, <fpage>R21</fpage>(<year>2005</year>).<pub-id pub-id-type="pmid">15693950</pub-id></mixed-citation>
    </ref>
    <ref id="R7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><name><surname>Cusanovich</surname><given-names>DA</given-names></name><etal/><article-title>A Single-Cell Atlas of In Vivo Mammalian Chromatin Accessibility</article-title>. <source>Cell</source><volume>174</volume>, <fpage>1309</fpage>–<lpage>1324.e18</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">30078704</pub-id></mixed-citation>
    </ref>
    <ref id="R8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><name><surname>Zheng</surname><given-names>GXY</given-names></name><etal/><article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat. Commun</source><volume>8</volume>, <fpage>14049</fpage>(<year>2017</year>).<pub-id pub-id-type="pmid">28091601</pub-id></mixed-citation>
    </ref>
    <ref id="R9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><name><surname>Levine</surname><given-names>JH</given-names></name><etal/><article-title>Data-Driven Phenotypic Dissection of AML Reveals Progenitor-like Cells that Correlate with Prognosis</article-title>. <source>Cell</source><volume>162</volume>, <fpage>184</fpage>–<lpage>197</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26095251</pub-id></mixed-citation>
    </ref>
    <ref id="R10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><name><surname>Pliner</surname><given-names>HA</given-names></name><etal/><article-title>Cicero Predicts cis-Regulatory DNA Interactions from Single-Cell Chromatin Accessibility Data</article-title>. <source>Mol. Cell</source><volume>71</volume>, <fpage>858</fpage>–<lpage>871.e8</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">30078726</pub-id></mixed-citation>
    </ref>
    <ref id="R11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><name><surname>Cao</surname><given-names>J</given-names></name><etal/><article-title>Comprehensive single-cell transcriptional profiling of a multicellular organism</article-title>. <source>Science</source><volume>357</volume>, <fpage>661</fpage>–<lpage>667</lpage> (<year>2017</year>).<pub-id pub-id-type="pmid">28818938</pub-id></mixed-citation>
    </ref>
    <ref id="R12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><name><surname>Zeisel</surname><given-names>A</given-names></name><etal/><article-title>Molecular Architecture of the Mouse Nervous System</article-title>. <source>Cell</source><volume>174</volume>, <fpage>999</fpage>–<lpage>1014.e22</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">30096314</pub-id></mixed-citation>
    </ref>
    <ref id="R13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><name><surname>Merkin</surname><given-names>J</given-names></name>, <name><surname>Russell</surname><given-names>C</given-names></name>, <name><surname>Chen</surname><given-names>P</given-names></name> &amp; <name><surname>Burge</surname><given-names>CB</given-names></name>
<article-title>Evolutionary dynamics of gene and isoform regulation in Mammalian tissues</article-title>. <source>Science</source>
<volume>338</volume>, <fpage>1593</fpage>–<lpage>1599</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">23258891</pub-id></mixed-citation>
    </ref>
    <ref id="R14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><name><surname>Lambrechts</surname><given-names>D</given-names></name><etal/><article-title>Phenotype molding of stromal cells in the lung tumor microenvironment</article-title>. <source>Nat. Med</source><volume>24</volume>, <fpage>1277</fpage>–<lpage>1289</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29988129</pub-id></mixed-citation>
    </ref>
    <ref id="R15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><name><surname>Rosenberg</surname><given-names>AB</given-names></name><etal/><article-title>Single-cell profiling of the developing mouse brain and spinal cord with split-pool barcoding</article-title>. <source>Science</source><volume>360</volume>, <fpage>176</fpage>–<lpage>182</lpage> (<year>2018</year>).<pub-id pub-id-type="pmid">29545511</pub-id></mixed-citation>
    </ref>
    <ref id="R16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><name><surname>Alavi</surname><given-names>A</given-names></name>, <name><surname>Ruffalo</surname><given-names>M</given-names></name>, <name><surname>Parvangada</surname><given-names>A</given-names></name>, <name><surname>Huang</surname><given-names>Z</given-names></name> &amp; <name><surname>Bar-Joseph</surname><given-names>Z</given-names></name>
<article-title>A web server for comparative analysis of single-cell RNA-seq data</article-title>. <source>Nat. Commun</source>
<volume>9</volume>, <fpage>4768</fpage>(<year>2018</year>).<pub-id pub-id-type="pmid">30425249</pub-id></mixed-citation>
    </ref>
    <ref id="R17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><name><surname>Zou</surname><given-names>H</given-names></name> &amp; <name><surname>Hastie</surname><given-names>T</given-names></name>
<article-title>Regularization and variable selection via the elastic net</article-title>. <source>J. R. Stat. Soc. Series B Stat. Methodol</source>
<volume>67</volume>, <fpage>301</fpage>–<lpage>320</lpage> (<year>2005</year>).</mixed-citation>
    </ref>
    <ref id="R18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><name><surname>Carlson</surname><given-names>M</given-names></name>, <name><surname>Falcon</surname><given-names>S</given-names></name>, <name><surname>Pages</surname><given-names>H</given-names></name> &amp; <name><surname>Li</surname><given-names>N</given-names></name>
<article-title>AnnotationDbi: Annotation Database Interface</article-title>. <source>R package version</source>
<volume>1</volume>,</mixed-citation>
    </ref>
    <ref id="R19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><name><surname>Jones</surname><given-names>KS</given-names></name><article-title>A STATISTICAL INTERPRETATION OF TERM SPECIFICITY AND ITS APPLICATION IN RETRIEVAL</article-title>. <source>Journal of Documentation</source><volume>28</volume>, <fpage>11</fpage>–<lpage>21</lpage> (<year>1972</year>).</mixed-citation>
    </ref>
    <ref id="R20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><name><surname>Baglama</surname><given-names>J</given-names></name>, <name><surname>Reichel</surname><given-names>L</given-names></name> &amp; <name><surname>Lewis</surname><given-names>BW</given-names></name>
<article-title>irlba: Fast truncated singular value decomposition and principal components analysis for large dense and sparse matrices</article-title>. <source>R package version</source>
<volume>2</volume>, (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><name><surname>Friedman</surname><given-names>J</given-names></name>, <name><surname>Hastie</surname><given-names>T</given-names></name> &amp; <name><surname>Tibshirani</surname><given-names>R</given-names></name>
<article-title>glmnet: Lasso and elastic-net regularized generalized linear models</article-title>. <source>R package version</source>
<volume>1</volume>, (<year>2009</year>).</mixed-citation>
    </ref>
    <ref id="R22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><name><surname>Lun</surname><given-names>A</given-names></name><etal/><source>Distinguishing cells from empty droplets in droplet-based single-cell RNA sequencing data</source>. doi:<pub-id pub-id-type="doi">10.1101/234872</pub-id></mixed-citation>
    </ref>
    <ref id="R23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><name><surname>Griffiths</surname><given-names>JA</given-names></name>, <name><surname>Richard</surname><given-names>AC</given-names></name>, <name><surname>Bach</surname><given-names>K</given-names></name>, <name><surname>Lun</surname><given-names>ATL</given-names></name> &amp; <name><surname>Marioni</surname><given-names>JC</given-names></name>
<article-title>Detection and removal of barcode swapping in single-cell RNA-seq data</article-title>. <source>Nat. Commun</source>
<volume>9</volume>, <fpage>2667</fpage>(<year>2018</year>).<pub-id pub-id-type="pmid">29991676</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1.</label>
    <caption>
      <title>Garnett accurately classifies peripheral blood mononuclear cells.</title>
      <p id="P39"><bold>A)</bold> Overview of Garnett algorithm. See <xref rid="S1" ref-type="sec">Methods</xref> for algorithmic details. Briefly, Garnett takes as input a marker file that defines cell types using marker genes, and builds a cell type hierarchy that can include cell subtypes. Next, Garnett trains a classifier using elastic net multinomial regression<sup><xref rid="R17" ref-type="bibr">17</xref></sup> at each node beginning at the root of the tree by comparing cell type representative cells. Lastly, Garnett hierarchically classifies all cells and optionally provides a second cluster-extended classification. <bold>B)</bold> t-SNE plots of 10x Genomics’ 100,000 cell PBMC dataset (n = 94,571 cells). The first panel is colored by cell type based on FACS sorting, the second panel is colored by cluster-agnostic cell type according to Garnett classification, and the third panel is colored by the Garnett cluster-extended type, which labels cells based on the composition of their cluster or community. <bold>C)</bold> A heatmap of data in (B) comparing the labels based on FACS (rows) with the cluster-agnostic (left) and cluster-extended (right) cell type assignments by Garnett (columns). Color represents the percent of cells of a certain FACS type labeled each type by Garnett. <bold>D)</bold> t-SNE plots of 10x Genomics V2 chemistry applied to PBMCs from a healthy donor (n = 8,381 cells). The first panel is colored by type determined manually using known gene markers. The second and third panels are colored by Garnett cluster-agnostic and cluster-extended cell type assignments by a classifier trained on the data shown in panels (B) and (C). <bold>E)</bold> Similar to panel (C), a heatmap of data in (D).</p>
    </caption>
    <graphic xlink:href="nihms-1534578-f0001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2.</label>
    <caption>
      <title>Garnett can discriminate among cell types across a whole animal, across species and between normal and pathological tissue.</title>
      <p id="P40">Garnett classification results for sci-RNA-seq data from whole C. elegans, published in ref<sup><xref rid="R11" ref-type="bibr">11</xref></sup>. <bold>A)</bold> t-SNE plots of the whole worm dataset (n = 42,035 cells). First panel is colored by published type from ref<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, second panel colored by the major (top level) Garnett cluster-extended classification. Garnett cluster-agnostic type is available in <xref rid="SD3" ref-type="supplementary-material">Supplementary Figure 7</xref>. <bold>B)</bold> Heatmap comparing the reported cell types versus the Garnett cluster-extended cell types. Color represents the percent of cells of a certain reported type labelled as each type by Garnett. <bold>C)</bold> Heatmap comparing the reported neuron subtypes versus the Garnett cluster-agnostic neuron subtypes.</p>
    </caption>
    <graphic xlink:href="nihms-1534578-f0002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3.</label>
    <caption>
      <title>Garnett accurately classifies across species and distinguishes normal and pathological tissue.</title>
      <p id="P41"><bold>A)</bold> Garnett cluster-extended results for human lung tumors from ref<sup><xref rid="R14" ref-type="bibr">14</xref></sup> classified based on a Garnett classifier trained on lung cells from the Mouse Cell Atlas. t-SNE plots of the human lung tumor dataset (n = 52,698 cells). First panel is colored by published type from ref<sup><xref rid="R14" ref-type="bibr">14</xref></sup>, second panel colored by the Garnett cluster-extended classification. <bold>B)</bold> Heatmap comparing the reported cell types versus the Garnett cluster-extended cell types from panel D. Color represents the percent of cells of a certain reported type labelled as each type by Garnett.</p>
    </caption>
    <graphic xlink:href="nihms-1534578-f0003"/>
  </fig>
</floats-group>
