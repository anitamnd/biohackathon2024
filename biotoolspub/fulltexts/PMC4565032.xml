<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?covid-19-tdm?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4565032</article-id>
    <article-id pub-id-type="pmid">26002885</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btv317</article-id>
    <article-id pub-id-type="publisher-id">btv317</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Bayesian mixture analysis for metagenomic community profiling</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Morfopoulou</surname>
          <given-names>Sofia</given-names>
        </name>
        <xref ref-type="corresp" rid="btv317-COR1">*</xref>
        <xref ref-type="aff" rid="d324773e80"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Plagnol</surname>
          <given-names>Vincent</given-names>
        </name>
        <xref ref-type="aff" rid="d324773e80"/>
      </contrib>
    </contrib-group>
    <aff id="d324773e80">UCL Genetics Institute, University College London, London WC1E 6BT,
UK</aff>
    <author-notes>
      <corresp id="btv317-COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="FN100">
        <p>Associate Editor: Alfonso Valencia</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>9</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2015-05-21">
      <day>21</day>
      <month>5</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>5</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>31</volume>
    <issue>18</issue>
    <fpage>2930</fpage>
    <lpage>2938</lpage>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>11</month>
        <year>2014</year>
      </date>
      <date date-type="rev-recd">
        <day>25</day>
        <month>4</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>5</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2015. Published by Oxford University
Press.</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative
Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted
reuse, distribution, and reproduction in any medium, provided the original work is
properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btv317.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p><bold>Motivation:</bold> Deep sequencing of clinical samples is now an established tool
for the detection of infectious pathogens, with direct medical applications. The large
amount of data generated produces an opportunity to detect species even at very low
levels, provided that computational tools can effectively profile the relevant metagenomic
communities. Data interpretation is complicated by the fact that short sequencing reads
can match multiple organisms and by the lack of completeness of existing databases, in
particular for viral pathogens. Here we present metaMix, a Bayesian mixture model
framework for resolving complex metagenomic mixtures. We show that the use of parallel
Monte Carlo Markov chains for the exploration of the species space enables the
identification of the set of species most likely to contribute to the mixture.</p>
      <p><bold>Results:</bold> We demonstrate the greater accuracy of metaMix compared with
relevant methods, particularly for profiling complex communities consisting of several
related species. We designed metaMix specifically for the analysis of deep transcriptome
sequencing datasets, with a focus on viral pathogen detection; however, the principles are
generally applicable to all types of metagenomic mixtures.</p>
      <p><bold>Availability and implementation:</bold> metaMix is implemented as a user friendly R
package, freely available on CRAN: <ext-link ext-link-type="uri" xlink:href="http://cran.r-project.org/web/packages/metaMix">http://cran.r-project.org/web/packages/metaMix</ext-link></p>
      <p>
        <bold>Contact:</bold>
        <email>sofia.morfopoulou.10@ucl.ac.uk</email>
      </p>
      <p><bold>Supplementary information:</bold><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available
at <italic>Bionformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>1 Introduction</title>
    <p>Metagenomics can be defined as the study of DNA sequences from environmental or community
samples, while metatranscriptomics is the analysis of RNA sequence data from such samples.
The scope of metagenomics/metatranscriptomics is broad and includes the analysis of a
diverse set of samples such as gut microbiome (<xref rid="btv317-B21" ref-type="bibr">Minot
<italic>et al.</italic>, 2011</xref>; <xref rid="btv317-B24" ref-type="bibr">Qin
<italic>et</italic><italic>al.</italic>, 2010</xref>), environmental (<xref rid="btv317-B22" ref-type="bibr">Mizuno <italic>et</italic><italic>al.</italic>,
2013</xref>) or clinical (<xref rid="btv317-B20" ref-type="bibr">McMullan
<italic>et</italic><italic>al.</italic>, 2012</xref>; <xref rid="btv317-B23" ref-type="bibr">Negredo <italic>et</italic><italic>al.</italic>, 2011</xref>; <xref rid="btv317-B28" ref-type="bibr">Willner <italic>et</italic><italic>al.</italic>,
2009</xref>) samples. Among these applications, the discovery of viral pathogens is
clearly relevant for clinical practice (<xref rid="btv317-B5" ref-type="bibr">Chiu,
2013</xref>; <xref rid="btv317-B10" ref-type="bibr">Fancello
<italic>et</italic><italic>al.</italic>, 2012</xref>). The traditional process of
characterizing a virus through potentially difficult and time consuming culture techniques
is being revolutionized by advances in high throughput sequencing. Potential benefits of
sequence driven methodologies include a more rapid turnaround time (<xref rid="btv317-B25" ref-type="bibr">Quail <italic>et</italic><italic>al.</italic>, 2012</xref>), combined
with a largely unbiased approach in species detection, including the opportunity for
unexpected discoveries.</p>
    <p>The analysis of shotgun sequencing data from metagenomic mixtures raises complex
computational challenges. Part of the difficulty stems from the read length limitation of
existing deep DNA-sequencing technologies, an issue compounded by the extensive level of
homology across viral and bacterial species. Another complication is the divergence of the
microbial DNA sequences from the publicly available references. As a consequence, the
assignment of a sequencing read to a database organism is often unclear. Last, the number of
reads originating from a disease causing pathogen can be low (<xref rid="btv317-B2" ref-type="bibr">Barzon <italic>et</italic><italic>al.</italic>, 2013</xref>). The pathogen
contribution to the mixture depends on the biological context, the timing of sample
extraction and the type of pathogen considered. Therefore, highly sensitive computational
approaches are required.</p>
    <p>A first analytical problem is read classification that is the assignment of a given
sequencing read to a species. Several tools have been developed and these belong to two
broadly defined classes: composition-based and similarity-based approaches. The read
classification based on sequence composition relies on the intrinsic features of the reads.
Methods include PhyloPythia (<xref rid="btv317-B19" ref-type="bibr">McHardy
<italic>et</italic><italic>al.</italic>, 2007</xref>) and Phymm (<xref rid="btv317-B3" ref-type="bibr">Brady and Salzberg, 2009</xref>). These tend to focus on major classes in
a dataset and may not perform well on low-abundance populations (<xref rid="btv317-B16" ref-type="bibr">Kunin <italic>et</italic><italic>al.</italic>, 2008</xref>).
Additionally, results are usually reliable for longer reads only (<xref rid="btv317-B8" ref-type="bibr">Dröge and McHardy, 2012</xref>).</p>
    <p>Similarity-based methods, using homology search algorithms such as BLAST (<xref rid="btv317-B1" ref-type="bibr">Altschul <italic>et</italic><italic>al.</italic>,
1990</xref>), are considered the most sensitive methods for read classification (<xref rid="btv317-B3" ref-type="bibr">Brady and Salzberg, 2009</xref>). One of the most popular
tools using the output of a similarity search algorithm is MEGAN (<xref rid="btv317-B14" ref-type="bibr">Huson <italic>et</italic><italic>al.</italic>, 2007</xref>). MEGAN
addresses ambiguous matches by assigning reads that have multiple possible assignments to
several species, to the taxonomic group containing all these species, or else their lowest
common ancestor (LCA). This approach is accurate on a higher taxonomic level. However, it is
lacking a formal solution to resolving ambiguous matches.</p>
    <p>A weakness of the similarity-based methods is that a long tail of species, each supported
only by few reads can appear in the results. This results from the classification being
decided one read at a time, in contrast to considering all reads simultaneously. Hybrid
methods combining composition and similarity information such as PhymmBL (<xref rid="btv317-B3" ref-type="bibr">Brady and Salzberg, 2009</xref>) and RITA (<xref rid="btv317-B17" ref-type="bibr">MacDonald <italic>et</italic><italic>al.</italic>,
2012</xref>) also work read by read.</p>
    <p>Methods focused on the statistical inference of the set of present species as well as the
estimation of their relative proportions, incorporate knowledge from all reads to assign
each individual read to a species. From a statistical standpoint, this identification and
quantification question can be thought of as an application of mixture models. These ideas
have been applied in the metagenomics context in frequentist [GRAMMy (<xref rid="btv317-B29" ref-type="bibr">Xia <italic>et</italic><italic>al.</italic>, 2011</xref>)] and Bayesian
[Pathoscope (<xref rid="btv317-B11" ref-type="bibr">Francis
<italic>et</italic><italic>al.</italic>, 2013</xref>)] settings. GRAMMy formulates the
problem as a finite mixture model, using the Expectation-Maximization (EM) algorithm to
estimate the relative genome abundances. Pathoscope refines this process by penalizing reads
with ambiguous matches in the presence of reads with unique matches and enforcing parsimony
within a Bayesian context.</p>
    <p>Fitting a mixture model is useful for the species relative abundance estimation, as well as
the read to species assignment. A related but distinct question concerns the set of species
which should be included in the mixture model. This question is closely related to the
biological question of asking what species are present in the mixture. Including all species
flagged as potential matches by the read classification can introduce a large number of
species, often in the low thousands. Mixture models will then identify a large number of
species at low levels. This interpretation is appropriate in some applications. In many
other cases, the expectation is that the underlying species set should be parsimonious and
that some divergence with database species or sequencing errors can explain a large fraction
of the non matching reads.</p>
    <p>Hence, a better statistical formulation of the community profiling problem is the
exploration of the candidate organisms state-space. In this context, non nested models can
be compared based on their marginal likelihood. Within this Bayesian framework, readily
interpretable probabilities, such as the posterior probabilities of species sets can be used
to quantify the support for a species in the mixture. Finally, more complex hypotheses
testing for example the number of viral species or the joint presence of two distinct
organisms can be investigated.</p>
    <p>The main challenge behind such a formulation is computational. Even with a relatively small
number of species to consider, the number of subsets of this space that could explain the
mixture grows exponentially. Efficient computational strategies are required to make this
problem tractable. Here we show that this inference can be achieved for modern scale
metagenomics datasets. Our strategy is based on parallel tempering, a Monte Carlo Markov
Chain (MCMC) technique, using parallel computing to speed up the inference. We implemented
these ideas in a user friendly R package called metaMix. metaMix produces posterior
probabilities for various models as well as the relative abundances under each model. We
demonstrate its potential using datasets from clinical samples as well as benchmark
metagenomic datasets.</p>
  </sec>
  <sec sec-type="methods">
    <title>2 Methods</title>
    <sec>
      <title>2.1 Bioinformatics preprocessing</title>
      <p>Prior to running the mixture model for metagenomic profiling, several steps are required
to process the short read sequence data. The pipeline uses publicly available
bioinformatics tools for each preprocessing step.</p>
      <p>The first step is the removal of clonal reads using an in house C++ script. We then use
PRINSEQ (<xref rid="btv317-B27" ref-type="bibr">Schmieder and Edwards, 2011</xref>) for
read-based quality control, removing low quality and complexity reads and performing 3′end
trimming. For metagenomic analysis of human samples, reads originating from the human host
are not relevant for our research question. We therefore remove human host reads, using a
two-step approach to limit computation time: initially a short read aligner (novoalign,
<ext-link ext-link-type="uri" xlink:href="http://www.novocraft.com">www.novocraft.com</ext-link>), followed by BLASTn.
The next step is only applicable when the focus is on virus discovery using transcriptome
reads. We remove ribosomal RNA sequences, using BLASTn against the Silva rRNA
database.</p>
      <p>The remaining reads are assembled into contigs using the Velvet short read assembler
(<xref rid="btv317-B30" ref-type="bibr">Zerbino and Birney, 2008</xref>). For each
contig we record the number of reads required for its assembly, using this information at
the stage of species abundance estimation. A Velvet tuning parameter is the user defined
<italic>k</italic>-mer length that specifies the extent of overlap required to assemble
read pairs. Metagenomic assembly is not a straightforward task, as short k-mers work best
with the low abundance organisms, while long k-mers with the highly abundance ones. The
shorter the k-mer the greater the chance of spurious overlaps, hence we choose relatively
high <italic>k</italic>-mer length, in order to avoid chimeric contigs.</p>
      <p>For each contig and unassembled read we record the potentially originating species, using
the nucleotide to protein homology matching tool BLASTx. We use BLASTx due to the higher
level of conservation expected at the protein level compared with nucleotides. This choice
is guided by our focus in viral pathogens—viruses having high genetic diversity and
divergence (<xref rid="btv317-B10" ref-type="bibr">Fancello
<italic>et</italic><italic>al.</italic>, 2012</xref>). If taxonomic information is not
included in the BLAST output, we obtain it by using the NCBI taxonomy files that map
proteins to taxons. For simplicity we subsequently drop the protein information and only
keep a record of mismatches between the read and the species. If a read matches multiple
proteins from the same species, we keep only the best match. This step generates a sparse
similarity matrix between the read sequences and the protein sequences, with species as
columns, reads and contigs as rows.</p>
      <p>The statistical method described in the remainder of this section considers the competing
models that could accommodate our observed data i.e. the BLASTx results and compares them.
The different models represent different sets of species being present in the sample. The
method works on two levels of inference: in the first instance we assume a set of species
to be present in the sample and we estimate this model’s parameters given the data. The
other level of inference is the model comparison so as to assess the more plausible model.
The process is iterated in order to explore the model state space.</p>
    </sec>
    <sec>
      <title>2.2 Model specification assuming a fixed set of species</title>
      <p>Assuming a given set of <italic>K</italic> species from which the reads can originate,
the metagenomic problem can be summarized as a mixture problem, for which the assignment
of the sequencing reads to species is unknown and must be determined. The data consist of
<italic>N</italic> sequencing reads <inline-formula><mml:math id="MM1"><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and for a given read <italic>x<sub>i</sub></italic> the
likelihood is written as: <disp-formula id="btv317-M1"><label>(1)</label><mml:math id="MM2"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>K</mml:mtext></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="MM3"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>...</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> represent the proportion of each of the <italic>K</italic>
species in the mixture. These mixture weights are constrained such that
<inline-formula><mml:math id="MM4"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM5"><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mi>w</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:mstyle><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. In practice, we also add a category (species
<italic>K</italic> + 1) which we refer to as the ‘unknown’ category, and captures the
fact that some reads cannot be assigned to any species.</p>
      <p>Additionally <inline-formula><mml:math id="MM6"><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> = <inline-formula><mml:math id="MM7"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mtext>from</mml:mtext><mml:mo> </mml:mo><mml:mtext>species</mml:mtext><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> = <italic>p</italic><sub>ij</sub> is the probability of
observing the read <italic>x<sub>i</sub></italic> conditional on the assumption that it
originated from species <italic>j.</italic> We model this probability using the number of
mismatches <italic>m</italic> between the translated read sequence and the reference
sequence and a Poisson distribution with parameter <italic>λ</italic> for that number of
mismatches <inline-formula><mml:math id="MM8"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>Pois</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>;</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mtext>g</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, where <italic>l</italic><sub>g</sub> is the length of the
reference genome, when short reads are matched to a nucleotide database. For nucleotide
matching, <italic>l</italic><sub>g</sub> has a large impact on the probability
computation. However, when matching against protein databases, the more limited
heterogeneity of protein lengths results in a much smaller impact of the length parameter.
In addition, incomplete annotation can potentially make the inclusion of protein length
problematic for the <italic>p</italic><sub>ij</sub> computation. Consequently, for protein
matched sequences, we simply defined our <italic>p<sub>ij</sub></italic> as:
<inline-formula><mml:math id="MM9"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>Pois</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>;</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>Therefore for a given set of <italic>K</italic> species, the
<italic>p</italic><sub>ij</sub> probabilities are regarded as known and the mixture
weights must be estimated. Combining the above we see that when we know the set of species
<italic>K</italic>, the mixture distribution gives the probability of observing read
<italic>x<sub>i</sub></italic>: <inline-formula><mml:math id="MM10"><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>K</mml:mtext></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, i.e Equation (<xref ref-type="disp-formula" rid="btv317-M1">1</xref>).</p>
      <p>We therefore write the likelihood of the dataset <bold><italic>X</italic></bold> as a sum
of <italic>K</italic><sup>n</sup> terms: <disp-formula id="btv317-M2"><label>(2)</label><mml:math id="MM11"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>n</mml:mtext></mml:msubsup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>K</mml:mtext></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>2.3 Estimation of mixture weights</title>
      <p>Assuming a fixed set of species, the posterior probability distribution of the weights
<bold><italic>w</italic></bold> given the read data <italic>X</italic> is:
<disp-formula id="btv317-M3"><label>(3)</label><mml:math id="MM12"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mover><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mover><mml:mfrac><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∫</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mi>d</mml:mi><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula> A practical prior for the mixing parameters
<bold><italic>w</italic></bold> is the Dirichlet distribution owing to its conjugate
status to the multinomial distribution. Despite the use of conjugate priors, the
probabilistic assignment of reads to species involves the expansion of the likelihood into
<italic>K</italic><sup>n</sup> terms which is computationally infeasible through direct
computation. An efficient estimation can be performed by the introduction of unobserved
latent variables that code for the read assignments. In this framework, either the Gibbs
sampler (<xref rid="btv317-B7" ref-type="bibr">Diebolt and Robert, 1994</xref>; <xref rid="btv317-B18" ref-type="bibr">Marin <italic>et al.</italic>, 2005</xref>) a MCM
technique, or the EM (<xref rid="btv317-B6" ref-type="bibr">Dempster and Laird,
1977</xref>) algorithm can be used to estimate the mixture weights
<bold><italic>w</italic></bold>. EM returns a point estimate for
<bold><italic>w</italic></bold> while the Gibbs sampler the distribution of
<bold><italic>w</italic></bold> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>). Both methods were implemented and provided comparable
results.</p>
    </sec>
    <sec>
      <title>2.4 Marginal likelihood estimation</title>
      <p>Each combination of species corresponds to a finite mixture model for which the marginal
likelihood can be estimated. Marginal likelihood comparison has a central role in
comparing different models <inline-formula><mml:math id="MM13"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. To compute the marginal likelihood
<inline-formula><mml:math id="MM14"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for the mixture model <italic>M</italic><sub>k</sub> one
has to average over the parameters with respect to the prior distribution
<inline-formula><mml:math id="MM15"><mml:mrow><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="MM16"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the model parameters: <disp-formula id="btv317-M4"><label>(4)</label><mml:math id="MM17"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>P</mml:mi></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula> The posterior probability of the model
<italic>M</italic><sub>k</sub> is: <disp-formula id="btv317-M5"><label>(5)</label><mml:math id="MM18"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="MM19"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the prior belief we hold for each model. The prior can
be specified depending on the context but the basis of our interpretation is that
parsimonious models with a limited number of species are more likely. Thus, in this
Bayesian framework, our default prior uses a penalty limiting the number of species in the
model, i.e <inline-formula><mml:math id="MM20"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mtext>penalty</mml:mtext></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>number of species in </mml:mtext><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mtext>)</mml:mtext></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. We approximate this penalty factor based on a user-defined
parameter r that represents the species read support required by the user to believe in
the presence of this species. We compute the logarithimic penalty value as the
log-likelihood difference between two models: model <inline-formula><mml:math id="MM21"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>unknown</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> which is our starting point when we have no knowledge about
which species are present and therefore all <italic>N</italic> reads come from the
‘unknown’ category (<inline-formula><mml:math id="MM22"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>) and model <inline-formula><mml:math id="MM23"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>r</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> where r reads have a perfect match to a species
(<italic>p</italic><sub>ij</sub> = 1) and the remaining <inline-formula><mml:math id="MM24"><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mtext>r</mml:mtext></mml:mrow></mml:math></inline-formula> reads belong to the ‘unknown’ category:
<inline-formula><mml:math id="MM25"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mtext>penalty</mml:mtext><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>unknown</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>r</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. For DNA sequence analysis, the
<italic>p</italic><sub>ij</sub> probabilities for the r reads originating from this
unspecified species are approximated by 1/(median genome length in the reference
database). This read support parameter reflects, in our probabilistic framework, the
number of unique reads required to support the hypothesis that a species is present.</p>
      <p>From now on, when we refer to the marginal likelihood, we mean the marginal likelihood
for a specific model and we forego conditioning on the model
<italic>M</italic><sub>k</sub> in the notation. Additionally, in our mixture model
<italic>p<sub>ij</sub></italic> are always regarded as known, therefore the model
parameters <inline-formula><mml:math id="MM26"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the mixture weights <bold><italic>w</italic></bold>.
Hence (<xref ref-type="disp-formula" rid="btv317-M4">4</xref>) becomes: <disp-formula id="btv317-M6"><label>(6)</label><mml:math id="MM27"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mtext>w</mml:mtext></mml:msub><mml:mi>P</mml:mi></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mover><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mover><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mtext>w</mml:mtext></mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∏</mml:mo><mml:mtext>i</mml:mtext></mml:msub><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mtext>i</mml:mtext></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext>j</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>ij</mml:mtext></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:mrow></mml:mstyle><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow></mml:math></disp-formula> Approximating the marginal likelihood is a task both
difficult and time-consuming. We chose the Defensive Importance Sampling technique (<xref rid="btv317-B12" ref-type="bibr">Hesterberg, 1995</xref>) for the relative simple
implementation compared with other approaches (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> for details of implementation). This is crucial
as we perform this approximation numerous times, for every species combination we
consider.</p>
      <p>However the goal of this work is to deliver results in a clinical setting within an
actionable time-frame. We wish to speed up the computation without compromising the
accuracy and the sensitivity of the results. For that reason, we use a point estimate of
the marginal likelihood by means of the EM algorithm. The different approaches were used
on the benchmark dataset. The resulting taxonomic assignment as well as the species
relative abundance estimates were similar between them, with the EM approach resulting in
a 13-fold speed increase (<xref ref-type="supplementary-material" rid="sup1">Supplementary
Methods</xref>).</p>
    </sec>
    <sec>
      <title>2.5 Model comparison: exploring the set of present species</title>
      <p>We use a MCMC to explore the set of present species of size <inline-formula><mml:math id="MM28"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mtext>S</mml:mtext></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, where <italic>S</italic> is the total number of potential
species. In practice we observe that <italic>S</italic> can be &gt; 1000. The MCMC must
explore the state-space in a clinically useful timespan. Therefore we reduce the size of
the state-space, by decreasing the number of <italic>S</italic> species to the low
hundreds. We achieve this by fitting a mixture model with <italic>S</italic> categories,
considering all potential species simultaneously. Post fitting, we retain only the species
categories that are not empty, that is categories that have at least one read assigned to
them.</p>
      <p>Let us assume that at step <italic>t</italic>, we deal with a set of species that
corresponds to the mixture model <italic>M</italic><sub>k</sub>. At the next step
<inline-formula><mml:math id="MM29"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, we either add or remove a species and the new set
corresponds to the mixture model <italic>M</italic><sub>l</sub>. The step proposing the
model <italic>M</italic><sub>l</sub> is accepted with probability: <disp-formula id="btv317-M7"><label>(7)</label><mml:math id="MM30"><mml:mrow><mml:mi>A</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>l</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>l</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>t</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>l</mml:mtext></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>l</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="MM31"><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>l</mml:mtext></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the probability of transitioning from model
<italic>M</italic><sub>l</sub> to model <italic>M</italic><sub>k</sub>. In other words,
this is the probability of adding or removing the species to the
<italic>M</italic><sub>k</sub> set of species that took us to the
<italic>M</italic><sub>l</sub> set of species.</p>
      <p>If the step is accepted, then the chain moves to the new proposed state
<italic>M</italic><sub>l</sub>. Otherwise if not accepted, the chain’s current state
becomes the previous state of the chain, i.e the set of species remains unchanged.</p>
      <p>metaMix outputs log-likelihood traceplots so that the user can visually inspect the
mixing and the convergence of the chain. The default setting is to discard the first 20%
of the iterations as burn-in. We concentrate on the rest to study the distribution over
the model choices and perform model averaging (<xref rid="btv317-B13" ref-type="bibr">Hoeting <italic>et</italic><italic>al.</italic>, 1999</xref>), incorporating model
uncertainty. This framework allows to answer a broad range of questions. For example, what
species have probability <italic>p</italic> or greater being included in the set of
present species? Finally, metaMix also outputs Bayes Factors to quantify the evidence in
favour of each species: <disp-formula><mml:math id="MM32"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi>log</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mtext>BF</mml:mtext><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>species present</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mtext>species absent</mml:mtext></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math>.</disp-formula></p>
      <sec>
        <title>2.6 Optimized implementation: parallel tempering</title>
        <p>We observed that simple MCMC does not efficiently explore the complex model state
space, as evidenced by the poor mixing of the chain (<xref ref-type="fig" rid="btv317-F1">Fig. 1</xref>). In order to overcome this and take advantage of
parallel computing, we run multiple chains and allow exchange moves between them. This
method is called parallel tempering MCMC (<xref rid="btv317-B9" ref-type="bibr">Earl and
Deem, 2005</xref>). </p>
        <fig id="btv317-F1" orientation="portrait" position="float">
          <label>Fig. 1.</label>
          <caption>
            <p><bold>a.</bold> Log-likelihood trace plot for single chain MCMC and <bold>b.</bold>
for PT chain at temperature <italic>T</italic> = 1. <bold>c.</bold> Schematic of
parallel tempering. Exchanges are attempted between chains of neighboring
temperatures, where Chain1 at <inline-formula><mml:math id="MM33"><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula></p>
          </caption>
          <graphic xlink:href="btv317f1p"/>
        </fig>
        <p>Within the parallel setting, each chain simulates from the posterior distribution
<inline-formula><mml:math id="MM34"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> = <inline-formula><mml:math id="MM35"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> raised to a temperature <inline-formula><mml:math id="MM36"><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>, where model <italic>M<sub>k</sub></italic> comes from a
collection of models <inline-formula><mml:math id="MM37"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> and represents a set of species being present. The
different temperature levels result in tempered versions of the posterior distribution
<inline-formula><mml:math id="MM38"><mml:mrow><mml:mi>P</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. When <italic>T</italic> = 1 the draws are from the
posterior distribution. On the other hand, at higher temperatures the posterior spreads
out its mass and becomes flatter. In practice that means that distributions at higher
temperatures are easily sampled, improving the mixing. We are interested in studying the
original posterior distribution with <italic>T</italic> = 1.</p>
        <p>We implemented two types of moves. The first is the mutation step, which simply is the
within chain move we described in the previous section. This is accepted with
probability given by (<xref ref-type="disp-formula" rid="btv317-M7">7</xref>). The other
is the exchange step, a between chains move. This Metropolis-Hastings move proposes to
swap the value of two chains <italic>k</italic> and <italic>k</italic> + 1, adjacent in
terms of <italic>T</italic>, with respective temperatures
1/<italic>T</italic><sub>1</sub> and 1/<italic>T</italic><sub>2</sub> where
<inline-formula><mml:math id="MM39"><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. Suppose that the values of the two chains are
<italic>M</italic><sub>k</sub> and <inline-formula><mml:math id="MM40"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, respectively, corresponding to two different sets of
species. The move is accepted with probability (<xref rid="btv317-B15" ref-type="bibr">Jasra <italic>et</italic><italic>al.</italic>, 2007</xref>): <disp-formula id="btv317-M8"><label>(8)</label><mml:math id="MM41"><mml:mrow><mml:mi>A</mml:mi><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> Because <inline-formula><mml:math id="MM42"><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> = <inline-formula><mml:math id="MM43"><mml:mrow><mml:mi>P</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>k</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM44"><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> = <inline-formula><mml:math id="MM45"><mml:mrow><mml:mi>P</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, it follows that when <inline-formula><mml:math id="MM46"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> represents a set of species of higher probability than
the one <italic>M</italic><sub>k</sub> represents, the exchange will always be accepted
(<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods, Fig.
1</xref>). This allows moves between separate modes, ensuring a global exploration of
the model state space. Eventually ‘hot’ and ‘cold’ chains will progress towards a global
mode.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>3 Results</title>
    <p>We first applied metaMix on a popular benchmark dataset, for which the community
composition and the read assignment is known. We then analyzed RNA-Seq datasets from two
clinical samples that were generated for diagnostic purposes. We compare our results with
the ones produced by MEGAN version 5.3 and Pathoscope 2.0. Both methods are similarity
based. This property and more specifically their flexibility to work with BLASTx output,
makes them better candidates for viral discovery compared with composition-based methods.
From the mixture model methods, we have chosen Pathoscope. We were also interested in
comparing our results to the ones by GRAMMy, which was the first similarity-based method to
use the idea of the mixture model. However, GRAMMy is designed for nucleotide-nucleotide
comparisons (BLASTn), which is suboptimal for viral discovery. GRAMMy also only considers
unassembled reads and requires that these are of the same fixed length. For these reasons,
GRAMMy was not included in the comparison. Default parameters were used for all methods,
unless stated otherwise.</p>
    <p>For the metaMix output, we reported organisms with a posterior probability
<italic>P</italic> &gt; 0.8 (default). The metaMix read support parameter
<monospace>r</monospace>, which essentially sets the sensitivity/specificity of the
method, has an impact on the number of reported species. A large<monospace> r
</monospace>value can result in the method merging together strains that are differentiated
by fewer reads than <monospace>r</monospace>. On the other hand a low<monospace> r
</monospace>can have the opposite effect, whereby the methods splits a strain into two or
more strains, by moving a few reads from one strain to a very similar one with which they
have equally good matches.</p>
    <p>The user’s choice for this key parameter <monospace>r</monospace> should be informed by the
biological context. As an example, for the typical human clinical sample where the sample
collection might have occurred some time after the infection has taken place, a low value in
order to adopt a sensitive approach is reasonable. Hence, for viral identification in human
clinical samples, a low and sensitive value (<inline-formula><mml:math id="MM47"><mml:mrow><mml:mi mathvariant="monospace">r</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>) is a reasonable choice. In a highly complex environmental
metagenomic community where there is a plethora of species of similar abundances, the choice
becomes less straightforward especially in the case of closely related strains. We set the
default value for general community profiling in environmental samples at
<inline-formula><mml:math id="MM48"><mml:mrow><mml:mi mathvariant="monospace">r</mml:mi><mml:mo>=</mml:mo><mml:mn>30</mml:mn></mml:mrow></mml:math></inline-formula>. We also compare the output of metaMix for different values
of this parameter as well as for different posterior probability cutoffs. <xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> presents a
discussion on the metaMix settings as well as practical considerations.</p>
    <sec>
      <title>3.1 FAMeS datasets—closely related strains</title>
      <p>The FAMeS artificial datasets (<ext-link ext-link-type="uri" xlink:href="http://fames.jgi-psf.org/description.html">http://fames.jgi-psf.org/description.html</ext-link>), are mock metagenomic community
datasets composed of random reads from 113 isolate microbial genomes. They are a popular
choice to use as benchmark datasets for various metagenomics methods. Their suitability
stems from the fact that the number of species that form the metagenomic community is
known as well as their relative abundances. The FAMeS datasets have been designed to model
real metagenomic communities in terms of complexity and phylogenetic composition.</p>
      <p>There are three datasets: simHC, simMC, simLC corresponding to high, medium and low
complexity of the metagenomic community, respectively. We first discuss in detail the
results of the three methods for simHC, the highest complexity dataset. simHC consists of
closely related strains with similar abundances and no dominant species. The lowest
abundance is 255 reads out of 118 000 reads. We then summarize the results for the other
two mock communities, simLC and simMC, providing more detail in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>. The
bioinformatics processing in this instance consisted of a BLASTn comparison to all NCBI
bacterial genomes (<xref ref-type="supplementary-material" rid="sup1">Supplementary
Methods</xref>). The number of genomes mapped, retrieved from the the BLASTn output was
∼2500.</p>
      <p>As discussed below, metaMix outperforms Pathoscope and MEGAN in the community profiling
task and consequently in the relative abundance estimation (<xref rid="btv317-T2" ref-type="table">Table 2</xref>).</p>
      <sec>
        <title>3.1.1 metaMix</title>
        <p>To limit the complexity of the fit, we used the two step procedure described in the
Methods and fully implemented in metaMix. We first fitted the mixture model with the
complete set of 2500 species and a limited run length of 500 iterations. Based on this
analysis, we identified 1312 species supported by at least one read and explored this
state space. To limit the computational time, we also considered a stronger
approximation, including only the 374 potential species supported by at least 10
sequencing reads. Both approaches generated similar results, albeit the more complex one
with 1312 potential species required the quadruple of the computation time (12 h instead
of 3 h). metaMix identified 116 species, detecting successfully all the members of the
metagenomic community. These were detected on the strain level except in four instances
where a different strain of the same species, or different species within the same genus
was detected. Four species were identified and not in the simulated dataset, hence can
be considered as false positives. In order to assess the variability of metaMix results,
we ran the analysis 25 times changing the random seed. We report the number of species
detected, the sensitivity and specificity as well as relative abundance estimate measure
errors, at various posterior probability cutoffs (<xref rid="btv317-T1" ref-type="table">Table 1</xref>). We summarize the resulting community profile based on one of these
runs in <xref ref-type="supplementary-material" rid="sup1">Supplementary Table
S1</xref>. </p>
        <table-wrap id="btv317-T1" orientation="portrait" position="float">
          <label>Table 1.</label>
          <caption>
            <p>simHC community: number of species detected by metaMix as well as sensitivity,
specificity, AVGRE, RRMSE for metaMix at various posterior probability cutoffs
(default in bold font)</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead align="left">
              <tr>
                <th colspan="1" rowspan="1">Cutoff</th>
                <th colspan="1" rowspan="1">0.9</th>
                <th colspan="1" rowspan="1">0.8</th>
                <th colspan="1" rowspan="1">0.7</th>
                <th colspan="1" rowspan="1">0.6</th>
                <th colspan="1" rowspan="1">0.5</th>
              </tr>
            </thead>
            <tbody align="left">
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity (mean)</bold>
                </td>
                <td colspan="1" rowspan="1">99.82</td>
                <td colspan="1" rowspan="1">
                  <bold>99.96</bold>
                </td>
                <td colspan="1" rowspan="1">99.96</td>
                <td colspan="1" rowspan="1">100</td>
                <td colspan="1" rowspan="1">100</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity (SD)</bold>
                </td>
                <td colspan="1" rowspan="1">0.0036</td>
                <td colspan="1" rowspan="1">
                  <bold>0.0017</bold>
                </td>
                <td colspan="1" rowspan="1">0.0017</td>
                <td colspan="1" rowspan="1">0</td>
                <td colspan="1" rowspan="1">0</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Specificity (mean)</bold>
                </td>
                <td colspan="1" rowspan="1">99.86</td>
                <td colspan="1" rowspan="1">
                  <bold>99.82</bold>
                </td>
                <td colspan="1" rowspan="1">99.77</td>
                <td colspan="1" rowspan="1">99.73</td>
                <td colspan="1" rowspan="1">99.70</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Specificity (SD)</bold>
                </td>
                <td colspan="1" rowspan="1">0.0004</td>
                <td colspan="1" rowspan="1">
                  <bold>0.0004</bold>
                </td>
                <td colspan="1" rowspan="1">0.0005</td>
                <td colspan="1" rowspan="1">0.0003</td>
                <td colspan="1" rowspan="1">0.0001</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>RRMSE</bold>
                </td>
                <td colspan="1" rowspan="1">16.69</td>
                <td colspan="1" rowspan="1">16.85</td>
                <td colspan="1" rowspan="1">16.73</td>
                <td colspan="1" rowspan="1">17.50</td>
                <td colspan="1" rowspan="1">17.48</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>AVGRE</bold>
                </td>
                <td colspan="1" rowspan="1">8.20</td>
                <td colspan="1" rowspan="1">8.31</td>
                <td colspan="1" rowspan="1">8.16</td>
                <td colspan="1" rowspan="1">8.60</td>
                <td colspan="1" rowspan="1">8.56</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>No. Species–median</bold>
                </td>
                <td colspan="1" rowspan="1">115</td>
                <td colspan="1" rowspan="1">
                  <bold>116</bold>
                </td>
                <td colspan="1" rowspan="1">117</td>
                <td colspan="1" rowspan="1">118</td>
                <td colspan="1" rowspan="1">119</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>No. Species–SD</bold>
                </td>
                <td colspan="1" rowspan="1">1.2</td>
                <td colspan="1" rowspan="1">
                  <bold>0.9</bold>
                </td>
                <td colspan="1" rowspan="1">1.2</td>
                <td colspan="1" rowspan="1">0.7</td>
                <td colspan="1" rowspan="1">0.3</td>
              </tr>
            </tbody>
          </table>
          <table-wrap-foot>
            <fn id="btv317-TF2">
              <p>The results are average values based on 25 runs.</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
      </sec>
      <sec>
        <title>3.1.2 Pathoscope</title>
        <p>Pathoscope identified 47 species. Of these 45 are members of the metagenomic community.
42 are the exact same strain, while 3 are either the same species but different strain,
or same genus but different species. However it fails to detect 68 species that are
actually present in the mixture. Tuning the parameter that enforces the parsimonious
results (any thetaPrior &gt; 10), thereby removing the unique read penalty, Pathoscope
behaves as a standard mixture model and identifies 165 species (<xref rid="btv317-T2" ref-type="table">Table 2</xref>). With these settings, it identifies all but one
members of the community. The organisms are identified at the strain level, except in
three instances where it identified different species within the same genus. The major
interpretation issue is the presence of a long tail of species (54 species) that are
actually not present in the mixture (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>). Pathoscope produced the results in 1 min. </p>
        <table-wrap id="btv317-T2" orientation="portrait" position="float">
          <label>Table 2.</label>
          <caption>
            <p>Number of species identified for the FAMeS simLC and simMC datasets, as well as
sensitivity, specificity and abundance estimates error measures RRMSE and AVGRE</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead align="left">
              <tr>
                <th colspan="1" rowspan="1"/>
                <th colspan="1" rowspan="1">metaMix</th>
                <th colspan="1" rowspan="1">Pathoscope</th>
                <th colspan="1" rowspan="1">MEGAN</th>
              </tr>
            </thead>
            <tbody align="left">
              <tr>
                <td colspan="1" rowspan="1"/>
                <td align="center" colspan="3" rowspan="1">
                  <bold>simHC</bold>
                </td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Number of species</bold>
                </td>
                <td colspan="1" rowspan="1">116</td>
                <td colspan="1" rowspan="1">165</td>
                <td colspan="1" rowspan="1">232</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity</bold>
                </td>
                <td colspan="1" rowspan="1">99.96</td>
                <td colspan="1" rowspan="1">99.1</td>
                <td colspan="1" rowspan="1">100</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">99.8</td>
                <td colspan="1" rowspan="1">97.7</td>
                <td colspan="1" rowspan="1">95.0</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>RRMSE</bold>
                </td>
                <td colspan="1" rowspan="1">16.9</td>
                <td colspan="1" rowspan="1">36.6</td>
                <td colspan="1" rowspan="1">35.9</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>AVGRE</bold>
                </td>
                <td colspan="1" rowspan="1">8.3</td>
                <td colspan="1" rowspan="1">29.7</td>
                <td colspan="1" rowspan="1">18</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1"/>
                <td align="center" colspan="3" rowspan="1">
                  <bold>simLC</bold>
                </td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Number of species</bold>
                </td>
                <td colspan="1" rowspan="1">114</td>
                <td colspan="1" rowspan="1">147</td>
                <td colspan="1" rowspan="1">208</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity</bold>
                </td>
                <td colspan="1" rowspan="1">98.8</td>
                <td colspan="1" rowspan="1">97.3</td>
                <td colspan="1" rowspan="1">100</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">99.8</td>
                <td colspan="1" rowspan="1">98.4</td>
                <td colspan="1" rowspan="1">95.9</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>RRMSE</bold>
                </td>
                <td colspan="1" rowspan="1">21.1</td>
                <td colspan="1" rowspan="1">185.6</td>
                <td colspan="1" rowspan="1">32</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>AVGRE</bold>
                </td>
                <td colspan="1" rowspan="1">8.9</td>
                <td colspan="1" rowspan="1">53.3</td>
                <td colspan="1" rowspan="1">16.1</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1"/>
                <td align="center" colspan="3" rowspan="1">
                  <bold>simMC</bold>
                </td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Number of species</bold>
                </td>
                <td colspan="1" rowspan="1">115</td>
                <td colspan="1" rowspan="1">144</td>
                <td colspan="1" rowspan="1">208</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity</bold>
                </td>
                <td colspan="1" rowspan="1">98.5</td>
                <td colspan="1" rowspan="1">98.2</td>
                <td colspan="1" rowspan="1">100</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">99.8</td>
                <td colspan="1" rowspan="1">98.6</td>
                <td colspan="1" rowspan="1">95.9</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>RRMSE</bold>
                </td>
                <td colspan="1" rowspan="1">29.6</td>
                <td colspan="1" rowspan="1">152.7</td>
                <td colspan="1" rowspan="1">31.9</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>AVGRE</bold>
                </td>
                <td colspan="1" rowspan="1">12.9</td>
                <td colspan="1" rowspan="1">49.2</td>
                <td colspan="1" rowspan="1">19.3</td>
              </tr>
            </tbody>
          </table>
          <table-wrap-foot>
            <fn id="btv317-TF1">
              <p>The metaMix results are based on 25 runs.</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
      </sec>
      <sec>
        <title>3.1.3 MEGAN</title>
        <p>MEGAN identified 232 taxa (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>). It discovered all original species of the community
on the strain level, except for nine instances where it identified the LCA. Aside from
the lack of strain or species specificity for 8% of the community members, the main
issue is the long tail of false positives, i.e low specificity (<xref rid="btv317-T2" ref-type="table">Table 2</xref>). In the species summary provided by MEGAN, there are
119 taxa (species or higher order) which are not actually present, but supported by a
sufficient number of reads (default value: 50 reads) for MEGAN to include these in the
output. Results were produced in less than a minute. To lower the false positive rate,
we also filtered the BLAST results prior to MEGAN analysis, imposing stringent E-value
and similarity cutoffs. An E-value &lt; 1 E-10 removed only 9 entries from the results,
requiring similarity &gt; 90% removed only 5, while both filters resulted in 208 taxa in
the summary results.</p>
      </sec>
      <sec>
        <title>3.1.4 Relative abundances</title>
        <p>The primary aim for metaMix is to be a diagnostic tool and to answer whether a species
is present or absent from the mixture we study. As a secondary aim, we are also
interested in estimating accurately the relative abundance of the present organisms. We
can assess the abundance estimates produced by the methods by using error measures such
as the relative root mean square error, RRMSE and the average relative error, AVGRE
(<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> for
definition). For metaMix, we use the relative abundance estimates from the 25 runs. For
all methods, when the exact strain was not identified but the correct species or genus
was, we used this abundance. metaMix produces the most accurate abundance estimates and
the results are summarized in <xref rid="btv317-T2" ref-type="table">Table 2</xref>.</p>
      </sec>
      <sec>
        <title>3.1.5 Importance of read support parameter</title>
        <p>We then assessed the importance of the read support parameter <inline-formula><mml:math id="MM49"><mml:mtext>r</mml:mtext></mml:math></inline-formula> on the output of metaMix. We ran metaMix on the benchmark
simHC FAMeS dataset with <monospace>r</monospace> = {10, 20, 30, 50} reads, 25 runs for
each (<xref rid="btv317-T3" ref-type="table">Table 3</xref>. We observe that as
<monospace>r</monospace> decreases, a few more related strains from the reference
database that are not in the community are retained in the output. As
<monospace>r</monospace> increases two similar strains are merged into one. </p>
        <table-wrap id="btv317-T3" orientation="portrait" position="float">
          <label>Table 3.</label>
          <caption>
            <p>simHC FAMeS dataset</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead align="left">
              <tr>
                <th colspan="1" rowspan="1">Read Support</th>
                <th colspan="1" rowspan="1">metaMix</th>
                <th colspan="1" rowspan="1">Pathoscope</th>
                <th colspan="1" rowspan="1">MEGAN</th>
              </tr>
            </thead>
            <tbody align="left">
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>50</bold>
                </td>
                <td colspan="1" rowspan="1">114 (0.9)</td>
                <td colspan="1" rowspan="1">131</td>
                <td colspan="1" rowspan="1">147</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity–Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">99.1–99.9</td>
                <td colspan="1" rowspan="1">98.2–99.1</td>
                <td colspan="1" rowspan="1">100–98.5</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>30</bold>
                </td>
                <td colspan="1" rowspan="1">116 (0.95)</td>
                <td colspan="1" rowspan="1">131</td>
                <td colspan="1" rowspan="1">156</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity–Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">99.96–99.8</td>
                <td colspan="1" rowspan="1">98.2–99.1</td>
                <td colspan="1" rowspan="1">100–98.2</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>20</bold>
                </td>
                <td colspan="1" rowspan="1">124 (1.65)</td>
                <td colspan="1" rowspan="1">141</td>
                <td colspan="1" rowspan="1">166</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity–Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">100–99.5</td>
                <td colspan="1" rowspan="1">98.2–98.7</td>
                <td colspan="1" rowspan="1">100–98</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>10</bold>
                </td>
                <td colspan="1" rowspan="1">155 (1.9)</td>
                <td colspan="1" rowspan="1">155</td>
                <td colspan="1" rowspan="1">188</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">
                  <bold>Sensitivity–Specificity</bold>
                </td>
                <td colspan="1" rowspan="1">100–98.2</td>
                <td colspan="1" rowspan="1">99.1–98.2</td>
                <td colspan="1" rowspan="1">100–97.4</td>
              </tr>
            </tbody>
          </table>
          <table-wrap-foot>
            <fn id="btv317-TF3">
              <p>Number of species (SD in parenthesis), sensitivity and specificity by metaMix (25
runs), Pathoscope and MEGAN, as a function of the min. number of reads required
for each species to appear in the output. metaMix: <monospace>r</monospace> = {10,
20, 30, 50} reads, Pathoscope: thetaPrior<inline-formula><mml:math id="MM50"><mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>7</mml:mn><mml:mo>+</mml:mo></mml:mrow></mml:math></inline-formula> post-run threshold = {10, 20, 30, 50} reads, MEGAN:
‘Min Support’ + post-run threshold = {10, 20, 30, 50} reads.</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
        <p>We compared these results with the output of Pathoscope and MEGAN. None of these
methods have a read support parameter serving the same purpose as in metaMix, so we
tuned the most relevant parameters in these tools. Pathoscope has a thetaPrior parameter
that enforces a unique read penalty. This parameter represents the read pseudocounts for
the non-unique matches and the default setting is zero which allows for non informative
priors. Using the default setting Pathoscope identifies 47 taxa. When thetaP’s value is
in (1,7) it identifies 22 taxa, while with thetaP &gt; 7 it identifies 165. With this
latter setting which is the one we chose for the comparison, Pathoscope behaves as a
standard mixture model.</p>
        <p>MEGAN has a ‘Min Support’ parameter which sets a threshold for the number of reads that
must be assigned to a taxon so that it appears in the result. Any read assigned to a
taxon not having the required support is pushed up the taxonomy until a taxon is found
that has sufficient support. We used Min support = {10, 20, 30, 50} reads. The
respective number of taxa in the summary files was 250, 243, 236, 232. We then also
applied a post-run read count threshold to both methods’ output summary. We set the
threshold for 10, 20, 30, 50 reads, respectively, disregarding taxa that have less than
that number of reads assigned to them. In all instances metaMix produces a community
profile closer to the real one, along with a better balance of sensitivity and
specificity compared with the other two methods (<xref rid="btv317-T3" ref-type="table">Table 3</xref>). Pathoscope finds ∼15 more false positives while MEGAN ∼40 more
compared with metaMix at the same read support level, except for the lowest r = 10 where
metaMix and Pathoscope achieve the same specificity. We report further results in the
<xref ref-type="supplementary-material" rid="sup1">supplementaty discussion</xref>,
using different posterior probability cutoffs for the different r settings.</p>
      </sec>
      <sec>
        <title>3.1.6 simMC and simLC communities</title>
        <p>The FAMeS project includes two additional mock communities that consist of the same 113
species as simHC, but they differ in their relative abundances setup: in simLC there is
one dominant species or a few more in simMC. We ran metaMix 25 times for both, changing
the random seed. These two datasets turned out to be more challenging for all three
methods, missing or merging together some similar related strains. metaMix outperforms
Pathoscope and MEGAN in terms of producing a parsimonious community profile and having
the best sensitivity and specificity trade-off (<xref rid="btv317-T2" ref-type="table">Table 2</xref>).</p>
        <p>The FAMeS datasets are complex and distinct from typical human clinical samples,
putting aside gut microbiome analysis. The differences are the large number of
organisms, the presence of closely related strains of similar abundances, as well as the
lack of viruses. Nevertheless, they are essential datasets to use as benchmark for
examining the performance of the methods in a situation of closely related strains in
the sample.</p>
      </sec>
    </sec>
    <sec>
      <title>3.2 Human clinical sample—low viral load</title>
      <sec>
        <title>3.2.1 Protein reference database</title>
        <p>For the analysis of human clinical samples, we use a custom reference database that
combines viral, bacterial, human and mouse RefSeq proteins (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>). To test
metaMix in a clinical setting with a low viral load, we used a brain biopsy RNA-Seq
dataset from an undiagnosed encephalitis patient (UCL Hospital, data provided as part of
a collaboration with Professor Breuer, UCL). Total RNA was purified from the biopsy and
polyA RNA was separated for sequencing library preparation. The Illumina MiSeq
instrument generated 20 million paired-end reads. We processed the raw data using the
bioinformatics pipeline described in Methods section. The processed dataset consisted of
∼75 000 non-host reads and contigs. Based on the BLASTx output there were 1298 potential
species.</p>
      </sec>
      <sec>
        <title>3.2.2 metaMix</title>
        <p>Following the initial processing, we used metaMix for species identification and
abundance estimation. The resulting species profile is shown in <xref rid="btv317-T4" ref-type="table">Table 4</xref>; the 13 metaMix entries correspond to 10 species. The
most abundant organism was the <inline-formula><mml:math id="MM51"><mml:mi>ϕ</mml:mi></mml:math></inline-formula>X174 bacteriophage, which is routinely used for
deep-sequencing quality control. More interestingly, we identified an astrovirus. Five
short assembled contigs (44 reads) with length ranging between 167 and 471 bp and two
non-assembled reads were assigned to the <italic>Astrovirus VA1</italic> with a
probability score of 1 (<xref ref-type="fig" rid="btv317-F2">Fig. 2</xref>). metaMix
also identified a number of bacteria supported by a few reads. These are either known
laboratory reagent contaminants or human skin associated contaminants (<xref rid="btv317-B26" ref-type="bibr">Salter <italic>et</italic><italic>al.</italic>,
2014</xref>). The analysis completed in 29 min. </p>
        <table-wrap id="btv317-T4" orientation="portrait" position="float">
          <label>Table 4.</label>
          <caption>
            <p>Human clinical sample—novel virus</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead align="left">
              <tr>
                <th colspan="1" rowspan="1"/>
                <th colspan="1" rowspan="1"/>
                <th align="center" colspan="3" rowspan="1">metaMix<hr/></th>
                <th colspan="1" rowspan="1">Pathoscope<hr/></th>
              </tr>
              <tr>
                <th colspan="1" rowspan="1">Taxon identifier</th>
                <th colspan="1" rowspan="1">Scientific name</th>
                <th colspan="1" rowspan="1">Assigned reads</th>
                <th colspan="1" rowspan="1">Posterior Probability</th>
                <th colspan="1" rowspan="1">Bayes factor</th>
                <th colspan="1" rowspan="1">Final best hit read numbers</th>
              </tr>
            </thead>
            <tbody align="left">
              <tr>
                <td colspan="1" rowspan="1">374840</td>
                <td colspan="1" rowspan="1">
                  <italic>Enter. phage phiX174</italic>
                </td>
                <td colspan="1" rowspan="1">60447</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">140154</td>
                <td colspan="1" rowspan="1">65327</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">NA</td>
                <td colspan="1" rowspan="1">
                  <italic>unknown</italic>
                </td>
                <td colspan="1" rowspan="1">10257</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">NA</td>
                <td colspan="1" rowspan="1">NA</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">9606</td>
                <td colspan="1" rowspan="1">
                  <italic>Homo sapiens</italic>
                </td>
                <td colspan="1" rowspan="1">214</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">564</td>
                <td colspan="1" rowspan="1">554</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">28090</td>
                <td colspan="1" rowspan="1">
                  <italic>Acinetobacter lwoffii</italic>
                </td>
                <td colspan="1" rowspan="1">94</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">197</td>
                <td colspan="1" rowspan="1">126</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">469</td>
                <td colspan="1" rowspan="1">
                  <italic>Acinetobacter</italic>
                </td>
                <td colspan="1" rowspan="1">71</td>
                <td colspan="1" rowspan="1">0.99</td>
                <td colspan="1" rowspan="1">216</td>
                <td colspan="1" rowspan="1">123</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">13690</td>
                <td colspan="1" rowspan="1">
                  <italic>Sphingobium yanoikuyae</italic>
                </td>
                <td colspan="1" rowspan="1">61</td>
                <td colspan="1" rowspan="1">0.99</td>
                <td colspan="1" rowspan="1">216</td>
                <td colspan="1" rowspan="1">135</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">133448</td>
                <td colspan="1" rowspan="1">
                  <italic>Citrobacter youngae</italic>
                </td>
                <td colspan="1" rowspan="1">47</td>
                <td colspan="1" rowspan="1">0.91</td>
                <td colspan="1" rowspan="1">4</td>
                <td colspan="1" rowspan="1">169</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">645687</td>
                <td colspan="1" rowspan="1">
                  <italic>Astrovirus VA1</italic>
                </td>
                <td colspan="1" rowspan="1">46</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">65</td>
                <td colspan="1" rowspan="1">46</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">199310</td>
                <td colspan="1" rowspan="1">
                  <italic>Escherichia coli CFT073</italic>
                </td>
                <td colspan="1" rowspan="1">30</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">12</td>
                <td colspan="1" rowspan="1">35</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">56946</td>
                <td colspan="1" rowspan="1">
                  <italic>Afipia broomeae</italic>
                </td>
                <td colspan="1" rowspan="1">29</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">29</td>
                <td colspan="1" rowspan="1">77</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">409438</td>
                <td colspan="1" rowspan="1">
                  <italic>E.coli SE11</italic>
                </td>
                <td colspan="1" rowspan="1">19</td>
                <td colspan="1" rowspan="1">0.98</td>
                <td colspan="1" rowspan="1">14</td>
                <td colspan="1" rowspan="1">49</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">618</td>
                <td colspan="1" rowspan="1">
                  <italic>Serratia odorifera</italic>
                </td>
                <td colspan="1" rowspan="1">16</td>
                <td colspan="1" rowspan="1">0.92</td>
                <td colspan="1" rowspan="1">5</td>
                <td colspan="1" rowspan="1">—</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">1747</td>
                <td colspan="1" rowspan="1">
                  <italic>Propionibacterium acnes</italic>
                </td>
                <td colspan="1" rowspan="1">13</td>
                <td colspan="1" rowspan="1">0.97</td>
                <td colspan="1" rowspan="1">14</td>
                <td colspan="1" rowspan="1">35</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">1282</td>
                <td colspan="1" rowspan="1">
                  <italic>Staphylococcus epidermidis</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">10</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">28211</td>
                <td colspan="1" rowspan="1">
                  <italic>Alphaproteobacteria</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">10</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">28037</td>
                <td colspan="1" rowspan="1">
                  <italic>Streptococcus mitis</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">8</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">562</td>
                <td colspan="1" rowspan="1">
                  <italic>E.coli</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">8</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">509173</td>
                <td colspan="1" rowspan="1">
                  <italic>Acinetobacter baumannii AYE</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">7</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">41297</td>
                <td colspan="1" rowspan="1">
                  <italic>Sphingomonadaceae</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">6</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">40214</td>
                <td colspan="1" rowspan="1">
                  <italic>Acinetobacter johnsonii</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">6</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">29391</td>
                <td colspan="1" rowspan="1">
                  <italic>Gemella morbillorum</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">5</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">76122</td>
                <td colspan="1" rowspan="1">
                  <italic>Alloprevotella tannerae</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">4</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">652103</td>
                <td colspan="1" rowspan="1">
                  <italic>Rhodopseudomonas palustris</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">2</td>
              </tr>
              <tr>
                <td colspan="1" rowspan="1">268747</td>
                <td colspan="1" rowspan="1">
                  <italic>Prochlorococcus phage</italic>
                </td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">—</td>
                <td colspan="1" rowspan="1">2</td>
              </tr>
            </tbody>
          </table>
          <table-wrap-foot>
            <fn id="btv317-TF4">
              <p>Comparison of community profile: metaMix—pathoscope.</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
        <fig id="btv317-F2" orientation="portrait" position="float">
          <label>Fig. 2.</label>
          <caption>
            <p>Human clinical sample - novel virus. The reads (short lines) assigned by metaMix to
Astrovirus VA1 are aligned to the genome. The longer lines represent the genes of
the virus</p>
          </caption>
          <graphic xlink:href="btv317f2p"/>
        </fig>
        <p>The presence of the astrovirus was confirmed with real-time RT-PCR. Genome sequencing
of the astrovirus in the sample and subsequent study of the consensus sequence showed
that we had in fact identified a novel virus, closely related to the VA1 strain (<xref rid="btv317-B4" ref-type="bibr">Brown <italic>et</italic><italic>al.</italic>,
2014</xref>).</p>
      </sec>
      <sec>
        <title>3.2.3 Pathoscope</title>
        <p>Pathoscope identified 22 taxa, corresponding to 15 species and some genera or families
(<xref rid="btv317-T4" ref-type="table">Table 4</xref>). It also assigned all 46 reads
to the <italic>Astrovirus VA1.</italic> Almost all the species identified from metaMix
were identified by Pathoscope, with an additional nine taxa supported by few reads. As
the method works only with unassembled sequence data, an extra BLASTx step was performed
for the 91 516 reads that had contributed to the 679 assembled contigs. Pathoscope
produced the results in  &lt; 1 min.</p>
      </sec>
      <sec>
        <title>3.2.4 MEGAN</title>
        <p>MEGAN identified 19 taxa and did not detect the astrovirus signal. We modified the
minimum read support parameter from 50 reads to 10 to increase sensitivity. MEGAN then
identified 25 taxa, including the <italic>Astrovirus VA1.</italic> The remaining 24 were
mostly genera, relevant to the species detected by metaMix and Pathoscope. MEGAN
produced the results in  &lt; 1 min.</p>
      </sec>
    </sec>
    <sec>
      <title>3.3 Human clinical sample—species not in the database</title>
      <p>We then compared the three methods in a scenario where sequences present in the sample
are absent from our reference database. We analyzed 32 million RNA-Seq reads, obtained
using the HiSeq instrument for a human clinical sample. Following initial processing using
our bionformatics pipeline, the dataset had 1 261 575 non-host sequences for subsequent
analyses. There were 3150 potential species based on the BLASTx output.</p>
      <sec>
        <title>3.3.1 metaMix</title>
        <p>The resulting species profile consisted of 7 species (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>). The most
interesting finding was the identification of <italic>Human coronavirus OC43</italic>
(<sc>hcov-oc</sc>43) with almost a million reads assigned to it. Additionally there
were 67 K reads assigned to <italic>Human enteric coronavirus strain 4408.</italic> The
presence of both viruses in the results indicated that even though the virus in the
sample was mostly similar to <sc>hc</sc>o<sc>v-oc</sc> 43, there were sequences sharing
higher similarity to 4408 at some loci. This is highlighting how the database choice
impacts the results: the RefSeq database we used has only one
<sc>hc</sc>o<sc>v-oc</sc>43 strain, while in GenBank there are several, capturing the
high mutation rates of this species. We followed up on the sequences assigned to the
‘unknown category’, looking for nucleotide similarity with <sc>nr-nt</sc> using BLASTn.
Half of the reads originated from an untranslated region of the Coronavirus genome,
which is not captured by the protein reference database. The remaining reads matched
confidently to either zebrafish or chicken sequences, two organisms whose proteins are
not in the human microbiome reference we are using. These matches were explained as
barcode leakage resulting from multiplexing on the same flowcell zebrafish and chicken
RNA-Seq libraries. metaMix appropriately assigned these reads to the ‘unknown’ category,
producing a clean probabilistic summary (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>). The method ran in 4.7 h. The presence of
the coronavirus was confirmed using RT-PCR. In this instance, the metaMix results
emphasize the importance of being able to deal with missing reference sequences that do
not have a closely related strain or species in the same database.</p>
      </sec>
      <sec>
        <title>3.3.2 Pathoscope</title>
        <p>Pathoscope identified 177 species in this sample. We optimized the value of the unique
read penalty parameter and we achieved the best results with the thetaPrior parameter
set within the range 10–100. With these settings, the method identified 52 species
(<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>).
Our assessment is that Pathoscope is confused by the lack of completeness of databases
combined with the absence of an ‘unknown’ category, which prevents it from dealing with
these unassigned reads sensibly. Pathoscope ran in 10 min.</p>
      </sec>
      <sec>
        <title>3.3.3 MEGAN</title>
        <p>MEGAN assigned the reads to 30 taxa. These included some species and genera but most
were families (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table
S2</xref>). Approximately 250 K reads could not be assigned to any taxonomic level.
MEGAN completed its analysis in 8 min.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>4 Discussion</title>
    <p>Here, we present metaMix, a sensitive method for metagenomic species identification and
abundance estimation. It is implemented as an R package, freely available from CRAN. Using a
Bayesian mixture model framework, we account for model uncertainty by performing model
averaging and we resolve ambiguous assignments by considering all reads simultaneously. A
key feature of the method is that it provides probabilities that answer pertinent biological
questions, in particular the posterior probability for the presence of a species in the
mixture. Additionally it accurately quantifies the relative proportions of the
organisms.</p>
    <p>This general framework is designed to address interpretation issues associated with closely
related strains in the sample, low abundance organisms and absence of genomes from the
reference database. We show that metaMix outperforms other methods in the community
profiling task, particularly when complex structures with closely related strains are
studied. As a consequence, it also produces more accurate relative abundance estimates for
the species in the mixture. The method can deal with either unassembled reads or assembled
contigs or both, allowing for flexibility of choice for the bioinformatics preprocessing. In
practice, the choice of bioinformatics processing prior to the application of our Bayesian
mixture analysis must be optimized for each application, and our processing pipeline has
been designed with viral sequence identification from transcriptome sequencing as a main
goal. Nevertheless, as demonstrated by our analysis of the mock bacterial community dataset,
the method can be applied in other contexts.</p>
    <p>The sensitivity and general applicability of metaMix comes at an increased computational
cost, requiring access to a multi-core computer to run efficiently. For the datasets
presented here, the computation time remained manageable and did not exceed a few hours,
using 12 cores to run 12 parallel chains. Nevertheless, a limitation of metaMix is the
increased processing time for very large datasets. Speed related improvements can be
implemented in scenarios where the species ambiguity concerns only a small proportion of the
read set. Reads with certain assignments can be flagged prior to the MCMC exploration of the
state-space. Their assignment information can then be carried forward, thereby reducing the
size of the similarity matrix used as input by the mixture model. Another area of possible
improvement is MCMC convergence determination. The current version of metaMix produces
log-likelihood traceplots allowing the user to visually inspect the MCMC convergence;
however, additional diagnostic criteria can be implemented in future versions. Finally,
consideration of the differences between mismatches, especially on the amino-acid level
could lead to more accurate estimation of the <italic>p</italic><sub>ij</sub> probabilities.
Such information is captured by the BLASTx similarity score. This metric could thus be used
for probability estimation, instead of the number of mismatches.</p>
    <p>metaMix is most useful for complex datasets for which the interpretation is challenging. It
has been mainly used as a clinical diagnostic tool, helping with the identification of the
infecting pathogen while providing an accurate profile of the community in the
sample.<?A3B2 tpb-2.5 pt?></p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Data</label>
      <media xlink:href="btv317_Supplementary_Data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank David Balding for the constructive comments on the manuscript, Christian Robert
for the helpful methodological discussion, Judith Breuer, Julianne Lockwood and Mike Hubank
for data sharing and informative discussions for the interpretation of the results.</p>
  </ack>
  <sec>
    <title>Funding</title>
    <p>SM is supported by a PhD studentship from the Annals of Human Genetics. This work is also
supported by the National Institute for Health Research University College London Hospitals
Biomedical Research Centre.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="btv317-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Altschul</surname><given-names>S.F.</given-names></name><etal/></person-group> (<year>1990</year>) <article-title>Basic local alignment search
tool</article-title>. <source>J. Mol. Biol.</source>, <volume>215</volume>,
<fpage>403</fpage>–<lpage>410</lpage>.<pub-id pub-id-type="pmid">2231712</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barzon</surname><given-names>L.</given-names></name><etal/></person-group> (<year>2013</year>) <article-title>Next-generation sequencing
technologies in diagnostic virology</article-title>. <source>J. Clin. Virol.</source>,
<volume>58</volume>, <fpage>346</fpage>–<lpage>350</lpage>.<pub-id pub-id-type="pmid">23523339</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brady</surname><given-names>A.</given-names></name><name><surname>Salzberg</surname><given-names>S.L.</given-names></name></person-group> (<year>2009</year>) <article-title>Phymm and PhymmBL: metagenomic
phylogenetic classification with interpolated Markov models</article-title>.
<source>Nat. Methods</source>, <volume>6</volume>,
<fpage>673</fpage>–<lpage>676</lpage>.<pub-id pub-id-type="pmid">19648916</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname><given-names>J.R.</given-names></name><etal/></person-group> (<year>2014</year>) <article-title>Astrovirus VA1/HMO-C: an increasingly
recognised neurotropic pathogen in immunocompromised patients</article-title>.
<source>Clin. Infect. Dis.</source>, <volume>60</volume>,
<fpage>881</fpage>–<lpage>888</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chiu</surname><given-names>C.Y.</given-names></name></person-group> (<year>2013</year>) <article-title>Viral pathogen
discovery</article-title>. <source>Curr. Opin. Microbiol.</source>, <volume>16</volume>,
<fpage>468</fpage>–<lpage>478</lpage>.<pub-id pub-id-type="pmid">23725672</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dempster</surname><given-names>A.</given-names></name><name><surname>Laird</surname><given-names>N.</given-names></name></person-group> (<year>1977</year>) <article-title>Maximum likelihood from incomplete data
via the EM algorithm</article-title>. <source>J. R. Stat. Soc..</source>,
<volume>39</volume>, <fpage>1</fpage>–<lpage>38</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diebolt</surname><given-names>J.</given-names></name><name><surname>Robert</surname><given-names>C.P.</given-names></name></person-group> (<year>1994</year>) <article-title>Estimation of finite mixture
distributions through Bayesian sampling</article-title>. <source>J. R. Stat. Soc. Ser. B
Methodol.</source>, <volume>56</volume>,
<fpage>363</fpage>–<lpage>375</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dröge</surname><given-names>J.</given-names></name><name><surname>McHardy</surname><given-names>A.C.</given-names></name></person-group> (<year>2012</year>) <article-title>Taxonomic binning of metagenome samples
generated by next-generation sequencing technologies</article-title>. <source>Brief.
Bioinform.</source>, <volume>13</volume>,
<fpage>646</fpage>–<lpage>655</lpage>.<pub-id pub-id-type="pmid">22851513</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Earl</surname><given-names>D.J.</given-names></name><name><surname>Deem</surname><given-names>M.W.</given-names></name></person-group> (<year>2005</year>) <article-title>Parallel tempering: theory,
applications, and new perspectives</article-title>. <source>Phys. Chem. Chem.
Phys.</source>, <volume>7</volume>,
<fpage>3910</fpage>–<lpage>3916</lpage>.<pub-id pub-id-type="pmid">19810318</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fancello</surname><given-names>L.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>Computational tools for viral
metagenomics and their application in clinical research</article-title>.
<source>Virology</source>, <volume>434</volume>,
<fpage>162</fpage>–<lpage>174</lpage>.<pub-id pub-id-type="pmid">23062738</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Francis</surname><given-names>O.E.</given-names></name><etal/></person-group> (<year>2013</year>) <article-title>Pathoscope: species identification and
strain attribution with unassembled sequencing data</article-title>. <source>Genome
Research</source>, <volume>23</volume>,
<fpage>1721</fpage>–<lpage>729</lpage>.<pub-id pub-id-type="pmid">23843222</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hesterberg</surname><given-names>T.</given-names></name></person-group> (<year>1995</year>) <article-title>Weighted average importance sampling
and defensive mixture distributions</article-title>. <source>Technometrics</source>,
<volume>37</volume>, <fpage>185</fpage>–<lpage>194</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoeting</surname><given-names>J.A.</given-names></name><etal/></person-group> (<year>1999</year>) <article-title>Bayesian model averaging: a
tutorial</article-title>. <source>Stat. Sci.</source>, <volume>14</volume>,
<fpage>382</fpage>–<lpage>417</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huson</surname><given-names>D.H.</given-names></name><etal/></person-group> (<year>2007</year>) <article-title>MEGAN analysis of metagenomic
data</article-title>. <source>Genome Res.</source>, <volume>17</volume>,
<fpage>377</fpage>–<lpage>386</lpage>.<pub-id pub-id-type="pmid">17255551</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jasra</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2007</year>) <article-title>On population-based simulation for
static inference</article-title>. <source>Stat. Comput.</source>, <volume>17</volume>,
<fpage>263</fpage>–<lpage>279</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kunin</surname><given-names>V.</given-names></name><etal/></person-group> (<year>2008</year>) <article-title>A bioinformatician’s guide to
metagenomics</article-title>. <source>Microbiol. Mol. Biol. Rev.</source>,
<volume>72</volume>, <fpage>557</fpage>–<lpage>578</lpage>.<pub-id pub-id-type="pmid">19052320</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>MacDonald</surname><given-names>N.J.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>Rapid identification of
high-confidence taxonomic assignments for metagenomic data</article-title>.
<source>Nucleic Acids Res.</source>, <volume>40</volume>,
<fpage>e111</fpage>.<pub-id pub-id-type="pmid">22532608</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B18">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Marin</surname><given-names>J.M.</given-names></name><etal/></person-group> (<year>2005</year>) <article-title>Bayesian modelling and inference on
mixtures of distributions</article-title>. In: <person-group person-group-type="editor"><name><surname>Rao</surname><given-names>C.</given-names></name><name><surname>Dey</surname><given-names>D.</given-names></name></person-group> (eds) <source>Handbook of Statistics</source>. <volume>Vol.
25</volume>
<publisher-name>Elsevier-Science</publisher-name>, pp.
<fpage>223</fpage>–<lpage>228</lpage>.</mixed-citation>
    </ref>
    <ref id="btv317-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McHardy</surname><given-names>A.C.</given-names></name><etal/></person-group> (<year>2007</year>) <article-title>Accurate phylogenetic classification
of variable-length DNA fragments</article-title>. <source>Nat. Methods</source>,
<volume>4</volume>, <fpage>63</fpage>–<lpage>72</lpage>.<pub-id pub-id-type="pmid">17179938</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McMullan</surname><given-names>L.K.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>A new phlebovirus associated with
severe febrile illness in Missouri</article-title>. <source>N. Engl. J. Med.</source>,
<volume>367</volume>, <fpage>834</fpage>–<lpage>841</lpage>.<pub-id pub-id-type="pmid">22931317</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Minot</surname><given-names>S.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>The human gut virome: inter-individual
variation and dynamic response to diet</article-title>. <source>Genome Res.</source>,
<volume>21</volume>, <fpage>1616</fpage>–<lpage>1625</lpage>.<pub-id pub-id-type="pmid">21880779</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mizuno</surname><given-names>C.M.</given-names></name><etal/></person-group> (<year>2013</year>) <article-title>Expanding the marine virosphere using
metagenomics</article-title>. <source>PLoS Genet.</source>, <volume>9</volume>,
<fpage>e1003987</fpage>.<pub-id pub-id-type="pmid">24348267</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Negredo</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Discovery of an ebolavirus-like
filovirus in europe</article-title>. <source>PLoS Pathogens</source>,
<volume>7</volume>, <fpage>e1002304</fpage>.<pub-id pub-id-type="pmid">22039362</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qin</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2010</year>) <article-title>A human gut microbial gene catalogue
established by metagenomic sequencing</article-title>. <source>Nature</source>,
<volume>464</volume>, <fpage>59</fpage>–<lpage>65</lpage>.<pub-id pub-id-type="pmid">20203603</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quail</surname><given-names>M.A.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>A tale of three next generation
sequencing platforms: comparison of Ion Torrent, Pacific Biosciences and Illumina MiSeq
sequencers</article-title>. <source>BMC Genomics</source>, <volume>13</volume>,
<fpage>341</fpage>.<pub-id pub-id-type="pmid">22827831</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salter</surname><given-names>S.J.</given-names></name><etal/></person-group> (<year>2014</year>) <article-title>Reagent and laboratory contamination
can critically impact sequence-based microbiome analyses</article-title>. <source>BMC
Biol.</source>, <volume>12</volume>, <fpage>87</fpage>.<pub-id pub-id-type="pmid">25387460</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmieder</surname><given-names>R.</given-names></name><name><surname>Edwards</surname><given-names>R.</given-names></name></person-group> (<year>2011</year>) <article-title>Quality control and preprocessing of
metagenomic datasets</article-title>. <source>Bioinformatics</source>,
<volume>27</volume>, <fpage>863</fpage>–<lpage>864</lpage>.<pub-id pub-id-type="pmid">21278185</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Willner</surname><given-names>D.</given-names></name><etal/></person-group> (<year>2009</year>) <article-title>Metagenomic analysis of respiratory
tract DNA viral communities in cystic fibrosis and non-cystic fibrosis
individuals</article-title>. <source>PLoS One</source>, <volume>4</volume>,
<fpage>e7370</fpage>.<pub-id pub-id-type="pmid">19816605</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xia</surname><given-names>L.C.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Accurate genome relative abundance
estimation based on shotgun metagenomic reads</article-title>. <source>PLoS
One</source>, <volume>6</volume>, <fpage>e27992</fpage>.<pub-id pub-id-type="pmid">22162995</pub-id></mixed-citation>
    </ref>
    <ref id="btv317-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zerbino</surname><given-names>D.R.</given-names></name><name><surname>Birney</surname><given-names>E.</given-names></name></person-group> (<year>2008</year>) <article-title>Velvet: algorithms for de novo short
read assembly using de Bruijn graphs</article-title>. <source>Genome Res.</source>,
<volume>18</volume>, <fpage>821</fpage>–<lpage>829</lpage>.<pub-id pub-id-type="pmid">18349386</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
