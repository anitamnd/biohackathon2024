<?DTDIdentifier.IdentifierValue article.dtd?>
<?DTDIdentifier.IdentifierType system?>
<?SourceDTD.DTDName article.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName bmc2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1465-6906</issn>
    <issn pub-type="epub">1465-6914</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3188795</article-id>
    <article-id pub-id-type="publisher-id">gb-2011-12-2-r13</article-id>
    <article-id pub-id-type="pmid">21310039</article-id>
    <article-id pub-id-type="doi">10.1186/gb-2011-12-2-r13</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Haplotype and isoform specific expression estimation using multi-mapping RNA-seq reads</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" id="A1">
        <name>
          <surname>Turro</surname>
          <given-names>Ernest</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>ernest.turro@ic.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" id="A2">
        <name>
          <surname>Su</surname>
          <given-names>Shu-Yi</given-names>
        </name>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>shuyisu@gallo.ucsf.edu</email>
      </contrib>
      <contrib contrib-type="author" id="A3">
        <name>
          <surname>Gonçalves</surname>
          <given-names>Ângela</given-names>
        </name>
        <xref ref-type="aff" rid="I3">3</xref>
        <email>angela.goncalves@ebi.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" id="A4">
        <name>
          <surname>Coin</surname>
          <given-names>Lachlan JM</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>l.coin@imperial.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" id="A5">
        <name>
          <surname>Richardson</surname>
          <given-names>Sylvia</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>sylvia.richardson@imperial.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" id="A6">
        <name>
          <surname>Lewin</surname>
          <given-names>Alex</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>a.m.lewin@ic.ac.uk</email>
      </contrib>
    </contrib-group>
    <aff id="I1"><label>1</label>Department of Epidemiology and Biostatistics, Imperial College London, Norfolk Place, London, W2 1PG, UK</aff>
    <aff id="I2"><label>2</label>Ernest Gallo Clinic and Research Center, Department of Bioinformatics, University of California, San Francisco, 5858 Horton Street, Suite 200, Emeryville, CA 94608, USA</aff>
    <aff id="I3"><label>3</label>European Bioinformatics Institute (EMBL-EBI), Wellcome Trust Genome Campus, Hinxton, Cambridge CB10 1SD, UK</aff>
    <pub-date pub-type="ppub">
      <year>2011</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>10</day>
      <month>2</month>
      <year>2011</year>
    </pub-date>
    <volume>12</volume>
    <issue>2</issue>
    <fpage>R13</fpage>
    <lpage>R13</lpage>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>9</month>
        <year>2010</year>
      </date>
      <date date-type="rev-recd">
        <day>17</day>
        <month>11</month>
        <year>2010</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>2</month>
        <year>2011</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright ©2011 Turro et al.; licensee BioMed Central Ltd.</copyright-statement>
      <copyright-year>2011</copyright-year>
      <copyright-holder>Turro et al.; licensee BioMed Central Ltd.</copyright-holder>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="http://genomebiology.com/2011/12/2/R13"/>
    <abstract>
      <p>We present a novel pipeline and methodology for simultaneously estimating isoform expression and allelic imbalance in diploid organisms using RNA-seq data. We achieve this by modeling the expression of haplotype-specific isoforms. If unknown, the two parental isoform sequences can be individually reconstructed. A new statistical method, MMSEQ, deconvolves the mapping of reads to multiple transcripts (isoforms or haplotype-specific isoforms). Our software can take into account non-uniform read generation and works with paired-end reads.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec>
    <title>Background</title>
    <p>High-throughput sequencing of RNA, known as RNA-seq, is a promising new approach to transcriptome profiling. RNA-seq has a greater dynamic range than microarrays, which suffer from non-specific hybridization and saturation biases. Transcriptional subsequences spanning multiple exons can be directly observed, allowing more precise estimation of the expression levels of splice variants. Moreover, unlike traditional expression arrays, RNA-seq produces sequence information that can be used for genotyping and phasing of haplotypes, thus permitting inferences to be made about the expression of each of the two parental haplotypes of a transcript in a diploid organism.</p>
    <p>The first step in RNA-seq experiments is the preparation of cDNA libraries, whereby RNA is isolated, fragmented and synthesized to cDNA. Sequencing of one or both ends of the fragments then takes place to produce millions of short reads and an associated base call uncertainty measure for each position in each read. The reads are then aligned, usually allowing for sequencing errors and polymorphisms, to a set of reference chromosomes or transcripts. The alignments of the reads are the fundamental data used to study biological phenomena such as isoform expression levels and allelic imbalance. Methods have recently been developed to estimate these two quantities separately but no approaches exist to make inferences about them simultaneously to estimate expression at the haplotype <italic>and </italic>isoform ('haplo-isoform') level. In diploid organisms, this level of analysis can contribute to our understanding of <italic>cis </italic>vs. <italic>trans </italic>regulation [<xref ref-type="bibr" rid="B1">1</xref>] and epigenetic effects such as genomic imprinting [<xref ref-type="bibr" rid="B2">2</xref>]. We first set out the problems of isoform level expression, allelic mapping biases and allelic imbalance, and then propose a pipeline and statistical model to deal with them.</p>
    <sec>
      <title>Isoform level expression</title>
      <p>Multiple isoforms of the same gene and multiple genes within paralogos gene families often exhibit exonic sequence similarity or identity. Therefore, given the short length of reads relative to isoforms, many reads map to multiple transcripts (Table <xref ref-type="table" rid="T1">1</xref>). Discarding multi-mapping reads leads to a significant loss of information as well as a systematic underestimation of expression estimates. For reads that map to multiple locations, one solution is to distribute the multi-mapping reads according to the coverage ratios at each location using only single-mapping reads [<xref ref-type="bibr" rid="B3">3</xref>]. However, this does not address the problem of inferring expression levels at the isoform level.</p>
      <table-wrap id="T1" position="float">
        <label>Table 1</label>
        <caption>
          <p>Multi-mapping reads. Approximate proportion of reads mapping to multiple Ensembl transcripts or genes in human using 37 bp single-end or paired-end data obtained from HapMap individuals.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th/>
              <th align="center">37 bp single-end</th>
              <th align="center">37 bp paired-end</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">Multiple transcripts</td>
              <td align="center">78%</td>
              <td align="center">73%</td>
            </tr>
            <tr>
              <td align="left">Multiple genes</td>
              <td align="center">20%</td>
              <td align="center">10%</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>Essentially, the estimation of isoform level expression can be done by constructing a matrix of indicator functions <italic>M<sub>it </sub></italic>= 1 if region <italic>i </italic>belongs to transcript <italic>t</italic>. The 'regions' may for now be thought of as exons or part exons, though we later define them more generally. Using this construction it is natural to define a model:</p>
      <p>
        <disp-formula id="bmcM1">
          <label>(1)</label>
          <mml:math id="M1" name="gb-2011-12-2-r13-i1" overflow="scroll">
            <mml:mrow>
              <mml:msub>
                <mml:mi>X</mml:mi>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>∼</mml:mo>
              <mml:mi/>
              <mml:mi>P</mml:mi>
              <mml:mi>o</mml:mi>
              <mml:mi>i</mml:mi>
              <mml:mi>s</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>b</mml:mi>
              <mml:msub>
                <mml:mi>s</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:msub>
                <mml:mi>M</mml:mi>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>,</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>where <italic>X<sub>it </sub></italic>are the (unobserved) counts of reads from region <italic>i </italic>of transcript <italic>t</italic>, <italic>b </italic>is a normalization constant used when comparing experiments, <italic>μ<sub>t </sub></italic>is a parameter representing the expression of transcript <italic>t </italic>and <italic>s<sub>i </sub></italic>is the <italic>effective </italic>length of region <italic>i </italic>(that is the number of possible start positions for reads in the region). This model can be fit using an expectation maximization (EM) algorithm, since the <italic>X<sub>it </sub></italic>are unobserved but their sums across transcripts <inline-formula><mml:math id="M2" name="gb-2011-12-2-r13-i2" overflow="scroll"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>≡</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> are observed.</p>
      <p>This model has been used by [<xref ref-type="bibr" rid="B4">4</xref>] in their POEM software, with <italic>i </italic>representing exons. Their method does not use reads that span multiple exons or reads that map to multiple genes. The same model has been used in [<xref ref-type="bibr" rid="B5">5</xref>], with <italic>i </italic>representing exons or part exons, or regions spanning exon junctions, enabling good estimation of isoform expression within genes. They do not, however, include reads mapping to multiple genes. The RSEM method [<xref ref-type="bibr" rid="B6">6</xref>] employs a similar model, but models the probability of each read individually, rather than read counts. This method allows reads to come from multiple genes as well as multiple isoforms of the same gene. The modeling of individual reads allows RSEM to accommodate general position-specific biases in the generation of reads. However, two recent papers [<xref ref-type="bibr" rid="B7">7</xref>,<xref ref-type="bibr" rid="B8">8</xref>] have shown that deviations from uniformity in the generation of reads are in great part sequence rather than position-dependent for a given experimental protocol and sequencing platform. Furthermore, the computational requirements of modeling individual reads increasing proportionately with read depth, which, in the case of RSEM, is exacerbated further by the use of computationally intensive bootstrapping procedures to estimate standard errors. None of the above methods are compatible with paired-end data. A recently published method, Cufflinks [<xref ref-type="bibr" rid="B9">9</xref>], focuses on transcript assembly as well as expression estimation using an extension of the [<xref ref-type="bibr" rid="B5">5</xref>] model that is compatible with paired-end data. However, this method does not model sequence-specific uniformity biases and uses a fixed down-weighting scheme to account for reads mapping to more than one transcription locus, meaning that the abundances of transcripts in different regions are estimated independently.</p>
    </sec>
    <sec>
      <title>Allelic imbalance</title>
      <p>Studies of imbalances between the expression of two parental haplotypes have mostly been restricted to testing the null hypothesis of equal expression between two alleles at a single heterozygous base, typically with a binomial test [<xref ref-type="bibr" rid="B1">1</xref>,<xref ref-type="bibr" rid="B2">2</xref>,<xref ref-type="bibr" rid="B10">10</xref>]. However, as transcripts may contain multiple heterozygotes, a more powerful approach is to assess the presence of a consistent imbalance across all the heterozygotes in a gene together. This has been done on a case-by-case basis using read pairs that overlap two heterozygous SNPs [<xref ref-type="bibr" rid="B11">11</xref>] while [<xref ref-type="bibr" rid="B12">12</xref>] propose an extension to the binomial test for detecting allelic imbalance that takes into account all SNPs and their positions in a gene. However, this approach, which is a statistical test rather than a method of quantifying haplotype-specific expression, assumes imbalances to be homogeneous along genes and thus does not take into account the possibility of asymmetric imbalances between isoforms of the same gene.</p>
    </sec>
    <sec>
      <title>Allelic mapping biases</title>
      <p>Aligners usually have a maximum tolerance threshold for mismatches between reads and the reference. Reads containing non-reference alleles are less likely to align than reads matching the reference exactly, so genes with a high frequency of non-reference alleles may be underestimated. Ideally, aligners would accept ambiguity codes for alleles that segregate in the species (cf. Novoalign [<xref ref-type="bibr" rid="B13">13</xref>]), but no free software is currently able to do this. A possible workaround is to change the nucleotide at each SNP to an allele that does not segregate in the species, as has been proposed to remove biases when estimating allelic imbalance [<xref ref-type="bibr" rid="B10">10</xref>]. However, in the context of gene expression analysis, this leads to even greater underestimation of genes with many non-reference alleles and an increase in incorrect alignments to homologous regions. Instead, we propose aligning to a sample-specific transcriptome reference, constructed from (potentially phased) genotype calls.</p>
    </sec>
    <sec>
      <title>MMSEQ</title>
      <p>In this paper we present a new pipeline, including a novel statistical method called MMSEQ, for estimating haplotype, isoform and gene specific expression. The MMSEQ software is straightforward to use, fully documented and freely available online [<xref ref-type="bibr" rid="B14">14</xref>] and as part of ArrayExpressHTS [<xref ref-type="bibr" rid="B15">15</xref>]. Our pipeline exploits all reads that can be mapped to at least one annotated transcript sequence and reduces the number of alignments missed due to the presence of non-reference alleles. It is compatible with paired-end data and makes use of inferred insert size information to choose the best alignments. Our method permits estimating the expression of the two versions of each heterozygote-containing isoform ('haplo-isoform') individually and thus it can detect asymmetric imbalances between isoforms of the same gene. Our software further takes into account sequence-specific deviations from uniform sampling of reads using the model described in [<xref ref-type="bibr" rid="B8">8</xref>] but can flexibly accommodate other models. We validate our method at the isoform level with a simulation study, comparing our results to RSEM's, and applying it to a published Illumina dataset consisting of lymphoblastoid cell lines from 61 HapMap individuals [<xref ref-type="bibr" rid="B16">16</xref>]. We validate our method at the haplo-isoform level by showing we can deconvolve the expression estimates of haplo-isoforms on the non-pseudoautosomal (non-PAR) region of the X chromosome using a pooled dataset of two HapMap males. We further apply our method to a published dataset of F<sub>1 </sub>initial and reciprocal crosses of CAST/EiJ (CAST) and C57BL/6J (C57) inbred mice [<xref ref-type="bibr" rid="B2">2</xref>] and demonstrate that MMSEQ is able to detect parental imbalance between the two haplotypes of each isoform.</p>
    </sec>
  </sec>
  <sec>
    <title>Results</title>
    <sec>
      <title>Overview of the pipeline</title>
      <p>The pipeline can be depicted as a flow chart with two different start positions (Figure <xref ref-type="fig" rid="F1">1</xref>):</p>
      <fig id="F1" position="float">
        <label>Figure 1</label>
        <caption>
          <p><bold>Pipeline flow chart</bold>. Flow chart depicting the steps in the pipeline and two main use cases. <bold>(a) </bold>expression estimation using a pre-defined transcriptome reference; <bold>(b) </bold>construction of a custom transcriptome reference from the data followed by expression estimation. Haplotype-specific expression can be obtained using a pre-defined transcript reference if the parental transcriptome sequences are known and recombination has no effect (for example in the case of an F<sub>1 </sub>cross of two inbred strains). If the standard (for example Ensembl) reference is used, then isoform-level estimates are produced. If a custom reference is constructed solely to avoid allelic mapping biases, the phasing of genotypes can be omitted and isoform-level estimates are produced. If the genotypes are phased, haplo-isoform estimation is performed.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-1"/>
      </fig>
      <p>(a) Expression estimation using alignments to a pre-defined transcriptome reference,</p>
      <p>(b) Expression estimation using alignments to a transcriptome reference that is obtained from the RNA-seq data.</p>
      <p>In case (a), the level of estimation (haplo-isoform or isoform) depends on whether the reference includes two copies of heterozygous transcripts. In case (b), it depends on whether the genotypes are phased. The most exhaustive use of the pipeline proceeds as follows. First, the reads are aligned to the standard genome reference using TopHat [<xref ref-type="bibr" rid="B17">17</xref>]. Then, genotypes are called with SAMtools pileup [<xref ref-type="bibr" rid="B18">18</xref>]. Genotypes are then phased with polyHap [<xref ref-type="bibr" rid="B19">19</xref>] using population genotype data to produce a pair of haplotypes for all gene regions on the genome. The standard transcriptome reference is then edited for each individual to match the inferred haplotypes. The reads are realigned to the individualized haplotype specific transcriptome reference with Bowtie [<xref ref-type="bibr" rid="B20">20</xref>], finding alignments for reads that originally failed to align due to having too many mismatches with the standard reference (approximately 0:3% more reads recovered, with some transcripts receiving up to 13% more hits, in the HapMap dataset [<xref ref-type="bibr" rid="B16">16</xref>]). Finally, our new method, MMSEQ, is used to disaggregate the expression level of each haplo-isoform.</p>
    </sec>
    <sec>
      <title>MMSEQ</title>
      <sec>
        <title>Poisson model</title>
        <p>We use the model in Equation 1 as a starting point for modeling gene isoforms and extend it to apply to haplo-isoforms. First, we employ a more general definition of 'region': each read maps to one set of transcripts, which may belong to the same gene or to various different genes, and which can have two versions, one containing the paternal and the other the maternal haplotype. These sets are labeled by <italic>i</italic>. Many reads will map to the exact same set, hence we can model reads counts (<italic>k<sub>i</sub></italic>) for the set. The <italic>M<sub>it </sub></italic>are defined very straightforwardly as the indicator functions for transcript <italic>t </italic>belonging to set <italic>i</italic>. The region length <italic>s<sub>i </sub></italic>is the effective length of the sequence shared between the whole set. If the set of transcripts all belong to the same gene and haplotype, then <italic>s<sub>i </sub></italic>may be the effective length of an exon or part exon. However, aligned reads often map to multiple genes equally well (Table <xref ref-type="table" rid="T1">1</xref>) so the region need not correspond to an actual region on the genome. Using our definition of a region, the <italic>s<sub>i </sub></italic>would be difficult to calculate given the sheer number of overlaps and regions, but in fact the <italic>s<sub>i </sub></italic>are not needed in the calculation of the model (see Materials and Methods). Hence we have a model for read counts in which the data and fixed quantities (<italic>k<sub>i </sub></italic>and <italic>M<sub>it</sub></italic>) are calculated in a straightforward way, and which allows for reads mapping to multiple isoforms of the same or different genes in exons or exon junctions and to paternal and maternal haplotypes separately.</p>
        <p>Without loss of generality, Figure <xref ref-type="fig" rid="F2">2a</xref> illustrates our formulation for a gene with an alternatively spliced cassette exon and Figure <xref ref-type="fig" rid="F2">2b</xref> illustrates it for a gene with a single heterozygous base. The heterozygote casts a 'shadow' upstream of length equal to the read length, which acts like an alternative middle exon. This is because reads with starting positions within the shadow cover the heterozygote and contain one of the two alleles, thus mapping to only one of the two haplotypes.</p>
        <fig id="F2" position="float">
          <label>Figure 2</label>
          <caption>
            <p><bold>MMSEQ data structures to represent read mappings to alternative isoforms and alternative haplotypes</bold>. <bold>(a) </bold>Schematic of a gene with an alternatively spliced cassette exon. Each read is labeled according to the transcripts it maps to and placed along its alignment position. Reads that map to both transcripts, <italic>t</italic><sub>1 </sub>and <italic>t</italic><sub>2</sub>, are shown in red, reads that map only to <italic>t</italic><sub>1 </sub>are shown in blue and the read that maps only to <italic>t</italic><sub>2 </sub>is shown in green. Reads that align with their start positions in the regions labeled by <italic>d</italic><sub>1 </sub>and <italic>d</italic><sub>3 </sub>(in red) may have come from either transcript, reads with their start positions in <italic>d</italic><sub>2 </sub>(in blue) can only have come from transcript 1, and reads with their start positions in <italic>d</italic><sub>4 </sub>(in green) must be from transcript 2. Each row <italic>i </italic>of the indicator matrix <italic>M </italic>characterizes a unique set of transcripts that is mapped to by <italic>k<sub>i </sub></italic>reads. There are three transcript sets: {<italic>t</italic><sub>1</sub>, <italic>t</italic><sub>2</sub>} (red), {<italic>t</italic><sub>1</sub>} (blue) and {<italic>t</italic><sub>2</sub>} (green). Exon lengths are <italic>e</italic><sub>1</sub>, <italic>e</italic><sub>2</sub>, <italic>e</italic><sub>3</sub>. Hence <italic>s</italic><sub>1 </sub>= <italic>d</italic><sub>1 </sub>+ <italic>d</italic><sub>3</sub>, <italic>s</italic><sub>2 </sub>= <italic>d</italic><sub>2 </sub>and <italic>s</italic><sub>3 </sub>= <italic>d</italic><sub>4</sub>. The effective length of transcript <italic>t </italic>is equal to the sum over the elements of <bold>s </bold>that have a corresponding 1 in column <italic>t </italic>of <italic>M</italic>, that is ∑<italic><sub>i </sub></italic><italic>s<sub>i</sub>M<sub>it</sub></italic>. It can be seen from the figure that these lengths are the sums of the exons minus read length (ϵ) plus one, as expected. (<bold>b</bold>)Schematic of a single-exon gene with a heterozygote near the center. Reads with starting positions in region <italic>d</italic><sub>2 </sub>contain either the 'C' allele or the 'G' allele and thus map to either the haplo-isoform <italic>t</italic><sub>1<italic>A</italic></sub>, which has a 'C' or <italic>t</italic><sub>1<italic>B</italic></sub>, which has a 'G'. It is evident that the heterozygote acts like an alternative middle exon, and that the same model and data structures as in the alternative isoform schematic apply.</p>
          </caption>
          <graphic xlink:href="gb-2011-12-2-r13-2"/>
        </fig>
        <p>We now formulate a Poisson model for read counts from transcript sets:</p>
        <p>
          <disp-formula id="bmcM2">
            <label>(2)</label>
            <mml:math id="M3" name="gb-2011-12-2-r13-i3" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>k</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:mo>∼</mml:mo>
                <mml:mi/>
                <mml:mi>P</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>i</mml:mi>
                <mml:mi>s</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>b</mml:mi>
                    <mml:msub>
                      <mml:mi>s</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mstyle displaystyle="true">
                      <mml:munder>
                        <mml:mo>∑</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:munder>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>M</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                    </mml:mstyle>
                    <mml:msub>
                      <mml:mi>μ</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>,</mml:mo>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>where <italic>b </italic>is a normalization constant, ∑<italic><sub>t </sub>M<sub>it</sub>μ<sub>t </sub></italic>is the total expression from the transcript set <italic>i </italic>and <italic>s<sub>i </sub></italic>is the effective length of the region of shared sequence between transcripts in set <italic>i</italic>. Figure <xref ref-type="fig" rid="F2">2a</xref> shows how the <italic>s<sub>i </sub></italic>can be calculated for the gene with a cassette exon. Note that the sum of lengths of all the regions shared by transcript <italic>t </italic>add up to its effective length (transcript length minus read length plus one for uniformly generated reads): ∑<italic><sub>i </sub>s<sub>i</sub>M<sub>it </sub></italic>= <italic>l<sub>t</sub></italic>, so the transcript-set model is consistent with the usual Poisson model. Setting <italic>l<sub>t </sub></italic>to the transcript length minus read length plus one is appropriate if a constant Poisson rate is assumed along all positions in a transcript: <inline-formula><mml:math id="M4" name="gb-2011-12-2-r13-i4" overflow="scroll"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>P</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi>P</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msub><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic>r<sub>t </sub></italic>is the number of reads originating from transcript <italic>t </italic>and the sum is over all possible starting read positions <italic>p</italic>. The non-uniformity of read generation demonstrated in [<xref ref-type="bibr" rid="B8">8</xref>], however, suggests a variable-rate Poisson model:</p>
        <p>
          <disp-formula id="bmcM3">
            <label>(3)</label>
            <mml:math id="M5" name="gb-2011-12-2-r13-i5" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>r</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:msub>
                <mml:mo>∼</mml:mo>
                <mml:mi>P</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>i</mml:mi>
                <mml:mi>s</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>b</mml:mi>
                    <mml:mstyle displaystyle="true">
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>p</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>l</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:munderover>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>α</mml:mi>
                          <mml:mrow>
                            <mml:mi>t</mml:mi>
                            <mml:mi>p</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mi>t</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                    </mml:mstyle>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>∼</mml:mo>
                <mml:mi>P</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>i</mml:mi>
                <mml:mi>s</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>b</mml:mi>
                    <mml:msub>
                      <mml:mover accent="true">
                        <mml:mi>l</mml:mi>
                        <mml:mo>˜</mml:mo>
                      </mml:mover>
                      <mml:mi>t</mml:mi>
                    </mml:msub>
                    <mml:msub>
                      <mml:mi>μ</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>,</mml:mo>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>where <inline-formula><mml:math id="M6" name="gb-2011-12-2-r13-i6" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>l</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is an adjusted effective length, referred to as the sum of sequence preferences (SSP) in [<xref ref-type="bibr" rid="B8">8</xref>]. We use their Poisson regression model to adjust the length of each transcript based on its sequence, but other adjustment procedures may be used instead. Briefly, the logarithm of the sequencing preference of each possible start position in a transcript is calculated as the sum of an intercept term plus a set of coefficients determined by the sequence immediately upstream and downstream of the start position. It would also be possible to integrate the method described in [<xref ref-type="bibr" rid="B7">7</xref>], which uses a weighting for reads based on the first seven nucleotides of their sequences, by applying this weighting in our calculation of <italic>k<sub>i</sub></italic>. However, this approach does not incorporate the effects of the sequence composition on the reference upstream of the read start positions or further downstream than seven bases, and we thus prefer to use the [<xref ref-type="bibr" rid="B8">8</xref>] method instead. The normalization constant <italic>b </italic>is used to make lanes with different read depths comparable. We set <italic>b </italic>to the total number of reads (in millions) and measure transcript lengths in kilobases, which means the scale of the expression parameter <italic>μ<sub>t </sub></italic>is equivalent to RPKM (reads per kilobase per million mapped reads) described in [<xref ref-type="bibr" rid="B3">3</xref>]. In downstream analysis, a more robust measure can be used, such as the library size parameter suggested by [<xref ref-type="bibr" rid="B21">21</xref>].</p>
        <p>The only unknown parameters in the model are the <italic>μ<sub>t</sub></italic>. The observed data are the <italic>k<sub>i </sub></italic>and the matrix <italic>M </italic>and effective transcript lengths <italic>l<sub>t </sub></italic>are known. In principle the effective lengths of the transcript sets <italic>s<sub>i </sub></italic>can be calculated, but in fact, they are not needed (see Materials and Methods).</p>
      </sec>
      <sec>
        <title>Inference</title>
        <p>The maximum likelihood (ML) estimate of <italic>μ<sub>t </sub></italic>cannot be obtained analytically, so instead we use an expectation maximization (EM) algorithm to compute it, an approach also taken by [<xref ref-type="bibr" rid="B4">4</xref>,<xref ref-type="bibr" rid="B6">6</xref>] for isoforms. After convergence of the algorithm, we output the estimates of <italic>μ<sub>t </sub></italic>and refer to them as MMSEQ EM estimates.</p>
        <p>The usual approach to estimating statistical standard errors of ML estimators requires inversion of the observed information matrix. When analyzing the expression of thousands of transcripts, the high dimensionality of the observed information matrix and the possibility of identical columns due to gene homology make this approach impracticable. Bootstrapping may also be used to estimate errors, as in [<xref ref-type="bibr" rid="B6">6</xref>], but it is a computationally intensive method requiring repeated runs of the EM algorithm. Instead we use a simple Bayesian model with a vague prior on <italic>μ<sub>t</sub></italic>. As before, we use the augmented data reads per region and transcript, <italic>X<sub>it</sub></italic>. The full model is:</p>
        <p>
          <disp-formula id="bmcM4">
            <label>(4)</label>
            <mml:math id="M7" name="gb-2011-12-2-r13-i7" overflow="scroll">
              <mml:mrow>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>X</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mo stretchy="false">|</mml:mo>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>μ</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:msub>
                    <mml:mtext> </mml:mtext>
                    <mml:mo>∼</mml:mo>
                    <mml:mi>P</mml:mi>
                    <mml:mi>o</mml:mi>
                    <mml:mi>i</mml:mi>
                    <mml:mi>s</mml:mi>
                    <mml:mo stretchy="false">(</mml:mo>
                    <mml:mi>b</mml:mi>
                    <mml:msub>
                      <mml:mi>s</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:msub>
                      <mml:mi>M</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:msub>
                      <mml:mi>μ</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:msub>
                    <mml:mo stretchy="false">)</mml:mo>
                    <mml:mo>,</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>
          <disp-formula id="bmcM5">
            <label>(5)</label>
            <mml:math id="M8" name="gb-2011-12-2-r13-i8" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>μ</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:msub>
                <mml:mo>∼</mml:mo>
                <mml:mi>G</mml:mi>
                <mml:mi>a</mml:mi>
                <mml:mi>m</mml:mi>
                <mml:mo stretchy="false">(</mml:mo>
                <mml:mi>α</mml:mi>
                <mml:mo>,</mml:mo>
                <mml:mi>β</mml:mi>
                <mml:mo stretchy="false">)</mml:mo>
                <mml:mo>.</mml:mo>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>Again, the only lengths needed are the <italic>l<sub>t</sub></italic>. The conjugacy of the Poisson-Gamma model makes the sampling fast and straightforward as the full conditionals are in closed form (see Materials and Methods). We use the final EM estimate of the <italic>μ<sub>t </sub></italic>as the initial values for the Gibbs sampling. We then produce samples from the whole posterior distributions of the <italic>μ<sub>t </sub></italic>and calculate the sample means and their respective Monte Carlo standard errors (MCSE), which take into account the autocorrelations of the samples [<xref ref-type="bibr" rid="B22">22</xref>]. We set the hyperprior parameters to <italic>α </italic>= 1.2 and <italic>β </italic>= 0.001, producing a vague prior on the <italic>μ<sub>t </sub></italic>that captures the well-known broad and skewed distribution of gene expression values. We output the means of the Gibbs samples of <italic>μ<sub>t</sub></italic>, which we refer to as MMSEQ GS estimates. As we shall show, the regularization afforded by the Bayesian algorithm produces estimates with a lower error than the MMSEQ EM estimates. Moreover, it can readily be shown that for transcript with low coverage, the ML estimate is often zero, even though this is likely to be an underestimate of the expression. For example, suppose there exist two equally-expressed haplo-isoforms differing by only one heterozygote. Under the assumption of uniform sampling of 0.01 reads per nucleotide for both haplo-isoforms, if the read length is 35, then the probability of observing a read containing one allele but no reads containing the other allele is fairly high (2(1-<italic>e</italic><sup>-0.35</sup>)<italic>e</italic><sup>-0.35 </sup>≃ 0.42). The ML estimate of the haplo-isoform with the unsampled allele under this scenario is zero while the ML estimate of the haplo-isoform with the sampled allele is overestimated. With Gibbs sampling, on the other hand, this effect is tempered by the Gamma prior. The MMSEQ GS estimates are thus our preferred expression measures.</p>
      </sec>
      <sec>
        <title>Best mismatch stratum filter</title>
        <p>While a read may align to multiple transcripts, not all alignments may be equally reliable. We therefore filter out all alignments that do not have the minimal number of mismatches for a given read or read pair (similar to the <monospace>--strata </monospace>switch in Bowtie, but compatible with paired as well as single end data). In the case of paired-end data, the number of mismatches from both ends is added up to determine the 'mismatch stratum' of a read pair. This filter is crucial in order to correctly discriminate between the two versions of an isoform at a heterozygous position, since reads from one haplotype also match the alternative haplotype with an additional mismatch. The stratum filter thus ensures that reads are properly assigned to the correct haplotype.</p>
      </sec>
      <sec>
        <title>Insert size filter for paired-end data</title>
        <p>For paired-end data, both reads in a pair must align to a transcript for the mapping to be considered. If the fragments are sufficiently large, the alignments may span three exons and align to transcripts that both retain and skip the middle exon. However, the alignment with an inferred fragment size (also called insert size) that is nearer to the expected insert size from the fragmentation protocol, is more likely to be correct. We exploit this information by applying an insert size filter to alignments in the best mismatch stratum for each read. If an alignment's insert size is nearer than <italic>x </italic>bp (for example equivalent to one standard deviation) away from the expected insert size, then all other alignments for that read with an insert size greater than <italic>x </italic>bp away from the expected insert size are removed. This filter can be thought of as an extension of mismatch-based filtering for reporting only alignments with moderately high probability of being true. Although full probabilistic modeling is more principled, filtering is a commonplace approach to reducing alignment candidates for each read to a set that can be dealt with pragmatically. For the HapMap dataset, mistakes in the protocol resulted in two distributions of insert sizes within some samples, so we omitted this filter.</p>
      </sec>
      <sec>
        <title>MMSEQ output</title>
        <p>The <italic>mmseq </italic>program produces three files each containing EM and GS expression estimates with associated MCSEs. The first file provides estimates at the transcript/haplo-isoform level, the second file provides aggregate estimates for sets of transcripts that have been amalgamated due to having identical sequences (and therefore indistinguishable expression levels), and the third file aggregates transcript estimates into genes, thus providing gene-level estimates. Homozygous transcripts are aggregated together, whereas heterozygous transcripts are aggregated separately to produce 'haplo-gene' level estimates. With respect to transcripts that have identical sequences and hence indistinguishable and unidentifiable expression levels, the posterior samples exhibit high variance and strong anti-correlation but the sum of their expression can be precisely estimated (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>). We therefore recommend use of the amalgamated estimates.</p>
      </sec>
    </sec>
    <sec>
      <title>Performance and scalability</title>
      <p>The performance of the EM and Gibbs algorithms is determined principally by the size of the <italic>M </italic>matrix, which is bounded by the total number of known transcripts and the total number of combinations of transcripts that share sequence. Marginal increases in the total number of observed reads do not result in commensurate increases in the size of <italic>M</italic>, because additional reads tend to map to transcript sets that have been mapped to by previous reads (Table <xref ref-type="table" rid="T2">2</xref>). Consequently, the <italic>mmseq </italic>program exhibits economies of scale which allow it to cope with future increases in throughput. This contrasts with the RSEM method, which represents each read separately in their indicator matrix that maps reads to isoforms [<xref ref-type="bibr" rid="B6">6</xref>].</p>
      <table-wrap id="T2" position="float">
        <label>Table 2</label>
        <caption>
          <p><italic>mmseq </italic>performance. Performance of the <italic>mmseq </italic>program on subsets of different sizes of the HapMap paired-end dataset. </p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="center">Read pairs (millions)</th>
              <th align="center">Dimension of <italic>M</italic></th>
              <th align="center">Runtime (seconds)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center">1</td>
              <td align="center">63,924 × 68,666</td>
              <td align="center">507</td>
            </tr>
            <tr>
              <td align="center">2</td>
              <td align="center">84,417 × 75,649</td>
              <td align="center">541</td>
            </tr>
            <tr>
              <td align="center">3</td>
              <td align="center">97,576 × 79,035</td>
              <td align="center">746</td>
            </tr>
            <tr>
              <td align="center">4</td>
              <td align="center">107,344 × 81,289</td>
              <td align="center">793</td>
            </tr>
            <tr>
              <td align="center">8</td>
              <td align="center">134,489 × 86,528</td>
              <td align="center">1,047</td>
            </tr>
            <tr>
              <td align="center">16</td>
              <td align="center">166,100 × 91,023</td>
              <td align="center">1,204</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <p>Where necessary in order to obtain a large enough dataset, reads from multiple lanes of the same individual were pooled. The program exhibits economies of scale because the dimension of <italic>M </italic>increases more slowly than the number of reads.</p>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>Correction for non-uniform read sampling</title>
      <p>We have assessed the effect of applying the Poisson regression [<xref ref-type="bibr" rid="B8">8</xref>] correction for non-uniform sampling using read data from three Illumina Genome Analyzer II (GAII) lanes from the HapMap dataset [<xref ref-type="bibr" rid="B16">16</xref>] (described below). Two of the samples were from the same run (ID 3125) and a third from a separate run (ID 3122). We obtained Poisson regression coefficients for 20 bases upstream and downstream of each possible start position using the first 10 million alignments for each lane. The regression model was fitted using only the most highly expressed transcripts, as these have the best signal-to-noise ratio [<xref ref-type="bibr" rid="B8">8</xref>]. Specifically, from the 500 transcripts with the highest average number of nucleotides per position, we selected a subset containing only one transcript per gene so as to avoid double-counting of sequence preferences. As shown in Additional file <xref ref-type="supplementary-material" rid="S2">2</xref>, the coefficients are highly stable across both lanes and runs. The time-consuming task of calculating adjusted transcript lengths separately for each lane is therefore unnecessary. Instead, our software can reuse the adjusted transcript lengths calculated from one sample when analyzing other samples. Variations in the Poisson rate from base to base tend to average out over the length of each transcript, and thus the adjustments to the lengths are generally slight (Additional file <xref ref-type="supplementary-material" rid="S3">3</xref>). As expected from the Poisson model (Equation 3), changes in the expression estimates (estimates of <italic>μ<sub>t</sub></italic>) tend to be inversely proportional to adjustments to the lengths. Nevertheless, as transcripts sharing reads may be adjusted in opposite directions, for some transcripts even a small change in the length has a significant impact on the expression estimate (Figure <xref ref-type="fig" rid="F3">3</xref>).</p>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>Impact on expression of transcript lengths adjustment</bold>. Smooth scatterplot of the log fold change in transcript length after adjusting for non-uniform read generation vs. the log fold change in expression. The hundred transcripts in the lowest density regions are shown as black dots. Changes in the expression estimates tend to be inversely proportional to adjustments to the lengths but for some transcripts even a small change in the length has a significant impact on the expression estimate.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-3"/>
      </fig>
    </sec>
    <sec>
      <title>Simulation study of isoform expression estimation</title>
      <p>We simulated reads from human and mouse Ensembl cDNA files under the assumption of uniform sampling of reads and ran the MMSEQ workflow. We found good correlation between simulated and estimated expression values and between dispersion around the true values and estimated MCSEs. We did however observe a small upward bias in our estimates of transcripts with low expression levels, attributable to our use of the mean to summarize highly skewed distributions. We evaluated our gene-level estimates by summing over the isoform components within each gene. As anticipated, we obtained more precise estimates for genes than for transcripts (Figure <xref ref-type="fig" rid="F4">4</xref>).</p>
      <fig id="F4" position="float">
        <label>Figure 4</label>
        <caption>
          <p><bold>Isoform-level simulation scatterplots</bold>. Scatterplots comparing log-scale simulated vs. estimated RPKM expression values for human and mouse at the transcript and gene levels. Estimates with MCSE greater than the median are shown in black, lower than the median but higher than the bottom 10% are shown in dark grey and lower than the bottom 10% are shown in light grey.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-4"/>
      </fig>
      <p>We also observed better estimates for mouse, which has 45,452 annotated transcripts, than for human, which has higher splicing complexity manifested in 122,636 annotated transcripts (Figure <xref ref-type="fig" rid="F5">5</xref>). Transcripts may be connected to other transcripts via reads that align to regions shared by isoforms of the same gene or to different genes with sequence homology. The complexity of the graph that connects transcripts with each other reflects the ambiguity in the assignment of reads to transcripts and thus the errors in our estimates. A bar plot of the number of transcripts that each transcript is connected to in human and mouse demonstrates a significant difference in complexity between the annotated transcriptomes of the two species (Additional file <xref ref-type="supplementary-material" rid="S4">4</xref>).</p>
      <fig id="F5" position="float">
        <label>Figure 5</label>
        <caption>
          <p><bold>Scatterplots comparing RSEM with MMSEQ</bold>. Scatterplots comparing simulated vs. estimated normalized expression values from RSEM, MMSEQ EM and MMSEQ GS for a simulated human dataset. The second RSEM plot from the left is a blown up version of the plot on the far left so that the y-axis covers the same range as the MMSEQ plots on the right.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-5"/>
      </fig>
    </sec>
    <sec>
      <title>Comparison of isoform expression estimation between MMSEQ and RSEM</title>
      <p>Like MMSEQ, the RSEM method [<xref ref-type="bibr" rid="B6">6</xref>] makes use of all classes of reads to estimate isoform expression. The authors have shown an improvement of their method for gene-level estimation over strategies that discard multiply aligned reads or allocate them to mapped transcripts according to the coverage by single-mapping reads (as in [<xref ref-type="bibr" rid="B3">3</xref>]). However, isoform-level results for their method have not been assessed. We obtained RSEM estimates for Ensembl transcripts using our simulated human sequence dataset for the purposes of comparison.</p>
      <p>We scaled our simulated and estimated expression values to add up to one in order to make them comparable to RSEM's fractional expression estimates. We found that RSEM and MMSEQ EM are comparable but, unlike the MMSEQ EM algorithm, RSEM tended to overestimate some medium-expression transcripts. Both the RSEM and MMSEQ EM algorithms tended to underestimate some low-expression transcripts, pushing them very close to zero and thus producing very large errors on the log scale. This was avoided by the regularization of the Gibbs algorithm, which produced tighter estimates and only overestimated slightly some very lowly expressed transcripts (Figure <xref ref-type="fig" rid="F5">5</xref> and Additional file <xref ref-type="supplementary-material" rid="S5">5</xref>), showing the benefits of using the whole posterior distribution of <italic>μ<sub>t </sub></italic>to estimate expression rather than a maximization strategy.</p>
    </sec>
    <sec>
      <title>Isoform-level application to the HapMap dataset</title>
      <p>The HapMap paired-end Illumina GAII dataset [<xref ref-type="bibr" rid="B16">16</xref>] consists of 73 lanes: 7 lanes for the same Yoruban individual, another 7 lanes for the same CEU individual and the remaining 59 lanes each for different CEU individuals. The authors assessed exon-count correlations between the lanes. Here we look at transcript and gene-level correlations. We analyzed the data using the MMSEQ pipeline, aligning approximately 75% of reads to Ensembl human reference transcripts. The average rank correlation was 0.92 and 0.84 respectively at the gene and transcript level (Figure <xref ref-type="fig" rid="F6">6</xref>). When comparing identical samples at the gene level the rank correlation ranged from 0.96 to 0.97 for the Yoruban individual and from 0.92 to 0.97 for the CEU individual. At the transcript level, the ranges were 0.91 to 0.92 and 0.90 to 0.91 for the Yoruban and CEU individuals respectively. The transcript-level values are comparable to exon-count correlations found by [<xref ref-type="bibr" rid="B16">16</xref>]. Both are lower than the gene-level correlation, as might be expected due to the inclusion of within-gene variance.</p>
      <fig id="F6" position="float">
        <label>Figure 6</label>
        <caption>
          <p><bold>Rank correlation box plots in the HapMap dataset</bold>. Boxplots of pairwise Spearman's rank correlation between expression values in the HapMap dataset. The first and second sets of seven boxplots correspond to technical replicates while the remaining boxplots correspond to different CEU individuals.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-6"/>
      </fig>
      <p>Although the ordering of transcripts and genes was broadly maintained even between lanes belonging to different individuals and runs, we found a striking contrast in the distribution of expression values between lanes of the same individual and lanes of different individuals (Additional file <xref ref-type="supplementary-material" rid="S6">6</xref>). The consistency of expression values for lanes of the same individual indicates that the technical replicability of the Illumina GAII sequencer is extremely high and therefore that the variation observed between lanes from different individuals is mostly a reflection of biological variability. This is in line with previous research showing that sequence count data follow a negative binomial distribution in biological replicates and a Poisson distribution in technical replicates [<xref ref-type="bibr" rid="B21">21</xref>]. As such, we expect the variance of our estimates to be proportional and greater than proportional to the expression values for technical and biological replicates respectively. This is indeed borne out both at the gene and transcript level (Additional file <xref ref-type="supplementary-material" rid="S7">7</xref>) and corroborates the need to take into account extra variability for highly-expressed transcripts in differential expression analysis with biological replication (see Discussion).</p>
    </sec>
    <sec>
      <title>Validation of haplo-isoform deconvolution</title>
      <p>The non-pseudoautosomal region (non-PAR) of the X chromosome in human males is haploid, and thus the alleles in that region can be called directly without the need for phasing. We validated our method for deconvolving expression between two haplotypes of the same isoform as follows. We used the RNA-seq data of two males from the HapMap data (NA12045 and NA12872) to call their haplotypes. We identified 117 isoforms on the non-PAR of the X chromosome that differed between the two individuals. We created custom transcriptome references for each of the two males, containing their individual versions of the 117 isoforms. We then created a third hybrid reference containing two copies of the 117 isoforms, one matching the haplotype of one male and the second matching the haplotype of the other. This hybrid reference mimics the case of a female with two X chromosomes with unknown expression of the two parental copies of each isoform. We obtained individual expression estimates of the 117 isoforms using the separate transcriptome references in each male and compared them with estimates obtained by aligning a dataset pooled from the data of both males to the hybrid reference. Although the original correlation between the two males was 0.85, the correlation between the individual estimates and the deconvolved estimates was 0.96 and 0.98, showing MMSEQ is capable of disaggregating the expression from paternal and maternal isoforms (Additional file <xref ref-type="supplementary-material" rid="S8">8</xref>).</p>
      <p>To test whether MMSEQ is able to recover greater imbalances than found naturally between the two male individuals, we divided the genes of the 117 isoforms that are heterozygous in the hybrid reference into three equal-sized groups. For one group, we artificially removed 90% of the reads hitting one male and, for another group, we artificially removed 90% of the reads hitting the other male. This reduction of reads mimics what would be observed if more extreme imbalances existed. We thus reduced the correlation between the log expression of the two males from 0.85 to 0.48. Despite this large imbalance, there was a correlation of 0.91 and 0.95 between the individual and the deconvolved estimates obtained from the pooled dataset (Figure <xref ref-type="fig" rid="F7">7</xref>), showing that MMSEQ is able to accurately disaggregate haplotype-specific expression in the presence of large imbalances.</p>
      <fig id="F7" position="float">
        <label>Figure 7</label>
        <caption>
          <p><bold>Scatterplots of log expression estimates from individual and pooled data with read removal</bold>. Left: scatterplot of log expression estimates of male NA12045 vs. NA12872 obtained from individual datasets where reads were removed from subsets of genes to decrease the correlation between the two individuals. Center: scatterplot of log expression estimates of male NA12045 obtained from the individual vs. pooled data. Right: scatterplot of log expression estimates of male NA12872 obtained from the individual vs. pooled data.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-7"/>
      </fig>
    </sec>
    <sec>
      <title>Demonstration of haplo-isoform expression estimation using an F<sub>1 </sub>hybrid mouse brain dataset</title>
      <p>We have applied MMSEQ to a published murine embryonic day 15 RNA-seq dataset of CAST/C57 initial (F<sub>1</sub>i) and reciprocal (F<sub>1</sub>r) crosses [<xref ref-type="bibr" rid="B2">2</xref>]. Each RNA sample was a pool from four individuals. The C57 reference transcriptome used by the authors is available from the UCSC Genome Browser [<xref ref-type="bibr" rid="B23">23</xref>]. The authors called SNPs by aligning reads from the CAST samples to the C57 reference. We created a CAST reference transcriptome by changing alleles in the C57 reference sequences according to those SNP calls. The two references were combined in a hybrid reference containing two entries for isoforms that differed in sequence between C57 and CAST. Thus there is a one-to-one mapping between SNPs called in the parents and heterozygotes in the hybrids. The data consist of 152 and 159 million 36 bp Illumina GAII reads for F<sub>1</sub>i and F<sub>1</sub>r respectively.</p>
      <p>A scatterplot of the CAST/C57 differential expression between F<sub>1</sub>i and F<sub>1</sub>r crosses reveal a clear clustering of points into three groups (Figure <xref ref-type="fig" rid="F8">8</xref>). Firstly, the points on the upper-left to lower-right diagonal correspond to transcripts which show imbalance towards the parent of origin, suggesting they are imprinted. Those on the upper-left quadrant and bottom-right quadrant correspond to maternally and paternally imprinted transcripts respectively. Transcripts termed 'consensus imprinted' by [<xref ref-type="bibr" rid="B2">2</xref>] are highlighted in color. These were defined arbitrarily by the authors as transcripts with more than two heterozygotes exhibiting imbalance in favor of the same parental sex, at least one of which was significant in a <italic>χ</italic><sup>2 </sup>goodness-of- fit test with a <italic>P-value </italic>threshold of 0.05.</p>
      <fig id="F8" position="float">
        <label>Figure 8</label>
        <caption>
          <p><bold>Reciprocal vs. initial cross, highlighting 'consensus' imbalanced isoforms and X transcripts</bold>. Scatterplot of log fold changes between haplo-isoforms in the reciprocal (F<sub>1</sub>r) and the initial (F<sub>1</sub>i) cross, highlighting X transcripts in blue, isoforms termed 'consensus' maternally imprinted in red and 'consensus' paternally imprinted in green. 'Consensus' imprinted genes were chosen by [<xref ref-type="bibr" rid="B2">2</xref>] as those with more than two heterozygotes exhibiting imbalance in favor of the same parental sex, at least one of which was significant in a <italic>χ</italic><sup>2 </sup>goodness-of-fit test with a <italic>P-value </italic>threshold of 0.05.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-8"/>
      </fig>
      <p>We also identified a clustering of transcripts that exhibited CAST overexpression in the F<sub>1</sub>i hybrids but approximately balanced expression in the F<sub>1</sub>r's. We identified the cluster as consisting wholly of transcripts on the X chromosome (Additional file <xref ref-type="supplementary-material" rid="S9">9</xref>), which suggests that the initial crosses were male and the reciprocal crosses female. The sexes of the hybrid mice are in fact unknown. There was a slight skew in favor of the CAST strand in the reciprocal crosses. We think it is unlikely that this was due to mapping biases, since the CAST reference was produced from SNP calls against the C57 reference and was thus of lower quality, so any mapping bias would be expected to be in favor of C57. Moreover, [<xref ref-type="bibr" rid="B24">24</xref>] found a similar skew in adult samples of the same crosses. It is possible that the skew is the result of a selective bias in favor of C57 X-inactivated cells [<xref ref-type="bibr" rid="B25">25</xref>], possibly caused by one or more of the three mutations on the X-inactivation transcript (UCSC ID uc009tzp.1) or mutations in its promoter region.</p>
      <p>The third grouping in the plot is on the lower-left to upper-right diagonal. These transcripts demonstrate consistent CAST/C57 differential expression regardless of the sex-strain combination of the parents, and are thus indicative of <italic>cis </italic>regulation.</p>
      <p>One advantage of MMSEQ is that imbalances are assessed at the transcript level rather than for individual SNPs. Thus it is not necessary to set arbitrary thresholds on the numbers of heterozygotes or the magnitude and significance of the imbalances to make claims about transcript-level imbalances. Indeed, some of the transcripts that contain one or more heterozygote with a significant <italic>P-value </italic>but were not classified as 'consensus imprinted' by [<xref ref-type="bibr" rid="B2">2</xref>] are clearly shown to be imprinted by our results. Note however that 27 transcripts had significant heterozygotes with imbalances in opposing directions, demonstrating that it is not always appropriate to generalize from a single locus to make claims of imbalance at the transcript level (Figure <xref ref-type="fig" rid="F8">8</xref> and Additional file <xref ref-type="supplementary-material" rid="S10">10</xref>).</p>
      <p>For genes containing heterozygotes with opposing imbalances, one approach is to scan the transcript annotations to identify isoform structures consistent with the observed SNP positions and imbalances. This approach was taken by [<xref ref-type="bibr" rid="B2">2</xref>], who defined these genes as 'complex' as long as at least one SNP was significant. An example of a complex gene is <italic>H13</italic>, which has two short isoforms and three longer isoforms with several additional exons towards the 3' end (Figure <xref ref-type="fig" rid="F9">9</xref>). The short isoforms contained heterozygotes with a paternal bias in their 3' exons while the heterozygotes on the 3' and intermediary exons of the longer isoforms had a maternal bias (cf. Figure S9 of [<xref ref-type="bibr" rid="B2">2</xref>] for a SNP-by-SNP visualization of the results of their preoptic area F<sub>1 </sub>samples). Using MMSEQ, we were able to discern this effect by direct quantification of haplo-isoforms. The two short isoforms were clearly imbalanced towards the paternally inherited haplotype while two of the long isoforms were clearly imbalanced towards the maternally inherited haplotype. An additional gene within the boundaries of <italic>H13</italic>, <italic>Mcts2</italic>, was also found to be paternally overexpressed (Table <xref ref-type="table" rid="T3">3</xref>). By exploiting the data and annotation simultaneously, MMSEQ can be used to detect opposing imbalances between isoforms of the same gene directly.</p>
      <fig id="F9" position="float">
        <label>Figure 9</label>
        <caption>
          <p><bold>Isoform structures of <italic>H13 </italic>and <italic>Mcts2</italic></bold>. Labeled graphical depiction of <italic>H13 </italic>and <italic>Mcts2 </italic>UCSC isoform structures.</p>
        </caption>
        <graphic xlink:href="gb-2011-12-2-r13-9"/>
      </fig>
      <table-wrap id="T3" position="float">
        <label>Table 3</label>
        <caption>
          <p>MMSEQ estimates for <italic>H13 </italic>and <italic>Mcts2 </italic>isoforms in F<sub>1 </sub>hybrid samples. MMSEQ estimates for each haplotype and isoform of <italic>H13 </italic>and <italic>Mcts2 </italic>of the initial and reciprocal crosses are shown. </p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th/>
              <th align="center" colspan="2">Mother</th>
              <th align="center" colspan="2">Father</th>
            </tr>
            <tr>
              <th/>
              <th align="center">CAST<italic><sub>i</sub></italic></th>
              <th align="center">C57<italic><sub>r</sub></italic></th>
              <th align="center">C57<italic><sub>i</sub></italic></th>
              <th align="center">CAST<italic><sub>r</sub></italic></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">uc008nfz.1</td>
              <td align="center">1.26</td>
              <td align="center">1.63</td>
              <td align="center">9.61</td>
              <td align="center">9.17</td>
            </tr>
            <tr>
              <td align="left">uc008nga.1</td>
              <td align="center">1.29</td>
              <td align="center">3.58</td>
              <td align="center">7.68</td>
              <td align="center">7.51</td>
            </tr>
            <tr>
              <td align="left">uc008ngb.1</td>
              <td align="center">12.97</td>
              <td align="center">9.81</td>
              <td align="center">0.94</td>
              <td align="center">0.39</td>
            </tr>
            <tr>
              <td align="left">uc008ngc.1</td>
              <td align="center">13.63</td>
              <td align="center">10.51</td>
              <td align="center">1.10</td>
              <td align="center">1.08</td>
            </tr>
            <tr>
              <td align="left">uc008ngd.1</td>
              <td align="center">0.22</td>
              <td align="center">0.18</td>
              <td align="center">0.30</td>
              <td align="center">0.13</td>
            </tr>
            <tr>
              <td align="left">uc008nge.1</td>
              <td align="center">2.01</td>
              <td align="center">4.20</td>
              <td align="center">11.29</td>
              <td align="center">14.66</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <p>The two short isoforms of <italic>H13 </italic>(uc008nfz.1 and uc008nga.1) were found to be paternally imprinted, while the longer isoforms uc008ngb.1 and uc008ngc.1 were found to be maternally imprinted. The long isoform uc008ngd.1 was estimated to be close to absent. The short <italic>Mcts2 </italic>gene (uc008nge.1), located within the boundaries of <italic>H13</italic>, was found to be paternally overexpressed.</p>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>Discussion</title>
    <p>We have presented a pipeline and statistical method that can disaggregate expression between isoforms and even between the two haplotypes of each isoform within an individual. MMSEQ produces improved isoform estimates compared to RSEM for medium to low expression transcripts, is more scalable, and estimates standard errors more efficiently. Furthermore, our principled approach to haplo-isoform quantification obviates the need for ad-hoc interpretations of SNP-by-SNP imbalances in terms of transcripts. Two aspects of our method, however, deserve further discussion.</p>
    <sec>
      <title>Transcript discovery</title>
      <p>MMSEQ aims to quantify the abundance of known transcripts, and as such relies on the comprehensiveness of the transcriptome's annotation. It is usually possible to align a very large proportion of the reads to Ensembl transcripts (approximately 75% in the HapMap study using Ensembl version 56). However, samples may contain previously unobserved genes or isoforms. MMSEQ can in such cases work in tandem with transcript discovery methods by adding newly predicted isoform sequences to the reference transcript FASTA file and using it in the alignment and mapping steps of the MMSEQ workflow.</p>
    </sec>
    <sec>
      <title>Modeling biological variability</title>
      <p>The Poisson distribution captures technical variability arising in repeated sequencing experiments with the same biological sample. The true expression value is, in effect, fixed by the experiment, and the only source of variability arises from measurement error and mapping uncertainty. However, between biological replicates such as different individuals in the HapMap study, there is, additionally, variability of a biological origin. As has been previously reported, this results in expression values between replicates that show overdispersion, captured, for example, by a negative binomial distribution [<xref ref-type="bibr" rid="B21">21</xref>].</p>
      <p>Here we have focused on the problem of estimating the posterior distribution of expression values independently per sample. Nevertheless, it would be possible to add a further level to our Bayesian model to capture overdispersion across samples flexibly. For example, if exchangeable Gamma priors are set on the <italic>μ<sub>t</sub></italic>, a suitable negative binomial model can be induced.</p>
    </sec>
    <sec>
      <title>Phasing with paired-end data</title>
      <p>In this work, we have phased genotype calls obtained from SAMtools pileups - an approach that works well with both single and paired-end data. However, in the case of paired-end data, the haplotypes observed directly at multiple SNPs spanned by overlapping read pairs could be used to increase confidence in the phasing calls. Although incorporating this information would benefit phasing estimates only for some sets of SNPs, we believe it is a worthwhile area of future research. As phasing is a distinct step in our pipeline, improved methodologies can be integrated flexibly as they become available.</p>
    </sec>
  </sec>
  <sec>
    <title>Conclusions</title>
    <p>RNA-seq is a promising and rapidly developing technology that provides sequence and expression intensity information of a sample in a single experiment. We have presented a novel pipeline and fast, scalable methodology to estimate expression of diploid organisms at the haplotype, isoform and gene levels. This allows researchers to go beyond allele-specific expression analysis and assess imbalance between paternal and maternal copies of isoforms, which in turn may be compared to differential isoform expression between individuals. We have shown that our method is able to deconvolve the expression of transcripts on each of two X chromosomes from human males in a pooled dataset, and that it can be successfully applied to detect genomic imprinting and <italic>cis</italic>-regulated transcripts in mouse hybrids. Our method retains reads that emanate from junctions as well as wholly within exons, models alignments to multiple transcripts, potentially across genes, exploits insert size information in paired-end data to choose the best alignments and flexibly incorporates corrective models for non-uniform read sampling. The pipeline, the MMSEQ software and related documentation are freely available online [<xref ref-type="bibr" rid="B14">14</xref>].</p>
  </sec>
  <sec sec-type="materials|methods">
    <title>Materials and methods</title>
    <sec>
      <title>Expectation maximization</title>
      <p>We augment the data with the reads per region and transcript, <italic>X<sub>it</sub></italic>, where Σ<italic><sub>t </sub>X<sub>it </sub></italic>= <italic>k<sub>i </sub></italic>and use the Poisson approximation for the augmented data likelihood:</p>
      <p>
        <disp-formula id="bmcM6">
          <label>(6)</label>
          <mml:math id="M9" name="gb-2011-12-2-r13-i9" overflow="scroll">
            <mml:mrow>
              <mml:msub>
                <mml:mi>X</mml:mi>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>∼</mml:mo>
              <mml:mi>P</mml:mi>
              <mml:mi>o</mml:mi>
              <mml:mi>i</mml:mi>
              <mml:mi>s</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>b</mml:mi>
              <mml:msub>
                <mml:mi>s</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:msub>
                <mml:mi>M</mml:mi>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>The distribution of the augmented data conditional on the observed data and the parameters is multinomial:</p>
      <p>
        <disp-formula id="bmcM7">
          <label>(7)</label>
          <mml:math id="M10" name="gb-2011-12-2-r13-i10" overflow="scroll">
            <mml:mrow>
              <mml:mrow>
                <mml:mrow>
                  <mml:mo>{</mml:mo>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>,</mml:mo>
                  <mml:mn>...</mml:mn>
                  <mml:mo>,</mml:mo>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mi>n</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>}</mml:mo>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mn>1</mml:mn>
              </mml:msub>
              <mml:mo>,</mml:mo>
              <mml:mn>...</mml:mn>
              <mml:mo>,</mml:mo>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo>}</mml:mo>
              <mml:mo>,</mml:mo>
              <mml:msub>
                <mml:mi>k</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo>~</mml:mo>
              <mml:mi>M</mml:mi>
              <mml:mi>u</mml:mi>
              <mml:mi>l</mml:mi>
              <mml:mi>t</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>k</mml:mi>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                  <mml:mo>,</mml:mo>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:msub>
                        <mml:mi>μ</mml:mi>
                        <mml:mn>1</mml:mn>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mstyle displaystyle="true">
                        <mml:msub>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>t</mml:mi>
                        </mml:msub>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>M</mml:mi>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>t</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mstyle>
                    </mml:mrow>
                  </mml:mfrac>
                  <mml:mo>,</mml:mo>
                  <mml:mn>...</mml:mn>
                  <mml:mo>,</mml:mo>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>n</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:msub>
                        <mml:mi>μ</mml:mi>
                        <mml:mi>n</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mstyle displaystyle="true">
                        <mml:msub>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>t</mml:mi>
                        </mml:msub>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>M</mml:mi>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>t</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mstyle>
                    </mml:mrow>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="bmcM8">
          <label>(8)</label>
          <mml:math id="M11" name="gb-2011-12-2-r13-i11" overflow="scroll">
            <mml:mrow>
              <mml:mo>⇒</mml:mo>
              <mml:mi mathvariant="double-struck">E</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:msub>
                <mml:mi>k</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>,</mml:mo>
              <mml:msubsup>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
                <mml:mrow>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>p</mml:mi>
                  <mml:mo stretchy="false">)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>k</mml:mi>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                  <mml:msub>
                    <mml:mi>M</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:msubsup>
                    <mml:mi>μ</mml:mi>
                    <mml:mi>t</mml:mi>
                    <mml:mrow>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mrow>
                  <mml:mstyle displaystyle="true">
                    <mml:msub>
                      <mml:mo>∑</mml:mo>
                      <mml:msup>
                        <mml:mi>t</mml:mi>
                        <mml:mo>′</mml:mo>
                      </mml:msup>
                    </mml:msub>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:msup>
                            <mml:mi>t</mml:mi>
                            <mml:mo>′</mml:mo>
                          </mml:msup>
                        </mml:mrow>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mstyle>
                  <mml:msubsup>
                    <mml:mi>μ</mml:mi>
                    <mml:msup>
                      <mml:mi>t</mml:mi>
                      <mml:mo>′</mml:mo>
                    </mml:msup>
                    <mml:mrow>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                </mml:mrow>
              </mml:mfrac>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>The derivative of the expected Poisson log likelihood over <italic>X </italic>given <italic>k </italic>and <italic>μ</italic><sup>(<italic>p</italic>) </sup>with respect to <italic>μ<sub>t </sub></italic>is linear in X, and hence</p>
      <p>
        <disp-formula id="bmcM9">
          <label>(9)</label>
          <mml:math id="M12" name="gb-2011-12-2-r13-i12" overflow="scroll">
            <mml:mrow>
              <mml:mi>a</mml:mi>
              <mml:mi>r</mml:mi>
              <mml:mi>g</mml:mi>
              <mml:mi/>
              <mml:mi>m</mml:mi>
              <mml:mi>a</mml:mi>
              <mml:mi>x</mml:mi>
              <mml:mi/>
              <mml:msub>
                <mml:mi mathvariant="double-struck">E</mml:mi>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi>X</mml:mi>
                    <mml:mo stretchy="false">|</mml:mo>
                  </mml:mrow>
                  <mml:mi>k</mml:mi>
                  <mml:mo>,</mml:mo>
                  <mml:msup>
                    <mml:mi>μ</mml:mi>
                    <mml:mrow>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:msup>
                </mml:mrow>
              </mml:msub>
              <mml:mi>log</mml:mi>
              <mml:mi>L</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>μ</mml:mi>
              <mml:mo>;</mml:mo>
              <mml:mi>X</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>b</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>M</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>s</mml:mi>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>=</mml:mo>
              <mml:mi>arg</mml:mi>
              <mml:mi>max</mml:mi>
              <mml:mi>log</mml:mi>
              <mml:mi>L</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>μ</mml:mi>
              <mml:mo>;</mml:mo>
              <mml:mi mathvariant="double-struck">E</mml:mi>
              <mml:mrow>
                <mml:mrow>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>X</mml:mi>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:mi>k</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:msup>
                <mml:mi>μ</mml:mi>
                <mml:mrow>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>p</mml:mi>
                  <mml:mo stretchy="false">)</mml:mo>
                </mml:mrow>
              </mml:msup>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>,</mml:mo>
              <mml:mi>b</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>M</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>s</mml:mi>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>The EM algorithm can be thus be expressed as repeatedly updating the <inline-formula><mml:math id="M13" name="gb-2011-12-2-r13-i13" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> at each iteration <italic>p </italic>using a form of the Poisson ML estimator in which the <italic>X<sub>it </sub></italic>have been substituted with <inline-formula><mml:math id="M14" name="gb-2011-12-2-r13-i14" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>:</p>
      <p>
        <disp-formula id="bmcM10">
          <label>(10)</label>
          <mml:math id="M15" name="gb-2011-12-2-r13-i15" overflow="scroll">
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
                <mml:mrow>
                  <mml:mo stretchy="false">(</mml:mo>
                  <mml:mi>p</mml:mi>
                  <mml:mo>+</mml:mo>
                  <mml:mn>1</mml:mn>
                  <mml:mo stretchy="false">)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>←</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mstyle displaystyle="true">
                    <mml:msub>
                      <mml:mo>∑</mml:mo>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>X</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>t</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo stretchy="false">(</mml:mo>
                          <mml:mi>p</mml:mi>
                          <mml:mo stretchy="false">)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                    </mml:mrow>
                  </mml:mstyle>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>b</mml:mi>
                  <mml:msub>
                    <mml:mi>l</mml:mi>
                    <mml:mi>t</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mfrac>
              <mml:mo>,</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="bmcM11">
          <label>(11)</label>
          <mml:math id="M16" name="gb-2011-12-2-r13-i16" overflow="scroll">
            <mml:mrow>
              <mml:mtext>where</mml:mtext>
              <mml:mtext> </mml:mtext>
              <mml:mfrac>
                <mml:mrow>
                  <mml:mstyle displaystyle="true">
                    <mml:msub>
                      <mml:mo>∑</mml:mo>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>X</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>t</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo stretchy="false">(</mml:mo>
                          <mml:mi>p</mml:mi>
                          <mml:mo stretchy="false">)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                    </mml:mrow>
                  </mml:mstyle>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>b</mml:mi>
                  <mml:msub>
                    <mml:mi>l</mml:mi>
                    <mml:mi>t</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mfrac>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mi>μ</mml:mi>
                    <mml:mi>t</mml:mi>
                    <mml:mrow>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>b</mml:mi>
                  <mml:msub>
                    <mml:mi>l</mml:mi>
                    <mml:mi>t</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mfrac>
              <mml:mstyle displaystyle="true">
                <mml:munder>
                  <mml:mo>∑</mml:mo>
                  <mml:mi>i</mml:mi>
                </mml:munder>
                <mml:mrow>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>k</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>t</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mstyle displaystyle="true">
                        <mml:msub>
                          <mml:mo>∑</mml:mo>
                          <mml:msup>
                            <mml:mi>t</mml:mi>
                            <mml:mo>′</mml:mo>
                          </mml:msup>
                        </mml:msub>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>M</mml:mi>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:msup>
                                <mml:mi>t</mml:mi>
                                <mml:mo>′</mml:mo>
                              </mml:msup>
                            </mml:mrow>
                          </mml:msub>
                          <mml:msubsup>
                            <mml:mi>μ</mml:mi>
                            <mml:msup>
                              <mml:mi>t</mml:mi>
                              <mml:mo>′</mml:mo>
                            </mml:msup>
                            <mml:mrow>
                              <mml:mo stretchy="false">(</mml:mo>
                              <mml:mi>p</mml:mi>
                              <mml:mo stretchy="false">)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                        </mml:mrow>
                      </mml:mstyle>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:mfrac>
                  <mml:mo>,</mml:mo>
                </mml:mrow>
              </mml:mstyle>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>which converges to the ML estimate of <italic>μ<sub>t</sub></italic>. To initialize the algorithm, we set <italic>μ</italic><sup>(0) </sup>equal to <inline-formula><mml:math id="M17" name="gb-2011-12-2-r13-i17" overflow="scroll"><mml:mrow><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>b</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mstyle><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>Σ</mml:mi><mml:msup><mml:mi>t</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msup><mml:mi>t</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula>, which is equivalent to distributing <italic>k<sub>i </sub></italic>evenly between cells of <italic>X<sub>i </sub></italic>where <italic>M<sub>it </sub></italic>is one. For a given region <italic>i</italic>, the probability of reads being allocated to a given transcript depends only on the <italic>μ<sub>t </sub></italic>and not on <italic>s<sub>i </sub></italic>(as the region is the same length on all transcripts). Hence, the <italic>s<sub>i </sub></italic>do not appear in the update steps.</p>
    </sec>
    <sec>
      <title>Bayesian model and Gibbs sampling</title>
      <p>As before, we use the augmented data reads per region and transcript, <italic>X<sub>it</sub></italic>. The full model is:</p>
      <p>
        <disp-formula id="bmcM12">
          <label>(12)</label>
          <mml:math id="M18" name="gb-2011-12-2-r13-i18" overflow="scroll">
            <mml:mrow>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo>∼</mml:mo>
              <mml:mi>P</mml:mi>
              <mml:mi>o</mml:mi>
              <mml:mi>i</mml:mi>
              <mml:mi>s</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>b</mml:mi>
              <mml:msub>
                <mml:mi>s</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:msub>
                <mml:mi>M</mml:mi>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>,</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="bmcM13">
          <label>(13)</label>
          <mml:math id="M19" name="gb-2011-12-2-r13-i19" overflow="scroll">
            <mml:mrow>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo>∼</mml:mo>
              <mml:mi>G</mml:mi>
              <mml:mi>a</mml:mi>
              <mml:mi>m</mml:mi>
              <mml:mo stretchy="false">(</mml:mo>
              <mml:mi>α</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi>β</mml:mi>
              <mml:mo stretchy="false">)</mml:mo>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>The full conditionals are:</p>
      <p>
        <disp-formula id="bmcM14">
          <label>(14)</label>
          <mml:math id="M20" name="gb-2011-12-2-r13-i20" overflow="scroll">
            <mml:mrow>
              <mml:mrow>
                <mml:mrow>
                  <mml:mo>{</mml:mo>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>,</mml:mo>
                  <mml:mn>...</mml:mn>
                  <mml:mo>,</mml:mo>
                  <mml:msub>
                    <mml:mi>X</mml:mi>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>}</mml:mo>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mn>1</mml:mn>
              </mml:msub>
              <mml:mo>,</mml:mo>
              <mml:mn>...</mml:mn>
              <mml:mo>,</mml:mo>
              <mml:msub>
                <mml:mi>μ</mml:mi>
                <mml:mi>t</mml:mi>
              </mml:msub>
              <mml:mo>}</mml:mo>
              <mml:mo>,</mml:mo>
              <mml:msub>
                <mml:mi>k</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>~</mml:mo>
              <mml:mi>M</mml:mi>
              <mml:mi>u</mml:mi>
              <mml:mi>l</mml:mi>
              <mml:mi>t</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>k</mml:mi>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                  <mml:mo>,</mml:mo>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:msub>
                        <mml:mi>μ</mml:mi>
                        <mml:mn>1</mml:mn>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mstyle displaystyle="true">
                        <mml:msub>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>t</mml:mi>
                        </mml:msub>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>M</mml:mi>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>t</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mstyle>
                    </mml:mrow>
                  </mml:mfrac>
                  <mml:mo>,</mml:mo>
                  <mml:mn>...</mml:mn>
                  <mml:mo>,</mml:mo>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>M</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>n</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:msub>
                        <mml:mi>μ</mml:mi>
                        <mml:mi>n</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mstyle displaystyle="true">
                        <mml:msub>
                          <mml:mo>∑</mml:mo>
                          <mml:mi>t</mml:mi>
                        </mml:msub>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>M</mml:mi>
                            <mml:mrow>
                              <mml:mi>i</mml:mi>
                              <mml:mi>t</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mi>t</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mstyle>
                    </mml:mrow>
                  </mml:mfrac>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mo>,</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="bmcM15">
          <label>(15)</label>
          <mml:math id="M21" name="gb-2011-12-2-r13-i21" overflow="scroll">
            <mml:mrow>
              <mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>μ</mml:mi>
                    <mml:mi>t</mml:mi>
                  </mml:msub>
                </mml:mrow>
                <mml:mo stretchy="false">|</mml:mo>
              </mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:msub>
                <mml:mi>X</mml:mi>
                <mml:mrow>
                  <mml:mn>1</mml:mn>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>,</mml:mo>
              <mml:mn>...</mml:mn>
              <mml:msub>
                <mml:mi>X</mml:mi>
                <mml:mrow>
                  <mml:mi>m</mml:mi>
                  <mml:mi>t</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>}</mml:mo>
              <mml:mo>~</mml:mo>
              <mml:mi>G</mml:mi>
              <mml:mi>a</mml:mi>
              <mml:mi>m</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>α</mml:mi>
                  <mml:mo>+</mml:mo>
                  <mml:mstyle displaystyle="true">
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mi>i</mml:mi>
                    </mml:munder>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>X</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mi>t</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>,</mml:mo>
                      <mml:mi>β</mml:mi>
                      <mml:mo>+</mml:mo>
                      <mml:mi>b</mml:mi>
                      <mml:msub>
                        <mml:mi>l</mml:mi>
                        <mml:mi>t</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mstyle>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>Again, the <italic>s<sub>i </sub></italic>are not needed as they are absent from the full conditionals.</p>
    </sec>
    <sec>
      <title>TopHat settings</title>
      <p>Gapped alignment to the genome is performed with TopHat. We use a GFF file (specified with <monospace>-G</monospace>) based on the Ensembl annotation. We set <monospace>--no-novel-juncs</monospace>, <monospace>--min-isoform-fraction 0.0 </monospace>and <monospace>--min-anchor-length 3</monospace>. The expected inner distance between mate pairs is specified with the <monospace>-r </monospace>switch.</p>
    </sec>
    <sec>
      <title>SAMtools pileup settings</title>
      <p>Genotypes output by SAMtools pileup were filtered using samtools.pl varFilter with default options and setting a minimum Phred-scaled probability of the genotype being identical to the reference ('SNP quality') threshold of 20.</p>
    </sec>
    <sec>
      <title>Bowtie settings</title>
      <p>Alignment to the transcriptome with Bowtie is performed with the <monospace>-a --best </monospace>switches, which ensure all the best alignments in terms of mismatches are produced. Additionally, we recommend using <monospace>--strata </monospace>to output only alignments with the minimum number of mismatches, although it currently has no effect on paired-end data. The minimum and maximum insert sizes should be set appropriately with the <monospace>-I </monospace>and <monospace>-X </monospace>switches respectively, as should <monospace>--norc/--nofw </monospace>for stranded protocols.</p>
    </sec>
  </sec>
  <sec>
    <title>Abbreviations</title>
    <p>CEU: Utah residents with ancestry from northern and western Europe; EM: expectation maximization; GAII: Genome Analyzer II; GS: Gibbs sampling; Haplo-isoform: haplotype-specific isoform; MCSE: Monte Carlo standard errors; ML: maximum likelihood; PAR: pseudo-autosomal region; RPKM: reads per kilobase per million mapped reads; SNP: single nucleotide polymorphism; UCSC: University of California: Santa Cruz.</p>
  </sec>
  <sec>
    <title>Authors' contributions</title>
    <p>ET and AL developed the statistical model with the advice of SR and drafted the manuscript. ET implemented the MMSEQ software and ran validation experiments. SS and ET implemented the haplo-isoform pipeline and ran validation experiments. LC proposed and helped develop the EM algorithm and supervised the haplo-isoform validation experiment. AG proposed the application to mouse crosses and provided guidance on RNA-seq analysis. AG and ET applied the method to the mouse brain dataset. AL and SR supervised the project. AG, LC, SR and SS reviewed and revised the manuscript. All authors have read and approved the final manuscript.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="S1">
      <caption>
        <title>Additional file 1</title>
        <p><bold>Gibbs traces of identical transcripts</bold>. Gibbs traces for two transcripts that have identical sequences, ENST00000436491 and ENST00000415119, and their sums. The individual transcript estimates exhibit high variability and anti-correlation, but the total expression level of the two transcripts can be well estimated.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S1.PDF" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S2">
      <caption>
        <title>Additional file 2</title>
        <p><bold>Poisson regression coefficients for three lanes in the HapMap dataset</bold>. Plots of the Poisson regression coefficients obtained using the method described in [<xref ref-type="bibr" rid="B8">8</xref>] from three lanes in the HapMap dataset. The first two plots are for two lanes of the same Illumina GAII run (3125_2 and 3125_7), while the last plot is for a lane in a separate run (3122_7). The coefficients are highly stable across both lanes and runs.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S2.PDF" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S3">
      <caption>
        <title>Additional file 3</title>
        <p><bold>Plots of adjusted transcript lengths</bold>. Scatterplot of log10 true vs. adjusted transcript lengths (top) and histogram of the log10 fold change in transcript length after adjustment (bottom). The adjustments are in general very slight.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S3.PNG" mimetype="image" mime-subtype="png">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S4">
      <caption>
        <title>Additional file 4</title>
        <p><bold>Transcript connectivity bar plot</bold>. Bar plot of the number of transcripts that each transcript is connected to via shared reads for human and mouse.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S4.PDF" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S5">
      <caption>
        <title>Additional file 5</title>
        <p><bold>MMSEQ vs. RSEM scatterplots</bold>. Normalized simulated expression vs. log ratio between simulated and estimated normalized expression for RSEM (left) and MMSEQ GS (right) (note the difference in the scales of the y-axes). The RSEM estimates tend to underestimate some low-to-medium expression values and set them very close to zero, which translates to large negative log ratios. This also applies to MMSEQ EM estimates. The posterior means estimated using MMSEQ Gibbs sampling are less biased except for a slight upwards bias for very lowly expressed transcripts.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S5.PNG" mimetype="image" mime-subtype="png">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S6">
      <caption>
        <title>Additional file 6</title>
        <p><bold>Quantile-quantile plots between pairs of lanes of the same individual and between pairs of lanes of different individuals</bold>. Quantile-quantile plots of transcript expression estimates between pairs of lanes in the HapMap dataset. The lane IDs are shown along the diagonal. The bottom-left triangle shows pair-wise comparisons for a single individual sequenced in seven lanes of the same run. The upper-right triangle shows pair-wise comparisons between different individuals all sequenced in different lanes. There is a striking contrast in the consistency of the distribution of high values between pairs in the two triangles.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S6.PDF" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S7">
      <caption>
        <title>Additional file 7</title>
        <p><bold>Log-base mean-variance correlation between technical and biological replicates</bold>. Scatterplots of log mean expression values against the log of the variance across technical and biological replicates at the transcript and gene levels. Each scatterplot has a line with a gradient of one if it shows technical replicates and two if it shows biological replicates. The variance is approximately proportional to the mean for technical replicates and the square of the mean for biological replicates.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S7.PNG" mimetype="image" mime-subtype="png">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S8">
      <caption>
        <title>Additional file 8</title>
        <p><bold>Scatterplots of log expression estimates from individual and pooled data</bold>. Left: scatterplot of log expression estimates of male NA12045 vs. NA12872 obtained from individual datasets. Center: scatterplot of log expression estimates of male NA12045 obtained from the individual vs. pooled data. Right: scatterplot of log expression estimates of male NA12872 obtained from the individual vs. pooled data.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S8.PDF" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S9">
      <caption>
        <title>Additional file 9</title>
        <p><bold>Reciprocal vs. initial cross, omitting transcripts on the X chromosome</bold>. Scatterplot of log fold changes between haplo-isoforms in the reciprocal (F<sub>1</sub>r) and the initial (F<sub>1</sub>i) cross, omitting transcripts on the X chromosome.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S9.PNG" mimetype="image" mime-subtype="png">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S10">
      <caption>
        <title>Additional file 10</title>
        <p><bold>Reciprocal vs. initial cross, highlighting isoforms containing at least one significant SNP</bold>. Scatterplot of log fold changes between haplo-isoforms in the reciprocal (F<sub>1</sub>r) and the initial (F<sub>1</sub>i) cross, highlighting in green circles and red crosses isoforms containing at least one significant SNP imbalanced towards the paternal and maternal strain respectively. SNPs were called significant using a <italic>χ</italic><sup>2 </sup>goodness-of-fit test with a <italic>P</italic>-value threshold of 0.05 and are listed in [<xref ref-type="bibr" rid="B2">2</xref>]. Some transcripts contain significant SNPs with opposing imbalances, one example of which is clearly visible in the bottom-right quadrant.</p>
      </caption>
      <media xlink:href="gb-2011-12-2-r13-S10.PNG" mimetype="image" mime-subtype="png">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Acknowledgements</title>
    <p>This research was supported by BBSRC grant BBG0003521. We thank William Astle for constructive comments on the statistical model.</p>
  </sec>
  <ref-list>
    <ref id="B1">
      <mixed-citation publication-type="journal">
        <name>
          <surname>McManus</surname>
          <given-names>CJ</given-names>
        </name>
        <name>
          <surname>Coolon</surname>
          <given-names>JD</given-names>
        </name>
        <name>
          <surname>Duff</surname>
          <given-names>MO</given-names>
        </name>
        <name>
          <surname>Eipper-Mains</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Graveley</surname>
          <given-names>BR</given-names>
        </name>
        <name>
          <surname>Wittkopp</surname>
          <given-names>PJ</given-names>
        </name>
        <article-title>Regulatory divergence in Drosophila revealed by mRNA-seq.</article-title>
        <source>Genome Res</source>
        <year>2010</year>
        <volume>20</volume>
        <fpage>816</fpage>
        <lpage>825</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.102491.109</pub-id>
        <pub-id pub-id-type="pmid">20354124</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Gregg</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Weissbourd</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Luo</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Schroth</surname>
          <given-names>GP</given-names>
        </name>
        <name>
          <surname>Haig</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Dulac</surname>
          <given-names>C</given-names>
        </name>
        <article-title>High-resolution analysis of parent-of-origin allelic expression in the mouse brain.</article-title>
        <source>Science</source>
        <year>2010</year>
        <volume>329</volume>
        <fpage>643</fpage>
        <lpage>648</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1190830</pub-id>
        <pub-id pub-id-type="pmid">20616232</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Mortazavi</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Williams</surname>
          <given-names>BA</given-names>
        </name>
        <name>
          <surname>McCue</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Schaeffer</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Wold</surname>
          <given-names>B</given-names>
        </name>
        <article-title>Mapping and quantifying mammalian transcriptomes by RNA-Seq.</article-title>
        <source>Nat Methods</source>
        <year>2008</year>
        <volume>5</volume>
        <fpage>621</fpage>
        <lpage>628</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.1226</pub-id>
        <pub-id pub-id-type="pmid">18516045</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="other">
        <name>
          <surname>Richard</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Schulz</surname>
          <given-names>MH</given-names>
        </name>
        <name>
          <surname>Sultan</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Nürnberger</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Schrinner</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Balzereit</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Dagand</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Rasche</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Lehrach</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Vingron</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Haas</surname>
          <given-names>SA</given-names>
        </name>
        <name>
          <surname>Yaspo</surname>
          <given-names>ML</given-names>
        </name>
        <article-title>Prediction of alternative isoforms from exon expression levels in RNA-Seq experiments.</article-title>
        <source>Nucleic Acids Res</source>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20150413</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Jiang</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Wong</surname>
          <given-names>WH</given-names>
        </name>
        <article-title>Statistical inferences for isoform expression in RNA-Seq.</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1026</fpage>
        <lpage>1032</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp113</pub-id>
        <pub-id pub-id-type="pmid">19244387</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Ruotti</surname>
          <given-names>V</given-names>
        </name>
        <name>
          <surname>Stewart</surname>
          <given-names>RM</given-names>
        </name>
        <name>
          <surname>Thomson</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>Dewey</surname>
          <given-names>CN</given-names>
        </name>
        <article-title>RNA-Seq gene expression estimation with read mapping uncertainty.</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>493</fpage>
        <lpage>500</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp692</pub-id>
        <pub-id pub-id-type="pmid">20022975</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Hansen</surname>
          <given-names>KD</given-names>
        </name>
        <name>
          <surname>Brenner</surname>
          <given-names>SE</given-names>
        </name>
        <name>
          <surname>Dudoit</surname>
          <given-names>S</given-names>
        </name>
        <article-title>Biases in Illumina transcriptome sequencing caused by random hexamer priming.</article-title>
        <source>Nucleic Acids Res</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>e131</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkq224</pub-id>
        <pub-id pub-id-type="pmid">20395217</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Jiang</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Wong</surname>
          <given-names>WH</given-names>
        </name>
        <article-title>Modeling non-uniformity in short-read rates in RNA-Seq data.</article-title>
        <source>Genome Biol</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R50</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2010-11-5-r50</pub-id>
        <pub-id pub-id-type="pmid">20459815</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Trapnell</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Williams</surname>
          <given-names>BA</given-names>
        </name>
        <name>
          <surname>Pertea</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Mortazavi</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Kwan</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>van Baren</surname>
          <given-names>MJ</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <name>
          <surname>Wold</surname>
          <given-names>BJ</given-names>
        </name>
        <name>
          <surname>Pachter</surname>
          <given-names>L</given-names>
        </name>
        <article-title>Transcript assembly and quantification by RNA-Seq reveals unannotated transcripts and isoform switching during cell differentiation.</article-title>
        <source>Nat Biotechnol</source>
        <year>2010</year>
        <volume>28</volume>
        <fpage>511</fpage>
        <lpage>515</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.1621</pub-id>
        <pub-id pub-id-type="pmid">20436464</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Degner</surname>
          <given-names>JF</given-names>
        </name>
        <name>
          <surname>Marioni</surname>
          <given-names>JC</given-names>
        </name>
        <name>
          <surname>Pai</surname>
          <given-names>AA</given-names>
        </name>
        <name>
          <surname>Pickrell</surname>
          <given-names>JK</given-names>
        </name>
        <name>
          <surname>Nkadori</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Gilad</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Pritchard</surname>
          <given-names>JK</given-names>
        </name>
        <article-title>Effect of read-mapping biases on detecting allele-specific expression from RNA-sequencing data.</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>3207</fpage>
        <lpage>3212</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp579</pub-id>
        <pub-id pub-id-type="pmid">19808877</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Heap</surname>
          <given-names>GA</given-names>
        </name>
        <name>
          <surname>Yang</surname>
          <given-names>JHM</given-names>
        </name>
        <name>
          <surname>Downes</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Healy</surname>
          <given-names>BC</given-names>
        </name>
        <name>
          <surname>Hunt</surname>
          <given-names>KA</given-names>
        </name>
        <name>
          <surname>Bockett</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Franke</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Dubois</surname>
          <given-names>PC</given-names>
        </name>
        <name>
          <surname>Mein</surname>
          <given-names>CA</given-names>
        </name>
        <name>
          <surname>Dobson</surname>
          <given-names>RJ</given-names>
        </name>
        <name>
          <surname>Albert</surname>
          <given-names>TJ</given-names>
        </name>
        <name>
          <surname>Rodesch</surname>
          <given-names>MJ</given-names>
        </name>
        <name>
          <surname>Clayton</surname>
          <given-names>DG</given-names>
        </name>
        <name>
          <surname>Todd</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>van Heel</surname>
          <given-names>DA</given-names>
        </name>
        <name>
          <surname>Plagnol</surname>
          <given-names>V</given-names>
        </name>
        <article-title>Genome-wide analysis of allelic expression imbalance in human primary cells by high-throughput transcriptome resequencing.</article-title>
        <source>Hum Mol Genet</source>
        <year>2010</year>
        <volume>19</volume>
        <fpage>122</fpage>
        <lpage>134</lpage>
        <pub-id pub-id-type="doi">10.1093/hmg/ddp473</pub-id>
        <pub-id pub-id-type="pmid">19825846</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Fontanillas</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Landry</surname>
          <given-names>CR</given-names>
        </name>
        <name>
          <surname>Wittkopp</surname>
          <given-names>PJ</given-names>
        </name>
        <name>
          <surname>Russ</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Gruber</surname>
          <given-names>JD</given-names>
        </name>
        <name>
          <surname>Nusbaum</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Hartl</surname>
          <given-names>DL</given-names>
        </name>
        <article-title>Key considerations for measuring allelic expression on a genomic scale using high-throughput sequencing.</article-title>
        <source>Mol Ecol</source>
        <year>2010</year>
        <volume>19</volume>
        <issue>Suppl 1</issue>
        <fpage>212</fpage>
        <lpage>227</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1365-294X.2010.04472.x</pub-id>
        <pub-id pub-id-type="pmid">20331781</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="other">
        <article-title>Novocraft.</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://novocraft.com">http://novocraft.com</ext-link>
      </mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="other">
        <article-title>Bayesian Gene eXpression.</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://bgx.org.uk">http://bgx.org.uk</ext-link>
      </mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="other">
        <name>
          <surname>Goncalves</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Tikhonov</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Brazma</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Kapushesky</surname>
          <given-names>M</given-names>
        </name>
        <article-title>A pipeline for RNA-seq data processing and quality assessment.</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21233166</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Montgomery</surname>
          <given-names>SB</given-names>
        </name>
        <name>
          <surname>Sammeth</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Gutierrez-Arcelus</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Lach</surname>
          <given-names>RP</given-names>
        </name>
        <name>
          <surname>Ingle</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Nisbett</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Guigo</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Dermitzakis</surname>
          <given-names>ET</given-names>
        </name>
        <article-title>Transcriptome genetics using second generation sequencing in a Caucasian population.</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>464</volume>
        <fpage>773</fpage>
        <lpage>777</lpage>
        <pub-id pub-id-type="doi">10.1038/nature08903</pub-id>
        <pub-id pub-id-type="pmid">20220756</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Trapnell</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Pachter</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <article-title>TopHat: discovering splice junctions with RNA-Seq.</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1105</fpage>
        <lpage>1111</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp120</pub-id>
        <pub-id pub-id-type="pmid">19289445</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Handsaker</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Wysoker</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Fennell</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Ruan</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Homer</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Marth</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Abecasis</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Durbin</surname>
          <given-names>R</given-names>
        </name>
        <collab>1000 Genome Project Data Processing Subgroup</collab>
        <article-title>The sequence alignment/map format and SAMtools.</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>2078</fpage>
        <lpage>2079</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id>
        <pub-id pub-id-type="pmid">19505943</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Su</surname>
          <given-names>SY</given-names>
        </name>
        <name>
          <surname>Asher</surname>
          <given-names>JE</given-names>
        </name>
        <name>
          <surname>Jarvelin</surname>
          <given-names>MR</given-names>
        </name>
        <name>
          <surname>Froguel</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Blakemore</surname>
          <given-names>AIF</given-names>
        </name>
        <name>
          <surname>Balding</surname>
          <given-names>DJ</given-names>
        </name>
        <name>
          <surname>Coin</surname>
          <given-names>LJM</given-names>
        </name>
        <article-title>Inferring combined CNV/SNP haplotypes from genotype data.</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>1437</fpage>
        <lpage>1445</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btq157</pub-id>
        <pub-id pub-id-type="pmid">20406911</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Trapnell</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Pop</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome.</article-title>
        <source>Genome Biol</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2009-10-3-r25</pub-id>
        <pub-id pub-id-type="pmid">19261174</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Anders</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Huber</surname>
          <given-names>W</given-names>
        </name>
        <article-title>Differential expression analysis for sequence count data.</article-title>
        <source>Genome Biol</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R106</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2010-11-10-r106</pub-id>
        <pub-id pub-id-type="pmid">20979621</pub-id>
        <pub-id pub-id-type="pmid">20979621</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Law</surname>
          <given-names>AM</given-names>
        </name>
        <article-title>Confidence intervals in discrete event simulation: a comparison of replication and batch means.</article-title>
        <source>Naval Res Logist Q</source>
        <year>1977</year>
        <volume>23</volume>
        <fpage>667</fpage>
        <lpage>678</lpage>
        <pub-id pub-id-type="doi">10.1002/nav.3800240414</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="other">
        <article-title>UCSC Genome Browser.</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://genome.ucsc.edu">http://genome.ucsc.edu</ext-link>
      </mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Gregg</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Butler</surname>
          <given-names>JE</given-names>
        </name>
        <name>
          <surname>Haig</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Dulac</surname>
          <given-names>C</given-names>
        </name>
        <article-title>Sex-specific parent-of-origin allelic expression in the mouse brain.</article-title>
        <source>Science</source>
        <year>2010</year>
        <volume>329</volume>
        <fpage>682</fpage>
        <lpage>685</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1190831</pub-id>
        <pub-id pub-id-type="pmid">20616234</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Puck</surname>
          <given-names>JM</given-names>
        </name>
        <name>
          <surname>Willard</surname>
          <given-names>HF</given-names>
        </name>
        <article-title>X inactivation in females with X-linked disease.</article-title>
        <source>N Engl J Med</source>
        <year>1998</year>
        <volume>338</volume>
        <fpage>325</fpage>
        <lpage>328</lpage>
        <pub-id pub-id-type="pmid">9445416</pub-id>
      </mixed-citation>
    </ref>
  </ref-list>
</back>
