<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4495298</article-id>
    <article-id pub-id-type="pmid">25777525</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btv146</article-id>
    <article-id pub-id-type="publisher-id">btv146</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="heading">
          <subject>Bioimage Informatics</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>Cardinal</italic>: an R package for statistical analysis of mass spectrometry-based imaging experiments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Bemis</surname>
          <given-names>Kyle D.</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Harry</surname>
          <given-names>April</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Eberlin</surname>
          <given-names>Livia S.</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ferreira</surname>
          <given-names>Christina</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>van de Ven</surname>
          <given-names>Stephanie M.</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mallick</surname>
          <given-names>Parag</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stolowitz</surname>
          <given-names>Mark</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vitek</surname>
          <given-names>Olga</given-names>
        </name>
        <xref ref-type="aff" rid="btv146-AFF4">
          <sup>4</sup>
        </xref>
        <xref ref-type="aff" rid="btv146-AFF5">
          <sup>5</sup>
        </xref>
        <xref ref-type="corresp" rid="btv146-COR1">*</xref>
      </contrib>
      <aff id="btv146-AFF1"><sup>1</sup>Department of Statistics and</aff>
      <aff id="btv146-AFF2"><sup>2</sup>Department of Chemistry, Purdue University, West Lafayette, IN 47907 USA,</aff>
      <aff id="btv146-AFF3"><sup>3</sup>Canary Center at Stanford for Cancer Early Detection, Stanford University School of Medicine, Palo Alto, CA 94304 USA,</aff>
      <aff id="btv146-AFF4"><sup>4</sup>College of Science and</aff>
      <aff id="btv146-AFF5"><sup>5</sup>College of Computer and Information Science, Northeastern University, Boston, MA 02115 USA</aff>
    </contrib-group>
    <author-notes>
      <corresp id="btv146-COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="FN1">
        <p>Associate Editor: Robert Murphy</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>7</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>15</day>
      <month>3</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>15</day>
      <month>3</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>31</volume>
    <issue>14</issue>
    <fpage>2418</fpage>
    <lpage>2420</lpage>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>12</month>
        <year>2014</year>
      </date>
      <date date-type="rev-recd">
        <day>22</day>
        <month>2</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>3</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2015. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><italic>Cardinal</italic> is an R package for statistical analysis of mass spectrometry-based imaging (MSI) experiments of biological samples such as tissues. <italic>Cardinal</italic> supports both Matrix-Assisted Laser Desorption/Ionization (MALDI) and Desorption Electrospray Ionization-based MSI workflows, and experiments with multiple tissues and complex designs. The main analytical functionalities include (1) image segmentation, which partitions a tissue into regions of homogeneous chemical composition, selects the number of segments and the subset of informative ions, and characterizes the associated uncertainty and (2) image classification, which assigns locations on the tissue to pre-defined classes, selects the subset of informative ions, and estimates the resulting classification error by (cross-) validation. The statistical methods are based on mixture modeling and regularization.</p>
      <p><bold>Contact</bold>: <email>o.vitek@neu.edu</email></p>
      <p><bold>Availability and implementation</bold>: The code, the documentation, and examples are available open-source at <ext-link ext-link-type="uri" xlink:href="http://www.cardinalmsi.org">www.cardinalmsi.org</ext-link> under the Artistic-2.0 license. The package is available at <ext-link ext-link-type="uri" xlink:href="http://www.bioconductor.org">www.bioconductor.org</ext-link>.</p>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Mass spectrometry-based imaging (MSI) experiments characterize the chemical composition of biological samples (such as tissues) or non-biological samples at spatial resolution (<xref rid="btv146-B6" ref-type="bibr">Watrous <italic>et al.</italic>, 2011</xref>). The experiments repeatedly acquire mass spectra at gridded locations on a tissue. Two typical goals of statistical analysis of MSI are <italic>image segmentation</italic>, which partitions a tissue into regions of homogeneous spectral profiles, and <italic>image classification</italic>, which assigns locations of the tissue to pre-defined classes based on their spectral profiles. However, achieving these goals is often quite difficult due to the large and complex nature of the datasets, and due to the biological and technical variation in intensities of spectral features. Statistical inference is key for distinguishing the systematic signals in the spectra from noise. The availability of statistical methods and software for MSI experiments is currently limited.</p>
    <p>We introduce <italic>Cardinal</italic>, an open-source R-based software package for processing and visualization of mass spectra, and for statistical segmentation and classification of the resulting images. <italic>Cardinal</italic> differs from other publicly available software tools such as BioMap, DataCube Explorer and MSiReader in its emphasis on statistical modeling and inference. It differs from commercial tools such as SCiLS Lab (SCiLS), flexImaging (Bruker), HDI (Waters) and TissueView (AB Sciex) in being open-source. It differs from the existing R packages for mass spectrometry such as MALDIquant and MSnbase in being designed specifically for MSI.</p>
  </sec>
  <sec>
    <title>2 Description</title>
    <sec>
      <title>2.1 Applicability and requirements</title>
      <p><italic>Cardinal</italic> is applicable to experiments aiming at segmentation and classification of a single tissue, or multiple tissues collected across biological subjects. It is applicable to Desorption Electrospray Ionization workflows, and to Matrix-Assisted Laser Desorption/Ionization (MALDI) workflows analyzing either intact or <italic>in</italic>
<italic>situ</italic>-digested proteins. <italic>Cardinal</italic> has been tested on raw MS1 spectra from Thermo LTQ linear ion trap, ABSciex TOF/TOF and Bruker Autoflex MALDI-TOF instruments with resolving powers ranging from 1000 to 22 000. <italic>Cardinal</italic> is compatible with Windows, Mac and Linux operating systems. The size of the input dataset must be such that it can be loaded entirely into computer memory. <italic>Cardinal</italic> runs optimally when the available memory is twice the size of the dataset.</p>
    </sec>
    <sec>
      <title>2.2 Data import, processing and visualization</title>
      <p><italic>Cardinal</italic> supports input data in the imzML format (<xref rid="btv146-B4" ref-type="bibr">Schramm <italic>et al.</italic>, 2012</xref>), and the <monospace>Analyze7.5</monospace> format. Free converters to imzML are available for most other formats at <ext-link ext-link-type="uri" xlink:href="http://www.imzml.org">www.imzml.org</ext-link>, and the converted imzML input data can be read into <italic>Cardinal</italic>.</p>
      <p><italic>Cardinal</italic> implements a complete set of common spectral processing methods (<xref rid="btv146-B7" ref-type="bibr">Yang <italic>et al.</italic>, 2009</xref>), including normalization (e.g. using total ion current), baseline correction (e.g. using median interpolation), peak detection [e.g. using LIMPIC (<xref rid="btv146-B3" ref-type="bibr">Mantini <italic>et al.</italic>, 2007</xref>)] and peak alignment (e.g. using mean spectrum).</p>
      <p><italic>Cardinal</italic> visualizes mass spectra, molecular ion images and results of the statistical analyses. The images are optimized with contrast enhancement and smoothing. The plots can be conditioned on experimental metadata (such as the type of the tissue), and viewed separately using a grid layout with multiple conditions, or jointly in a superposition.</p>
    </sec>
    <sec>
      <title>2.3 Functionalities for statistical analysis</title>
      <p>For image segmentation, <italic>Cardinal</italic> implements several existing methods, e.g. principle component analysis and Spatially-Aware (SA) and Spatially Aware Structurally Adaptive (SASA) segmentation (<xref rid="btv146-B1" ref-type="bibr">Alexandrov and Kobarg, 2011</xref>). <italic>Cardinal</italic> also introduces a novel method, called Spatial Shrunken Centroids, for model-based unsupervised image segmentation (<xref ref-type="fig" rid="btv146-F1">Fig. 1</xref>). It combines the spatial distance from SA and SASA with the mixture modeling and regularization from Nearest Shrunken Centroids (<xref rid="btv146-B5" ref-type="bibr">Tibshirani <italic>et al.</italic>, 2003</xref>). The mixture modeling allows us to estimate the probability that a location on the tissue belongs to a particular segment. Statistical regularization allows us to automatically select the spectral features that define each segments, as well as the total number of segments.
<fig id="btv146-F1" position="float"><label>Fig. 1.</label><caption><p>Unsupervised model-based segmentation of a cross-section of a pig fetus. (<bold>a</bold>) Optical image of a hematoxylin &amp; eosin-stained tissue highlights its morphology, e.g. the brain (left), the heart (center) and the liver (dark region below the heart). (<bold>b</bold>) Joint segmentation of five adjacent tissue sections from 28 016 non-background pixels and 10 200 mass features. <italic>Cardinal</italic> detected 298 peaks during peak picking. The segmentation with Spatial Shrunken Centroids and Spatially Aware distance selected 11 tissue segments. (<bold>c</bold>) The <italic>t</italic>-statistics quantified the relative importance of the peaks in the liver. Ninety-two peaks were systematically enriched and 153 were systematically absent, as compared with the mean spectrum. (<bold>d</bold>) As in (c), but for the heart segment. Only 23 peaks were systematically enriched in the heart, and none were systematically absent. Similar analyses can be performed in a supervised manner for image classification</p></caption><graphic xlink:href="btv146f1p"/></fig>
</p>
      <p>For image classification, <italic>Cardinal</italic> implements partial least squares discriminant analysis and orthogonal projections to latent structures discriminant analysis (<xref rid="btv146-B2" ref-type="bibr">Dill <italic>et al.</italic>, 2010</xref>). <italic>Cardinal</italic> also introduces a novel Spatial Shrunken Centroids for model-based image classification, which utilizes the same principles as the model-based image segmentation but works in a supervised manner. For all the methods, <italic>Cardinal</italic> automates the estimation of classification error rate by (cross-)validation.</p>
    </sec>
    <sec>
      <title>2.4 Implementation and performance</title>
      <p><italic>Cardinal</italic> employs efficient data structures to store the data and the metadata, and optimized methods for data manipulation. As the result, <italic>Cardinal</italic> can be used with any dataset that fits in the computer memory. For example, the dataset in <xref ref-type="fig" rid="btv146-F1">Figure 1</xref> with 28 016 pixels was 2.2 GB before the peak picking, and the processed version was 63.7 MB after the peak picking. Computation of the first 20 principal components took 86.9 sec on the raw data and 4.3 s on the picked peaks on a MacBook Pro with a 2.6 GHz Intel Core i7 and 16 GB memory. The segmentation with Spatial Shrunken Centroids on the picked peaks took 241 s (shortest) to 827 s (longest), depending on the initial values of regularization parameters and the number of clusters, on the same computer.</p>
      <p><italic>Cardinal</italic> facilitates the development of new functionalities, and the interoperability with other software. For example, raw mass spectra can be stored as either a R matrix or any matrix-like object, such as a sparse matrix. Most of the processing methods use an extendable framework <monospace>pixelApply</monospace>, similar to the <monospace>apply</monospace> family of methods in R. The <monospace>ResultSet</monospace> data structure allows the developers to store the results of any analyses, and directly access the <italic>Cardinal</italic>’s plotting capabilities. <italic>Cardinal</italic> also has functions for simulating mass spectra, to assist method testing. It is publicly available at <ext-link ext-link-type="uri" xlink:href="http://www.bioconductor.org">www.bioconductor.org</ext-link></p>
    </sec>
  </sec>
  <sec>
    <title>3 Conclusions</title>
    <p><italic>Cardinal</italic> is a general, flexible, open-source tool for the analysis of MSI experiments. It can be used by researchers with and without background in R and computing. For experimenters, <italic>Cardinal</italic> provides a full toolchain for multiple workflows, with emphasis on multivariate statistical modeling, inference and model-based visualization. For developers, <italic>Cardinal</italic> provides a foundation for designing and implementing new methods of computational and statistical analysis of MSI experiments. Users can find more support through the Google Group, accessible through the project website.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the <funding-source>NSF Graduate Research Fellowship</funding-source> No. <award-id>103049</award-id> to K.B., by the <funding-source>Carver Fellowship, Purdue University</funding-source>, to A.H., and by the <funding-source>NSF CAREER</funding-source> award <award-id>DBI-1054826</award-id> to O.V. The authors thank R. Graham Cooks for invaluable discussions and the data.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="btv146-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alexandrov</surname><given-names>T.</given-names></name><name><surname>Kobarg</surname><given-names>J.H.</given-names></name></person-group> (<year>2011</year>) <article-title>Efficient spatial segmentation of large imaging mass spectrometry datasets with spatially aware clustering</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>i230</fpage>.<pub-id pub-id-type="pmid">21685075</pub-id></mixed-citation>
    </ref>
    <ref id="btv146-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dill</surname><given-names>A.L.</given-names></name><etal/></person-group> (<year>2010</year>) <article-title>Multivariate statistical differentiation of renal cell carcinomas based on lipidomic analysis by ambient ionization imaging mass spectrometry</article-title>. <source>Anal. Bioanal. Chem.</source>, <volume>398</volume>, <fpage>2969</fpage>.<pub-id pub-id-type="pmid">20953777</pub-id></mixed-citation>
    </ref>
    <ref id="btv146-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mantini</surname><given-names>D.</given-names></name><etal/></person-group> (<year>2007</year>) <article-title>LIMPIC: a computational method for the separation of protein MALDI-TOF-MS signals from noise</article-title>. <source>BMC Bioinf.</source>, <volume>8</volume>, <fpage>101</fpage>.</mixed-citation>
    </ref>
    <ref id="btv146-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schramm</surname><given-names>T.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>imzML – A common data format for the flexible exchange and processing of mass spectrometry imaging data</article-title>. <source>J. Proteom.</source>, <volume>75</volume>, <fpage>5106</fpage>.</mixed-citation>
    </ref>
    <ref id="btv146-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tibshirani</surname><given-names>R.</given-names></name><etal/></person-group> (<year>2003</year>) <article-title>Class prediction by nearest shrunken with applications to DNA microarrays</article-title>. <source>Stat. Sci.</source>, <volume>18</volume>, <fpage>104</fpage>.</mixed-citation>
    </ref>
    <ref id="btv146-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Watrous</surname><given-names>J.D.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>The evolving field of imaging mass spectrometry and its impact on future biological research</article-title>. <source>J.Mass Spectrom.</source>, <volume>46</volume>, <fpage>209</fpage>.<pub-id pub-id-type="pmid">21322093</pub-id></mixed-citation>
    </ref>
    <ref id="btv146-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname><given-names>C.</given-names></name><etal/></person-group> (<year>2009</year>) <article-title>Comparison of public peak detection algorithms for MALDI mass spectrometry data analysis</article-title>. <source>BMC Bioinf.</source>, <volume>10</volume>, <fpage>4</fpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
