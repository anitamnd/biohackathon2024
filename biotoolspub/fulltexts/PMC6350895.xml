<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat. Methods?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 1005?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6350895</article-id>
    <article-id pub-id-type="pmid">29553579</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4636</article-id>
    <article-id pub-id-type="manuscript">ems76395</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SpatialDE: identification of spatially variable genes</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Svensson</surname>
          <given-names>Valentine</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Teichmann</surname>
          <given-names>Sarah A</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stegle</surname>
          <given-names>Oliver</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Wellcome Trust Sanger Institute, Wellcome Genome Campus, CB10 1SD Hinxton, Cambridge, UK</aff>
    <aff id="A2"><label>2</label>European Molecular Biology Laboratory, European Bioinformatics Institute, Wellcome Genome Campus, CB10 1SD, Hinxton, Cambridge, UK</aff>
    <aff id="A3"><label>3</label>Theory of Condensed Matter Group, Cavendish Laboratory, 19 JJ Thomson Avenue, CB3 0HE, Cambridge, U.K</aff>
    <aff id="A4"><label>4</label>European Molecular Biology Laboratory, Genome Biology Unit, 69117 Heidelberg, Germany</aff>
    <author-notes>
      <corresp id="CR1">Corresponding authors: Valentine Svensson (<email>vale@ebi.ac.uk</email>), Oliver Stegle (<email>oliver.stegle@ebi.ac.uk</email>)</corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>23</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>19</day>
      <month>3</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>29</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <volume>15</volume>
    <issue>5</issue>
    <fpage>343</fpage>
    <lpage>346</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4636-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Technological advances have made it possible to measure spatially resolved gene expression at high throughput. However, methods to analyze these data are not established. Here, we develop SpatialDE, a statistical test to identify genes with spatial patterns of expression variation from multiplexed imaging or spatial RNA sequencing data. SpatialDE also implements “automatic expression histology”, a spatial gene clustering approach that enables expression-based tissue histology.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Miniaturization and parallelization in genomics has enabled high-throughput transcriptome profiling from low quantities of starting material, including in single cells. Increased throughput has also fostered new experimental designs that directly assay the spatial context of gene expression variation. Spatially resolved gene expression is crucial for determining the functions and phenotypes of cells in multicellular organisms<xref rid="R1" ref-type="bibr">1</xref>. Spatial expression variation can reflect communication between adjacent cells, position-specific states, or cells that migrate to specific tissue locations to perform their functions.</p>
  <p id="P3">Several experimental methods to measure gene expression levels in a spatial context have been established, which differ in resolution, accuracy and throughput. These include the computational integration of single cell RNA-seq (scRNA-seq) data with a spatial reference dataset<xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref>, careful collection and recording of the spatial location of samples<xref rid="R4" ref-type="bibr">4</xref>, parallel profiling of mRNA using barcodes on a grid of known spatial locations<xref rid="R4" ref-type="bibr">4</xref>–<xref rid="R6" ref-type="bibr">6</xref>, and methods based on multiplexed <italic>in situ</italic> hybridization<xref rid="R7" ref-type="bibr">7</xref>,<xref rid="R8" ref-type="bibr">8</xref> or sequencing<xref rid="R1" ref-type="bibr">1</xref>.</p>
  <p id="P4">A first critical step in the analysis of these datasets is to identify genes that exhibit spatial variation across the tissue. However, existing approaches for identifying highly variable genes (HVG)<xref rid="R9" ref-type="bibr">9</xref>, as used for conventional scRNA-seq data, ignore spatial information and hence do not measure <italic>spatial</italic> variability (<xref ref-type="fig" rid="F1">Fig. 1A</xref>). Alternatively, researchers have applied analysis of variance (ANOVA) to test for differential expression between groups of cells, either using <italic>a priori</italic> defined cell annotations, or based on sample clustering<xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R6" ref-type="bibr">6</xref>,<xref rid="R7" ref-type="bibr">7</xref>, with some methods incorporating spatial information<xref rid="R10" ref-type="bibr">10</xref>. Critically, such methods can only detect variations that are captured by differences between discrete groups.</p>
  <p id="P5">Here, we propose <italic>SpatialDE</italic>, a method for identifying and characterizing <italic>spatially variable</italic> genes (SV genes). Our method builds on Gaussian process regression, a class of models used in geostatistics. Briefly, for each gene, SpatialDE decomposes expression variability into spatial and non-spatial components (<xref ref-type="fig" rid="F1">Fig. 1A-B</xref>), using two random effect terms: a spatial variance term that parametrizes gene expression covariance by pairwise distances of samples, and a noise term that models non-spatial variability. The ratio of the variance explained by these components quantifies the Fraction of Spatial Variance (FSV). Significant SV genes can be identified by comparing this full model to a model without the spatial variance component (<xref ref-type="fig" rid="F1">Fig. 1B</xref>, <xref ref-type="sec" rid="S1">Methods</xref>).</p>
  <p id="P6">By interpreting the fitted model parameters, we can gain insights into the underlying spatial function, such as its length scale (<xref ref-type="fig" rid="F1">Fig. 1B</xref>, the expected number of changes in a unit interval). SpatialDE can also be used to classify these functions, thereby identifying genes with linear or periodic expression patterns (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 1</xref>, <xref ref-type="sec" rid="S1">Methods</xref>). Finally, SpatialDE provides a spatial clustering method within the same Gaussian process framework, which identifies sets of genes that mark distinct spatial expression patterns (<xref ref-type="fig" rid="F1">Fig. 1C</xref>). This provides a means to perform <italic>automatic expression histology</italic> (AEH), which relates tissue structure and cell type composition using the expression patterns of marker genes. Leveraging efficient inference methods previously developed for linear mixed models<xref rid="R11" ref-type="bibr">11</xref>, and taking advantage of the data structure from massively parallel molecular assays, SpatialDE is computationally very efficient (<xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 2</xref>).</p>
  <p id="P7">First, we applied our method to spatial transcriptomics data from mouse olfactory bulb<xref rid="R6" ref-type="bibr">6</xref>. Briefly, spatial transcriptomics gene expression levels were derived from thin tissue sections placed on an array with poly(dT) probes and spatially resolved DNA barcodes. These form a grid of circular “spots” with a diameter of 100 μm, measuring mRNA abundance of 10-100 cells per spot using probes with barcodes that encode spatial locations.</p>
  <p id="P8">The SpatialDE test identified 67 SV genes (FDR &lt; 0.05, <xref ref-type="supplementary-material" rid="SD5">Supp. Table 1</xref>), with spatial dependencies explaining up to 70% of the gene expression variance (<xref ref-type="fig" rid="F2">Fig. 2A</xref>). This set of genes was also markedly disjoint from genes identified when using conventional HVG methods that ignore spatial dependencies (3,497 genes, 40 overlap, <xref ref-type="sec" rid="S1">Methods</xref>). The SV genes identified exhibit clear spatial substructure, consistent with matched hematoxylin and eosin (HE) stained images of the same tissue (<xref ref-type="fig" rid="F2">Fig. 2B-C</xref>). These included canonical marker genes highlighted in the primary analysis by Ståhl <italic>et al<xref rid="R6" ref-type="bibr">6</xref></italic>, such as <italic>Penk</italic>, <italic>Doc2g</italic>, and <italic>Kctd12</italic>, but also additional genes that define the granule cell layer of the bulb. Genes in the latter set were classified as periodically variable, with period lengths corresponding to the distance between the centers of the hemispheres, including <italic>Kcnh3</italic>, <italic>Nrgn</italic>, or <italic>Mbp</italic> with 1.8 mm period length (<xref ref-type="fig" rid="F2">Fig. 2C</xref>, further examples in <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 3</xref>). Other genes with periodic patterns, such as the vesicular glutamate transporter <italic>Slc17a7</italic>, were identified with shorter periods (1.1 mm), and inspection revealed regularly dispersed regions, potentially identifying a pattern associated with higher neuron density<xref rid="R12" ref-type="bibr">12</xref>, suggesting that periodic expression in tissues is of biological interest.</p>
  <p id="P9">Applying automatic expression histology identified five canonical expression patterns, clearly demarcating structures visible in the HE image (<xref ref-type="fig" rid="F2">Fig. 2D</xref>, <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 4A</xref>). For comparison, we also considered conventional clustering based on the expression profile of each “spot”. However, this approach ignores spatial information and does not establish relationships between genes defining cell types as in AEH (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 5</xref>).</p>
  <p id="P10">As a second application, we considered tissue slices from breast cancer biopsies<xref rid="R6" ref-type="bibr">6</xref>, profiled using the same spatial transcriptomics protocol (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 6</xref>). SpatialDE identified 115 SV genes (FDR &lt; 0.05, compared to 3,503 detected by HVG; overlap 34 genes), including seven genes with known disease relevance that were highlighted in the primary analysis (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 6B-C</xref>). Significantly SV genes were enriched for collagens, which distinguish tissue substructure<xref rid="R13" ref-type="bibr">13</xref> (Reactome “Collagen formation”, P = 3.38 * 10<sup>-14</sup>, gProfiler<xref rid="R14" ref-type="bibr">14</xref>, <xref ref-type="supplementary-material" rid="SD5">Supp. Table 1</xref>). Additionally, we identified the autophagy related gene <italic>TP53INP2,</italic> surrounding the structured tissue (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 6C</xref>). The set of SV genes also included the cytokines <italic>CXCL9</italic> and <italic>CXCL13</italic>, which are expressed in a visually distinct region (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 6A</xref>, black arrow), together with the IL12 receptor subunit gene <italic>IL12RB1</italic>, indicating a potential tumor-related local immune response. Notably, these genes (and N=29 others) were not identified as differentially expressed when applying unsupervised clustering in conjunction with an ANOVA test (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 7</xref>). Furthermore, these genes do not have high rank based on non-spatial HVG measures (including mean-CV<sup>2</sup> relation<xref rid="R9" ref-type="bibr">9</xref> or mean-dropout relation<xref rid="R15" ref-type="bibr">15</xref>, <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 8</xref>).</p>
  <p id="P11">Automatic expression histology of the SV genes in the breast cancer biopsy (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 4B</xref>) most clearly separated the adipocytic from the denser region of the tissue, but additionally identified a small region overlapping the tumor feature in the HE image. Among the 17 genes assigned to this pattern were the cytokines and receptors <italic>CXCL9</italic>, <italic>CXCL13</italic>, <italic>IL12RB1</italic>, and <italic>IL21R</italic> (<xref ref-type="supplementary-material" rid="SD5">Supp. Table 1</xref>).</p>
  <p id="P12">Overall, we found that variable genes detected by SpatialDE are complementary to existing methods. In particular, SpatialDE identifies genes with localized expression patterns, as indicated by small fitted length scales, which are missed by methods that ignore spatial contexts (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 7E</xref>). We confirmed the statistical calibration and the robustness of SpatialDE using randomized data (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 9</xref>) and simulations (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 10</xref>).</p>
  <p id="P13">SpatialDE is not limited to sequencing technologies, and can be applied to any expression data with spatial and/or temporal annotation. To explore this, we applied SpatialDE to data generated using multiplexed single molecule FISH (smFISH), a method that quantifies gene expression with subcellular resolution for a large number of target genes in parallel. Briefly, probes are sequentially hybridized to RNA while carrying different temporal combinations of fluorophores, which act as barcodes and can quantify the expression of thousands of transcripts<xref rid="R16" ref-type="bibr">16</xref> by imaging.</p>
  <p id="P14">We applied SpatialDE to multiplexed smFISH data of cells from mouse hippocampus, generated using SeqFISH<xref rid="R7" ref-type="bibr">7</xref>. This study considered 249 genes chosen to investigate the cell type composition along dorsal and ventral axes of the hippocampus (<xref ref-type="fig" rid="F2">Fig. 2E</xref>). SpatialDE identified 32 SV genes (<xref ref-type="fig" rid="F2">Fig. 2E</xref>, FDR &lt; 0.05, 58 genes were detected as HVG, with an overlap of 5 genes) and again SpatialDE identified genes with different types of spatial variation, including linear (N=5) and periodic patterns (N=8, examples in <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 11</xref>). The three highest ranking genes: <italic>Mog</italic>, <italic>Myl14</italic>, and <italic>Ndnf</italic> displayed a distinct region of lower expression (<xref ref-type="fig" rid="F2">Figure 2F-G</xref>, black arrows). These genes were grouped into histological expression patterns by the AEH method (<xref ref-type="fig" rid="F2">Figure 2H</xref>, <xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 2C</xref>). Visual inspection of all 249 genes supports the ranking of spatial variation from SpatialDE (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 12</xref>).</p>
  <p id="P15">SpatialDE can also be used to test for spatial expression variation in cell culture systems, where spatial variation is not typically expected <italic>a priori</italic>. As an example, we considered data from another multiplexed smFISH dataset generated using MERFISH with 140 probes on a human osteosarcoma cell line<xref rid="R8" ref-type="bibr">8</xref> (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 13A-B</xref>). In the primary analysis, surprisingly <italic>Moffitt et al.<xref rid="R8" ref-type="bibr">8</xref></italic> discovered spatially restricted cell populations with higher proliferation rates. Consistent with these findings, our method identified a substantial proportion of the genes assayed as spatially variable (N=91, 65% of all genes, FDR&lt;0.05, 29 genes HVG with overlap of 24 genes), including six of the seven genes highlighted as differentially expressed between proliferating and resting subpopulations (e.g. <italic>THBS1</italic> and <italic>CENPF1</italic>, <xref ref-type="supplementary-material" rid="SD2">Supp Fig. 13C</xref>). This indicates that high confluence in cell culture can lead to spatial dependency in gene expression<xref rid="R17" ref-type="bibr">17</xref>. Negative control probes in these data were not detected as spatially variable, further confirming the statistical calibration of SpatialDE (<xref ref-type="supplementary-material" rid="SD2">Supp Fig. 13D</xref>).</p>
  <p id="P16">Our results demonstrate that SpatialDE identifies spatially variable genes and allows biologically relevant features to be detected in tissue samples without <italic>a priori</italic> histological annotation. The increased availability of high-throughput experiments, including spatially resolved RNA-seq, means that there will be a growing need for methods that account for this new dimension of expression variation, such as SpatialDE.</p>
  <p id="P17">We applied our method to data from multiple protocols, considering both tissues and cell cultures. SpatialDE can also be applied to temporal data from time-course experiments to identify genes with dynamic expression (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 14</xref>). Methods already exist for this application<xref rid="R18" ref-type="bibr">18</xref>, but are typically computationally more demanding. In principle, SpatialDE can also be applied to 3-dimensional data, e.g. from aligned serial sections of 2-dimensional data, or from <italic>in situ</italic> sequencing<xref rid="R1" ref-type="bibr">1</xref>.</p>
  <p id="P18">SpatialDE is related to and generalizes previous approaches for detecting temporal<xref rid="R19" ref-type="bibr">19</xref> and periodic gene expression patterns<xref rid="R20" ref-type="bibr">20</xref> in time series. While biologically important, the identification of periodic patterns has technical limitations, in particular in edge cases, where noise can mask statistical significance for visually similar patterns (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 15</xref>).</p>
  <p id="P19">Future extensions of SpatialDE could be tailored towards specific platforms, for example to more explicitly model technical sources of variation. Other areas of future work are the incorporation of information about the tissue makeup or local differences in cell density. Finally, there exist spatial clustering methods that are focused on clustering cell positions rather than genes<xref rid="R10" ref-type="bibr">10</xref>, which could be combined with the AEH presented here.</p>
  <sec sec-type="methods" id="S1" specific-use="web-only">
    <title>Online methods</title>
    <p id="P20">Methods, including statements of data availability and any associated accession codes and references, are available in the online version of the paper. Full details of the derivation and implementation of SpatialDE are provided in <xref ref-type="supplementary-material" rid="SD3">Supp. Note 1</xref>.</p>
    <sec id="S2">
      <title>SpatialDE model</title>
      <p id="P21">Spatial DE models the gene expression profiles <italic>y</italic> = (<italic>y</italic><sub>1</sub>, … , <italic>y<sub>N</sub></italic>) for a given gene across spatial coordinates <italic>X</italic> = (<italic>x</italic><sub>1</sub>, … , <italic>x<sub>N</sub></italic>) using a multivariate normal model of the form <disp-formula id="FD1"><label>(1)</label><mml:math display="block" id="M1" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mi>δ</mml:mi><mml:mo>,</mml:mo><mml:mi>Σ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>μ</mml:mi><mml:mo>·</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>·</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>Σ</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>·</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p id="P22">The fixed effect <italic>μ<sub>g</sub></italic> · 1accounts for mean expression level and <italic>Σ</italic> denotes a spatial covariance matrix defined based on the input coordinates of pairs of cells. SpatialDE uses the so called squared exponential covariance function to define <italic>Σ</italic>: <disp-formula id="FD2"><label>(2)</label><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:msub><mml:mi>Σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mtext mathvariant="italic">exp</mml:mtext><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msup><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>·</mml:mo><mml:msup><mml:mi>l</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> whereby the covariance between pairs of cells <italic>i</italic> and <italic>j</italic> is modelled to decay exponentially with the squared distance between them. The hyperparameter <italic>l</italic>, also known as the <italic>characteristic length scale</italic>, determines how rapidly the covariance decays as a function of distance<xref rid="R21" ref-type="bibr">21</xref>.</p>
      <p id="P23">The second covariance term <italic>δ</italic> · <italic>I</italic> accounts for independent non-spatial variation in gene expression, where the ratio FSV = 1 / (1 + <italic>δ</italic>) can be interpreted as the fraction of expression variance attributable to spatial effects. Model parameters are fit by maximizing the marginal log likelihood, <disp-formula id="FD3"><label>(3)</label><mml:math display="block" id="M3" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo>·</mml:mo><mml:mi>N</mml:mi><mml:mo>·</mml:mo><mml:mtext>log</mml:mtext><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>·</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo>·</mml:mo><mml:mtext>log</mml:mtext><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>·</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>Σ</mml:mi><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>·</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mo>·</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>·</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo>Σ</mml:mo><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo>·</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mo>·</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula> This optimization problem with closed form solutions for the parameters <italic>μ</italic> and <italic>σ<sub>s</sub></italic>, for given parameters values <italic>δ</italic>. Gradient-based optimization is used to determine <italic>δ</italic>, and the hyperparameter <italic>l</italic> is determined via grid search. Naïve methods for evaluating the marginal likelihood in <xref ref-type="disp-formula" rid="FD1">Eq. (1)</xref> scale cubically in the number of cells, thus prohibiting applications to larger datasets. We adapt algebraic reformulations that have been proposed in statistical genetics<xref rid="R11" ref-type="bibr">11</xref>,<xref rid="R22" ref-type="bibr">22</xref>, coupled with efficient pre-computations of all terms possible, to improve scalability of the model (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 2</xref>).</p>
    </sec>
    <sec id="S3">
      <title>Statistical significance</title>
      <p id="P24">To estimate statistical significance, the model likelihood of the fitted SpatialDE model is compared to the likelihood of a model that corresponds to the null hypothesis of no spatial covariance, <disp-formula id="FD4"><label>(4)</label><mml:math display="block" id="M4" overflow="scroll"><mml:mrow><mml:mtext>P</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>y</mml:mtext><mml:mo>|</mml:mo><mml:mo>μ</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>μ</mml:mo><mml:mo>·</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>·</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula> P-values are then estimated analytically based on the <italic>χ</italic><sup>2</sup> distribution transformation with one degree of freedom. Unless stated otherwise, we use the Q-value method<xref rid="R23" ref-type="bibr">23</xref> to adjust for multiple testing, thereby controlling the false discovery rate (FDR).</p>
    </sec>
    <sec id="S4">
      <title>Model selection</title>
      <p id="P25">Following significance testing, the spatial covariance patterns identified can be further investigated by comparisons of models with alternative covariance functions. In addition to the squared exponential covariance (<xref ref-type="disp-formula" rid="FD2">Eq. (2)</xref>), SpatialDE implements covariance functions that assume linear trends as well as periodic patterns of gene expression variation (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 1</xref>), which are compared using the Bayesian information criterion: <disp-formula id="FD5"><mml:math display="block" id="M5" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mtext>log</mml:mtext><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:mi>M</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mo>·</mml:mo><mml:mi>L</mml:mi><mml:mi>L</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula> Here <italic>M</italic> denotes the number of hyperparameters of a given model, <italic>N</italic> the number of samples, and <italic>LL</italic> (<xref ref-type="disp-formula" rid="FD3">Eq. (3)</xref>) is the log marginal likelihood of the data. For guidance on how to interpret these inferences and alternative functional forms, see <xref ref-type="supplementary-material" rid="SD3">Supp. Note 1</xref>.</p>
    </sec>
    <sec id="S5">
      <title>Automatic expression histology</title>
      <p id="P26">To group spatially variable genes with similar spatial expression patterns, SpatialDE implements a clustering model based on the same spatial GP prior as used to test for spatially variable genes (<xref ref-type="disp-formula" rid="FD1">Eq. (1)</xref>). Let <italic>Y</italic> = (<italic>y</italic><sub>1</sub>, . . . , <italic>y<sub>G</sub></italic>) be the expression matrix of <italic>G</italic> spatially variable genes in each spatial location (now each <italic>y<sub>g</sub></italic> is a vector of <italic>N</italic> observations), <italic>μ</italic> = {<italic>μ</italic><sub>1</sub>, . . , <italic>μ<sub>K</sub></italic>} is the matrix of <italic>K</italic> underlying patterns, so the vector <italic>μ<sub>k</sub></italic> represents pattern <italic>k</italic>. Further, let <italic>Z</italic> be a binary indicator matrix that assigns gene <italic>g</italic> to pattern <italic>k</italic> if <italic>z<sub>g,k</sub></italic> = 1. Then the full model across all genes can be written as: <disp-formula id="FD6"><mml:math display="block" id="M6" overflow="scroll"><mml:mtable columnalign="center"><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mi>Σ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>μ</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>Σ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>Z</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>G</mml:mi></mml:munderover><mml:mrow><mml:mi>N</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>μ</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>Σ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>Σ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>G</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>K</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> The parameter <inline-formula><mml:math display="inline" id="M7" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is the noise level for the model, and <italic>Σ</italic> is the spatial covariance matrix defined based on spatial coordinates (see <xref ref-type="disp-formula" rid="FD2">Eq. (2)</xref>). This model can be regarded as an extension of the classical Gaussian mixture model<xref rid="R24" ref-type="bibr">24</xref>, with the addition of a spatial prior on cluster centroids. Approximate posterior distributions for <italic>μ</italic> and <italic>z</italic> are estimated using variational inference<xref rid="R24" ref-type="bibr">24</xref>, while the noise level <inline-formula><mml:math display="inline" id="M8" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>e</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is estimated by maximising the variational lower bound. The length scale <italic>l</italic> for the covariance <italic>Σ</italic> is specified by the user, as is the number of fitted patterns, <italic>K</italic>. The choice of <italic>l</italic> can be informed by the fitted length scales in the SpatialDE significance test. See <xref ref-type="supplementary-material" rid="SD3">Supp. Note 1</xref> for details on inference and derivation of variational updates.</p>
      <p id="P27">After inference, the posterior expectations <inline-formula><mml:math display="inline" id="M9" overflow="scroll"><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></inline-formula> and <inline-formula><mml:math display="inline" id="M10" overflow="scroll"><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></inline-formula> of the parameters can be used to visualise any histological pattern through plotting <inline-formula><mml:math display="inline" id="M11" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> over the <italic>x</italic> coordinates. The most likely assignment of genes to an individual pattern is determined by the largest value in the vector <inline-formula><mml:math display="inline" id="M12" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">¯</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> which corresponds to the posterior probabilities of a gene belonging to each pattern.</p>
    </sec>
    <sec id="S6">
      <title>Highly variable gene selection</title>
      <p id="P28">For each dataset, highly variable genes were identified using the ScanPy implementation<xref rid="R25" ref-type="bibr">25</xref> of the Seurat method of highly variable gene filtering<xref rid="R3" ref-type="bibr">3</xref> using default parameters.</p>
    </sec>
    <sec id="S7">
      <title>Relationship to prior work</title>
      <p id="P29">SpatialDE is related to existing Gaussian-processes based gene expression models. First used in geostatistics<xref rid="R26" ref-type="bibr">26</xref>, GP models have been applied to test for differential gene expression over time<xref rid="R27" ref-type="bibr">27</xref>, including the analysis of bifurcation events<xref rid="R28" ref-type="bibr">28</xref>, and to define general tests for temporal variability<xref rid="R28" ref-type="bibr">28</xref>–<xref rid="R32" ref-type="bibr">32</xref>.</p>
      <p id="P30">We have here adapted GP models to spatial transcriptome data, although the model can also be applied to univariate data (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 14</xref>) or higher-dimensional inputs. The main technical innovations presented here are three-fold. First, the model presented is faster than existing methods by leveraging computational tricks previously proposed in the context of statistical genetics (<xref ref-type="supplementary-material" rid="SD2">Supp. Fig. 2</xref>, Section above). Second, we combine spatial GPs with model selection using BIC<xref rid="R33" ref-type="bibr">33</xref>. Third, we propose an efficient and versatile spatial clustering within the same statistical framework.</p>
    </sec>
    <sec id="S8">
      <title>Data sets and processing</title>
      <sec id="S9">
        <title>Spatial Transcriptomics data</title>
        <p id="P31">The count tables from Stahl et al<xref rid="R6" ref-type="bibr">6</xref> were downloaded from the website <ext-link ext-link-type="uri" xlink:href="http://www.spatialtranscriptomicsresearch.org/datasets/doi-10-1126science-aaf2403">http://www.spatialtranscriptomicsresearch.org/datasets/doi-10-1126science-aaf2403</ext-link>, linked from the publication. For the breast cancer data, we used the file annotated as ”Layer 2” with the corresponding HE image. For the mouse olfactory bulb, we used the file named ”Replicate 11” with corresponding HE image. Images included in figures were cropped, down-scaled and converted to grayscale to conserve file sizes. When performing automatic expression histology, the number of patterns was set to 5 for both data sets, the characteristic length scale was set to 105 μm for the breast cancer data, and to 150 μm for the olfactory bulb data.</p>
      </sec>
      <sec id="S10">
        <title>SeqFISH data</title>
        <p id="P32">We downloaded the expression table from the supplementary material of Shah <italic>et al<xref rid="R7" ref-type="bibr">7</xref></italic> and extracted cell counts from the region annotated with number 43 in the 249 gene experiment (Table S8 in the original publication). The shape of the data suggested this corresponded to a region in the lower left part of the corresponding supplementary figure, informing the schematic shown in <xref ref-type="fig" rid="F2">Fig. 2F</xref> (only used for the purpose of illustration). In the automatic histology analysis, the number of patterns was set to 5, and the characteristic length scale was set to 50 μm.</p>
      </sec>
      <sec id="S11">
        <title>MERFISH data</title>
        <p id="P33">From the website <ext-link ext-link-type="uri" xlink:href="http://zhuang.harvard.edu/merfish">http://zhuang.harvard.edu/merfish</ext-link> we downloaded the file ”data for release.zip” which contain data from Moffitt et al<xref rid="R8" ref-type="bibr">8</xref> We used the files in the folder called ”Replicate 6”, as these had the largest number of cells and highest confluency.</p>
      </sec>
      <sec id="S12">
        <title>Frog development RNA-seq data</title>
        <p id="P34">We downloaded the TPM expression table for Clutch A from GEO accession GSE65785 which was referenced in the original publication<xref rid="R18" ref-type="bibr">18</xref>.</p>
      </sec>
    </sec>
    <sec id="S13">
      <title>Expression count normalisation</title>
      <p id="P35">The SpatialDE model is based on the assumption of normally distributed residual noise and independent observations across cells. To meet these requirements with spatial expression count data we have identified two normalisation steps (<xref ref-type="supplementary-material" rid="SD3">Supp. Note 1</xref>). First, we use a variance stabilizing transformation for negative binomial distributed data to satisfy the first condition known as Anscombe’s transformation. Second, we noticed that generally the expression level of a given gene correlates with the total count in a cell / spatial location. To ensure that SpatialDE captures the spatial covariance for each gene beyond this effect, log total count values are regressed out from the Anscombe-transformed expression values before fitting the spatial models.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Reporting summary</label>
      <media xlink:href="NIHMS76395-supplement-Reporting_summary.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1675" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Supplementary figures</label>
      <media xlink:href="NIHMS76395-supplement-Supplementary_figures.docx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1679" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Supplementary note 1</label>
      <media xlink:href="NIHMS76395-supplement-Supplementary_note_1.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1683" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>Supplementary software</label>
      <media xlink:href="NIHMS76395-supplement-Supplementary_software.zip" mimetype="application" mime-subtype="zip" orientation="portrait" xlink:type="simple" id="d36e1687" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>Supplementary table 1</label>
      <media xlink:href="NIHMS76395-supplement-Supplementary_table_1.xlsx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1691" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S14">
    <title>Acknowledgements</title>
    <p>The authors wish to thank Damien Arnol and Francesco Paolo Casale for helpful advice on statistics and data normalization. Jeffrey Moffitt helped us understand the data format for available MERFISH data. In addition, we are thankful to Aarun Lun, Martin Hemberg, Daniel Kunz, and Kerstin Meyer for feedback on the manuscript. V.S. was supported by the EMBL International PhD Program, S.A.T. was supported by the Wellcome Trust and ERC Consolidator Grant “ThDEFINE”, O.S. received funding from EMBL core funding, the Wellcome Trust and the EU.</p>
  </ack>
  <fn-group>
    <fn id="FN1">
      <p id="P36">
        <bold>Code availability</bold>
      </p>
      <p id="P37">An open source implementation of SpatialDE is available from <ext-link ext-link-type="uri" xlink:href="https://github.com/Teichlab/SpatialDE">https://github.com/Teichlab/SpatialDE</ext-link>. The release includes tutorials and example vignettes for reproducing the presented analyses, as well as all pre-processed datasets considered in this study. The software version used to generate the results as presented in this manuscript is also available as <xref ref-type="supplementary-material" rid="SD4">Supplementary Software</xref>.</p>
    </fn>
    <fn id="FN2">
      <p id="P38">
        <bold>Data availability</bold>
      </p>
      <p id="P39">In addition to data sources mentioned above, all data used for analysis is available from <ext-link ext-link-type="uri" xlink:href="https://github.com/Teichlab/SpatialDE">https://github.com/Teichlab/SpatialDE</ext-link> using git-lfs. All results from analysis are reported in <xref ref-type="supplementary-material" rid="SD5">Supplementary Table 1</xref>.</p>
    </fn>
    <fn fn-type="con" id="FN3">
      <p id="P40">
        <bold>Author contributions</bold>
      </p>
      <p id="P41">V.S., O.S., conceived the method. V.S. implemented the method and generated the results. V.S., S.A.T, O.S. interpreted the results. V.S., S.A.T, O.S. wrote the paper.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN4">
      <p id="P42">
        <bold>Competing financial interests</bold>
      </p>
      <p id="P43">The authors declare no financial conflicts of interest.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>JH</given-names>
          </name>
        </person-group>
        <article-title>Quantitative approaches for investigating the spatial context of gene expression</article-title>
        <source>Wiley Interdiscip Rev Syst Biol Med</source>
        <year>2017</year>
        <volume>9</volume>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Achim</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-throughput spatial mapping of single-cell RNA-seq data to tissue of origin</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>503</fpage>
        <lpage>509</lpage>
        <pub-id pub-id-type="pmid">25867922</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Junker</surname>
            <given-names>JP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide RNA Tomography in the zebrafish embryo</article-title>
        <source>Cell</source>
        <year>2014</year>
        <volume>159</volume>
        <fpage>662</fpage>
        <lpage>675</lpage>
        <pub-id pub-id-type="pmid">25417113</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomic analysis of cryosectioned tissue samples with Geo-seq</article-title>
        <source>Nat Protoc</source>
        <year>2017</year>
        <volume>12</volume>
        <fpage>566</fpage>
        <lpage>580</lpage>
        <pub-id pub-id-type="pmid">28207000</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>353</volume>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shah</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lubeck</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>In Situ Transcription Profiling of Single Cells Reveals Spatial Organization of Cells in the Mouse Hippocampus</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>92</volume>
        <fpage>342</fpage>
        <lpage>357</lpage>
        <pub-id pub-id-type="pmid">27764670</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-throughput single-cell gene-expression profiling with multiplexed error-robust fluorescence in situ hybridization</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>11046</fpage>
        <lpage>11051</lpage>
        <pub-id pub-id-type="pmid">27625426</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brennecke</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Accounting for technical noise in single-cell RNA-seq experiments</article-title>
        <source>Nat Methods</source>
        <year>2013</year>
        <volume>10</volume>
        <fpage>1093</fpage>
        <lpage>1095</lpage>
        <pub-id pub-id-type="pmid">24056876</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pettit</surname>
            <given-names>J-B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identifying cell types from spatially referenced single-cell expression datasets</article-title>
        <source>PLoS Comput Biol</source>
        <year>2014</year>
        <volume>10</volume>
        <fpage>e1003824</fpage>
        <pub-id pub-id-type="pmid">25254363</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lippert</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FaST linear mixed models for genome-wide association studies</article-title>
        <source>Nat Methods</source>
        <year>2011</year>
        <volume>8</volume>
        <fpage>833</fpage>
        <lpage>835</lpage>
        <pub-id pub-id-type="pmid">21892150</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jahn</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Takamori</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rhee</surname>
            <given-names>JS</given-names>
          </name>
          <name>
            <surname>Rosenmund</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <source>Nature</source>
        <year>2000</year>
        <volume>407</volume>
        <fpage>189</fpage>
        <lpage>194</lpage>
        <comment>10.1038/35025070</comment>
        <pub-id pub-id-type="pmid">11001057</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Seewaldt</surname>
            <given-names>VL</given-names>
          </name>
        </person-group>
        <article-title>Cancer: Destiny from density</article-title>
        <source>Nature</source>
        <year>2012</year>
        <volume>490</volume>
        <fpage>490</fpage>
        <lpage>491</lpage>
        <pub-id pub-id-type="pmid">23099400</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reimand</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>g:Profiler-a web server for functional interpretation of gene lists (2016 update)</article-title>
        <source>Nucleic Acids Res</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>W83</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="pmid">27098042</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andrews</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Modelling dropouts allows for unbiased identification of marker genes in scRNASeq experiments</article-title>
        <source>bioRxiv</source>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>KH</given-names>
          </name>
          <name>
            <surname>Boettiger</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Zhuang</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>RNA imaging. Spatially resolved, highly multiplexed RNA profiling in single cells</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>348</volume>
        <comment>aaa6090</comment>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Battich</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Stoeger</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Pelkmans</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Control of Transcript Variability in Single Mammalian Cells</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>163</volume>
        <fpage>1596</fpage>
        <lpage>1610</lpage>
        <pub-id pub-id-type="pmid">26687353</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Owens</surname>
            <given-names>NDL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Measuring Absolute RNA Copy Numbers at High Temporal Resolution Reveals Transcriptome Kinetics in Development</article-title>
        <source>Cell Rep</source>
        <year>2016</year>
        <volume>14</volume>
        <fpage>632</fpage>
        <lpage>647</lpage>
        <pub-id pub-id-type="pmid">26774488</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalaitzis</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Lawrence</surname>
            <given-names>ND</given-names>
          </name>
        </person-group>
        <article-title>A simple approach to ranking differentially expressed gene expression time courses through Gaussian process regression</article-title>
        <source>BMC Bioinformatics</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>180</fpage>
        <pub-id pub-id-type="pmid">21599902</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durrande</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Hensman</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rattray</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lawrence</surname>
            <given-names>ND</given-names>
          </name>
        </person-group>
        <source>Detecting periodicities with Gaussian processes</source>
        <year>2016</year>
        <pub-id pub-id-type="doi">10.7717/peerj-cs.50</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Rasmussen</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>CKI</given-names>
          </name>
        </person-group>
        <source>Gaussian Processes for Machine Learning</source>
        <publisher-name>MIT Press</publisher-name>
        <year>2006</year>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Stephens</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Genome-wide efficient mixed-model analysis for association studies</article-title>
        <source>Nat Genet</source>
        <year>2012</year>
        <volume>44</volume>
        <fpage>821</fpage>
        <lpage>824</lpage>
        <pub-id pub-id-type="pmid">22706312</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Statistical significance for genomewide studies</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <year>2003</year>
        <volume>100</volume>
        <fpage>9440</fpage>
        <lpage>9445</lpage>
        <pub-id pub-id-type="pmid">12883005</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Bishop</surname>
            <given-names>CM</given-names>
          </name>
        </person-group>
        <source>Pattern recognition and machine learning</source>
        <publisher-name>springer</publisher-name>
        <year>2006</year>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alexander Wolf</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Scanpy for analysis of large-scale single-cell gene expression data</article-title>
        <source>bioRxiv</source>
        <year>2017</year>
        <comment>174029</comment>
        <pub-id pub-id-type="doi">10.1101/174029</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Krige</surname>
            <given-names>DG</given-names>
          </name>
        </person-group>
        <article-title>A statistical approach to some basic mine valuation problems on the Witwatersrand</article-title>
        <source>J South Afr Inst Min Metall</source>
        <year>1951</year>
        <volume>52</volume>
        <fpage>119</fpage>
        <lpage>139</lpage>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A robust Bayesian two-sample test for detecting intervals of differential gene expression in microarray time series</article-title>
        <source>J Comput Biol</source>
        <year>2010</year>
        <volume>17</volume>
        <fpage>355</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="pmid">20377450</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lönnberg</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq and computational analysis using temporal mixture modeling resolves TH1/TFH fate bifurcation in malaria</article-title>
        <source>Science Immunology</source>
        <year>2017</year>
        <volume>2</volume>
        <comment>eaal2192</comment>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kalaitzis</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Lawrence</surname>
            <given-names>ND</given-names>
          </name>
        </person-group>
        <article-title>A simple approach to ranking differentially expressed gene expression time courses through Gaussian process regression</article-title>
        <source>BMC Bioinformatics</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>180</fpage>
        <pub-id pub-id-type="pmid">21599902</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Äijö</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Methods for time series analysis of RNA-seq data with application to human Th17 cell differentiation</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <fpage>i113</fpage>
        <lpage>20</lpage>
        <pub-id pub-id-type="pmid">24931974</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macaulay</surname>
            <given-names>IC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-Cell RNA-Sequencing Reveals a Continuous Spectrum of Differentiation in Hematopoietic Cells</article-title>
        <source>Cell Rep</source>
        <year>2016</year>
        <volume>14</volume>
        <fpage>966</fpage>
        <lpage>977</lpage>
        <pub-id pub-id-type="pmid">26804912</pub-id>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eckersley-Maslin</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MERVL/Zscan4 Network Activation Results in Transient Genome-wide DNA Demethylation of mESCs</article-title>
        <source>Cell Rep</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>179</fpage>
        <lpage>192</lpage>
        <pub-id pub-id-type="pmid">27681430</pub-id>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lloyd</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Duvenaud</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Grosse</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Tenenbaum</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Ghahramani</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Automatic Construction and Natural-Language Description of Nonparametric Regression Models</article-title>
        <source>arXiv [stat.ML]</source>
        <year>2014</year>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <boxed-text id="BX1" position="float" orientation="portrait">
    <caption>
      <title>Editor’s Summary</title>
    </caption>
    <p>SpatialDE identifies genes with significant spatial expression patterns from multiplexed imaging or spatial RNA sequencing data, and can cluster genes with similar spatial patterns as a form of expression-based tissue histology.</p>
  </boxed-text>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>Overview of SpatialDE for the identification of spatially variable genes.</title>
      <p>(<bold>A</bold>) In spatial gene expression studies, expression levels are measured as a function of spatial coordinates of cells or samples. SpatialDE defines spatial dependence for a given gene using a non-parametric regression model, testing whether gene expression levels at different locations co-vary in a manner that depends on their relative location, and thus are <italic>spatially variable</italic>. (<bold>B</bold>) SpatialDE partitions expression variation into a spatial component (using functional dependencies <italic>f</italic>(<italic>x</italic><sub>1</sub>, <italic>x</italic><sub>2</sub>)), characterized by spatial covariance, and independent observation noise (<italic>ψ</italic>). Representative simulated expression patterns are plotted below the corresponding covariance matrices for the null model (None) and the alternative model (Spatial covariance) with different lengthscales. (<bold>C</bold>) Automatic expression histology uses spatial clustering to model the expression levels of spatially variable genes using a set of unobserved tissue structure patterns. Both the underlying patterns and the gene-pattern assignments are learned from data.</p>
    </caption>
    <graphic xlink:href="emss-76395-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Application of SpatialDE to spatial transcriptomics and SeqFISH data.</title>
      <p>(<bold>A</bold>) Fraction of variance explained by spatial variation (FSV) versus significance of spatial variation (SpatialDE negative log P-value) for all genes in the mouse olfactory bulb data. Dashed line corresponds to FDR=0.05 significance level (N=67 SV genes, Q-value adjusted). Genes are classified as periodically variable (N=19) or with a general spatial dependency (N=48). Classical histological marker genes highlighted in Stahl et al are in red text. Point size indicates uncertainty of FSV estimates; CI, confidence intervals. The X symbol shows the result of applying SpatialDE to the estimated total RNA content per spot. (<bold>B</bold>) Hematoxylin and eosin image for mouse olfactory bulb data from Stahl <italic>et al</italic>. (<bold>C</bold>) Visualization of selected SV genes. Orange bar shows fitted period length for genes with periodic dependencies; blue bar shows fitted length scale for genes with general spatial trends. 2D plots depict expression level for genes across the tissue section coded in color. Asterisks denote statistical significance of spatial variation (* FDR &lt; 0.05, ** FDR &lt; 0.01, *** FDR &lt; 0.001). Insets in lower left show the posterior probability for gene assignments as general spatial, periodic spatial, or linear trend. (<bold>D</bold>) Example histological expression patterns identified by automatic expression histology analysis, with expression levels encoded in color. The number of genes assigned to each pattern are noted. (<bold>E</bold>) Proportion of spatial variance versus significance of spatial variation (SpatialDE negative log P-value) for all 249 genes in the SeqFISH data from a region of mouse hippocampus from Shah <italic>et al<xref rid="R7" ref-type="bibr">7</xref></italic>, as in <bold>A</bold>, showing genes with linear dependency in green. (<bold>F</bold>) Voronoi tessellation representative of tissue structure. (<bold>G</bold>) Expression of selected SV genes (out of 32, FDR &lt; 0.05, Q-value adjusted) with linear (<italic>htr3a</italic>), periodic (<italic>foxj1</italic>), and general spatial trends. Black arrows indicate distinct region of low expression of <italic>Mog</italic>, <italic>Myl14</italic> and <italic>Ndnf</italic>. (<bold>H</bold>) Three examples of histological expression patterns identified by AEH.</p>
    </caption>
    <graphic xlink:href="emss-76395-f002"/>
  </fig>
</floats-group>
