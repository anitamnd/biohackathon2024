<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">J Appl Crystallogr</journal-id>
    <journal-id journal-id-type="iso-abbrev">J Appl Crystallogr</journal-id>
    <journal-id journal-id-type="publisher-id">J. Appl. Cryst.</journal-id>
    <journal-title-group>
      <journal-title>Journal of Applied Crystallography</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0021-8898</issn>
    <issn pub-type="epub">1600-5767</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6878877</article-id>
    <article-id pub-id-type="publisher-id">yr5050</article-id>
    <article-id pub-id-type="doi">10.1107/S1600576719012044</article-id>
    <article-id pub-id-type="coden">JACGAR</article-id>
    <article-id pub-id-type="pii">S1600576719012044</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Computer Programs</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>DatView</italic>: a graphical user interface for visualizing and querying large data sets in serial femtosecond crystallography</article-title>
      <alt-title>
        <italic>DatView</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Stander</surname>
          <given-names>Natasha</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fromme</surname>
          <given-names>Petra</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0003-1757-0205</contrib-id>
        <name>
          <surname>Zatsepin</surname>
          <given-names>Nadia</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
        <xref ref-type="aff" rid="c">c</xref>
        <xref ref-type="aff" rid="d">d</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label>School of Molecular Sciences, Arizona State University, Tempe, AZ 85287, <country>USA</country></aff>
      <aff id="b"><label>b</label>Biodesign Center for Applied Structural Discovery, Arizona State University, Tempe, AZ 85287, <country>USA</country></aff>
      <aff id="c"><label>c</label>Department of Physics, Arizona State University, Tempe, AZ 85287, <country>USA</country></aff>
      <aff id="d"><label>d</label>ARC Centre of Excellence in Advanced Molecular Imaging, Department of Chemistry and Physics, La Trobe Institute for Molecular Science, La Trobe University, Victoria 3086, <country>Australia</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>n.zatsepin@latrobe.edu.au</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>12</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>31</day>
      <month>10</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>10</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>52</volume>
    <issue>Pt 6</issue>
    <issue-id pub-id-type="publisher-id">j190600</issue-id>
    <fpage>1440</fpage>
    <lpage>1448</lpage>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>4</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>8</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Natasha Stander et al. 2019</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution (CC-BY) Licence, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://creativecommons.org/licenses/by/4.0/</ali:license_ref>
      </license>
    </permissions>
    <self-uri xlink:href="https://doi.org/10.1107/S1600576719012044">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p><italic>DatView</italic> is a new graphical user interface for simplifying analysis by facilitating plotting parameters and exporting selections from large serial crystallography data sets.</p>
    </abstract>
    <abstract>
      <p><italic>DatView</italic> is a new graphical user interface (GUI) for plotting parameters to explore correlations, identify outliers and export subsets of data. It was designed to simplify and expedite analysis of very large unmerged serial femtosecond crystallography (SFX) data sets composed of indexing results from hundreds of thousands of microcrystal diffraction patterns. However, <italic>DatView</italic> works with any tabulated data, offering its functionality to many applications outside serial crystallography. In <italic>DatView</italic>’s user-friendly GUI, selections are drawn onto plots and synchronized across all other plots, so correlations between multiple parameters in large multi-parameter data sets can be rapidly identified. It also includes an item viewer for displaying images in the current selection alongside the associated metadata. For serial crystallography data processed by <italic>indexamajig</italic> from <italic>CrystFEL</italic> [White, Kirian, Martin, Aquila, Nass, Barty &amp; Chapman (2012<xref ref-type="bibr" rid="bb24"> ▸</xref>). <italic>J. Appl. Cryst.</italic>
<bold>45</bold>, 335–341], <italic>DatView</italic> generates a table of parameters and metadata from stream files and, optionally, the associated HDF5 files. By combining the functionality of several commonly needed tools for SFX in a single GUI that operates on tabulated data, the time needed to load and calculate statistics from large data sets is reduced. This paper describes how <italic>DatView</italic> facilitates (i) efficient feedback during data collection by examining trends in time, sample position or any parameter, (ii) determination of optimal indexing and integration parameters via the comparison mode, (iii) identification of systematic errors in unmerged SFX data sets, and (iv) sorting and highly flexible data filtering (plot selections, Boolean filters and more), including direct export of subset <italic>CrystFEL</italic> stream files for further processing.</p>
    </abstract>
    <kwd-group>
      <kwd>serial femtosecond crystallography</kwd>
      <kwd>visualization</kwd>
      <kwd>X-ray free-electron lasers</kwd>
      <kwd>data analysis</kwd>
      <kwd>graphical user interfaces</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>National Science Foundation</funding-source>
        <award-id>1231306</award-id>
        <award-id>1565180</award-id>
        <principal-award-recipient>Natasha Stander</principal-award-recipient>
        <principal-award-recipient>Petra Fromme</principal-award-recipient>
        <principal-award-recipient>Nadia Zatsepin</principal-award-recipient>
        <principal-award-recipient>Natasha Stander</principal-award-recipient>
        <principal-award-recipient>Nadia Zatsepin</principal-award-recipient>
      </award-group>
      <funding-statement>This work was funded by <funding-source>National Science Foundation</funding-source> grants <award-id>1231306</award-id> and <award-id>1565180</award-id>. </funding-statement>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="introduction" id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>Serial femtosecond crystallography (SFX) at X-ray free-electron lasers (XFELs) is a recent innovation in macromolecular crystallography where structures are determined from thousands of snapshot diffraction patterns from nano/microcrystals delivered to a pulsed XFEL beam in a serial fashion. The short (femtosecond) pulse duration diminishes the effect of radiation damage on the data because each crystal is exposed only once in a diffraction-before-destruction approach (Neutze <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb17"> ▸</xref>; Chapman <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb5"> ▸</xref>; Spence, 2017<xref ref-type="bibr" rid="bb19"> ▸</xref>). To account for shot-to-shot variation in both crystals and the XFEL beam, SFX data sets are often large, with up to hundreds of thousands of diffraction patterns. These large data sets are typically reprocessed many times with software such as <italic>CrystFEL</italic> (White <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb24"> ▸</xref>) or <italic>cctbx.xfel</italic> (Hattne <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb11"> ▸</xref>) to find optimum indexing, integration and merging parameters. Data visualization is an important guide for this optimization, as well as for optimal data collection. While tools such as <italic>cell_explorer</italic> (White, Mariani <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb25"> ▸</xref>), the <italic>Data Exploration Toolkit</italic> (Zeldin <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb27"> ▸</xref>) and <italic>cxiview</italic> (Barty <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb3"> ▸</xref>) exist to give feedback during data collection and processing, up to now there has been no unified graphical user interface (GUI) for interactive visualization of SFX data sets.</p>
    <p><italic>DatView</italic>’s unified GUI increases the power of the program to explore correlations between many parameters simultaneously, export selections and compare the effects of different processing approaches. It loads any text table where each column is a parameter and each row an item. Through the GUI, users select parameters to plot and then make selections directly on the plots. Selections on one plot are synchronized to all other plots, showing the current selection as opaque and the full data set as semi-transparent. An item viewer displays the items in the current selection and supports selections on an item-by-item basis. The available plots and options are described in detail in Section 3<xref ref-type="sec" rid="sec3"/>.</p>
    <p>An important extension to data visualization is exporting the selection for further processing. This enables outlier rejection [motivated by Diederichs &amp; Karplus (2013<xref ref-type="bibr" rid="bb6"> ▸</xref>) and Assmann <italic>et al.</italic> (2016<xref ref-type="bibr" rid="bb1"> ▸</xref>)], obtaining a consistent subset for advanced processing (Kabsch, 2014<xref ref-type="bibr" rid="bb12"> ▸</xref>; White, 2014<xref ref-type="bibr" rid="bb21"> ▸</xref>; Ginn <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb10"> ▸</xref>; Uervirojnangkoorn <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb20"> ▸</xref>) or splitting the data set into user-defined bins (Foadi <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb8"> ▸</xref>; Barends <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb2"> ▸</xref>; Zeldin <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb27"> ▸</xref>). <italic>DatView</italic> has three available export formats for selections: (i) a text table, the <italic>DatView</italic> input format (<monospace>.dat</monospace>), (ii) a file list (<monospace>.lst</monospace>) and (iii) <italic>CrystFEL</italic> unmerged indexing output, called a stream file, which contains each pattern’s partially integrated reflections, unit cell, orientation, diffraction resolution and peaks used for indexing, with the associated indexing and integration parameters, and other metadata (<monospace>.stream</monospace>) (White <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb24"> ▸</xref>). Export options are described in Section 4<xref ref-type="sec" rid="sec4"/>.</p>
    <p><italic>DatView</italic> has a comparison mode to support frame-by-frame parameter optimization, similarly to <italic>IOTA</italic> (Lyubimov <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb15"> ▸</xref>). For the comparison mode, multiple input tables (indexing results from different indexing conditions, for example) are combined with information about which diffraction patterns are equivalent across the different input files. From the GUI, users can plot the value of a parameter from one input table against the same parameter from the equivalent pattern of a different input table. Users can then export a data set optimized with respect to a chosen output parameter (<italic>e.g.</italic> diffraction resolution) by using the minimum or maximum filter available in <italic>DatView</italic>’s comparison mode. A new stream file is written, containing the optimal indexing result for each crystal, extracted from the multiple stream files from the multiple indexing attempts. The comparison mode is described in Section 5<xref ref-type="sec" rid="sec5"/>.</p>
    <p><italic>DatView</italic> is a standalone program. It is written in Python 3 and available from <ext-link ext-link-type="uri" xlink:href="https://github.com/nstander/DatView">https://github.com/nstander/DatView</ext-link>, with documentation at <ext-link ext-link-type="uri" xlink:href="https://zatsepinlab.atlassian.net/wiki/spaces/DAT/overview">https://zatsepinlab.atlassian.net/wiki/spaces/DAT/overview</ext-link>. It uses the PyQt, matplotlib, NumPy, SciPy, h5py, pyqtgraph and lxml libraries. It additionally uses a modified geometry file parser from the CfelPyUtils library and the histogram clip functionality of <italic>cxiview</italic>, which are both included with the code.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Input   </title>
    <p><italic>DatView</italic> loads text tables, so it can be used for many types of data set, although a preprocessing step may be required. For <italic>CrystFEL</italic> stream files or list files, the script <monospace>datgen.py</monospace> writes a table with parameters from the input file(s) and, optionally, parameters from HDF5/CXI image files or NumPy arrays. This table is the input for <italic>DatView</italic>. The optional parameters make it easy to include information like time stamps, XFEL pulse durations and sample information in the table. The table is an index into both the stream file and the image file, allowing the item viewer to display the images from the image file and overlay found and predicted peaks from the stream file. Table files can be combined, so preprocessing can be run in parallel for individual input stream files, and streams do not need to be duplicated in a single large stream file for display and calculation of basic statistics. The table index is generally smaller than the input stream files, which reduces the loading time of <italic>DatView</italic> compared with programs like <italic>cxiview</italic> (Barty <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb3"> ▸</xref>) or <italic>cell_explorer</italic> (White, Mariani <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb25"> ▸</xref>) (see Table 1<xref ref-type="table" rid="table1"> ▸</xref> for a comparison). However, the update time in the GUI will depend on the size of the input file and the number of plots. <italic>DatView</italic> is slower than <italic>cell_explorer</italic> because <italic>DatView</italic> is written in Python 3 rather than C (as is the case for <italic>cell_explorer</italic>) and is typically managing more parameters.</p>
    <p>Preprocessing scripts have also been developed for Pandas HDF5 spectroscopy files at PAL-XFEL (Ko <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb13"> ▸</xref>) [used in Fig. 4(<italic>b</italic>)] and for serial crystallography hit finding on the Frontier Microfocusing Macromolecular Crystallography (FMX) beamline at NSLS-II (Fuchs <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb9"> ▸</xref>), where data are collected on an EIGER 16M detector (Könnecke <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb14"> ▸</xref>; Casanas <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb4"> ▸</xref>). Data from NSLS-II are used in Figs. 1<xref ref-type="fig" rid="fig1"> ▸</xref> and 6. In addition to formatting the data as a text table, the external configuration file may need to be edited. The external configuration file describes the data type of each parameter so it can be loaded by NumPy, and is necessary for any data containing non-numeric fields. It also allows the configuration of many other parameters such as color maps, default histograms and displays in the item viewer. The preprocessing script and configuration file for Pandas HDF5 spectroscopy files at PAL-XFEL are shipped with <italic>DatView</italic>, and NSLS-II files are linked to from <italic>DatView</italic>’s GitHub page.</p>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Data visualization   </title>
    <p><italic>DatView</italic> provides synchronized interactive plots and an item viewer. The main window contains histograms, three per row, with additional rows appearing as needed [<italic>e.g.</italic> Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>a</italic>)]. The default histograms to open are given in the external configuration file. For SFX, the unit-cell parameters are opened by default. Additional plots are available from the plot menu and detailed below. The suggested parameters for those plots are also configurable, and for SFX are set to relevant parameters such as the predicted detector shifts and the unit-cell volume against sorted order. Options such as the stacking and colors of histograms can be configured in the control panel available from the View menu [Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>b</italic>)]. The item viewer (Section 3.3<xref ref-type="sec" rid="sec3.3"/> and Fig. 4) is also available from the View menu. Exporting (Section 4<xref ref-type="sec" rid="sec4"/>) is part of the File menu.</p>
    <sec id="sec3.1">
      <label>3.1.</label>
      <title>Synchronization   </title>
      <p><italic>DatView</italic> synchronizes the current selection to all plots, making it easy to simultaneously visualize correlations across any number of parameters on multiple plots in one, two and three dimensions. For SFX, this can facilitate solving problems like the determination of the correct beam center. As an example, SFX data from the Coherent X-ray Imaging Data Bank (CXIDB) (Maia, 2012<xref ref-type="bibr" rid="bb16"> ▸</xref>), data set ID 40 (Fenalti <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>; White, Barty <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb23"> ▸</xref>), were re-indexed with <italic>CrystFEL</italic> Version 0.7.0 with an incorrect beam center and no unit-cell constraints. This represents the start of an experiment where the exact geometry is often not known, but can be roughly estimated from indexing (typically some well known calibration sample) (White, 2019<xref ref-type="bibr" rid="bb22"> ▸</xref>). <italic>DatView</italic> opens the table generated by <monospace>datgen.py</monospace> with histograms of the six unit-cell parameters stacked by centering (<italic>C</italic> centered is blue, <italic>P</italic> centered is black), as shown in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>a</italic>), similarly to <italic>CrystFEL</italic>’s <italic>cell_explorer</italic> (White, Mariani <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb25"> ▸</xref>). Multiple peaks or very noisy unit-cell distributions are commonly a sign that the geometry is inaccurate.</p>
      <p>A 2D histogram (where the coloring is by density) can be generated from the Plot menu [Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>b</italic>)], with the predicted detector shift in <italic>x</italic> and <italic>y</italic> selected as the horizontal and vertical axes for the plot, respectively, akin to that produced by the <italic>CrystFEL</italic> script <italic>detector-shift</italic>. The distribution of predicted detector shifts in this example is noisy, with multiple peaks. Here, <italic>DatView</italic>’s synchronized plots are useful because users can select regions from the unit-cell distributions with Shift + click and drag, and the detector-shift plot updates accordingly, thus quickly identifying what detector center correction needs to be applied to increase the indexing yield with the correct unit cell. Selecting regions corresponding to the expected unit cell [Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>c</italic>)] gives Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>d</italic>), emphasizing the peak near (−0.3, 0.4) which was the offset used in this example.</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2.</label>
      <title>Interactivity   </title>
      <p>The interactivity of the plots also aids in data visualization. Histogram and 2D histogram binning can be changed from the context menu or with the keyboard shortcuts ‘+’ and ‘−’. Continuing the current example of determining the correct beam center, increasing the binning on the example detector-shift plot shown in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>d</italic>) clarifies that there are two distinct clusters, as shown in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>a</italic>). At this point, the user could select directly from the predicted detector-shift plot (shift + click and drag) to limit the selection to just one of the clusters and look for correlations in other variables. However, given that a change in beam center is often the result of a change in the experiment at a particular point in time, another logical step would be to plot the detector shift over time.</p>
      <p>Scatter plots can be created from the plot menu with any parameters for the <italic>x</italic> and <italic>y</italic> axes and the color. To plot the detector shift over time, the predicted detector shift in <italic>x</italic> (since it appears larger than the shift in <italic>y</italic>) is used for the <italic>y</italic> axis, the current sort order is used for the <italic>x</italic> axis and the run number is used for color. The current sort order is configurable from the control panel, but will initially be the same as the file order. To sort in order of data collection (time), the image file name was used because the date and time are part of the file names for the example data. In the initial plot shown in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>b</italic>), it is hard to see a clear shift because with over 100 000 patterns in the semi-transparent full data set the 9868 patterns correctly indexed in the opaque data set are not distinguishable. All plots in <italic>DatView</italic> can be changed to show only the current selection or the full data set (ignoring the current selection). Plotting just the current selection simplifies the plot [Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>c</italic>)], revealing an obvious change in the <italic>x</italic> shift.</p>
      <p>All plots in <italic>DatView</italic> allow zooming with the scroll wheel and panning with click and drag. Additional information about data under the cursor is also available from the tooltips. By manipulating the example plot in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>c</italic>), it can be determined that the shift occurs around pattern 53 500, which is approximately the break between runs 144 and 146. This may be correlated with changes in the experimental setup, such as the start of a new shift, changes in the XFEL beam that made realignment necessary, or a different sample-to-detector distance where the detector rails are slightly misaligned from the optical axis, as has been observed on a number of beamlines. Users may decide from this information to use a different beam center for the first part of the data set than for the second part.</p>
    </sec>
    <sec id="sec3.3">
      <label>3.3.</label>
      <title>Item viewer   </title>
      <p>Selections are also synchronized to an item viewer. The item viewer (Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>) has two panels. On the left is a list of all statistics and metadata in the input table for a particular row. On the right is a frame viewer that can display 1D or 2D data from HDF5/CXI files as scatter plots or images, respectively [see Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>(<italic>b</italic>) for readouts from an area detector and two photodiodes from a PAL-XFEL spectroscopy data set]. For diffraction data [Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>(<italic>a</italic>)], the viewer is similar to <italic>cxiview</italic> (Barty <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb3"> ▸</xref>) and can overlay found and predicted peaks from the stream file. The tooltip hover text displays the <italic>x</italic> and <italic>y</italic> coordinates and pixel value, as well as the resolution and Miller index, if known. Previous, Play and Next buttons provide a simple interface for viewing images in the current selection, and the flag check box allows changing the current selection. As an example, sometimes ice rings make the apparent diffraction resolution limit of a pattern abnormally high. The user could select the highest diffracting patterns from a histogram of the apparent diffraction resolution limit in the main window and then play through them in the item viewer, flagging frames that contain ice rings. Then, from the control panel, the user can set the selection to exclude any flagged items (or only include flagged items) to update the plots with statistics only from the clean data set.</p>
    </sec>
    <sec id="sec3.4">
      <label>3.4.</label>
      <title>Other plots   </title>
      <p>Of the five plot types currently available in <italic>DatView</italic>, three have already been introduced in the previous examples: histograms, 2D histograms and scatter plots. The remaining two plot types are pixel plots and aggregated plots. Pixel plots were developed for visualizing data from microcrystals on a fixed target that is raster scanned across the beam. Two examples are shown in Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref> from data collected from membrane protein microcrystals on micropatterned silicon chips mounted on the high-speed Roadrunner goniometer (Roedig <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb18"> ▸</xref>) (unpublished data). The color of the pixel at position (<italic>x</italic>, <italic>y</italic>) is determined by a user-selected parameter, which was the unit-cell <italic>a</italic> axis in this example. Data collection began at the bottom of the chip, so the large change in the <italic>a</italic> axis in Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>(<italic>a</italic>) compared with Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>(<italic>b</italic>) could indicate temperature or humidity changes during data collection. Such feedback during data collection can help optimize the experimental setup and make the best use of beamtime.</p>
      <p>Aggregated plots bin one of the axes and display a calculated statistic of the bin on the second axis. For example, users can bin the data by run number and plot the average unit-cell volume of each bin, with optional standard-deviation error bars. A second dimension of binning can be added by splitting the data into multiple lines. An example is described in Section 5.1<xref ref-type="sec" rid="sec5.1"/> and shown in Fig. 7(<italic>a</italic>).</p>
    </sec>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Export   </title>
    <p>While data visualization on its own is very useful to guide data-collection strategies and data processing, the data-export options in <italic>DatView</italic> are anticipated to be most useful for many users because they enable users to save the current selection for further processing, applying sorting and binning in a flexible and user-friendly way.</p>
    <sec id="sec4.1">
      <label>4.1.</label>
      <title>Export formats   </title>
      <p>There are three available export formats: table, file list and <italic>CrystFEL</italic> stream file. The first is the input table format but outputting only the rows from the current selection. The second is a file list of image file names with one file name per line. For multiple-event HDF5/CXI image files, the event numbers are output following <italic>CrystFEL</italic> convention with ‘<monospace>//</monospace>’ separating the file name and event number on each line. This format can be used as input to <italic>CrystFEL</italic> auto-indexing. The final format is a <italic>CrystFEL</italic> stream file that can be used with <italic>CrystFEL</italic> merging programs (White <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb24"> ▸</xref>; White, Mariani <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb25"> ▸</xref>). The stream file output is only available with tables generated from stream files because it uses the index into the stream file to copy the text for each selected crystal into a new file. The stream file output will not match the <italic>CrystFEL</italic> convention for stream file(s) with multiple crystals for a frame because <italic>DatView</italic> repeats all frame information for each crystal. This convention is necessary to be able to select individual crystals from a multi-crystal frame and for sorting.</p>
    </sec>
    <sec id="sec4.2">
      <label>4.2.</label>
      <title>Export options   </title>
      <p>There are three main export options: sort, limit and partition [Figs. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>a</italic>)–6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>c</italic>)]. The exported selection follows the current sort order [Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>b</italic>)]. The sorted output enables users to try different cutoffs in <italic>CrystFEL</italic> merging programs using start-after and stop-after options, instead of duplicating information into many potential input files. There is also a limit option [Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>c</italic>)] so that users can export just the first <italic>N</italic> patterns of the current sort order. Alternatively, the limit can be used to select a random subset of size <italic>N</italic> from the current selection. This is useful if the user wishes to compare the results of different selections with equivalent numbers of patterns. Finally, partitions [Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>a</italic>)] enable users to bin data by any parameter and create a different output file for each bin. For instance, a European XFEL data set could be partitioned by pulse ID in the train of pulses to check for systematic changes (Wiedorn <italic>et al.</italic>, 2018<xref ref-type="bibr" rid="bb26"> ▸</xref>) or to separate pulses before and after laser illumination for time-resolved pump–probe SFX.</p>
    </sec>
    <sec id="sec4.3">
      <label>4.3.</label>
      <title>Advanced selections   </title>
      <p><italic>DatView</italic> provides an interface for specifying exact cutoffs of selections for improved precision compared with drawing the cutoffs on a plot. These controls are available through the filter section of the control panel shown in Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>d</italic>). Plots are automatically connected to filters, so selecting a range on a plot is equivalent to typing that range into the filter interface. Any selection drawn onto a plot is represented with a ‘between’ filter because it enforces values on that parameter that are between the given minimum and maximum.</p>
      <p>The filter interface includes additional controls for more complex selections. As an example, the user may want to select high-resolution patterns from the beginning and end of the data, avoiding a problematic section in the middle. As a combination of Boolean and relational operators, the desired result may look like this: (high resolution AND (pattern number &lt; 2000 OR pattern number <inline-formula><inline-graphic xlink:href="j-52-01440-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>)). Filters in <italic>DatView</italic> are represented as a tree, with each layer of parentheses represented by a nested layer in the tree. Nodes of the tree with children are the AND or OR operators that determine how the child nodes are combined. As an example, the condition above is shown in Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>(<italic>d</italic>).</p>
      <p>Leaf-node filters operate on the data. Three of these filters have already been mentioned: ‘between’, ‘less than’ and ‘greater than or equal to.’ A fourth available operator is <inline-formula><inline-graphic xlink:href="j-52-01440-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (in the set of), which is available for categorical variables. It displays possible values (categories) and the user can toggle each value’s inclusion individually. As an example, in the CXIDB ID 40 data set indexed with the incorrect beam center described above, there were two possible cell centerings (<italic>C</italic> and <italic>P</italic>), as seen in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>a</italic>). There is a third possibility of no cell centering for patterns that were not indexed. An ‘in’ filter displays a drop down with these three possible centerings and the user can toggle each possible value individually. Additional filters are unique to the comparison mode and described in Section 5.2<xref ref-type="sec" rid="sec5.2"/>.</p>
    </sec>
  </sec>
  <sec id="sec5">
    <label>5.</label>
    <title>Comparison mode   </title>
    <p>For advanced users and developers, <italic>DatView</italic> has a unique feature called comparison mode for visualizing the changes in parameters from different data-processing approaches. This requires a preprocessing script, <monospace>datcompare.py</monospace>, that takes multiple input tables and combines them into a <monospace>.npz</monospace> (compressed NumPy) file that is loaded directly with the viewer. This file includes every row from every input file and additional information linking equivalent frames from the different input files. As an example, the data set from CXIDB ID 40 was indexed with <italic>CrystFEL</italic> Version 0.7.0 with the provided scripts and input files. Then, it was indexed three additional times with different integration radii. The integration radii parameter in <italic>CrystFEL</italic>’s <italic>indexamajig</italic> defines the outer radius of a peak and the inner and outer radii of the peak’s local background. Comparison mode can be used to visualize how different integration radii impact the indexing results on a frame-by-frame basis.</p>
    <sec id="sec5.1">
      <label>5.1.</label>
      <title>Plots   </title>
      <p>Two additional parameters for plots appear in comparison mode: the comparison ID, which is unique for each diffraction pattern irrespective of the stream files, and the comparison group, which identifies the input table of the frame. In the example, the comparison ID field range is from 0 to 125 415 so there is a unique value for each frame in the data set. The comparison group has four possible values for the four different input tables. To examine whether there is a change in the unit-cell volume determined by indexing with different integration radii, an aggregated plot can be used with the comparison ID for the <italic>x</italic> axis and a different line for each comparison group, shown in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>(<italic>a</italic>). From the plot, it is apparent that the integration radii influence the unit-cell volume since the different lines do not overlap, but the effect is not consistent for all patterns since the lines cross.</p>
      <p>For a more detailed view of the changes, two additional plots are available, called comparison scatter and comparison 2D histogram. They are variants of the scatter and histogram plots where the <italic>x</italic> and <italic>y</italic> axes are input tables. Each point is a frame, with the <italic>x</italic> value corresponding to the value of the parameter in the <italic>x</italic> input table and the <italic>y</italic> value corresponding to the value of the parameter from the <italic>y</italic> input table. A comparison 2D histogram for the integration radii used in the initial scripts as the <italic>x</italic> axis and the default <italic>CrystFEL</italic> integration radii as the <italic>y</italic> axis is shown in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>(<italic>b</italic>).</p>
    </sec>
    <sec id="sec5.2">
      <label>5.2.</label>
      <title>Filters   </title>
      <p>After visualizing the frame-by-frame changes from different processing approaches, it is useful to create a combined data set that is optimal for each frame. The software <italic>IOTA</italic> (Lyubimov <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb15"> ▸</xref>) does this by screening peak-finding parameters for each frame and using the parameters for each frame that minimize an optimization function. <italic>DatView</italic> enables this kind of processing with the ‘min’ and ‘max’ filter operators available in the comparison mode. These filters keep the frame from each set of equivalent frames that minimizes or maximizes the selected parameter. In the example, a minimum filter on the cell volume would result in a selection with 125 416 frames (if all frames were indexed in at least one input file), where each selected frame comes from the input table where its cell volume is minimal.</p>
      <p>The ‘min’ and ‘max’ filters are comparison filters because they operate on each set of equivalent frames. In other words, the inclusion of a frame depends on the values of the parameter for that frame in the other input tables. There are four other comparison filters: ‘all between’, ‘any between’, ‘all same’ and ‘any different’. The ‘all between’ filter can be used to select the set of patterns that were indexed with all four integration radii by enforcing equivalent frames to have a unit-cell volume in the normal range. In the example, this results in 232 308 selected rows, meaning 58 077 patterns were indexed in all four conditions. The ‘any between’ filter on cell volume would keep any frame that was indexed under at least one condition. For the example data, this would result in 287 916 selected rows, meaning 71 979 patterns were indexed under at least one condition.</p>
      <p>The ‘all same’ and ‘any different’ filters help with parameters that only change occasionally. For the example data set, the diffraction resolution limit calculated by <italic>CrystFEL</italic>’s <italic>indexamajig</italic> is not always affected by the integration radii. Using the ‘all same’ filter on the diffraction resolution limit for the set of patterns indexed under every condition reduces the selection from 232 308 to 138 384, showing that for 34 596 patterns the different integration radii did not have an impact on the calculated diffraction resolution limit. The ‘any different’ filter is the opposite of the ‘all same’ filter and results in the selection of the other 93 924 rows corresponding to the 23 481 patterns whose diffraction resolution limit was different in at least one input file.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec6">
    <label>6.</label>
    <title>Conclusions   </title>
    <p><italic>DatView</italic>’s GUI for visualizing data, exporting subsets and comparing processing methods makes data analysis for SFX data sets easier. The synchronized and interactive plots aid in diagnosing and fixing problems, and the item viewer makes it easy to make selections on a frame-by-frame basis. Export functionality enables users to create clean data sets or efficiently bin data sets into different files. The comparison mode allows basic frame-by-frame optimization of indexing and integration parameters. <italic>DatView</italic> is included in the CFEL software stack at the European XFEL, and has also been used on the FMX beamline at NSLS-II, at PAL-XFEL and at LCLS. It is anticipated that it will help many users make the most of their serial crystallography data and other types of multi-parameter data.</p>
  </sec>
</body>
<back>
  <ack>
    <p>The authors are grateful to Valerio Mariani for maintaining <italic>DatView</italic> on the European XFEL Center for Free-Electron Laser Science (CFEL) software stack. The authors also thank Thomas Grant, Sabine Botha and Chufeng Li for testing and feedback on <italic>DatView</italic> and feedback on the manuscript. The PAL-XFEL data set was used with permission from Ganesh Subramanian.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Assmann, G., Brehm, W. &amp; Diederichs, K. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 1021–1028.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Barends, T., White, T. A., Barty, A., Foucar, L., Messerschmidt, M., Alonso-Mori, R., Botha, S., Chapman, H., Doak, R. B., Galli, L., Gati, C., Gutmann, M., Koglin, J., Markvardsen, A., Nass, K., Oberthur, D., Shoeman, R. L., Schlichting, I. &amp; Boutet, S. (2015). <italic>J. Synchrotron Rad.</italic>
<bold>22</bold>, 644–652.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Barty, A., Kirian, R. A., Maia, F. R. N. C., Hantke, M., Yoon, C. H., White, T. A. &amp; Chapman, H. (2014). <italic>J. Appl. Cryst.</italic>
<bold>47</bold>, 1118–1131.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Casanas, A., Warshamanage, R., Finke, A. D., Panepucci, E., Olieric, V., Nöll, A., Tampé, R., Brandstetter, S., Förster, A., Mueller, M., Schulze-Briese, C., Bunk, O. &amp; Wang, M. (2016). <italic>Acta Cryst.</italic> D<bold>72</bold>, 1036–1048.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Chapman, H. N., Fromme, P., Barty, A., White, T. A., Kirian, R. A., Aquila, A., Hunter, M. S., Schulz, J., DePonte, D. P., Weierstall, U., Doak, R. B., Maia, F. R. N. C., Martin, A. V., Schlichting, I., Lomb, L., Coppola, N., Shoeman, R. L., Epp, S. W., Hartmann, R., Rolles, D., Rudenko, A., Foucar, L., Kimmel, N., Weidenspointner, G., Holl, P., Liang, M., Barthelmess, M., Caleman, C., Boutet, S., Bogan, M. J., Krzywinski, J., Bostedt, C., Bajt, S., Gumprecht, L., Rudek, B., Erk, B., Schmidt, C., Hömke, A., Reich, C., Pietschner, D., Strüder, L., Hauser, G., Gorke, H., Ullrich, J., Herrmann, S., Schaller, G., Schopper, F., Soltau, H., Kühnel, K., Messerschmidt, M., Bozek, J. D., Hau-Riege, S. P., Frank, M., Hampton, C. Y., Sierra, R. G., Starodub, D., Williams, G. J., Hajdu, J., Timneanu, N., Seibert, M. M., Andreasson, J., Rocker, A., Jönsson, O., Svenda, M., Stern, S., Nass, K., Andritschke, R., Schröter, C., Krasniqi, F., Bott, M., Schmidt, K. E., Wang, X., Grotjohann, I., Holton, J. M., Barends, T. R. M., Neutze, R., Marchesini, S., Fromme, R., Schorb, S., Rupp, D., Adolph, M., Gorkhover, T., Andersson, I., Hirsemann, H., Potdevin, G., Graafsma, H., Nilsson, B. &amp; Spence, J. C. H. (2011). <italic>Nature</italic>, <bold>470</bold>, 73–77.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Diederichs, K. &amp; Karplus, P. A. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 1215–1222.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Fenalti, G., Zatsepin, N. A., Betti, C., Giguere, P., Han, G. W., Ishchenko, A., Liu, W., Guillemyn, K., Zhang, H., James, D., Wang, D., Weierstall, U., Spence, J. C. H., Boutet, S., Messerschmidt, M., Williams, G. J., Gati, C., Yefanov, O. M., White, T. A., Oberthuer, D., Metz, M., Yoon, C. H., Barty, A., Chapman, H. N., Basu, S., Coe, J., Conrad, C. E., Fromme, R., Fromme, P., Tourwé, D., Schiller, P. W., Roth, B. L., Ballet, S., Katritch, V., Stevens, R. C. &amp; Cherezov, V. (2015). <italic>Nat. Struct. Mol. Biol.</italic>
<bold>22</bold>, 265–268.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Foadi, J., Aller, P., Alguel, Y., Cameron, A., Axford, D., Owen, R. L., Armour, W., Waterman, D. G., Iwata, S. &amp; Evans, G. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 1617–1632.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Fuchs, M., Sweet, R., Berman, L., Hendrickson, W., Chubar, O., Canestrari, N., Idir, M., Yang, L. &amp; Schneider, D. (2014). <italic>J. Phys. Conf. Ser.</italic>
<bold>493</bold>, 012021.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Ginn, H. M., Brewster, A. S., Hattne, J., Evans, G., Wagner, A., Grimes, J. M., Sauter, N. K., Sutton, G. &amp; Stuart, D. I. (2015). <italic>Acta Cryst.</italic> D<bold>71</bold>, 1400–1410.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Hattne, J., Echols, N., Tran, R., Kern, J., Gildea, R. J., Brewster, A. S., Alonso-Mori, R., Glöckner, C., Hellmich, J., Laksmono, H., Sierra, R. G., Lassalle-Kaiser, B., Lampe, A., Han, G., Gul, S., DiFiore, D., Milathianaki, D., Fry, A. R., Miahnahri, A., White, W. E., Schafer, D. W., Seibert, M. M., Koglin, J. E., Sokaras, D., Weng, T. C., Sellberg, J., Latimer, M. J., Glatzel, P., Zwart, P. H., Grosse-Kunstleve, R. W., Bogan, M. J., Messerschmidt, M., Williams, G. J., Boutet, S., Messinger, J., Zouni, A., Yano, J., Bergmann, U., Yachandra, V. K., Adams, P. D. &amp; Sauter, N. K. (2014). <italic>Nat. Methods</italic>, <bold>11</bold>, 545–548.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Kabsch, W. (2014). <italic>Acta Cryst.</italic> D<bold>70</bold>, 2204–2216.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Ko, I., Kang, H.-S., Heo, H., Kim, C., Kim, G., Min, C.-K., Yang, H., Baek, S., Choi, H.-J., Mun, G., Park, B., Suh, Y., Shin, D., Hu, J., Hong, J., Jung, S., Kim, S., Kim, K., Na, D., Park, S., Park, Y., Jung, Y., Jeong, S., Lee, H., Lee, S., Lee, S., Oh, B., Suh, H., Han, J., Kim, M., Jung, N., Kim, Y., Lee, M., Lee, B., Sung, C., Mok, I., Yang, J., Parc, Y., Lee, W., Lee, C., Shin, H., Kim, J., Kim, Y., Lee, J., Park, S., Kim, J., Park, J., Eom, I., Rah, S., Kim, S., Nam, K. H., Park, J., Park, J., Kim, S., Kwon, S., An, R., Park, S., Kim, K., Hyun, H., Kim, S., Kim, S., Yu, C., Kim, B., Kang, T., Kim, K., Kim, S., Lee, H., Lee, H., Park, K., Koo, T., Kim, D. &amp; Lee, K. (2017). <italic>Appl. Sci.</italic>
<bold>7</bold>, 479.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Könnecke, M., Akeroyd, F. A., Bernstein, H. J., Brewster, A. S., Campbell, S. I., Clausen, B., Cottrell, S., Hoffmann, J. U., Jemian, P. R., Männicke, D., Osborn, R., Peterson, P. F., Richter, T., Suzuki, J., Watts, B., Wintersberger, E. &amp; Wuttke, J. (2015). <italic>J. Appl. Cryst.</italic>
<bold>48</bold>, 301–305.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Lyubimov, A. Y., Uervirojnangkoorn, M., Zeldin, O. B., Brewster, A. S., Murray, T. D., Sauter, N. K., Berger, J. M., Weis, W. I. &amp; Brunger, A. T. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 1057–1064.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Maia, F. R. (2012). <italic>Nat. Methods</italic>, <bold>9</bold>, 854–855.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Neutze, R., Wouts, R., van der Spoel, D., Weckert, E. &amp; Hajdu, J. (2000). <italic>Nature</italic>, <bold>406</bold>, 752–757.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Roedig, P., Ginn, H. M., Pakendorf, T., Sutton, G., Harlos, K., Walter, T. S., Meyer, J., Fischer, P., Duman, R., Vartiainen, I., Reime, B., Warmer, M., Brewster, A. S., Young, I. D., Michels-Clark, T., Sauter, N. K., Kotecha, A., Kelly, J., Rowlands, D. J., Sikorsky, M., Nelson, S., Damiani, D. S., Alonso-Mori, R., Ren, J., Fry, E. E., David, C., Stuart, D. I., Wagner, A. &amp; Meents, A. (2017). <italic>Nat. Methods</italic>, <bold>14</bold>, 805–810.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Spence, J. C. H. (2017). <italic>IUCrJ</italic>, <bold>4</bold>, 322–339.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Uervirojnangkoorn, M., Zeldin, O. B., Lyubimov, A. Y., Hattne, J., Brewster, A. S., Sauter, N. K., Brunger, A. T. &amp; Weis, W. I. (2015). <italic>eLife</italic>, <bold>4</bold>, e05421.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">White, T. A. (2014). <italic>Philos. Trans. R. Soc. London B</italic>, <bold>369</bold>, 20130330.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">White, T. A. (2019). <italic>Acta Cryst.</italic> D<bold>75</bold>, 219–233.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">White, T. A., Barty, A., Liu, W., Ishchenko, A., Zhang, H., Gati, C., Zatsepin, N. A., Basu, S., Oberthür, D., Metz, M., Beyerlein, K. R., Yoon, C. H., Yefanov, O. M., James, D., Wang, D., Messerschmidt, M., Koglin, J. E., Boutet, S., Weierstall, U. &amp; Cherezov, V. (2016). <italic>Sci. Data</italic>, <bold>3</bold>, 160057.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">White, T. A., Kirian, R. A., Martin, A. V., Aquila, A., Nass, K., Barty, A. &amp; Chapman, H. N. (2012). <italic>J. Appl. Cryst.</italic>
<bold>45</bold>, 335–341.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">White, T. A., Mariani, V., Brehm, W., Yefanov, O., Barty, A., Beyerlein, K. R., Chervinskii, F., Galli, L., Gati, C., Nakane, T., Tolstikova, A., Yamashita, K., Yoon, C. H., Diederichs, K. &amp; Chapman, H. N. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 680–689.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Wiedorn, M. O., Oberthür, D., Bean, R., Schubert, R., Werner, N., Abbey, B., Aepfelbacher, M., Adriano, L., Allahgholi, A., Al-Qudami, N., Andreasson, J., Aplin, S., Awel, S., Ayyer, K., Bajt, S., Barák, I., Bari, S., Bielecki, J., Botha, S., Boukhelef, D., Brehm, W., Brockhauser, S., Cheviakov, I., Coleman, M. A., Cruz-Mazo, F., Danilevski, C., Darmanin, C., Doak, R. B., Domaracky, M., Dörner, K., Du, Y., Fangohr, H., Fleckenstein, H., Frank, M., Fromme, P., Gañán-Calvo, A. M., Gevorkov, Y., Giewekemeyer, K., Ginn, H. M., Graafsma, H., Graceffa, R., Greiffenberg, D., Gumprecht, L., Göttlicher, P., Hajdu, J., Hauf, S., Heymann, M., Holmes, S., Horke, D. A., Hunter, M. S., Imlau, S., Kaukher, A., Kim, Y., Klyuev, A., Knoška, J., Kobe, B., Kuhn, M., Kupitz, C., Küpper, J., Lahey-Rudolph, J. M., Laurus, T., Le Cong, K., Letrun, R., Xavier, P. L., Maia, L., Maia, F. R. N. C., Mariani, V., Messerschmidt, M., Metz, M., Mezza, D., Michelat, T., Mills, G., Monteiro, D. C. F., Morgan, A., Mühlig, K., Munke, A., Münnich, A., Nette, J., Nugent, K. A., Nuguid, T., Orville, A. M., Pandey, S., Pena, G., Villanueva-Perez, P., Poehlsen, J., Previtali, G., Redecke, L., Riekehr, W. M., Rohde, H., Round, A., Safenreiter, T., Sarrou, I., Sato, T., Schmidt, M., Schmitt, B., Schönherr, R., Schulz, J., Sellberg, J. A., Seibert, M. M., Seuring, C., Shelby, M. L., Shoeman, R. L., Sikorski, M., Silenzi, A., Stan, C. A., Shi, X., Stern, S., Sztuk-Dambietz, J., Szuba, J., Tolstikova, A., Trebbin, M., Trunk, U., Vagovic, P., Ve, T., Weinhausen, B., White, T. A., Wrona, K., Xu, C., Yefanov, O., Zatsepin, N., Zhang, J., Perbandt, M., Mancuso, A. P., Betzel, C., Chapman, H. &amp; Barty, A. (2018). <italic>Nat. Commun.</italic>
<bold>9</bold>, 4025.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Zeldin, O. B., Brewster, A. S., Hattne, J., Uervirojnangkoorn, M., Lyubimov, A. Y., Zhou, Q., Zhao, M., Weis, W. I., Sauter, N. K. &amp; Brunger, A. T. (2015). <italic>Acta Cryst.</italic> D<bold>71</bold>, 352–356.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>(<italic>a</italic>) The main window of <italic>DatView</italic>, containing histograms, three per row, with additional rows appearing as needed. Additional plots appear in their own windows. (<italic>b</italic>) The control panel interface for stacked histograms. This is a hit-finding data set from NSLS-II (unpublished data).</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig1"/>
  </fig>
  <fig id="fig2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Data from CXIDB ID 40 (Fenalti <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>; White, Barty <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb23"> ▸</xref>) indexed with an incorrect beam center. (<italic>a</italic>) The initial main window of <italic>DatView</italic>, showing histograms of the unit-cell distributions colored by centering (blue is <italic>C</italic> centered, black is <italic>P</italic> centered). (<italic>b</italic>) A 2D histogram of the predicted detector shifts from indexing, generated from the Plot menu. (<italic>c</italic>) Selecting regions of the unit-cell distribution with Shift + click and drag updates panel (<italic>d</italic>) to emphasize the detector shift needed for the correctly indexed patterns.</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig2"/>
  </fig>
  <fig id="fig3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>(<italic>a</italic>) The same 2D histogram of predicted detector shifts as in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>d</italic>) but with finer binning, making the two distinct clusters easier to view. (<italic>b</italic>) A scatter plot of the detector <italic>x</italic> shift over sorted order (order of data collection) colored by run number, with the default display setting of showing the full data set semi-transparent and the current selection opaque. (<italic>c</italic>) The same as panel (<italic>b</italic>) but showing only the current selection, highlighting the point where the two clusters in panel (<italic>a</italic>) separate.</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig3"/>
  </fig>
  <fig id="fig4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <p><italic>DatView’s</italic> item viewer. The left-hand pane shows all the statistics available for that row from the input table and the right-hand pane shows data from the HDF5 file. (<italic>a</italic>) A view of a pattern from CXIDB ID 40 (Fenalti <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>; White, Barty <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb23"> ▸</xref>). The image file information from the input table is used to display the image and the stream file information from the input table to overlay predicted (blue) and found (red) peak locations. A <italic>CrystFEL</italic> geometry file is used to lay out the information and for the resolution rings (blue) and the pattern’s diffraction resolution limit ring (green). (<italic>b</italic>) A frame of spectroscopy data collected at PAL-XFEL, showing readouts from an area detector and two photodiodes.</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig4"/>
  </fig>
  <fig id="fig5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Example of <italic>DatView</italic> pixel plots, showing the <italic>a</italic> axis of the unit cells of membrane protein microcrystals by position on micropatterned silicon chips mounted on the high-speed Roadrunner goniometer (Roedig <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb18"> ▸</xref>) (unpublished data). Data collection began at the bottom of the chip. (<italic>a</italic>) A pixel plot showing the variation in unit-cell <italic>a</italic> axis that may be related to humidity or temperature changes during data collection, and (<italic>b</italic>) the <italic>a</italic>-axis pixel plot from another chip from the same experiment that did not show much variation in the unit cell.</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig5"/>
  </fig>
  <fig id="fig6" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <p>The control panel interfaces for (<italic>a</italic>) partitions controlling output bins, (<italic>b</italic>) sorting, (<italic>c</italic>) limiting output, and (<italic>d</italic>) creating and editing filters. The filter tree in panel (<italic>d</italic>) is equivalent to the filter in the text: (high resolution AND (pattern number &lt; 2000 OR pattern number <inline-formula><inline-graphic xlink:href="j-52-01440-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>)), showing how nested parentheses become nested layers in the tree structure. These windows use headings from NSLS-II hit-finding tables (unpublished data).</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig6"/>
  </fig>
  <fig id="fig7" orientation="portrait" position="float">
    <label>Figure 7</label>
    <caption>
      <p><italic>DatView</italic> comparison plots of indexing results from four different indexing conditions for SFX data from CXIDB ID 40 (Fenalti <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>; White, Barty <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb23"> ▸</xref>). The entire data set was processed with the original (published) integration radii of 3, 4, 5 pixels, then 2, 4, 5 pixels, 3, 5, 7 pixels and the <italic>CrystFEL</italic> default integration radii of 4, 5, 7 pixels. (<italic>a</italic>) An aggregated plot across equivalent frames showing the average cell volume grouped by processing. (<italic>b</italic>) A 2D histogram showing the apparent change in unit-cell volume when indexing with the integration radii (3, 4, 5 pixels) from the scripts downloaded from CXIDB and the default integration radii (4, 5, 7 pixels).</p>
    </caption>
    <graphic xlink:href="j-52-01440-fig7"/>
  </fig>
  <table-wrap id="table1" orientation="portrait" position="float">
    <label>Table 1</label>
    <caption>
      <title>Data sizes and comparison of time taken (minutes:seconds) for the appearance of the GUI for <italic>CrystFEL</italic> stream files from data set CXIDB ID 40 (Fenalti <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>; White, Barty <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb23"> ▸</xref>)</title>
      <p>Data were processed with <italic>CrystFEL</italic> Version 0.7.0 and times were averaged over five repetitions. The small stream file is the entire data set with original processing parameters. The larger stream file combines the results of indexing with four different sets of integration radii, as described in Section 5<xref ref-type="sec" rid="sec5"/>.</p>
    </caption>
    <table frame="hsides" rules="groups">
      <thead valign="bottom">
        <tr>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom"> </th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom">Small stream</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom">Larger stream</th>
        </tr>
      </thead>
      <tbody valign="top">
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">Indexed patterns</td>
          <td rowspan="1" colspan="1" align="left" valign="top">66 036</td>
          <td rowspan="1" colspan="1" align="left" valign="top">247 554</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">Frames</td>
          <td rowspan="1" colspan="1" align="left" valign="top">125 458</td>
          <td rowspan="1" colspan="1" align="left" valign="top">479 051</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">File size</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2.7 GB</td>
          <td rowspan="1" colspan="1" align="left" valign="top">9.7 GB</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">
            <italic>cell_explorer</italic>
          </td>
          <td rowspan="1" colspan="1" align="left" valign="top">0:20</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1:16</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">Detector shift</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0:29</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1:41</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">
            <italic>cxiview</italic>
          </td>
          <td rowspan="1" colspan="1" align="left" valign="top">1:26</td>
          <td rowspan="1" colspan="1" align="left" valign="top">5:08</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>DatView</italic> preprocessing</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0:44</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2:42</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"><monospace>.dat</monospace> file size</td>
          <td rowspan="1" colspan="1" align="left" valign="top">61 MB</td>
          <td rowspan="1" colspan="1" align="left" valign="top">237 MB</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">
            <italic>DatView</italic>
          </td>
          <td rowspan="1" colspan="1" align="left" valign="top">0:13</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0:33</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</floats-group>
