<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9805555</article-id>
    <article-id pub-id-type="pmid">36342196</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac722</article-id>
    <article-id pub-id-type="publisher-id">btac722</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A framework for group-wise summarization and comparison of chromatin state annotations</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-1131-7375</contrib-id>
        <name>
          <surname>Vu</surname>
          <given-names>Ha</given-names>
        </name>
        <aff><institution>Bioinformatics Interdepartmental Program, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Department of Biological Chemistry, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Koch</surname>
          <given-names>Zane</given-names>
        </name>
        <aff><institution>Department of Biological Chemistry, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fiziev</surname>
          <given-names>Petko</given-names>
        </name>
        <aff><institution>Bioinformatics Interdepartmental Program, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Department of Biological Chemistry, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Illumina Artificial Intelligence Laboratory, Illumina Inc.</institution>, Foster City, CA 94404, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4026-7853</contrib-id>
        <name>
          <surname>Ernst</surname>
          <given-names>Jason</given-names>
        </name>
        <aff><institution>Bioinformatics Interdepartmental Program, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Department of Biological Chemistry, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Eli and Edythe Broad Center of Regenerative Medicine and Stem Cell Research, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Computer Science Department, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Jonsson Comprehensive Cancer Center, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Molecular Biology Institute, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <aff><institution>Computational Medicine Department, University of California, Los Angeles</institution>, Los Angeles, CA 90095, <country country="US">USA</country></aff>
        <xref rid="btac722-cor1" ref-type="corresp"/>
        <!--jason.ernst@ucla.edu-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Martelli</surname>
          <given-names>Pier Luigi</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac722-cor1">To whom correspondence should be addressed. Email: <email>jason.ernst@ucla.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-11-07">
      <day>07</day>
      <month>11</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>07</day>
      <month>11</month>
      <year>2022</year>
    </pub-date>
    <volume>39</volume>
    <issue>1</issue>
    <elocation-id>btac722</elocation-id>
    <history>
      <date date-type="received">
        <day>02</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>12</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>19</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>23</day>
        <month>11</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac722.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Genome-wide maps of epigenetic modifications are powerful resources for non-coding genome annotation. Maps of multiple epigenetics marks have been integrated into cell or tissue type-specific chromatin state annotations for many cell or tissue types. With the increasing availability of multiple chromatin state maps for biologically similar samples, there is a need for methods that can effectively summarize the information about chromatin state annotations within groups of samples and identify differences across groups of samples at a high resolution.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed CSREP, which takes as input chromatin state annotations for a group of samples. CSREP then probabilistically estimates the state at each genomic position and derives a representative chromatin state map for the group. CSREP uses an ensemble of multi-class logistic regression classifiers that predict the chromatin state assignment of each sample given the state maps from all other samples. The difference in CSREP’s probability assignments for the two groups can be used to identify genomic locations with differential chromatin state assignments. Using groups of chromatin state maps of a diverse set of cell and tissue types, we demonstrate the advantages of using CSREP to summarize chromatin state maps and identify biologically relevant differences between groups at a high resolution.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The CSREP source code and generated data are available at <ext-link xlink:href="http://github.com/ernstlab/csrep" ext-link-type="uri">http://github.com/ernstlab/csrep</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>DP1DA044371</award-id>
        <award-id>U01MH105578</award-id>
        <award-id>UH3NS104095</award-id>
        <award-id>U01HG012079</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Science Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/100000001</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>1254200</award-id>
        <award-id>1705121</award-id>
        <award-id>2125664</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Rose Hills Innovator Award</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>UCLA Jonsson Comprehensive Cancer Center and Eli and Edythe Broad Center of Regenerative Medicine</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Stem Cell Research Ablon Scholars Program</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Genome-wide maps of chromatin marks such as histone modifications and variants provide valuable information for annotating non-coding genome features (<xref rid="btac722-B1" ref-type="bibr">Barski <italic toggle="yes">et al.</italic>, 2007</xref>; <xref rid="btac722-B7" ref-type="bibr">Ernst <italic toggle="yes">et al.</italic>, 2011</xref>; <xref rid="btac722-B26" ref-type="bibr">Xie <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btac722-B28" ref-type="bibr">Zhu <italic toggle="yes">et al.</italic>, 2013</xref>). Efforts by large consortia and individual labs have produced chromatin state maps for many cell and tissue types (<xref rid="btac722-B6" ref-type="bibr">ENCODE Project Consortium, 2012</xref>; <xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btac722-B26" ref-type="bibr">Xie <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btac722-B28" ref-type="bibr">Zhu <italic toggle="yes">et al.</italic>, 2013</xref>). A popular representation of such data is chromatin states defined by the combinatorial and spatial patterns of multiple marks, which are generated by methods such as ChromHMM and Segway (<xref rid="btac722-B9" ref-type="bibr">Ernst and Kellis, 2010</xref>, <xref rid="btac722-B8" ref-type="bibr">2012</xref>; <xref rid="btac722-B14" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic>, 2012</xref>; <xref rid="btac722-B19" ref-type="bibr">Libbrecht <italic toggle="yes">et al.</italic>, 2021</xref>), and correspond to diverse classes of genomic elements including various types of enhancers and promoters.</p>
    <p>Chromatin state maps have been produced for hundreds of different biological samples. In many cases, there are multiple samples representing similar cell and tissue types (<xref rid="btac722-B2" ref-type="bibr">Boix <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>). In such cases, to simplify analyses and visualizations, it may be desirable to have a single chromatin state annotation that summarizes the annotations for all samples in a pre-defined sample group of interest. A straightforward approach to this task is to take the most frequent chromatin state assigned at each position across samples in the group. However, when the number of samples in a group is small or the number of states is large, such an approach can be particularly vulnerable to noise. Furthermore, such an approach does not consider additional information available about the different chromatin states. For example, if a location was assigned to three different states in three samples, the summary annotation among these three states based on the frequency-based method would be arbitrary. However, by leveraging information about the co-occurrence of state assignments genome-wide, there is additional information to predict the most likely chromatin state annotation for a new sample from the group.</p>
    <p>A related challenge is to identify differences in chromatin state annotations between two groups at a high resolution and on a per-state basis. Several methods have been developed for comparing chromatin state annotations between groups of samples, but typically either work at a coarse resolution or do not identify differences on a per-chromatin-state basis. For instance, ChromDiff (<xref rid="btac722-B27" ref-type="bibr">Yen and Kellis, 2015</xref>) presents a statistical testing framework to uncover pre-defined broad regions such as gene bodies with significant differences for specific chromatin states across the two groups, but was not specifically designed for detecting differences at the resolution of the chromatin state annotations. EpiAlign (<xref rid="btac722-B10" ref-type="bibr">Ge <italic toggle="yes">et al.</italic>, 2019</xref>) scores the alignment patterns between two user-input sequences of chromatin state annotations in two samples, hence is most applicable for comparing broad domains that encompass multiple chromatin state segments. Another method, chromswitch (<xref rid="btac722-B15" ref-type="bibr">Jessa and Kleinman, 2018</xref>) also offers a framework to score the differential chromatin state annotations within broader user-specified input genomic locus and is not designed for detecting chromatin state differences genome-wide at the same resolution of the annotations. EpiCompare (<xref rid="btac722-B13" ref-type="bibr">He and Wang, 2017</xref>) is primarily a webtool that can be used for detecting cell-type-specific chromatin state differences in terms of enhancer or promoter states but does not support detecting differences for individual states or other types of chromatin states. SCIDDO (<xref rid="btac722-B5" ref-type="bibr">Ebert and Schulz, 2021</xref>) conducts fast genome-wide detection of differential chromatin domains between two groups of samples while incorporating a measure of similarity among states. However, as SCIDDO provides a single differential score per position, it does not directly answer the question of which chromatin states change at each genomic position. Another method, dPCA (<xref rid="btac722-B16" ref-type="bibr">Ji <italic toggle="yes">et al.</italic>, 2013</xref>), works directly on chromatin mark signals and does not quantify state differences across groups of samples.</p>
    <p>To effectively summarize the chromatin state annotations for a group of samples and prioritize the chromatin state differences between two groups on a per-state basis, at high resolution, we introduce CSREP. CSREP leverages both the information about the input samples’ chromatin states at a position, as well as information on states’ co-occurrences in different samples within the same group across the genome. CSREP does this by first generating probabilistic estimates of chromatin state annotations to summarize a group of samples using an ensemble of multi-class logistic regression classifiers. These classifiers predict the state assignment in a sample at a position, given the annotations in other samples at the corresponding genomic position. From those predictions, CSREP is then able to produce a single summary state assignment per position. Furthermore, CSREP can use the difference of summary probabilistic predictions for two groups of samples to quantify the difference in state assignments between the two groups on a per-state basis, e.g. one genome-wide score track per chromatin state. CSREP’s ability to summarize chromatin states for a group of samples beyond simple counting is a unique feature of CSREP relative to existing methods mentioned above for detecting differential chromatin states or domains. CSREP is also distinguished from these existing methods by a combination of (i) considering differential chromatin state annotations at the resolution of the input annotations instead of over broad domains, (ii) generating outputs genome-wide instead of at user-specified loci and (iii) providing state-specific and directionally meaningful scores for all states.</p>
    <p>Using CSREP, we generate the summary chromatin state maps for 11 groups of tissue/cell types from Roadmap Epigenomics Project (<xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>), and for 75 groups from the EpiMap Portal (<xref rid="btac722-B2" ref-type="bibr">Boix <italic toggle="yes">et al.</italic>, 2021</xref>), which can be easily viewed on genome browsers (Data availability). We show that CSREP can better predict chromatin state assignments in held-out samples than a counting-based baseline method. We also verify that the resulting summary chromatin maps show correspondence with the group’s average gene expression profile. Additionally, we show that CSREP’s differential scores can recover differential epigenetic signals on chromosome X between Male and Female samples. We also show that CSREP differential scores between samples from two different tissue groups can predict regions of differential peaks for various chromatin marks. The CSREP implementation is designed to be user-friendly and includes a detailed tutorial, available at <ext-link xlink:href="https://github.com/ernstlab/csrep" ext-link-type="uri">https://github.com/ernstlab/csrep</ext-link>. We expect CSREP will be a useful tool for summarizing chromatin state maps within groups and finding differences across groups. Additionally, we expect the summary annotations for different tissue groups that we generated with CSREP to be a useful resource.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 CSREP’s summarization of a group of samples</title>
      <p>Let <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi>G</mml:mi></mml:math></inline-formula> denote the number of genomic bins across the genome, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> the number of chromatin states, and <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> the number of samples in the target group of samples. Let <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo></mml:math></inline-formula>denote the chromatin state assigned to sample <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> at genomic position <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>, which can take one value of <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>S</mml:mi></mml:math></inline-formula>. Let <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> denote the set of samples not including <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>, i.e. <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula>. In general, CSREP is an ensemble of <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> multi-class logistic regression classifiers such that for each sample <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>, CSREP trains a classifier to predict the chromatin state map of this sample based on features from the remaining samples (<inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>). The predictor variables for such a model include one-hot encoded chromatin state maps of the <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> samples (all samples in the group except <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>) and an intercept term, resulting in <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> predictor variables. The response variable is the chromatin state of the target sample <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>, which can take one value of <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>S</mml:mi></mml:math></inline-formula>.</p>
      <p>In the multi-class logistic regression model, let <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>denote the vector of predictor variables at position <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>, which has length <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> and takes values <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mo>{</mml:mo><mml:mn>0,1</mml:mn><mml:mo>}</mml:mo><mml:mo>.</mml:mo></mml:math></inline-formula> The last entry of <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>is 1, corresponding to the intercept term. Let <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> denote the value of the response variable at position <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>, which takes values <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mo>{</mml:mo><mml:mn>1,2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>S</mml:mi><mml:mo>}</mml:mo></mml:math></inline-formula>. Since the input chromatin state maps that we used segmented the genome into 200-bp bins, we refer to each genomic position as one 200-bp window in the genome. We randomly selected genomic positions for the training dataset, such that these positions constitute 10% of the genome. We chose 10% as the training proportion because increasing this parameter does not result in considerable increase in model accuracy but increases runtime (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). Given the training dataset, for each state <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>S</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:math></inline-formula>, the multi-class logistic regression model learns a coefficient vector <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> with length <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>, corresponding to the number of predictor variables. The probability of sample <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>’s chromatin state assignment being <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> at position <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is then calculated as:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mi>P</mml:mi><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:math></disp-formula>for <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>S</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:math></inline-formula>, and as the following when <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mi>S</mml:mi></mml:math></inline-formula><italic toggle="yes">:</italic><disp-formula id="E2"><mml:math id="M2" display="block" overflow="scroll"><mml:mi>P</mml:mi><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula></p>
      <p>The model is implemented using Python’s sklearn, pybedtools packages and snakemake (<xref rid="btac722-B4" ref-type="bibr">Dale <italic toggle="yes">et al.</italic>, 2011</xref>; <xref rid="btac722-B18" ref-type="bibr">Köster and Rahmann, 2012</xref>; <xref rid="btac722-B20" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac722-B21" ref-type="bibr">Quinlan and Hall, 2010</xref>). An L2-norm penalty with the default regularization strength of 1.0 was used for training. CSREP applies the model to generate probabilistic predictions of a genome-wide chromatin state map for sample <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula>, which is presented in a matrix of size <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:mi>S</mml:mi></mml:math></inline-formula>. The output matrices from <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> predictions for <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> samples are then averaged, so at each genomic bin, the sum of state assignment probabilities across <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> states is <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mn>1</mml:mn></mml:math></inline-formula>. In addition, the chromatin state with the maximum probability in each row is recorded to produce a single representative chromatin state map for the entire group of samples.</p>
    </sec>
    <sec>
      <title>2.2 CSREP’s application to prioritizing differential chromatin state changes between two groups of samples</title>
      <p>To calculate differential chromatin state maps between two groups of samples, Group1 and Group2, CSREP first calculates the probabilistic chromatin state map matrices for each group as described above, denoted as <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, respectively. After this, CSREP subtracts the two matrices to represent the differential chromatin state map between Group1 and Group2 (denoted <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>), i.e. <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi><mml:mo>-</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. We note that we used signed and not absolute difference here and thus the score ranges from −1 to 1. A score on row <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and column <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> of <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, denoted <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, being −1 means Group2 is estimated to have probability <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mn>1</mml:mn></mml:math></inline-formula> of being assigned to state <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> at position <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mi mathvariant="normal">i</mml:mi></mml:math></inline-formula> while Group1 has probability of 0. Additionally, since CSREP assigns <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> scores of differential chromatin maps to each genomic position <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>, corresponding to <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> states, CSREP can uncover specific chromatin state changes. For example, if <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.8</mml:mn></mml:math></inline-formula> when <inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> while <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>-</mml:mo><mml:mn>0.8</mml:mn></mml:math></inline-formula> when <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:math></inline-formula>, we can infer that at position <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>, Group1 is likely to be in State <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mn>1</mml:mn></mml:math></inline-formula> while Group2 is likely to be in State <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mn>2</mml:mn></mml:math></inline-formula>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 CSREP method overview</title>
      <p>CSREP takes as input chromatin state maps for a group of samples learned in such a way that annotations for different samples have an internally consistent set of defined chromatin states (<xref rid="btac722-B9" ref-type="bibr">Ernst and Kellis, 2010</xref>, <xref rid="btac722-B8" ref-type="bibr">2012</xref>). We note that the input is presented in BED file format, with each file containing the chromatin state map for one sample. CSREP then generates as output (i) a summary probabilistic chromatin state assignment matrix and (ii) a summary state map track for the group. The summary state assignment matrix represents the probabilities of each state being present at each genomic position in a new sample of that group. To generate these, CSREP takes a supervised learning approach, leveraging information about the co-occurrence of states from the different samples across the genome. Specifically, for each group of input samples, CSREP trains an ensemble of <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> multi-class logistic regression classifiers (<xref rid="btac722-B12" ref-type="bibr">Hastie <italic toggle="yes">et al.</italic>, 2009</xref>), where <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> is the number of samples in the group, to generate probabilistic predictions for each chromatin state at each position (<xref rid="btac722-F1" ref-type="fig">Fig. 1A</xref>, Section 2). We used multi-class logistic regression classifiers since they provide well-calibrated probabilities, are robust, and relatively fast to train. Each classifier is trained with <italic toggle="yes">labels</italic> based on the chromatin state assignments from one sample and <italic toggle="yes">features</italic> based on the chromatin state assignments in other samples for the same genomic positions. Each classifier then makes a probabilistic prediction of the chromatin state assigned at each genomic position in the target sample. The chromatin state input features to each logistic regression classifier are represented with a one-hot-encoding of the chromatin states. The classifiers are trained on randomly selected genomic positions that constitute 10% of the genome, while the predictions are calculated genome-wide. The resolution of predictions is the same as that of input samples’ chromatin state maps (200 bp with default settings for ChromHMM). The prediction results for each sample’s chromatin state map are represented in a matrix with <italic toggle="yes">rows</italic> corresponding to genomic positions and <italic toggle="yes">columns</italic> chromatin states. The values in each row, which sum to 1, represent the probabilities of state assignments at a genomic position. The probabilistic summary of a group is based on averaging the prediction output matrices for each sample in the group. These probabilistic predictions are then used to generate a summary chromatin state map for the group of samples by assigning the state with maximum assignment probability to each genomic position (<xref rid="btac722-F1" ref-type="fig">Fig. 1A</xref>, Section 2).</p>
      <fig position="float" id="btac722-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>Overview of CSREP. (<bold>A</bold>) CSREP uses an ensemble of multi-class logistic regression models. In each model, the chromatin state map at the target sample is predicted based on the one-hot encoding of chromatin state assignments at the corresponding genomic positions in other samples. Multi-class logistic regression outputs the probabilities that each genomic position (row) in the target sample will be assigned to each state (column). CSREP averages the prediction matrices for target samples, to output the summary state assignment probability matrix. Sam., sample; <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mi mathvariant="normal">P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi mathvariant="italic">i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math></inline-formula> probability that genomic position <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is annotated as state <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula>. (<bold>B</bold>) The operations to obtain differential chromatin state scores between two groups with multiple samples. CSREP calculates the summary chromatin state assignment matrices for two groups and then subtracts one group’s summary matrix from the other’s to obtain differential chromatin scores. Differential chromatin scores are bounded between −1 and 1. (<bold>C</bold>) Visualization of CSREP’s output in a genomic region (hg19, chr5:156012600–156022400). The top of the subpanel shows the CSREP’s summary chromatin state probabilities for 18 states across 7 Brain reference epigenomes. Each track shows the probabilities of assignment for one state, as named and colored on the left. The middle subpanel shows the 18-state chromatin state maps for 7 Brain samples and 5 ESC samples from Roadmap Epigenomics (<xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>), and the CSREP’s output summary chromatin state maps for each group, boxed. States are colored as in legends at the left of this subpanel. The last subpanel shows the differential chromatin scores when Brain’s summary state probabilities are subtracted from ESC’s (ESC—Brain). Each track shows one state’s differential scores. Scores between 0 and 1 are shown above each track, while those between −1 and 0 are below the corresponding track. This region is also shown in an expanded format in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref></p>
        </caption>
        <graphic xlink:href="btac722f1" position="float"/>
      </fig>
      <p>CSREP’s summary probabilistic predictions can be directly used to generate differential chromatin state maps for two groups with multiple samples, where the input samples from both groups share the same internally consistent set of defined chromatin states. This is achieved by subtracting the summary chromatin state assignment matrix of one group (first group) from the other’s (second group) (<xref rid="btac722-F1" ref-type="fig">Fig. 1B</xref>, Section 2). At each genomic position, CSREP’s chromatin differential scores for individual chromatin states are bounded between −1 and 1. A score of 1 for state <inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> means state <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> was predicted to be the annotation for the first and second groups with probability 1 and 0, respectively, and vice versa for −1 (<xref rid="btac722-F1" ref-type="fig">Fig. 1B and C</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>). Overall, in addition to summarizing the state assignments for groups of samples, CSREP can calculate scores of differential chromatin state assignments for pairs of groups at the resolution of the input chromatin state maps.</p>
      <fig position="float" id="btac722-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Performance of CSREP in summarizing multiple samples’ chromatin state maps from a group. (<bold>A</bold>) Visualization of one arbitrarily selected 500-kb region (chr5: 42821109–43321109, hg19). The first 10 tracks show chromatin state maps of 10 samples of the Digestive group from the Roadmap Epigenomics Consortium, which were input to CSREP. The following track shows the summary chromatin state map from CSREP, which shows strong agreement with the input. States are colored based on the legend on the lower left. In the following 18 tracks, each track shows CSREP’s probabilities of assignment for each of 18 states, with the state annotations shown in the legend on left. (<bold>B</bold>) Boxplots showing the CSREP and base_count methods’ average, range and 25, 75% quantiles of the AUROCs across 64 samples, for each of the 18 chromatin states. The AUROCs were calculated in leave-one-out cross-validation analysis where we used a group’s summary probabilistic chromatin state map to predict genomic locations of individual chromatin states in a left-out sample from the same cell/tissue group (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). States 1–18 (x-axis) are annotated as in (A). (<bold>C</bold>) Boxplots showing the Spearman correlations between a group of samples’ (1) summary probabilities of state 1_TssA (active TSS) at annotated TSSs and (2) the corresponding group’s average gene expression (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We obtained the correlations for 8 groups of cell types from the Roadmap Epigenomics Project and 65 groups from EpiMap. Each dot shows the Spearman correlation for data from a group of samples. Results of paired <italic toggle="yes">t</italic>-test to compare CSREP versus base_count’s output correlations are shown on top. The alternative hypothesis for the <italic toggle="yes">t</italic>-test is that correlations resulted from CSREP are higher than those from base_count (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>)</p>
        </caption>
        <graphic xlink:href="btac722f2" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 CSREP is predictive of chromatin states on held-out samples</title>
      <p>We applied CSREP to a compendium of 18-state chromatin state maps for 64 samples (reference epigenomes) from 11 tissue groups generated by the Roadmap Epigenomics Project (<xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>). The tissue groups include embryonic stem cells (ESCs), induced pluripotent stem cells (iPSC), ESC-derived cells, blood &amp; T-cells, HSC &amp; B-cells, epithelial, brain, muscle, heart, smooth muscle and digestive. The number of input samples for each tissue group ranges from 3 to 12 (Additional File 2). We provide CSREP’s genome-wide summary probabilistic and state assignments for the 11 tissue groups (Data availability). Given our computing configuration, the run-time for CSREP to jointly preprocess input data for all 64 samples was ∼40 min, and then the time to output the predictions for each group ranged from ∼1 to 3 h (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>).</p>
      <p>We first visualized CSREP’s summary chromatin state maps for groups of samples from digestive and heart tissue groups, which have 10 and 3 samples, respectively (<xref rid="btac722-F2" ref-type="fig">Fig. 2A</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S4–S7</xref>). We arbitrarily selected four 500-kb regions and for each group, we visualized the input chromatin state maps and CSREP’s output probabilistic state estimates and summary state map at such genomic windows. We observed expected correspondences between the groups’ input and output chromatin state assignment estimates (<xref rid="btac722-F2" ref-type="fig">Fig. 2A</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S4–S7</xref>). We also visualized CSREP’s summary chromatin state maps at the loci of two genes that had distinctly higher expression in Digestive and Brain cell types, LGALS4 and MT3, respectively, which highlighted the corresponding groups’ differences in the summary chromatin state maps (<xref rid="btac722-B11" ref-type="bibr">GTEx Consortium, 2020</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S8–S10</xref>).</p>
      <p>To quantitatively evaluate CSREP’s summary output for a group of samples, we evaluated the accuracy of CSREP’s summary probabilistic chromatin state predictions in a leave-one-out cross-validation analysis. In particular, for each chromatin state, we calculated the area under the receiver operating characteristic curve (AUROC) for predicting genomic locations assigned to the state in a held-out sample, based on the summary chromatin state maps generated from data in other samples from the group (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We compared the performance of CSREP against a baseline method, denoted base_count (short for counting-based baseline method), which counts each state’s frequency across input samples at each genomic position (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>).</p>
      <p>CSREP showed strong predictive performance for chromatin states in left-out samples with average AUROCs across 64 samples varying from 0.871 to 0.993 for the 18 states. Across the 18 states, CSREP consistently had better AUROC in recovering individual states compared to the baseline method base_count (<xref rid="btac722-F2" ref-type="fig">Fig. 2B</xref>). The average AUROC improvement by CSREP compared to base_count ranged from 0.003 (for state 18_Quies) to 0.157 (for state 4_TssFlnkD). Larger performance improvements by CSREP relative to base_count were observed for all chromatin states when there are fewer input samples in the group (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S11</xref>).</p>
    </sec>
    <sec>
      <title>3.3 CSREP’s summary chromatin state maps’ association with gene expression</title>
      <p>Transcription start sites (TSS) are marked by various histone modifications and variants that can correlate with transcription (<xref rid="btac722-B17" ref-type="bibr">Kimura, 2013</xref>; <xref rid="btac722-B23" ref-type="bibr">Soboleva <italic toggle="yes">et al.</italic>, 2014</xref>). Here, we evaluated how CSREP’s summary state map for a tissue group is predictive of the group’s gene expression profiles at the TSS of genes. First, we obtained gene expression data for available samples for the 11 tissue groups mentioned above and calculated the average protein-coding gene expression for each group (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). Of the 11 groups, 8 had gene expression data available for at least one sample (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We then calculated the Spearman correlation between (i) the group’s average expression for protein-coding genes and (ii) CSREP’s summary state assignment probabilities for state 1_TssA (active TSS state) at the corresponding genes’ TSSs. We did the same evaluation for base_count. CSREP had significantly higher correlations than base_count (<xref rid="btac722-F2" ref-type="fig">Fig. 2C</xref>, paired <italic toggle="yes">t</italic>-test <italic toggle="yes">P</italic>-value &lt; 0.0062, average 0.65 versus 0.59, <xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We next extended this analysis for a larger dataset of 552 samples in 75 groups from EpiMap repository based on state 1_TssA from the same 18-state annotations (<xref rid="btac722-B2" ref-type="bibr">Boix <italic toggle="yes">et al.</italic>, 2021</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). The 75 groups were previously formed based on tissue types and developmental stages with the number of samples per group ranging from 3 to 38 (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>, Additional File 2). Of the 75 groups, 65 also had gene expression data available for at least one sample. Across these 65 groups, again CSREP had significantly higher correlations than base_count (<xref rid="btac722-F2" ref-type="fig">Fig. 2C</xref>, paired <italic toggle="yes">t</italic>-test <italic toggle="yes">P</italic>-value &lt; 2.2e-16, average 0.63 versus 0.59, <xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). Overall, CSREP’s summary chromatin state maps at TSS for the TssA state show significantly higher correspondence with gene expression levels compared to the base_count method.</p>
    </sec>
    <sec>
      <title>3.4 CSREP detects differential chromatin regions associated with different sexes</title>
      <p>We next investigated the performance of CSREP at identifying biologically meaningful chromatin state changes between groups of Male and Female samples based on its ability to prioritize chromatin state differences on chromosome X (chrX) relative to autosomal chromosomes. Specifically, we applied CSREP to calculate differential chromatin state scores between 25 Female and 44 Male samples from Roadmap Epigenomics (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>) (<xref rid="btac722-B10" ref-type="bibr">Ge <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="btac722-B27" ref-type="bibr">Yen and Kellis, 2015</xref>) by subtracting CSREP’s summary state probability matrix for the Female samples from the corresponding matrix for the Male samples.</p>
      <p>We analyzed CSREP’s differential scores for all chromatin states across autosomal chromosomes and chrX (<xref rid="btac722-F3" ref-type="fig">Fig. 3A</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S12 and S13</xref>). Three states with the largest magnitude of difference in mean Male–Female differential scores between chrX and autosomes were states 13_Het (heterochromatin, marked by H3K9me3), 17_ReprPCWk (weak polycomb repressive complex) and 18_Quies (quiescent) (Supplementary Fig. S13). In contrast, active promoter/enhancer states showed minimal difference in the distribution of Male–Female differential scores for chrX versus autosomes (<xref rid="btac722-F3" ref-type="fig">Fig. 3A</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S12 and S13</xref>). In chrX, compared to autosomal chromosomes, the distribution of differential scores for states 13_Het and 17_ReprPCWk showed a larger tail of negative values. ChrX’s average score minus the autosomes’ average score values for states 13_Het and 17_ReprPCWk were −0.039 and −0.054, respectively (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S13</xref>), implying that on chrX, Female samples are more often assigned to these states compared to Male samples. State 18_Quies showed the opposite trend with a difference of 0.11 (<xref rid="btac722-F3" ref-type="fig">Fig. 3A</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S13</xref>). These results are consistent with sex-specific chrX inactivation, which is used in Female mammals to achieve dosage compensation between the two sexes (<xref rid="btac722-B25" ref-type="bibr">Wutz, 2011</xref>; <xref rid="btac722-B27" ref-type="bibr">Yen and Kellis, 2015</xref>).</p>
      <fig position="float" id="btac722-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>CSREP shows signals of differential chromatin state scores in chrX when comparing Male and Female samples. (<bold>A</bold>) Each subpanel shows the histogram of CSREP’s differential scores in autosomes and chrX, for states associated with heterochromatin (13_Het), weak polycomb repressed domains (17_ReprPCWk), quiescent regions (18_Quies), and active transcription start site (1_TssA). The x-axis shows differential scores, with positive values implying Male samples have higher probabilities of being in the state compared to Female samples, and vice versa for negative values. Histograms of scores for all states are in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S12</xref>. (<bold>B</bold>) AUROCs of recovering regions overlapping annotated TSSs on chrX, using differential chromatin scores of three states as in (A), outputted by CSREP, base_count, SCIDDO, Mann–Whitney <italic toggle="yes">U</italic>-test (based on ChromDiff) and Fisher’s Exact test (based on EpiCompare) for Male and Female groups (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). The AUROCs based on Mann–Whitney <italic toggle="yes">U</italic>-test showed values close to those based on base_count, hence the plotted average AUROCs from these two methods were overlapping. We calculated the AUROCs using different sets of input Male and Female samples, with varying numbers of samples in each group (x-axis). For each number of samples (x-axis), we conducted the analysis for 30 sets of Male and Female input samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). The plots show the average (dots) and standard deviation (error bars) of the AUROCs across the 30 sets of input samples. SCIDDO did not successfully generate output for the case of 15 input samples, thus no results are reported for that</p>
        </caption>
        <graphic xlink:href="btac722f3" position="float"/>
      </fig>
      <p>We next compared the performance of CSREP and other methods in recovering annotated transcription start sites (TSSs) on chrX, using the above-mentioned states, given varying numbers of input samples (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>, <xref rid="btac722-F3" ref-type="fig">Fig. 3B</xref>). To do this, we randomly selected 30 subsets of size <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> Male and <inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> Female samples from the set of available 44 Male and 25 Female samples, where <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> is varied within the set of 3, 5, 9, 12 or 15 samples. Given each set of input Male and Female samples, we calculated the AUROC when using differential chromatin scores between Male and Female groups to predict locations overlapping annotated TSSs on chrX, against the background of those overlapping all annotated TSSs in the genome (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). The methods we compared CSREP against include SCIDDO, the count difference from base_count, the Mann–Whitney <italic toggle="yes">U</italic>-test [used by ChromDiff (<xref rid="btac722-B27" ref-type="bibr">Yen and Kellis, 2015</xref>)], and the Fisher’s exact test [used by EpiCompare (<xref rid="btac722-B13" ref-type="bibr">He and Wang, 2017</xref>)] (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). The Mann–Whitney <italic toggle="yes">U</italic> and Fisher’s exact tests were applied at each genomic position, using two input sample groups’ chromatin state annotations at the respective position. We considered other related methods for detecting differential chromatin domains not appropriate for direct comparison against CSREP (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We observed that CSREP showed the largest advantage over other methods, as measured by AUROCs, when the number of input samples from Male and Female groups is relatively small, e.g. three samples in each group (<xref rid="btac722-F3" ref-type="fig">Fig. 3B</xref>). As the number of input samples from each group increases sufficiently, the overall performance advantage of CSREP relative to base_count, Mann–Whitney <italic toggle="yes">U</italic>-test and Fisher’s exact test goes away. In all cases, CSREP showed better performance compared to SCIDDO (<xref rid="btac722-B5" ref-type="bibr">Ebert and Schulz, 2021</xref>) (<xref rid="btac722-F3" ref-type="fig">Fig. 3B</xref>). Overall, CSREP showed the clearest advantage over other approaches when the number of samples is relatively small, which occurs frequently in practice.</p>
    </sec>
    <sec>
      <title>3.5 CSREP’s differential scores recover differential chromatin mark peaks</title>
      <p>We next analyzed how well CSREP’s differential chromatin state scores can predict genomic regions overlapping differential signals of DNase I hypersensitivity (DNase), H3K9ac and H3K27ac between samples from embryonic stem cell (ESC) and brain. DNase and H3K9ac signals were not used for learning the 18-state model used to annotate the two groups’ input samples, providing an independent validation. While H3K27ac was used in learning the input chromatin state maps, since all the methods being compared (CSREP, base_count, SCIDDO, Mann–Whitney <italic toggle="yes">U</italic>-test based on ChromDiff and Fisher’s exact test based on EpiCompare) had access to the same chromatin state maps as input, and H3K27ac is a well-established mark of cell-type-specific activity (<xref rid="btac722-B3" ref-type="bibr">Creyghton <italic toggle="yes">et al.</italic>, 2010</xref>), we still considered H3K27ac in the evaluations of methods’ performance.</p>
      <p>For each of the three chromatin marks, we first obtained a set of bases that overlap with peaks in all samples from ESC but not in any from the Brain group and vice versa (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>, Additional File 2). We then calculated CSREP and base_count differential chromatin scores by subtracting the summary chromatin state map of Brain from that of the ESC. Additionally, we applied SCIDDO, Mann–Whitney <italic toggle="yes">U</italic>-test (ChromDiff’s approach) and Fisher’s Exact test (EpiCompare’s approach) to the same set of input data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). We evaluated, in terms of AUROC, how well the methods prioritize regions overlapping bases in the ESC-/brain-specific sets of peaks (<xref rid="sup1" ref-type="supplementary-material">Supplementary Methods</xref>). For CSREP, base_count, Mann–Whitney <italic toggle="yes">U</italic>-test and Fisher’s exact test, we conducted separate evaluations for each chromatin state but did <italic toggle="yes">not</italic> for SCIDDO since it outputs one score track that measures the overall difference across the chromatin state landscape between the two groups.</p>
      <p>Across the different marks and groups (ESC-specific or Brain-specific peaks) we evaluated, CSREP’s differential scores from either promoter- or enhancer-associated states resulted in the highest AUROCs, with few exceptions (<xref rid="btac722-F4" ref-type="fig">Fig. 4</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>). For example, for identifying Brain-specific H3K9ac peaks, CSREP had an AUROC of 0.717 based on the evaluation with state 9_EnhA1, an active enhancer state, while the maximum AUROCs achieved for base_count, Mann–Whitney <italic toggle="yes">U</italic>-test, Fisher’s exact test and SCIDDO were 0.617, 0.636, 0.601 and 0.564, respectively. In total across the six evaluations, among the top-3 highest AUROCs per evaluation, 15 of the 18 AUROCs were based on CSREP’s differential scores for individual chromatin states (<xref rid="btac722-F4" ref-type="fig">Fig. 4</xref>). The AUROCs for states not usually associated with these marks (transcription, heterochromatin, repeats/ZNF gene, quiescent and polycomb repressed states) tended to be near 0.5 or in some cases lower (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>). These analyses suggest that CSREP differential scores tended to better correspond to locations of individual mark differences between two groups of samples genome-wide, compared to other approaches. Even though SCIDDO incorporated a measure of dissimilarity among states, it showed lower AUROCs compared to the maximum obtained by CSREP. This is potentially because SCIDDO outputs one score per genomic bin to measure the general difference across all states, while CSREP generates state-specific scores. Hence, CSREP should have better power to predict regions associated with differential signals of marks that are present in only specific states (e.g. H3K27ac is present in enhancer states but not in repressive states). Additionally, this may also be because CSREP produces scores that show the direction of differences (with positive/negative scores implying one group’s higher state assignment probabilities compared to the other’s) while SCIDDO’s scores do not have a specific direction associated with them.</p>
      <fig position="float" id="btac722-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>Evaluation of recovery of differential chromatin marks signals between ESC and Brain. The table shows AUROCs for differential scores’ predictions of genomic regions associated with differential peak signals for one chromatin mark, from left to right: DNase, H3K27ac and H3K9ac. For each chromatin mark, it shows the AUROCs of predicting signal peaks observed in Brain and ESC exclusively (Brain-spec and ESC-spec, respectively). Differential scores outputted by CSREP, base-count, Mann–Whitney <italic toggle="yes">U</italic>-test (used by ChromDiff) and Fisher’s exact test (used by EpiCompare) are shown for active promoter and enhancer associated chromatin states (rows). In each category of comparisons (a chromatin mark in either ESC or Brain), the top three scores that show the highest AUROCs are in bold and underlined. Along the bottom is the AUROC for SCIDDO. Only active promoter and enhancer states are expected to be associated with differential DNase, H3K27ac and H3K9ac signals, but the AUROCs corresponding to all states are shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S14</xref></p>
        </caption>
        <graphic xlink:href="btac722f4" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Here, we proposed CSREP, a method for probabilistically summarizing the chromatin state maps from a group of samples. CSREP achieves this by training multi-class logistic regression models to predict the chromatin state annotations of one sample using data from others, and then averaging the prediction probabilities across all samples in the group. CSREP outputs the probabilities of each chromatin state being assigned to each genomic position, at the same resolution that chromatin states are annotated. We applied CSREP to generate summary 18-state chromatin state assignment probability matrices for 11 groups of cell and tissue types from Roadmap Epigenomics Project (<xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>), and 75 groups of samples stratified by cell and tissue types and developmental phases from EpiMap (<xref rid="btac722-B2" ref-type="bibr">Boix <italic toggle="yes">et al.</italic>, 2021</xref>), and have made them publicly available (Data availability, Additional File 2).</p>
    <p>Our analyses reveal that CSREP’s probabilistic summary of state assignments better predicts the chromatin states of held-out samples compared to the counting-based baseline approach. We also showed that CSREP’s summary assignment probabilities of state 1_TssA at TSS were well correlated with the average gene expression of the group and significantly higher than those achieved by the counting-based baseline.</p>
    <p>CSREP can also be used to directly quantify the difference in chromatin state maps between two groups with multiple samples, at the resolution of the input annotations. CSREP produces differential scores for each chromatin state at each genomic position, which represent the difference in probabilities that samples from the two input groups are assigned to each specific state. Therefore, CSREP differential scores are bounded (−1 to 1), interpretable with respect to specific chromatin state changes, and indicative of the direction of change, which contrasts it with other approaches that provide a single score showing the magnitude of difference per genomic position. We used CSREP to compare the chromatin state annotations between Male and Female samples from Roadmap Epigenomics (<xref rid="btac722-B22" ref-type="bibr">Roadmap Epigenomics Consortium <italic toggle="yes">et al.</italic>, 2015</xref>) and showed that CSREP can better predict regions overlapping genes’ TSS on chrX, particularly when there are few samples in each group. CSREP’s differential scores for states associated with active enhancers and promoters better recovered tissue-group-specific peaks of DNase, H3K27ac and H3K9ac signals compared to alternative approaches, suggesting that CSREP provides useful additional information for analyzing epigenomic changes across tissue types.</p>
    <p>Here, we presented applications of CSREP on samples that were grouped based on cell and tissue types and based on sex. In general, CSREP assumes the dominant signal of any variation between groups is associated with the grouping variable of interest. In cases in which the experimental design used to collect the data cannot ensure this, other known covariates can be used to detect if there are potential confounders.</p>
    <p>CSREP works directly off of chromatin state annotations, which makes CSREP agnostic to the specific methods used to produce those annotations. Some methods for learning chromatin state annotations have the option to expose posterior probability estimates of annotations. However, in general, it is not clear how well calibrated those estimates will be, and assuming accurately determined posterior probability estimates are available as input would also make CSREP less generally applicable. A possible direction for future work would be to extend CSREP to make use of posteriors or possibly other information that CSREP does not directly consider, such as the individual mark signal in each sample.</p>
    <p>We note that CSREP’s summary chromatin state maps offer complementary benefits to the recently developed universal chromatin state annotation, which provides a single integrative annotation of the genome based on a model defined from over a 1000 epigenomic datasets from over 100 cell and tissue types (denoted the full-stack model) (<xref rid="btac722-B24" ref-type="bibr">Vu and Ernst, 2022</xref>). The full-stack model jointly captures activity across many diverse cell and tissue types and hence can capture annotations corresponding to both constitutive and cell-type-specific activities (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>). CSREP, on the other hand, provides a more direct and focused chromatin state annotation representative specifically of the individual input samples’ annotations.</p>
    <p>To facilitate the use of CSREP, we provide an implementation of CSREP as a snakemake pipeline (<xref rid="btac722-B18" ref-type="bibr">Köster and Rahmann, 2012</xref>; <xref rid="btac722-B20" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic>, 2021</xref>) with a detailed tutorial that only requires users to modify parameters in a yaml file. The program can be run either on local computers or on computing clusters, in which case snakemake will optimize the workflow for execution.</p>
    <p>We expect CSREP to be a useful tool and the CSREP output we provided to be a valuable resource for summarizing chromatin state maps from groups of samples, and for prioritizing regions with differential chromatin state changes across pairs of groups of samples.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac722_Supplementary_Data</label>
      <media xlink:href="btac722_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank members of the Ernst lab for their helpful suggestions on the manuscript.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by US National Institutes of Health [DP1DA044371, U01MH105578, UH3NS104095 and U01HG012079]; US National Science Foundation [1254200, 1705121 and 2125664]; Rose Hills Innovator Award, and the UCLA Jonsson Comprehensive Cancer Center and Eli and Edythe Broad Center of Regenerative Medicine and Stem Cell Research Ablon Scholars Program.</p>
      <p><italic toggle="yes">Conflict of Interest:</italic> none declared.</p>
    </sec>
  </ack>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The summary chromatin state maps (the chromatin state assignment matrices and the corresponding state annotation) for 11 tissue groups in Roadmap Epigenomics Project and 75 groups in EpiMap Portal are available for download with links from <ext-link xlink:href="https://github.com/ernstlab/csrep" ext-link-type="uri">https://github.com/ernstlab/csrep</ext-link>, and can be viewed on UCSC Genome Browser with the track hub link from <ext-link xlink:href="https://github.com/ernstlab/csrep" ext-link-type="uri">https://github.com/ernstlab/csrep</ext-link>. The summary state maps for samples in Roadmap Epigenomics and EpiMap are provided for both hg38 and hg19. Links to download all input data are provided in Additional File 2.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac722-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barski</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2007</year>) <article-title>High-resolution profiling of histone methylations in the human genome</article-title>. <source>Cell</source>, <volume>129</volume>, <fpage>823</fpage>–<lpage>837</lpage>.<pub-id pub-id-type="pmid">17512414</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Boix</surname><given-names>C.A.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Regulatory genomic circuitry of human disease loci by integrative epigenomics</article-title>. <source>Nature</source>, <volume>590</volume>, <fpage>300</fpage>–<lpage>307</lpage>.<pub-id pub-id-type="pmid">33536621</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Creyghton</surname><given-names>M.P.</given-names></string-name></person-group><etal>et al</etal> (<year>2010</year>) <article-title>Histone H3K27ac separates active from poised enhancers and predicts developmental state</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>107</volume>, <fpage>21931</fpage>–<lpage>21936</lpage>.<pub-id pub-id-type="pmid">21106759</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dale</surname><given-names>R.K.</given-names></string-name></person-group><etal>et al</etal> (<year>2011</year>) <article-title>Pybedtools: a flexible python library for manipulating genomic datasets and annotations</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>3423</fpage>–<lpage>3424</lpage>.<pub-id pub-id-type="pmid">21949271</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ebert</surname><given-names>P.</given-names></string-name>, <string-name><surname>Schulz</surname><given-names>M.H.</given-names></string-name></person-group> (<year>2021</year>) <article-title>Fast detection of differential chromatin domains with SCIDDO</article-title>. <source>Bioinformatics</source>, <volume>37</volume>, <fpage>1198</fpage>–<lpage>1205</lpage>.<pub-id pub-id-type="pmid">33232443</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B6">
      <mixed-citation publication-type="journal"><collab>ENCODE Project Consortium</collab> (<year>2012</year>) <article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source>, <volume>489</volume>, <fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2011</year>) <article-title>Mapping and analysis of chromatin state dynamics in nine human cell types</article-title>. <source>Nature</source>, <volume>473</volume>, <fpage>43</fpage>–<lpage>49</lpage>.<pub-id pub-id-type="pmid">21441907</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group> (<year>2012</year>) <article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>215</fpage>–<lpage>216</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group> (<year>2010</year>) <article-title>Discovery and characterization of chromatin states for systematic annotation of the human genome</article-title>. <source>Nat. Biotechnol</source>., <volume>28</volume>, <fpage>817</fpage>–<lpage>825</lpage>.<pub-id pub-id-type="pmid">20657582</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ge</surname><given-names>X.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>EpiAlign: an alignment-based bioinformatic tool for comparing chromatin state sequences</article-title>. <source>Nucleic Acids Res</source>., <volume>47</volume>, <fpage>e77–e77</fpage>.<pub-id pub-id-type="pmid">31045217</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B11">
      <mixed-citation publication-type="journal"><collab>GTEx Consortium</collab> (<year>2020</year>) <article-title>The GTEx consortium atlas of genetic regulatory effects across human tissues</article-title>. <source>Science</source>, <volume>369</volume>, <fpage>1318</fpage>–<lpage>1330</lpage>.<pub-id pub-id-type="pmid">32913098</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B12">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Hastie</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2009</year>) <source>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</source>. <publisher-name>Springer, New York</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btac722-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>He</surname><given-names>Y.</given-names></string-name>, <string-name><surname>Wang</surname><given-names>T.</given-names></string-name></person-group> (<year>2017</year>) <article-title>EpiCompare: an online tool to define and explore genomic regions with tissue or cell type-specific epigenomic features</article-title>. <source>Bioinformatics</source>, <volume>33</volume>, <fpage>3268</fpage>–<lpage>3275</lpage>.<pub-id pub-id-type="pmid">28605501</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hoffman</surname><given-names>M.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2012</year>) <article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>473</fpage>–<lpage>476</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jessa</surname><given-names>S.</given-names></string-name>, <string-name><surname>Kleinman</surname><given-names>C.L.</given-names></string-name></person-group> (<year>2018</year>) <article-title>Chromswitch: a flexible method to detect chromatin state switches</article-title>. <source>Bioinformatics</source>, <volume>34</volume>, <fpage>2286</fpage>–<lpage>2288</lpage>.<pub-id pub-id-type="pmid">29438498</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ji</surname><given-names>H.</given-names></string-name></person-group><etal>et al</etal> (<year>2013</year>) <article-title>Differential principal component analysis of ChIP-seq</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>110</volume>, <fpage>6789</fpage>–<lpage>6794</lpage>.<pub-id pub-id-type="pmid">23569280</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kimura</surname><given-names>H.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Histone modifications for human epigenome analysis</article-title>. <source>J. Hum. Genet</source>., <volume>58</volume>, <fpage>439</fpage>–<lpage>445</lpage>.<pub-id pub-id-type="pmid">23739122</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group> (<year>2012</year>) <article-title>Snakemake—a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Libbrecht</surname><given-names>M.W.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Segmentation and genome annotation algorithms for identifying chromatin state and other genomic patterns</article-title>. <source>PLoS Comput. Biol</source>., <volume>17</volume>, <fpage>e1009423</fpage>.<pub-id pub-id-type="pmid">34648491</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Research</source>, <volume>10</volume>, <fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Quinlan</surname><given-names>A.R.</given-names></string-name>, <string-name><surname>Hall</surname><given-names>I.M.</given-names></string-name></person-group> (<year>2010</year>) <article-title>BEDTools: a flexible suite of utilities for comparing genomic features</article-title>. <source>Bioinformatics</source>, <volume>26</volume>, <fpage>841</fpage>–<lpage>842</lpage>.<pub-id pub-id-type="pmid">20110278</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B22">
      <mixed-citation publication-type="journal"><collab>Roadmap Epigenomics Consortium</collab><etal>et al</etal> (<year>2015</year>) <article-title>Integrative analysis of 111 reference human epigenomes</article-title>. <source>Nature</source>, <volume>518</volume>, <fpage>317</fpage>–<lpage>330</lpage>.<pub-id pub-id-type="pmid">25693563</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Soboleva</surname><given-names>T.A.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Histone variants at the transcription start-site</article-title>. <source>Trends Genet</source>., <volume>30</volume>, <fpage>199</fpage>–<lpage>209</lpage>.<pub-id pub-id-type="pmid">24768041</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vu</surname><given-names>H.</given-names></string-name>, <string-name><surname>Ernst</surname><given-names>J.</given-names></string-name></person-group> (<year>2022</year>) <article-title>Universal annotation of the human genome through integration of over a thousand epigenomic datasets</article-title>. <source>Genome Biol</source>., <volume>23</volume>, <fpage>1</fpage>–<lpage>37</lpage>.<pub-id pub-id-type="pmid">34980209</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wutz</surname><given-names>A.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Gene silencing in X-chromosome inactivation: advances in understanding facultative heterochromatin formation</article-title>. <source>Nat. Rev. Genet</source>., <volume>12</volume>, <fpage>542</fpage>–<lpage>553</lpage>.<pub-id pub-id-type="pmid">21765457</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xie</surname><given-names>W.</given-names></string-name></person-group><etal>et al</etal> (<year>2013</year>) <article-title>Epigenomic analysis of multilineage differentiation of human embryonic stem cells</article-title>. <source>Cell</source>, <volume>153</volume>, <fpage>1134</fpage>–<lpage>1148</lpage>.<pub-id pub-id-type="pmid">23664764</pub-id></mixed-citation>
    </ref>
    <ref id="btac722-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yen</surname><given-names>A.</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group> (<year>2015</year>) <article-title>Systematic chromatin state comparison of epigenomes associated with diverse properties including sex and tissue type</article-title>. <source>Nat. Commun</source>., <volume>6</volume>, <fpage>1</fpage>–<lpage>13</lpage>.</mixed-citation>
    </ref>
    <ref id="btac722-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhu</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2013</year>) <article-title>Genome-wide chromatin state transitions associated with developmental and environmental cues</article-title>. <source>Cell</source>, <volume>152</volume>, <fpage>642</fpage>–<lpage>654</lpage>.<pub-id pub-id-type="pmid">23333102</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
