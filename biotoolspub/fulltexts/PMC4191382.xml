<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <?epub August-6-2014?>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="hwp">nar</journal-id>
    <journal-id journal-id-type="publisher-id">nar</journal-id>
    <journal-title-group>
      <journal-title>Nucleic Acids Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0305-1048</issn>
    <issn pub-type="epub">1362-4962</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4191382</article-id>
    <article-id pub-id-type="pmid">25100869</article-id>
    <article-id pub-id-type="doi">10.1093/nar/gku699</article-id>
    <article-categories>
      <subj-group subj-group-type="hwp-journal-coll">
        <subject>28</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Methods Online</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>leeHom: adaptor trimming and merging for Illumina sequencing reads</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Renaud</surname>
          <given-names>Gabriel</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stenzel</surname>
          <given-names>Udo</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
      <aff>Department of Evolutionary Genetics, Max Planck Institute for Evolutionary Anthropology, D-04103 Leipzig, Germany</aff>
    </contrib-group>
    <author-notes>
      <corresp id="COR1"><label>*</label>To whom correspondence should be addressed. Tel: +49 341 3550 500; Fax: +49 341 3550 555; Email: <email>kelso@eva.mpg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>13</day>
      <month>10</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>06</day>
      <month>8</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>06</day>
      <month>8</month>
      <year>2014</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>42</volume>
    <issue>18</issue>
    <fpage>e141</fpage>
    <lpage>e141</lpage>
    <history>
      <date date-type="accepted">
        <day>21</day>
        <month>7</month>
        <year>2014</year>
      </date>
      <date date-type="rev-recd">
        <day>28</day>
        <month>5</month>
        <year>2014</year>
      </date>
      <date date-type="received">
        <day>18</day>
        <month>4</month>
        <year>2014</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2014. Published by Oxford University Press on behalf of Nucleic Acids Research.</copyright-statement>
      <copyright-year>2014</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:title="pdf" xlink:type="simple" xlink:href="gku699.pdf"/>
    <abstract>
      <p>The sequencing of libraries containing molecules shorter than the read length, such as in ancient or forensic applications, may result in the production of reads that include the adaptor, and in paired reads that overlap one another. Challenges for the processing of such reads are the accurate identification of the adaptor sequence and accurate reconstruction of the original sequence most likely to have given rise to the observed read(s). We introduce an algorithm that removes the adaptors and reconstructs the original DNA sequences using a Bayesian maximum <italic>a posteriori</italic> probability approach. Our algorithm is faster, and provides a more accurate reconstruction of the original sequence for both simulated and ancient DNA data sets, than other approaches. leeHom is released under the GPLv3 and is freely available from: <ext-link ext-link-type="uri" xlink:href="https://bioinf.eva.mpg.de/leehom/">https://bioinf.eva.mpg.de/leehom/</ext-link></p>
    </abstract>
    <counts>
      <page-count count="7"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>cover-date</meta-name>
        <meta-value>13 October 2014</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>INTRODUCTION</title>
    <p>Recent improvements have increased the efficiency with which endogenous molecules from ancient samples can be made accessible for sequencing (<xref rid="B1" ref-type="bibr">1</xref>). However, the DNA molecules extracted from ancient samples are often short due to the degradation of DNA after the death of the organism and average length rarely exceeds 100 bp (<xref rid="B2" ref-type="bibr">2</xref>).</p>
    <p>As a consequence, read length usually exceeds the length of the DNA molecule, and the read contains both the sequence of the original molecule and also part of the adaptor sequence (see Figure <xref ref-type="fig" rid="F1">1</xref>). For paired-end reads that exceed the molecule length, both the forward and reverse reads will have the sequence of the same original molecule before showing residual adaptor sequence. Similarly, molecules that are shorter than the sum of the forward and reverse read length are expected to show identical bases at the ends of both reads since the same part of the molecule is read twice. Merging of identical sequences is also expected to reduce sequencing error due to the repeated observation of the same base. Since residual adaptor sequences in the reads interfere with mapping and assembly, it is necessary to trim reads up to the start of the original molecule.</p>
    <fig id="F1" position="float">
      <label>Figure 1.</label>
      <caption>
        <p>Schematic representation of paired-end sequencing for very short molecules. (a) When the molecule is shorter than the read length, both reads will run into the adaptors and the remaining part will completely overlap. (b) If the sequence is longer but still not longer than twice the read length, adaptor sequences will be absent but a partial overlap can be observed between the end of the sequences.</p>
      </caption>
      <graphic xlink:href="gku699fig1"/>
    </fig>
    <p>Several algorithms have been implemented to trim adaptor sequences (see (<xref rid="B3" ref-type="bibr">3</xref>,<xref rid="B4" ref-type="bibr">4</xref>) and <ext-link ext-link-type="uri" xlink:href="http://code.google.com/p/ea-utils/wiki/FastqMultx">http://code.google.com/p/ea-utils/wiki/FastqMultx</ext-link>) and to merge overlapping paired-end sequences (see (<xref rid="B5" ref-type="bibr">5</xref>,<xref rid="B6" ref-type="bibr">6</xref>) and <ext-link ext-link-type="uri" xlink:href="https://github.com/jstjohn/SeqPrep">https://github.com/jstjohn/SeqPrep</ext-link>). However, these algorithms use cutoffs for detecting adaptors and merging reads and need to be adapted to varying rates of sequencing errors. More liberal cutoffs can lead to a greater number of false positives. Other algorithms (<xref rid="B7" ref-type="bibr">7</xref>–<xref rid="B9" ref-type="bibr">9</xref>) have been designed to merge overlapping pairs but do not provide the likelihood of seeing the adaptor at the end of both reads. Furthermore, sequencing centers often give end-users sequencing data with the adaptors already trimmed and including the likelihood of sequencing the adaptor becomes impossible or use this information to reconstruct very short molecules.</p>
    <p>We present a new Bayesian maximum <italic>a posteriori</italic> trimming and merging algorithm, leeHom, that is particularly useful for ancient DNA (aDNA) and other cases where short molecules are sequenced. Instead of separating the processes of adaptor trimming and merging, leeHom considers both steps into a single probabilistic model. Briefly, leeHom computes the probability of observing the reads given a certain original molecule length and returns the most likely one. Our algorithm is highly robust to sequencing error, produces few false positives and is able to handle common sequencing problems, such as missing cycles. The algorithm was tested on a set of simulated aDNA sequences where the original molecule sequenced was known, and on Neandertal sequence data. Our results show that leeHom outperforms currently available software in speed and accuracy for both simulated and real aDNA data, and that it is suitable for processing large volumes of sequence data. It can take unaligned BAM or fastq files as input and requires the sequence of the adaptors be provided.</p>
  </sec>
  <sec sec-type="materials|methods" id="SEC2">
    <title>MATERIALS AND METHODS</title>
    <sec id="SEC2-1">
      <title>Computation of the likelihood for a given sequence length</title>
      <p>Our approach relies on computing the probability of observing a pair of reads assuming that the original molecule is of a certain length. A similar maximum likelihood approach for paired-end reads was used in the literature for assembling 16S rRNA or polymerase chain reaction product flanked by primer sequences using partially overlapping paired-end reads (see (<xref rid="B7" ref-type="bibr">7</xref>)). Apart from computing the likelihood of all possible overlapping sequence lengths, the likelihood of stemming from non-overlapping pairs is also computed, thus removing the need for hard cutoffs. Furthermore, a probabilistic prior of seeing a sequence of a certain length can be added.</p>
      <p>Given that we have sequenced paired-end reads <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub>, we assume that if the original sequence was shorter than the read length, each read will have, at the end, the sequences of the adaptors: <italic>a</italic><sub>1</sub> and <italic>a</italic><sub>2</sub>, respectively. We define <italic>l</italic><sub>1</sub> = length(<italic>r</italic><sub>1</sub>) and <italic>l</italic><sub>2</sub> = length(<italic>r</italic><sub>2</sub>). The probability of observing this data given that we assume that the original sequence was of length <italic>i</italic>, denotated as <italic>P</italic>(<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>, <italic>a</italic><sub>1</sub>, <italic>a</italic><sub>2</sub>|<italic>i</italic>), can be computed using the following formula:
<disp-formula id="M1"><label>(1)</label><tex-math id="M19">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{eqnarray*} &amp;&amp;P(a_1 \approx r_1[i-1..]) \cdot P(r_1[1..i-1] \approx \nonumber \\ &amp;&amp;\overline{r_2}[1..i-1]) \cdot P(a_2 \approx \overline{r_2}[i-1..]) \end{eqnarray*}\end{document}</tex-math></disp-formula>where <italic>P</italic> represents the probability, <inline-formula><tex-math id="M20">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\overline{r_2}$\end{document}</tex-math></inline-formula> is the reverse complement of <italic>r</italic><sub>2</sub>, the [<italic>i</italic>..] and [1..<italic>i</italic> − 1] operators denote the suffix starting at position <italic>i</italic> and the prefix ending before position <italic>i</italic>, respectively, and where an end index greater than the start one represents an empty string. The first and last terms correspond to the probability of observing <italic>r</italic><sub>1</sub>[<italic>i</italic>..] and <inline-formula><tex-math id="M21">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\overline{r_2}[i..]$\end{document}</tex-math></inline-formula> given that the templates were <italic>a</italic><sub>1</sub> and <italic>a</italic><sub>2</sub>, respectively. The middle term corresponds to the probability of observing the stretches <italic>r</italic><sub>1</sub>[1..<italic>i</italic> − 1] and <inline-formula><tex-math id="M22">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\overline{r_2}[1..i-1]$\end{document}</tex-math></inline-formula> given that they stemmed from a common sequence. The specific equations for those two probability functions are defined in greater detail below. This probability is computed from for every <italic>i</italic> ∈ 0...<italic>l</italic><sub>1</sub> + <italic>l</italic><sub>2</sub>. The posterior probability of any length being <italic>i</italic> given the data can be described using the following expression:
<disp-formula id="M2"><label>(2)</label><tex-math id="M23">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P(i|r_1,r_2,a_1,a_2) \propto P(r_1,r_2,a_1,a_2|i) \cdot P(i) \end{equation*}\end{document}</tex-math></disp-formula>The prior on the sequence length <italic>i</italic> is defined using the probability density function of the log-normal distribution given by:
<disp-formula id="M3"><label>(3)</label><tex-math id="M24">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P(i) = \frac{1}{i \sqrt{2\pi } \sigma } e^{ - \frac{({\rm ln}(i) - \mu )^2 }{2 \sigma ^2} } \end{equation*}\end{document}</tex-math></disp-formula>The term above models the likelihood of seeing that particular sequence size given a prior belief on the sequence size distribution. To find the most suitable distribution to model the length of DNA sequences, various heavy-tail distribution were compared using the maximum likelihood fit from the Fitdistrplus R package (<ext-link ext-link-type="uri" xlink:href="http://cran.r-project.org/web/packages/fitdistrplus/">http://cran.r-project.org/web/packages/fitdistrplus/</ext-link>) and the one maximizing the likelihood of the fit was log-normal (data not shown). To illustrate how the shape of the prior changes from modern to aDNA sequences, the log-normal distribution for both a modern and aDNA data set was computed (see Figure <xref ref-type="fig" rid="F2">2</xref>). Users also have the option of using a uniform prior on the sequence length if the size distribution of the sequences is unknown.</p>
      <fig id="F2" position="float">
        <label>Figure 2.</label>
        <caption>
          <p>Empirical (black) and theoretical (red) length distributions of ancient and modern DNA libraries. Presented is the output of the maximum likelihood fit from the Fitdistrplus R package using a log-normal distribution for an aDNA library (left) and a modern DNA library (right). aDNA molecules tend to be of shorter length with a much narrower variance than modern DNA.</p>
        </caption>
        <graphic xlink:href="gku699fig2"/>
      </fig>
      <p>leeHom aims at finding the original sequence length <italic>i</italic><sub>max</sub> that maximize the likelihood of observation of <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub>:
<disp-formula><tex-math id="M25">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} i_{{\rm max}} = {\rm argmax}_{i \in \lbrace 0...l_1 + l_2\rbrace } P(i|r_1,r_2,a_1,a_2) \end{equation*}\end{document}</tex-math></disp-formula>and returns the most likely bases for the sequence of length <italic>i</italic><sub>max</sub>.</p>
      <p>To compute <italic>P</italic>(<italic>a</italic><sub>1</sub> ≈ <italic>r</italic><sub>1</sub>[<italic>i</italic>..]) and <italic>P</italic>(<italic>a</italic><sub>2</sub> ≈ <italic>r</italic><sub>2</sub>[<italic>i</italic>..]), we use a string comparison that disallows insertions/deletions while tolerating mismatches. The probability of seeing a substring of a read <italic>r</italic>[<italic>i</italic>..] given that an adaptor <italic>a</italic> was the template is given by the product of the likelihood for each base:
<disp-formula id="M4"><label>(4)</label><tex-math id="M26">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P(a \approx r[i-1..]) = \prod _{k=i-1}^{k={\rm length}(r)} P_{{\rm match}} (a[k-i+1],r[k]) \end{equation*}\end{document}</tex-math></disp-formula>where <italic>P</italic><sub>match</sub> is the likelihood of match for two bases. Let <italic>q</italic>[<italic>i</italic>] be the quality score associated with base <italic>r</italic>[<italic>i</italic>], the probability of sequencing error for a given quality score <italic>q</italic>[<italic>k</italic>] is defined as follows:
<disp-formula id="M5"><label>(5)</label><tex-math id="M27">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p_e(q[k]) = 10^{\frac{-q[k]}{10}} \end{equation*}\end{document}</tex-math></disp-formula>Therefore, the probability of observing <italic>r</italic>[<italic>k</italic> + <italic>i</italic>] given that the correct nucleotide is <italic>a</italic>[<italic>k</italic>] is computed as follows:
<disp-formula id="M6"><label>(6)</label><tex-math id="M28">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P_{{\rm match}} (a[k],r[k+i]) = \left\lbrace \begin{array}{ll}1-p_e(q[k]) &amp; \text{if } a[k] = r[k+i] \\ p_e(q_k) \cdot \frac{1}{3} &amp; \text{if } a[k] \ne r[k+i] \\ \frac{1}{4} &amp; \text{if } k &gt; {\rm length}(a) \\ \end{array}\right. \end{equation*}\end{document}</tex-math></disp-formula>Equation <xref ref-type="disp-formula" rid="M6">(6)</xref> assumes that the probability of error given a certain sequenced base represents the probability of miscalling the base to any other base with equal probability.</p>
      <p>The likelihood of the overlap <inline-formula><tex-math id="M29">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$P(r_1[1..i-1] \approx \overline{r_2}[1..i-1])$\end{document}</tex-math></inline-formula>, is defined as the probability of having seen both substrings given that they stemmed from the same DNA sequence. Assuming that each base is independent of the remaining ones, the likelihood for each base can therefore be multiplied as such:
<disp-formula id="M7"><label>(7)</label><tex-math id="M30">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P(r_1[1..i-1] \approx \overline{r_2}[1..i-1]) = \prod _{k=1}^{k=i-1} P_{{\rm overlap}} ( r_1[k] , \overline{r_2}[k] ) \end{equation*}\end{document}</tex-math></disp-formula>Given that the strings <italic>r</italic><sub>1</sub> and <inline-formula><tex-math id="M31">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\overline{r_2}$\end{document}</tex-math></inline-formula> have the associated quality scores <italic>q</italic><sub>1</sub> and <inline-formula><tex-math id="M32">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\overline{q_2}$\end{document}</tex-math></inline-formula>, the likelihood of two bases from two different reads stemming from the same original base is given by marginalizing the probabilities for each potential nucleotide that could have been this original nucleotide multiplied by the respective probability of observation of the two sequenced nucleotides:
<disp-formula id="M8"><label>(8)</label><tex-math id="M33">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} P_{{\rm overlap}} ( r_1[k] , \overline{r_2}[k] ) = \sum _{n \in \left\lbrace A,C,G,T \right\rbrace } P_{{\rm obs}}(n) \cdot P_{{\rm obs}}(r_1,\overline{r_2}|n) \end{equation*}\end{document}</tex-math></disp-formula>where <italic>P</italic><sub>obs</sub>(<italic>n</italic>) representing the likelihood of observing nucleotide <italic>n</italic> in the original overlapping sequence, approximated to <inline-formula><tex-math id="M34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\frac{1}{4}$\end{document}</tex-math></inline-formula> for ∀<italic>n</italic> ∈ {<italic>A</italic>, <italic>C</italic>, <italic>G</italic>, <italic>T</italic>}. The second term (<inline-formula><tex-math id="M35">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$P_{{\rm obs}}(r_1,\overline{r_2}|n)$\end{document}</tex-math></inline-formula>) can be quantified as follows:
<disp-formula id="M9"><label>(9)</label><tex-math id="M36">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} \left\lbrace \begin{array}{llll}(1-p_e( q_1[k] )) &amp; \cdot &amp; (1-p_e(q_2[k])) &amp; \text{if } r_1[k] = \overline{r_2}[k] \wedge r_1[k] = n \\ (1-p_e( q_1[k] )) &amp; \cdot &amp; (p_e(q_2[k])) \cdot \frac{1}{3} &amp; \text{if } r_1[k] \ne \overline{r_2}[k] \wedge r_1[k] = n \\ (p_e( q_1[k] )) \cdot \frac{1}{3} &amp; \cdot &amp; (1-p_e(q_2[k])) &amp; \text{if } r_1[k] \ne \overline{r_2}[k] \wedge \overline{r_2}[k] = n \\ (p_e( q_1[k] )) \cdot \frac{1}{3} &amp; \cdot &amp; (p_e(q_2[k])) \cdot \frac{1}{3} &amp; \text{if } r_1[k] \ne n \wedge \overline{r_2}[k] \ne n \\ \end{array}\right. \end{equation*}\end{document}</tex-math></disp-formula>Again, we assume that a sequencing error is equally likely to produce any nucleotide besides the correct one.</p>
      <p>Once again, leeHom aims at finding the sequence length <italic>i</italic> that maximizes Equation <xref ref-type="disp-formula" rid="M1">(1)</xref>. However, different values of <italic>i</italic> can be equally likely. To avoid incorrect reconstructions due to multiple sequence lengths that are equally likely, we avoid reconstructing sequences where the ratio of the likelihoods of the second most likely sequence length to the most likely one exceeds 1 in 20. This ensures that the most likely sequence has to be several fold more likely than the second-best option. As mentioned before, the likelihood of having no overlap and, therefore, having a sequence length exceeding twice the read length is also computed as follows:
<disp-formula id="M10"><label>(10)</label><tex-math id="M37">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} \int _{l_1 + l_2} ^{\infty } \frac{1}{x \sqrt{2\pi } \sigma } e^{ - \frac{({\rm ln}(x) - \mu )^2 }{2 \sigma ^2} } \cdot \prod _{l_1 + l_2} P_{{\rm obs}}(n) \end{equation*}\end{document}</tex-math></disp-formula>where <italic>P</italic><sub>obs</sub>(<italic>n</italic>) is defined as in Equation <xref ref-type="disp-formula" rid="M8">(8)</xref>. The prior (<inline-formula><tex-math id="M38">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\int _{l_1 + l_2} ^{\infty } \frac{1}{x \sqrt{2\pi } \sigma } e^{ - \frac{({\rm ln}(x) - \mu )^2 }{2 \sigma ^2} }$\end{document}</tex-math></inline-formula>) on the sequence length represents the probability of generating a sequence longer than <italic>l</italic><sub>1</sub> + <italic>l</italic><sub>2</sub> and can be interpreted as 1 − cdf(<italic>l</italic><sub>1</sub> + <italic>l</italic><sub>2</sub>), where cdf() is the cumulative distribution function for the aforementioned log-normal distribution. The resulting value is compared with the remaining likelihood values for sequence lengths.</p>
    </sec>
    <sec id="SEC2-2">
      <title>Consensus of overlapping regions</title>
      <p>Once the most likely sequence length has been computed, the remaining task is to assemble the sequence using the information provided by <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub>. If a base has been covered in only one read, it is reported along with the original quality score. However, if the base is covered by both reads, a consensus base with its associated quality score is produced. Again, we assume a principle of independent observations with quantified error probabilities given by the quality scores to produce both quantities.</p>
      <p>Let two sequenced bases <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub> with quality scores on the PHRED scale <italic>q</italic><sub>1</sub> and <italic>q</italic><sub>2</sub>, respectively. For any given nucleotide <italic>n</italic> ∈ {<italic>A</italic>, <italic>C</italic>, <italic>G</italic>, <italic>T</italic>} that we believe to be the actual base, the probability of observing <italic>b</italic><sub>1</sub> can be computed by the following:
<disp-formula id="M11"><label>(11)</label><tex-math id="M39">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(b_1|n) = \left\lbrace \begin{array}{@{}l@{\quad }l@{}}1-p_e(q_1) &amp; \text{if } b_1 = n \\ \frac{p_e(q_1)}{3} &amp; \text{if } b_1 \ne n \\ \end{array}\right. \end{equation*}\end{document}</tex-math></disp-formula>Assuming that both bases <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub> represent independent observations, we can define the probability of <italic>n</italic> given <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub>:
<disp-formula id="M12"><label>(12)</label><tex-math id="M40">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(b_1,b_2|n) = p(b_1|n) \cdot p(b_2|n) \end{equation*}\end{document}</tex-math></disp-formula>For calling the consensus base we seek to compute the likelihood of a nucleotide <italic>n</italic> given the observation <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub>. This can be computed using Bayes’ rule:
<disp-formula id="M13"><label>(13)</label><tex-math id="M41">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(n|b_1,b_2) = \frac{p(b_1,b_2|n) \cdot p(n)}{p(b_1,b_2)} \end{equation*}\end{document}</tex-math></disp-formula>The probability of having observed <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub> can be computed by summing the probability of having generated both bases given that we believe that they came from the same base. Since there are only four possibilities for this base, the following equation can be used:
<disp-formula id="M14"><label>(14)</label><tex-math id="M42">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p(b_1,b_2) = \sum _{m \in \left\lbrace A,C,G,T \right\rbrace } p_{{\rm obs}}(m) \cdot p(b_1,b_2|m) \end{equation*}\end{document}</tex-math></disp-formula>where <italic>p</italic><sub>obs</sub>(<italic>m</italic>) is the prior for that given nucleotide (see section above) and <italic>p</italic>(<italic>b</italic><sub>1</sub>, <italic>b</italic><sub>2</sub>|<italic>m</italic>) can be derived using Equations <xref ref-type="disp-formula" rid="M12">(12)</xref> and <xref ref-type="disp-formula" rid="M11">(11)</xref>. In resulting BAM files, the probability of error, which is the probability of not observing <italic>n</italic> given the two bases <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub>, is reported. Hence, the following can be derived:
<disp-formula id="M15"><label>(15)</label><tex-math id="M43">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p( - n|b_1,b_2) = 1- p(n|b_1,b_2) \end{equation*}\end{document}</tex-math></disp-formula>
<disp-formula id="M16"><label>(16)</label><tex-math id="M44">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{eqnarray*} &amp; = &amp; 1- \frac{p(b_1,b_2|n) \cdot p(n)}{p(b_1,b_2)} \end{eqnarray*}\end{document}</tex-math></disp-formula>
<disp-formula id="M17"><label>(17)</label><tex-math id="M45">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{eqnarray*} &amp; = &amp; \frac{ p(b_1,b_2) - p(b_1,b_2|n) \cdot p(n)}{p(b_1,b_2)} \end{eqnarray*}\end{document}</tex-math></disp-formula>By substituting the result from Equation <xref ref-type="disp-formula" rid="M14">(14)</xref> in the previous expression, <italic>p</italic>(−<italic>n</italic>|<italic>b</italic><sub>1</sub>, <italic>b</italic><sub>2</sub>) becomes:
<disp-formula id="M18"><label>(18)</label><tex-math id="M46">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}\begin{equation*} p( - n|b_1,b_2) = \frac{ \sum _{m \in { \left\lbrace A,C,G,T \right\rbrace \setminus n }} p(b_1,b_2|m) }{ \sum _{m \in \left\lbrace A,C,G,T \right\rbrace } p(b_1,b_2|m) }. \end{equation*}\end{document}</tex-math></disp-formula>Finally, the most likely nucleotide is produced along with its associated quality score by taking the PHRED scaled quantity defined in Equation <xref ref-type="disp-formula" rid="M18">(18)</xref>.</p>
    </sec>
    <sec id="SEC2-3">
      <title>aDNA sequencing data</title>
      <p>Since sequencing error rates vary between sequencing runs and even vary within a run, such a complex error rate is difficult to model and an actual data set would be needed to evaluate reconstruction accuracy. To benchmark the aforementioned programs on actual aDNA data, the first 10M reads from a paired-end Illumina HiSeq 2500 run from the Altai Neandertal (<xref rid="B10" ref-type="bibr">10</xref>) were used as test data set. Programs that trim and merge reads - MergeTrimReads, SeqPrep and AdaptorRemoval - were used with default parameters as comparison. The resulting reconstructed sequences were mapped back to the human reference genome (1000 Genomes version hg19) using BWA 0.5.10 (<xref rid="B11" ref-type="bibr">11</xref>) with default parameters. The number of aligned sequences along with the number of sequences aligning with mapping quality greater than 30 were tallied for each algorithm.</p>
      <p>A common feature of the programs being tested is the ability to merge overlapping stretches. To evaluate whether this strategy improved sequence accuracy compared to simply trimming the adaptors and mapping both remaining reads separately, the same data set was processed by cutadapt (<xref rid="B3" ref-type="bibr">3</xref>) and the resulting unmerged and paired reads were mapped with BWA. The number of mismatches per aligned basepair was computed for aligned read which were merged by leeHom and simply left as trimmed paired reads by cutadapt.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC3">
    <title>RESULTS</title>
    <sec id="SEC3-1">
      <title>Distribution of the log likelihood</title>
      <p>To illustrate the differences in the likelihood landscape between actual modern and aDNA paired reads, the log-likelihood for different potential sequence length was plotted (see Figure <xref ref-type="fig" rid="F3">3</xref>). For aDNA pairs, there is a clear peak in log-likelihood around the length of the original fragment, whereas modern DNA shows a more even probabilistic landscape. For the aDNA, the difference between the log of the most likely and the second most likely fragment length was 66.93, whereas that difference was 0.19 for the modern DNA pairs.</p>
      <fig id="F3" position="float">
        <label>Figure 3.</label>
        <caption>
          <p>The log-likelihood for various possibilities of length of the original molecules for an ancient and modern DNA read pair. The dotted line represents the likelihood that the reads do not merge and that they came from a molecule of length greater than the longest possible overlap. For the aDNA read pairs, a particular length of the original molecule is more likely than the remaining possibilities. This is not the case for modern DNA read pairs due to the longer length of the original molecule.</p>
        </caption>
        <graphic xlink:href="gku699fig3"/>
      </fig>
    </sec>
    <sec id="SEC3-2">
      <title>Simulated data</title>
      <sec id="SEC3-2-1">
        <title>Paired-end</title>
        <p>Using simulated paired-end reads at different levels of error, the performance of leeHom was compared to MergeTrimReads (<xref rid="B5" ref-type="bibr">5</xref>), SeqPrep (<ext-link ext-link-type="uri" xlink:href="https://github.com/jstjohn/SeqPrep">https://github.com/jstjohn/SeqPrep</ext-link>) and to AdaptorRemoval (<xref rid="B6" ref-type="bibr">6</xref>). Briefly, sequences matching the sequence length distribution of aDNA molecules generated for the Denisova genome project (<xref rid="B12" ref-type="bibr">12</xref>) were selected at random from the genome. Sequences with unresolved base pairs (‘N’) were removed. Reads of 100 bp were simulated by either adding adapter sequences to the end of reads if the original sequence was shorter than the simulated read length or by simply taking the first hundred base pairs from each end. An Illumina error profile was used by aligning PhiX control sequences to the PhiX genome and building a frequency table for matches and types of substitution. The frequency of quality scores associated with each were tallied. Errors were introduced at a certain rate and a nucleotide substitutions were added with the an associated quality score taken from the error profile. Errors were introduced for each base independently of each other. As our data set contains the original sequence, we assessed both the number of molecules for which the sequence was reconstructed perfectly, and the number of sequences with the correct length.</p>
        <p>The number of perfectly reconstructed sequences versus the simulated error rate is plotted in Figure <xref ref-type="fig" rid="F4">4</xref>. Clearly, the number of inferred sequences without any mismatches decreases both due to the increased difficulty of inferring the original sequence and the smaller number of sequences with no mismatches. The relative number of sequences with at least one mismatch was also plotted. This number tends to reach a plateau due to the absence of reads without any sequencing errors. Both in terms of perfectly reconstructed sequences and inexact matches, leeHom outperforms remaining algorithms especially at high error rates. Furthermore, in terms of reconstructed sequences with the correct length irrespective of the number of mismatches, leeHom also offers superior accuracy.</p>
        <fig id="F4" position="float">
          <label>Figure 4.</label>
          <caption>
            <p>Comparison of the fraction for all input reads of reconstructed sequences as a function of simulated error rate for the output of leeHom and currently available software for sequence reconstruction based on paired-end read data. The number of perfectly reconstructed sequences (left), the ones with a single mismatch (mm) to the original sequence (center) and those with the correct length (right) are presented. Both in terms of perfectly reconstructed sequences and in terms of sequences with the correct length, leeHom outperforms other currently available algorithms.</p>
          </caption>
          <graphic xlink:href="gku699fig4"/>
        </fig>
        <p>In terms of falsely merged reads, out of 931 767 paired-end reads, neither AdapterRemoval nor SeqPrep generated any false positives. MergeTrimReads and leeHom generated respectively 11 and 22 false positives. Those reads were located in regions of genomic repeats. It should also be noted that using a prior in leeHom on the sequence length equal to the distribution used to generate the simulated reads eliminates these false positives.</p>
      </sec>
      <sec id="SEC3-2-2">
        <title>Single-end</title>
        <p>In a similar approach to the one taken for paired-end reads, the number of perfectly inferred sequences was tallied for single-end reads for various software packages that trim adaptor sequences. Also, the number of sequences with imperfect matches to the original simulated sequence as well as the total number of sequences with correct length was computed (see Supplementary Figure S2). leeHom and AdapterRemoval offer the greatest robustness to sequencing errors. Upon measuring the amount of false positives on simulated modern DNA reads (see Supplementary Table S1), leehom offers fewer false positives than AdapterRemoval.</p>
      </sec>
    </sec>
    <sec id="SEC3-3">
      <title>Sequencing data</title>
      <p>On an actual aDNA data set of 10M paired-end reads from (<xref rid="B10" ref-type="bibr">10</xref>), the runtime as well as the number of inferred sequences mapping back to the genome was computed (see Table <xref ref-type="table" rid="tbl1">1</xref>). Also, the number of sequences aligning with mapping quality of at least 30 was also computed. Since an algorithm is unlikely to produce a sequence that aligns to the human genome by chance and even more unlikely to align with high mapping quality, the number of aligned sequences indicates the accuracy of the reconstruction. Both in terms of runtime and accuracy, leeHom outperforms currently available programs.</p>
      <table-wrap id="tbl1" position="float">
        <label>Table 1.</label>
        <caption>
          <title>Runtime and accuracy for various adapter trimming and merging software packages</title>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">
</th>
              <th align="left" rowspan="1" colspan="1">leeHom (+prior)</th>
              <th align="left" rowspan="1" colspan="1">leeHom</th>
              <th align="left" rowspan="1" colspan="1">MergeTrimReads</th>
              <th align="left" rowspan="1" colspan="1">AdapterRemoval</th>
              <th align="left" rowspan="1" colspan="1">SeqPrep</th>
              <th align="left" rowspan="1" colspan="1">cutadapt + FLASH</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">runtime (wallclock)</td>
              <td rowspan="1" colspan="1">17m16s</td>
              <td rowspan="1" colspan="1">16m51s</td>
              <td rowspan="1" colspan="1">60m17s</td>
              <td rowspan="1" colspan="1">27m37s</td>
              <td rowspan="1" colspan="1">23m20s</td>
              <td rowspan="1" colspan="1">4m32+5m37</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">runtime (CPU)</td>
              <td rowspan="1" colspan="1">17m14s</td>
              <td rowspan="1" colspan="1">16m49s</td>
              <td rowspan="1" colspan="1">60m16s</td>
              <td rowspan="1" colspan="1">28m16s</td>
              <td rowspan="1" colspan="1">24m27s</td>
              <td rowspan="1" colspan="1">6m00+5m15</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Mapped</td>
              <td rowspan="1" colspan="1">3 381 755</td>
              <td rowspan="1" colspan="1">3 373,531</td>
              <td rowspan="1" colspan="1">3 370 675</td>
              <td rowspan="1" colspan="1">3 308 763</td>
              <td rowspan="1" colspan="1">3 222 585</td>
              <td rowspan="1" colspan="1">3 276 250</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">MQ30</td>
              <td rowspan="1" colspan="1">2 814 558</td>
              <td rowspan="1" colspan="1">2 806 692</td>
              <td rowspan="1" colspan="1">2 803 915</td>
              <td rowspan="1" colspan="1">2 758 884</td>
              <td rowspan="1" colspan="1">2 743 703</td>
              <td rowspan="1" colspan="1">2 744 661</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="TFN001">
            <p>The runtime of different algorithms for sequence reconstruction along with the number of produced sequences aligning to the human genome. In terms of aligned sequences both at minimum mapping quality 0 and 30, leeHom outperforms other algorithms especially if a prior on the sequence length is used. Also in terms of runtime, leeHom compares favorably to other programs. PEAR failed to run due to the amount of data even when increasing the amount of RAM (to 5GB). The time reported for FLASH is the time for cutadapt to run for both forward and reverse reads and for FLASH to run.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Trivially, it should be noted that the use of any of these tools is an improvement over aligning the raw sequences without any attempt at adaptor trimming and paired-end read merging since, out of 10M paired-end reads, only 1 506 567 (15.07%) reads align and among those, 1 338 397 (13.38%) have high mapping quality.</p>
      <p>An assumption behind paired-end read merging for aDNA is the ability to cross-correct using double observations of the sequenced bases and quality scores. To test this hypothesis, the number of mismatches per aligned base was computed for both merged sequences produced by leeHom and trimmed reads produced by cutadapt (see Table <xref ref-type="table" rid="tbl2">2</xref>). The number of mismatches per aligned nucleotide is lower in the merged reads produced by leeHom thus indicating the gain in accuracy is due to cross-correction.</p>
      <table-wrap id="tbl2" position="float">
        <label>Table 2.</label>
        <caption>
          <title>Mismatches per aligned base for various aDNA strategies</title>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">Approach</th>
              <th align="left" rowspan="1" colspan="1">Mismatches</th>
              <th align="left" rowspan="1" colspan="1">Aligned bases</th>
              <th align="left" rowspan="1" colspan="1">Mismatches per 1000 bases</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">leeHom</td>
              <td rowspan="1" colspan="1">1 130 159</td>
              <td rowspan="1" colspan="1">218 746 206</td>
              <td rowspan="1" colspan="1">5.17</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">cutadapt</td>
              <td rowspan="1" colspan="1">2 326 041</td>
              <td rowspan="1" colspan="1">410 027 512</td>
              <td rowspan="1" colspan="1">5.67</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="TFN002">
            <p>The number of mismatches and aligned bases for both merged sequences produced by leeHom and reads trimmed by cutadapt. This table presents the raw number of aligned nucleotides given that, for a given paired-end read, the merged sequences produced by leeHom and the trimmed sequences produced by cutadapt were aligned to the human genome. By computing the number of mismatches per nucleotide, leeHom produces sequences that have greater similarity to the human reference due to cross-correction of the reconstructed sequence using the paired reads.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion" id="SEC4">
    <title>DISCUSSION</title>
    <p>The tasks of stripping residual adapters and merging overlapping pairs are generally separated. Our results show that considering both at once in a single model increases the number of sequences that can ultimately be mapped. Furthermore, the use of the prior distribution can help distinguishing between corner cases. For instance, when a few bases of the adapters are seen, the decision to trim or not depends heavily on the prior probability for the length distribution. For very short aDNA molecules, trimming such bases might be beneficial, whereas for longer molecules, resolved bases might be needlessly removed. A Bayesian approach given the distribution offers the possibility of a natural probabilistic transition from very short fragment size to longer ones without the use of arbitrary cutoffs. A prior on the distribution should, therefore, be used whenever there is data from the same library that provides information about the size distribution of the library inserts. If no previous data on insert-size are available, the default parameters should be used.</p>
    <p>Stricter cutoffs can be used for high quality data sets this will reduce the number of false positives. More liberal cutoffs should be used on data sets with higher errors as this will allow more sequences to be retrieved. However, as mentioned before, error rates vary between sequencing runs and often within a single sequencing run. Adapting the thresholds for the detection of the adapters and the overlapping within a single sequencing run is generally infeasible. Probabilistic approaches obviate this need by returning the most likely model given the data at hand. As shown in the results section, this approach outperforms currently available algorithms especially at high error rates.</p>
    <p>Since adapters are often simply trimmed and the reads left unmodified during standard processing, the value of merging overlapping parts for aDNA studies was evaluated. As shown in the results section, the cross-correction effect of having observed the same sequence twice reduces noise and mismatches to the reference.</p>
    <p>leeHom can be used with a prior on the distribution of the molecule lengths. However, this information is not always available beforehand especially for newly sequenced libraries. Ideally, the step of trimming adapters and merging overlapping parts should be combined with mapping where the distribution of the original sequences could be empirically determined. Once sufficient confidence in the shape of the fragment size distribution, this could be used as prior for both aDNA and modern samples as a standalone tool. Furthermore, substitution rates to remaining nucleotides have been assumed to be equally likely which is empirically not the case (<xref rid="B13" ref-type="bibr">13</xref>). More realistic substitution probabilities could be incorporated in our model. Also, leeHom assumes that quality scores are correlated positively with their observed error rate which is increasingly the case for modern sequencers.</p>
  </sec>
  <sec sec-type="conclusions" id="SEC5">
    <title>CONCLUSION</title>
    <p>leeHom outperforms currently available algorithms for reconstruction of aDNA sequences from reads both in terms of accuracy and speed. The maximum likelihood sequence reconstruction lowers error in aDNA, and other data sets with overlapping paired end reads, thus leading to more accurate alignments.</p>
  </sec>
  <sec sec-type="supplementary-material" id="SEC6">
    <title>SUPPLEMENTARY DATA</title>
    <p><ext-link ext-link-type="uri" xlink:href="http://nar.oxfordjournals.org/lookup/suppl/doi:10.1093/nar/gku699/-/DC1">Supplementary data</ext-link> are available at NAR Online.</p>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>SUPPLEMENTARY DATA</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_42_18_e141__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_gku699_nar-01043-met-k-2014-File003.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Kay Prüfer for useful comments and Amin Saffari for testing the software.</p>
  </ack>
  <sec id="SEC7">
    <title>FUNDING</title>
    <p>The authors acknowledge financial support from the Max Planck Society; NSERC for PGS Doctoral scholarship [to G.R.] Funding for open access charge: Max Planck Society.</p>
    <p><italic>Conflict of interest statement</italic>. None declared.</p>
  </sec>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gansauge</surname>
            <given-names>M.-T.</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Single-stranded DNA library preparation for the sequencing of ancient or damaged DNA</article-title>
        <source>Nat. Protoc.</source>
        <year>2013</year>
        <volume>8</volume>
        <fpage>737</fpage>
        <lpage>748</lpage>
        <pub-id pub-id-type="pmid">23493070</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sawyer</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Guschanski</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Savolainen</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Pääbo</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Temporal patterns of nucleotide misincorporations and DNA fragmentation in ancient DNA</article-title>
        <source>PLoS One</source>
        <year>2012</year>
        <volume>7</volume>
        <fpage>e34131</fpage>
        <pub-id pub-id-type="pmid">22479540</pub-id>
      </element-citation>
    </ref>
    <ref id="B3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Martin</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Cutadapt removes adapter sequences from high-throughput sequencing reads</article-title>
        <source>EMBnet. J.</source>
        <year>2011</year>
        <volume>17</volume>
        <fpage>10</fpage>
      </element-citation>
    </ref>
    <ref id="B4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kong</surname>
            <given-names>Y.</given-names>
          </name>
        </person-group>
        <article-title>Btrim: a fast, lightweight adapter and quality trimming program for next-generation sequencing technologies</article-title>
        <source>Genomics</source>
        <year>2011</year>
        <volume>98</volume>
        <fpage>152</fpage>
        <lpage>153</lpage>
        <pub-id pub-id-type="pmid">21651976</pub-id>
      </element-citation>
    </ref>
    <ref id="B5">
      <label>5.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Kircher</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Shapiro</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Hofreiter</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Analysis of high-throughput ancient DNA sequencing data</article-title>
        <source>Ancient DNA: methods and protocols</source>
        <year>2012</year>
        <publisher-loc>Humana Press</publisher-loc>
        <publisher-name>Springer</publisher-name>
        <fpage>197</fpage>
        <lpage>228</lpage>
      </element-citation>
    </ref>
    <ref id="B6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lindgreen</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>AdapterRemoval: easy cleaning of next-generation sequencing reads</article-title>
        <source>BMC Res. Notes</source>
        <year>2012</year>
        <volume>5</volume>
        <fpage>337</fpage>
        <lpage>343</lpage>
        <pub-id pub-id-type="pmid">22748135</pub-id>
      </element-citation>
    </ref>
    <ref id="B7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Masella</surname>
            <given-names>A.P.</given-names>
          </name>
          <name>
            <surname>Bartram</surname>
            <given-names>A.K.</given-names>
          </name>
          <name>
            <surname>Truszkowski</surname>
            <given-names>J.M.</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>D.G.</given-names>
          </name>
          <name>
            <surname>Neufeld</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>PANDAseq: paired-end assembler for Illumina sequences</article-title>
        <source>BMC Bioinformat.</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>31</fpage>
        <lpage>37</lpage>
      </element-citation>
    </ref>
    <ref id="B8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Kobert</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Flouri</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Stamatakis</surname>
            <given-names>A.</given-names>
          </name>
        </person-group>
        <article-title>PEAR: a fast and accurate Illumina Paired-End reAd mergeR</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>30</volume>
        <fpage>614</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="pmid">24142950</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>S.-M.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>T.-W.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>COPE: an accurate k-mer-based pair-end reads connection tool to facilitate genome assembly</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>2870</fpage>
        <lpage>2874</lpage>
        <pub-id pub-id-type="pmid">23044551</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prüfer</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Racimo</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Jay</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Sankararaman</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Sawyer</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Heinze</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Renaud</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Sudmant</surname>
            <given-names>P.H.</given-names>
          </name>
          <name>
            <surname>de Filippo</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The complete genome sequence of a Neanderthal from the Altai Mountains</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>505</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="pmid">24352235</pub-id>
      </element-citation>
    </ref>
    <ref id="B11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate short read alignment with Burrows–Wheeler transform</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1754</fpage>
        <lpage>1760</lpage>
        <pub-id pub-id-type="pmid">19451168</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meyer</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Kircher</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Gansauge</surname>
            <given-names>M.-T.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Racimo</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Mallick</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Schraiber</surname>
            <given-names>J.G.</given-names>
          </name>
          <name>
            <surname>Jay</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Prüfer</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>de Filippo</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A high-coverage genome sequence from an archaic Denisovan individual</article-title>
        <source>Science</source>
        <year>2012</year>
        <volume>338</volume>
        <fpage>222</fpage>
        <lpage>226</lpage>
        <pub-id pub-id-type="pmid">22936568</pub-id>
      </element-citation>
    </ref>
    <ref id="B13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nakamura</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Oshima</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Morimoto</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ikeda</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Yoshikawa</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Shiwa</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Ishikawa</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Linak</surname>
            <given-names>M.C.</given-names>
          </name>
          <name>
            <surname>Hirai</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Takahashi</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sequence-specific error profile of Illumina sequencers</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2011</year>
        <volume>39</volume>
        <fpage>e90</fpage>
        <pub-id pub-id-type="pmid">21576222</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
