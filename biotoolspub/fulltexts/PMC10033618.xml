<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Theor Appl Genet</journal-id>
    <journal-id journal-id-type="iso-abbrev">Theor Appl Genet</journal-id>
    <journal-title-group>
      <journal-title>TAG. Theoretical and Applied Genetics. Theoretische Und Angewandte Genetik</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0040-5752</issn>
    <issn pub-type="epub">1432-2242</issn>
    <publisher>
      <publisher-name>Springer Berlin Heidelberg</publisher-name>
      <publisher-loc>Berlin/Heidelberg</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10033618</article-id>
    <article-id pub-id-type="pmid">36949348</article-id>
    <article-id pub-id-type="publisher-id">4298</article-id>
    <article-id pub-id-type="doi">10.1007/s00122-023-04298-x</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Fully efficient, two-stage analysis of multi-environment trials with directional dominance and multi-trait genomic selection</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0957-4337</contrib-id>
        <name>
          <surname>Endelman</surname>
          <given-names>Jeffrey B.</given-names>
        </name>
        <address>
          <email>endelman@wisc.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <aff id="Aff1"><institution-wrap><institution-id institution-id-type="GRID">grid.14003.36</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 3675</institution-id><institution>Department of Horticulture, </institution><institution>University of Wisconsin-Madison, </institution></institution-wrap>Madison, WI 53706 USA </aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="com">
        <p>Communicated by Huihui Li.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>3</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>3</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2023</year>
    </pub-date>
    <volume>136</volume>
    <issue>4</issue>
    <elocation-id>65</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>2</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Key message</title>
        <p id="Par1">R/StageWise enables fully efficient, two-stage analysis of multi-environment, multi-trait datasets for genomic selection, including support for dominance heterosis and polyploidy.</p>
      </sec>
      <sec>
        <title>Abstract</title>
        <p id="Par2">Plant breeders interested in genomic selection often face challenges to fully utilizing multi-trait, multi-environment datasets. R package StageWise was developed to go beyond the capabilities of most specialized software for genomic prediction, without requiring the programming skills needed for more general-purpose software for mixed models. As the name suggests, one of the core features is a fully efficient, two-stage analysis for multiple environments, in which the full variance–covariance matrix of the Stage 1 genotype means is used in Stage 2. Another feature is directional dominance, including for polyploids, to account for inbreeding depression in outbred crops. StageWise enables selection with multi-trait indices, including restricted indices with one or more traits constrained to have zero response. For a potato dataset with 943 genotypes evaluated over 6 years, including the Stage 1 errors in Stage 2 reduced the Akaike Information Criterion (AIC) by 29, 67, and 104 for maturity, yield, and fry color, respectively. The proportion of variation explained by heterosis was largest for yield but still only 0.03, likely because of limited variation for the genomic inbreeding coefficient. Due to the large additive genetic correlation (0.57) between yield and maturity, naïve selection on an index combining yield and fry color led to an undesirable response for later maturity. The restricted index coefficients to maximize genetic merit without delaying maturity were identified. The software and three vignettes are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/jendelman/StageWise">https://github.com/jendelman/StageWise</ext-link>.</p>
      </sec>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1007/s00122-023-04298-x.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100005825</institution-id>
            <institution>National Institute of Food and Agriculture</institution>
          </institution-wrap>
        </funding-source>
        <award-id>2020-51181-32156</award-id>
        <award-id>2016-34141-25707</award-id>
        <award-id>2019-34141-30284</award-id>
        <award-id>Hatch Project 1013047</award-id>
        <principal-award-recipient>
          <name>
            <surname>Endelman</surname>
            <given-names>Jeffrey B.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100011744</institution-id>
            <institution>Wisconsin Potato and Vegetable Growers Association</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Potatoes USA</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer-Verlag GmbH Germany, part of Springer Nature 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par3">During the first decade of the twenty-first century, the focus of genomic selection research was the development of theory and methods (e.g., Meuwissen et al. <xref ref-type="bibr" rid="CR38">2001</xref>; Habier et al. <xref ref-type="bibr" rid="CR27">2007</xref>; Daetwyler et al. <xref ref-type="bibr" rid="CR13">2008</xref>; Bernardo and Yu <xref ref-type="bibr" rid="CR6">2007</xref>; VanRaden <xref ref-type="bibr" rid="CR56">2008</xref>), and most researchers worked in animal rather than plant breeding. This changed in the following decade with the development of specialized software for genomic prediction, including rrBLUP (Endelman <xref ref-type="bibr" rid="CR16">2011</xref>), GAPIT (Lipka et al. <xref ref-type="bibr" rid="CR37">2012</xref>), synbreed (Wimmer et al. <xref ref-type="bibr" rid="CR60">2012</xref>), BGLR (Pérez and de los Campos <xref ref-type="bibr" rid="CR42">2014</xref>), and sommer (Covarrubias-Pazaran <xref ref-type="bibr" rid="CR10">2016</xref>). Over the last several years, new software development has emphasized multi-trait prediction models (Montesinos-López et al. <xref ref-type="bibr" rid="CR40">2019</xref>; Runcie et al. <xref ref-type="bibr" rid="CR50">2021</xref>; Pérez-Rodríguez and de los Campos <xref ref-type="bibr" rid="CR43">2022</xref>). Collectively, these software publications have been cited several thousand times, which reflects their enabling role for the adoption of genomic selection, particularly in plant breeding.</p>
    <p id="Par4">However, these packages have limitations to handle the full complexity of plant breeding data, with different experimental designs, heritabilities, and spatial models for non-genetic variation. The challenge of properly analyzing multi-environment datasets existed before genomic selection, which led to the concept of a two-stage analysis (Frensham et al. <xref ref-type="bibr" rid="CR21">1997</xref>). In Stage 1, genotype means are estimated as fixed effects for each environment, which become the response variable in Stage 2. The errors of the Stage 1 estimates are typically different, and failure to account for this in Stage 2 leads to sub-optimal results (Möhring and Piepho <xref ref-type="bibr" rid="CR39">2009</xref>). A “fully efficient” two-stage analysis uses the full variance–covariance matrix of the Stage 1 genotype means in Stage 2, rather than a diagonal approximation (Piepho et al. <xref ref-type="bibr" rid="CR44">2012</xref>; Damesa et al. <xref ref-type="bibr" rid="CR14">2017</xref>). Previous examples of a properly weighted, two-stage analysis have used one of three well-established, REML-based programs for mixed models: SAS PROC MIXED (SAS Institute Inc, Cary, NC), ASReml (Gilmour et al. <xref ref-type="bibr" rid="CR24">2015</xref>), or ASReml-R (Butler et al. <xref ref-type="bibr" rid="CR8">2018</xref>). All three software allow the variance–covariance matrix of the random effect for Stage 1 errors to be specified while estimating the other, unknown variance components of the Stage 2 model. Despite this precedent, many studies continue to ignore Stage 1 errors, and I believe a major reason is the additional programming skill required.</p>
    <p id="Par5">The goal of the current research was to develop a new R package (R Core Team <xref ref-type="bibr" rid="CR46">2022</xref>) for genomic selection that makes fully efficient, two-stage analysis more accessible to plant breeders. The software, called StageWise, returns empirical BLUPs using variance components estimated with ASReml-R. It also works for polyploids and incorporates advanced features such as directional dominance and multi-trait selection indices.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <sec id="Sec3">
      <title>Single trait with homogeneous GxE</title>
      <p id="Par6">The response variable for Stage 2 is the Stage 1 BLUEs for the effect of genotype in environment. The mixed model with homogeneous GxE can be written as
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$BLUE\left[ {g_{{{\text{ij}}}} } \right] = y_{{{\text{ij}}}} = E_{{\text{j}}} + g_{{\text{i}}} + gE_{{{\text{ij}}}} + s_{{{\text{ij}}}}$$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mrow><mml:mi>B</mml:mi><mml:mi>L</mml:mi><mml:mi>U</mml:mi><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mi>g</mml:mi><mml:mtext>ij</mml:mtext></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mtext>ij</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mtext>j</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mtext>i</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mi>E</mml:mi><mml:mtext>ij</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mtext>ij</mml:mtext></mml:msub></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g_{{{\text{ij}}}}$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mi>g</mml:mi><mml:mtext>ij</mml:mtext></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq1.gif"/></alternatives></inline-formula> is the genotypic value for individual (or clone) <italic>i</italic> in environment <italic>j</italic>, <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{\mathrm{j}}$$\end{document}</tex-math><mml:math id="M6"><mml:msub><mml:mi>E</mml:mi><mml:mi mathvariant="normal">j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq2.gif"/></alternatives></inline-formula> is the fixed effect for environment <italic>j</italic>, <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{i}$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq3.gif"/></alternatives></inline-formula> is the random effect for individual <italic>i</italic> across environments, and the GxE effect, <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${gE}_{\mathrm{ij}},$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">gE</mml:mi></mml:mrow><mml:mi mathvariant="normal">ij</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq4.gif"/></alternatives></inline-formula> is actually the model residual (Damesa et al. <xref ref-type="bibr" rid="CR14">2017</xref>). The <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s}_{\mathrm{ij}}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mi>s</mml:mi><mml:mi mathvariant="normal">ij</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq5.gif"/></alternatives></inline-formula> effect, which represents the Stage 1 estimation error, is multivariate normal with no free variance parameters: the variance–covariance matrix is the direct sum of the variance–covariance matrices of the Stage 1 BLUEs (Damesa et al. <xref ref-type="bibr" rid="CR14">2017</xref>). The <inline-formula id="IEq6"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${gE}_{ij}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi mathvariant="italic">gE</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq6.gif"/></alternatives></inline-formula> are independent and identically distributed (i.i.d.), which implies a single genetic correlation between all environments. Without marker data, the software assumes the <inline-formula id="IEq7"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\mathrm{i}}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq7.gif"/></alternatives></inline-formula> effects are i.i.d.</p>
      <p id="Par7">When marker data are provided, the software decomposes <inline-formula id="IEq8"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{i}$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq8.gif"/></alternatives></inline-formula> into additive and non-additive values. The vector of additive values is multivariate normal with covariance proportional to a genomic additive matrix <bold>G</bold> (VanRaden <xref ref-type="bibr" rid="CR56">2008</xref> Method 1, extended to arbitrary ploidy). If <bold>W</bold> represents the centered matrix of allele dosages (<italic>n</italic> individuals x <italic>m</italic> bi-allelic markers with frequencies <italic>p</italic> = 1–<italic>q</italic>), then for ploidy <inline-formula id="IEq9"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><mml:math id="M20"><mml:mi>ϕ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq9.gif"/></alternatives></inline-formula>,<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{G}} = \frac{{{\mathbf{WW}}^{{\text{T}}} }}{{\phi \mathop \sum \nolimits_{k} p_{{\text{k}}} q_{{\text{k}}} }}$$\end{document}</tex-math><mml:math id="M22" display="block"><mml:mrow><mml:mi mathvariant="bold">G</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mi mathvariant="bold">WW</mml:mi></mml:mrow><mml:mtext>T</mml:mtext></mml:msup><mml:mrow><mml:mi>ϕ</mml:mi><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mtext>k</mml:mtext></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mtext>k</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par8">If a three-column pedigree is provided, <bold>G</bold> can be blended with the pedigree relationship matrix <bold>A</bold> (calculated using R package AGHmatrix (Amadeu et al. <xref ref-type="bibr" rid="CR3">2016</xref>)) to produce <inline-formula id="IEq10"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{H}=\left(1-\upomega \right)\mathbf{G}+\upomega \mathbf{A}$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mi mathvariant="bold">H</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi mathvariant="normal">ω</mml:mi></mml:mfenced><mml:mi mathvariant="bold">G</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ω</mml:mi><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq10.gif"/></alternatives></inline-formula>, for <inline-formula id="IEq11"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$0\le\upomega \le 1$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi mathvariant="normal">ω</mml:mi><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq11.gif"/></alternatives></inline-formula> (Legarra et al. <xref ref-type="bibr" rid="CR36">2009</xref>; Christensen and Lund <xref ref-type="bibr" rid="CR9">2010</xref>). In addition to the additive polygenic effect, the user can indicate some markers should be included as additive (fixed effect) covariates in Eq. (<xref rid="Equ1" ref-type="disp-formula">1</xref>), to capture large effect QTL.</p>
    </sec>
    <sec id="Sec4">
      <title>Directional dominance</title>
      <p id="Par9">Two models for the non-additive genetic values are available. In the genetic residual model, the non-additive values are i.i.d. The other option is a directional (digenic) dominance model, which follows the classical framework of Fisher (<xref ref-type="bibr" rid="CR20">1941</xref>) and Kempthorne (<xref ref-type="bibr" rid="CR30">1957</xref>) and is a refinement of recent research (Vitezica et al. <xref ref-type="bibr" rid="CR58">2013</xref>; Xiang et al. <xref ref-type="bibr" rid="CR61">2016</xref>; Endelman et al. <xref ref-type="bibr" rid="CR18">2018</xref>; Batista et al. <xref ref-type="bibr" rid="CR4">2022</xref>). For a locus with two alleles designated 0/1, there are three digenic dominance effects <inline-formula id="IEq12"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\beta }_{00},{\beta }_{01}$$\end{document}</tex-math><mml:math id="M28"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>00</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>01</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq12.gif"/></alternatives></inline-formula>, <inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\beta }_{11}$$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mi>β</mml:mi><mml:mn>11</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq13.gif"/></alternatives></inline-formula>, which equal the dominance deviation in diploids, but more generally for any ploidy are the coefficients for regressing the dominance deviation on diplotype dosage. (Higher order dominance effects for polyploids are not considered.) These dominance effects can be expressed in terms of a parameter that has no established name but may be called a digenic substitution effect, <inline-formula id="IEq14"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta$$\end{document}</tex-math><mml:math id="M32"><mml:mi>β</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq14.gif"/></alternatives></inline-formula>, by analogy with the allele substitution effect <italic>α</italic> for additive effects. The <inline-formula id="IEq15"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta$$\end{document}</tex-math><mml:math id="M34"><mml:mi>β</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq15.gif"/></alternatives></inline-formula> parameter represents the average change in dominance deviation per unit increase in dosage of the heterozygous diplotype:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta = \beta_{01} - \frac{1}{2}\left( {\beta_{00} + \beta_{11} } \right)$$\end{document}</tex-math><mml:math id="M36" display="block"><mml:mrow><mml:mi>β</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>01</mml:mn></mml:msub><mml:mo>-</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>00</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>11</mml:mn></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par10">(This differs from the scaling in Endelman et al. (<xref ref-type="bibr" rid="CR18">2018</xref>) by –2 so that <inline-formula id="IEq16"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta$$\end{document}</tex-math><mml:math id="M38"><mml:mi>β</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq16.gif"/></alternatives></inline-formula> in Eq. (<xref rid="Equ3" ref-type="disp-formula">3</xref>) equals <italic>d</italic> in the classical diploid model of Vitezica et al. (<xref ref-type="bibr" rid="CR58">2013</xref>).) Designating the frequency of allele 1 as <inline-formula id="IEq17"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p = 1 - q$$\end{document}</tex-math><mml:math id="M40"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq17.gif"/></alternatives></inline-formula>, the dominance effects can be expressed in terms of the substitution effect:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} \beta_{00} = - 2p^{2} \beta \hfill \\ \beta_{01} = 2pq\beta \hfill \\ \beta_{11} = - 2q^{2} \beta \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M42" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>00</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>β</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi>β</mml:mi><mml:mn>01</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>p</mml:mi><mml:mi>q</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi>β</mml:mi><mml:mn>11</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>β</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par11">The dominance value of an individual is the sum of its dominance effects and can be written as <inline-formula id="IEq18"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q\beta$$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:mi>Q</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq18.gif"/></alternatives></inline-formula>, where the dominance coefficient <italic>Q</italic> for ploidy <inline-formula id="IEq19"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><mml:math id="M46"><mml:mi>ϕ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq19.gif"/></alternatives></inline-formula> and allele dosage <italic>X</italic> (of allele 1) is<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q = - 2\left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)p^{2} + 2p\left( {\phi - 1} \right)X - X\left( {X - 1} \right)$$\end{document}</tex-math><mml:math id="M48" display="block"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:msup><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mi>X</mml:mi><mml:mo>-</mml:mo><mml:mi>X</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>X</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par12">In Eq. (<xref rid="Equ5" ref-type="disp-formula">5</xref>), <inline-formula id="IEq20"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)$$\end{document}</tex-math><mml:math id="M50"><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq20.gif"/></alternatives></inline-formula> is the binomial coefficient. The dominance genetic variance, <italic>V</italic><sub>D</sub>, is <inline-formula id="IEq21"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\begin{array}{c}\phi \\ 2\end{array}\right)$$\end{document}</tex-math><mml:math id="M52"><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq21.gif"/></alternatives></inline-formula> times the variance of the dominance effects, <inline-formula id="IEq22"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$4{p}^{2}{q}^{2}{\beta }^{2}.$$\end{document}</tex-math><mml:math id="M54"><mml:mrow><mml:mn>4</mml:mn><mml:msup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq22.gif"/></alternatives></inline-formula> Extending this framework to <italic>m</italic> loci, the dominance value is <inline-formula id="IEq23"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop \sum \nolimits_{k = 1}^{m} Q_{k} \beta_{k}$$\end{document}</tex-math><mml:math id="M56"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:msub><mml:mi>Q</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq23.gif"/></alternatives></inline-formula>, and the dominance variance is<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$V_{D} = \left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)\sum\limits_{k = 1}^{m} {4p_{k}^{2} } q_{k}^{2} \beta_{k}^{2} + \sum\limits_{k} {\sum\limits_{{k^{\prime } \ne k}} {\beta_{k} \beta_{{k^{\prime } }} } } {\text{cov}} \left[ {Q_{k} ,Q_{{k^{\prime } }} } \right]$$\end{document}</tex-math><mml:math id="M58" display="block"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>D</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:mrow><mml:mn>4</mml:mn><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>β</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow></mml:mrow><mml:mtext>cov</mml:mtext><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par13">The first term in Eq. (<xref rid="Equ6" ref-type="disp-formula">6</xref>) is the dominance <italic>genic</italic> variance, which depends on allele frequencies but not LD between loci. The second term is the disequilibrium covariance, which can be positive or negative.</p>
      <p id="Par14">In classical quantitative genetics, the substitution effects are fixed parameters, but to compute dominance values by BLUP, we switch to viewing them as random normal effects (de los Campos et al. <xref ref-type="bibr" rid="CR15">2015</xref>), with mean <inline-formula id="IEq24"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{\beta }$$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mi>μ</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq24.gif"/></alternatives></inline-formula> and variance <inline-formula id="IEq25"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{\beta }^{2}$$\end{document}</tex-math><mml:math id="M62"><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq25.gif"/></alternatives></inline-formula>. For a trait with no average heterosis in the population, <inline-formula id="IEq26"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{\beta }=0$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq26.gif"/></alternatives></inline-formula> (Varona et al. <xref ref-type="bibr" rid="CR57">2018</xref>). Let <bold>Q</bold> denote the <italic>n</italic> × <italic>m</italic> matrix of dominance coefficients for <italic>n</italic> individuals at <italic>m</italic> loci. The vector of dominance values <inline-formula id="IEq27"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{Q}{\varvec{\upbeta}}$$\end{document}</tex-math><mml:math id="M66"><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi><mml:mrow><mml:mi mathvariant="bold">β</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq27.gif"/></alternatives></inline-formula> is multivariate normal, with mean <inline-formula id="IEq28"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{Q}\mathbf{1}{\mu }_{\beta }$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi><mml:mn mathvariant="bold">1</mml:mn><mml:msub><mml:mi>μ</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq28.gif"/></alternatives></inline-formula> and variance–covariance matrix <inline-formula id="IEq29"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{Q}{\mathbf{Q}}^{\mathrm{T}}{\sigma }_{\beta }^{2}$$\end{document}</tex-math><mml:math id="M70"><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi></mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:msup><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq29.gif"/></alternatives></inline-formula>. Equivalently, the dominance values can be written as<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{Q}\varvec{\beta}} = - b{\mathbf{F}} + {\mathbf{d}}_{0}$$\end{document}</tex-math><mml:math id="M72" display="block"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Q</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mi>b</mml:mi><mml:mi mathvariant="bold">F</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="bold">d</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq30"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{F}}$$\end{document}</tex-math><mml:math id="M74"><mml:mi mathvariant="bold">F</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq30.gif"/></alternatives></inline-formula> is a vector of genomic inbreeding coefficients, with regression coefficient <inline-formula id="IEq31"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b$$\end{document}</tex-math><mml:math id="M76"><mml:mi>b</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq31.gif"/></alternatives></inline-formula> (positive value implies heterosis), and <inline-formula id="IEq32"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{d}}_{0}\sim \mathrm{MVN}\left(0,\mathbf{D}{\sigma }_{D}^{2}\right)$$\end{document}</tex-math><mml:math id="M78"><mml:mrow><mml:msub><mml:mi mathvariant="bold">d</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="normal">MVN</mml:mi><mml:mfenced close=")" open="("><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold">D</mml:mi><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq32.gif"/></alternatives></inline-formula> represents dominance with no average heterosis. The genomic dominance matrix <bold>D</bold> is defined by interpreting its variance component <inline-formula id="IEq33"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{D}^{2}$$\end{document}</tex-math><mml:math id="M80"><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq33.gif"/></alternatives></inline-formula> as the expected value of the classical dominance variance with respect to the substitution effects, assuming no overall heterosis. From Eq. (<xref rid="Equ6" ref-type="disp-formula">6</xref>) the result is<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma_{D}^{2} = E\left[ {V_{D} } \right] = \sigma_{\beta }^{2} \left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)\mathop \sum \limits_{k} 4p_{k}^{2} q_{k}^{2}$$\end{document}</tex-math><mml:math id="M82" display="block"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mi>V</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>k</mml:mi></mml:munder><mml:mn>4</mml:mn><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par15">which leads to<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{D}} = \frac{{{\mathbf{QQ}}^{{\text{T}}} }}{{\left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)\mathop \sum \nolimits_{k} 4p_{k}^{2} q_{k}^{2} }}$$\end{document}</tex-math><mml:math id="M84" display="block"><mml:mrow><mml:mi mathvariant="bold">D</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mi mathvariant="bold">QQ</mml:mi></mml:mrow><mml:mtext>T</mml:mtext></mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mn>4</mml:mn><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par16">From Eq. (<xref rid="Equ7" ref-type="disp-formula">7</xref>), the vector of genomic inbreeding coefficients <bold>F</bold> is proportional to the row sum of <bold>Q</bold>. The correct scaling is derived by considering the expected value of <italic>Q</italic> (Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>) in the classical sense (where genotypes are random and parameters are fixed), for a completely inbred population in which homozygotes of allele 1 occur with frequency <italic>p</italic>. Under these conditions, <inline-formula id="IEq34"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[X\right]=\phi p$$\end{document}</tex-math><mml:math id="M86"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mi>X</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mi>ϕ</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq34.gif"/></alternatives></inline-formula> and <inline-formula id="IEq35"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[{X}^{2}\right]={\phi }^{2}p$$\end{document}</tex-math><mml:math id="M88"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mi>p</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq35.gif"/></alternatives></inline-formula>, which leads to <inline-formula id="IEq36"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[Q\right]=-2pq\left(\begin{array}{c}\phi \\ 2\end{array}\right)$$\end{document}</tex-math><mml:math id="M90"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mi>Q</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mi>p</mml:mi><mml:mi>q</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq36.gif"/></alternatives></inline-formula>. Extending this to multiple loci and equating the result to <italic>F</italic> = 1 sets the proportionality constant and leads to the following definition:<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{F}} = \frac{{ - {\mathbf{Q}}\mathbf{1}}}{{\left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)\mathop \sum \nolimits_{k} 2p_{k} q_{k} }}$$\end{document}</tex-math><mml:math id="M92" display="block"><mml:mrow><mml:mi mathvariant="bold">F</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>-</mml:mo><mml:mi mathvariant="bold">Q</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par17">The vector of genomic inbreeding coefficients is included as a fixed effect covariate in the Stage 2 model. Inbreeding coefficients can also be computed from the diagonal elements of the additive relationship matrix (either A or G) according to <inline-formula id="IEq37"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(G-1)/(\phi -1)$$\end{document}</tex-math><mml:math id="M94"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>G</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq37.gif"/></alternatives></inline-formula> (Henderson <xref ref-type="bibr" rid="CR29">1976</xref>; Gallais <xref ref-type="bibr" rid="CR23">2003</xref>; Endelman and Jannink <xref ref-type="bibr" rid="CR17">2012</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Extension to multiple locations or traits</title>
      <p id="Par18">StageWise has the option of including a random effect <inline-formula id="IEq38"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g(L)$$\end{document}</tex-math><mml:math id="M96"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq38.gif"/></alternatives></inline-formula> in Stage 2 for genotype within location (or <italic>L</italic> can represent some other factor, such as management). Using the subscript <italic>k</italic> to designate location, the linear model (Eq. <xref rid="Equ1" ref-type="disp-formula">1</xref>) becomes<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\text{BLUE}}\left[ {g_{ijk} } \right] = y_{ijk} = E_{j} + g\left( L \right)_{ik} + gE_{ijk} + s_{ijk}$$\end{document}</tex-math><mml:math id="M98" display="block"><mml:mrow><mml:mtext>BLUE</mml:mtext><mml:mfenced close="]" open="["><mml:msub><mml:mi>g</mml:mi><mml:mrow><mml:mi mathvariant="italic">ijk</mml:mi></mml:mrow></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi mathvariant="italic">ijk</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mfenced close=")" open="("><mml:mi>L</mml:mi></mml:mfenced><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi mathvariant="italic">ijk</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi mathvariant="italic">ijk</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par19">The <inline-formula id="IEq39"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g\left( L \right)_{{{\text{ik}}}}$$\end{document}</tex-math><mml:math id="M100"><mml:mrow><mml:mi>g</mml:mi><mml:msub><mml:mfenced close=")" open="("><mml:mi>L</mml:mi></mml:mfenced><mml:mtext>ik</mml:mtext></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq39.gif"/></alternatives></inline-formula> effect is modeled using a separable covariance structure, <inline-formula id="IEq40"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{I}} \otimes {{\varvec{\Gamma}}}$$\end{document}</tex-math><mml:math id="M102"><mml:mrow><mml:mi mathvariant="bold">I</mml:mi><mml:mo>⊗</mml:mo><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq40.gif"/></alternatives></inline-formula> in the absence of marker data, where the genetic covariance between locations <inline-formula id="IEq41"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\Gamma}}$$\end{document}</tex-math><mml:math id="M104"><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq41.gif"/></alternatives></inline-formula> follows a second-order factor-analytic (FA2) model. The FA2 model provides a good balance between statistical parsimony and complexity for many plant breeding applications, and <italic>Stage2</italic> returns the rotated and scaled factor loadings (Cullis et al. <xref ref-type="bibr" rid="CR12">2010</xref>). A heterogeneous variance model is used for <inline-formula id="IEq42"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${gE}_{\mathrm{ijk}}$$\end{document}</tex-math><mml:math id="M106"><mml:msub><mml:mrow><mml:mi mathvariant="italic">gE</mml:mi></mml:mrow><mml:mi mathvariant="normal">ijk</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq42.gif"/></alternatives></inline-formula> (which is the model residual as before), with different variance parameters for each location.</p>
      <p id="Par20">When marker data are provided, genotypic value is partitioned into additive and non-additive values, and the FA2 model is still used for the additive covariance between locations. Attempts to use an FA2 model for non-additive values were unsuccessful in several datasets, and even with a compound symmetry model, the correlation parameter was always on the boundary (equal to 1). The non-additive correlation parameter was therefore fixed at 1 and accepted as a model limitation. When markers are included as fixed effect covariates, different regression coefficients are estimated for each location. Similarly, different regression coefficients for genomic inbreeding are estimated per location.</p>
      <p id="Par21">A similar framework is used for multi-trait analysis, with trait replacing location in Eq. (<xref rid="Equ11" ref-type="disp-formula">11</xref>), except that all trait covariance matrices are unstructured. In Stage 1, a separable covariance model is used for the residuals, and in Stage 2, the fixed effects for environment are trait-specific. When markers are used to partition additive and non-additive genetic value, separate unstructured covariance matrices are estimated for each. Multi-trait models are limited to the homogeneous GxE structure described for single trait analysis (i.e., the genetic correlation between all environments is the same, regardless of location).</p>
    </sec>
    <sec id="Sec6">
      <title>Proportion of variance explained</title>
      <p id="Par22">The aim is to quantify the proportion of variance (PVE) explained by each effect in the Stage 2 model, excluding the main effect <italic>E</italic><sub>j</sub> (which mirrors how heritability is calculated). The core idea is to compute variances based on the method of Legarra (<xref ref-type="bibr" rid="CR35">2016</xref>), and the PVE is the variance of each effect divided by the sum. This is not a true partitioning of variance because the Stage 2 effects are not necessarily orthogonal.</p>
      <p id="Par23">First consider effects such as <inline-formula id="IEq43"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$g{E}_{\mathrm{ij}}$$\end{document}</tex-math><mml:math id="M108"><mml:mrow><mml:mi>g</mml:mi><mml:msub><mml:mi>E</mml:mi><mml:mi mathvariant="normal">ij</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq43.gif"/></alternatives></inline-formula> and <italic>s</italic><sub>ij</sub> (Eq. <xref rid="Equ1" ref-type="disp-formula">1</xref>), which are indexed by both genotype <italic>i</italic> and environment <italic>j</italic>. Representing these effects by vector <bold>y</bold> of length <italic>t</italic>, the variance is<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$V_{y} = \frac{1}{t}\mathop \sum \limits_{ij} y_{ij}^{2} - \left( {\frac{1}{t}\mathop \sum \limits_{ij} y_{ij} } \right)^{2} = \frac{1}{t}{\mathbf{y^{\prime}y}} - \frac{1}{{t^{2} }}\left( {\mathbf{1}_{t}^{^{\prime}} {\mathbf{y}}} \right)^{2}$$\end{document}</tex-math><mml:math id="M110" display="block"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mfrac><mml:mrow><mml:msup><mml:mi mathvariant="bold">y</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mi mathvariant="bold">y</mml:mi></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par24">The symbol <inline-formula id="IEq44"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{1}_{t}$$\end{document}</tex-math><mml:math id="M112"><mml:msub><mml:mn mathvariant="bold">1</mml:mn><mml:mi>t</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq44.gif"/></alternatives></inline-formula> in Eq. (<xref rid="Equ12" ref-type="disp-formula">12</xref>) is a <italic>t</italic> × 1 vector of 1’s. For multivariate normal (MVN) <bold>y</bold> with mean <inline-formula id="IEq45"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\upmu}}$$\end{document}</tex-math><mml:math id="M114"><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq45.gif"/></alternatives></inline-formula> and variance–covariance matrix <inline-formula id="IEq46"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{K}$$\end{document}</tex-math><mml:math id="M116"><mml:mi mathvariant="bold">K</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq46.gif"/></alternatives></inline-formula>, the expectation of <italic>V</italic><sub>y</sub> can be computed using the following general formula for quadratic forms (Searle et al. <xref ref-type="bibr" rid="CR53">1992</xref>):<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[ {{\mathbf{y^{\prime}Ay}}} \right] = {\text{tr}}\left( {{\mathbf{AK}}} \right) + {\mathbf{\upmu^{\prime}A\upmu }}$$\end{document}</tex-math><mml:math id="M118" display="block"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mi mathvariant="bold">y</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">Ay</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mtext>tr</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">AK</mml:mi></mml:mfenced><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="normal">μ</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">A</mml:mi><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par25">The “tr” in Eq. (<xref rid="Equ13" ref-type="disp-formula">13</xref>) stands for trace, which equals the sum of the diagonal elements. It follows that<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[ {V_{{\text{y}}} } \right] = \left[ {\overline{{{\text{diag}}\left( {\mathbf{K}} \right)}} - \overline{{{\text{K}}_{ \cdot \cdot } }} } \right] + \left[ {\overline{{\mu_{ \cdot }^{2} }} - \left( {\overline{\mu .} } \right)^{2} } \right]$$\end{document}</tex-math><mml:math id="M120" display="block"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mi>V</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">K</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mover><mml:msub><mml:mtext>K</mml:mtext><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mover><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mo>·</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:msup><mml:mfenced close=")" open="("><mml:mover><mml:mrow><mml:mi>μ</mml:mi><mml:mo>.</mml:mo></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq47"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overline{\mathrm{diag }(\mathbf{K})}$$\end{document}</tex-math><mml:math id="M122"><mml:mover><mml:mrow><mml:mi mathvariant="normal">diag</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">K</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq47.gif"/></alternatives></inline-formula> is the mean of the diagonal elements of <bold>K</bold>. Equation (<xref rid="Equ14" ref-type="disp-formula">14</xref>) follows the convention of using an overbar to indicate averaging with respect to dotted subscripts.</p>
      <p id="Par26">For effects indexed only by genotype, such as <inline-formula id="IEq48"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\mathrm{i}}$$\end{document}</tex-math><mml:math id="M124"><mml:msub><mml:mi>g</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq48.gif"/></alternatives></inline-formula>, Eq. (<xref rid="Equ14" ref-type="disp-formula">14</xref>) needs to be modified to accommodate unbalanced experiments. If <inline-formula id="IEq49"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{x}\sim \mathrm{MVN}\left({\varvec{\upmu}},\mathbf{K}\right)$$\end{document}</tex-math><mml:math id="M126"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>∼</mml:mo><mml:mi mathvariant="normal">MVN</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="bold">K</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq49.gif"/></alternatives></inline-formula>, and <bold>Z</bold> is the incidence matrix relating <bold>x</bold> to the <italic>gE</italic> basis of the Stage 2 model, then <inline-formula id="IEq50"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{y}=\mathbf{Z}\mathbf{x}$$\end{document}</tex-math><mml:math id="M128"><mml:mrow><mml:mi mathvariant="bold">y</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq50.gif"/></alternatives></inline-formula> is the random vector for which we need to compute the expected variance. The result is identical to Eq. (<xref rid="Equ14" ref-type="disp-formula">14</xref>) provided the averages are interpreted as weighted averages:<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} \overline{{{\text{diag}}\left( {\mathbf{K}} \right)}} = \frac{1}{t}\mathop \sum \limits_{i} w_{{\text{i}}} {\text{K}}_{{{\text{ii}}}} \hfill \\ \overline{{{\text{K}}_{ \cdot \cdot } }} = \frac{1}{{t^{2} }}\mathop \sum \limits_{i,j} w_{i} {\text{K}}_{{{\text{ij}}}} w_{{\text{j}}} \hfill \\ \overline{{\mu_{.}^{b} }} = \frac{1}{t}\mathop \sum \limits_{i} w_{i} \mu_{i}^{b} \,\,{\text{for exponent }}b = 1,2, \ldots \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M130" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">K</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mtext>i</mml:mtext></mml:msub><mml:msub><mml:mtext>K</mml:mtext><mml:mtext>ii</mml:mtext></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mover><mml:msub><mml:mtext>K</mml:mtext><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mtext>K</mml:mtext><mml:mtext>ij</mml:mtext></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mtext>j</mml:mtext></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mover><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mo>.</mml:mo></mml:mrow><mml:mi>b</mml:mi></mml:msubsup><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msubsup><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:mrow><mml:mtext>for exponent</mml:mtext><mml:mspace width="0.333333em"/></mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par27">The weights <inline-formula id="IEq51"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$w_{i}$$\end{document}</tex-math><mml:math id="M132"><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq51.gif"/></alternatives></inline-formula> in Eq. (<xref rid="Equ15" ref-type="disp-formula">15</xref>) come from <inline-formula id="IEq52"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{w}} = \mathbf{1}_{t}^{\varvec{^{\prime}}} {\mathbf{Z}}$$\end{document}</tex-math><mml:math id="M134"><mml:mrow><mml:mi mathvariant="bold">w</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow></mml:msubsup><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq52.gif"/></alternatives></inline-formula> and represent the number of environments for genotype <inline-formula id="IEq53"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M136"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq53.gif"/></alternatives></inline-formula>.</p>
      <p id="Par28">For the multi-location model, the genotype within location variance is computed using <inline-formula id="IEq54"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{K}} = {\mathbf{G}} \otimes {{\varvec{\Gamma}}}$$\end{document}</tex-math><mml:math id="M138"><mml:mrow><mml:mi mathvariant="bold">K</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="bold">G</mml:mi><mml:mo>⊗</mml:mo><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq54.gif"/></alternatives></inline-formula> and weights equal to the number of times each <italic>gL</italic> combination is present. For a balanced experiment with <italic>n</italic> individuals and <italic>s</italic> locations, the result is<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} E\left[ {V_{g\left( L \right)} } \right] &amp; = \frac{{{\text{tr}}\left( {{\mathbf{G}} \otimes {{\varvec{\Gamma}}}} \right)}}{ns} - \frac{{\left( {\mathbf{1}_{n}^{^{\prime}} \otimes \mathbf{1}_{s}^{^{\prime}} } \right)\left( {{\mathbf{G}} \otimes {{\varvec{\Gamma}}}} \right)\left( {\mathbf{1}_{n} \otimes \mathbf{1}_{s} } \right)}}{{n^{2} s^{2} }} \\ &amp; = \left[ {\overline{{{\text{diag}}\left( {\mathbf{G}} \right)}} } \right]\left[ {\overline{{{\text{diag}}\left( {{\varvec{\Gamma}}} \right)}} } \right] - \left( {\overline{{{\text{G}}_{ \cdot \cdot } }} } \right)\left( {\overline{{{\Gamma }_{ \cdot \cdot } }} } \right) \end{aligned}$$\end{document}</tex-math><mml:math id="M140" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mfenced close=")" open="("><mml:mi>L</mml:mi></mml:mfenced></mml:mrow></mml:msub></mml:mfenced></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>tr</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">G</mml:mi><mml:mo>⊗</mml:mo><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ns</mml:mi></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo>⊗</mml:mo><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">G</mml:mi><mml:mo>⊗</mml:mo><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mn mathvariant="bold">1</mml:mn><mml:mi>n</mml:mi></mml:msub><mml:mo>⊗</mml:mo><mml:msub><mml:mn mathvariant="bold">1</mml:mn><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">G</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mfenced close="]" open="["><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mo>-</mml:mo><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mtext>G</mml:mtext><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi mathvariant="normal">Γ</mml:mi><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par29">Following Rogers et al. (<xref ref-type="bibr" rid="CR49">2021</xref>), Eq. (<xref rid="Equ16" ref-type="disp-formula">16</xref>) is partitioned into a main effect <italic>V</italic><sub>g</sub> plus genotype x loc interaction <italic>V</italic><sub>gL</sub>. The main effect is based on the average of the <inline-formula id="IEq55"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{{s\left( {s - 1} \right)}}{2}$$\end{document}</tex-math><mml:math id="M142"><mml:mfrac><mml:mrow><mml:mi>s</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>s</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq55.gif"/></alternatives></inline-formula> off-diagonal elements of <inline-formula id="IEq56"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\varvec{\Gamma}}}$$\end{document}</tex-math><mml:math id="M144"><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq56.gif"/></alternatives></inline-formula>:<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[ {V_{g} } \right] = \left[ {\overline{{{\text{diag}}\left( {\mathbf{G}} \right)}} - \overline{{{\text{G}}_{ \cdot \cdot } }} } \right]\left[ {\frac{2}{{s\left( {s - 1} \right)}}\mathop \sum \limits_{i} \mathop \sum \limits_{j &gt; i} {\Gamma }_{{{\text{ij}}}} } \right]$$\end{document}</tex-math><mml:math id="M146" display="block"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mi>V</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">G</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mover><mml:msub><mml:mtext>G</mml:mtext><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mfrac><mml:mn>2</mml:mn><mml:mrow><mml:mi>s</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>s</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>&gt;</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi mathvariant="normal">Γ</mml:mi><mml:mtext>ij</mml:mtext></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par30">Equation (<xref rid="Equ17" ref-type="disp-formula">17</xref>) is extended to the unbalanced case by using weighted averages for <bold>G</bold>.</p>
    </sec>
    <sec id="Sec7">
      <title>BLUP</title>
      <p id="Par31">Empirical BLUPs are calculated conditional on the variance components estimated in Stage 2. All Stage 2 models described above can be written in the following standard form:<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{y}} = {\mathbf{X\updelta }} + {\mathbf{Zu}} + {{\varvec{\upvarepsilon}}}$$\end{document}</tex-math><mml:math id="M148" display="block"><mml:mrow><mml:mi mathvariant="bold">y</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold">X</mml:mi><mml:mi mathvariant="normal">δ</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="bold">Zu</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold">ε</mml:mi></mml:mrow></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq57"><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\varvec{\updelta}}}$$\end{document}</tex-math><mml:math id="M150"><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq57.gif"/></alternatives></inline-formula> is a vector of fixed effects (for environments, markers, and inbreeding), <inline-formula id="IEq58"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{u}$$\end{document}</tex-math><mml:math id="M152"><mml:mi mathvariant="bold">u</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq58.gif"/></alternatives></inline-formula> is a vector of multivariate normal genetic effects, and <inline-formula id="IEq59"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\upvarepsilon}}$$\end{document}</tex-math><mml:math id="M154"><mml:mrow><mml:mi mathvariant="bold">ε</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq59.gif"/></alternatives></inline-formula> is the “residual” vector (for the g x env and Stage 1 error effects). Let <inline-formula id="IEq60"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{\mathbf{u}}$$\end{document}</tex-math><mml:math id="M156"><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq60.gif"/></alternatives></inline-formula> denote BLUP[<bold>u</bold>], which is calculated one of two ways for numerical efficiency. If the length of <bold>y</bold> exceeds the length of <bold>u</bold>, then <inline-formula id="IEq61"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{\mathbf{u}}$$\end{document}</tex-math><mml:math id="M158"><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq61.gif"/></alternatives></inline-formula> is calculating by inverting the coefficient matrix of the mixed model equations (MME; Henderson <xref ref-type="bibr" rid="CR28">1975</xref>). Otherwise, <inline-formula id="IEq62"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{\mathbf{u}}$$\end{document}</tex-math><mml:math id="M160"><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq62.gif"/></alternatives></inline-formula> is calculated by inverting <inline-formula id="IEq63"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{V}} = var\left( {\mathbf{y}} \right)$$\end{document}</tex-math><mml:math id="M162"><mml:mrow><mml:mi mathvariant="bold">V</mml:mi><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">y</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq63.gif"/></alternatives></inline-formula> and using the following result (Searle et al. <xref ref-type="bibr" rid="CR53">1992</xref>):<disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} {\hat{\mathbf{u}}} = cov\left( {{\mathbf{u}},{\mathbf{y}}} \right){\mathbf{Py}} = var\left( {\mathbf{u}} \right){\mathbf{Z}}^{\prime}{\mathbf{Py}} \hfill \\ {\text{where }}{\mathbf{P}} = {\mathbf{V}}^{ - 1} - {\mathbf{V}}^{ - 1} {\mathbf{X}}\left( {{\mathbf{X^{\prime}V}}^{ - 1} {\mathbf{X}}} \right)^{ - 1} {\mathbf{X^{\prime}V}}^{ - 1} \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M164" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">u</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">Py</mml:mi><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">u</mml:mi></mml:mfenced><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">Py</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mrow><mml:mtext>where</mml:mtext><mml:mspace width="0.333333em"/></mml:mrow><mml:mi mathvariant="bold">P</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">X</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">V</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">X</mml:mi></mml:mrow></mml:mfenced><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">X</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">V</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par32">Genetic merit is a linear combination of random and fixed effects. For random effects, the structure of <bold>u</bold> is trait nested within individual, nested within additive vs. non-additive values. For fixed effects (ignoring the environment effects), <inline-formula id="IEq64"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\updelta}}$$\end{document}</tex-math><mml:math id="M166"><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq64.gif"/></alternatives></inline-formula> contains trait nested within marker effects, followed by trait nested within the regression coefficient for heterosis. If <bold>W</bold> represents the centered matrix of allele dosages for the fixed effect markers (<italic>n</italic> individuals x <italic>m</italic> markers), <bold>F</bold> is the vector of genomic inbreeding coefficients, and <bold>c</bold> is the vector of economic weights for multiple traits or locations, then the genetic merit vector for the population is<disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\varvec{\uptheta}}} = \left( {\left[ {\begin{array}{*{20}c} {{\mathbf{I}}_{n} } &amp; {\gamma {\mathbf{I}}_{n} } \\ \end{array} } \right] \otimes {\mathbf{c}}\varvec{^{\prime}}} \right){\mathbf{u}} + \left( {\left[ {\begin{array}{*{20}c} {\mathbf{W}} &amp; {\gamma {\mathbf{F}}} \\ \end{array} } \right] \otimes {\mathbf{c}}\varvec{^{\prime}}} \right){{\varvec{\updelta}}}$$\end{document}</tex-math><mml:math id="M168" display="block"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">θ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd><mml:mtd><mml:mrow><mml:mi>γ</mml:mi><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>⊗</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">u</mml:mi><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi mathvariant="bold">W</mml:mi></mml:mtd><mml:mtd><mml:mrow><mml:mi>γ</mml:mi><mml:mi mathvariant="bold">F</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>⊗</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow></mml:mrow></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par33">The value of <inline-formula id="IEq65"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M170"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq65.gif"/></alternatives></inline-formula> depends on which genetic value is predicted: 0 for additive value, 1 for total value, and <inline-formula id="IEq66"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left(\frac{\phi }{2}-1\right)/\left(\phi -1\right)$$\end{document}</tex-math><mml:math id="M172"><mml:mrow><mml:mfenced close=")" open="("><mml:mfrac><mml:mi>ϕ</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mfenced><mml:mo stretchy="false">/</mml:mo><mml:mfenced close=")" open="("><mml:mi>ϕ</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq66.gif"/></alternatives></inline-formula> for breeding value and ploidy <inline-formula id="IEq67"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><mml:math id="M174"><mml:mi>ϕ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq67.gif"/></alternatives></inline-formula> (Gallais <xref ref-type="bibr" rid="CR23">2003</xref>). Because BLUP is a linear operator, <inline-formula id="IEq68"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{{\varvec{\uptheta}}}=$$\end{document}</tex-math><mml:math id="M176"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">θ</mml:mi></mml:mrow><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq68.gif"/></alternatives></inline-formula> BLUP[<inline-formula id="IEq69"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\uptheta}}]$$\end{document}</tex-math><mml:math id="M178"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">θ</mml:mi></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq69.gif"/></alternatives></inline-formula> (i.e., the selection index) is given by Eq. (<xref rid="Equ20" ref-type="disp-formula">20</xref>) with <bold>u</bold> and <inline-formula id="IEq70"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\updelta}}$$\end{document}</tex-math><mml:math id="M180"><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq70.gif"/></alternatives></inline-formula> replaced by their predicted values.</p>
      <p id="Par34">Index coefficients entered by the user are interpreted as relative weights for standardized traits (or locations). To generate the vector <bold>c</bold>, the software divides the user-supplied weights by the standard deviations of the breeding values (estimated in Stage 2); it also applies an overall scaling such that <inline-formula id="IEq71"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Vert \mathbf{c}\Vert =1$$\end{document}</tex-math><mml:math id="M182"><mml:mrow><mml:mo stretchy="false">‖</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mo stretchy="false">‖</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq71.gif"/></alternatives></inline-formula>, which ensures predictions are commensurate with the original trait scale in multi-location models.</p>
      <p id="Par35">The reliability <inline-formula id="IEq72"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${r}_{i}^{2}$$\end{document}</tex-math><mml:math id="M184"><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq72.gif"/></alternatives></inline-formula> of the predicted merit <inline-formula id="IEq73"><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\theta }_{i}$$\end{document}</tex-math><mml:math id="M186"><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq73.gif"/></alternatives></inline-formula> for individual <italic>i</italic> is the squared correlation with its true value <inline-formula id="IEq74"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta_{i}$$\end{document}</tex-math><mml:math id="M188"><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq74.gif"/></alternatives></inline-formula>, which depends only on the random effects. If <inline-formula id="IEq75"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{u}}_{i}$$\end{document}</tex-math><mml:math id="M190"><mml:msub><mml:mi mathvariant="bold">u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq75.gif"/></alternatives></inline-formula> represents the vector of random genetic effects for individual <italic>i</italic>, and <inline-formula id="IEq76"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\varvec{\uplambda}}} \, {{\text{denotes} }}\left[ {\begin{array}{*{20}c} 1 &amp; \gamma \\ \end{array} } \right]^{\prime} \otimes {\mathbf{c}}$$\end{document}</tex-math><mml:math id="M192"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow><mml:mspace width="0.166667em"/><mml:mtext>denotes</mml:mtext><mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>′</mml:mo></mml:msup><mml:mo>⊗</mml:mo><mml:mi mathvariant="bold">c</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq76.gif"/></alternatives></inline-formula><bold>,</bold> then the random effects component of <inline-formula id="IEq77"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta_{i}$$\end{document}</tex-math><mml:math id="M194"><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq77.gif"/></alternatives></inline-formula> is <inline-formula id="IEq78"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{\varvec{\uplambda}}}^{\prime}{\mathbf{u}}_{i}$$\end{document}</tex-math><mml:math id="M196"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:msub><mml:mi mathvariant="bold">u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq78.gif"/></alternatives></inline-formula>, and the reliability is<disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_{i}^{2} = \frac{{cov^{2} \left( {\theta_{i} ,\hat{\theta }_{i} } \right)}}{{var\left( {\theta_{i} } \right)var\left( {\hat{\theta }_{i} } \right)}} = \frac{{\left[ {{{\varvec{\uplambda}}}^{\prime}cov\left( {{\mathbf{u}}_{i} ,{\hat{\mathbf{u}}}_{i} } \right){{\varvec{\uplambda}}}} \right]^{2} }}{{\left[ {{{\varvec{\uplambda}}}^{\prime}var\left( {{\mathbf{u}}_{i} } \right){{\varvec{\uplambda}}}} \right]\left[ {{{\varvec{\uplambda}}}^{\prime}var\left( {{\hat{\mathbf{u}}}_{i} } \right){{\varvec{\uplambda}}}} \right]}} = \frac{{{{\varvec{\uplambda}}}^{\prime}var\left( {{\hat{\mathbf{u}}}_{i} } \right){{\varvec{\uplambda}}}}}{{{{\varvec{\uplambda}}}^{\prime}var\left( {{\mathbf{u}}_{i} } \right){{\varvec{\uplambda}}}}}$$\end{document}</tex-math><mml:math id="M198" display="block"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:msup><mml:mi>v</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi mathvariant="bold">u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow></mml:mfenced><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mi mathvariant="bold">u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mi mathvariant="bold">u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mrow><mml:mi mathvariant="bold">λ</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par36">The final equality in Eq. (<xref rid="Equ21" ref-type="disp-formula">21</xref>) relies on the following property of BLUP: <inline-formula id="IEq79"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$cov\left(\mathbf{u},\widehat{\mathbf{u}}\right)=var\left(\widehat{\mathbf{u}}\right)$$\end{document}</tex-math><mml:math id="M200"><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">u</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq79.gif"/></alternatives></inline-formula>. For the MME solution method, the <inline-formula id="IEq80"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$var\left(\widehat{\mathbf{u}}\right)$$\end{document}</tex-math><mml:math id="M202"><mml:mrow><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq80.gif"/></alternatives></inline-formula> matrix is computed as <inline-formula id="IEq81"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$var\left(\mathbf{u}\right)-{\mathbf{C}}_{22}$$\end{document}</tex-math><mml:math id="M204"><mml:mrow><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">u</mml:mi></mml:mfenced><mml:mo>-</mml:mo><mml:msub><mml:mi mathvariant="bold">C</mml:mi><mml:mn>22</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq81.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq82"><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{C}}_{22}$$\end{document}</tex-math><mml:math id="M206"><mml:msub><mml:mi mathvariant="bold">C</mml:mi><mml:mn>22</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq82.gif"/></alternatives></inline-formula> is from the partitioned inverse coefficient matrix (Henderson <xref ref-type="bibr" rid="CR28">1975</xref>). For the <bold>V</bold> inversion method, <inline-formula id="IEq83"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$var\left(\widehat{\mathbf{u}}\right)=var\left(\mathbf{u}\right)\left({\mathbf{Z}}^{\mathbf{^{\prime}}}\mathbf{P}\mathbf{Z}\right)var(\mathbf{u})$$\end{document}</tex-math><mml:math id="M208"><mml:mrow><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">u</mml:mi></mml:mfenced><mml:mfenced close=")" open="("><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mi mathvariant="bold">P</mml:mi><mml:mi mathvariant="bold">Z</mml:mi></mml:mfenced><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq83.gif"/></alternatives></inline-formula> (Searle et al. <xref ref-type="bibr" rid="CR53">1992</xref>).</p>
    </sec>
    <sec id="Sec8">
      <title>Selection response</title>
      <p id="Par37">The breeder’s equation provides the expected response to truncation selection on predicted merit <inline-formula id="IEq84"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{\theta }$$\end{document}</tex-math><mml:math id="M210"><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq84.gif"/></alternatives></inline-formula>. If <inline-formula id="IEq85"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{b}$$\end{document}</tex-math><mml:math id="M212"><mml:mi mathvariant="bold">b</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq85.gif"/></alternatives></inline-formula> denotes the multi-trait vector of breeding values for an individual, then its predicted merit is <inline-formula id="IEq86"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{\theta } = {\mathbf{c}}^{\prime}{\hat{\mathbf{b}}}$$\end{document}</tex-math><mml:math id="M214"><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">b</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq86.gif"/></alternatives></inline-formula> (see Eq. <xref rid="Equ20" ref-type="disp-formula">20</xref>), and the multi-trait response <bold>x</bold> under selection intensity <italic>i</italic> is<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}} = \left[ {i\sigma_{{\hat{\theta }}} } \right]\left[ {\frac{{cov_{n} \left( {{\mathbf{b}}, \hat{\theta }} \right)}}{{\sigma_{{\hat{\theta }}}^{2} }}} \right] = i \sigma_{{\hat{\theta }}}^{ - 1} cov_{n} \left( {{\mathbf{b}},{\hat{\mathbf{b}}}} \right){\mathbf{c}}$$\end{document}</tex-math><mml:math id="M216" display="block"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>σ</mml:mi><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mfrac><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>v</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">b</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfrac></mml:mfenced><mml:mo>=</mml:mo><mml:mi>i</mml:mi><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>v</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">b</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi mathvariant="bold">b</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">c</mml:mi></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par38">(To connect Eq. (<xref rid="Equ22" ref-type="disp-formula">22</xref>) with a familiar form of the breeder’s equation, the first bracketed term is the selection differential, and the second bracketed term represents heritability.) The subscript <italic>n</italic> on <inline-formula id="IEq87"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$co{v}_{n}$$\end{document}</tex-math><mml:math id="M218"><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>v</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq87.gif"/></alternatives></inline-formula> indicates it is the covariance with respect to the <italic>n</italic> individuals in the population, which differs slightly from the covariance of a vector with respect to its MVN distribution (see “<xref rid="Sec15" ref-type="sec">Appendix</xref>”). As mentioned earlier, under BLUP, the latter covariance satisfies <inline-formula id="IEq88"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$cov\left(\mathbf{u},\widehat{\mathbf{u}}\right)=var\left(\widehat{\mathbf{u}}\right)$$\end{document}</tex-math><mml:math id="M220"><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">u</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq88.gif"/></alternatives></inline-formula>. Combining this result with “<xref rid="Sec15" ref-type="sec">Appendix</xref>” Eq. (<xref rid="Equ35" ref-type="disp-formula">35</xref>), it follows that <inline-formula id="IEq89"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$co{v}_{n}\left(\mathbf{b},\widehat{\mathbf{b}}\right)=va{r}_{n}(\widehat{\mathbf{b}})$$\end{document}</tex-math><mml:math id="M222"><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>v</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">b</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi mathvariant="bold">b</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mfenced><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi mathvariant="bold">b</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq89.gif"/></alternatives></inline-formula>, which is denoted <bold>B</bold>. The formula for traits <italic>j</italic> and <italic>k</italic> is<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} B_{jk} = \overline{{{{\text{diag}}}\left( {\mathbf{L}} \right)}} - \overline{{L_{ \cdot \cdot } }} + \overline{{\mu_{j \cdot } \mu_{k \cdot } }} - \left( {\overline{{\mu_{j \cdot } }} } \right)\left( {\overline{{\mu_{k \cdot } }} } \right) \hfill \\ {\mathbf{L}} = \left[ {\begin{array}{*{20}c} {{\mathbf{I}}_{n} } &amp; {\gamma {\mathbf{I}}_{n} } \\ \end{array} } \right]cov\left( {{\hat{\mathbf{u}}}_{j} ,{\hat{\mathbf{u}}}_{k} } \right)\left[ {\begin{array}{*{20}c} {{\mathbf{I}}_{t} } &amp; {\gamma {\mathbf{I}}_{t} } \\ \end{array} } \right]^{\prime} \hfill \\ {{\varvec{\upmu}}}_{j} = \left[ {\begin{array}{*{20}c} {\mathbf{W}} &amp; {\gamma {\mathbf{F}}} \\ \end{array} } \right]{{\varvec{\updelta}}}_{j} \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M224" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>B</mml:mi><mml:mrow><mml:mi mathvariant="italic">jk</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">L</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mover><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>·</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">L</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd><mml:mtd><mml:mrow><mml:mi>γ</mml:mi><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mtd><mml:mtd><mml:mrow><mml:mi>γ</mml:mi><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi mathvariant="bold">W</mml:mi></mml:mtd><mml:mtd><mml:mrow><mml:mi>γ</mml:mi><mml:mi mathvariant="bold">F</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par39">The vector <inline-formula id="IEq90"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widehat{\mathbf{u}}}_{j}$$\end{document}</tex-math><mml:math id="M226"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq90.gif"/></alternatives></inline-formula> is a 2<italic>n</italic> × 1 stacked vector of the predicted additive and non-additive values for a population of size <italic>n</italic>. The calculation of <inline-formula id="IEq91"><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$cov({\widehat{\mathbf{u}}}_{j}, {\widehat{\mathbf{u}}}_{k})$$\end{document}</tex-math><mml:math id="M228"><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq91.gif"/></alternatives></inline-formula> follows the same procedure described above (see Eq. <xref rid="Equ19" ref-type="disp-formula">19</xref>), and the contribution from <inline-formula id="IEq92"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\updelta}}$$\end{document}</tex-math><mml:math id="M230"><mml:mrow><mml:mi mathvariant="bold">δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq92.gif"/></alternatives></inline-formula> is calculated using the fixed effect estimates. Since the overall scaling of the index coefficients is arbitrary, we can impose <inline-formula id="IEq93"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{\widehat{\theta }}^{2}=1$$\end{document}</tex-math><mml:math id="M232"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq93.gif"/></alternatives></inline-formula>. Inverting Eq. (<xref rid="Equ22" ref-type="disp-formula">22</xref>) under this constraint leads to an expression for the index coefficients:<disp-formula id="Equ24"><label>24</label><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{c}} = i^{ - 1} {\mathbf{B}}^{ - 1} {\mathbf{x}}$$\end{document}</tex-math><mml:math id="M234" display="block"><mml:mrow><mml:mi mathvariant="bold">c</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par40">Substituting this result into <inline-formula id="IEq94"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${1=\sigma }_{\widehat{\theta }}^{2}={\mathbf{c}}^{\mathbf{^{\prime}}}\mathbf{B}\mathbf{c}$$\end{document}</tex-math><mml:math id="M236"><mml:mrow><mml:msubsup><mml:mrow><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mi mathvariant="bold">B</mml:mi><mml:mi mathvariant="bold">c</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq94.gif"/></alternatives></inline-formula> leads to an implicit equation for the response:<disp-formula id="Equ25"><label>25</label><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x^{\prime}B}}^{ - 1} {\mathbf{x}} - i^{2} = 0$$\end{document}</tex-math><mml:math id="M238" display="block"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">x</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">B</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">x</mml:mi><mml:mo>-</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">Equation (<xref rid="Equ25" ref-type="disp-formula">25</xref>) is the matrix representation of an ellipsoid in <italic>t</italic> dimensions, which is used by StageWise to provide a geometric visualization of selection tradeoffs. (The software DESIRE (Kinghorn <xref ref-type="bibr" rid="CR32">2013</xref>) is an earlier example of plotting the elliptical multi-trait response.) If the response is expressed in units of genetic standard deviation, a diagonal matrix <inline-formula id="IEq95"><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\Delta}}$$\end{document}</tex-math><mml:math id="M240"><mml:mrow><mml:mi mathvariant="bold">Δ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq95.gif"/></alternatives></inline-formula> with elements <inline-formula id="IEq96"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{b}=\sqrt{{\sigma }_{\mathrm{A}}^{2}+{\gamma }^{2}{\sigma }_{\mathrm{D}}^{2}}$$\end{document}</tex-math><mml:math id="M242"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi mathvariant="normal">A</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:msqrt></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq96.gif"/></alternatives></inline-formula> is used to rescale the matrix of the quadratic form as <inline-formula id="IEq97"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\Delta}}{\mathbf{B}}^{-1}{\varvec{\Delta}}$$\end{document}</tex-math><mml:math id="M244"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Δ</mml:mi></mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mi mathvariant="bold">Δ</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq97.gif"/></alternatives></inline-formula>. The principal axes of the ellipse are given by the eigenvectors of this matrix, and the lengths of the semi-axes equal the inverse square-root of the eigenvalues.</p>
      <p id="Par42">This geometric model provides a convenient method for implementing a restricted selection index, in which the response for some traits is constrained to be zero (Kempthorne and Nordskog <xref ref-type="bibr" rid="CR31">1959</xref>). From above, the change in genetic merit associated with response <bold>x</bold> is <inline-formula id="IEq98"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf{c}\mathbf{^{\prime}}\mathbf{x}$$\end{document}</tex-math><mml:math id="M246"><mml:mrow><mml:mi mathvariant="bold">c</mml:mi><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq98.gif"/></alternatives></inline-formula>, which is the projection of <bold>x</bold> onto <bold>c</bold> times the magnitude of <bold>c</bold>. For the unrestricted index, the response that maximizes genetic gain is therefore the solution of the following convex optimization problem:<disp-formula id="Equ26"><label>26</label><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} \mathop {\max }\limits_{{\mathbf{x}}} {\mathbf{c^{\prime}x}} \hfill \\ {\mathbf{x^{\prime}B}}^{ - 1} {\mathbf{x}} \le 1 \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M248" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:munder><mml:mo movablelimits="false">max</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:munder><mml:mrow><mml:msup><mml:mi mathvariant="bold">c</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">x</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">B</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">x</mml:mi><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par43">The linear inequality constraint in Eq. (<xref rid="Equ26" ref-type="disp-formula">26</xref>), which is convex, replaces the linear equality constraint of Eq. (<xref rid="Equ25" ref-type="disp-formula">25</xref>), which is not convex. This substitution is valid because the linear objective ensures the optimum is on the boundary (Boyd and Vandenberghe <xref ref-type="bibr" rid="CR7">2004</xref>). For the restricted index, the restricted traits are not included in the objective <inline-formula id="IEq99"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{c}}^{\mathrm{^{\prime}}}\mathbf{x}$$\end{document}</tex-math><mml:math id="M250"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq99.gif"/></alternatives></inline-formula>, and equality or inequality constraints on the genetic gain <inline-formula id="IEq100"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}_{i}$$\end{document}</tex-math><mml:math id="M252"><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq100.gif"/></alternatives></inline-formula> for restricted trait <italic>i</italic> are added to Eq. (<xref rid="Equ26" ref-type="disp-formula">26</xref>). Convex optimization is performed using CVXR (Fu et al. <xref ref-type="bibr" rid="CR22">2020</xref>), and the index coefficients are computed from the optimal <bold>x</bold> via Eq. (<xref rid="Equ24" ref-type="disp-formula">24</xref>) with intensity <italic>i</italic> = 1.</p>
    </sec>
    <sec id="Sec9">
      <title>Marker effects and GWAS</title>
      <p id="Par44">Marker effects and GWAS scores are also calculated by BLUP. Let <inline-formula id="IEq101"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\upalpha}}$$\end{document}</tex-math><mml:math id="M254"><mml:mrow><mml:mi mathvariant="bold">α</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq101.gif"/></alternatives></inline-formula> represent the <italic>mt</italic> × 1 vector of additive (substitution) effects for <italic>t</italic> traits/locations nested within <italic>m</italic> markers, with variance–covariance matrix <inline-formula id="IEq102"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{I}}_{m} \otimes {{\varvec{\Gamma}}}\left( {\phi \mathop \sum \nolimits_{k} p_{k} q_{k} } \right)^{ - 1}$$\end{document}</tex-math><mml:math id="M256"><mml:mrow><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>⊗</mml:mo><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>ϕ</mml:mi><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq102.gif"/></alternatives></inline-formula> for ploidy <inline-formula id="IEq103"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><mml:math id="M258"><mml:mi>ϕ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq103.gif"/></alternatives></inline-formula> (Endelman et al. <xref ref-type="bibr" rid="CR18">2018</xref>). From the linearity of BLUP, the predicted multi-trait index of marker effects is <inline-formula id="IEq104"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {{\mathbf{I}}_{m} \otimes {\mathbf{c}}^{\prime}} \right){\hat{\mathbf{\alpha }}}$$\end{document}</tex-math><mml:math id="M260"><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq104.gif"/></alternatives></inline-formula><bold>,</bold> and from Eq. (<xref rid="Equ19" ref-type="disp-formula">19</xref>), <inline-formula id="IEq105"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{\mathbf{\alpha }}}$$\end{document}</tex-math><mml:math id="M262"><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq105.gif"/></alternatives></inline-formula> can be written in terms of the predicted additive values <inline-formula id="IEq106"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{\mathbf{a}}}$$\end{document}</tex-math><mml:math id="M264"><mml:mover accent="true"><mml:mi mathvariant="bold">a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq106.gif"/></alternatives></inline-formula> as<disp-formula id="Equ27"><label>27</label><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{gathered} {\hat{\mathbf{\alpha }}} = cov\left( {{{\varvec{\upalpha}}},{\mathbf{y}}} \right){\mathbf{Py}} = var\left( {{\varvec{\upalpha}}} \right)\left[ {{\mathbf{W^{\prime}}} \otimes {\mathbf{I}}_{t} } \right]\left[ {{\mathbf{G}}^{ - 1} \otimes {{\varvec{\Gamma}}}^{ - 1} } \right]{\hat{\mathbf{a}}} = \frac{{\left( {{\mathbf{W^{\prime}G}}^{ - 1} \otimes {\mathbf{I}}_{t} } \right){\hat{\mathbf{a}}}}}{{\phi \mathop \sum \nolimits_{k} p_{k} q_{k} }} \hfill \\ \Rightarrow \left( {{\mathbf{I}}_{m} \otimes {\mathbf{c}^{\prime}}} \right){\hat{\mathbf{\upalpha }}} = \frac{{\left( {{\mathbf{W^{\prime}G}}^{ - 1} \otimes {\mathbf{c}}^{\prime}} \right){\hat{\mathbf{a}}}}}{{\phi \mathop \sum \nolimits_{k} p_{k} q_{k} }} \hfill \\ \end{gathered}$$\end{document}</tex-math><mml:math id="M266" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mrow><mml:mi mathvariant="bold">α</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="bold">y</mml:mi></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">Py</mml:mi><mml:mo>=</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">α</mml:mi></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mi mathvariant="bold">W</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>⊗</mml:mo><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="bold">Γ</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="bold">a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">W</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">G</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⊗</mml:mo><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="bold">a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mo stretchy="false">⇒</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="normal">α</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">W</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">G</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="bold">a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>ϕ</mml:mi><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par45">The <bold>W</bold> matrix in Eq. (<xref rid="Equ27" ref-type="disp-formula">27</xref>) is the centered matrix of allele dosages (individuals x markers). A similar result holds for relating the multi-trait index of digenic substitution effects <inline-formula id="IEq107"><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\varvec{\upbeta}}$$\end{document}</tex-math><mml:math id="M268"><mml:mrow><mml:mi mathvariant="bold">β</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq107.gif"/></alternatives></inline-formula> to the predicted dominance values <inline-formula id="IEq108"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{\mathbf{d}}}$$\end{document}</tex-math><mml:math id="M270"><mml:mover accent="true"><mml:mi mathvariant="bold">d</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq108.gif"/></alternatives></inline-formula> (Eq. <xref rid="Equ7" ref-type="disp-formula">7</xref>):<disp-formula id="Equ28"><label>28</label><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {{\mathbf{I}}_{{\text{m}}} \otimes {\mathbf{c}^{\prime}}} \right){\hat{\mathbf{\upbeta }}} = \frac{{\left( {{\mathbf{Q^{\prime}D}}^{ - 1} \otimes {\mathbf{c}}^{\prime}} \right){\hat{\mathbf{d}}}}}{{\left( {\begin{array}{*{20}c} \phi \\ 2 \\ \end{array} } \right)\mathop \sum \nolimits_{k} 4p_{k}^{2} q_{k}^{2} }}$$\end{document}</tex-math><mml:math id="M272" display="block"><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mtext>m</mml:mtext></mml:msub><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="normal">β</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold">Q</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi mathvariant="bold">D</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mi mathvariant="bold">d</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>ϕ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mn>4</mml:mn><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>q</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par46">The fixed effect for inbreeding is included in <inline-formula id="IEq109"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widehat{\mathbf{d}}$$\end{document}</tex-math><mml:math id="M274"><mml:mover accent="true"><mml:mi mathvariant="bold">d</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq109.gif"/></alternatives></inline-formula> and therefore represented in the predicted marker effects.</p>
      <p id="Par47">GWAS p-values are computed from the standardized BLUPs of the marker effects, which are asymptotically standard normal (Gualdrón Duarte et al. <xref ref-type="bibr" rid="CR26">2014</xref>). If <inline-formula id="IEq110"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{w}}_{k}$$\end{document}</tex-math><mml:math id="M276"><mml:msub><mml:mi mathvariant="bold">w</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq110.gif"/></alternatives></inline-formula> denotes the <italic>k</italic>th column of the <bold>W</bold> matrix, then the standard error of the predicted additive effect for marker <italic>k</italic> is<disp-formula id="Equ29"><label>29</label><alternatives><tex-math id="M277">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{{\left[ {\left( {{\mathbf{w}}_{k}^{{\prime}} {\mathbf{G}}^{ - 1} \otimes {\mathbf{c}}^{\prime}} \right)var\left( {{\hat{\mathbf{a}}}} \right)\left( {{\mathbf{G}}^{ - 1} {\mathbf{w}}_{k} \otimes {\mathbf{c}}} \right)} \right]^{1/2} }}{{\phi \mathop \sum \nolimits_{k} p_{k} q_{k} }}$$\end{document}</tex-math><mml:math id="M278" display="block"><mml:mfrac><mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">w</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⊗</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">c</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:mfenced><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mfenced close=")" open="("><mml:mover accent="true"><mml:mi mathvariant="bold">a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi mathvariant="bold">w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>⊗</mml:mo><mml:mi mathvariant="bold">c</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mrow><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mi>ϕ</mml:mi><mml:msub><mml:mo>∑</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="122_2023_4298_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par48">The formula for dominance effects is analogous, based on Eq. (<xref rid="Equ28" ref-type="disp-formula">28</xref>). StageWise provides the option to parallelize this computation across multiple cores. To control for multiple testing, the desired significance level specified by the user is divided by the effective number of markers (Moskvina and Schmidt <xref ref-type="bibr" rid="CR41">2008</xref>) to set the<italic> p</italic> value discovery threshold.</p>
    </sec>
    <sec id="Sec10">
      <title>Potato data analysis</title>
      <p id="Par49">The potato dataset is an updated version of the data from Endelman et al. (<xref ref-type="bibr" rid="CR18">2018</xref>), which spanned 2012–2017 at one location (Hancock, WI) and contained 571 clones from both preliminary and advanced yield trials. The current version spans 2015–2020 and contains 943 clones. Fixed effects for block or trial, as well as stand count, were used in Stage 1. Three traits were analyzed: total yield (Mg ha<sup>−1</sup>), vine maturity (1 [early] to 9 [late] visual scale at 100 days after planting), and potato chip fry color (Hunter <italic>L</italic>) after 6 months of storage. The G matrix was used for multi-trait analysis, instead of H, due to convergence problems with the latter.</p>
      <p id="Par50">Marker data files contain the estimated allele dosage (0–4) from genotyping with potato SNP array v2 or v3 (which contains most of v2) (Felcher et al. <xref ref-type="bibr" rid="CR19">2012</xref>; Vos et al. <xref ref-type="bibr" rid="CR59">2015</xref>). Genotype calls were made with R package fitPoly (Zych et al. <xref ref-type="bibr" rid="CR63">2019</xref>). Data from the two array versions were combined with the command <italic>merge_impute</italic> from R package polyBreedR (<ext-link ext-link-type="uri" xlink:href="https://github.com/jendelman/polyBreedR">https://github.com/jendelman/polyBreedR</ext-link>). This command performs one iteration of the EM algorithm described in Poland et al. (<xref ref-type="bibr" rid="CR45">2012</xref>) (only one iteration is needed for complete datasets at low and high density), followed by shift and scaling (if necessary) to ensure all data are in the interval [0, ploidy].</p>
    </sec>
  </sec>
  <sec id="Sec11">
    <title>Results</title>
    <p id="Par51">The workflow to analyze data with StageWise is illustrated in Fig. <xref rid="Fig1" ref-type="fig">1</xref>. Any software can be used to compute genotype BLUEs and their variance–covariance matrix in Stage 1. For convenience, the package has a command named <italic>Stage1</italic>, which can accommodate any number of fixed or i.i.d. random covariates, as well as spatial analysis using SpATS (Rodríguez-Álvarez et al. <xref ref-type="bibr" rid="CR48">2018</xref>). To partition genetic value into additive and non-additive components, genome-wide marker data is processed with the command <italic>read_geno</italic>, and the output is then included in the call to <italic>Stage2</italic>. After estimating the variance components with <italic>Stage2</italic>, the <italic>blup_prep</italic> command inverts either the coefficient matrix of the mixed model equations or the variance–covariance matrix of the Stage 2 response variable, whichever is smaller. This allows for rapid, iterative use of the <italic>blup</italic> command to obtain different types of predictions and standard errors, which are used in the calculation of reliability (i.e., squared accuracy) for individuals and GWAS scores for markers. Three vignettes, or tutorials, come with the software to give detailed examples of using the commands. The following results represent a condensed version of this information.<fig id="Fig1"><label>Fig. 1</label><caption><p>Overview of the commands and workflow in R/StageWise</p></caption><graphic xlink:href="122_2023_4298_Fig1_HTML" id="MO1"/></fig></p>
    <p id="Par52">The primary dataset comes from six years of potato yield trials at a single location and includes 943 genotyped clones. The genotypic values of heterozygous clones have both additive and non-additive components. Non-additive values can be modeled in StageWise either as genetic residuals (no covariance) or as dominance values. In the context of genomic prediction, directional dominance models use inbreeding coefficients to estimate heterosis. Figure <xref rid="Fig2" ref-type="fig">2</xref> compares three types of inbreeding coefficients for this population: (1) <italic>F</italic><sub>D</sub>, from the directional dominance model, (2) <italic>F</italic><sub>G</sub>, from the diagonal elements of the additive genomic relationship matrix, and (3) <italic>F</italic><sub>A</sub>, from the diagonal elements of the pedigree relationship matrix. The F<sub>G</sub> and F<sub>D</sub> coefficients from the genomic models were highly correlated (<italic>r</italic> = 0.98) and have the same population mean, − 0.08, which indicates a slight excess of heterozygosity compared to panmictic (Hardy–Weinberg) equilibrium. Although there was some concordance between the genomic and pedigree coefficients for the most inbred individuals, there was little agreement at small values of <italic>F</italic><sub>A</sub> (Fig. <xref rid="Fig2" ref-type="fig">2</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><p>Comparison of inbreeding coefficients (F) for a population of 943 potato breeding lines. The vertical axis is computed from the dominance coefficients, and the horizontal axis is computed from the additive relationship matrix</p></caption><graphic xlink:href="122_2023_4298_Fig2_HTML" id="MO2"/></fig></p>
    <sec id="Sec12">
      <title>Single trait analysis</title>
      <p id="Par53">Initially, the three traits in the potato dataset–total yield, chip fry color, and vine maturity–were analyzed independently. In Stage 1, broad-sense heritability on a plot basis was highest for yield (0.70–0.83), with similar results for fry color (0.25–0.74) and maturity (0.38–0.74) (Figure S1, ESM1). The benefit of including Stage 1 errors in the Stage 2 model was assessed based on the change in AIC, which ranged from − 29 for maturity to − 104 for fry color (Table <xref rid="Tab1" ref-type="table">1</xref>). Applying the <italic>summary</italic> command to the output from <italic>Stage2</italic> generates a table with the proportion of variation explained (PVE). The PVE for additive effects, which can be called genomic heritability, ranged from 0.34 (yield) to 0.43 (maturity) (Table <xref rid="Tab2" ref-type="table">2</xref>). The PVE for dominance effects has two parts: one due to the variance of the dominance effects (“Dominance” in Table <xref rid="Tab2" ref-type="table">2</xref>), and the other from variation in the genomic inbreeding coefficient (“Heterosis” in Table <xref rid="Tab2" ref-type="table">2</xref>). Of the three traits, yield had the largest influence of dominance, with a combined PVE of 0.15.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Akaike Information Criterion (AIC) for the Stage 2 model with vs. without inclusion of the Stage 1 errors</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Yield</th><th align="left">Fry color</th><th align="left">Vine maturity</th></tr></thead><tbody><tr><td align="left">Without</td><td align="left">7007</td><td align="left">4662</td><td align="left">2018</td></tr><tr><td align="left">With</td><td align="left">6940</td><td align="left">4558</td><td align="left">1989</td></tr><tr><td align="left">Change</td><td align="left">− 67</td><td align="left">− 104</td><td align="left">− 29</td></tr></tbody></table></table-wrap><table-wrap id="Tab2"><label>Table 2</label><caption><p>Proportion of variation explained for the multi-year potato dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Yield</th><th align="left">Fry color</th><th align="left">Vine maturity</th></tr></thead><tbody><tr><td align="left">Additive</td><td char="." align="char">0.34</td><td char="." align="char">0.38</td><td char="." align="char">0.43</td></tr><tr><td align="left">Dominance</td><td char="." align="char">0.12</td><td char="." align="char">0.04</td><td char="." align="char">0.02</td></tr><tr><td align="left">Heterosis</td><td char="." align="char">0.03</td><td char="." align="char">0.00</td><td char="." align="char">0.00</td></tr><tr><td align="left">Genotype x year</td><td char="." align="char">0.30</td><td char="." align="char">0.24</td><td char="." align="char">0.16</td></tr><tr><td align="left">Stage 1 error</td><td char="." align="char">0.21</td><td char="." align="char">0.34</td><td char="." align="char">0.39</td></tr></tbody></table><table-wrap-foot><p>Both “Dominance” and “Heterosis” come from the directional dominance model</p></table-wrap-foot></table-wrap></p>
      <p id="Par54">StageWise has the ability for genomic prediction with the H matrix, which is a weighted average of G and A that was originally developed to use ungenotyped individuals in the training population (Legarra et al. <xref ref-type="bibr" rid="CR36">2009</xref>; Christensen and Lund <xref ref-type="bibr" rid="CR9">2010</xref>). Even when all individuals are genotyped, H may still outperform G due to the sparsity of A (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). For the potato dataset, the change in AIC with H ranged from − 6 (fry color) to − 13 (yield). The optimum weight for A was 0.3 for vine maturity and fry color and 0.5 for yield. As the weight for A increased, the estimate for genomic heritability (solid line in Fig. <xref rid="Fig3" ref-type="fig">3</xref>) also increased, at the expense of dominance (dashed line).<fig id="Fig3"><label>Fig. 3</label><caption><p>Minimizing the Akaike Information Criterion (AIC) to select the optimal weighting of pedigree (A) and marker (G) additive relationship matrices: <bold>H</bold> = w<bold>A</bold> + (1–w)<bold>G</bold>. The optimal weight varied by trait in a potato dataset of 943 clones. The proportion of variation explained (PVE) by the additive effects (solid line) increased with w, while the PVE for the dominance effects (dashed line) decreased</p></caption><graphic xlink:href="122_2023_4298_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par55">The <italic>blup_prep</italic> command has an option to mask Stage 1 BLUEs, which can be used to estimate the accuracy of predicting new individuals or new environments. Figure <xref rid="Fig4" ref-type="fig">4</xref> compares the reliability of genome-wide marker-assisted selection (MAS) vs. marker-based selection (MBS) for the last breeding cohort in the potato dataset. The distinction between MAS and MBS is that the selection candidates are part of the training set with MAS but not with MBS (Bernardo <xref ref-type="bibr" rid="CR5">2010</xref>). The reliability of MAS <inline-formula id="IEq111"><alternatives><tex-math id="M279">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${(r}_{A}^{2})$$\end{document}</tex-math><mml:math id="M280"><mml:mrow><mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq111.gif"/></alternatives></inline-formula> was 0.14–0.21 higher than MBS <inline-formula id="IEq112"><alternatives><tex-math id="M281">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${(r}_{B}^{2})$$\end{document}</tex-math><mml:math id="M282"><mml:mrow><mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq112.gif"/></alternatives></inline-formula> across traits. From index theory (Lande and Thompson <xref ref-type="bibr" rid="CR34">1990</xref>; Riedelsheimer and Melchinger <xref ref-type="bibr" rid="CR47">2013</xref>), the two quantities are related b﻿y<fig id="Fig4"><label>Fig. 4</label><caption><p>Comparing the reliability (<italic>r</italic><sup>2</sup>) of marker-assisted (MAS) vs. marker-based (MBS) genomic selection in the potato dataset. Each point represents a clone from one breeding cohort, and the blue line is a linear trendline. The increased accuracy from having phenotypes for the selection candidates (MAS) was closely predicted by selection index theory (dashed line)</p></caption><graphic xlink:href="122_2023_4298_Fig4_HTML" id="MO4"/></fig><disp-formula id="Equ30"><label>30</label><alternatives><tex-math id="M283">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${r}_{A}^{2}={r}_{B}^{2}+\frac{{h}^{2}{\left(1-{r}_{B}^{2}\right)}^{2}}{\left(1-{h}^{2}{r}_{B}^{2}\right)}$$\end{document}</tex-math><mml:math id="M284" display="block"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfenced></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mfenced close=")" open="("><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mfenced></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par56">When used with the genomic heritability estimates from <italic>Stage2</italic>, this formula closely matched the data for all three traits (Fig. <xref rid="Fig4" ref-type="fig">4</xref>).</p>
      <p id="Par57">Although GWAS is not the emphasis of StageWise, the software can perform a fully efficient, two-stage GWAS. For the potato dataset, there was a major QTL for vine maturity on chr05 (Figure S2, ESM1), in the vicinity of the well-known regulator of potato maturity <italic>StCDF1</italic> (Kloosterman et al. <xref ref-type="bibr" rid="CR33">2013</xref>). <italic>Stage2</italic> has an optional argument to include markers as fixed effects for major QTL. In this case, the PVE for the marker was 0.10, which represents 21% of the total additive variance.</p>
    </sec>
    <sec id="Sec13">
      <title>Multi-trait analysis</title>
      <p id="Par58">Multi-trait analysis follows the same general workflow as a single trait. In addition to the PVE, the <italic>summary</italic> command returns the additive correlation matrix for the traits. For the potato dataset, late maturity was correlated with higher yield (<italic>r</italic> = 0.57) and slightly with lighter fry color (<italic>r</italic> = 0.23). There was no genetic correlation (<italic>r</italic> = 0.00) between yield and fry color.</p>
      <p id="Par59">The “index.coeff” argument for <italic>blup</italic> is used to specify the selection index coefficients, which determine the relative weights of the traits (after standardization to unit variance) for genetic merit. (Because StageWise uses a multi-trait BLUP, the optimal index coefficients equal the coefficients of genetic merit.) For the potato chip market, it is reasonable to give equal weight to yield and fry color. However, naïve selection on these traits alone will generate offspring with later maturity, which is undesirable. One way to avoid this is by using vine maturity as a covariate in the analysis.</p>
      <p id="Par60">Alternatively, the <italic>gain</italic> command in StageWise can be used to compute the coefficients of a restricted selection index, in which the response for some traits is constrained to be zero (Kempthorne and Nordskog <xref ref-type="bibr" rid="CR31">1959</xref>). For a given selection intensity and <italic>t</italic> traits, the set of all possible responses is a <italic>t</italic>-dimensional ellipsoid, and <italic>gain</italic> shows 2D slices of it. Figure <xref rid="Fig5" ref-type="fig">5</xref> shows the breeding value response for yield and maturity, as well as two line segments. The dashed red line is the projection of the index vector, and the solid blue line is the projection of the optimal response. The restricted index requires negative weight for maturity to produce zero response, which reduces the yield response compared to the unrestricted index by <inline-formula id="IEq113"><alternatives><tex-math id="M285">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$0.23i\sigma$$\end{document}</tex-math><mml:math id="M286"><mml:mrow><mml:mn>0.23</mml:mn><mml:mi>i</mml:mi><mml:mi>σ</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq113.gif"/></alternatives></inline-formula> (<inline-formula id="IEq114"><alternatives><tex-math id="M287">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M288"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq114.gif"/></alternatives></inline-formula> is selection intensity and <inline-formula id="IEq115"><alternatives><tex-math id="M289">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><mml:math id="M290"><mml:mi>σ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq115.gif"/></alternatives></inline-formula> is the genetic standard deviation of the breeding values; Table <xref rid="Tab3" ref-type="table">3</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><p>Selection response tradeoffs in the potato dataset for three traits: yield, maturity, and fry color. The response surface is three-dimensional, but only the yield-maturity plane is shown to highlight the tradeoff between these two traits. The dashed red line segment is the projection of the index vector, and the solid blue line segment is the projection of the optimal response (color figure online)</p></caption><graphic xlink:href="122_2023_4298_Fig5_HTML" id="MO5"/></fig><table-wrap id="Tab3"><label>Table 3</label><caption><p>Multi-trait response for potato under truncation selection, assuming yield and fry color contribute equally to genetic merit</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2">Trait</th><th align="left" colspan="2">Unrestricted index</th><th align="left" colspan="2">Restricted index</th></tr><tr><th align="left">Coefficients</th><th align="left">Response</th><th align="left">Coefficients</th><th align="left">Response</th></tr></thead><tbody><tr><td align="left">Total yield</td><td char="." align="char">0.707</td><td char="." align="char">0.53</td><td char="." align="char">0.601</td><td char="." align="char">0.30</td></tr><tr><td align="left">Fry color</td><td char="." align="char">0.707</td><td char="." align="char">0.52</td><td char="." align="char">0.601</td><td char="." align="char">0.51</td></tr><tr><td align="left">Vine maturity</td><td char="." align="char">0.000</td><td char="." align="char">0.47</td><td char="." align="char">-0.527</td><td char="." align="char">0.00</td></tr></tbody></table><table-wrap-foot><p>Index coefficients are for standardized traits and scaled to have unit norm. Response is for intensity <italic>i</italic> = 1, in units of genetic standard deviation</p></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec14">
    <title>Discussion</title>
    <p id="Par61">StageWise was designed to enhance the use of genomic prediction in plant breeding, but there are some limitations. At present, each phenotype is associated with a single genotype identifier, which is inadequate for hybrid prediction. The options for modeling GxE are somewhat limited, particularly for multiple traits, which assume a uniform genetic correlation between environments. For single trait analysis, a more complex GxE model is possible to allow for heterogenous genetic correlation between locations. The genetic covariance between locations is based on a second- order factor-analytic (FA2) model (Smith et al. <xref ref-type="bibr" rid="CR54">2001</xref>), which offers enough statistical complexity for many applications. To assess model adequacy, the factor loadings returned by <italic>Stage2</italic> can visualized with the command <italic>uniplot</italic>, which generates a circular plot in which the squared radius for each location equals the proportion of genetic variance explained by the latent factors (Cullis et al. <xref ref-type="bibr" rid="CR12">2010</xref>). This functionality is illustrated in Vignette 2 using national trial data for potato (Schmitz Carley et al. <xref ref-type="bibr" rid="CR52">2019</xref>). At present, StageWise does not have functionality for genomic prediction with environmental covariates.</p>
    <p id="Par62">This is the first study to formulate and apply a model for directional dominance in polyploids. Although heterosis explained less than 5% of the variance (PVE) for yield, we should expect small PVE when there is limited variation for inbreeding. The standard deviation of <italic>F</italic><sub>D</sub> was only 0.03 for the population of 943 potato clones (Fig. <xref rid="Fig3" ref-type="fig">3</xref>).</p>
    <p id="Par63">From the theory of directional dominance, the average dominance coefficient is the covariate for estimating heterosis. Xiang et al. (<xref ref-type="bibr" rid="CR61">2016</xref>) used average heterozygosity for the covariate because under a genotypic parameterization of dominance in diploids, this is equivalent to the average dominance coefficient. However, studies employing orthogonal parameterizations of dominance have also used this covariate (Aliloo et al. <xref ref-type="bibr" rid="CR2">2017</xref>; Yadav et al. <xref ref-type="bibr" rid="CR62">2021</xref>), even though heterozygosity is no longer equivalent to the dominance coefficient because the relative contribution of the genotypes to inbreeding depends on allele frequency (see Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>). For example, the minor allele homozygote contributes more to inbreeding than the major allele homozygote, and the difference is <inline-formula id="IEq116"><alternatives><tex-math id="M291">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi \left(\phi -1\right)\left(q-p\right)$$\end{document}</tex-math><mml:math id="M292"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mfenced close=")" open="("><mml:mi>ϕ</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mfenced><mml:mfenced close=")" open="("><mml:mi>q</mml:mi><mml:mo>-</mml:mo><mml:mi>p</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq116.gif"/></alternatives></inline-formula> for ploidy <inline-formula id="IEq117"><alternatives><tex-math id="M293">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\phi$$\end{document}</tex-math><mml:math id="M294"><mml:mi>ϕ</mml:mi></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq117.gif"/></alternatives></inline-formula> and minor allele frequency <inline-formula id="IEq118"><alternatives><tex-math id="M295">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p=1-q$$\end{document}</tex-math><mml:math id="M296"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq118.gif"/></alternatives></inline-formula> at panmictic equilibrium. To give another example, simplex dosage of the minor allele in a tetraploid contributes more to inbreeding than duplex dosage only for <italic>p</italic> &gt; 1/3; for <italic>p</italic> &lt; 1/3, duplex dosage contributes more.</p>
    <p id="Par64">A more general approach to restricted selection indices was developed in StageWise by investigating the geometry of the problem (Eq. <xref rid="Equ26" ref-type="disp-formula">26</xref>). Until now, only equality constraints have been included (i.e., specifying a certain value for genetic gain), which are amenable to solution by the method of Lagrange multipliers. StageWise uses convex optimization software to allow for both equality and inequality constraints. In many situations, inequality constraints are more appropriate than equality constraints. For example, when selecting for yield, we might accept earlier but not later maturity, which is represented by response <inline-formula id="IEq119"><alternatives><tex-math id="M297">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\le 0$$\end{document}</tex-math><mml:math id="M298"><mml:mrow><mml:mo>≤</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq119.gif"/></alternatives></inline-formula>. With only one constrained trait, the optimal solution corresponds to zero response, so the inequality offers no advantage. But with two or more constraints, higher genetic gains are possible with inequalities (ESM2).</p>
    <p id="Par65">The “mask” argument for <italic>blup_prep</italic> makes it easy to investigate the potential benefit of using a correlated, secondary trait to improve genomic selection. Many plant breeding programs are exploring the use of spectral measurements from high-throughput phenotyping platforms to improve selection for yield. For example, Rutkoski et al. (<xref ref-type="bibr" rid="CR51">2016</xref>) demonstrated that aerial measurements of canopy temperature during grain fill could be used to predict wheat grain yield. Vignette 3 shows how to recreate this result with StageWise.</p>
    <p id="Par66">Typically, the number of traits a breeder must consider for selection is too large to analyze jointly in StageWise based on the current implementation with ASReml-R. New algorithms may alleviate this limitation in the future (Runcie et al. <xref ref-type="bibr" rid="CR50">2021</xref>), but in the meantime, a practical approach is to split the traits into groups for multivariate analysis based on phenotypic correlations. In the final step, multiple outputs from <italic>blup_prep</italic> can be combined in one call to <italic>blup</italic>, using an index that covers all traits (example in Vignette 3).</p>
    <p id="Par67">We should acknowledge that truncation selection on breeding value is not optimal for long-term genetic gain. The design of selection methods that conserve and exploit genetic diversity more efficiently is an exciting area of research (e.g., Toro and Varona <xref ref-type="bibr" rid="CR55">2010</xref>; Akdemir and Sánchez <xref ref-type="bibr" rid="CR1">2016</xref>; Goiffon et al. <xref ref-type="bibr" rid="CR25">2017</xref>). Although such methods are not currently available in StageWise, the additive and dominance marker effects returned by the software can be used to implement them.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec16">
      <title>Electronic supplementary material</title>
      <p>Below is the link to the electronic supplementary material.<supplementary-material content-type="local-data" id="MOESM1"><media xlink:href="122_2023_4298_MOESM1_ESM.pdf"><caption><p>Supplementary file1 (PDF 236 KB)</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="MOESM2"><media xlink:href="122_2023_4298_MOESM2_ESM.pdf"><caption><p>Supplementary file2 (PDF 157 KB)</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="MOESM3"><media xlink:href="122_2023_4298_MOESM3_ESM.zip"><caption><p>Supplementary file3 (ZIP 14439 KB)</p></caption></media></supplementary-material></p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec15">
        <title>Appendix</title>
        <p id="Par69">The objective is an expression for the expected covariance between two quantities of a population of size <italic>n</italic>, represented by multivariate normal vectors <inline-formula id="IEq120"><alternatives><tex-math id="M299">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}}_{1}\sim \mathrm{MVN}\left({{\varvec{\upmu}}}_{1},{\mathbf{K}}_{1}\right)$$\end{document}</tex-math><mml:math id="M300"><mml:mrow><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="normal">MVN</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq120.gif"/></alternatives></inline-formula> and <inline-formula id="IEq121"><alternatives><tex-math id="M301">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}}_{2}\sim \mathrm{MVN}\left({{\varvec{\upmu}}}_{2},{\mathbf{K}}_{2}\right)$$\end{document}</tex-math><mml:math id="M302"><mml:mrow><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="normal">MVN</mml:mi><mml:mfenced close=")" open="("><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq121.gif"/></alternatives></inline-formula>, with covariance <bold>L</bold>:<disp-formula id="Equ31"><label>31</label><alternatives><tex-math id="M303">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}}=\left[\begin{array}{c}{{\mathbf{x}}}_{1}\\ {{\mathbf{x}}}_{2}\end{array}\right]\sim MVN\left(\left[\begin{array}{c}{{\varvec{\upmu}}}_{1}\\ {{\varvec{\upmu}}}_{2}\end{array}\right],\left[\begin{array}{cc}{{\mathbf{K}}}_{1}&amp; {\mathbf{L}}\\ {\mathbf{L}}&amp; {{\mathbf{K}}}_{2}\end{array}\right]\right)$$\end{document}</tex-math><mml:math id="M304" display="block"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>∼</mml:mo><mml:mi>M</mml:mi><mml:mi>V</mml:mi><mml:mi>N</mml:mi><mml:mfenced close=")" open="("><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd><mml:mtd><mml:mi mathvariant="bold">L</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ31.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par70">Noting that <inline-formula id="IEq122"><alternatives><tex-math id="M305">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}}_{1}=\left[\begin{array}{cc}{\mathbf{I}}_{{n}}&amp; \mathbf{0}\end{array}\right]\mathbf{x}$$\end{document}</tex-math><mml:math id="M306"><mml:mrow><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq122.gif"/></alternatives></inline-formula> and <inline-formula id="IEq123"><alternatives><tex-math id="M307">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{x}}_{2}=\left[\begin{array}{cc}\mathbf{0}&amp; {\mathbf{I}}_{{n}}\end{array}\right]\mathbf{x}$$\end{document}</tex-math><mml:math id="M308"><mml:mrow><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq123.gif"/></alternatives></inline-formula>, the population covariance is (cf. Eq. (<xref rid="Equ12" ref-type="disp-formula">12</xref>))<disp-formula id="Equ32"><label>32</label><alternatives><tex-math id="M309">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{cov}}_{12}={n}^{-1}{{\mathbf{x}}}_{1}^{\mathrm{^{\prime}}}{{\mathbf{x}}}_{2}-{n}^{-2}\left(\mathbf{1}_{n}^{\mathrm{^{\prime}}}{{\mathbf{x}}}_{1}\right)\left(\mathbf{1}_{n}^{\mathrm{^{\prime}}}{{\mathbf{x}}}_{2}\right)=\frac{1}{2n}{\mathbf{x}}\boldsymbol{^{\prime}}\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{I}}}_{n}\\ {{\mathbf{I}}}_{n}&amp; \mathbf{0}\end{array}\right]{\mathbf{x}}+\frac{1}{2{n}^{2}}{\mathbf{x}}\boldsymbol{^{\prime}}\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{J}}}_{n}\\ {{\mathbf{J}}}_{n}&amp; \mathbf{0}\end{array}\right]{\mathbf{x}}$$\end{document}</tex-math><mml:math id="M310" display="block"><mml:mrow><mml:msub><mml:mi mathvariant="normal">cov</mml:mi><mml:mn>12</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msubsup><mml:mi mathvariant="bold">x</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mfenced><mml:mfenced close=")" open="("><mml:msubsup><mml:mn mathvariant="bold">1</mml:mn><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:msub><mml:mi mathvariant="bold">x</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="bold">x</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">x</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mi mathvariant="bold">x</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi mathvariant="bold">x</mml:mi></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ32.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par71">where <inline-formula id="IEq124"><alternatives><tex-math id="M311">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{J}}_{n}={\mathbf{1}_{n}\mathbf{1}}_{n}^{^{\prime}}$$\end{document}</tex-math><mml:math id="M312"><mml:mrow><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:msub><mml:mn mathvariant="bold">1</mml:mn><mml:mi>n</mml:mi></mml:msub><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq124.gif"/></alternatives></inline-formula> is a <italic>n</italic> x <italic>n</italic> matrix of ones. Using Eq. (<xref rid="Equ13" ref-type="disp-formula">13</xref>), the expectation of the first quadratic form in Eq. (<xref rid="Equ32" ref-type="disp-formula">32</xref>) is<disp-formula id="Equ33"><label>33</label><alternatives><tex-math id="M313">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{2n}\mathrm{tr}\left(\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{I}}}_{n}\\ {{\mathbf{I}}}_{n}&amp; \mathbf{0}\end{array}\right]\left[\begin{array}{cc}{{\mathbf{K}}}_{1}&amp; {\mathbf{L}}\\ {\mathbf{L}}&amp; {{\mathbf{K}}}_{2}\end{array}\right]\right)+\frac{1}{2n}\left({\left[\begin{array}{c}{{\varvec{\upmu}}}_{1}\\ {{\varvec{\upmu}}}_{2}\end{array}\right]}^{\mathrm{^{\prime}}}\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{I}}}_{n}\\ {{\mathbf{I}}}_{n}&amp; \mathbf{0}\end{array}\right]\left[\begin{array}{c}{{\varvec{\upmu}}}_{1}\\ {{\varvec{\upmu}}}_{2}\end{array}\right]\right)=\frac{1}{n}\sum_{i=1}^{n}\left({L}_{ii}+{\upmu }_{1i}{\upmu }_{2i}\right)$$\end{document}</tex-math><mml:math id="M314" display="block"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">tr</mml:mi><mml:mfenced close=")" open="("><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd><mml:mtd><mml:mi mathvariant="bold">L</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:msup><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">I</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mfenced close=")" open="("><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi mathvariant="italic">ii</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="normal">μ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi mathvariant="normal">μ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ33.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par72">The expectation of the second quadratic form in Eq. (<xref rid="Equ32" ref-type="disp-formula">32</xref>) is<disp-formula id="Equ34"><label>34</label><alternatives><tex-math id="M315">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{2{n}^{2}}\mathrm{tr}\left(\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{J}}}_{n}\\ {{\mathbf{J}}}_{n} &amp; \mathbf{0}\end{array}\right]\left[\begin{array}{cc}{{\mathbf{K}}}_{1}&amp; {\mathbf{L}}\\ {\mathbf{L}}&amp; {{\mathbf{K}}}_{2}\end{array}\right]\right)+\frac{1}{2{n}^{2}}\left({\left[\begin{array}{c}{{\varvec{\upmu}}}_{1}\\ {{\varvec{\upmu}}}_{2}\end{array}\right]}^{\mathrm{^{\prime}}}\left[\begin{array}{cc}\mathbf{0}&amp; {{\mathbf{J}}}_{n}\\ {{\mathbf{J}}}_{n}&amp; \mathbf{0}\end{array}\right]\left[\begin{array}{c}{{\varvec{\upmu}}}_{1}\\ {{\varvec{\upmu}}}_{2}\end{array}\right]\right)=\overline{{L}_{\bullet \bullet }}+\left(\overline{{\upmu }_{1\bullet }}\right)\left(\overline{{\upmu }_{2\bullet }}\right)$$\end{document}</tex-math><mml:math id="M316" display="block"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">tr</mml:mi><mml:mfenced close=")" open="("><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd><mml:mtd><mml:mi mathvariant="bold">L</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">K</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:msup><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">J</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mn mathvariant="bold">0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced><mml:mo>=</mml:mo><mml:mover><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mo>∙</mml:mo><mml:mo>∙</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi mathvariant="normal">μ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>∙</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi mathvariant="normal">μ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>∙</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ34.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par73">Putting Eq. (<xref rid="Equ33" ref-type="disp-formula">33</xref>and<xref rid="Equ34" ref-type="disp-formula">34</xref>) together, the expected covariance is<disp-formula id="Equ35"><label>35</label><alternatives><tex-math id="M317">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E\left[ {\text{cov} _{{12}} } \right] = \overline{{{\text{diag}}\left( {\mathbf{L}} \right)}} - \overline{{L_{{ \cdot \cdot }} }} + \overline{{\mu _{{1 \cdot }} \mu _{{2 \cdot }} }} - \left( {\overline{{\mu _{{1 \cdot }} }} } \right)\left( {\overline{{\mu _{{2 \cdot }} }} } \right)$$\end{document}</tex-math><mml:math id="M318" display="block"><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:msub><mml:mtext>cov</mml:mtext><mml:mn>12</mml:mn></mml:msub></mml:mfenced><mml:mo>=</mml:mo><mml:mover><mml:mrow><mml:mtext>diag</mml:mtext><mml:mfenced close=")" open="("><mml:mi mathvariant="bold">L</mml:mi></mml:mfenced></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mover><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mo>·</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>·</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced><mml:mfenced close=")" open="("><mml:mover><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo>¯</mml:mo></mml:mover></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ35.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par74">As in the Methods, for partitioning covariance on a <italic>gE</italic> basis, the unbalanced nature of the experiment is accounted for by computing the covariance between vectors <inline-formula id="IEq125"><alternatives><tex-math id="M319">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{y}}_{1} = {\mathbf{Zx}}_{1}$$\end{document}</tex-math><mml:math id="M320"><mml:mrow><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="bold">Zx</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq125.gif"/></alternatives></inline-formula> and <inline-formula id="IEq126"><alternatives><tex-math id="M321">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{y}}_{2} = {\mathbf{Zx}}_{2}$$\end{document}</tex-math><mml:math id="M322"><mml:mrow><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="bold">Zx</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq126.gif"/></alternatives></inline-formula><bold>,</bold> where incidence matrix <bold>Z</bold> maps <italic>n</italic> individuals to <italic>gE</italic> instances. If <bold>y</bold> denotes the stacked vector <inline-formula id="IEq127"><alternatives><tex-math id="M323">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left[ {\begin{array}{*{20}c} {{\mathbf{y}}_{1} } &amp; {{\mathbf{y}}_{2} } \\ \end{array} } \right]^{\prime}$$\end{document}</tex-math><mml:math id="M324"><mml:msup><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd><mml:mtd><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="122_2023_4298_Article_IEq127.gif"/></alternatives></inline-formula>, then<disp-formula id="Equ36"><label>36</label><alternatives><tex-math id="M325">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathbf{y}}=\left[\begin{array}{c}{{\mathbf{y}}}_{1}\\ {{\mathbf{y}}}_{2}\end{array}\right]\sim MVN\left(\left[\begin{array}{c}{{\mathbf{Z}}{\varvec{\upmu}}}_{1}\\ {\mathbf{Z}}{{\varvec{\upmu}}}_{2}\end{array}\right],\left[\begin{array}{cc}{{\mathbf{Z}}{\mathbf{K}}}_{1}{{\mathbf{Z}}}^{\mathrm{^{\prime}}}&amp; {\mathbf{Z}}{\mathbf{L}}{\mathbf{Z}}\boldsymbol{^{\prime}}\\ {\mathbf{Z}}{\mathbf{L}}{\mathbf{Z}}\boldsymbol{^{\prime}}&amp; {{\mathbf{Z}}{\mathbf{K}}}_{2}{{\mathbf{Z}}}^{\mathrm{^{\prime}}}\end{array}\right]\right)$$\end{document}</tex-math><mml:math id="M326" display="block"><mml:mrow><mml:mi mathvariant="bold">y</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:msub><mml:mi mathvariant="bold">y</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>∼</mml:mo><mml:mi>M</mml:mi><mml:mi>V</mml:mi><mml:mi>N</mml:mi><mml:mfenced close=")" open="("><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">Z</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">μ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi><mml:mi mathvariant="bold">K</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi><mml:mi mathvariant="bold">L</mml:mi><mml:mi mathvariant="bold">Z</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow/><mml:mi mathvariant="bold">Z</mml:mi><mml:mi mathvariant="bold">L</mml:mi><mml:mi mathvariant="bold">Z</mml:mi><mml:mrow><mml:msup><mml:mrow/><mml:mo mathvariant="bold">′</mml:mo></mml:msup></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi><mml:mi mathvariant="bold">K</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:msup><mml:mrow><mml:mi mathvariant="bold">Z</mml:mi></mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="122_2023_4298_Article_Equ36.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par75">Replacing <bold>x</bold> with <bold>y</bold> in Eq. (<xref rid="Equ32" ref-type="disp-formula">32</xref>), the result for expected covariance follows Eq. (<xref rid="Equ35" ref-type="disp-formula">35</xref>) but using averages weighted by the number of environments per genotype.</p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>I would like to thank potato breeding colleagues across the US for contributing germplasm used in this study, Grace Christensen for assistance with genotyping, and the UW-Madison Hancock and Rhinelander Agricultural Research Stations.</p>
  </ack>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Software development has been supported by USDA Hatch Project 1013047 and the USDA National Institute of Food and Agriculture (NIFA) Award 2020–51181-32156. The potato datasets were generated with support from NIFA Awards 2016–34141-25707 and 2019–34141-30284, Potatoes USA, the Wisconsin Potato and Vegetable Growers Association, and the University of Wisconsin-Madison.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data Availability</title>
    <p>The potato datasets and vignettes are distributed with the StageWise software, which is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/jendelman/StageWise">https://github.com/jendelman/StageWise</ext-link> under the GNU General Public License v3. The current versions of the software and vignettes at the time of publication have been archived as ESM3.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar1" notes-type="COI-statement">
      <title>Conflict of Interests</title>
      <p id="Par68">The author has no relevant financial or non-financial interests to disclose.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Akdemir</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Sánchez</surname>
            <given-names>JI</given-names>
          </name>
        </person-group>
        <article-title>Efficient breeding by genomic mating</article-title>
        <source>Front Genet</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>210</fpage>
        <pub-id pub-id-type="doi">10.3389/fgene.2016.00210</pub-id>
        <?supplied-pmid 27965707?>
        <pub-id pub-id-type="pmid">27965707</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aliloo</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Pryce</surname>
            <given-names>JE</given-names>
          </name>
          <name>
            <surname>González-Recio</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Cocks</surname>
            <given-names>BG</given-names>
          </name>
          <name>
            <surname>Goddard</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Hayes</surname>
            <given-names>BJ</given-names>
          </name>
        </person-group>
        <article-title>Including nonadditive genetic effects in mating programs to maximize dairy farm profitability</article-title>
        <source>J Dairy Sci</source>
        <year>2017</year>
        <volume>100</volume>
        <fpage>1203</fpage>
        <lpage>1222</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2016-11261</pub-id>
        <?supplied-pmid 27939540?>
        <pub-id pub-id-type="pmid">27939540</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amadeu</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Cellon</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Olmstead</surname>
            <given-names>JW</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Resende</surname>
            <given-names>MF</given-names>
          </name>
          <name>
            <surname>Muñoz</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <article-title>AGHmatrix: R package to construct relationship matrices for autotetraploid and diploid species: a blueberry example</article-title>
        <source>Plant Genome</source>
        <year>2016</year>
        <pub-id pub-id-type="doi">10.3835/plantgenome2016.01.0009</pub-id>
        <?supplied-pmid 27902800?>
        <pub-id pub-id-type="pmid">27902800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Batista</surname>
            <given-names>LG</given-names>
          </name>
          <name>
            <surname>Mello</surname>
            <given-names>VH</given-names>
          </name>
          <name>
            <surname>Souza</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Margarido</surname>
            <given-names>GRA</given-names>
          </name>
        </person-group>
        <article-title>Genomic prediction with allele dosage information in highly polyploid species</article-title>
        <source>Theor Appl Genet</source>
        <year>2022</year>
        <volume>135</volume>
        <fpage>723</fpage>
        <lpage>739</lpage>
        <pub-id pub-id-type="doi">10.1007/s00122-021-03994-w</pub-id>
        <?supplied-pmid 34800132?>
        <pub-id pub-id-type="pmid">34800132</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Bernardo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Breeding for quantitative traits in plants</source>
        <year>2010</year>
        <edition>2</edition>
        <publisher-loc>Woodbury, MN</publisher-loc>
        <publisher-name>Stemma Press</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bernardo</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Prospects for genomewide selection for quantitative traits in maize</article-title>
        <source>Crop Sci</source>
        <year>2007</year>
        <volume>47</volume>
        <fpage>1082</fpage>
        <lpage>1090</lpage>
        <pub-id pub-id-type="doi">10.2135/cropsci2006.11.0690</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Boyd</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Vandenberghe</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <source>Convex Optimization</source>
        <year>2004</year>
        <publisher-name>Cambridge University Press</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR8">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Cullis</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Gilmour</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gogel</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>ASReml-R Reference Manual Version 4</source>
        <year>2018</year>
        <publisher-loc>Hemel Hempstead, UK</publisher-loc>
        <publisher-name>VSN International Ltd</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Christensen</surname>
            <given-names>OF</given-names>
          </name>
          <name>
            <surname>Lund</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Genomic prediction when some animals are not genotyped</article-title>
        <source>Gen Sel Evol</source>
        <year>2010</year>
        <volume>42</volume>
        <fpage>2</fpage>
        <pub-id pub-id-type="doi">10.1186/1297-9686-42-2</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Covarrubias-Pazaran</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Genome-assisted prediction of quantitative traits using the R package sommer</article-title>
        <source>PloS ONE</source>
        <year>2016</year>
        <volume>11</volume>
        <issue>6</issue>
        <fpage>e0156744</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0156744</pub-id>
        <?supplied-pmid 27271781?>
        <pub-id pub-id-type="pmid">27271781</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cullis</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Beeck</surname>
            <given-names>CP</given-names>
          </name>
          <name>
            <surname>Cowling</surname>
            <given-names>WA</given-names>
          </name>
        </person-group>
        <article-title>Analysis of yield and oil from a series of canola breeding trials. Part II. Exploring variety by environment interaction using factor analysis</article-title>
        <source>Genome</source>
        <year>2010</year>
        <volume>53</volume>
        <fpage>1002</fpage>
        <lpage>1016</lpage>
        <pub-id pub-id-type="doi">10.1139/G10-080</pub-id>
        <?supplied-pmid 21076516?>
        <pub-id pub-id-type="pmid">21076516</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Daetwyler</surname>
            <given-names>HD</given-names>
          </name>
          <name>
            <surname>Villanueva</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Woolliams</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>Accuracy of predicting the genetic risk of disease using a genome-wide approach</article-title>
        <source>PLoS ONE</source>
        <year>2008</year>
        <volume>3</volume>
        <issue>10</issue>
        <fpage>e3395</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0003395</pub-id>
        <?supplied-pmid 18852893?>
        <pub-id pub-id-type="pmid">18852893</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Damesa</surname>
            <given-names>TM</given-names>
          </name>
          <name>
            <surname>Möhring</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Worku</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Piepho</surname>
            <given-names>HP</given-names>
          </name>
        </person-group>
        <article-title>One step at a time: Stage-wise analysis of a series of experiments</article-title>
        <source>Agron J</source>
        <year>2017</year>
        <volume>109</volume>
        <fpage>845</fpage>
        <lpage>857</lpage>
        <pub-id pub-id-type="doi">10.2134/agronj2016.07.0395</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>de los Campos</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sorensen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gianola</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Genomic heritability: what is it?</article-title>
        <source>PLoS Genet</source>
        <year>2015</year>
        <volume>11</volume>
        <issue>5</issue>
        <fpage>e1005048</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.1005048</pub-id>
        <?supplied-pmid 25942577?>
        <pub-id pub-id-type="pmid">25942577</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Endelman</surname>
            <given-names>JB</given-names>
          </name>
        </person-group>
        <article-title>Ridge regression and other kernels for genomic selection with R package rrBLUP</article-title>
        <source>Plant Genome</source>
        <year>2011</year>
        <volume>4</volume>
        <fpage>50</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="doi">10.3835/plantgenome2011.08.0024</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Endelman</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Jannink</surname>
            <given-names>JL</given-names>
          </name>
        </person-group>
        <article-title>Shrinkage estimation of the realized relationship matrix</article-title>
        <source>G3 Bethesda</source>
        <year>2012</year>
        <volume>2</volume>
        <fpage>1405</fpage>
        <lpage>1413</lpage>
        <pub-id pub-id-type="doi">10.1534/g3.112.004259</pub-id>
        <?supplied-pmid 23173092?>
        <pub-id pub-id-type="pmid">23173092</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Endelman</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Schmitz Carley</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Bethke</surname>
            <given-names>PC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genetic variance partitioning and genome-wide prediction with allele dosage information in autotetraploid potato</article-title>
        <source>Genetics</source>
        <year>2018</year>
        <volume>209</volume>
        <fpage>77</fpage>
        <lpage>87</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.118.300685</pub-id>
        <?supplied-pmid 29514860?>
        <pub-id pub-id-type="pmid">29514860</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Felcher</surname>
            <given-names>KJ</given-names>
          </name>
          <name>
            <surname>Coombs</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Massa</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Hansey</surname>
            <given-names>CN</given-names>
          </name>
          <name>
            <surname>Hamilton</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Veilleux</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Buell</surname>
            <given-names>CB</given-names>
          </name>
          <name>
            <surname>Douches</surname>
            <given-names>DS</given-names>
          </name>
        </person-group>
        <article-title>Integration of two diploid potato linkage maps with the potato genome sequence</article-title>
        <source>Plos ONE</source>
        <year>2012</year>
        <volume>7</volume>
        <issue>4</issue>
        <fpage>e36347</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.00363474</pub-id>
        <?supplied-pmid 22558443?>
        <pub-id pub-id-type="pmid">22558443</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fisher</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Average excess and average effect of a gene substitution</article-title>
        <source>Ann Eugen</source>
        <year>1941</year>
        <volume>11</volume>
        <fpage>53</fpage>
        <lpage>63</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1469-1809.1941.tb02272.x</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frensham</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Cullis</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Verbyla</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Genotype by environment variance heterogeneity in a two-stage analysis</article-title>
        <source>Biometrics</source>
        <year>1997</year>
        <volume>53</volume>
        <fpage>1373</fpage>
        <lpage>1383</lpage>
        <pub-id pub-id-type="doi">10.2307/2533504</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Narasimhan</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Boyd</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>CVXR: An R package for disciplined convex optimization</article-title>
        <source>J Stat Software.</source>
        <year>2020</year>
        <volume>94</volume>
        <fpage>1</fpage>
        <lpage>34</lpage>
        <pub-id pub-id-type="doi">10.18637/jss.v094.i14</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Gallais</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <source>Quantitative genetics and breeding methods in autopolyploid plants</source>
        <year>2003</year>
        <publisher-loc>Paris</publisher-loc>
        <publisher-name>INRA</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR24">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Gilmour</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Gogel</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Cullis</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Welham</surname>
            <given-names>SJ</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>ASReml User guide release 4.1 Structural specification</source>
        <year>2015</year>
        <publisher-loc>Hemel Hempstead, UK</publisher-loc>
        <publisher-name>VSN International Ltd</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR25">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goiffon</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kusmec</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Schnable</surname>
            <given-names>PS</given-names>
          </name>
        </person-group>
        <article-title>Improving response in genomic selection with a population-based selection strategy: Optimal population value selection</article-title>
        <source>Genetics</source>
        <year>2017</year>
        <volume>206</volume>
        <fpage>1675</fpage>
        <lpage>1682</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.116.197103</pub-id>
        <?supplied-pmid 28526698?>
        <pub-id pub-id-type="pmid">28526698</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gualdrón Duarte</surname>
            <given-names>JL</given-names>
          </name>
          <name>
            <surname>Cantet</surname>
            <given-names>RJC</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>RO</given-names>
          </name>
          <name>
            <surname>Ernst</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Raney</surname>
            <given-names>NE</given-names>
          </name>
          <name>
            <surname>Steibel</surname>
            <given-names>JP</given-names>
          </name>
        </person-group>
        <article-title>Rapid screening for phenotype-genotype associations by linear transformations of genomic evaluations</article-title>
        <source>BMC Bioinform</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>246</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-15-246</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Habier</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Fernando</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Dekkers</surname>
            <given-names>JCM</given-names>
          </name>
        </person-group>
        <article-title>The impact of genetic relationship information on genome-assisted breeding values</article-title>
        <source>Genetics</source>
        <year>2007</year>
        <volume>177</volume>
        <fpage>2389</fpage>
        <lpage>2397</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.107.081190</pub-id>
        <?supplied-pmid 18073436?>
        <pub-id pub-id-type="pmid">18073436</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Henderson</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>Best linear unbiased estimation and prediction under a selection model</article-title>
        <source>Biometrics</source>
        <year>1975</year>
        <volume>31</volume>
        <fpage>423</fpage>
        <lpage>447</lpage>
        <pub-id pub-id-type="doi">10.2307/2529430</pub-id>
        <?supplied-pmid 1174616?>
        <pub-id pub-id-type="pmid">1174616</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Henderson</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>A simple method for computing the inverse of a numerator relationship matrix used in prediction of breeding values</article-title>
        <source>Biometrics</source>
        <year>1976</year>
        <volume>32</volume>
        <fpage>69</fpage>
        <lpage>83</lpage>
        <pub-id pub-id-type="doi">10.2307/2529339</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Kempthorne</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <source>An introduction to genetic statistics</source>
        <year>1957</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>John Wiley &amp; Sons</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR31">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kempthorne</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Nordskog</surname>
            <given-names>AW</given-names>
          </name>
        </person-group>
        <article-title>Restricted selection indices</article-title>
        <source>Biometrics</source>
        <year>1959</year>
        <volume>15</volume>
        <fpage>10</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.2307/2527598</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <mixed-citation publication-type="other">Kinghorn B (2013) DESIRE: Target your genetic gains. <ext-link ext-link-type="uri" xlink:href="https://bkinghor.une.edu.au/desire.htm">https://bkinghor.une.edu.au/desire.htm</ext-link>. Accessed 4 Sep. 2022.</mixed-citation>
    </ref>
    <ref id="CR33">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kloosterman</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Abelenda</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Carretero Gomez</surname>
            <given-names>MM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Naturally occurring allele diversity allows potato cultivation in northern latitudes</article-title>
        <source>Nature</source>
        <year>2013</year>
        <volume>495</volume>
        <fpage>246</fpage>
        <lpage>250</lpage>
        <pub-id pub-id-type="doi">10.1038/nature11912</pub-id>
        <?supplied-pmid 23467094?>
        <pub-id pub-id-type="pmid">23467094</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lande</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Efficiency of marker-assisted selection in the improvement of quantitative traits</article-title>
        <source>Genetics</source>
        <year>1990</year>
        <volume>124</volume>
        <fpage>743</fpage>
        <lpage>756</lpage>
        <pub-id pub-id-type="doi">10.1093/genetics/124.3.743</pub-id>
        <?supplied-pmid 1968875?>
        <pub-id pub-id-type="pmid">1968875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Comparing estimates of genetic variance across different relationship models</article-title>
        <source>Theor Pop Biol</source>
        <year>2016</year>
        <volume>107</volume>
        <fpage>26</fpage>
        <lpage>30</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tpb.2015.08.005</pub-id>
        <pub-id pub-id-type="pmid">26341159</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Aguilar</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Misztal</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>A relationship matrix including full pedigree and genomic information</article-title>
        <source>J Dairy Sci</source>
        <year>2009</year>
        <volume>92</volume>
        <fpage>4656</fpage>
        <lpage>4663</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2009-2061</pub-id>
        <?supplied-pmid 19700729?>
        <pub-id pub-id-type="pmid">19700729</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lipka</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Tian</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Peiffer</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GAPIT: genome association and prediction integrated tool</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>2397</fpage>
        <lpage>2399</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts444</pub-id>
        <?supplied-pmid 22796960?>
        <pub-id pub-id-type="pmid">22796960</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meuwissen</surname>
            <given-names>THE</given-names>
          </name>
          <name>
            <surname>Hayes</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Goddard</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Prediction of total genetic value using genome-wide dense marker maps</article-title>
        <source>Genetics</source>
        <year>2001</year>
        <volume>157</volume>
        <fpage>1819</fpage>
        <lpage>1829</lpage>
        <pub-id pub-id-type="doi">10.1093/genetics/157.4.1819</pub-id>
        <?supplied-pmid 11290733?>
        <pub-id pub-id-type="pmid">11290733</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Möhring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Piepho</surname>
            <given-names>HP</given-names>
          </name>
        </person-group>
        <article-title>Comparison of weighting in two-stage analysis of plant breeding trials</article-title>
        <source>Crop Sci</source>
        <year>2009</year>
        <volume>49</volume>
        <fpage>1977</fpage>
        <lpage>1988</lpage>
        <pub-id pub-id-type="doi">10.2135/cropsci2009.02.0083</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Montesinos-López</surname>
            <given-names>OA</given-names>
          </name>
          <name>
            <surname>Montesinos-López</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Luna-Vázquez</surname>
            <given-names>FJ</given-names>
          </name>
          <name>
            <surname>Toledo</surname>
            <given-names>FH</given-names>
          </name>
          <name>
            <surname>Pérez-Rodríguez</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Lillemo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Crossa</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>A R package for Bayesian analysis of multi-environment and multi-trait multi-environment data for genome-based prediction</article-title>
        <source>G3 Bethesda</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>1355</fpage>
        <lpage>1367</lpage>
        <pub-id pub-id-type="doi">10.1534/g3.119.400126</pub-id>
        <?supplied-pmid 30819822?>
        <pub-id pub-id-type="pmid">30819822</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moskvina</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Schmidt</surname>
            <given-names>KM</given-names>
          </name>
        </person-group>
        <article-title>On multiple-testing correction in genome-wide association studies</article-title>
        <source>Genet Epidemiol</source>
        <year>2008</year>
        <volume>32</volume>
        <fpage>567</fpage>
        <lpage>573</lpage>
        <pub-id pub-id-type="doi">10.1002/gepi.20331</pub-id>
        <?supplied-pmid 18425821?>
        <pub-id pub-id-type="pmid">18425821</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pérez</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>de los Campos</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Genome-wide regression and prediction with the BGLR statistical package</article-title>
        <source>Genetics</source>
        <year>2014</year>
        <volume>198</volume>
        <fpage>483</fpage>
        <lpage>495</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.114.164442</pub-id>
        <?supplied-pmid 25009151?>
        <pub-id pub-id-type="pmid">25009151</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pérez-Rodríguez</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>de los Campos</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Multitrait Bayesian shrinkage and variable selection models with the BGLR-R package</article-title>
        <source>Genetics</source>
        <year>2022</year>
        <volume>222</volume>
        <issue>1</issue>
        <fpage>12</fpage>
        <pub-id pub-id-type="doi">10.1093/genetics/iyac112</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Piepho</surname>
            <given-names>HP</given-names>
          </name>
          <name>
            <surname>Möhring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Schulz-Streeck</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ogutu</surname>
            <given-names>JO</given-names>
          </name>
        </person-group>
        <article-title>A stage-wise approach for analysis of multi-environment trials</article-title>
        <source>Biometrics</source>
        <year>2012</year>
        <volume>54</volume>
        <fpage>844</fpage>
        <lpage>860</lpage>
        <pub-id pub-id-type="doi">10.1002/bimj.201100219</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Poland</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Endelman</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Dawson</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genomic selection in wheat breeding using genotyping-by-sequencing</article-title>
        <source>Plant Genome</source>
        <year>2012</year>
        <volume>5</volume>
        <fpage>103</fpage>
        <lpage>113</lpage>
        <pub-id pub-id-type="doi">10.3835/plantgenome2012.06.0006</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <collab>R Core Team</collab>
        </person-group>
        <source>R: A language and environment for statistical computing</source>
        <year>2022</year>
        <publisher-loc>Austria</publisher-loc>
        <publisher-name>R Foundation for Statistical Computing</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR47">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Riedelsheimer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Melchinger</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <article-title>Optimizing the allocation of resources for genomic selection in one breeding cycle</article-title>
        <source>Theor Appl Genet</source>
        <year>2013</year>
        <volume>126</volume>
        <fpage>2835</fpage>
        <lpage>2848</lpage>
        <pub-id pub-id-type="doi">10.1007/s00122-013-2175-9</pub-id>
        <?supplied-pmid 23982591?>
        <pub-id pub-id-type="pmid">23982591</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodríguez-Álvarez</surname>
            <given-names>MX</given-names>
          </name>
          <name>
            <surname>Boer</surname>
            <given-names>MP</given-names>
          </name>
          <name>
            <surname>Eeuwijk</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Eilers</surname>
            <given-names>PHC</given-names>
          </name>
        </person-group>
        <article-title>Correcting for spatial heterogeneity in plant breeding experiments with P-splines</article-title>
        <source>Spatial Statistics</source>
        <year>2018</year>
        <volume>23</volume>
        <fpage>52</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="doi">10.1016/j.spasta.2017.10.003</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rogers</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Dunne</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Romay</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The importance of dominance and genotype-by-environment interactions on grain yield variation in a large-scale public cooperative maize experiment</article-title>
        <source>G3 Bethesda</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>jkaa050</fpage>
        <pub-id pub-id-type="doi">10.1093/g3journal/jkaa050</pub-id>
        <?supplied-pmid 33585867?>
        <pub-id pub-id-type="pmid">33585867</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Runcie</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Qu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Crawford</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>MegaLMM: Mega-scale linear mixed models for genomic predictions with thousands of traits</article-title>
        <source>Genome Biol</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>213</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02416-w</pub-id>
        <?supplied-pmid 34301310?>
        <pub-id pub-id-type="pmid">34301310</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rutkoski</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Poland</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Mondal</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Autrique</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>González Pérez</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Crossa</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Reynolds</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Canopy temperature and vegetation indices from high-throughput phenotyping improve accuracy of pedigree and genomic selection for grain yield in wheat</article-title>
        <source>G3 Bethesa</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>2799</fpage>
        <lpage>2808</lpage>
        <pub-id pub-id-type="doi">10.1534/g3.116.032888</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmitz Carley</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Coombs</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Clough</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>De Jong</surname>
            <given-names>WS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genetic covariance of environments in the potato National Chip Processing Trial</article-title>
        <source>Crop Sci</source>
        <year>2019</year>
        <volume>58</volume>
        <fpage>107</fpage>
        <lpage>114</lpage>
        <pub-id pub-id-type="doi">10.2135/cropsci2018.05.0314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Searle</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Casella</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>McCulloch</surname>
            <given-names>CE</given-names>
          </name>
        </person-group>
        <source>Variance components</source>
        <year>1992</year>
        <publisher-loc>Hoboken, NJ</publisher-loc>
        <publisher-name>John Wiley &amp; Sons</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR54">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smith</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Cullis</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Analyzing variety by environment data using multiplicative mixed models and adjustments for spatial field trend</article-title>
        <source>Biometrics</source>
        <year>2001</year>
        <volume>57</volume>
        <fpage>1138</fpage>
        <lpage>1147</lpage>
        <pub-id pub-id-type="doi">10.1111/j.0006-341X.2001.01138.x</pub-id>
        <?supplied-pmid 11764254?>
        <pub-id pub-id-type="pmid">11764254</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Toro</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Varona</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>A note on mate allocation for dominance handling in genomic selection</article-title>
        <source>Gen Sel Evol</source>
        <year>2010</year>
        <volume>42</volume>
        <fpage>33</fpage>
        <pub-id pub-id-type="doi">10.1186/1297-9686-42-33</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>VanRaden</surname>
            <given-names>PM</given-names>
          </name>
        </person-group>
        <article-title>Efficient methods to compute genomic predictions</article-title>
        <source>J Dairy Sci</source>
        <year>2008</year>
        <volume>91</volume>
        <fpage>4414</fpage>
        <lpage>4423</lpage>
        <pub-id pub-id-type="doi">10.3168/jds.2007-0980</pub-id>
        <?supplied-pmid 18946147?>
        <pub-id pub-id-type="pmid">18946147</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Varona</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Toro</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Vitezica</surname>
            <given-names>ZG</given-names>
          </name>
        </person-group>
        <article-title>Non-additive effects in genomic selection</article-title>
        <source>Front Genet</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>78</fpage>
        <pub-id pub-id-type="doi">10.3389/fgene.2018.00078</pub-id>
        <?supplied-pmid 29559995?>
        <pub-id pub-id-type="pmid">29559995</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vitezica</surname>
            <given-names>ZG</given-names>
          </name>
          <name>
            <surname>Varona</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>On the additive and dominance variance and covariance of individuals within the genomic selection scope</article-title>
        <source>Genetics</source>
        <year>2013</year>
        <volume>195</volume>
        <fpage>1223</fpage>
        <lpage>1230</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.113.155176</pub-id>
        <?supplied-pmid 24121775?>
        <pub-id pub-id-type="pmid">24121775</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vos</surname>
            <given-names>PG</given-names>
          </name>
          <name>
            <surname>Uitdewilligen</surname>
            <given-names>JGAML</given-names>
          </name>
          <name>
            <surname>Voorrips</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Visser</surname>
            <given-names>RGF</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>HJ</given-names>
          </name>
        </person-group>
        <article-title>Development and analysis of a 20K SNP array for potato (Solanum tuberosum): an insight into the breeding history</article-title>
        <source>Theor Appl Genet</source>
        <year>2015</year>
        <volume>128</volume>
        <fpage>2387</fpage>
        <lpage>2401</lpage>
        <pub-id pub-id-type="doi">10.1007/s00122-015-2593-y</pub-id>
        <?supplied-pmid 26263902?>
        <pub-id pub-id-type="pmid">26263902</pub-id>
      </element-citation>
    </ref>
    <ref id="CR60">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wimmer</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Albrecht</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Auinger</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Schön</surname>
            <given-names>CC</given-names>
          </name>
        </person-group>
        <article-title>synbreed: a framework for the analysis of genomic prediction data using R</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>2086</fpage>
        <lpage>2087</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts335</pub-id>
        <?supplied-pmid 22689388?>
        <pub-id pub-id-type="pmid">22689388</pub-id>
      </element-citation>
    </ref>
    <ref id="CR61">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xiang</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Christensen</surname>
            <given-names>OF</given-names>
          </name>
          <name>
            <surname>Vitezica</surname>
            <given-names>ZG</given-names>
          </name>
          <name>
            <surname>Legarra</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Genomic evaluation by including dominance effects and inbreeding depression for purebred and crossbred performance with an application in pigs</article-title>
        <source>Gen Sel Evol</source>
        <year>2016</year>
        <volume>48</volume>
        <fpage>92</fpage>
        <pub-id pub-id-type="doi">10.1186/s12711-016-0271-4</pub-id>
      </element-citation>
    </ref>
    <ref id="CR62">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yadav</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Joyce</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved genomic prediction of clonal performance in sugarcane by exploiting non-additive genetic effects</article-title>
        <source>Theor Appl Genet</source>
        <year>2021</year>
        <volume>134</volume>
        <fpage>2235</fpage>
        <lpage>2252</lpage>
        <pub-id pub-id-type="doi">10.1007/s00122-021-03822-1</pub-id>
        <?supplied-pmid 33903985?>
        <pub-id pub-id-type="pmid">33903985</pub-id>
      </element-citation>
    </ref>
    <ref id="CR63">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zych</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Gort</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Maliepaard</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Jansen</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Voorrips</surname>
            <given-names>RE</given-names>
          </name>
        </person-group>
        <article-title>FitTetra 2.0: improved genotype calling for tetraploids with multiple population and parental data support</article-title>
        <source>BMC Bioinformatics</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>148</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-019-2703-y</pub-id>
        <?supplied-pmid 30894135?>
        <pub-id pub-id-type="pmid">30894135</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
