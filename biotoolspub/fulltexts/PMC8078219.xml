<?properties open_access?>
<?subarticle report82892?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">F1000Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">F1000Res</journal-id>
    <journal-id journal-id-type="pmc">F1000Research</journal-id>
    <journal-title-group>
      <journal-title>F1000Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2046-1402</issn>
    <publisher>
      <publisher-name>F1000 Research Limited</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8078219</article-id>
    <article-id pub-id-type="doi">10.12688/f1000research.27062.2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software Tool Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SAPHIR: a Shiny application to analyze tissue section images</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>[version 2; peer review: 2 approved]</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Germani</surname>
          <given-names>Elodie</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-5786-9538</contrib-id>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lelouard</surname>
          <given-names>Hugues</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Project Administration</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fallet</surname>
          <given-names>Mathieu</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Project Administration</role>
        <role content-type="http://credit.casrai.org/">Resources</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – Original Draft Preparation</role>
        <role content-type="http://credit.casrai.org/">Writing – Review &amp; Editing</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-8144-6159</contrib-id>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <aff id="a1"><label>1</label>Université de Rennes 1, Rennes, 35000, France</aff>
      <aff id="a2"><label>2</label>Aix Marseille Univ, CNRS, INSERM, CIML, Marseille, France</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xlink:href="mailto:elodie.germani@hotmail.fr">elodie.germani@hotmail.fr</email>
      </corresp>
      <fn fn-type="COI-statement">
        <p>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>8</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>9</volume>
    <elocation-id>1276</elocation-id>
    <history>
      <date date-type="accepted">
        <day>24</day>
        <month>3</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2021 Germani E et al.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="f1000research-9-55654.pdf"/>
    <abstract>
      <p>Study of cell populations in tissues using immunofluorescence is a powerful method for both basic and medical research. Image acquisitions performed by confocal microscopy notably allow excellent lateral resolution and more than 10 parameter measurements when using spectral or multiplex imaging. Analysis of such complex images can be very challenging and easily lead to bias and misinterpretation. Here, we have developed the Shiny Analytical Plot of Histological Image Results (SAPHIR), an R shiny application for histo-cytometry using scatterplot representation of data extracted by segmentation. It offers many features, such as filtering of spurious data points, selection of cell subsets on scatterplot, visualization of scatterplot selections back into the image, statistics of selected data and data annotation. Our application allows to characterize labeled cells, from their phenotype to their number and location in the tissue, as well as their interaction with other cells. SAPHIR is available from:
<ext-link ext-link-type="uri" xlink:href="https://github.com/elodiegermani/SAPHIR">https://github.com/elodiegermani/SAPHIR</ext-link>
</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Tissue cellular quantification</kwd>
      <kwd>spatial cellular profiling</kwd>
      <kwd>cell-cell interactions</kwd>
      <kwd>scatterplot</kwd>
      <kwd>histo-cytometry</kwd>
      <kwd>image cytometry</kwd>
    </kwd-group>
    <funding-group>
      <award-group id="fund-1">
        <funding-source>Aix-Marseille University</funding-source>
      </award-group>
      <award-group id="fund-2">
        <funding-source>Fondation pour la Recherche Médicale</funding-source>
        <award-id>DEQ20170336745</award-id>
      </award-group>
      <award-group id="fund-3">
        <funding-source>Centre National de la Recherche Scientifique and Institut National de la Santé et de la Recherche Médicale</funding-source>
      </award-group>
      <award-group id="fund-4">
        <funding-source>Agence Nationale de la Recherche</funding-source>
        <award-id>ANR-10-INBS-04-01;ANR-16-CONV-0001</award-id>
      </award-group>
      <funding-statement>This work was supported by institutional funding from Centre National de la Recherche Scientifique and Institut National de la Santé et de la Recherche Médicale, by the Agence Nationale de la Recherche grant ANR-10-INBS-04-01 France Bio Imaging, by « Investissements d'Avenir » French Government program managed by the French National Research Agency (ANR-16-CONV-0001), by Excellence Initiative of Aix-Marseille University - A*MIDEX and by the Fondation pour la Recherche Médicale (FRM) grant DEQ20170336745. </funding-statement>
    </funding-group>
  </article-meta>
  <notes notes-type="version-changes">
    <sec sec-type="version-changes">
      <label>Revised</label>
      <title>Amendments from Version 1</title>
      <p>According to reviewers' comments, we updated our paper with details added on the Data requirement section, on the development of the application and on the Use case section. We also provided new Figures with a better resolution and new options implemented in SAPHIR to increase the visualization properties of the app.</p>
    </sec>
  </notes>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The identification, localization and quantification of cell subsets in tissues is a difficult but essential task for biologists to understand spatial cellular organization in different settings (e.g. homeostasis vs inflammatory diseases or cancer). Advances in optical microscopy allow image acquisitions with more than 10 channel measurements using spectral fluorescence imaging or multiplex imaging combined with z-axis optical slices of tissue sections ranging from 10 µm to more than 200 µm when clearing methods are used
<sup><xref rid="ref-1" ref-type="bibr">1</xref>–
<xref rid="ref-4" ref-type="bibr">4</xref></sup>. Analysis of such complex images is very challenging due to the size and complexity of data. It requires image segmentation in 3D that can be further improved using deep learning-based segmentation
<sup><xref rid="ref-5" ref-type="bibr">5</xref>–
<xref rid="ref-7" ref-type="bibr">7</xref></sup>. Then, like flow cytometry, complex image analysis can benefit from scatterplot representations that allow to gate cells of interest
<sup><xref rid="ref-2" ref-type="bibr">2</xref>,
<xref rid="ref-8" ref-type="bibr">8</xref></sup>. Surprisingly, in existing software, this scatterplot representation is rarely interactive with the image itself, although this would allow to locate selection results back into the image but also to filter or correct results and fine-tune the gates defining cell populations to obtain in return a better visualization of them into the image.</p>
    <p>To this end, we developed the Shiny Analytical Plot of Histological Image Results (SAPHIR), an R/Shiny application for the quantitative analysis of tissue section images. Since image segmentation is a complex task in continuous development and highly dependent on image quality and information, the integration of a single type of segmentation method in an image analysis application is not necessarily recommended. Therefore, we decided to separate segmentation from SAPHIR, but we provided in a segmentation menu the link to Fiji and the possibility to run Fiji segmentation macros on user image. Two Fiji macro examples with associated images, which can be used to perform this task before running SAPHIR, are also provided with the application. SAPHIR offers many features such as interactive scatterplots with the image and data filtering and correction as described below.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Data requirement</title>
      <p>The segmentation process that is required to use the application SAPHIR was carried out under Fiji
<sup><xref rid="ref-9" ref-type="bibr">9</xref></sup>, with homemade macros. These are available on GitHub in the
<ext-link ext-link-type="uri" xlink:href="https://github.com/elodiegermani/SAPHIR/tree/master/Demonstrationfiles">Demonstration Files</ext-link> and can be loaded from the segmentation menu of the application, too. Cell nucleus detection was used for 3D segmentation and the optical section containing the central region of each cell (largest nucleus area) was used to evaluate the fluorescent intensity signal of each channel within a circular ring containing the cell membrane. Finally, the external ring was converted to simple ROI (polygon) and save in .roi for each Cell Of Interest (COI) to be easily readable in R. Each COI was associated with its main optical section (slice). In addition, regions of interest were defined using DBSCAN (optional)
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup>. The segmentation process of the image to be analyzed should create a csv result file containing the intensity values of each channel (ranging from 0 to 255) and, if required, the positioning (x, y, z) linked to each COI. Importantly, many other morphological measurements like area, roundness, or solidity as well as other information (COI belonging to a region of interest, COI interaction with other cells) can be added to the segmentation result file. The result file should contain at least two columns that provide intensities or other parameters necessary to create a scatterplot.</p>
      <p>Finally, the minimal requirements to run the application are the image in TIFF with multiple channels and optionally slices, a legend file with all channel information written in column with name headers (Ch1, Ch2,..) and the corresponding labelling (e.g., LT or LB,..), a segmentation result file with intensity values of each COI in csv and the roi.zip file containing contours of each COI. For the TIFF image, since large images may alter the fluidity of the application, we decided that images with a X or Y dimension higher than 1024 would be resized proportionaly so the highest dimension is 1024 (e.g. a 2048 * 1536 image will become a 1024 * 768 image). SAPHIR is able to load standard 2D ROI from Fiji. The segmentation process can be done in either 2D or 3D, but in the latter case only the largest ROI associated with the central slice of each cell is kept. It is possible to convert labelled images (or mask image) in .roi by applying the "analyze particles" function of Fiji or by loading polygon ROI in Fiji and saving them in .roi.</p>
    </sec>
    <sec>
      <title>Operation</title>
      <p>SAPHIR was built in the R programming language (version 4.0.2), which has very powerful stastistical packages and excellent interactive dashboard programing package, Shiny and its derivatives like ShinyDashboard or Shinyfiles. Several packages available on CRAN (e.g. ijtiff, magick, ggplot2, plotly) and one package (EBImage) available on Bioconductor were used.</p>
      <p>The development of the app was made as follows. First, an interactive Shiny app was created, using the “shiny” library in R, to link a tissue section image and a scatterplot representing for each cell its fluorescence intensity on different channels. To do so, the libraries “ijtiff”, “RImageROI” and “ggplot2” were used. In addition, the statistical part of the app and the “Image to Plot” section were added. Second, the interface of the app was improved with “shinydashboard”, “shinyWidgets” and “shinycssloaders”. Third, a menu “Select your result” was created to load needed files (see Data requirement section). Fourth, the interactivity between the scatter plot and the image was improved using “plotly. A “filtering” option was also added to the scatterplot. Fifth, the visualization options of the scatterplot selections in the image, such as cell ID display, channel overlays and thickness of cells contours were added to the app. This was done using “EBImage” and “magick” packages. Finally, the “Annotation” menu was added to allow result corrections based on scatterplot to image analysis and “Download” buttons were created to allow the download of SAPHIR results.</p>
      <p>SAPHIR has been tested on macOS and Windows 10. A user flowchart from image acquisition to obtention of quantitative data of COI with SAPHIR is shown in
<xref ref-type="fig" rid="f1">Figure 1</xref>.</p>
      <fig fig-type="figure" id="f1" orientation="portrait" position="float">
        <label>Figure 1. </label>
        <caption>
          <title>Flow chart of tissue image analysis from image acquisition and segmentation (left side) to extracted data analysis with SAPHIR (right side).</title>
        </caption>
        <graphic xlink:href="f1000research-9-55654-g0000"/>
      </fig>
    </sec>
    <sec>
      <title>Implementation</title>
      <p>The first step of SAPHIR is either to run a segmentation program to obtain appropriate files or to load the four required files (image.tif, roi.zip, results.csv, legend.csv) in the “select your results” menu of the application. Here, result, region of interest (ROI) and legend files were obtained with a homemade segmentation macro developed under Fiji as described in the Data requirement section. Fiji and the macro can be launched from the segmentation menu of the application.</p>
      <p>The first tab of the “Plot to Image” menu is shown in
<xref ref-type="fig" rid="f2">Figure 2</xref> and allows the users to filter their data depending on one or two parameters displayed on histogram or scatterplot, respectively. This can be used to remove cells that have been badly segmented. Indeed, such cells display an aberrant area or volume (doublets or aggregates in red in
<xref ref-type="fig" rid="f2">Figure 2</xref>). Here, only cells within the Gaussian curve were retained (in blue in
<xref ref-type="fig" rid="f2">Figure 2</xref>). This can also be used to work only on given subpopulations filtered based on their location, interaction with other cells or other criteria (see Use case section below). Then, filtered cells can be separated into subsets thanks to a two-parameter (most often channel intensities) scatterplot (
<xref ref-type="fig" rid="f3">Figure 3A</xref>). In addition, users can add a third parameter that is displayed on the scatterplot through a change of symbol shape for each COI beyond a threshold defined by the users for a given parameter value (
<xref ref-type="fig" rid="f3">Figure 3A</xref>).</p>
      <fig fig-type="figure" id="f2" orientation="portrait" position="float">
        <label>Figure 2. </label>
        <caption>
          <title>Menu “Plot to Image” of SAPHIR application.</title>
          <p>The data-filtering tab allows the selection of cells to be analyzed based on one or two parameters. Based on the cell area parameter, only cells that displayed a conventional cell area (in blue) were selected. Badly segmented cells (large area in red) were discarded.</p>
        </caption>
        <graphic xlink:href="f1000research-9-55654-g0001"/>
      </fig>
      <fig fig-type="figure" id="f3" orientation="portrait" position="float">
        <label>Figure 3. </label>
        <caption>
          <title>Menu “Plot to Image” of SAPHIR application.</title>
          <p>(
<bold>A</bold>) Scatterplot of two channel intensity parameters used to gate COI. User can add a third parameter that is displayed on the scatterplot through a change of symbol shape for COI beyond a threshold defined by the user. (
<bold>B</bold>) Visualization of selected cells in the image. Some of the available options are shown (displayed channel(s), channel overlay, cell identity number, brightness).</p>
        </caption>
        <graphic xlink:href="f1000research-9-55654-g0002"/>
      </fig>
      <p>Gating can be made easily with quadrants, rectangles and lassos in single or multiple selection mode. Interactivity between scatterplot and image is optional to avoid slow interaction when the size of images exceeds 300 MB, especially using Docker. In the latter case, we recommend users to perform their gating before allowing their selection to be shown in the image by ticking the appropriate box. Users can easily change the slice and the displayed channels with buttons to monitor selected COI spatial distribution and fluorescence intensity in the image (
<xref ref-type="fig" rid="f3">Figure 3B</xref>). Moreover, several options are available such as cell identity display or channel overlay (
<xref ref-type="fig" rid="f3">Figure 3B</xref>). Finally, statistics of the gated COI are downloadable, and gates are saveable for further analyses.</p>
      <p>The SAPHIR menu “Image to Plot” allows to select a region in the image and to display cells of this region on a two-parameter scatterplot (
<xref ref-type="fig" rid="f4">Figure 4</xref>).</p>
      <fig fig-type="figure" id="f4" orientation="portrait" position="float">
        <label>Figure 4. </label>
        <caption>
          <title>Menu “Image to Plot” of SAPHIR application.</title>
          <p>Selection of one region in the image (left) and visualization of COI of this region in a corresponding scatterplot where two parameters are displayed (right).</p>
        </caption>
        <graphic xlink:href="f1000research-9-55654-g0003"/>
      </fig>
      <p>Finally, the menu “Annotation” allows correction of the data from the result csv file but also from the scatterplot-gated cells when saved in the “Plot to Image” menu. For each selected cell, a cropped image of this cell is displayed, and based on the previous analyses users can change its parameters (e.g., cell identity) if necessary (
<xref ref-type="fig" rid="f5">Figure 5</xref>).</p>
      <fig fig-type="figure" id="f5" orientation="portrait" position="float">
        <label>Figure 5. </label>
        <caption>
          <title>Menu “Annotate your data” of SAPHIR application.</title>
          <p>The results to annotate can be selected based on the Plot to Image scatterplot gated cells that have been previously saved (left panel). Each cell of the selection can be visualized in the image (right panel) with the possibility to change image size (magnification), the displayed channel(s), the slice (z optical section) and the brightness. Based on the different analysis, results for the selected COI can be modified and final results saved and exported.</p>
        </caption>
        <graphic xlink:href="f1000research-9-55654-g0004"/>
      </fig>
    </sec>
  </sec>
  <sec sec-type="cases">
    <title>Use case</title>
    <p>To show the usefulness of our application, we used it on a project that aims to characterize in murine Peyer’s patches (PP) the interaction between phagocytes and proliferative immune effector cells, i.e. B and T cells. PP are immune inductive sites distributed along the small intestine in charge of sampling noxious antigens and mounting an immune response against them. In PP, antigens are taken up by phagocytes, which, upon stimulation, migrate in the T cell zone and its periphery to interact with prime naïve T cells. The periphery of the PP T cell zone is indeed an area of intense proliferation of immune effector cells after stimulation, suggesting that this region is a privileged site for their activation
<sup><xref rid="ref-11" ref-type="bibr">11</xref></sup>. We therefore decided to use SAPHIR to examine the evolution of proliferative cell number, to determine their identity (B or T cells) and to analyze their interaction with migratory phagocytes in this region during the course of a stimulation.</p>
    <p>We selected a spectral confocal image of a stained stimulated PP. It consisted of 12 optical slices with 6 channels distinguishing proliferative nuclei, B cells, T cells, monocyte-derived phagocytes, early-activated T cells and total nuclei. All optical slices but only the first four channels were necessary for the purpose of this study. First, we used two homemade Fiji macros as described in Data requirement. These macros are available on GitHub in the Demonstration Files and can be launched from the Segmentation menu of the application. The first macro allows the counting of proliferative cells through segmentation of Ki-67
<sup>+</sup> nuclei, provides their identity through analysis of T and B cell staining intensity of Ki-67
<sup>+</sup> cells, and determines their interaction with phagocytes. The second macro identifies the area of high density in proliferative cells as ROI, thanks to the DBSCAN algorithm
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup> and determines whether previously analysed cells belong to this ROI. Finally, we obtained a result file that includes 176 COI (proliferative cells of the ROI) analyzed on 10 parameters (the intensity of LT and LB channels; the coordinates x, y, z; 3 physical parameters: area, circularity and solidity; interaction = 1 or not = 0 with a phagocyte; and the belonging = 1 or not = 0 to the region of strong proliferation).</p>
    <p>Then, we integrated these data into the SAPHIR application and generated scatterplots and statistical analyses. Thus, with the “Filtering” tab we selected only proliferative cells belonging to the area of intense proliferation at the periphery of the T cell zone from which we wanted to obtain statistical data (green rectangle in the upper left histogram of
<xref ref-type="fig" rid="f6">Figure 6</xref>). Then, these ROI-proliferative cells were split into B and T cells using the scatter plot (
<xref ref-type="fig" rid="f6">Figure 6</xref>, left mid-panel). We were thus able to identify proliferative T cells (lower right quadrant, red contour), proliferative B cells (upper left quadrant) and uncharacterized proliferative cells (lower left quadrant). Finally, we used the “symbol shape change parameter” option to highlight ROI-proliferative cells that interacted with phagocytes (circles vs triangles). Selecting T cells, we could localize each of them on the optical slices and check their interaction or not with phagocytes directly into the image (
<xref ref-type="fig" rid="f6">Figure 6</xref>, right panel and higher magnification inserts).</p>
    <fig fig-type="figure" id="f6" orientation="portrait" position="float">
      <label>Figure 6. </label>
      <caption>
        <title>Use case: analysis of proliferative immune effector cells interacting with phagocytes in the T cell zone of murine Peyer’s patches.</title>
        <p>Upper left: Proliferative cells belonging to the proliferative area of the T cell zone periphery (ROI_DBSCAN) were selected using the Filtering tab (green rectangle). Mid-left: ROI proliferative cells were split into T (orange symbols) and B cells (green symbols) on the scatterplot and phagocyte-interacting cells highlighted (circles) thanks to the symbol shape change parameter. Right: Proliferative T cells selected in the lower left scatter plot were visualized on each optical section (magenta contour). On the shown optical section two proliferative T cells were observed. Higher magnification of the boxed area showed phagocytes (grey cells) interacting with one proliferative T cell (ID 61) but not with the other (ID39). T cell ID numbers allow to locate them back in the scatterplot (pointed out in orange) and in the statistical table (boxed in red) and to check that one but not the other was indeed identified as interacting with phagocytes (circle vs triangle in the scatterplot and 1 vs 0 in the interaction column).</p>
      </caption>
      <graphic xlink:href="f1000research-9-55654-g0005"/>
    </fig>
    <p>Finally, we obtained exportable statistical data for all gated cells validated or not by direct visualization onto the image (
<xref ref-type="fig" rid="f6">Figure 6</xref>, lower left panel with selected cells boxed in red). In our case, no errors were detected but if they were, the annotation menu would have allowed to correct them. Finally, based on the analysis of this image and several other similar images, we could document the propensity of proliferating T cells to interact with phagocytes at the periphery of the T cell zone upon stimulation (manuscript in preparation).</p>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusion</title>
    <p>The SAPHIR application provides a simple and user-friendly interface to obtain quantitative data from tissue images as well as COI positioning in the tissue. It is based on the interactivity between quantitative data extracted from the image and the image itself. This is especially useful to locate cells that have been selected based on the extracted data. It may thus reveal particular and unsuspected locations for the selected cells within the tissue. It can also be used to check some parameters of the selected cells (e.g., phenotype and interacting partners) on the image to correct any possible errors generated by the automatic analysis (e.g., segmentation and cell identity). Further developments of SAPHIR will include use of pyramidal images to minimize loading and analysis time and will implement R spatial analysis algorithm to analyze cell clusters and cell neighborhood
<sup><xref rid="ref-12" ref-type="bibr">12</xref></sup>.</p>
  </sec>
  <sec>
    <title>Data and availability</title>
    <p>SAPHIR is provided with segmentation data from two demo pictures (
<ext-link ext-link-type="uri" xlink:href="https://github.com/elodiegermani/SAPHIR/tree/master/Demonstration%20files">https://github.com/elodiegermani/SAPHIR/tree/master/Demonstration%20files</ext-link>): one with only two intensity channels and one optical slice to test the application in a very easy and quickly way, and a more complex one with 6 intensity channels, 12 optical slices and two additional parameters (belonging to a ROI and cell-cell interaction) for advanced testing of the application.</p>
    <p>These data are parts of several projects conducted in the Center of Immunology of Marseille-Luminy (France). Acquisition of the images was made with spectral confocal microscopy and analyzed with Fiji with the provided macro.</p>
  </sec>
  <sec>
    <title>Software availability</title>
    <p>Source code available from:
<ext-link ext-link-type="uri" xlink:href="http://www.github.com/elodiegermani/SAPHIR">www.github.com/elodiegermani/SAPHIR</ext-link>
</p>
    <p>Archived source code as at time of publication:
<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.4656582">https://doi.org/10.5281/zenodo.4656582</ext-link>
<sup><xref rid="ref-13" ref-type="bibr">13</xref></sup>
</p>
    <p>License: GNU General Public License v3.0</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We acknowledge financial support from n° ANR-10-INBS-04-01 France Bio Imaging.</p>
    <p>We thank Guillaume Gay (CENTURI Multi-engineering platform) for helpful discussion; Mauro Gaya and Claude Grégoire for the use of an unpublished image.</p>
    <p>This publication was supported by COST Action NEUBIAS (CA15124), funded by COST (European Cooperation in Science and Technology.</p>
  </ack>
  <ref-list>
    <ref id="ref-1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dodt</surname><given-names>HU</given-names></name><name><surname>Leischner</surname><given-names>U</given-names></name><name><surname>Schierloh</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>Ultramicroscopy: three-dimensional visualization of neuronal networks in the whole mouse brain.</article-title><source><italic toggle="yes">Nat Methods.</italic></source><year>2007</year>;<volume>4</volume>(<issue>4</issue>):<fpage>331</fpage>–<lpage>336</lpage>.
<pub-id pub-id-type="doi">10.1038/nmeth1036</pub-id><?supplied-pmid 17384643?><pub-id pub-id-type="pmid">17384643</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerner</surname><given-names>MY</given-names></name><name><surname>Kastenmuller</surname><given-names>W</given-names></name><name><surname>Ifrim</surname><given-names>I</given-names></name><etal/></person-group>:
<article-title>Histo-cytometry: a method for highly multiplex quantitative tissue imaging analysis applied to dendritic cell subset microanatomy in lymph nodes.</article-title><source><italic toggle="yes">Immunity.</italic></source><year>2012</year>;<volume>37</volume>(<issue>2</issue>):<fpage>364</fpage>–<lpage>376</lpage>.
<pub-id pub-id-type="doi">10.1016/j.immuni.2012.07.011</pub-id><!--<pub-id pub-id-type="pmcid">3514885</pub-id>--><?supplied-pmid 22863836?><pub-id pub-id-type="pmid">22863836</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goltsev</surname><given-names>Y</given-names></name><name><surname>Samusik</surname><given-names>N</given-names></name><name><surname>Kennedy-Darling</surname><given-names>J</given-names></name><etal/></person-group>:
<article-title>Deep Profiling of Mouse Splenic Architecture with CODEX Multiplexed Imaging.</article-title><source><italic toggle="yes">Cell.</italic></source><year>2018</year>;<volume>174</volume>(<issue>4</issue>):<fpage>968</fpage>–<lpage>981.e915</lpage>.
<pub-id pub-id-type="doi">10.1016/j.cell.2018.07.010</pub-id><!--<pub-id pub-id-type="pmcid">6086938</pub-id>--><?supplied-pmid 30078711?><pub-id pub-id-type="pmid">30078711</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <label>4</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lelouard</surname><given-names>H</given-names></name><name><surname>Mailfert</surname><given-names>S</given-names></name><name><surname>Fallet</surname><given-names>M</given-names></name></person-group>:
<article-title>A ten-color spectral imaging strategy to reveal localization of gut immune cell subsets.</article-title><source><italic toggle="yes">Zeiss Application note.</italic></source><year>2018</year>.
<ext-link ext-link-type="uri" xlink:href="https://www.researchgate.net/profile/Sebastien_Mailfert/publication/327933068_A_ten-color_spectral_imaging_strategy_to_reveal_localization_of_gut_immune_cell_subsets/links/5bae1485a6fdccd3cb7948fa/A-ten-color-spectral-imaging-strategy-to-reveal-localization-of-gut-immune-cell-subsets.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Legland</surname><given-names>D</given-names></name><name><surname>Arganda-Carreras</surname><given-names>I</given-names></name><name><surname>Andrey</surname><given-names>P</given-names></name></person-group>:
<article-title>MorphoLibJ: integrated library and plugins for mathematical morphology with ImageJ.</article-title><source><italic toggle="yes">Bioinformatics.</italic></source><year>2016</year>;<volume>32</volume>(<issue>22</issue>):<fpage>3532</fpage>–<lpage>3534</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btw413</pub-id><?supplied-pmid 27412086?><pub-id pub-id-type="pmid">27412086</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weigert</surname><given-names>M</given-names></name><name><surname>Schmidt</surname><given-names>U</given-names></name><name><surname>Haase</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>Star-convex Polyhedra for 3D Object Detection and Segmentation in Microscopy</article-title>.
<italic>2020 IEEE Winter Conference on Applications of Computer Vision (WACV); 2020 1–5 March 2020</italic>.<year>2020</year>;<fpage>3655</fpage>–<lpage>3662</lpage>.
<ext-link ext-link-type="uri" xlink:href="https://openaccess.thecvf.com/content_WACV_2020/papers/Weigert_Star-convex_Polyhedra_for_3D_Object_Detection_and_Segmentation_in_Microscopy_WACV_2020_paper.pdf">Reference Source</ext-link></mixed-citation>
    </ref>
    <ref id="ref-7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname><given-names>C</given-names></name><name><surname>Michaelos</surname><given-names>M</given-names></name><name><surname>Pachitariu</surname><given-names>M</given-names></name></person-group>:
<article-title>Cellpose: a generalist algorithm for cellular segmentation.</article-title><source><italic toggle="yes">bioRxiv.</italic></source><year>2020</year>;<fpage>2020.2002.2002.931238</fpage>.
<pub-id pub-id-type="doi">10.1101/2020.02.02.931238</pub-id></mixed-citation>
    </ref>
    <ref id="ref-8">
      <label>8</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Winfree</surname><given-names>S</given-names></name><name><surname>Khan</surname><given-names>S</given-names></name><name><surname>Micanovic</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>Quantitative Three-Dimensional Tissue Cytometry to Study Kidney Tissue and Resident Immune Cells.</article-title><source><italic toggle="yes">J Am Soc Nephrol.</italic></source><year>2017</year>;<volume>28</volume>(<issue>7</issue>):<fpage>2108</fpage>–<lpage>2118</lpage>.
<pub-id pub-id-type="doi">10.1681/ASN.2016091027</pub-id><!--<pub-id pub-id-type="pmcid">5491289</pub-id>--><?supplied-pmid 28154201?><pub-id pub-id-type="pmid">28154201</pub-id></mixed-citation>
    </ref>
    <ref id="ref-9">
      <label>9</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schindelin</surname><given-names>J</given-names></name><name><surname>Arganda-Carreras</surname><given-names>I</given-names></name><name><surname>Frise</surname><given-names>E</given-names></name><etal/></person-group>:
<article-title>Fiji: an open-source platform for biological-image analysis.</article-title><source><italic toggle="yes">Nat Methods.</italic></source><year>2012</year>;<volume>9</volume>(<issue>7</issue>):<fpage>676</fpage>–<lpage>682</lpage>.
<pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id><!--<pub-id pub-id-type="pmcid">3855844</pub-id>--><?supplied-pmid 22743772?><pub-id pub-id-type="pmid">22743772</pub-id></mixed-citation>
    </ref>
    <ref id="ref-10">
      <label>10</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hahsler</surname><given-names>M</given-names></name><name><surname>Piekenbrock</surname><given-names>M</given-names></name><name><surname>Doran</surname><given-names>D</given-names></name></person-group>:
<article-title>dbscan: Fast Density-Based Clustering with R.</article-title><source><italic toggle="yes">J Stat Softw.</italic></source><year>2019</year>;<volume>91</volume>(<issue>1</issue>):<fpage>30</fpage>.
<pub-id pub-id-type="doi">10.18637/jss.v091.i01</pub-id></mixed-citation>
    </ref>
    <ref id="ref-11">
      <label>11</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>C</given-names></name><name><surname>Bonnardel</surname><given-names>J</given-names></name><name><surname>Da Silva</surname><given-names>C</given-names></name><etal/></person-group>:
<article-title>Differentiation Paths of Peyer’s Patch LysoDCs Are Linked to Sampling Site Positioning, Migration, and T Cell Priming.</article-title><source><italic toggle="yes">Cell Rep.</italic></source><year>2020</year>;<volume>31</volume>(<issue>1</issue>):<fpage>107479</fpage>.
<pub-id pub-id-type="doi">10.1016/j.celrep.2020.03.043</pub-id><?supplied-pmid 32268097?><pub-id pub-id-type="pmid">32268097</pub-id></mixed-citation>
    </ref>
    <ref id="ref-12">
      <label>12</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stoltzfus</surname><given-names>CR</given-names></name><name><surname>Filipek</surname><given-names>J</given-names></name><name><surname>Gern</surname><given-names>BH</given-names></name><etal/></person-group>:
<article-title>CytoMAP: A Spatial Analysis Toolbox Reveals Features of Myeloid Cell Organization in Lymphoid Tissues.</article-title><source><italic toggle="yes">Cell Rep.</italic></source><year>2020</year>;<volume>31</volume>(<issue>3</issue>):<fpage>107523</fpage>.
<pub-id pub-id-type="doi">10.1016/j.celrep.2020.107523</pub-id><!--<pub-id pub-id-type="pmcid">7233132</pub-id>--><?supplied-pmid 32320656?><pub-id pub-id-type="pmid">32320656</pub-id></mixed-citation>
    </ref>
    <ref id="ref-13">
      <label>13</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>elodiegermani</surname></name><name><surname>matfallet</surname></name></person-group>:
<article-title>elodiegermani/SAPHIR: Second release: Minor modifications (Version v1.1.1).</article-title><source><italic toggle="yes">Zenodo.</italic></source><year>2021</year>.
<pub-id pub-id-type="doi">10.5281/zenodo.4656582</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="report82892" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.55654.r82892</article-id>
    <title-group>
      <article-title>Reviewer response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Winfree</surname>
          <given-names>Seth</given-names>
        </name>
        <xref ref-type="aff" rid="r82892a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r82892a1"><label>1</label>Division of Nephrology, Department of Medicine, Indiana University School of Medicine, Indianapolis, IN, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>Developer of a tool for use in tissue cytometry.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2021 Winfree S</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d39e1092" ext-link-type="doi" xlink:href="10.12688/f1000research.27062.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>Thank you for taking the time to respond and thoroughly and thoughtfully to my review. I found your responses to my concerns regarding “Rationale for tool development,” “Interpretation of output, results tool performance”, and figure presentation more than adequate. </p>
    <p> With regard to my minor comments: I believe that addressing bias and inaccuracy is an important and worthwhile pursuit, however, it is unclear how begin able to reclassify cells would specifically address this. In fact, it could be argued that the included functionality could lead to more biased data by allowing for manipulation without clear mechanisms for tracking analysis and changelogs. This appears to be an opportunity for additional contribution in this space (image-based cytometry) and in all multi-step complicated image analysis protocols. How should we qualify segmentation and classification accuracy? However, this is obviously beyond the scope of your work and I would not consider it an impediment for approval. </p>
    <p> Thank you for taking the time for putting together SAPHIR, I hope to incorporate it into my workflows that, at times, bounce between R and ImageJ/FIJI.</p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Partly</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Partly</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Yes</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Partly</p>
    <p>Reviewer Expertise:</p>
    <p>light microscopy, multispectral microscopy, image analysis, tissue cytometry, kidney immunology, neutrophil biology</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report82891" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.55654.r82891</article-id>
    <title-group>
      <article-title>Reviewer response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ahmed</surname>
          <given-names>Mahmoud</given-names>
        </name>
        <xref ref-type="aff" rid="r82891a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-4377-6541</contrib-id>
      </contrib>
      <aff id="r82891a1"><label>1</label>Department of Biochemistry and Convergence Medical Sciences, Institute of Health Sciences, Gyeongsang National University School of Medicine, Jinju, South Korea</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>23</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2021 Ahmed M</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d39e1184" ext-link-type="doi" xlink:href="10.12688/f1000research.27062.2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>Based on their response, the modified manuscript, and the updated app, the authors addressed most of the issues raised in the review. These include a description of the app's development process and a detailed interpretation of the results in the use case. A few changes were made in the app itself, including adding a segmentation menu with links to the required macros, a docker file, and a modified script to address the issues with installing and running the app.</p>
    <p> By contrast, the authors made a few arguments and committed to following up with changes to address other issues. Those are
<list list-type="bullet"><list-item><p>They explain that the goal of the example use case is to illustrate the functionality rather than provide a real example of the analysis workflow.</p></list-item><list-item><p>No viable option was provided for users to try/test the app before investing in installing and running it locally. The authors explained that they are working on a strategy to address this issue.</p></list-item><list-item><p>No substantial improvements to the code were made however the authors committed to cleaning up the code in the future.</p></list-item></list>
</p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Partly</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Yes</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Partly</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Partly</p>
    <p>Reviewer Expertise:</p>
    <p>image-analysis, genomics, adipocyte-differentiation, autophagy</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report73742" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.29894.r73742</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Winfree</surname>
          <given-names>Seth</given-names>
        </name>
        <xref ref-type="aff" rid="r73742a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r73742a1"><label>1</label>Division of Nephrology, Department of Medicine, Indiana University School of Medicine, Indianapolis, IN, USA</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>I authored a article demonstrating a tool I developed with similar functionality.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>30</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2020 Winfree S</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d39e1279" ext-link-type="doi" xlink:href="10.12688/f1000research.27062.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve-with-reservations</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>SAPHIR is an R based tool for image cytometry. SAPHIR provides a novel R based Shinny application for analyzing an existing segmentation, an associated image and measured features of the segmented objects. The tool is intended to meet an unmet need for a flow cytometry-like exploration tool that enables 1) the highlighting of cells-of-interest in the original image volume defined by cells gated on staining intensity or morphological features and 2) the plotting of cells to a scatterplot of staining intensity or morphological features based on an image region-of-interest (ROI). </p>
    <p>
      <bold>Major criticisms:</bold>
      <list list-type="order">
        <list-item>
          <p><underline>Rationale for tool development</underline>: A number of tools previously described or referenced in this manuscript include functionality similar to or overlapping with SAPHIR albeit with different implementations. Although the rationale presented by the authors is clearly explained, it is unclear what the rationale is for a new implementation of these functionalities in R (versus CellAnalyst in Python and CodexMAV and Volumetric Tissue Exploration and Analysis in Java). A tool in R could prove very useful especially in light of major R-based projects in transcriptomic analyses and data visualization and the platform's unrivaled strength in statistical analysis, but this is not addressed. Furthermore, R's strengths and weaknesses in imaging (versus other platforms) are not considered or addressed. These points require further justification and discussion. </p>
        </list-item>
        <list-item>
          <p><underline>Rationale for tool development:</underline> It is unclear if this tool is designed as a generalizable solution or intended only for ImageJ/FIJI users as it is tied to ImageJ/FIJI functionality to generate a number of input files-especially the segmentation which is based on the ImageJ ROI class. Although there may be a path or utility for using ROIs from Icy, CellProfiler, Ilastik or other common segmentation tools, this is not discussed and needs to be clarified.</p>
        </list-item>
        <list-item>
          <p><underline>Interpretation of output results and tool functionality:</underline> The authors mention the importance of supporting multiplexed fluorescence images in the introduction, “more than 10 channel measurements”, but in neither the results nor supporting material is it clear to what degree SAPHIR supports these kinds of datasets (e.g. Lelouard
<italic>et al.</italic> the manuscript). Furthermore, the support for 3D datasets is unclear, as ImageJ ROIs are limited to 2D and the link referenced in the supporting material for the “Complex Image Analysis”,
<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4056001#.X8HVRC2ZM_W">https://zenodo.org/record/4056001#.X8HVRC2ZM_W</ext-link>, suggests the scripts used to generate the input files only consider a single optical slice. Please clarify these functionalities.</p>
        </list-item>
        <list-item>
          <p><underline>Tool performance:</underline> The claim of the application’s quickness is hard to assess. Although, SAPHIR appears to function well with the demonstration datasets the authors also qualify their quickness claim: “Interactivity between scatterplot and image is optional to avoid slow interaction when high-resolution images are used. In the latter case, we recommend users to perform their gating before allowing their selection to be shown in the image by ticking the appropriate box.” This apparent contradiction is unqualified, beyond “high-resolution”, the claim of quickness is poorly clarified. Please elaborate, and demonstrate if necessary, this limitation-for instance with larger or more complex datasets.</p>
        </list-item>
        <list-item>
          <p><underline>Manuscript:</underline> Figures are difficult to interpret due to size and resolution, especially figure 6 in which the “orange” color could not be easily identified nor the “magenta contour”. This is critical to demonstrating the behaviors of SAPHIR. Please adjust to facilitate the interpretation of the results.</p>
        </list-item>
      </list>
    </p>
    <p>
      <bold>Minor criticisms:</bold>
      <list list-type="order">
        <list-item>
          <p><underline>Tool performance:</underline> One of the major goals appears to be addressing “bias and misinterpretation” but this is not directly discussed in the results. It is unclear in what way(s) SAPHIR directly addresses bias.</p>
        </list-item>
        <list-item>
          <p><underline>Tool performance:</underline> The title and introduction suggest that large or mesoscale datasets that can be generated by modern imaging modalities are a unique challenge due to their size and complexity. It is unclear to what degree SAPHIR is able to analyze datasets with a large number of cells. This is an important qualification that is not directly addressed.  </p>
        </list-item>
      </list>
    </p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Partly</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Partly</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Yes</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Partly</p>
    <p>Reviewer Expertise:</p>
    <p>light microscopy, multispectral microscopy, image analysis, tissue cytometry, kidney immunology, neutrophil biology</p>
    <p>I confirm that I have read this submission and believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard, however I have significant reservations, as outlined above.</p>
  </body>
  <sub-article id="comment6490-73742" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>GERMANI</surname>
            <given-names>Elodie</given-names>
          </name>
          <aff>University of Rennes 1, France</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>23</day>
        <month>3</month>
        <year>2021</year>
      </pub-date>
    </front-stub>
    <body>
      <p>Dear reviewer, we would like to thank you for all your comments on our app and article that helped us improve them. </p>
      <p> We studied every remark and wanted to give you an answer : </p>
      <p>
        <bold>Major criticisms:</bold>
      </p>
      <p>
        <bold><underline>1. Rationale for tool development</underline>: A number of tools previously described or referenced in this manuscript include functionality similar to or overlapping with SAPHIR albeit with different implementations. Although the rationale presented by the authors is clearly explained, it is unclear what the rationale is for a new implementation of these functionalities in R (versus CellAnalyst in Python and CodexMAV and Volumetric Tissue Exploration and Analysis in Java). A tool in R could prove very useful especially in light of major R-based projects in transcriptomic analyses and data visualization and the platform's unrivaled strength in statistical analysis, but this is not addressed. Furthermore, R's strengths and weaknesses in imaging (versus other platforms) are not considered or addressed. These points require further justification and discussion. </bold>
      </p>
      <p> Due to the short format chosen for our manuscript (allowed initial length of 1000 words), it was not possible to include a discussion on the advantage/disadvantage of each software and its environment. CodexMAV is a commercial software but available for free as an ImageJ plugin. It needs FCS files to run. The software is very powerful to do spatial analysis (t-SNE) of cell populations in tissues, but we didn’t test it in our datasets, yet. CellProfiler (Analyst) is very interesting in term of segmentation and analysis but as far as we know, scatterplots and images are not interconnected. VTEA is also a great and easy application to use, as it is an ImageJ plugin. However, at the time we needed quantitative analysis to be done, segmentation was included in VTEA without all the flexibility that was required for the segmentation of our datasets. We therefore asked the VTEA developer to add the possibility to load ROIs from ImageJ, which is done now. However, the strong interconnection between the image and the scatterplot that we wanted to have to control and correct cells identity was lacking. We have added a sentence in section Operation to explain why we have chosen R for developing SAPHIR application.</p>
      <p>
        <bold><underline>2. Rationale for tool development:</underline> It is unclear if this tool is designed as a generalizable solution or intended only for ImageJ/FIJI users as it is tied to ImageJ/FIJI functionality to generate a number of input files-especially the segmentation which is based on the ImageJ ROI class. Although there may be a path or utility for using ROIs from Icy, CellProfiler, Ilastik or other common segmentation tools, this is not discussed and needs to be clarified.</bold>
      </p>
      <p> Following reviewer recommendation, we have now added a sentence in the data requirement section to help users with the conversion of COI obtained from other software into the Fiji .roi format.</p>
      <p>
        <bold><underline>3. Interpretation of output results and tool functionality:</underline> The authors mention the importance of supporting multiplexed fluorescence images in the introduction, “more than 10 channel measurements”, but in neither the results nor supporting material is it clear to what degree SAPHIR supports these kinds of datasets (e.g. Lelouard
<italic>et al.</italic> the manuscript). Furthermore, the support for 3D datasets is unclear, as ImageJ ROIs are limited to 2D and the link referenced in the supporting material for the “Complex Image Analysis”,
<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4056001#.X8HVRC2ZM_W">https://zenodo.org/record/4056001#.X8HVRC2ZM_W</ext-link>, suggests the scripts used to generate the input files only consider a single optical slice. Please clarify these functionalities.</bold>
      </p>
      <p> SAPHIR is supporting multichannel images and Z stack image (ijtiff is used to load the image). We indeed used 3D images but following 3D segmentation only the main COI corresponding to the largest nucleus area was kept for calculating the intensity of other channels. In Fiji, the ROI are linked to specific slices allowing this operation. Thus, we used 2D ROI of 3D images for SAPHIR analysis. This is now explained in the data requirement section.</p>
      <p> Of note, it is now possible to obtain 3D ROI in Fiji using a Plugin from Thomas Boudier (
<ext-link ext-link-type="uri" xlink:href="https://imagejdocu.tudor.lu/plugin/stacks/3d_roi_manager/start#d_roi_manager">https://imagejdocu.tudor.lu/plugin/stacks/3d_roi_manager/start#d_roi_manager</ext-link>
<underline>).</underline>
</p>
      <p>
        <bold>4. Tool performance: The claim of the application’s quickness is hard to assess. Although, SAPHIR appears to function well with the demonstration datasets the authors also qualify their quickness claim: “Interactivity between scatterplot and image is optional to avoid slow interaction when high-resolution images are used. In the latter case, we recommend users to perform their gating before allowing their selection to be shown in the image by ticking the appropriate box.” This apparent contradiction is unqualified, beyond “high-resolution”, the claim of quickness is poorly clarified. Please elaborate, and demonstrate if necessary, this limitation-for instance with larger or more complex datasets.</bold>
      </p>
      <p> As the application could be slowed down with images &gt;300MB, we decided to remove the term "quickly” from the abstract of the manuscript. Moreover, the limitation of 300MB is now specified in the implementation section. Big images (with multiple slices and channels) have to be stored on SSD drive to limit slow interaction. Since our application was mainly used for tissue section &lt; 20 µm, we did not test datasets &gt; 300MB, yet.</p>
      <p>
        <bold><underline>5. Manuscript:</underline> Figures are difficult to interpret due to size and resolution, especially figure 6 in which the “orange” color could not be easily identified nor the “magenta contour”. This is critical to demonstrating the behaviors of SAPHIR. Please adjust to facilitate the interpretation of the results.</bold>
      </p>
      <p> The resolution of the figures has been improved and Figure 6 has been modified to allow better visualization of specific parts of the panels. Moreover, the app tools now include options to adjust the cell contour thickness in the image and the spot size in the scatterplot.</p>
      <p>
        <bold>Minor criticisms:</bold>
      </p>
      <p>
        <bold><underline>1. Tool performance:</underline> One of the major goals appears to be addressing “bias and misinterpretation” but this is not directly discussed in the results. It is unclear in what way(s) SAPHIR directly addresses bias.</bold>
      </p>
      <p> By allowing to analyze for each cell of the scatterplot its position and its characteristics in the image, SAPHIR allows to check that the parameters obtained automatically with the segmentation and other analysis algorithms fit with the observation of the selected cells in the image. Then, the annotation menu allows to correct any bad analysis (e.g., cell identity). We have now extended the use case section to better describe SAPHIR use.</p>
      <p>
        <bold><underline>2. Tool performance:</underline> The title and introduction suggest that large or mesoscale datasets that can be generated by modern imaging modalities are a unique challenge due to their size and complexity. It is unclear to what degree SAPHIR is able to analyze datasets with a large number of cells. This is an important qualification that is not directly addressed.</bold>
      </p>
      <p> Our aim was clearly not to analyze mesoscale datasets. We apologize if that is the impression given by our title or introduction, although we see no allusion to it in the title and only a small reference in the introduction (i.e., “10 µm to more than 200 µm when clearing methods are used”) but not related to the description of the application. Actually, as mentioned in the introduction our main goal was to obtain an interconnection between the representation of image parameters in scatterplot and the image itself in order to analyze positioning of scatterplot-selected cells in the image and to check and correct any analysis errors by direct observation of the selected cells.</p>
      <p> We hope these responses and the new version of our article will satisfy you.</p>
    </body>
  </sub-article>
</sub-article>
<sub-article id="report73741" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.29894.r73741</article-id>
    <title-group>
      <article-title>Reviewer response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ahmed</surname>
          <given-names>Mahmoud</given-names>
        </name>
        <xref ref-type="aff" rid="r73741a1">1</xref>
        <role>Referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-4377-6541</contrib-id>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lai</surname>
          <given-names>Trang Huyen</given-names>
        </name>
        <xref ref-type="aff" rid="r73741a1">1</xref>
        <role>Co-referee</role>
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-4619-6558</contrib-id>
      </contrib>
      <aff id="r73741a1"><label>1</label>Department of Biochemistry and Convergence Medical Sciences, Institute of Health Sciences, Gyeongsang National University School of Medicine, Jinju, South Korea</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="COI-statement">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <permissions>
      <copyright-statement>Copyright: © 2020 Lai TH and Ahmed M</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access peer review report distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <related-article related-article-type="peer-reviewed-article" id="d39e1591" ext-link-type="doi" xlink:href="10.12688/f1000research.27062.1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve-with-reservations</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>In this article, the authors describe a shiny app to load and explore the segmentation output of fluorescence images from ImageJ/Fiji. The app provides an interactive interface to filter, select, and annotate the regions of interest as defined by the ImageJ/Fiji macros. Besides, the app allows for performing statistical testing on the selected regions. The manuscript describes the motivation for developing the app, the basic functionality, and a use case. In the use case, the app was used to filter proliferative T and B cells based on cell membranes staining and determine that more T cells interacted with phagocytes in Peyer's patches images.</p>
    <p> The article is written in clear and concise language. The motivation for developing the app and the description of the operation is sound. A few issues remain:</p>
    <p>
      <bold>Major Issues</bold>
      <list list-type="order">
        <list-item>
          <p>The implementation section focuses on describing the interface but doesn't explain much about the inner working of the app or the development process. (related, question 3).</p>
        </list-item>
        <list-item>
          <p>Four types of files are needed to use the app: Images, Data files, ROIs Files, and Legend files. Each file needs to be processed and prepared to match the formats and requirements of the app. The user has to perform many steps, including using ImageJ and R, to process the files to be able to use SAPHIR. Besides, if the user wants to combine 2 images, he or she has to prepare 4 files for each image. These complicated steps could limit the replication of the analysis by others. It is better if the providers could explain the steps and the tools that they have used to prepare their files. Or if there is an option in SAPHIR that we can use to directly prepare the files.</p>
        </list-item>
        <list-item>
          <p>The article explains well using the app to perform different filtering and selection on an example image. However, it doesn't say much about the interpretation of the outputs, or the context in which these decisions could be made. (related, question 4)</p>
        </list-item>
        <list-item>
          <p>The use case is very brief and it seems like many of the analysis steps were done outside of the app using custom macros. This makes it hard to evaluate the use case or determining how the app contributed to the final calculations. The authors could provide a more complete description of the use case starting from the raw images and describe how the macros work. It would be helpful to provide links to the data and the tools they used as well.</p>
        </list-item>
        <list-item>
          <p>The two examples provided in the article use a single image. To be able to make any claims on the performance (related, question 5), the authors might need to perform testing with multiple images or provide a comparison with existing tools.</p>
        </list-item>
      </list>
      <bold>Minor Issues</bold>
      <list list-type="order">
        <list-item>
          <p>Several screenshots from the app were included in the manuscript as figures. It might be helpful to change the size/resolution of the images for clarity. Also, highlighting the important parts of the image would make it easier to understand the interface.</p>
        </list-item>
        <list-item>
          <p>The app depends on ImageJ so it should be bundled with the app or explain how to obtain and add to the app.</p>
        </list-item>
        <list-item>
          <p>Related. Trying to run the app using rstudio server on rocker/verse failed. A dependency libpoppler-cpp-dev was required but not declared.</p>
        </list-item>
        <list-item>
          <p>Provide a viable demo, for example using
<ext-link ext-link-type="uri" xlink:href="http://shinyapps.io">shinyapps.io</ext-link> or
<ext-link ext-link-type="uri" xlink:href="http://rstudio.cloud">rstudio.cloud</ext-link> would make it easier to evaluate the tool and lowers the entry cost for users.</p>
        </list-item>
        <list-item>
          <p>The app is written as one long R script. This makes it very difficult to examine, modify, or extend the code. Factoring the code or making it more modular would be helpful.</p>
        </list-item>
        <list-item>
          <p>After installing the most recent versions of the required packages, trying to run the app in a fresh rstudio session through an error related to shinyjs::extendShinyjs. I was able to get it to run by adding functions = 'winprint' as an argument.
<ext-link ext-link-type="uri" xlink:href="https://stackoverflow.com/questions/63860952/print-shiny-app-screen-not-working-error-shinyjs-extendshinyjs-functions-ar">Source</ext-link>
</p>
        </list-item>
      </list>
    </p>
    <p>Are the conclusions about the tool and its performance adequately supported by the findings presented in the article?</p>
    <p>Partly</p>
    <p>Is the rationale for developing the new software tool clearly explained?</p>
    <p>Yes</p>
    <p>Is the description of the software tool technically sound?</p>
    <p>Yes</p>
    <p>Are sufficient details of the code, methods and analysis (if applicable) provided to allow replication of the software development and its use by others?</p>
    <p>Partly</p>
    <p>Is sufficient information provided to allow interpretation of the expected output datasets and any results generated using the tool?</p>
    <p>Partly</p>
    <p>Reviewer Expertise:</p>
    <p>image-analysis, genomics, adipocyte-differentiation, autophagy</p>
    <p>We confirm that we have read this submission and believe that we have an appropriate level of expertise to confirm that it is of an acceptable scientific standard, however we have significant reservations, as outlined above.</p>
  </body>
  <sub-article id="comment6489-73741" article-type="response">
    <front-stub>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>GERMANI</surname>
            <given-names>Elodie</given-names>
          </name>
          <aff>University of Rennes 1, France</aff>
        </contrib>
      </contrib-group>
      <author-notes>
        <fn fn-type="COI-statement">
          <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
        </fn>
      </author-notes>
      <pub-date pub-type="epub">
        <day>23</day>
        <month>3</month>
        <year>2021</year>
      </pub-date>
    </front-stub>
    <body>
      <p>Dear reviewer, we would like to thank you for all your comments on our app and article that helped us improve them. </p>
      <p> We studied every remark and wanted to give you an answer : </p>
      <p>
        <bold>Major Issues</bold>
      </p>
      <p>
        <bold>1. The implementation section focuses on describing the interface but doesn't explain much about the inner working of the app or the development process. (related, question 3).</bold>
      </p>
      <p> Following the recommendation of the reviewer we have now explain the development process of the app in the operation section.</p>
      <p>
        <bold>2. Four types of files are needed to use the app: Images, Data files, ROIs Files, and Legend files. Each file needs to be processed and prepared to match the formats and requirements of the app. The user has to perform many steps, including using ImageJ and R, to process the files to be able to use SAPHIR. Besides, if the user wants to combine 2 images, he or she has to prepare 4 files for each image. These complicated steps could limit the replication of the analysis by others. It is better if the providers could explain the steps and the tools that they have used to prepare their files. Or if there is an option in SAPHIR that we can use to directly prepare the files.</bold>
      </p>
      <p> We thank the reviewer for this suggestion. We have now added in the data requirement section a description of the segmentation process. A segmentation menu to is available in the application where Fiji and the two macros used in the manuscript can be launched.</p>
      <p>
        <bold>3. The article explains well using the app to perform different filtering and selection on an example image. However, it doesn't say much about the interpretation of the outputs, or the context in which these decisions could be made. (related, question 4)</bold>
      </p>
      <p> We agree with the reviewer and based on the use case we now describe the results we could obtain and the conclusions we were able to draw using SAPHIR on a specific application, which is the immune response initiation in murine Peyer’s patches. We also show how useful the filtering tool is to focus on a given population of cells (i.e., in our case proliferative cells of the ROI) and how interaction between the image and the scatter plot can be used to focus on a given cell of interest and to control that analysis is correct. </p>
      <p>
        <bold>4. The use case is very brief and it seems like many of the analysis steps were done outside of the app using custom macros. This makes it hard to evaluate the use case or determining how the app contributed to the final calculations. The authors could provide a more complete description of the use case starting from the raw images and describe how the macros work. It would be helpful to provide links to the data and the tools they used as well.</bold>
      </p>
      <p> We followed the recommendation of the reviewer and have extended the section dedicated to the use case (see answer to point 3). However, since the segmentation process is now described in detail in the data requirement section, we only briefly described this step to rather focus on the contribution of SAPHIR to quantitative image analysis. As explained in the main text, all data and macros are available on GitHub in the Demonstration Files.</p>
      <p>
        <bold>5. The two examples provided in the article use a single image. To be able to make any claims on the performance (related, question 5), the authors might need to perform testing with multiple images or provide a comparison with existing tools.</bold>
      </p>
      <p> The main goal of this manuscript was to provide a brief description of the application and its usefulness using two types of image as demos. It is now applied in the lab to study biological processes using dozens of images to validate statistics and its use will be included in several studies, but it was not the aim of this manuscript to already provide this kind of analysis. We indeed tested other tools before developing SAPHIR, such as VTEA and FlowJo, but none was really adapted to our needs as we especially wanted to have a strong interconnection between images and scatterplots.  </p>
      <p>
        <bold>Minor Issues</bold>
      </p>
      <p>
        <bold>1. Several screenshots from the app were included in the manuscript as figures. It might be helpful to change the size/resolution of the images for clarity. Also, highlighting the important parts of the image would make it easier to understand the interface.</bold>
      </p>
      <p> The resolution of the figures has been improved and Figure 6 has been modified to allow better visualization of specific parts of the panels. Moreover, the app tools now include options to adjust the cell contour thickness in the image and the size of the dots in the scatterplots.</p>
      <p>
        <bold>2. The app depends on ImageJ so it should be bundled with the app or explain how to obtain and add to the app.</bold>
      </p>
      <p> Link to Fiji is now provided in the segmentation menu of the app, where Fiji and the two macros used in the manuscript can be launched and applied to any image.</p>
      <p>
        <bold>3. Related. Trying to run the app using rstudio server on rocker/verse failed. A dependency libpoppler-cpp-dev was required but not declared.</bold>
      </p>
      <p> The dependency to lipoppler-cpp-dev is due to the use of the magick package, which is required to use the application. We also had this problem when trying to deploy our app on shinyapps.io. This problem can be solved using a Unix operating system instead of Windows. We have created a Docker file to use the app without this kind of issues.</p>
      <p>
        <bold>4. Provide a viable demo, for example using
<ext-link ext-link-type="uri" xlink:href="http://shinyapps.io">shinyapps.io</ext-link> or
<ext-link ext-link-type="uri" xlink:href="http://rstudio.cloud">rstudio.cloud</ext-link> would make it easier to evaluate the tool and lowers the entry cost for users.</bold>
      </p>
      <p> We are soon going to deploy a demo version on shinyapps.io. However, it will only be operable on our demo images and the user will not be able to change the images to use.</p>
      <p>
        <bold>5. The app is written as one long R script. This makes it very difficult to examine, modify, or extend the code. Factoring the code or making it more modular would be helpful.</bold>
      </p>
      <p> We agree with the reviewer and we are going to modularize the code in the following months.</p>
      <p>
        <bold>6. After installing the most recent versions of the required packages, trying to run the app in a fresh rstudio session through an error related to shinyjs::extendShinyjs. I was able to get it to run by adding functions = 'winprint' as an argument. </bold>
        <ext-link ext-link-type="uri" xlink:href="https://stackoverflow.com/questions/63860952/print-shiny-app-screen-not-working-error-shinyjs-extendshinyjs-functions-ar">
          <bold>Source</bold>
        </ext-link>
      </p>
      <p> We modified the script in order to correct this. Indeed, the package shinyjs was recently updated and a new argument in the function “extendShinyjs” was made mandatory. We added this modification to the latest version of our script.</p>
      <p> We hope these responses and the new version of our article will satisfy you.</p>
    </body>
  </sub-article>
</sub-article>
