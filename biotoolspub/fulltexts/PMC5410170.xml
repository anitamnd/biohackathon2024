<?properties open_access?>
<?properties manuscript?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat. Methods?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 1005?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5410170</article-id>
    <article-id pub-id-type="pmid">28346451</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4236</article-id>
    <article-id pub-id-type="manuscript">ems71741</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SC3 - consensus clustering of single-cell RNA-Seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Kiselev</surname>
          <given-names>Vladimir Yu.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kirschner</surname>
          <given-names>Kristina</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schaub</surname>
          <given-names>Michael T.</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Andrews</surname>
          <given-names>Tallulah</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yiu</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chandra</surname>
          <given-names>Tamir</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A1">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Natarajan</surname>
          <given-names>Kedar N</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Reik</surname>
          <given-names>Wolf</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A5">5</xref>
        <xref ref-type="aff" rid="A7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barahona</surname>
          <given-names>Mauricio</given-names>
        </name>
        <xref ref-type="aff" rid="A8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Green</surname>
          <given-names>Anthony R</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hemberg</surname>
          <given-names>Martin</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Wellcome Trust Sanger Institute, Hinxton, Cambridge, UK</aff>
    <aff id="A2"><label>2</label>Cambridge Institute for Medical Research, Wellcome Trust/MRC Stem Cell Institute and Department of Haematology, University of Cambridge, Hills Road, Cambridge, UK</aff>
    <aff id="A3"><label>3</label>Department of Mathematics and naXys, University of Namur, Belgium</aff>
    <aff id="A4"><label>4</label>ICTEAM, Université catholique de Louvain, Belgium</aff>
    <aff id="A5"><label>5</label>Epigenetics Programme, The Babraham Institute, Babraham, Cambridge, UK</aff>
    <aff id="A6"><label>6</label>EMBL-European Bioinformatics Institute, Hinxton, Cambridge, UK</aff>
    <aff id="A7"><label>7</label>Centre for Trophoblast Research, University of Cambridge, Cambridge, UK</aff>
    <aff id="A8"><label>8</label>Department of Mathematics, Imperial College London, London, UK</aff>
    <author-notes>
      <corresp id="CR1">Corresponding author: Martin Hemberg (<email>mh26@sanger.ac.uk</email>)</corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>13</day>
      <month>3</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>3</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>9</month>
      <year>2017</year>
    </pub-date>
    <volume>14</volume>
    <issue>5</issue>
    <fpage>483</fpage>
    <lpage>486</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4236-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">Single-cell RNA-seq (scRNA-seq) enables a quantitative cell-type characterisation based on global transcriptome profiles. We present Single-Cell Consensus Clustering (SC3), a user-friendly tool for unsupervised clustering which achieves high accuracy and robustness by combining multiple clustering solutions through a consensus approach. We demonstrate that SC3 is capable of identifying subclones based on the transcriptomes from neoplastic cells collected from patients.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">One of the key applications of scRNA-seq is determining cell types based on transcriptome profiles alone through unsupervised clustering<xref rid="R1" ref-type="bibr">1</xref>–<xref rid="R3" ref-type="bibr">3</xref>. A full characterisation of the transcriptional landscape of individual cells holds an enormous potential, both for basic biology and clinical applications. SC3 is an interactive and user-friendly R-package for clustering and its integration with Bioconductor<xref rid="R4" ref-type="bibr">4</xref> and scater<xref rid="R5" ref-type="bibr">5</xref> makes it easy to incorporate into existing bioinformatic workflows.</p>
  <p id="P3">The SC3 pipeline is presented in <xref ref-type="fig" rid="F1">Fig. 1a</xref>, <xref ref-type="sec" rid="S1">Methods</xref>. Each of the steps requires the specification of a number of parameters. Choosing optimal parameter values is difficult and time-consuming. To avoid this problem, SC3 utilizes a parallelisation approach, whereby a significant subset of the parameter space is evaluated simultaneously to obtain a set of clusterings. SC3 then combines <italic>all</italic> the different clustering outcomes into a consensus matrix that summarises how often each pair of cells is located in the same cluster. The final result provided by SC3 is determined by complete-linkage hierarchical clustering of the consensus matrix into <italic>k</italic> groups.</p>
  <p id="P4">To constrain the parameter values of the SC3 pipeline, we first considered six publicly available scRNA-Seq datasets<xref ref-type="fn" rid="FN1">*</xref> (<xref ref-type="fig" rid="F1">Fig. 1b</xref>). The datasets were selected on the basis that one can be highly confident in the cell-labels as they represent cells from different stages, conditions or lines, and thus we consider them as ‘gold standard’. To quantify the similarity between the reference labels and the clusters obtained by SC3, we used the Adjusted Rand Index (ARI, see <xref ref-type="sec" rid="S1">Methods</xref>) which ranges from 1, when the clusterings are identical, to 0 when the similarity is what one would expect by chance. For the gold standard datasets, we found that the quality of the outcome as measured by the ARI was sensitive to the number of eigenvectors, <italic>d</italic>, retained after the spectral transformation (<xref ref-type="supplementary-material" rid="SD2">Fig. S1, S2</xref>). For all six datasets we find that the best clusterings were achieved when <italic>d</italic> is between 4-7% of the number of cells, <italic>N</italic> (<xref ref-type="fig" rid="F1">Fig. 1c</xref>, <xref ref-type="supplementary-material" rid="SD2">S3a</xref>, <xref ref-type="sec" rid="S1">Methods</xref>). The robustness of the 4-7% region was supported by a simulation experiment where the reads from the six gold standard datasets were downsampled by a factor of ten (<xref ref-type="sec" rid="S1">Methods</xref> and <xref ref-type="supplementary-material" rid="SD2">Fig. S3a</xref>). We further tested the SC3 pipeline on six other published datasets, where the cell labels can only be considered ‘silver standard’ since they were assigned using computational methods and the authors’ knowledge of the underlying biology. Again, we find that SC3 performs well when using <italic>d</italic> in the 4-7% of <italic>N</italic> interval (<xref ref-type="supplementary-material" rid="SD2">Fig. S3b</xref>). The final step, consensus clustering, improves both the accuracy and the stability of the solution. k-means based methods will typically provide different outcomes depending on the initial conditions. We find that this variability is significantly reduced with the consensus approach (<xref ref-type="fig" rid="F1">Fig. 1d</xref>).</p>
  <p id="P5">To benchmark SC3, we considered five other methods: tSNE<xref rid="R6" ref-type="bibr">6</xref> followed by <italic>k</italic>-means clustering (a method similar to the one used by Grün et al<xref rid="R1" ref-type="bibr">1</xref>), pcaReduce<xref rid="R7" ref-type="bibr">7</xref>, SNN-Cliq<xref rid="R8" ref-type="bibr">8</xref>, SINCERA<xref rid="R9" ref-type="bibr">9</xref> and SEURAT<xref rid="R10" ref-type="bibr">10</xref>. As <xref ref-type="fig" rid="F2">Fig. 2a</xref> shows, SC3 performs better than the five tested methods across all datasets (Wilcoxon signed-rank test p-value &lt; 0.01), with only a few exceptions. In addition to considering accuracy, we also compared the stability of SC3 with other stochastic methods (pcaReduce and tSNE+kmeans, but not SEURAT) by running them 100 times (<xref ref-type="fig" rid="F2">Fig. 2b</xref>, <xref ref-type="sec" rid="S1">Methods</xref>, black dots in <xref ref-type="fig" rid="F2">Fig. 2a</xref>). In contrast to the other methods that rely on different initializations, SC3 is highly stable.</p>
  <p id="P6">Although SC3’s consensus strategy provides a high accuracy, it comes at a moderate computational cost: the run time for N = 2,000 is ~20 mins (<xref ref-type="supplementary-material" rid="SD2">Fig. S4a</xref>). The main bottleneck is the k-means clustering and by reducing how many different runs are considered it is possible to cluster 5,000 cells in ~20 mins with only a slight reduction in accuracy (<xref ref-type="supplementary-material" rid="SD2">Fig. S4b</xref>). To apply SC3 to even larger datasets, we have implemented a hybrid approach that combines unsupervised and supervised methodologies. SC3 selects a subset of 5,000 cells uniformly at random, and obtains clusters from this subset as described above. Subsequently, the inferred labels are used to train a support vector machine (SVM, <xref ref-type="sec" rid="S1">Methods</xref>), which is employed to assign labels to the remaining cells. Our result shows that the use of an SVM to predict cell labels works well (<xref ref-type="fig" rid="F2">Fig. 2c</xref>, <xref ref-type="supplementary-material" rid="SD2">S4c</xref> and <xref ref-type="sec" rid="S1">Methods</xref>). Using the hybrid approach, we were able to analyse a large Drop-Seq dataset with <italic>N</italic> = 44,808 cells and <italic>k</italic> = 39 clusters<xref rid="R10" ref-type="bibr">10</xref> and our results were again in good agreement with the original authors’ (<xref ref-type="supplementary-material" rid="SD3">Supplementary Results</xref>, <xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD2">Fig. S5</xref>, <xref ref-type="supplementary-material" rid="SD3">Table S1</xref>). The main drawback of the sampling strategy is that one may fail to identify rare cell-types, and when N&gt;&gt;5,000 there is a substantial risk that the sampled distribution will differ significantly from the full distribution (<xref ref-type="sec" rid="S1">Methods</xref>). If the user is trying to identify a rare subpopulation (e.g. cancer stem cells), then methods specifically designed to identify rare cell-types such as RaceID<xref rid="R1" ref-type="bibr">1</xref> or GiniClust<xref rid="R11" ref-type="bibr">11</xref> may be more appropriate.</p>
  <p id="P7">To help the user identify a good choice of <italic>k</italic>, we have implemented a method based on Random Matrix Theory (RMT)<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R13" ref-type="bibr">13</xref> for determining the number of clusters (<xref ref-type="sec" rid="S1">Methods</xref>). Overall, we find good agreement between these estimates, <inline-formula><mml:math display="inline" id="M1" overflow="scroll"><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, and the numbers suggested by the original authors (<xref ref-type="fig" rid="F2">Fig. 2b</xref>). Additionally, in the interactive SC3 session the user can explore different choices of <italic>k</italic> in real time, by either assessing the consensus matrix (<xref ref-type="fig" rid="F2">Fig. 2d</xref>), the silhouette index<xref rid="R14" ref-type="bibr">14</xref> (a measure of how tightly grouped the cells in the clusters are), or the expression matrix.</p>
  <p id="P8">To help the user interpret the clustering result SC3 can identify differentially expressed genes, marker genes, and outlier cells (<xref ref-type="supplementary-material" rid="SD2">Fig. S6</xref>, <xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD3">Table S2</xref>). Marker genes are particularly useful since they can be used to uniquely identify a cluster. To illustrate these features, we analysed the Deng<xref rid="R15" ref-type="bibr">15</xref> dataset tracing embryonic developmental stages. The most stable result for <italic>k</italic> = 10 is shown in <xref ref-type="fig" rid="F2">Fig. 2d</xref>, and our clusters largely agree with the known sampling timepoints. In total, we identified ~3000 marker genes (<xref ref-type="supplementary-material" rid="SD3">Table S3</xref>), many of which had been previously reported as specific to the different developmental stages<xref rid="R16" ref-type="bibr">16</xref>,<xref rid="R17" ref-type="bibr">17</xref>. Furthermore, the analysis reveals several genes specific to each developmental stage which had previously not been reported (<xref ref-type="supplementary-material" rid="SD3">Table S3</xref>). Importantly, when using the reference labels reported by the authors<xref rid="R15" ref-type="bibr">15</xref>, nine cells have high outlier scores (purple cells in <xref ref-type="supplementary-material" rid="SD2">Fig. S6c</xref>). As it turns out, these were prepared using the Smart-Seq2 protocol instead of the Smart-Seq protocol<xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R15" ref-type="bibr">15</xref>.</p>
  <p id="P9">Finally, we investigated the ability of SC3 to identify subclones based on transcriptomes. Myeloproliferative neoplasms, a group of diseases characterised by the overproduction of terminally differentiated cells of the myeloid lineage, reflect an early stage of tumorigenesis where multiple subclones are known to coexist in the same patient<xref rid="R18" ref-type="bibr">18</xref>. From exome sequencing data, we previously identified TET2 and JAK2V61F as the only driver mutations in a large patient cohort<xref rid="R19" ref-type="bibr">19</xref>. Haematopoietic stem cells (HSCs) are thought to be the cell of origin in myeloproliferative neoplasms. To gain further insight into the transcriptional landscape of patient derived HSCs, we obtained scRNA-seq data from the two patients (<xref ref-type="supplementary-material" rid="SD2">Figs. S7a-b, S8</xref>, <xref ref-type="sec" rid="S1">Methods</xref>, <xref ref-type="supplementary-material" rid="SD3">Table S4</xref>). For patient 1 (<italic>N</italic> = 51), both the silhouette index of SC3 and our RMT method suggested that <italic>k</italic> = 3, provides the best clustering, revealing three clusters of similar size (<xref ref-type="supplementary-material" rid="SD2">Fig. S9</xref>). For patient 2 (<italic>N</italic> = 89) SC3 indicated <italic>k</italic>=1 (<xref ref-type="supplementary-material" rid="SD2">Fig. S10</xref>), in agreement with the RMT algorithm, suggesting that one single cluster might best reflect the underlying transcriptional changes.</p>
  <p id="P10">Since known driver mutations in these patients are the <italic>TET2</italic> and <italic>JAK2V617F</italic> loci<xref rid="R20" ref-type="bibr">20</xref> we hypothesized that the different clusters correspond to different combinations of mutations within different clones. The genotype composition for each HSC clone was determined by growing individual haematopoietic stem cells into granulocyte/macrophage colonies, followed by Sanger sequencing of the TET2 and JAK2V617F loci (<xref ref-type="supplementary-material" rid="SD2">Fig. S7b-c</xref>). In agreement with the clustering defined by SC3, patient 1 (<italic>k</italic>=3) was found to harbor three different subclones: (i) cells with both TET2 and JAK2V617F mutations, (ii) cells with a TET2 mutation and (iii) wild-type cells (<xref ref-type="supplementary-material" rid="SD2">Fig. S7c</xref>). Strikingly, the SC3-clusters contain 22%, 29% and 49% of the cells, in excellent agreement with the proportions of each genotype found in the patient, namely 20%, 30% and 50% (<xref ref-type="supplementary-material" rid="SD2">Fig. S7c</xref>). Thus, we hypothesize that cluster 1 corresponds to the double mutant, cluster 2 corresponds to cells with only a TET2 mutation, and cluster 3 corresponds to wild-type cells. The HSC compartment of patient 2 was 100% mutant for TET2 and JAK2V617F (<xref ref-type="supplementary-material" rid="SD2">Fig. S7c</xref>), which again was consistent with clustering of <italic>k</italic>=1 suggested by SC3 (<xref ref-type="supplementary-material" rid="SD2">Fig. S10</xref>). We then analysed the pooled cells from patient 1 and 2. SC3 clustering again suggested <italic>k</italic>=3 (<xref ref-type="fig" rid="F3">Figs. 3</xref>, <xref ref-type="supplementary-material" rid="SD3">S11</xref>), in agreement with the RMT algorithm. Most importantly, all of the putative double mutant cells from patient 1 were grouped with the double mutant cells from patient 2. SC3 reported 33 marker genes for the putative <italic>TET2</italic> mutant and 202 marker genes for the putative double mutant clone (<xref ref-type="fig" rid="F3">Fig. 3</xref>, <xref ref-type="supplementary-material" rid="SD3">Table S5</xref>). Together with additional evidence (<xref ref-type="supplementary-material" rid="SD3">Supplementary Results</xref>, <xref ref-type="supplementary-material" rid="SD2">Fig. S12</xref>), we conclude that SC3 is able to identify subclones across patients.</p>
  <sec sec-type="methods" id="S1" specific-use="web-only">
    <title>Methods</title>
    <sec id="S2">
      <title>SC3 clustering</title>
      <p id="P11">SC3 takes as input an expression matrix <bold><italic>M</italic></bold> where columns correspond to cells and rows correspond to genes/transcripts. Each element of <bold><italic>M</italic></bold> corresponds to the expression of a gene/transcript in a given cell. By default SC3 does not carry out any form of normalization or correction for batch effects. SC3 is based on five elementary steps. The parameters in each of these steps can be easily adjusted by the user, but are set to sensible default values, determined via the gold standard datasets (see text).</p>
      <sec id="S3">
        <label>1</label>
        <title>Gene filter</title>
        <p id="P12">The gene filter removes genes/transcripts that are either expressed (expression value is more than 2) in less than X% of cells (rare genes/transcripts) or expressed (expression value is more than 0) in at least (100-X)% of cells (ubiquitous genes/transcripts). By default X is 6. The motivation for the gene filter is that ubiquitous and rare genes are most often not informative for the clustering. We also explored all three parameters defined in the gene filter (expression thresholds of rare and ubiquitous genes/transcripts and the percentage X) and found that in general the gene filter did not affect the accuracy of clustering (<xref ref-type="supplementary-material" rid="SD2">Fig. S3c</xref>). However, the gene filter significantly reduced the dimensionality of the data, thereby speeding up the method.</p>
        <p id="P13">For further analysis the filtered expression matrix <bold><italic>M</italic></bold> is log-transformed after adding a pseudo-count of 1: <bold><italic>M</italic>’</bold> = log2(<bold><italic>M</italic></bold> + 1).</p>
      </sec>
      <sec id="S4">
        <label>2</label>
        <title>Distance calculations</title>
        <p id="P14">Distance between the cells, i.e. columns, in <bold><italic>M</italic>’</bold> are calculated using the Euclidean, Pearson and Spearman metrics to construct distance matrices.</p>
        <p id="P15">We investigated the impact of dropouts on distance calculations by considering a modified distance metric that ignores dropouts. This was done by excluding genes that were not expressed in at least one cell from the distance calculation. We found that this did not improve the performance (<xref ref-type="supplementary-material" rid="SD2">Fig. S3d</xref>).</p>
      </sec>
      <sec id="S5">
        <label>3</label>
        <title>Transformations</title>
        <p id="P16">All distance matrices are then transformed using either principal component analysis (PCA) or by calculating the eigenvectors of the associated graph Laplacian (<bold><italic>L</italic></bold> = <bold><italic>I</italic></bold> - <bold><italic>D</italic></bold><sup>-1/2</sup><italic><bold>AD</bold></italic><sup>-1/2</sup>, where <bold><italic>I</italic></bold> is the identity matrix, <bold><italic>A</italic></bold> is a similarity matrix (<bold><italic>A</italic></bold> = exp(-<bold><italic>A’</italic></bold>/max(<bold><italic>A’</italic></bold>))), where <bold><italic>A’</italic></bold> is a distance matrix) and <bold><italic>D</italic></bold> is the degree matrix of <bold><italic>A</italic></bold>, a diagonal matrix which contains the row-sums of <bold><italic>A</italic></bold> on the diagonal (<bold><italic>D<sub>ii</sub> = ∑<sub>j</sub> A<sub>ij</sub></italic></bold>). The columns of the resulting matrices are then sorted in ascending order by their corresponding eigenvalues.</p>
      </sec>
      <sec id="S6">
        <label>4</label>
        <title>k-means</title>
        <p id="P17"><italic>k</italic>-means clustering is performed on the first <italic>d</italic> eigenvectors of the transformed distance matrices (<xref ref-type="fig" rid="F1">Fig. 1a</xref>) by using the default kmeans() R function with the Hartigan and Wong algorithm<xref rid="R21" ref-type="bibr">21</xref>. By default, the maximum number of iterations is set to 10<sup>9</sup> and the number of starts is set to 1,000.</p>
      </sec>
      <sec id="S7">
        <label>5</label>
        <title>Consensus clustering</title>
        <p id="P18">SC3 computes a consensus matrix using the Cluster-based Similarity Partitioning Algorithm (CSPA)<xref rid="R22" ref-type="bibr">22</xref>. For each individual clustering result a binary similarity matrix is constructed from the corresponding cell labels: if two cells belong to the same cluster, their similarity is 1, otherwise the similarity is 0 (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). A consensus matrix is calculated by averaging all similarity matrices of individual clusterings. To reduce computational time, if the length of the <italic>d</italic> range (<italic>D</italic> on <xref ref-type="fig" rid="F1">Fig. 1a</xref>) is more than 15, a random subset of 15 values selected uniformly from the <italic>d</italic> range is used.</p>
        <p id="P19">The resulting consensus matrix is clustered using hierarchical clustering with complete agglomeration and the clusters are inferred at the <italic>k</italic> level of hierarchy, where <italic>k</italic> is defined by a user (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). In principle, the <italic>k</italic> used for the hierarchical clustering need not be the same as the <italic>k</italic> used in step 5. However, for simplicity in SC3 the two parameters are constrained to have the same value.</p>
        <p id="P20"><xref ref-type="fig" rid="F1">Fig. 1d</xref> shows how the quality and the stability of clustering improves after <italic>consensus clustering</italic>.</p>
      </sec>
    </sec>
    <sec id="S8">
      <title>Adjusted Rand Index</title>
      <p id="P21">If cell-labels are available (e.g. from a published dataset) the Adjusted Rand Index (ARI)<xref rid="R23" ref-type="bibr">23</xref> can be used to calculate similarity between the SC3 clustering and the published clustering. ARI is defined as follows. Given a set of <italic>n</italic> elements, and two clusterings of these elements the overlap between the two clusterings can be summarised in a contingency table, where each entry denotes the number of objects in common between the two clusterings. The ARI can then be calculated as: <disp-formula id="FD1"><mml:math display="block" id="M2" overflow="scroll"><mml:mrow><mml:mi>A</mml:mi><mml:mi>R</mml:mi><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula> where <italic>n<sub>ij</sub></italic> are values from the contingency table, <italic>a<sub>i</sub></italic> is the sum of the <italic>i<sup>th</sup></italic> row of the contingency table, <italic>b<sub>j</sub></italic> is the sum of the <italic>j<sup>th</sup></italic> column of the contingency table and ( ) denotes a binomial coefficient.</p>
      <p id="P22">Since the reference labels are known for all published datasets, ARI is used for all comparisons throughout the paper.</p>
    </sec>
    <sec id="S9">
      <title>Downsampling of the gold standard datasets</title>
      <p id="P23">For each gene <italic>i</italic> and each cell <italic>j</italic>, the downsampled expression value was generated by drawing from a binomial distribution with parameters <italic>p</italic> = .1 and <italic>n</italic> = round(<bold><italic>M<sub>ij</sub></italic></bold>).</p>
    </sec>
    <sec id="S10">
      <title>Additional validation of SC3 pipeline</title>
      <p id="P24">Additionally, we investigated the impact of dropouts by considering a modified distance metric that ignores dropouts, but we found that this did not improve the performance (<xref ref-type="supplementary-material" rid="SD2">Fig. S3d</xref>, <xref ref-type="sec" rid="S1">Methods</xref>).</p>
    </sec>
    <sec id="S11">
      <title>Identification of a suitable number of groups <inline-formula><mml:math display="inline" id="M3" overflow="scroll"><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula></title>
      <p id="P25">Matrix <bold><italic>Z</italic></bold> is obtained from <bold><italic>M’</italic></bold> by subtracting the mean and dividing by the standard deviation for each column (z-score). Next, the eigenvalues of <bold><italic>X</italic></bold> =<bold><italic>Z<sup>T</sup></italic></bold>*<bold><italic>Z</italic></bold> are calculated. The number of clusters <inline-formula><mml:math display="inline" id="M4" overflow="scroll"><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> is determined by the number of eigenvalues that are significantly different with a p-value &lt;.001 from the Tracy-Widom distribution<xref rid="R24" ref-type="bibr">24</xref>,<xref rid="R25" ref-type="bibr">25</xref> with mean <inline-formula><mml:math display="inline" id="M5" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msqrt><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msqrt><mml:mo>+</mml:mo><mml:msqrt><mml:mi>p</mml:mi></mml:msqrt><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> and standard deviation <inline-formula><mml:math display="inline" id="M6" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msqrt><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msqrt><mml:mo>+</mml:mo><mml:msqrt><mml:mi>p</mml:mi></mml:msqrt><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msqrt><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msqrt><mml:mi>p</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>3</mml:mn></mml:mfrac></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>n</italic> is the number of genes/transcripts and <italic>p</italic> is the number of cells.</p>
    </sec>
    <sec id="S12">
      <title>Benchmarking</title>
      <p id="P26">For each dataset we used the expression units provided by the authors (<xref ref-type="fig" rid="F1">Fig. 1b</xref>). The gene filter was applied to all the datasets. For tSNE+k-means, SNN-Cliq and pcaReduce the same log-transformation as in SC3 (<bold><italic>M</italic>’</bold> = log2(<bold><italic>M</italic></bold> + 1)) was applied. For SINCERA we used the original z-score normalisation<xref rid="R26" ref-type="bibr">26</xref> instead of the log-transformation. For tSNE the Rtsne R package was used with the default parameters. For SEURAT we used the original Seurat R package (version 1.3): we performed tSNE embedding with the default parameters once (following the authors’ tutorial at <ext-link ext-link-type="uri" xlink:href="http://www.satijalab.org/clustertutorial1.html">http://www.satijalab.org/clustertutorial1.html</ext-link>) and then clustered the data using DBSCAN algorithm multiple times, where we varied the density parameter <italic>G</italic> in the range 10<sup>-3</sup>-10<sup>3</sup> to find a maximal ARI (this ARI is presented in <xref ref-type="fig" rid="F2">Fig. 2a</xref>). SEURAT was not able to find more than one cluster for the smallest datasets (Biase, Yan, Goolam, Treutlein and Ting) leading to very small ARI scores. For all methods we supplied the <italic>k</italic> used by the original authors.</p>
    </sec>
    <sec id="S13">
      <title>Cluster stability</title>
      <p id="P27">We calculated stability of clustering solutions by running each method 100 times and finding the most frequent solution and the number of times (<italic>N<sub>c</sub></italic>) it appeared. The stability measure shown in <xref ref-type="fig" rid="F2">Fig. 2b</xref> is then calculated as <italic>N<sub>c</sub></italic>/100.</p>
    </sec>
    <sec id="S14">
      <title>Support Vector Machines (SVM)</title>
      <p id="P28">When using SVM a specific fraction of the cells is selected at random with uniform probability. Next, a support vector machine<xref rid="R27" ref-type="bibr">27</xref> model with a linear kernel is constructed based on the obtained clustering. We used the <italic>svm</italic> function of the <italic>e1071</italic> R-package with default parameters. The cluster IDs for the remaining cells are then predicted by the SVM model.</p>
    </sec>
    <sec id="S15">
      <title>Identification of rare cell-types</title>
      <p id="P29">To specifically evaluate the sensitivity of SC3 for identifying rare cell-types, we carried out a synthetic experiment, whereby cells from one cell-type were removed iteratively from the Kolodziejczyk and Pollen datasets. For the Pollen dataset, all but 1-7 of the cells in one of the 11 clusters were removed. The limit of 7 cells corresponds to the size of the smallest cluster in the original data. Subsequently, SC3 was run using <italic>k</italic>=11, and we asked whether or not the cells of the rare cell-type were located in a separate cluster. This was repeated 100 times for each cell-type and <xref ref-type="supplementary-material" rid="SD2">Fig. S4d</xref> reports the percentage of runs when the rare cells were found together in a cluster with no other cells. Note that the ARI is a poor indicator of the ability to identify rare cells since this measure is relatively insensitive to the behavior of a small fraction of the cells. For the Kolodziejczyk dataset, we used a similar strategy, but we allowed for 1-101 cells in the rare group. For the Pollen dataset, SC3 can detect clusters containing ~1% of the cells, whereas for the Kolodziejczyk dataset ~10% of the cells are required (<xref ref-type="supplementary-material" rid="SD2">Fig. S4d</xref>). We hypothesize that the ability to identify rare cells reflects the origins of the two datasets; the Pollen data is more diverse as it represents 11 different cell lines while the Kolodziejczyk data comes from one cell-type grown in three different conditions.</p>
      <p id="P30">For the hybrid SC3 approach with 30% of cells used to train the SVM we were able to calculate the probability of including the rare cell-types in the training set analytically by multiplying the data from <xref ref-type="supplementary-material" rid="SD2">Fig. S4d</xref> by the probability of all rare cells to be included in the drawn sample (30% of all cells). This probability was calculated using the hypergeometric distribution R function: <italic>phyper(n.rare.cells - 1, n.rare.cells, n.other.cells, 0.3*(n.other.cells + n.rare.cells), lower.tail=F)</italic>, where <italic>n.rare.cells</italic> is the number of rare cells and <italic>n.other.cells</italic> is the number of other cells in the dataset (<xref ref-type="supplementary-material" rid="SD2">Fig. S4e</xref>).</p>
    </sec>
    <sec id="S16">
      <title>Biological insights</title>
      <p id="P31">SC3 can identify differentially expressed genes as genes that vary between two or more clusters. Accordingly, marker genes are identified as genes that are highly expressed in only one of the clusters and are able to distinguish one cluster from all the remaining ones (<xref ref-type="supplementary-material" rid="SD2">Fig. S6a</xref>). Cell outliers are identified through the calculation of a score for each cell using the Minimum Covariance Determinant<xref rid="R28" ref-type="bibr">28</xref>. Cells that fit well into their clusters receive an outlier score of 0, whereas high values indicate that the cell should be considered an outlier.</p>
      <sec id="S17">
        <title>Identification of differential expression</title>
        <p id="P32">Differential expression is calculated using the non-parametric Kruskal-Wallis test, an extension of the Mann-Whitney test for the scenario when there are more than two groups. The Kruskal-Wallis test has the advantage of being non-parametric, but as a consequence, it is not well suited for situations where many genes have the same expression value. A significant <italic>p</italic>-value indicates that gene expression in at least one cluster stochastically dominates one other cluster. SC3 provides a list of all differentially expressed genes with <italic>p</italic>-values&lt;0.01, corrected for multiple testing (using the default “holm” method of p.adjust() R function) and plots gene expression profiles of the 50 most significant differentially expressed genes. Note that the calculation of differential expression after clustering can introduce a bias in the distribution of <italic>p</italic>-values, and thus we advise to use the <italic>p</italic>-values for ranking the genes only.</p>
      </sec>
      <sec id="S18">
        <title>Identification of marker genes</title>
        <p id="P33">For each gene a binary classifier is constructed based on the mean cluster expression values. The area under the receiver operating characteristic (ROC) curve is used to quantify the accuracy of the prediction. A <italic>p</italic>-value is assigned to each gene by using the Wilcoxon signed rank test comparing gene ranks in the cluster with the highest mean expression with all others (<italic>p</italic>-values are adjusted by using the default “holm” method of p.adjust() R function). The genes with the area under the ROC curve (AUROC) &gt;0.85 and with the <italic>p</italic>-value&lt;0.01 are defined as marker genes. The AUROC threshold corresponds to the 99% quantile of the AUROC distributions obtained from 100 random permutations of cluster labels for all datasets (<xref ref-type="supplementary-material" rid="SD3">Table S2</xref> and <xref ref-type="supplementary-material" rid="SD2">Fig. S6b</xref>). SC3 provides a visualization of the gene expression profiles for the top 10 marker genes of each obtained cluster.</p>
      </sec>
      <sec id="S19">
        <title>Cell outlier detection</title>
        <p id="P34">Outlier cells are detected by first taking an expression matrix of each individual cluster (all cells with the same labels) and reducing its dimensionality using the robust method for PCA (ROBPCA)<xref rid="R29" ref-type="bibr">29</xref>. This method outputs a matrix with <italic>N</italic> rows (number of cells in the cluster) and <italic>P</italic> columns (retained number of principal components after running ROBPCA). SC3 then uses <italic>p=</italic>min(<italic>P</italic>, 3) first principal components for further analysis. If ROBPCA fails to perform or <italic>P</italic>=0, SC3 shows a warning message. We found (results not shown) that this usually happens when the distribution of gene expression in cells is too skewed towards 0. Second, robust distances (Mahalanobis) between the cells in each cluster are calculated from the reduced expression matrix using the minimum covariance determinant (MCD)<xref rid="R28" ref-type="bibr">28</xref>. We then used a threshold based on the <italic>Q</italic>% quantile of the chi-squared distribution (with <italic>p</italic> degrees of freedom) to define outliers. By default <italic>Q</italic>=99.99, but it can be manually adjusted by a user. Finally, we define an outlier score as the difference between the square root of the robust distance and the square root of the <italic>Q</italic>% quantile of the chi-squared distribution (with <italic>p</italic> degrees of freedom). The outlier score is plotted as a barplot (<xref ref-type="supplementary-material" rid="SD2">Fig. S6c</xref>).</p>
      </sec>
    </sec>
    <sec id="S20">
      <title>Gene and Pathway enrichment analysis</title>
      <p id="P35">We utilized g:Profiler web tool<xref rid="R30" ref-type="bibr">30</xref> to perform gene and pathway enrichment analysis in all obtained sets of genes.</p>
    </sec>
    <sec id="S21">
      <title>Analysis of the Macosko dataset</title>
      <p id="P36">To analyze the Drop-Seq dataset we followed the procedure used by Macosko et al and selected the 11,040 cells where more than 900 genes were expressed. Moreover, due to the low read depth, the gene filter was removed. We then sampled 5,000 cells and clustered using SC3, including the SVM step, 100 times. All 100 solutions were consistent between each other resulting in an average ARI of 0.58 and they were sufficiently accurate compared to the reference authors’ clustering yielding an average ARI of 0.54 (<xref ref-type="supplementary-material" rid="SD2">Fig. S5a</xref>). Since each of the 100 solutions were different, we added an additional consensus clustering step using the “best of k” consensus algorithm<xref rid="R31" ref-type="bibr">31</xref>. This approach provided a single solution based on the 100 different solutions and it was as accurate as the individual solutions with an ARI of 0.52 (the actual labels are presented in <xref ref-type="supplementary-material" rid="SD3">Table S1</xref>). The SC3 consensus solution splits the large original cluster (cluster 24 with 29,400 cells) hierarchically into 2 clusters of smaller sizes (18105 + 10558 = 28663 cells, clusters 4 and 8 in <xref ref-type="supplementary-material" rid="SD2">Fig. S5b</xref>). Additional gene and pathway enrichment analysis for the differentially expressed genes between the two clusters is presented in <xref ref-type="supplementary-material" rid="SD3">Table S1</xref>. If more than 75% of the cells from the reference cluster are shared with the SC3 cluster we defined these two clusters as matched. In total 31 reference clusters were matched to the SC3 clusters.</p>
    </sec>
    <sec sec-type="subjects" id="S22">
      <title>Patients</title>
      <p id="P37">Both patients provided written informed consent. Diagnoses were made in accordance with the guidelines of the British Committee for Standards in Haematology.</p>
      <sec id="S23">
        <title>Isolation of haematopoietic stem and progenitor cells</title>
        <p id="P38">Cell populations were derived from peripheral blood enriched for haematopoietic stem and progenitor cells (CD34+, CD38-, CD45RA-, CD90+), hereafter referred to as HSCs. For single cell cultures, individual HSCs were sorted into 96-well plates (<xref ref-type="supplementary-material" rid="SD2">Fig. S7a-b</xref>) and grown in a cytokine cocktail designed to promote progenitor expansion as previously described<xref rid="R32" ref-type="bibr">32</xref>. For scRNA-seq studies, single HSCs were directly sorted into lysis buffer as described in Picelli et al<xref rid="R33" ref-type="bibr">33</xref>.</p>
      </sec>
      <sec id="S24">
        <title>Determination of mutation load</title>
        <p id="P39">Colonies of granulocyte/macrophage composition were picked and DNA isolated for Sanger sequencing for JAK2V617F and TET2 mutations as previously described by Ortmann <italic>et al</italic><xref rid="R34" ref-type="bibr">34</xref>.</p>
      </sec>
      <sec id="S25">
        <title>Single cell RNA-Sequencing</title>
        <p id="P40">Single HSCs were sorted into 96-well plates and cDNA generated as described previously<xref rid="R33" ref-type="bibr">33</xref>. The Nextera XT library making kit was used for library generation as described by Picelli <italic>et al</italic><xref rid="R33" ref-type="bibr">33</xref>.</p>
      </sec>
      <sec id="S26">
        <title>Processing of scRNA-seq data from HSCs</title>
        <p id="P41">96 single cell samples per patient with 2 sequencing lanes per sample were sequenced yielding a variable number of reads (<italic>mean</italic> = 2,180,357, <italic>std dev</italic> = 1,342,541). FastQC<xref rid="R35" ref-type="bibr">35</xref> was used to assess the sequence quality. Foreign sequences from the Nextera Transposase agent were discovered and subsequently removed with Trimmomatic<xref rid="R36" ref-type="bibr">36</xref> using the parameters HEADCROP:19 ILLUMINACLIP:NexteraPE-PE.fa:2:30:10 TRAILING:28 CROP:90 MINLEN:60 to trim the reads to 90 bases before being mapped with TopHat<xref rid="R37" ref-type="bibr">37</xref> to the Ensembl reference genome version GRCh38.77 augmented with the spike-in controls downloaded from the ERCC consortium. Counts of uniquely mapped reads in each protein coding gene and each ERCC spike-in were calculated using SeqMonk (<ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.bbsrc.ac.uk/projects/seqmonk">http://www.bioinformatics.bbsrc.ac.uk/projects/seqmonk</ext-link>) and were used for further downstream analysis. Quality control of the cells contained two steps: 1. filtering of cells based on the number of expressed genes; 2. filtering of cells based on the ratio of the total number of ERCC spike-in reads to the total number of reads in protein coding genes. Filtering threshold were manually chosen by visual exploration of the quality control features (<xref ref-type="supplementary-material" rid="SD2">Fig. S8</xref>). After filtering, 51 and 89 cells were retained from patient 1 and patient 2, correspondingly. The expression values in each dataset were then normalised by first using a size-factor normalisation (from DESeq2 package<xref rid="R38" ref-type="bibr">38</xref>) to account for sequencing depth variability. Secondly, to account for technical variability, a normalisation based on ERCC spike-ins was performed using the RUVSeq package<xref rid="R39" ref-type="bibr">39</xref> (RUVg() function with parameter k=1). For combined patient data, normalisation steps were performed after pooling the cells. The resulting filtered and normalised datasets were clustered by SC3. Potential biases of cell filtering on the proportions of cells in the clusters of patient 1 are considered in the <xref ref-type="supplementary-material" rid="SD1">Supplementary Data 1</xref>. It shows that the cluster of lower cell quality is separated from the other biologically meaningful clusters of patient 1 and it does not change the total proportion of the biologically meaningful clusters. <xref ref-type="supplementary-material" rid="SD1">Supplementary Data 2</xref> shows that SC3 results of clustering of patient 1 do not depend on the normalization procedure.</p>
      </sec>
      <sec id="S27">
        <title>Clustering of patient scRNA-seq data by SC3</title>
        <p id="P42">We clustered scRNA-seq data from patient 1 and patient 2 separately as well as a combined dataset containing data from patient 1 + patient 2. For patient 1, in agreement with the RMT algorithm, the best clustering was achieved for <italic>k</italic>=3 (<xref ref-type="supplementary-material" rid="SD2">Fig. S9</xref>). Data from patient 2 was homogeneous and SC3 was unable to identify more than one meaningful cluster (<xref ref-type="supplementary-material" rid="SD2">Fig. S10</xref>), again in agreement with the RMT algorithm. For the combined dataset for patient 1 + patient 2 the best values of the silhouette index were obtained when <italic>k</italic> was 2 or 3 (<xref ref-type="supplementary-material" rid="SD2">Fig. S11</xref>). In both cases all of the cells from cluster 1 in patient 1 were grouped with the cells from patient 2. For <italic>k</italic>=3 clusters 1 and 3 of patient 1 were also resolved. The RMT algorithm also provided <italic>k</italic>=3 for the merged patient 1 + patient 2 dataset.</p>
      </sec>
      <sec id="S28">
        <title>Comparison of clustering of patient 1 scRNA-seq data</title>
        <p id="P43">Results of the clustering of the patient 1 data by other methods and their comparison to SC3 is presented in the <xref ref-type="supplementary-material" rid="SD1">Supplementary Data 3 and 4</xref>.</p>
      </sec>
      <sec id="S29">
        <title>Identification of differentially expressed genes from microarray data</title>
        <p id="P44">The microarray data of patient 1 was obtained from Array Express accession number E-MTAB-3086<xref rid="R34" ref-type="bibr">34</xref>. One replicate (2B) was identified as an outlier and removed. The limma R package<xref rid="R40" ref-type="bibr">40</xref> was used to identify 932 differentially expressed genes between WT and TET2/JAK2V617F double mutant using an adjusted (by false discovery rate) p-value threshold of 0.1.</p>
      </sec>
      <sec id="S30">
        <title>Marker genes analysis for patients</title>
        <p id="P45">For both patients, to increase the number of marker genes, the AUROC threshold was set to 0.7 instead of the default value of 0.85 and the 0.1 <italic>p</italic>-value threshold was chosen.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Supplementary Data</label>
      <media xlink:href="NIHMS71741-supplement-Supplementary_Data.zip" mimetype="application" mime-subtype="zip" orientation="portrait" xlink:type="simple" id="d36e1607" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Supplementary Figures</label>
      <media xlink:href="NIHMS71741-supplement-Supplementary_Figures.docx" mimetype="application" mime-subtype="octet-stream" orientation="portrait" xlink:type="simple" id="d36e1611" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Supplementary Results</label>
      <media xlink:href="NIHMS71741-supplement-Supplementary_Results.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" xlink:type="simple" id="d36e1615" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>Supplementary Software 1</label>
      <media xlink:href="NIHMS71741-supplement-Supplementary_Software_1.zip" mimetype="application" mime-subtype="zip" orientation="portrait" xlink:type="simple" id="d36e1619" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S31">
    <title>Acknowledgements</title>
    <p>We would like to thank B. Vangelov, J.-C. Delvenne and R. Lambiotte for fruitful discussions and their help with computational methods. We would also like to thank D. Flores Santa Cruz, D. Dimitropolou and J. Grinfeld for technical assistance with experiments. We thank I. Vasquez-Garcia, D. Harmin, M. Kosicki, D. Ramsköld and M. Huch for helpful comments on the manuscript.</p>
    <p>
      <bold>Funding</bold>
    </p>
    <p>V.K., T.A., A.Y. and M.H. are supported by Wellcome Trust Grant. K.N.N is supported by Wellcome Trust Strategic Award “Single cell genomics of mouse gastrulation”. M.T.S acknowledges support from: FRS-FNRS; the Belgian Network DYSCO (Dynamical Systems, Control and Optimisation) funded by the Interuniversity Attraction Poles Programme initiated by the Belgian State Science Policy Office; and the ARC (Action de Recherche Concerte) on Mining and Optimization of Big Data Models funded by the Wallonia-Brussels Federation. M.B. acknowledges support from EPSRC (grant EP/N014529/1). T.C. was funded through a core funded fellowship by the Sanger Institute and a Chancellor's fellowship from the University of Edinburgh. K.K. and A.G. are supported by Bloodwise (grant ref. 13003), the Wellcome Trust (grant ref. 104710/Z/14/Z), the Medical Research Council, the Kay Kendall Leukaemia Fund, the Cambridge NIHR Biomedical Research Center, the Cambridge Experimental Cancer Medicine Centre, the Leukemia and Lymphoma Society of America (grant ref. 07037), and a core support grant from the Wellcome Trust and MRC to the Wellcome Trust-Medical Research Council Cambridge Stem Cell Institute.</p>
  </ack>
  <fn-group>
    <fn id="FN1">
      <label>*</label>
      <p id="P46">Full references to the datasets can be found in the <xref ref-type="supplementary-material" rid="SD3">Supplementary Results</xref></p>
    </fn>
    <fn id="FN2">
      <p id="P47">
        <bold>Data Availability</bold>
      </p>
      <p id="P48">All datasets (in <xref ref-type="fig" rid="F1">Fig. 1b</xref> and Macosko dataset) were acquired from the accessions provided in the original publications. According to the authors, the Pollen dataset contains two distinct hierarchies and the cells can be grouped either into 4 or 11 clusters, and the Usoskin dataset contains three hierarchies and the cells can be grouped either into 4, 8 or 11 clusters. scRNA-seq data for patient 1 and 2 is available from GEO accession <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE79102">GSE79102</ext-link>.</p>
    </fn>
    <fn id="FN3">
      <p id="P49">
        <bold>Software availability</bold>
      </p>
      <p id="P50">SC3 is available as a R package at <ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/SC3/">http://bioconductor.org/packages/SC3/</ext-link>.</p>
      <p id="P51">Scripts for figures generation are available at <ext-link ext-link-type="uri" xlink:href="http://github.com/hemberg-lab/SC3-paper-figures">http://github.com/hemberg-lab/SC3-paper-figures</ext-link></p>
      <p id="P52">At the time of writing the manuscript the following old versions of some of the tools were used (these tools have been updated/upgraded since then): <list list-type="order" id="L1"><list-item><p id="P53">SC3 (1.1.2 &lt;= Version &lt; 1.1.5). These versions of SC3 can be installed: <list list-type="bullet" id="L2"><list-item><p id="P54">from source/binary files from Bioconductor <ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/3.3/bioc/html/SC3.html">http://bioconductor.org/packages/3.3/bioc/html/SC3.html</ext-link></p></list-item><list-item><p id="P55">from Github using commands:</p><p id="P56">install.packages("devtools")</p><p id="P57">devtools::install_github("hemberg-lab/SC3", ref = "8a86b60463")</p></list-item></list>
</p><p id="P58">SC3 v.1.1.2 source and DESCRIPTION files can be found in <xref ref-type="supplementary-material" rid="SD4">Supplementary Software 1</xref>.</p><p id="P59">In the newer versions the main SC3 pipeline has not been changed.</p></list-item><list-item><p id="P60">SEURAT (version 1.3) - can be installed from GitHub:</p><p id="P61">install.packages("devtools")</p><p id="P62">devtools::install_github('satijalab/seurat', ref = 'da6cd08')</p><p id="P63">In the newer versions of SEURAT a different algorithm is used for clustering.</p></list-item></list>
</p>
    </fn>
    <fn fn-type="con" id="FN4">
      <p id="P64">
        <bold>Contributions</bold>
      </p>
      <p id="P65">M.H. conceived the study; V.Y.K., M.H., M.T.S., M.B., T.A. and A.Y. contributed to the computational framework; K.K. and T.C. performed the experiments for the patient data; K.N.N. helped with the analysis of embryonic mouse data; M.B., W.R., A.R.G. and M.H. supervised the research; V.Y.K. and M.H. led the writing of the manuscript with input from the other authors.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN5">
      <p id="P66">
        <bold>Competing Financial Interests</bold>
      </p>
      <p id="P67">No competing financial interests.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell messenger RNA sequencing reveals rare intestinal cell types</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>525</volume>
        <fpage>251</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="pmid">26287467</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jaitin</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>343</volume>
        <fpage>776</fpage>
        <lpage>779</lpage>
        <pub-id pub-id-type="pmid">24531970</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mahata</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA sequencing reveals T helper cells synthesizing steroids de novo to contribute to immune homeostasis</article-title>
        <source>Cell Rep</source>
        <year>2014</year>
        <volume>7</volume>
        <fpage>1130</fpage>
        <lpage>1142</lpage>
        <pub-id pub-id-type="pmid">24813893</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gentleman</surname>
            <given-names>RC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bioconductor: open software development for computational biology and bioinformatics</article-title>
        <source>Genome Biol</source>
        <year>2004</year>
        <volume>5</volume>
        <fpage>R80</fpage>
        <pub-id pub-id-type="pmid">15461798</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw777</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing Data using t-SNE</article-title>
        <source>J Mach Learn Res</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zurauskiene</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Yau</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>pcaReduce: Hierarchical Clustering of Single Cell Transcriptional Profiles</article-title>
        <source>bioRxiv</source>
        <year>2015</year>
        <fpage>026385</fpage>
        <pub-id pub-id-type="doi">10.1101/026385</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Identification of cell types from single-cell transcriptomes using a novel clustering method</article-title>
        <source>Bioinformatics</source>
        <year>2015</year>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btv088</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Potter</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Whitsett</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>SINCERA: A Pipeline for Single-Cell RNA-Seq Profiling Analysis</article-title>
        <source>PLoS Comput Biol</source>
        <year>2015</year>
        <volume>11</volume>
        <fpage>e1004575</fpage>
        <pub-id pub-id-type="pmid">26600239</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>161</volume>
        <fpage>1202</fpage>
        <lpage>1214</lpage>
        <pub-id pub-id-type="pmid">26000488</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Pinello</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G-C</given-names>
          </name>
        </person-group>
        <article-title>GiniClust: detecting rare cell types from single-cell gene expression data with Gini index</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>144</fpage>
        <pub-id pub-id-type="pmid">27368803</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Population structure and eigenanalysis</article-title>
        <source>PLoS Genet</source>
        <year>2006</year>
        <volume>2</volume>
        <fpage>e190</fpage>
        <pub-id pub-id-type="pmid">17194218</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tracy</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Widom</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Level-spacing distributions and the Airy kernel</article-title>
        <source>Commun Math Phys</source>
        <year>1994</year>
        <volume>159</volume>
        <fpage>151</fpage>
        <lpage>174</lpage>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rousseeuw</surname>
            <given-names>PJ</given-names>
          </name>
        </person-group>
        <article-title>Silhouettes: A graphical aid to the interpretation and validation of cluster analysis</article-title>
        <source>J Comput Appl Math</source>
        <year>1987</year>
        <volume>20</volume>
        <fpage>53</fpage>
        <lpage>65</lpage>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Deng</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Ramsköld</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Reinius</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Sandberg</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq reveals dynamic, random monoallelic gene expression in mammalian cells</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>343</volume>
        <fpage>193</fpage>
        <lpage>196</lpage>
        <pub-id pub-id-type="pmid">24408435</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guo</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Resolution of cell fate decisions revealed by single-cell gene expression analysis from zygote to blastocyst</article-title>
        <source>Dev Cell</source>
        <year>2010</year>
        <volume>18</volume>
        <fpage>675</fpage>
        <lpage>685</lpage>
        <pub-id pub-id-type="pmid">20412781</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boroviak</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lineage-Specific Profiling Delineates the Emergence and Progression of Naive Pluripotency in Mammalian Embryogenesis</article-title>
        <source>Dev Cell</source>
        <year>2015</year>
        <volume>35</volume>
        <fpage>366</fpage>
        <lpage>382</lpage>
        <pub-id pub-id-type="pmid">26555056</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Staudt</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>AR</given-names>
          </name>
        </person-group>
        <article-title>Janus kinase deregulation in leukemia and lymphoma</article-title>
        <source>Immunity</source>
        <year>2012</year>
        <volume>36</volume>
        <fpage>529</fpage>
        <lpage>541</lpage>
        <pub-id pub-id-type="pmid">22520846</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ortmann</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Effect of mutation order on myeloproliferative neoplasms</article-title>
        <source>N Engl J Med</source>
        <year>2015</year>
        <volume>372</volume>
        <fpage>601</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="pmid">25671252</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nangalia</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Somatic CALR mutations in myeloproliferative neoplasms with nonmutated JAK2</article-title>
        <source>N Engl J Med</source>
        <year>2013</year>
        <volume>369</volume>
        <fpage>2391</fpage>
        <lpage>2405</lpage>
        <pub-id pub-id-type="pmid">24325359</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hartigan</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>Algorithm AS 136: A K-Means Clustering Algorithm</article-title>
        <source>J R Stat Soc Ser C Appl Stat</source>
        <year>1979</year>
        <volume>28</volume>
        <fpage>100</fpage>
        <lpage>108</lpage>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Strehl</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ghosh</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Cluster Ensembles --- a Knowledge Reuse Framework for Combining Multiple Partitions</article-title>
        <source>J Mach Learn Res</source>
        <year>2003</year>
        <volume>3</volume>
        <fpage>583</fpage>
        <lpage>617</lpage>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arabie</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Comparing partitions</article-title>
        <source>J Classification</source>
        <year>1985</year>
        <volume>2</volume>
        <fpage>193</fpage>
        <lpage>218</lpage>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tracy</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Widom</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Level-spacing distributions and the Airy kernel</article-title>
        <source>Commun Math Phys</source>
        <year>1994</year>
        <volume>159</volume>
        <fpage>151</fpage>
        <lpage>174</lpage>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Population structure and eigenanalysis</article-title>
        <source>PLoS Genet</source>
        <year>2006</year>
        <volume>2</volume>
        <fpage>e190</fpage>
        <pub-id pub-id-type="pmid">17194218</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Potter</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Whitsett</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>SINCERA: A Pipeline for Single-Cell RNA-Seq Profiling Analysis</article-title>
        <source>PLoS Comput Biol</source>
        <year>2015</year>
        <volume>11</volume>
        <fpage>e1004575</fpage>
        <pub-id pub-id-type="pmid">26600239</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ben-Hur</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Horn</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Siegelmann</surname>
            <given-names>HT</given-names>
          </name>
          <name>
            <surname>Vapnik</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Support Vector Clustering</article-title>
        <source>J Mach Learn Res</source>
        <year>2002</year>
        <volume>2</volume>
        <fpage>125</fpage>
        <lpage>137</lpage>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Debruyne</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Minimum covariance determinant</article-title>
        <source>WIREs Comp Stat</source>
        <year>2010</year>
        <volume>2</volume>
        <fpage>36</fpage>
        <lpage>43</lpage>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hubert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rousseeuw</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Branden</surname>
            <given-names>KV</given-names>
          </name>
        </person-group>
        <article-title>ROBPCA: A New Approach to Robust Principal Component Analysis</article-title>
        <source>Technometrics</source>
        <year>2005</year>
        <volume>47</volume>
        <fpage>64</fpage>
        <lpage>79</lpage>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reimand</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>g:Profiler-a web server for functional interpretation of gene lists (2016 update)</article-title>
        <source>Nucleic Acids Res</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>W83</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="pmid">27098042</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Goder</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Filkov</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Consensus Clustering Algorithms: Comparison and Refinement</article-title>
        <conf-name>Proceedings of the Meeting on Algorithm Engineering &amp; Expermiments</conf-name>
        <publisher-name>Society for Industrial and Applied Mathematics</publisher-name>
        <year>2008</year>
        <fpage>109</fpage>
        <lpage>117</lpage>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Petzer</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Zandstra</surname>
            <given-names>PW</given-names>
          </name>
          <name>
            <surname>Piret</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Eaves</surname>
            <given-names>CJ</given-names>
          </name>
        </person-group>
        <article-title>Differential cytokine effects on primitive (CD34+CD38-) human hematopoietic cells: novel responses to Flt3-ligand and thrombopoietin</article-title>
        <source>J Exp Med</source>
        <year>1996</year>
        <volume>183</volume>
        <fpage>2551</fpage>
        <lpage>2558</lpage>
        <pub-id pub-id-type="pmid">8676076</pub-id>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Picelli</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Full-length RNA-seq from single cells using Smart-seq2</article-title>
        <source>Nat Protoc</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>171</fpage>
        <lpage>181</lpage>
        <pub-id pub-id-type="pmid">24385147</pub-id>
      </element-citation>
    </ref>
    <ref id="R34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ortmann</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Effect of mutation order on myeloproliferative neoplasms</article-title>
        <source>N Engl J Med</source>
        <year>2015</year>
        <volume>372</volume>
        <fpage>601</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="pmid">25671252</pub-id>
      </element-citation>
    </ref>
    <ref id="R35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andrews</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>FastQC: A quality control tool for high throughput sequence data</article-title>
        <source>Reference Source</source>
        <year>2010</year>
      </element-citation>
    </ref>
    <ref id="R36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bolger</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Lohse</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Usadel</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Trimmomatic: a flexible trimmer for Illumina sequence data</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <fpage>2114</fpage>
        <lpage>2120</lpage>
        <pub-id pub-id-type="pmid">24695404</pub-id>
      </element-citation>
    </ref>
    <ref id="R37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>TopHat: discovering splice junctions with RNA-Seq</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1105</fpage>
        <lpage>1111</lpage>
        <pub-id pub-id-type="pmid">19289445</pub-id>
      </element-citation>
    </ref>
    <ref id="R38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Love</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Anders</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>
        <source>Genome Biol</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>550</fpage>
        <pub-id pub-id-type="pmid">25516281</pub-id>
      </element-citation>
    </ref>
    <ref id="R39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Risso</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Ngai</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Speed</surname>
            <given-names>TP</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Normalization of RNA-seq data using factor analysis of control genes or samples</article-title>
        <source>Nat Biotechnol</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>896</fpage>
        <lpage>902</lpage>
        <pub-id pub-id-type="pmid">25150836</pub-id>
      </element-citation>
    </ref>
    <ref id="R40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ritchie</surname>
            <given-names>ME</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title>
        <source>Nucleic Acids Res</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>e47</fpage>
        <pub-id pub-id-type="pmid">25605792</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>The SC3 framework for consensus clustering.</title>
      <p>(<bold>a</bold>) Overview of clustering with SC3 framework (see <xref ref-type="sec" rid="S1">Methods</xref>). The consensus step is exemplified using the Treutlein data. (<bold>b</bold>) Published datasets used to set SC3 parameters. <italic>N</italic> is the number of cells in a dataset; <italic>k</italic> is the number of clusters originally identified by the authors; Units: RPKM is Reads Per Kilobase of transcript per Million mapped reads, RPM is Reads Per Million mapped reads, FPKM is Fragments Per Kilobase of transcript per Million mapped reads, TPM is Transcripts Per Million mapped reads. (<bold>c</bold>) Histogram of the <italic>d</italic> values where ARI&gt;.95 is achieved for the gold standard datasets. The black vertical lines indicate the interval <italic>d</italic> = 4-7% of the total number of cells <italic>N,</italic> showing high accuracy in the classification. (<bold>d</bold>) 100 realizations of the SC3 clustering of the datasets shown in (<bold>b</bold>). Dots represent individual clustering runs. Bars correspond to the median of the dots. Red and grey colours correspond to clustering with and without consensus step. The black line corresponds to ARI=0.8. The dashed black line separates gold and silver standard datasets.</p>
    </caption>
    <graphic xlink:href="emss-71741-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Benchmarking of SC3 against existing methods.</title>
      <p>(<bold>a</bold>) SC3, tSNE+kmeans and pcaReduce were applied 100 times to each dataset. SNN-Cliq and SINCERA are deterministic and were run only once. SEURAT was also run once, however was optimised over different values of the density parameter <italic>G</italic> (<xref ref-type="sec" rid="S1">Methods</xref>). Each panel shows the ARI (black dots, <xref ref-type="sec" rid="S1">Methods</xref>) between the inferred clusterings and the reference labels. Bars correspond to the median of the dots. For the Pollen and Usoskin datasets all different hierarchies were considered (<xref ref-type="fn" rid="FN2">Data Avaialbility</xref>). The black line indicates ARI = 0.8. The dashed black line separates gold and silver standard datasets. (<bold>b</bold>) Number of clusters <inline-formula><mml:math display="inline" id="M7" overflow="scroll"><mml:mover accent="true"><mml:mi>k</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> predicted by SC3, SINCERA and SNN-Cliq for all datasets. Ref is the reference clustering reported by the authors. <bold>(c)</bold> The performance of the hybrid SC3 (<xref ref-type="sec" rid="S1">Methods</xref>). Dots represent outliers higher (lower) than the highest (lowest) value within 1.5 x IQR, where IQR is the interquartile range. The black line indicates ARI = 0.8. The dashed black line in the legend separates gold and silver standard datasets. (<bold>d</bold>) The consensus matrix as generated by SC3 for the Deng dataset (<xref ref-type="sec" rid="S1">Methods</xref>). The matrix indicates how often each pair of cells was assigned to the same cluster by the different parameter combinations as indicated by the colorbar (1 - always, 0 - never). SC3 finds a clustering with <italic>k</italic> = 10 clusters, separated by the white lines as visual guides. The colors at the top represent the reference labels, corresponding to different stages of development (see colour guide).</p>
    </caption>
    <graphic xlink:href="emss-71741-f002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title>Using SC3 to define subclones from two patients with myeloproliferative neoplasm.</title>
      <p>Marker gene expression matrix (after Gene Filter and Log-transformation, <xref ref-type="sec" rid="S1">Methods</xref>) of the combined dataset (patient 1 + patient 2). Clusters (separated by white vertical lines) correspond to <italic>k</italic> = 3 (<xref ref-type="sec" rid="S1">Methods</xref>). Only the top 10 marker genes are shown for each cluster.</p>
    </caption>
    <graphic xlink:href="emss-71741-f003"/>
  </fig>
</floats-group>
