<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4601135</article-id>
    <article-id pub-id-type="publisher-id">776</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-015-0776-0</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Schmutzi: estimation of contamination and endogenous mitochondrial consensus calling for ancient DNA</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Renaud</surname>
          <given-names>Gabriel</given-names>
        </name>
        <address>
          <email>gabriel.reno@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Slon</surname>
          <given-names>Viviane</given-names>
        </name>
        <address>
          <email>viviane_slon@eva.mpg.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Duggan</surname>
          <given-names>Ana T.</given-names>
        </name>
        <address>
          <email>duggana@mcmaster.ca</email>
        </address>
        <xref ref-type="aff" rid="Aff2"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <address>
          <email>janet_kelso@eva.mpg.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <aff id="Aff1"><label/>Max Planck Institute for Evolutionary Anthropology, Deutscher Platz 6, Leipzig, Germany </aff>
      <aff id="Aff2"><label/>McMaster Ancient DNA Centre, Department of Anthropology, McMaster University, 1280 Main St West, Hamilton, ON, L8S 4L9 Canada </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>10</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>10</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2015</year>
    </pub-date>
    <volume>16</volume>
    <elocation-id>224</elocation-id>
    <history>
      <date date-type="received">
        <day>9</day>
        <month>6</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>9</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Renaud et al. 2015</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p>Ancient DNA is typically highly degraded with appreciable cytosine deamination, and contamination with present-day DNA often complicates the identification of endogenous molecules. Together, these factors impede accurate assembly of the endogenous ancient mitochondrial genome. We present schmutzi, an iterative approach to jointly estimate present-day human contamination in ancient human DNA datasets and reconstruct the endogenous mitochondrial genome. By using sequence deamination patterns and fragment length distributions, schmutzi accurately reconstructs the endogenous mitochondrial genome sequence even when contamination exceeds 50 %. Given sufficient coverage, schmutzi also produces reliable estimates of contamination across a range of contamination rates. Availability: <ext-link ext-link-type="uri" xlink:href="https://bioinf.eva.mpg.de/schmutzi/">https://bioinf.eva.mpg.de/schmutzi/</ext-link>
license:GPLv3.</p>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (doi:10.1186/s13059-015-0776-0) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2015</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p>Advances in sequencing and improved methods for the extraction of ancient DNA (aDNA) have enabled the study of ancient genomes. However, many computational hurdles remain in the analysis of aDNA. After the death of an organism, the endogenous DNA begins to degrade and accumulates chemical damage. aDNA molecules, therefore, tend to be quite short, typically less than 60 bases in length [<xref ref-type="bibr" rid="CR1">1</xref>], and carry uracils as a result of cytosine deamination. Deaminated cytosines are misread as thymines during sequencing and lead to the characteristic increase in frequency of cytosine to thymine transitions near the ends of ancient molecules [<xref ref-type="bibr" rid="CR2">2</xref>]. Further, when extracting DNA from ancient human remains, microbial DNA often forms the bulk of all recoverable fragments [<xref ref-type="bibr" rid="CR3">3</xref>], which, together with contaminating DNA from individuals who handled the ancient sample, is sequenced along with the endogenous DNA [<xref ref-type="bibr" rid="CR4">4</xref>]. While bacterial sequences do not typically align to the human reference genome, present-day human contaminants will align together with the endogenous DNA fragments. The presence of contaminant fragments affects both consensus calling and genotyping, and the resulting errors may influence comparisons to present-day humans including the calculations of genotype likelihoods, divergence times, population genetics parameters and phylogenetic reconstructions [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>].</p>
    <p>Previous approaches to reconstructing ancient mitochondrial genomes include the mapping iterative assembler (MIA), which iteratively calls a consensus from the DNA fragments [<xref ref-type="bibr" rid="CR7">7</xref>]. When contamination is high (e.g., &gt;30 %), calling the consensus sequence of the endogenous mitochondrial genome without removing contaminant fragments is likely to result in an incorrect sequence (see Fig. <xref rid="Fig1" ref-type="fig">1</xref>). Because ancient endogenous DNA is more likely to be deaminated than the contaminant DNA from present-day humans [<xref ref-type="bibr" rid="CR8">8</xref>], some studies have restricted the analyses to fragments carrying deaminated cytosines [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR10">10</xref>]. However, using only deaminated fragments reduces the amount of data available for many ancient samples.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Schematic illustration of mitochondrial sequences from an ancient DNA library. When DNA from an ancient human sample is sequenced, DNA from the ancient human (endogenous fragments represented in <italic>green</italic>) as well as contaminant DNA fragments from the individuals who have handled the bone (contaminating fragments represented in <italic>red</italic>) are included. Because DNA undergoes deamination over time, endogenous fragments are likely to carry deaminated cytosines (represented as <italic>T’s</italic> in a <italic>blue frame</italic>), particularly near the ends of the DNA fragments. The non-deaminated cytosines are represented as <italic>unframed blue C’s</italic>. Schmutzi first identifies the endogenous fragments and, in a second step, uses these to quantify contamination. These steps are repeated until convergence is achieved and a single mitochondrial genome is identified</p></caption><graphic xlink:href="13059_2015_776_Fig1_HTML" id="MO1"/></fig></p>
    <p>Due to these issues, research groups have generally prioritized samples with low levels of present-day human contamination. To date, methods to quantify present-day human mitochondrial contamination have relied on the presence of fixed differences between the mitochondrial genomes of archaic and modern humans [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>]. This works well when analyzing the genomes of Neanderthals and Denisovans, but early modern human genomes typically carry too few fixed differences to permit a robust estimate of contamination. For early modern humans, various groups have, therefore, relied on sites in the ancient sample that differ from a large dataset of present-day human mitochondrial sequences [<xref ref-type="bibr" rid="CR13">13</xref>]. Additionally, a maximum-likelihood approach, which co-estimates sequencing error rates and contamination, has been applied to sequences originating from both early modern humans and archaic humans [<xref ref-type="bibr" rid="CR14">14</xref>]. Deamination patterns have also been used to estimate contamination from present-day humans in mitochondrial DNA [<xref ref-type="bibr" rid="CR10">10</xref>]. Software tools are available to measure overall deamination [<xref ref-type="bibr" rid="CR15">15</xref>], identify the endogenous template [<xref ref-type="bibr" rid="CR16">16</xref>], isolate deaminated fragments [<xref ref-type="bibr" rid="CR9">9</xref>] and perform nuclear contamination estimates based on the X-chromosome [<xref ref-type="bibr" rid="CR17">17</xref>]. However, there is currently no software for estimating mitochondrial contamination, which has been thoroughly tested to ascertain its accuracy, available for download for the aDNA research community.</p>
    <p>We developed <italic>schmutzi</italic>, an iterative approach to assembling the endogenous mitochondrial genome while simultaneously estimating present-day human mitochondrial contamination in archaic and early modern human aDNA datasets. Our approach to determining the endogenous mitochondrial genome sequence relies on distinguishing the endogenous and the contaminant nucleotides, given a prior on: contamination, deamination frequency and length distribution of the fragments. Contamination is estimated using single nucleotide differences between the endogenous mtDNA sequence and a database of potential contaminant mitochondrial genomes. The consensus calling and contamination estimation are run iteratively until a stable contamination rate estimate is reached.</p>
    <p>Schmutzi was tested on both simulated and empirical data. Our results show that schmutzi outperforms currently available methods in terms of accuracy of the endogenous call and contamination estimate, particularly at high levels of contamination. An open-source implementation of schmutzi in C++ has been released under the GPLv3.0 and is freely available together with the test datasets that were used [<xref ref-type="bibr" rid="CR18">18</xref>]. On a desktop computer, schmutzi requires between 1 and 3 hours to reach convergence for approximately 1 million fragments aligned to the mitochondrial reference genome. Faster run times (∼30 minutes) can be achieved using multi-core systems.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <p>Schmutzi iteratively calls (i) the endogenous mitochondrial consensus sequence and (ii) a contamination estimate using two linked software programs (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). The input for endoCaller, the consensus caller, is a set of aDNA sequences aligned to a mitochondrial genome reference, a contamination prior and deamination rates for the potentially endogenous and potentially contaminating DNA fragments. In the first iteration, the deamination rates and the prior for contamination are obtained using contDeam, a third sub-program of the schmutzi package (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). contDeam implements a methodology described in previous studies [<xref ref-type="bibr" rid="CR10">10</xref>], but incorporates some additional information including base quality and mapping quality into a Bayesian framework. An underlying assumption is that the base qualities are reasonably representative of the sequencing error probability. Recent versions of the default Illumina base caller, Bustard, provide such accuracy. The inputs for the contamination estimator, mtCont, are the same set of aligned fragments (in BAM format) that were used as input for contDeam, the endogenous consensus sequence determined by endoCaller, and a database of potential contaminant mitochondrial genomes. endoCaller, contDeam and mtCont can also be used as standalone applications. Each component program uses a Bayesian maximum a posteriori algorithm to estimate the most probable model parameters given the data. A list of the inputs and outputs for each of the three main programs, which are described in more detail in the sections below, is presented in Table <xref rid="Tab1" ref-type="table">1</xref>.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Schmutzi workflow. An initial contamination estimate is computed using the deamination rates of fragments by conditioning on the other end being deaminated and comparing these to the deamination rate of all fragments in the dataset (contDeam). This prior is provided to call an endogenous consensus (endoCaller). The consensus call is, in turn, used to re-estimate mitochondrial contamination (mtCont). Deamination rates and fragment length distributions are measured for fragments that support endogenous and contaminant mitochondrial genomes (splitEndo). The information from mtCont and splitEndo is used as input for re-calling the endogenous consensus (endoCaller). This cycle is repeated until a stable contamination rate is reached. <italic>db</italic> database</p></caption><graphic xlink:href="13059_2015_776_Fig2_HTML" id="MO2"/></fig><table-wrap id="Tab1"><label>Table 1</label><caption><p>Inputs and outputs for the different programs described in ‘<xref rid="Sec10" ref-type="sec">Methods</xref>’. Overview of the three main programs, contDeam, endoCaller and mtCont, with the helper program splitEndo for the iterative mode</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Program</th><th align="left">Input</th><th align="left">Output</th></tr></thead><tbody><tr><td align="left">contDeam</td><td align="left">BF</td><td align="left">CRDP, EDR</td></tr><tr><td align="left">endoCaller</td><td align="left">BF, EDR, CP, DFL</td><td align="left">EB</td></tr><tr><td align="left">mtCont</td><td align="left">BF, EDR, DB, EB</td><td align="left">CRDB, CS</td></tr><tr><td align="left">splitEndo</td><td align="left">BF, EB</td><td align="left">EDR, DFL</td></tr></tbody></table><table-wrap-foot><p><italic>BF</italic> BAM file, <italic>CRDP</italic> present-day human contamination rate using deamination patterns, <italic>CRDB</italic> present-day human contamination rate using a database of putative contaminants and the endogenous base, <italic>EDR</italic> endogenous deamination rates, <italic>CP</italic> contamination prior, <italic>DFL</italic> distribution of endogenous/contaminant fragment lengths, <italic>EB</italic> endogenous base, <italic>DB</italic> database of putative mitochondrial contaminant genomes, <italic>CS</italic> most likely contamination source</p></table-wrap-foot></table-wrap></p>
    <p>We tested the performance of each of the component programs and of the iterative function, using both simulated and empirical data. For simulations, we used mitochondrial sequences from an early modern human, a Neanderthal and a Denisovan as the endogenous genomes and a present-day human as the contaminant genome. We also tested the performance on a number of previously published aDNA datasets [<xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR19">19</xref>–<xref ref-type="bibr" rid="CR21">21</xref>]. Further details about the test data can be found in ‘<xref rid="Sec10" ref-type="sec">Methods</xref>’.</p>
    <sec id="Sec3">
      <title>Endogenous consensus calling</title>
      <sec id="Sec4">
        <title>Simulated data</title>
        <p>We ran schmutzi on simulated datasets created for three archaic genomes, each with increasing levels of present-day human contamination, and compared the endogenous and the contaminant genome sequences inferred by schmutzi to the published mitochondrial genome sequences for each individual (see Fig. <xref rid="Fig3" ref-type="fig">3</xref>). We also compared the endogenous consensus produced by (i) schmutzi, (ii) simply calling a consensus from all fragments using htslib and (iii) calling a consensus from fragments identified as deaminated by PMDtools. A Neanderthal was used as the endogenous mitochondrion and various levels of present-day human contamination were simulated. The mitochondrial sequences obtained using all three approaches to call the consensus were not considerably different (&lt;1 %) at low levels of contamination (see Table <xref rid="Tab2" ref-type="table">2</xref>). In contrast, at higher levels of contamination (&gt;20 %), using only the deaminated reads reduces false calls by bases from present-day human contamination. However, schmutzi, which uses all the reads and includes additional sources of information such as fragment length and a contamination prior, prevents false calls that are due to the presence of present-day human contamination. For the remaining simulations, a Denisovan, Neanderthal or early modern human was used as the endogenous genome, with either single- or double-stranded deamination patterns. The accuracy of the consensus sequences generated by schmutzi and by other computational methods to the published reference sequences is presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Tables S9–S14.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Effect of increasing contamination on endogenous genome sequence reconstruction and contaminant genome sequence reconstruction of simulated data. Accuracy of the ancient (<bold>a</bold>) and present-day contaminant (<bold>b</bold>) mitochondrial consensus sequences produced by schmutzi on simulated data for an early modern human, a Neanderthal and a Denisovan mitochondrial genome. We define an error as either a mismatch or an indel between the predicted endogenous sequence and the published mitochondrial sequence used for simulations. As contamination increases, inference of the endogenous mitochondrial genome becomes more difficult (<bold>a</bold>). In contrast, the prediction of the contaminant genome becomes more accurate at higher levels of present-day human contamination (<bold>b</bold>)</p></caption><graphic xlink:href="13059_2015_776_Fig3_HTML" id="MO3"/></fig><table-wrap id="Tab2"><label>Table 2</label><caption><p>Similarity of the predicted endogenous mitochondrial genome sequence to the original Neanderthal reference sequence, at various rates of simulated contamination with present-day human DNA. An endogenous consensus call was performed using schmutzi on all fragments, and using PMDtools followed by htslib on the fragments labeled by PMDtools as endogenous. For comparison, we generated a simple consensus by running htslib on all sequenced fragments. While this approach works well at low amounts of contamination, it produces an incorrect consensus at higher levels of contamination when the presence of contaminating fragments is not accounted for using approaches like PMDtools and schmutzi. The number of indels are reported as either insertions or deletions in either the predicted consensus or the Neanderthal reference; hence, discrepancies in the final sum may occur</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Contamination</th><th align="left" colspan="3">Endogenous prediction</th><th align="left" colspan="3">Endogenous prediction from</th><th align="left" colspan="3">Mitochondrial consensus, called</th></tr><tr><th align="left">rate</th><th align="left" colspan="3">from schmutzi</th><th align="left" colspan="3">PMDtools and htslib</th><th align="left" colspan="3">using htslib on all fragments</th></tr><tr><th align="left"/><th align="left">Matches</th><th align="left">Mismatches</th><th align="left">Indels</th><th align="left">Matches</th><th align="left">Mismatches</th><th align="left">Indels</th><th align="left">Matches</th><th align="left">Mismatches</th><th align="left">Indels</th></tr></thead><tbody><tr><td align="left">1 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,561</td><td align="left">2</td><td align="left">6</td><td align="left">16,561</td><td align="left">3</td><td align="left">5</td></tr><tr><td align="left">5 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,561</td><td align="left">2</td><td align="left">6</td><td align="left">16,561</td><td align="left">3</td><td align="left">5</td></tr><tr><td align="left">10 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,561</td><td align="left">2</td><td align="left">6</td><td align="left">16,561</td><td align="left">3</td><td align="left">5</td></tr><tr><td align="left">15 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,560</td><td align="left">3</td><td align="left">6</td><td align="left">16,553</td><td align="left">11</td><td align="left">5</td></tr><tr><td align="left">20 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,560</td><td align="left">3</td><td align="left">6</td><td align="left">16,488</td><td align="left">76</td><td align="left">5</td></tr><tr><td align="left">25 %</td><td align="left">16,565</td><td align="left">0</td><td align="left">0</td><td align="left">16,558</td><td align="left">5</td><td align="left">6</td><td align="left">16,374</td><td align="left">190</td><td align="left">5</td></tr><tr><td align="left">30 %</td><td align="left">16,564</td><td align="left">1</td><td align="left">0</td><td align="left">16,558</td><td align="left">5</td><td align="left">6</td><td align="left">16,371</td><td align="left">193</td><td align="left">5</td></tr><tr><td align="left">35 %</td><td align="left">16,564</td><td align="left">1</td><td align="left">0</td><td align="left">16,556</td><td align="left">7</td><td align="left">6</td><td align="left">16,371</td><td align="left">193</td><td align="left">5</td></tr><tr><td align="left">40 %</td><td align="left">16,564</td><td align="left">1</td><td align="left">0</td><td align="left">16,555</td><td align="left">8</td><td align="left">6</td><td align="left">16,371</td><td align="left">193</td><td align="left">5</td></tr><tr><td align="left">45 %</td><td align="left">16,564</td><td align="left">1</td><td align="left">0</td><td align="left">16,553</td><td align="left">10</td><td align="left">6</td><td align="left">16,371</td><td align="left">193</td><td align="left">5</td></tr><tr><td align="left">50 %</td><td align="left">16,563</td><td align="left">2</td><td align="left">0</td><td align="left">16,553</td><td align="left">10</td><td align="left">6</td><td align="left">16,371</td><td align="left">193</td><td align="left">5</td></tr><tr><td align="left">55 %</td><td align="left">16,564</td><td align="left">1</td><td align="left">0</td><td align="left">16,554</td><td align="left">9</td><td align="left">6</td><td align="left">16,370</td><td align="left">194</td><td align="left">5</td></tr><tr><td align="left">60 %</td><td align="left">16,563</td><td align="left">2</td><td align="left">0</td><td align="left">16,551</td><td align="left">12</td><td align="left">6</td><td align="left">16,368</td><td align="left">196</td><td align="left">5</td></tr><tr><td align="left">65 %</td><td align="left">16,563</td><td align="left">1</td><td align="left">1</td><td align="left">16,551</td><td align="left">12</td><td align="left">6</td><td align="left">16,361</td><td align="left">203</td><td align="left">5</td></tr><tr><td align="left">70 %</td><td align="left">16,562</td><td align="left">1</td><td align="left">2</td><td align="left">16,548</td><td align="left">15</td><td align="left">6</td><td align="left">16,358</td><td align="left">206</td><td align="left">5</td></tr><tr><td align="left">75 %</td><td align="left">16,563</td><td align="left">1</td><td align="left">1</td><td align="left">16,546</td><td align="left">17</td><td align="left">6</td><td align="left">16,355</td><td align="left">209</td><td align="left">5</td></tr><tr><td align="left">80 %</td><td align="left">16,561</td><td align="left">2</td><td align="left">2</td><td align="left">16,545</td><td align="left">18</td><td align="left">6</td><td align="left">16,355</td><td align="left">209</td><td align="left">5</td></tr><tr><td align="left">85 %</td><td align="left">16,563</td><td align="left">1</td><td align="left">1</td><td align="left">16,544</td><td align="left">19</td><td align="left">6</td><td align="left">16,355</td><td align="left">209</td><td align="left">5</td></tr><tr><td align="left">90 %</td><td align="left">16,561</td><td align="left">3</td><td align="left">1</td><td align="left">16,539</td><td align="left">24</td><td align="left">6</td><td align="left">16,355</td><td align="left">209</td><td align="left">5</td></tr><tr><td align="left">95 %</td><td align="left">16,550</td><td align="left">15</td><td align="left">7</td><td align="left">16,532</td><td align="left">31</td><td align="left">6</td><td align="left">16,355</td><td align="left">209</td><td align="left">5</td></tr></tbody></table></table-wrap></p>
        <p>Schmutzi produced a consensus for both the endogenous and contaminant genomes that is very robust to high levels of contamination. Our results show that the endogenous consensus is accurately reconstructed for up to 50 % present-day human contamination for the double-stranded simulations and up to 70 % for the single-stranded ones. This is due to higher levels of deamination in the single-stranded simulations resulting in better ascertainment of the endogenous base.</p>
        <p>We also called mitochondrial consensus sequences for each sample after processing the data using PMDtools (using the parameter -a to adjust quality scores and the recommended PMD score threshold of 3) to identify deaminated reads and then calling the consensus with htslib (default parameters and haploid model). The sequence similarity to the published ancient genomes was computed as for schmutzi. At higher levels of contamination, schmutzi is able to infer the endogenous genome more accurately than is possible using only htslib on the deaminated reads. It also performs better at higher levels of contamination than the approach of calling a consensus solely from deaminated reads using samtools mpileup (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.1). All three approaches provide a more accurate sequence than mitochondrial consensus genome obtained using MIA (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.1).</p>
        <p>The improvement obtained by schmutzi over approaches that use only deaminated reads from highly contaminated samples results from the inclusion of length and observed ratio of endogenous and contaminant bases. Iteration increases the accuracy of the endogenous consensus call. We found that the initial call for the m dataset with a simulated contamination rate of 58 % had seven mismatches to its original reference while only a single mismatch remained after convergence.</p>
        <p>At around 50 % present-day human contamination, the inference of the endogenous base becomes difficult as there is a near 50/50 distribution of endogenous and contaminant bases. As in the evaluation of the contamination estimate, to simulate low coverage, we subsampled the original BAM file with a simulated contamination rate of 48 %. This was done both for fragments with double-stranded and single-stranded associated damage. Our results show that, for this difficult target, we can infer the endogenous genomes to a coverage of about 20 × (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.2). This is also possible at 15 × but the endogenous calls need to be filtered for high-quality bases to avoid a high number of errors. This filtering also eliminates a significant portion (≈1/16) of the mitochondrial calls. Prediction of the endogenous mitochondrial genome at a lower coverage is possible if present-day human contamination is lower.</p>
      </sec>
      <sec id="Sec5">
        <title>Empirical data</title>
        <p>Because not all features of empirical aDNA datasets can be accurately simulated, we also tested schmutzi on the five empirical datasets described in Table <xref rid="Tab3" ref-type="table">3</xref>. Only a subset of the original data was used here. The accuracy of the endogenous consensus sequences called using schmutzi was compared to the published mitochondrial genomes and to the consensus sequence called using htslib. For htslib, the quality scores of potentially deaminated bases were reduced to avoid incorrect calls at deaminated sites, like the procedure used in [<xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR22">22</xref>].
<table-wrap id="Tab3"><label>Table 3</label><caption><p>Empirical mitochondrial datasets. The numbers in parentheses represent the deamination rates when conditioning on the other end of the fragment being deaminated for heavily contaminated samples</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Sample</th><th align="left">mtDNA</th><th align="left" colspan="2">Deamination</th><th align="left">Present-day</th><th align="left">Library ID</th></tr><tr><th align="left">ID</th><th align="left">coverage</th><th align="left" colspan="2">rates (%)</th><th align="left">contamination</th><th align="left">and reference</th></tr><tr><th align="left"/><th align="left">(×)</th><th align="left">5<sup>′</sup>
</th><th align="left">3<sup>′</sup>
</th><th align="left"/><th align="left"/></tr></thead><tbody><tr><td align="left">Altai Neanderthal</td><td align="left">1076</td><td align="left">5.7</td><td align="left">28.4</td><td align="left">Low (∼1 %)</td><td align="left">L9198 from [<xref ref-type="bibr" rid="CR12">12</xref>]</td></tr><tr><td align="left">Denisovan</td><td align="left">258</td><td align="left">14.8</td><td align="left">33.9</td><td align="left">Low (∼1 %)</td><td align="left">B1108 from [<xref ref-type="bibr" rid="CR20">20</xref>]</td></tr><tr><td align="left">Ust’-ishim</td><td align="left">124</td><td align="left">2.7</td><td align="left">3.4</td><td align="left">Low (∼1 %)</td><td align="left">B3899 from [<xref ref-type="bibr" rid="CR19">19</xref>]</td></tr><tr><td align="left">Mezmaiskaya Neanderthal B9687</td><td align="left">711</td><td align="left">8.8 (17.3)</td><td align="left">13.3 (25.8)</td><td align="left">High (∼40–50 %)</td><td align="left">B9687 from [<xref ref-type="bibr" rid="CR21">21</xref>]</td></tr><tr><td align="left">Mezmaiskaya Neanderthal B9688</td><td align="left">636</td><td align="left">8.5 (15.0)</td><td align="left">12.7 (24.1)</td><td align="left">High (∼40–50 %)</td><td align="left">B9688 from [<xref ref-type="bibr" rid="CR21">21</xref>]</td></tr></tbody></table></table-wrap></p>
        <p>At contamination rates less than 5 %, the consensus sequences called with htslib were highly similar (between one and five mismatches) to the published mitochondrial genome sequences (see Fig. <xref rid="Fig4" ref-type="fig">4</xref>). However, at higher contamination rates (&gt;40 %), the consensus sequence becomes increasingly inaccurate when called with htslib. In contrast, the consensus sequence produced by schmutzi is robust to higher contamination (40–50 %). For the highly contaminated Mezmaiskaya samples, we assessed the effect of using only deaminated fragments to generate the consensus using htslib. This approach has been used previously and substantially reduces the amount of contamination. Indeed, we show that the consensus obtained using htslib and only deaminated fragments improves the accuracy of the consensus sequence (see Fig. <xref rid="Fig4" ref-type="fig">4</xref>) but that the consensus sequence produced by schmutzi is still more accurate in all but one case, which was influenced by capture bias (see paragraphs below and ‘<xref rid="Sec18" ref-type="sec">Discussion</xref>’).
<fig id="Fig4"><label>Fig. 4</label><caption><p>Consensus call and contamination estimate accuracy for empirical datasets. <bold>a</bold> The htslib consensus call (<italic>yellow</italic>) and the schmutzi consensus call (<italic>red</italic>) were performed on a subset of the data from three Neanderthals, one Denisovan and one early modern human. The number of mismatches between the mitochondrial consensus sequence and the published mitochondrial genome from the same individual was calculated. <bold>b</bold> Contamination was estimated using schmutzi (<italic>red</italic>) and contamMix v.1.0-10 (<italic>blue</italic>) and compared to the contamination computed using diagnostic positions (<italic>gray</italic> per fragment and <italic>black</italic> per base). For the two Mezmaiskaya individuals, the endogenous genome used for comparison was obtained using another library with low levels of contamination from the same individual. <italic>diag pos</italic> diagnostic position, <italic>Nean</italic> Neanderthal</p></caption><graphic xlink:href="13059_2015_776_Fig4_HTML" id="MO4"/></fig></p>
        <p>To evaluate further the accuracy of the endogenous consensus calling, a maximum-likelihood phylogenetic tree was computed using the high-quality bases (≥200 PHRED scale) for both the inferred endogenous and contaminant genomes (see Fig. <xref rid="Fig5" ref-type="fig">5</xref><xref rid="Fig5" ref-type="fig">b</xref>), and another using the unfiltered positions (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.2.3). The tree for the high-quality bases has a higher likelihood than the unfiltered one. As expected, our endogenous mitochondrial genome falls within the Neanderthal lineage, more precisely on the Mezmaiskaya branch, whereas the contaminant one falls within the range of human variation. Our algorithm is, therefore, able, without any prior phylogenetic information, to separate the endogenous sequences from the contaminant portions of the alignment.
<fig id="Fig5"><label>Fig. 5</label><caption><p>Contamination estimates and phylogenetic placement of Mezmaiskaya 1 (library ID B9687). <bold>a</bold> The posterior probability distribution for contamination in Mezmaiskaya 1. The <italic>dotted line</italic> represents the estimate obtained using an ad hoc method based on fixed sites. <bold>b</bold> A maximum-likelihood tree showing the placement of the mitochondrial genome of Mezmaiskaya 1 (labeled <italic>MT</italic> in the tree) and the inferred contaminant (labeled <italic>MTc</italic> in the tree), compared to 20 present-day humans and nine archaic humans</p></caption><graphic xlink:href="13059_2015_776_Fig5_HTML" id="MO5"/></fig></p>
        <p>We examined in more detail the sequence inferred for the mitochondrial genome of the Neanderthal from Mezmaiskaya 1 (library ID B9687), which was generated from the same individual for which a high-quality mitochondrial genome from a library with low contamination is available (GenBank FM865411). We note that the contaminating mitochondrial sequence is not known.</p>
        <p>Under the assumption that the sequence from GenBank is without errors, the endogenous genome inferred by schmutzi should match perfectly this reference sequence. The inferred endogenous sequence differed by nine of the 16,608 bases. We noted that this region falls in the D-loop, which is typically quite divergent. We speculated that the incorrect identification of these nine bases may arise from an ascertainment bias due to the mitochondrial capture of the Mezmaiskaya sample using probes based on the human mitochondrial sequence. Indeed, we found that in this region the endogenous bases were significantly underrepresented compared to the contaminant (75 % rather than the average of 50 % for the whole mitochondrial genome). However, these bases tend to have low consensus base quality, which implies that the consensus calls at these positions is unreliable. Filtering for consensus base quality ≥200 (PHRED scale) reduces the number from nine mismatches to one. This single mismatch is in the poly-C region (position 16,184), which is routinely removed in downstream analyses [<xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR24">24</xref>].</p>
      </sec>
    </sec>
    <sec id="Sec6">
      <title>Accuracy of contamination estimates</title>
      <sec id="Sec7">
        <title>Empirical data</title>
        <p>We estimated contamination for each of the five empirical datasets using schmutzi and contamMix (v1.0-10), an implementation from the authors of a previously described maximum-likelihood method for estimating mitochondrial contamination [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR19">19</xref>].</p>
        <p>The correct contamination estimate was taken to be that obtained from fragments aligned to sites in the reference mitochondrial genome where Neanderthals or Denisovans differ from 20 present-day humans (diagnostic sites). Since there are too few diagnostic sites, this approach could not be used for the early modern human data.</p>
        <p>For the Altai Neanderthal and Denisovan samples, which have low contamination, both schmutzi and contamMix accurately estimate the contamination (see Fig. <xref rid="Fig4" ref-type="fig">4</xref>). However, for the highly contaminated Mezmaiskaya Neanderthal samples, schmutzi’s contamination estimates are closer to the estimates provided using diagnostic positions (44.1±0.8 and 49.3±0.7 for Mezmaiskaya samples 1 and 2, respectively). For Mezmaiskaya 1, for instance, using the 111 diagnostic sites, there were 2,443,418 individual bases supporting the Neanderthal base and 1,989,785 supporting the present-day human base, resulting in an estimated contamination of 44.9 % (per nucleotide basis). The contamination estimates obtained using diagnostic positions are constant even when filtering for high base quality and removing potentially deaminated bases. In comparison, the contamination estimate from schmutzi was 44±1 % and the estimate from contamMix was 41.4±0.8 %. We speculate that this is due to schmutzi’s iterative inference of the contaminating genome (see ‘<xref rid="Sec4" ref-type="sec">Simulated data</xref>’). To explore the results, we plotted the distribution of the posterior probability for the contamination estimate from one of the individuals (library ID B9687); see Fig. <xref rid="Fig5" ref-type="fig">5</xref><xref rid="Fig5" ref-type="fig">a</xref>. The posterior probability peaks at the one obtained using diagnostic positions.</p>
        <p>To test further the ability of schmutzi to estimate contamination and infer the endogenous sequence, we downloaded 22 different aDNA datasets from four different studies from different research groups. To compare our estimates to those produced by existing methods, we also ran contamMix on the same samples. Our results show that schmutzi is more accurate and our implementation faster than the existing methodologies (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.2.5).</p>
      </sec>
      <sec id="Sec8">
        <title>Simulated data</title>
        <p>To evaluate the range of contamination and coverage over which schmutzi can be used, we used the three simulated datasets with increasing levels of contamination and at varying coverage. For the simulated datasets, the contamination rates predicted by schmutzi correlate well with those simulated (Fig. <xref rid="Fig6" ref-type="fig">6</xref> and Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S16).
<fig id="Fig6"><label>Fig. 6</label><caption><p>Simulated versus measured contamination rates. Several sets contained simulated aDNA fragments from a mitochondrial genome belonging to an early modern human (left), a Neanderthal (middle) or a Denisovan (right). All simulated sets had damage patterns associated with a single-stranded library protocol. The double-stranded figure can be found in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results. A contaminating present-day human was pooled together at various rates to simulate contamination. The <italic>dotted black line</italic> represents a perfect prediction, and <italic>blue dots</italic> are the predicted rates of contamination by schmutzi once convergence was achieved. The <italic>red dots</italic> represent sets for which the algorithm stopped prematurely due to lack of information about the contaminant fragments. The <italic>black whiskers</italic> represent the 95 % confidence interval for contamination</p></caption><graphic xlink:href="13059_2015_776_Fig6_HTML" id="MO6"/></fig></p>
        <p>To test the accuracy of our algorithm to existing methods, we ran our algorithm and contamMix on a simulated dataset of 1 million fragments with double-stranded deamination patterns. The endogenous mitochondrial genome used was an early modern human with 50 % present-day human contamination. Our result show that the schmutzi algorithm offers superior accuracy compared to this existing method for estimating early modern human contamination (see Table <xref rid="Tab4" ref-type="table">4</xref>). Results for the maximum-likelihood methods used by contamMix for the remaining samples are presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.6. We also evaluated the impact of having multiple contaminant mitochondrial genomes (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.7) where an underestimate is observed for the early modern human at very high levels of contamination (70 %) and at a high mixture (e.g., 50/50) of different contaminant mitochondrial sequences.
<table-wrap id="Tab4"><label>Table 4</label><caption><p>Accuracy of contamination estimates on a simulated early modern human with double-stranded deamination patterns and high present-day modern human contamination. Three cores were used for every program. The programs contamMix and contDeam estimate contamination on a per fragment basis while mtCont estimates contamination on a per nucleotide basis. The contamination on a per nucleotide basis is higher due to the longer average length of contaminating fragments</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Contamination</th><th align="left">Contamination</th><th align="left">Run time</th></tr><tr><th align="left">estimate</th><th align="left">estimate</th><th align="left"/></tr><tr><th align="left">method</th><th align="left"/><th align="left"/></tr></thead><tbody><tr><td align="center" colspan="3">Target contamination rate: 50 % (fragment basis)</td></tr><tr><td align="left">contamMix 1.0-10</td><td align="left">54.9±0.7 %</td><td align="left">4 days</td></tr><tr><td align="left">Schmutzi (contDeam)</td><td align="left">49.0±0.5 %</td><td align="left">68 s</td></tr><tr><td align="center" colspan="3">Target contamination rate: 58.2 % (nucleotide basis)</td></tr><tr><td align="left">Schmutzi (mtCont without the predicted contaminant)</td><td align="left">32.0±1.0 %</td><td align="left">183 m</td></tr><tr><td align="left">Schmutzi (mtCont with the predicted contaminant)</td><td align="left">60.0±1.0 %</td><td align="left">200 m</td></tr></tbody></table></table-wrap></p>
        <p>The predictions of our algorithm for the remaining simulated datasets are presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.5. The predicted present-day human contamination rates matched the simulated contamination rates.</p>
        <p>To evaluate the effect of coverage on schmutzi’s contamination estimate, we analyzed a dataset with 47 % contamination and subsampled this to various levels of coverage. We chose 47 % as a level of contamination that makes the use of currently available tools difficult. Furthermore, at this level of contamination, there is an almost even number of endogenous and contaminant bases thus making the inference of each one relatively difficult for our model.</p>
        <p>For the simulated Neanderthal, the contamination estimated by schmutzi is stable down to a coverage of ∼ 100× (see results for the single-stranded protocol in the top row of Fig. <xref rid="Fig7" ref-type="fig">7</xref> and Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S18 for the double-stranded data). At coverage less than 100 × for the single-stranded data and contamination simulated here, estimation of contamination becomes difficult. For the double-stranded data, due to lower rates of deamination, our estimates are stable at coverages down to 150 ×. However, there are cases where an accurate mitochondrial genome sequence from another closely related individual can be used as a proxy to compute contamination rates (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S19). Using this heuristic we can obtain accurate contamination rates for coverage down to ∼ 5× (see Fig. <xref rid="Fig7" ref-type="fig">7</xref> bottom row).
<fig id="Fig7"><label>Fig. 7</label><caption><p>Robustness of the contamination estimate to lower coverage. The simulated dataset with a contamination rate of ∼47 % and single-stranded deamination patterns was subsampled at various coverages from 0 to 1250 ×. Top: Contamination rates were estimated across a range of coverages in simulated data for a Neanderthal, a Denisovan and an early modern human (Ust’-Ishim). Bottom: Contamination estimates when a high-quality mtDNA sequence from a closely related individual is used as the endogenous genome. Robust estimates can be made down to 5 × coverage even at 47 % contamination. For the early modern human, the contamination estimate provided was computed using the database alone and not the prediction of the contaminant genome thus leading to underestimates (see Table <xref rid="Tab4" ref-type="table">4</xref> for an example of the effect of using the predicted contaminant in the contamination estimate)</p></caption><graphic xlink:href="13059_2015_776_Fig7_HTML" id="MO7"/></fig></p>
        <p>We also note that the contamination prior estimates based only on deamination patterns also show a high correlation to those simulated (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.3). However, these estimates do not have the same robustness to low coverage as the final contamination estimate produced by the iterative approach. Additionally, we show that using a sensitive aligner like SHRIMP [<xref ref-type="bibr" rid="CR25">25</xref>] does not cause drops in coverage around regions of high divergence of the Denisovan mitochondrial genome to the human mtDNA, thus allowing for a more reliable contamination estimate (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.1).</p>
      </sec>
    </sec>
    <sec id="Sec9">
      <title>Contaminant consensus calling</title>
      <p>The accuracy of the contaminant genome inferred from the simulated datasets increased as the amount of contamination increased (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). However, at less than 1 % contamination, schmutzi cannot accurately infer the contaminant genome. An analysis of the inferred contaminant sequences is presented in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Tables S6 and S7.</p>
      <p>For our empirical Mezmaiskaya samples, while the endogenous genome sequence is known, the nature of the contaminant is not. We can, however, take the inferred contamination genome and verify whether it falls within a known mitochondrial haplogroup. Using HaploGrep [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>], we determined that our inferred mitochondrial genome pertained to the T2b3 haplogroup with a confidence of 93.1 %. Out of a total of 33 diagnostic sites for this haplogroup, only one site, with a relatively low consensus prediction quality from our software (65 on a PHRED scale), was not the expected diagnostic base.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="methods">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Test data</title>
      <p>We tested the performance of schmutzi on simulated and empirical mitochondrial sequence data from both archaic humans and early modern humans. Simulated mtDNA datasets with increasing levels of contamination were created by fragmenting and deaminating the mitochondrial genome sequences of a Denisovan (GenBank: FN673705.1) [<xref ref-type="bibr" rid="CR20">20</xref>], a Neanderthal (GenBank: AM948965.1) [<xref ref-type="bibr" rid="CR12">12</xref>] and an early modern human (Ust’-Ishim individual [<xref ref-type="bibr" rid="CR19">19</xref>]) and adding increasing amounts of contamination from a single, randomly selected present-day human mitochondrial genome (GenBank: KJ446110.1). We used empirical deamination rates from data prepared using a double-stranded library preparation protocol (C → T at the 5<sup>′</sup> end and G → A at the 3<sup>′</sup> end, rates from [<xref ref-type="bibr" rid="CR13">13</xref>]). We repeated the simulations by adding deamination rates from empirical data prepared using a single-stranded library protocol (C → T at both ends, rates from [<xref ref-type="bibr" rid="CR22">22</xref>], see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Methods).</p>
      <p>The empirical data included Illumina sequences from the same three ancient individuals as well as sequence data for two additional Neanderthal individuals from Mezmaiskaya [<xref ref-type="bibr" rid="CR21">21</xref>] (NCBI SRA ID: PRJEB6014), which were selected because of the high rate of present-day human contamination present in the sequencing libraries [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
      <p>We compared the accuracy of the consensus sequence called by schmutzi to the consensus sequences generated using a set of typical approaches that have been described in the literature: (i) MIA [<xref ref-type="bibr" rid="CR7">7</xref>], (ii) PMDtools to identify deaminated reads followed by a haploid consensus call using htslib [<xref ref-type="bibr" rid="CR9">9</xref>] and (iii) samtools mpileup (obtained from [<xref ref-type="bibr" rid="CR28">28</xref>]) after removing deaminated reads [<xref ref-type="bibr" rid="CR10">10</xref>]. We also compared schmutzi’s contamination estimates to the known contamination in the simulated sequence data, to the estimates based on diagnostic sites for the empirical data, and to the estimates obtained from the maximum-likelihood approach described in [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR19">19</xref>]. This is currently the only published method that can estimate mitochondrial contamination for both early modern humans and archaic humans. To assess the robustness of schmutzi to varying coverage, fragments were downsampled from 1 % to 50 % of the data using a uniform probability distribution.</p>
      <p>We first discuss how a reasonable contamination prior can be obtained using deamination patterns. We then provide details of the algorithm behind the endogenous consensus caller and show how the contamination is estimated using the output of the endogenous consensus caller. A list of the symbols used throughout this section is found in Table <xref rid="Tab5" ref-type="table">5</xref>.
<table-wrap id="Tab5"><label>Table 5</label><caption><p>Notation used in ‘<xref rid="Sec10" ref-type="sec">Methods</xref>’</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Symbol</th><th align="left">Definition</th></tr></thead><tbody><tr><td align="left"><inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {R}$\end{document}</tex-math><mml:math id="M2"><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq1.gif"/></alternatives></inline-formula></td><td align="left">Set of all fragments</td></tr><tr><td align="left"><inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {E}$\end{document}</tex-math><mml:math id="M4"><mml:mi mathvariant="double-struck">𝔼</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq2.gif"/></alternatives></inline-formula></td><td align="left">Set of all fragments from the endogenous genome</td></tr><tr><td align="left"><italic>R</italic><sub><italic>j</italic></sub></td><td align="left">a particular fragment in <italic>R</italic>, with <italic>l</italic> bases <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ r_{1}, \dots, r_{l} \}$\end{document}</tex-math><mml:math id="M6"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq3.gif"/></alternatives></inline-formula> and respective error probabilities <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ \epsilon _{1}, \dots, \epsilon _{l} \}$\end{document}</tex-math><mml:math id="M8"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq4.gif"/></alternatives></inline-formula>, which are given by the per-base quality scores</td></tr><tr><td align="left"><italic>E</italic></td><td align="left">The event that a sequencing error has occurred</td></tr><tr><td align="left"><italic>D</italic></td><td align="left">The event that deamination has occurred</td></tr><tr><td align="left"><italic>C</italic></td><td align="left">The event that <italic>R</italic>
<sub><italic>j</italic></sub> was sampled from a contaminant mitochondrial genome</td></tr><tr><td align="left"><italic>M</italic></td><td align="left">The event that <italic>R</italic>
<sub><italic>j</italic></sub> was correctly mapped</td></tr><tr><td align="left"><inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$m_{R_{j}}$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq5.gif"/></alternatives></inline-formula></td><td align="left">Probability that <italic>R</italic>
<sub><italic>J</italic></sub> is mismapped (<italic>P</italic>[¬<italic>M</italic>])</td></tr><tr><td align="left"><italic>b</italic><sub>e</sub></td><td align="left">The base from the endogenous genome</td></tr><tr><td align="left"><italic>b</italic><sub>c</sub></td><td align="left">The base from the contaminant genome</td></tr><tr><td align="left"><italic>c</italic></td><td align="left">The base from the contaminant genome used by mtCont, obtained from a database</td></tr><tr><td align="left"><italic>r</italic><sub><italic>i</italic></sub></td><td align="left">The base at position <italic>i</italic> from fragment <italic>R</italic>
<sub><italic>j</italic></sub>
</td></tr><tr><td align="left"><italic>ε</italic><sub><italic>i</italic></sub></td><td align="left">The probability that base <italic>r</italic>
<sub><italic>i</italic></sub> has a sequencing error as determined by the base caller</td></tr><tr><td align="left">¬</td><td align="left">Denotes the complement of an event (event has not occurred)</td></tr><tr><td align="left"><italic>c</italic><sub>d</sub></td><td align="left">Contamination rate, estimated by contDeam</td></tr><tr><td align="left"><italic>c</italic><sub>r</sub></td><td align="left">Contamination rate, estimated by mtCont</td></tr><tr><td align="left"><italic>c</italic><sub>c</sub></td><td align="left">Prior on contamination rate provided as input to endoCaller</td></tr><tr><td align="left">endo<sub>dist</sub>
</td><td align="left">log-normal distribution of the fragment length for the endogenous fragments</td></tr><tr><td align="left">cont<sub>dist</sub>
</td><td align="left">log-normal distribution of the fragment length for the contaminant fragments</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec12">
      <title>contDeam: determining a contamination prior using deamination patterns</title>
      <p>The first iteration of the endogenous genome inference needs a contamination prior that is ideally a reasonable approximation of the actual contamination rate. This first contamination estimate is computed by contDeam (see schematic in Fig. <xref rid="Fig2" ref-type="fig">2</xref>). This program computes the likelihood of observing the aDNA fragments aligned to the reference genome given fixed endogenous deamination patterns and a prior on the rate of present-day human contamination. It then returns the contamination rate with the highest posterior probability. This contamination rate is the most likely value needed to explain the difference between deamination rates for fragments identified as endogenous and overall deamination rates for all the fragments of the entire dataset. We start from the assumption that only the endogenous DNA has the deamination patterns typical of aDNA and that contaminant fragments are not deaminated and will, therefore, only reduce overall deamination rates. Previous studies suggest that deamination is rare in contaminants younger than about 100 years old [<xref ref-type="bibr" rid="CR8">8</xref>]. Having deaminated contaminant fragments may lead to underestimates. We discuss the extent of the potential underestimate at the end of this section.</p>
      <p>To identify the endogenous fragments and derive their deamination rate, there are two possible approaches. The first involves the separation of the endogenous and contaminant fragments using diagnostic positions on the mitochondrial genome. This is relatively straightforward when dealing with Neanderthal or Denisovan individuals, as their mitochondrial genome sequences fall outside of present-day human variation [<xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR30">30</xref>]. For instance, there are 111 diagnostic positions on the mitochondrial genome sequence at which seven Neanderthals share the same base, which differs from 20 present-day humans.</p>
      <p>However, when the endogenous sample is an early modern human and falls within present-day human variation, this approach lacks power due to the rarity of such diagnostic sites. A second strategy takes advantage of the observation that deamination at the 5<sup>′</sup> end of the fragment is independent of the deamination occurring at the 3<sup>′</sup> end and vice versa. By conditioning on observing deamination at one end and measuring the rates of deamination at the other, an estimate of the deamination rates of the endogenous fragments can be obtained [<xref ref-type="bibr" rid="CR10">10</xref>]. This second strategy requires an endogenous base to measure rates of deamination. We, therefore, use the mitochondrial reference sequence as the endogenous template. This assumption yields accurate results even for the highly divergent Denisovan mitochondrial genome. The contamination prior estimated by schmutzi uses this second approach by default. The estimate of the endogenous deamination rate is calculated only once, when launching contDeam. The contamination estimate obtained by contDeam is subsequently used as contamination prior for the first iteration (see Fig. <xref rid="Fig2" ref-type="fig">2</xref>).</p>
      <p>Let <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {R}$\end{document}</tex-math><mml:math id="M12"><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq6.gif"/></alternatives></inline-formula> be the set of all fragments and <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$R_{j} \in \mathbb {R}$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq7.gif"/></alternatives></inline-formula> be a particular aligned fragment of length <italic>l</italic>. We compute the probability of observing this particular alignment to the reference genome given two models: (i) the null model, where any difference from the reference can be solely explained by sequencing error or (ii) the deaminated model, where deamination and sequencing errors could have given rise to this particular alignment to the reference. For fragment <italic>R</italic><sub><italic>j</italic></sub>, let <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ r_{1}, \dots, r_{l} \}$\end{document}</tex-math><mml:math id="M16"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq8.gif"/></alternatives></inline-formula> be the individuals nucleotides and their respective error probabilities <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ \epsilon _{1}, \dots, \epsilon _{l} \}$\end{document}</tex-math><mml:math id="M18"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq9.gif"/></alternatives></inline-formula>, both of which are provided by the base caller. Let <italic>E</italic> denote the event that a sequencing error has occurred, <italic>D</italic> the event that deamination has occurred and let ¬ denote the complement of an event (i.e., the event has not occurred).</p>
      <p>We compute the likelihood of observing the base <italic>r</italic><sub><italic>i</italic></sub>∈<italic>R</italic><sub><italic>j</italic></sub>, aligned to the reference nucleotide <italic>n</italic>, by assuming that nucleotide <italic>n</italic> was the endogenous template. The likelihood of observing <italic>r</italic><sub><italic>i</italic></sub> under the null model, denoted <italic>p</italic><sub><italic>n</italic></sub>(<italic>r</italic><sub><italic>i</italic></sub>), is computed by taking into account two events, either a sequencing error has occurred or it has not: 
<disp-formula id="Equ1"><label>(1)</label><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P_{n} [\!r_{i}] = \begin{cases} (1-\epsilon_{i})\,P[\!n \to r_{i} |\neg E], &amp; \text{if}\,n = r_{i} \\ \epsilon_{i}\,P[\!n \to r_{i} |E ], &amp; \text{if}\,n \neq r_{i} \\ \end{cases}   $$ \end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where <italic>p</italic>[<italic>n</italic>→<italic>r</italic><sub><italic>i</italic></sub>|¬<italic>E</italic>] is the probability that <italic>r</italic><sub><italic>i</italic></sub> is observed if <italic>n</italic> was the template. This quantity is 1 as both nucleotides are identical. The other term, <italic>p</italic>[<italic>n</italic>→<italic>r</italic><sub><italic>i</italic></sub>|<italic>E</italic>], is the probability of a substitution from nucleotide <italic>n</italic> to <italic>r</italic><sub><italic>i</italic></sub> given sequencing error. This term is approximately equal to 1/3 but empirical substitution rates are used (see next section for details). Under the deaminated model, the probability of seeing base <italic>r</italic><sub><italic>i</italic></sub> (given the template <italic>n</italic>) denoted <italic>p</italic><sub><italic>d</italic></sub>(<italic>r</italic><sub><italic>i</italic></sub>) is 
<disp-formula id="Equ2"><label>(2)</label><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ {}P_{\mathrm{d}} [\!r_{i}] =\left\{ \begin{array}{l} (1-\epsilon_{i})\,P[\!n \to r_{i} |\neg D \cap \neg E ], \text{if}\,n = r_{i} \\ (1-\epsilon_{i})\,P[\!n \to r_{i} |D ]\\ +\\ \epsilon_{i}\,P[\!n \to r_{i} |E], \quad\quad \quad\quad\quad\quad \text{if}\,n \neq r_{i} \\ \end{array} \right.  $$ \end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>D</mml:mi><mml:mo>∩</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>D</mml:mi><mml:mo>]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr/></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>as three events need to be taken into account: (i) <inline-formula id="IEq10"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\neg D \cap \neg E$\end{document}</tex-math><mml:math id="M24"><mml:mo>¬</mml:mo><mml:mi>D</mml:mi><mml:mo>∩</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq10.gif"/></alternatives></inline-formula>, absence of both sequencing error and deamination (if <italic>n</italic>=<italic>r</italic><sub><italic>i</italic></sub>), and either (ii) <italic>D</italic> deamination or (iii) <italic>E</italic> error occurred and <italic>n</italic>≠<italic>r</italic><sub><italic>i</italic></sub>. We currently ignore the probability of observing the data given that both deamination and a sequencing error have occurred (<inline-formula id="IEq11"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$D \cap E$\end{document}</tex-math><mml:math id="M26"><mml:mi>D</mml:mi><mml:mo>∩</mml:mo><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq11.gif"/></alternatives></inline-formula>) as it is very unlikely compared to the scenarios mentioned above. The probability of observing a substitution <italic>n</italic>→<italic>r</italic><sub><italic>i</italic></sub> given deamination (<italic>P</italic>[ <italic>n</italic>→<italic>r</italic><sub><italic>i</italic></sub>|<italic>D</italic>]) is computed using the endogenous deamination rates that were described earlier. The term <inline-formula id="IEq12"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P [\!n \to r_{i} |\neg D \cap \neg E]$\end{document}</tex-math><mml:math id="M28"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>n</mml:mi><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>D</mml:mi><mml:mo>∩</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq12.gif"/></alternatives></inline-formula> is the probability that base <italic>r</italic><sub><italic>i</italic></sub> remains as is. This probability is obtained by subtracting from 1, the deamination probability of the remaining bases. For instance, if a given base has a deamination rate of 0.3, the probability that the base remains as is, given the absence of sequencing error, is 0.7.</p>
      <p>Let <italic>C</italic> be the event that we sampled the fragment <italic>R</italic><sub><italic>j</italic></sub> from a contaminant mitochondrial genome and ¬<italic>C</italic> be the event that we sampled from the endogenous genome. We compute the probability of observing fragment <italic>R</italic><sub><italic>j</italic></sub> with its alignment to the reference given that it was sampled from the endogenous genome by assuming that each base is an independent observation and that the probability of seeing any difference to the reference is explained by the deaminated model described by Eq. <xref rid="Equ2" ref-type="">2</xref>. Hence, we have: 
<disp-formula id="Equ3"><label>(3)</label><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!R_{j} | \neg C ] = \prod_{r_{i} \in R_{j}} P_{\mathrm{d}} [\!r_{i}]   $$ \end{document}</tex-math><mml:math id="M30"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>C</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>and similarly, if <italic>R</italic><sub><italic>j</italic></sub> was sampled from the contaminant, the probability of any base that differs from the reference is explained solely by sequencing errors (as defined by Eq. <xref rid="Equ1" ref-type="">1</xref>). This probability for all bases is given by 
<disp-formula id="Equ4"><label>(4)</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!R_{j} | C ] = \prod_{r_{i} \in R_{j}} P_{n} [\!r_{i}].   $$ \end{document}</tex-math><mml:math id="M32"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>There are two events that could have occurred: either we sampled the fragment from the contaminant with probability denoted <italic>c</italic><sub>d</sub> or we sampled from the endogenous genome with probability 1−<italic>c</italic><sub>d</sub>. The goal of contDeam is to estimate <italic>c</italic><sub>d</sub> given the data. Using Eqs. <xref rid="Equ3" ref-type="">3</xref> and <xref rid="Equ4" ref-type="">4</xref>, we obtain the probability of observing <italic>R</italic><sub><italic>j</italic></sub> given that it is sampled from the contaminant at rate <italic>c</italic><sub>d</sub>: 
<disp-formula id="Equ5"><label>(5)</label><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P [\!R_{j}| c_{\mathrm{d}} ] = P[\!R_{j}|\neg C] (1-c_{\mathrm{d}}) + P [\!R_{j}|C ] c_{\mathrm{d}}   $$ \end{document}</tex-math><mml:math id="M34"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>C</mml:mi><mml:mo>]</mml:mo><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo>]</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="13059_2015_776_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>since <italic>P</italic>[ <italic>C</italic>]=<italic>c</italic><sub>d</sub> by definition. The probability of observing all the fragments in set <italic>R</italic>, assuming the reference as the template and the endogenous deamination rates that were initially computed, for a given contamination rate <italic>c</italic><sub>d</sub>, is given by assuming that each fragment is an independent observation: 
<disp-formula id="Equ6"><label>(6)</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P [\!\mathbb{R} | c_{\mathrm{d}} ] = \prod_{R_{i} \in \mathbb{R}} P [\!R_{i} | c_{\mathrm{d}}].   $$ \end{document}</tex-math><mml:math id="M36"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>ℝ</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>Finally, the posterior probability of the contamination rate is given by omitting the probability term for the data (<inline-formula id="IEq13"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\mathbb {R}]$\end{document}</tex-math><mml:math id="M38"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq13.gif"/></alternatives></inline-formula>) as it is independent of the contamination rate, and using a uniform prior for the contamination rate (<italic>P</italic>[ <italic>c</italic><sub>d</sub>]). This posterior probability is, therefore, 
<disp-formula id="Equ7"><label>(7)</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P [\!c_{\mathrm{d}}|\mathbb{R}] \propto P_{d} [ \!\mathbb{R} |c_{\mathrm{d}}].   $$ \end{document}</tex-math><mml:math id="M40"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mo>∝</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>ℝ</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>We then produce the contamination rate <inline-formula id="IEq14"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {c_{\mathrm {d}}}$\end{document}</tex-math><mml:math id="M42"><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq14.gif"/></alternatives></inline-formula> with the highest posterior probability: 
<disp-formula id="Equ8"><label>(8)</label><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \widehat{c_{\mathrm{d}}} = \text{argmax}~P [\!c_{\mathrm{d}} | \mathbb{R} ].  $$ \end{document}</tex-math><mml:math id="M44"><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mtext>argmax</mml:mtext><mml:mspace width="1em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>One advantage of this approach is that it does not require the computation of the endogenous consensus. However, it also does not allow the user to identify the source of the contamination. Furthermore, it may underestimate contamination if the contaminant is deaminated (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.4). The assumption that the mitochondrial genome reference sequence is the template does not seem to influence the final contamination estimate even for the highly divergent Denisovan mitochondrial genome (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.3).</p>
    </sec>
    <sec id="Sec13">
      <title>endoCaller: mitochondrial consensus call</title>
      <p>The first step of the iterative process is to call an initial consensus of the endogenous mitochondrial genome from mtDNA fragments aligned to a mitochondrial reference sequence (endoCaller in Fig. <xref rid="Fig2" ref-type="fig">2</xref>).</p>
      <p>The consensus call relies on computing the probability of observing the aligned aDNA data for a particular pair of endogenous and contaminant nucleotides at a specific site, given a fixed contamination prior and fixed deamination patterns. The endogenous consensus caller seeks to identify the pair of endogenous and contamination nucleotides with the highest posterior probability given the aligned aDNA fragments. We also consider insertion/deletion at a given position. We assume that at any position there is a single nucleotide from the present-day human contaminant. The impact of having multiple contaminating nucleotides was also considered (see ‘<xref rid="Sec2" ref-type="sec">Results</xref>’).</p>
      <p>For a given position in the mitochondrial reference sequence, assuming a single contaminant, there are two bases to infer, <italic>b</italic><sub>e</sub> and <italic>b</italic><sub>c</sub>, for the endogenous and contaminant genomes, respectively. Let <italic>R</italic> be the set of all fragments and <inline-formula id="IEq15"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$R_{j} \in \mathbb {R}$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq15.gif"/></alternatives></inline-formula> be a fragment of length <italic>l</italic> that overlaps the position. Let <inline-formula id="IEq16"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ r_{1}, \dots, r_{l} \}$\end{document}</tex-math><mml:math id="M48"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq16.gif"/></alternatives></inline-formula> be the individual nucleotides of the fragment <italic>R</italic><sub><italic>j</italic></sub>, as identified by the base caller. The respective error probabilities <inline-formula id="IEq17"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\{ \epsilon _{1}, \dots, \epsilon _{l} \}$\end{document}</tex-math><mml:math id="M50"><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq17.gif"/></alternatives></inline-formula> for each base are also provided by the base caller.</p>
      <p>For the position to be evaluated, let the nucleotide <italic>r</italic><sub><italic>i</italic></sub> be the base of fragment <italic>R</italic><sub><italic>j</italic></sub> that aligns at that specific position. Let <italic>ε</italic><sub><italic>i</italic></sub> be its error probability as determined by the base caller. Let <italic>M</italic> be the event that <italic>R</italic><sub><italic>j</italic></sub> was correctly mapped and <italic>P</italic>[<italic>M</italic>] is estimated using the mapping quality provided by the mapper. Let <inline-formula id="IEq18"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {E}$\end{document}</tex-math><mml:math id="M52"><mml:mi mathvariant="double-struck">𝔼</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq18.gif"/></alternatives></inline-formula> be the set of fragments from the endogenous mitochondrial genome such that <inline-formula id="IEq19"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {E} \subseteq \mathbb {R}$\end{document}</tex-math><mml:math id="M54"><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>⊆</mml:mo><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq19.gif"/></alternatives></inline-formula>. We will assume that the a priori probability that fragment <italic>R</italic><sub><italic>j</italic></sub> is endogenous is <inline-formula id="IEq20"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\!R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M56"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq20.gif"/></alternatives></inline-formula>. This quantity is computed using both the deamination patterns of the fragment and its length to derive a probability of that fragment being endogenous. The equations for this expression are described in greater detail at the end of this section.</p>
      <p>In having observed the base <italic>r</italic><sub><italic>i</italic></sub>, there are two possibilities: the base came either from the contaminant with probability <inline-formula id="IEq21"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$1-P[\!R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M58"><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq21.gif"/></alternatives></inline-formula> or from the endogenous sample with probability <inline-formula id="IEq22"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\!R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M60"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq22.gif"/></alternatives></inline-formula>. We assume for now that the fragment was properly mapped (i.e., <italic>M</italic> occurred). The final equation, which considers either possibility, is presented in ‘<xref rid="Sec14" ref-type="sec">Mapping</xref>’. The probability of observing base <italic>r</italic><sub><italic>i</italic></sub>, denoted by <italic>P</italic>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>b</italic><sub>c</sub>,<italic>M</italic>], is given by 
<disp-formula id="Equ9"><label>(9)</label><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!R_{j} \in \mathbb{E}] P_{\mathrm{c}} [\!r_{i}|b_{\mathrm{e}},M] +\ (1- P[\!R_{j} \in \mathbb{E}]) P_{\mathrm{c}} [\!r_{i}|b_{\mathrm{c}},M].   $$ \end{document}</tex-math><mml:math id="M62"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>The expression <italic>P</italic><sub>e</sub>[<italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>M</italic>] is the probability of observing <italic>r</italic><sub><italic>i</italic></sub> given that the fragment is endogenous and <italic>b</italic><sub>e</sub> is the endogenous base. Let <italic>E</italic> denote the event that a sequencing error has occurred and let ¬<italic>E</italic> denote the complement of the event or, in other words, that the sequencing was correct and no error has occurred. The quantity <italic>P</italic><sub>e</sub>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>M</italic>] is given by 
<disp-formula id="Equ10"><label>(10)</label><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ (1-\epsilon_{i}) P_{\mathrm{e}} [\!b_{\mathrm{e}} \to r_{i}|\neg E,M] +\ \epsilon_{i} P_{\mathrm{e}} [\!b_{\mathrm{e}} \to r_{i} | E, M ].   $$ \end{document}</tex-math><mml:math id="M64"><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>Given that the base is correct (i.e., without sequencing error), both <italic>r</italic><sub><italic>i</italic></sub> and <italic>b</italic><sub>e</sub> should be identical; hence, 
<disp-formula id="Equ11"><label>(11)</label><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P_{\mathrm{e}} [\!b_{\mathrm{e}} \to r_{i} | \neg E, M] = \begin{cases} 1, &amp; \text{if}\,b_{\mathrm{e}} = r_{i} \\ 0, &amp; \text{if}\,b_{\mathrm{e}} \ne r_{i}. \\ \end{cases}   $$ \end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>.</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>However, due to deamination, it is possible to have a substitution with the probability derived from the deamination profile entered as input. Let <italic>Ω</italic> be the set of all DNA bases (<italic>Ω</italic>={<italic>A</italic>,<italic>C</italic>,<italic>G</italic>,<italic>T</italic>}). Under the deamination model, the term <italic>P</italic><sub>e</sub>[ <italic>b</italic><sub>e</sub>→<italic>r</italic><sub><italic>i</italic></sub>|¬<italic>E</italic>,<italic>M</italic>] becomes 
<disp-formula id="Equ12"><label>(12)</label><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{cases} 1 - \sum\limits_{b_{\mathrm{e}}' \in \Omega \setminus b} \text{rate}_{\text{deam}}\left(b_{\mathrm{e}} \to b_{\mathrm{e}}'\right), &amp; \text{if}\,b_{\mathrm{e}} = r_{i} \\ \text{rate}_{\text{deam}}(b_{\mathrm{e}} \to r_{i}), &amp; \text{if}\,b_{\mathrm{e}} \ne r_{i} \\ \end{cases}   $$ \end{document}</tex-math><mml:math id="M68"><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi><mml:mo>∖</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mtext>rate</mml:mtext></mml:mrow><mml:mrow><mml:mtext>deam</mml:mtext></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msubsup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mtext>rate</mml:mtext></mml:mrow><mml:mrow><mml:mtext>deam</mml:mtext></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where rate<sub>deam</sub>(<italic>b</italic>→<italic>r</italic><sub><italic>i</italic></sub>) is the rate of nucleotide substitution from <italic>b</italic> to <italic>r</italic><sub><italic>i</italic></sub> due to deamination at that specific position of the fragment. As stated before, the deamination rates per base for each position of the fragment are entered as input and remain unchanged by endoCaller. For sequencing errors, the probability of base substitution can be obtained using the assumption that any given nucleotide is equally likely to be miscalled as any of the remaining three nucleotides: 
<disp-formula id="Equ13"><label>(13)</label><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P_{\mathrm{e}} [\!b_{\mathrm{e}} \to r_{i} |E,M] = \frac {1} {3}, \quad \forall b_{\mathrm{e}} \ne r_{i}.   $$ \end{document}</tex-math><mml:math id="M70"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mo>∀</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>However, studies on Illumina sequencing errors show that this assumption is often incorrect [<xref ref-type="bibr" rid="CR31">31</xref>]. We, therefore, recommend using empirical nucleotide substitutions rates from an Illumina sequencing run (provided with the software package). The new error probability term becomes 
<disp-formula id="Equ14"><label>(14)</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P_{\mathrm{e}} [\!b_{\mathrm{e}} \to r_{i} |E,M] = \frac { \# b_{\mathrm{e}} \to r_{i}} { \sum\limits_{b_{\mathrm{e}}' \in \Omega \setminus b_{\mathrm{e}}} \# b_{\mathrm{e}} \to b_{\mathrm{e}}' }  $$ \end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>#</mml:mi><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi><mml:mo>∖</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mi>#</mml:mi><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msubsup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="13059_2015_776_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where <italic>#</italic><italic>x</italic>→<italic>y</italic> represents the number of times a mismatch between the reference base <italic>x</italic> to an observed <italic>y</italic> occurred. These counts were determined using spiked-in control sequences aligned to the PhiX genome provided by Illumina Corp.</p>
      <p>A similar computation is derived for the probability of seeing <italic>r</italic><sub><italic>i</italic></sub> given that we sampled the contaminant base <italic>b</italic><sub>c</sub> (<italic>P</italic><sub><italic>c</italic></sub>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>c</sub>,<italic>M</italic>]). However, the deamination profile provided as input for the contaminant fragments are different from the endogenous ones and tend to be much lower (the end of ‘<xref rid="Sec10" ref-type="sec">Methods</xref>’ describes the test data for empirical deamination rates for both endogenous and contaminant fragments). Our mitochondrial consensus caller endoCaller allows for deamination of the contaminant unlike contDeam, which assumes that the contaminant fragments have little to no deamination.</p>
      <sec id="Sec14">
        <title>Mapping</title>
        <p>Thus far, it was assumed that the fragment <italic>R</italic><sub><italic>j</italic></sub> was correctly mapped. For fragments not properly mapped, we estimate that the probability of seeing the base <italic>r</italic><sub><italic>i</italic></sub> is independent of bases <italic>b</italic><sub>e</sub> and <italic>b</italic><sub>c</sub> and is simply the probability of observing <italic>r</italic><sub><italic>i</italic></sub>: 
<disp-formula id="Equ15"><label>(15)</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!r_{i}|b,\neg M] = P[\!r_{i}] = \frac{1} {4}.   $$ \end{document}</tex-math><mml:math id="M74"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mo>¬</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The probability of fragment <italic>R</italic><sub><italic>j</italic></sub> being incorrectly mapped is obtained using its mapping quality, and we, therefore, combine Eqs. <xref rid="Equ9" ref-type="">9</xref> and <xref rid="Equ15" ref-type="">15</xref> into one to compute the final probability of observing the base <italic>r</italic><sub><italic>i</italic></sub>, denoted by <italic>P</italic>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>b</italic><sub>c</sub>]: 
<disp-formula id="Equ16"><label>(16)</label><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \left(1-m_{R_{j}}\right) P[\!r_{i}|b_{\mathrm{e}},b_{\mathrm{c}},M] +\ m_{R_{j}} P[\!r_{i}|b_{\mathrm{e}},b_{\mathrm{c}},\neg M]   $$ \end{document}</tex-math><mml:math id="M76"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>¬</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <inline-formula id="IEq23"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$m_{R_{j}}$\end{document}</tex-math><mml:math id="M78"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq23.gif"/></alternatives></inline-formula> is the probability that the fragment <italic>R</italic><sub><italic>j</italic></sub> is mismapped (i.e., <inline-formula id="IEq24"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$m_{R_{j}} = P[\neg M] $\end{document}</tex-math><mml:math id="M80"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mo>¬</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq24.gif"/></alternatives></inline-formula>).</p>
      </sec>
      <sec id="Sec15">
        <title>Producing the most likely bases</title>
        <p>The probability of observing the data given every endogenous and contaminant base has been described. However, the posterior probability of the pair of bases given the data <inline-formula id="IEq25"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbb {R}$\end{document}</tex-math><mml:math id="M82"><mml:mi>ℝ</mml:mi></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq25.gif"/></alternatives></inline-formula> is the quantity that is sought. We assume that every fragment <italic>R</italic><sub><italic>j</italic></sub> represents an independent observation and we also consider that the likelihood of bases <italic>b</italic><sub>e</sub> and <italic>b</italic><sub>c</sub> given the data is proportional to the probability of observing the data given the pair of nucleotides times a flat prior: 
<disp-formula id="Equ17"><label>(17)</label><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!b_{\mathrm{e}},b_{\mathrm{c}}|\mathbb{R}] \propto \prod_{R_{j} \in \mathbb{R}} P[\!R_{j}|b_{\mathrm{e}},b_{\mathrm{c}}] \frac {1} {4^{2}}.  $$ \end{document}</tex-math><mml:math id="M84"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mo>∝</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>4</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Once the joint probability for all pairs of nucleotides is computed, a marginalization over <italic>b</italic><sub>c</sub> is used to obtain the likelihood of a given endogenous base: 
<disp-formula id="Equ18"><label>(18)</label><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!b_{\mathrm{e}}|\mathbb{R}] = \sum_{b_{\mathrm{c}} \in \Omega} P[\!b_{\mathrm{e}},b_{\mathrm{c}}|\mathbb{R}].  $$ \end{document}</tex-math><mml:math id="M86"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>A marginalization over the endogenous base is used to call the contaminant base. Finally, the most likely endogenous nucleotide <inline-formula id="IEq26"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {b_{\mathrm {e}}}$\end{document}</tex-math><mml:math id="M88"><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq26.gif"/></alternatives></inline-formula> is produced: 
<disp-formula id="Equ19"><label>(19)</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \widehat{b_{\mathrm{e}}} = \underset{b_{\mathrm{e}} \in \Omega}{argmax}\,P [\!b_{\mathrm{e}}|\mathbb{R}].  $$ \end{document}</tex-math><mml:math id="M90"><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext mathvariant="italic">argmax</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:munder><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The probability of error on <inline-formula id="IEq27"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {b_{\mathrm {e}}}$\end{document}</tex-math><mml:math id="M92"><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq27.gif"/></alternatives></inline-formula> is given by the ratio of the sum of the probabilities for all alternative bases except the most likely over the sum of the probabilities for all bases: 
<disp-formula id="Equ20"><label>(20)</label><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[ \neg \widehat{b_{\mathrm{e}}}|\mathbb{R}] = \frac { \sum\limits_{b_{\mathrm{e}} \in \Omega \setminus \widehat{b_{\mathrm{e}}}} P[\!b_{\mathrm{e}}|\mathbb{R}]} { \sum\limits_{b_{\mathrm{e}} \in \Omega} P[\!b_{\mathrm{e}}|\mathbb{R}] }.   $$ \end{document}</tex-math><mml:math id="M94"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mo>¬</mml:mo><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi><mml:mo>∖</mml:mo><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>An analogous computation is done to determine the contaminant base. The computation for insertions and deletions is similar (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Methods, Section 1.2).</p>
      </sec>
      <sec id="Sec16">
        <title>Computation of <inline-formula id="IEq28"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M96"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq28.gif"/></alternatives></inline-formula></title>
        <p>For the probability that a given fragment <italic>R</italic><sub><italic>j</italic></sub> is endogenous, denoted as <inline-formula id="IEq29"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\!R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M98"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq29.gif"/></alternatives></inline-formula>, our model takes into consideration two factors: deamination patterns and the length of the fragments. Parameters for these two factors are introduced as input to the endogenous caller. Such parameters are re-estimated at each iteration using fragments that support an endogenous base versus a contaminant one (splitEndo in Fig. <xref rid="Fig2" ref-type="fig">2</xref>). The splitEndo module will (i) use the output of endoCaller from the previous iteration and separate fragments that support the endogenous or the contaminant base at positions where they differ and (ii) estimate deamination parameters and fit a log-normal distribution on each separated set of fragments independently. Deamination rates are obtained by measuring rates of nucleotide substitution from the reference base at a given position in the fragment and the log-normal parameters are obtained by a maximum-likelihood fit using the fitdistrplus R package. These estimates are fixed throughout a single iteration and are re-estimated by splitEndo in the following one.</p>
        <p>Endogenous fragments tend to exhibit higher rates of deamination than contaminant fragments (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Methods, Section 1.7). In the previous section where contDeam was described, we compared a model that considers deamination and sequencing errors, and another model that solely uses sequencing errors to compute the probability of seeing a particular alignment given the reference as template. In this section, we seek to incorporate the possibility that the template might be a different base than the endogenous one for greater accuracy. Let <italic>E</italic> denote the event that a sequencing error has occurred, <italic>D</italic> the event that deamination has occurred and let ¬ denote the complement of an event (i.e., the event has not occurred). First, we seek to compute the probability of observing the base <italic>r</italic><sub><italic>i</italic></sub>, part of the fragment <italic>R</italic><sub><italic>j</italic></sub>, given that it originated from endogenous base <italic>b</italic><sub>e</sub> under a model where substitutions are solely due to sequencing errors. This term, denoted <italic>p</italic><sub><italic>n</italic></sub>(<italic>r</italic><sub><italic>i</italic></sub>), is obtained similarly to Eq. <xref rid="Equ1" ref-type="">1</xref> but by considering all four potential endogenous bases <italic>b</italic><sub>e</sub> as follows: 
<disp-formula id="Equ21"><label>(21)</label><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \sum_{b_{\mathrm{e}} \in \Omega} (1-P[\neg b_{\mathrm{e}}]) P_{n} [\!r_{i}|b_{\mathrm{e}}]   $$ \end{document}</tex-math><mml:math id="M100"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:munder><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mo>¬</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>P</italic><sub><italic>n</italic></sub>[<italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>] is equal to 
<disp-formula id="Equ22"><label>(22)</label><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{cases}(1-\epsilon_{i})\,P[\!b_{\mathrm{e}} \to r_{i} |\neg E], &amp; \text{if}\,b_{\mathrm{e}} = r_{i} \\ \epsilon_{i}\,P[\!b_{\mathrm{e}} \to r_{i} |E], &amp; \text{if}\,b_{\mathrm{e}} \neq r_{i} \\ \end{cases}   $$ \end{document}</tex-math><mml:math id="M102"><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <inline-formula id="IEq30"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\neg b_{\mathrm {e}}|\mathbb {R}]$\end{document}</tex-math><mml:math id="M104"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mo>¬</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq30.gif"/></alternatives></inline-formula> is the probability of error for endogenous base <italic>b</italic><sub>e</sub> as defined in Eq. <xref rid="Equ20" ref-type="">20</xref>. The nucleotide substitution probabilities given either absence or presence of a sequencing error are computed as described in the contDeam section. Second, we compute the probability of seeing base <italic>r</italic><sub><italic>i</italic></sub> given endogenous base <italic>b</italic><sub>e</sub> if any difference is explained by either deamination or sequencing errors. Like Eq. <xref rid="Equ2" ref-type="">2</xref>, this probability, denoted <italic>P</italic><sub>d</sub>[ <italic>r</italic><sub><italic>i</italic></sub>], is computed using 
<disp-formula id="Equ23"><label>(23)</label><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \sum_{b_{\mathrm{e}} \in \Omega} (1-P[\neg b_{\mathrm{e}}]) P_{\mathrm{d}} [r_{i}|b_{\mathrm{e}}]   $$ \end{document}</tex-math><mml:math id="M106"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:munder><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mo>¬</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>where <italic>P</italic><sub>d</sub>[<italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>] is equal to 
<disp-formula id="Equ24"><label>(24)</label><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \begin{cases}(1-\epsilon_{i})\,P[\!b_{\mathrm{e}} \to r_{i} |\neg D \cap \neg E ], &amp; \text{if}\,b_{\mathrm{e}} = r_{i} \\ (1-\epsilon_{i})\,P[\!b_{\mathrm{e}} \to r_{i} |D ] +\ \epsilon_{i} P[ \!b_{\mathrm{e}} \to r_{i} |E], &amp; \text{if}\,b_{\mathrm{e}} \neq r_{i}. \\ \end{cases}   $$ \end{document}</tex-math><mml:math id="M108"><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>¬</mml:mo><mml:mi>D</mml:mi><mml:mo>∩</mml:mo><mml:mo>¬</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>D</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>E</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>.</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="1em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2015_776_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Again, the substitution probabilities given either deamination or sequencing error are computed as described in the contDeam section.</p>
        <p>We compute the probability that the aligned fragment <italic>R</italic><sub><italic>j</italic></sub> was observed under a deamination and sequencing error model, denoted <italic>P</italic>[ <italic>R</italic><sub><italic>j</italic></sub>|<italic>M</italic><sub>deam</sub>], by taking the product for each base <inline-formula id="IEq31"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$r_{1}, \dots, r_{l} \in R_{j}$\end{document}</tex-math><mml:math id="M110"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq31.gif"/></alternatives></inline-formula> of the term described by Eq. <xref rid="Equ23" ref-type="">23</xref>. The probability that aligned fragment <italic>R</italic><sub><italic>j</italic></sub> was observed under a sequencing error model, denoted <italic>P</italic>[ <italic>R</italic><sub><italic>j</italic></sub>|<italic>M</italic><sub>null</sub>] uses the product of the term described by Eq. <xref rid="Equ21" ref-type="">21</xref> where only sequencing errors are considered.</p>
        <p>As mentioned previously, endoCaller needs as input a prior, denoted <italic>c</italic><sub>c</sub>, on the rate of present-day human contamination. Finally, both probabilities are combined with our prior on a fragment being endogenous of 1−<italic>c</italic><sub>c</sub> as a posterior probability to obtain the probability that fragment <italic>R</italic><sub><italic>j</italic></sub> is deaminated: 
<disp-formula id="Equ25"><label>(25)</label><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \frac { (1-c_{\mathrm{c}}) P[\!R_{j} | M_{\text{deam}} ]} { (1-c_{\mathrm{c}}) P[\!R_{j} | M_{\text{deam}} ] +\ c_{\mathrm{c}} P[ \!R_{j} | M_{\text{null}}] }.   $$ \end{document}</tex-math><mml:math id="M112"><mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>deam</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>deam</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext>null</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Differences in fragment lengths between the endogenous and contaminant sequences can also be informative about contamination. Ancient fragments tend to be shorter than modern contaminating DNA fragments due to degradation of aDNA [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR30">30</xref>, <xref ref-type="bibr" rid="CR32">32</xref>] (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Methods, Section 1.5). Other studies have modeled the length of aDNA fragments using a log-normal distribution [<xref ref-type="bibr" rid="CR33">33</xref>]. Here we model the endogenous and contaminant fragment length distributions using two log-normal distributions and infer, using empirical distributions, four parameters, <italic>μ</italic><sub>endo</sub>,<italic>σ</italic><sub>endo</sub>,<italic>μ</italic><sub>cont</sub> and <italic>σ</italic><sub>cont</sub>, for the location and scale parameters of the endogenous and contaminant log-normal distributions, respectively. Again, these parameters are estimated by splitEndo at each iteration. The probability that the fragment <italic>R</italic><sub><italic>j</italic></sub> of length <italic>l</italic> was sampled from the endogenous distribution is given by the probability density function for the log-normal distribution: 
<disp-formula id="Equ26"><label>(26)</label><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ P[\!R_{j} \in \text{endo}_{\text{dist}}] = \frac {1} {l \sqrt{2\pi} \sigma_{\text{endo}}} \mathrm{e}^{- \frac{\left(\ln(l) - \mu_{\text{endo}}\right)^{2}} {2 \sigma_{\text{endo}}^{2}} }.  $$ \end{document}</tex-math><mml:math id="M114"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:msqrt><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mo>ln</mml:mo><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The probability that the fragment is from the contaminant distribution (<italic>P</italic>[<italic>R</italic><sub><italic>j</italic></sub>∈cont<sub>dist</sub>]) is calculated the same way except using the location and scale for that distribution. The posterior probability of both terms is used to compute the probability that fragment <italic>R</italic><sub><italic>j</italic></sub> pertains to the endogenous distribution using the contamination prior: 
<disp-formula id="Equ27"><label>(27)</label><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \frac { (1-c_{\mathrm{c}}) P[\!R_{j} \in \text{endo}_{\text{dist}}]} {(1-c_{\mathrm{c}}) P[\!R_{j} \in \text{endo}_{\text{dist}}] +\ c_{\mathrm{c}} P[\!R_{j} \in \text{cont}_{\text{dist}}]}.   $$ \end{document}</tex-math><mml:math id="M116"><mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mtext>endo</mml:mtext></mml:mrow><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mtext>cont</mml:mtext></mml:mrow><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:math><graphic xlink:href="13059_2015_776_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Finally, the deamination and length probabilities are combined to compute the probability that a fragment is endogenous (<inline-formula id="IEq32"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$P[\!R_{j} \in \mathbb {E}]$\end{document}</tex-math><mml:math id="M118"><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">𝔼</mml:mi><mml:mo>]</mml:mo></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq32.gif"/></alternatives></inline-formula>).</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>mtCont: mitochondrial contamination estimate</title>
      <p>Once the endogenous base and its likelihood have been computed for a given site, a second program takes this information, together with the aligned BAM file of all fragments covering each site, and determines the most likely contaminating genome from the database of possible contaminants as well as the contamination rate (mtCont in Fig. <xref rid="Fig2" ref-type="fig">2</xref>). This is achieved by determining the most likely contamination rate using sites where bases in the putative endogenous and contaminant genomes differ. Once this computation is finished for all mitochondrial genomes in the database, the genome with the highest likelihood of being the contaminant is identified (see details in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Methods, Section 1.6).</p>
      <p>In the previous section, a fixed contamination prior was supplied to endoCaller and the most likely endogenous and contaminant bases were inferred given the data. In this section, mtCont computes the most likely contamination rate given the data for fixed probabilities for the endogenous and contamination bases, which are provided by endoCaller. As in endoCaller, the deamination rates are entered as input. The contamination estimate generated by contDeam at iteration #1 is recalculated by mtCont in subsequent iterations (see Fig. <xref rid="Fig2" ref-type="fig">2</xref>).</p>
      <p>For a given position on the mitochondrion, let <italic>b</italic><sub>e</sub> be a possible base from the endogenous sample and <italic>c</italic> be a potential base from the contaminant. Let the contamination rate be <italic>c</italic><sub>r</sub>, defined as the probability of seeing a base from the contaminant at this given position. Therefore, the probability that the base is endogenous is 1−<italic>c</italic><sub>r</sub>. Like the terms used in the section above, let <italic>R</italic><sub><italic>j</italic></sub> be a fragment with mismapping probability <inline-formula id="IEq33"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$m_{R_{j}}$\end{document}</tex-math><mml:math id="M120"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2015_776_Article_IEq33.gif"/></alternatives></inline-formula> and let base <italic>r</italic><sub><italic>i</italic></sub> be its base at the position of interest. The probability of observing <italic>r</italic><sub><italic>i</italic></sub> given that either <italic>b</italic><sub>e</sub> or <italic>c</italic> could have given rise to it, denoted <italic>P</italic>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>c</italic>], is 
<disp-formula id="Equ28"><label>(28)</label><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ (1-m_{R_{j}}) P[\!r_{i}|b_{\mathrm{e}},c,M] +\ m_{R_{j}} P[\! r_{i}|b_{\mathrm{e}},c,\neg M]   $$ \end{document}</tex-math><mml:math id="M122"><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mo>¬</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where the probability of being mismapped is defined as in Eq. <xref rid="Equ15" ref-type="">15</xref>. If the fragment is properly mapped, it can originate from either the contaminant or the endogenous genome. Using the defined contamination rate, we can quantify <italic>P</italic>[<italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>c</italic>,<italic>M</italic>], the probability of observing <italic>r</italic><sub><italic>i</italic></sub> given that the fragment was correctly mapped as 
<disp-formula id="Equ29"><label>(29)</label><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ (1-c_{\mathrm{r}}) P_{\mathrm{e}} [\!r_{i}|b_{\mathrm{e}},M] +\ c_{\mathrm{r}} P_{c} [\!r_{i}|c,M]   $$ \end{document}</tex-math><mml:math id="M124"><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>since we either sampled from the contaminant with probability <italic>c</italic><sub>r</sub> or from the endogenous base with probability 1 − <italic>c</italic><sub>r</sub>. The probability of observing the base <italic>r</italic><sub><italic>i</italic></sub> given it came from either the endogenous material (<italic>P</italic><sub>e</sub>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>c</italic>,<italic>M</italic>]) or the contamination (<italic>P</italic><sub><italic>c</italic></sub>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>c</italic>,<italic>M</italic>]) considers sequencing errors and deamination rates. The precise terms found for such quantities are derived as in Eq. <xref rid="Equ10" ref-type="">10</xref>. The only difference is that a deaminated substitution model is used for the endogenous base whereas a model that only considers sequencing errors is used for the contaminant base.</p>
      <p>Let <italic>Ω</italic><sup>2</sup> be the set of all possible pairs of nucleotides. For a given contamination rate <italic>c</italic><sub>r</sub>, the probability (<italic>P</italic>[ <italic>r</italic><sub><italic>i</italic></sub>]) of observing the base <italic>r</italic><sub><italic>i</italic></sub> is obtained by marginalizing over each possible contaminant and endogenous base: 
<disp-formula id="Equ30"><label>(30)</label><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \sum\limits_{b_{\mathrm{e}},c \in \Omega^{2}} P[\!r_{i}|b_{\mathrm{e}},c] P[\!b_{\mathrm{e}},c]   $$ \end{document}</tex-math><mml:math id="M126"><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>Ω</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>]</mml:mo><mml:mi>P</mml:mi><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>]</mml:mo></mml:math><graphic xlink:href="13059_2015_776_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>where the term <italic>P</italic>[ <italic>r</italic><sub><italic>i</italic></sub>|<italic>b</italic><sub>e</sub>,<italic>c</italic>] is defined in Eq. <xref rid="Equ28" ref-type="">28</xref>. The combined probability of <italic>b</italic><sub>e</sub> being the endogenous and <italic>c</italic> being the contaminant base is given by <italic>P</italic>[ <italic>b</italic><sub>e</sub>,<italic>c</italic>]=<italic>P</italic>[ <italic>b</italic><sub>e</sub>]<italic>P</italic>[ <italic>c</italic>]. The prior on the endogenous base <italic>P</italic>[ <italic>b</italic><sub>e</sub>] is one minus the probability that <italic>b</italic><sub>e</sub> is not the endogenous base, a quantity defined by Eq. <xref rid="Equ20" ref-type="">20</xref>. The probability <italic>P</italic>[ <italic>c</italic>] is defined by the probability of having nucleotide <italic>c</italic> in the putative contaminant mitochondrial sequence.</p>
      <p>The total likelihood is obtained by the product of Eq. <xref rid="Equ30" ref-type="">30</xref> for every fragment. This likelihood is computed for every contamination rate between 0 and 100 % assuming a uniform prior on the contamination rate and for each mitochondrial genome in the set of putative contaminants. Finally, the contaminant genome is determined and the contamination rate with the highest posterior probability, as well as a 95 % confidence interval, is produced.</p>
    </sec>
  </sec>
  <sec id="Sec18" sec-type="discussion">
    <title>Discussion</title>
    <p>aDNA analyses have typically decoupled reconstruction of the endogenous mitochondrial genome from quantification and characterization of present-day human contamination. Since these two tasks are interdependent, we argue that consensus calling and contamination estimation should be performed iteratively to achieve the most accurate results. Current approaches to determining the endogenous mtDNA sequence are very dependent on the amount of contamination. In samples with low present-day human contamination, a consensus sequence is usually called using all sequences, whereas for highly contaminated samples, only deaminated fragments are used. However, there is no clear contamination cut-off to determine which strategy should be used. Schmutzi can be applied to samples with either low or high levels of contamination thereby obviating this decision.</p>
    <p>We have presented here empirical and simulated datasets demonstrating that schmutzi outperforms a number of existing approaches to consensus sequence calling and contamination estimation over a wide range of contamination rates and coverages. Our simulations were conducted using empirical fragment length distributions and deamination rates. It is trivial to see that higher deamination rates can enable end users to infer with greater confidence the endogenous sequence of even highly contaminated samples. We note that absence of deamination will yield incorrect estimates of contamination. Since deamination is the primary feature used to distinguish endogenous from contaminant bases, treatment with full uracil-DNA glycosylase [<xref ref-type="bibr" rid="CR34">34</xref>] is also likely to impact negatively the estimation of contamination and result in an incorrect endogenous consensus call at high levels of contamination. We, therefore, recommend using schmutzi only for samples with either no, or partial, uracil-DNA glycosylase treatment for potentially contaminated samples. It is important to note that the number of parameters and their range hinder us from making simple general statements about the amount of coverage or extent of deamination required for accurate estimates of present-day human contamination or accurate inference of the endogenous genome sequence. Although our study focused on human mitochondrial aDNA data, schmutzi can be applied to any other haploid aDNA dataset for which a reference genome is available. This includes non-human mitochondrial genomes, as well as viral, bacterial and chloroplast genomes.</p>
    <p>Although many groups have implemented ad hoc methods to assess contamination, there are few available software implementations. We compared schmutzi to contamMix, a previously used maximum-likelihood method described in [<xref ref-type="bibr" rid="CR14">14</xref>]. The predicted contamination rates produced by our algorithm are more accurate than those produced by this method on simulated data (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results, Section 2.3.6). Although the true contamination rate is not known for most ancient datasets, we have shown that our estimates are also consistent with contamination measured in empirical datasets using methods relying on diagnostic positions. While the approach of taking diagnostic positions is suitable for archaic humans like Neanderthals, it is not readily applicable to early modern humans, who have few fixed differences to present-day humans. Schmutzi’s modeling of mismatches due to deamination, sequencing errors and mismapping results in greater accuracy than simply estimating a single error parameter.</p>
    <p>Our endogenous consensus call shows a significant dependence on the prior, which is calculated based on the deamination patterns only for the first iteration (contDeam). We interpret this as evidence that a reasonable estimate for contamination can be obtained from deamination. For contDeam, we have also evaluated the impact on the final estimate due to biases like insufficient deamination and having deamination for contaminant fragments (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results Section 2.3.4). We do, however, notice that the contamination estimate improves incrementally during iteration of consensus calling and contamination estimation, suggesting that additional information is available in the mitochondrial endogenous consensus. This is particularly useful for low coverage samples.</p>
    <p>Schmutzi accurately infers the endogenous ancient genome sequence from unfiltered ancient sequence data. This is of particular importance when the contamination is high. Interestingly, schmutzi is also more accurate than approaches that reduce contamination by using only deaminated fragments to call the consensus. Such approaches substantially reduce the number of fragments available for calling the consensus, which may explain why schmutzi is marginally better at determining the consensus sequence.</p>
    <p>Although schmutzi performs well for both simulated and empirical data, a few artifacts are not currently modeled in the software. First, it is possible that there are multiple present-day human contaminants. At low contamination rates with multiple contaminants, schmutzi will underestimate the contamination, but the inference of the endogenous consensus sequence should not be affected. However, at high contamination rates, multiple contaminants make the inference of the endogenous sequence and estimation of the contamination extremely difficult, since the endogenous and contaminant alleles do not follow the expected distributions. Second, inclusion of misaligned microbial sequences and mitochondrial heteroplasmy are also not currently considered in the computation, though the empirical data suggest that schmutzi is not particularly sensitive to these. Lastly, the use of target enrichment approaches with DNA probes that are closer to the contaminant than to the endogenous sequence may cause differences in allele sampling, and may lead to incorrect consensus calls (see Fig. <xref rid="Fig4" ref-type="fig">4</xref> and Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Section 2.2.3 for further discussion about the capture bias).</p>
    <p>Schmutzi is sensitive to the divergence between the actual contaminant and the closest record in the database of putative contaminants. If this divergence is very large (e.g., more than 30 mismatches), contamination will be underestimated.</p>
    <p>When contamination rates are high, the predicted contaminant can be inferred at high resolution. This enables the program to use this predicted contaminant as a database record for the quantification of mitochondrial contamination (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Results). This is not feasible at low contamination rates, where the prediction of the contaminant mtDNA is poor. Our method does not currently use phylogenetic information to infer the endogenous and contaminant sequences. Although our approach works well empirically, the use of phylogenetic information could provide additional power for obtaining contamination estimates in very low coverage samples.</p>
    <p>In conclusion, we have described an algorithm that infers the endogenous mitochondrial genome sequence from an aDNA sample, even in the presence of high contamination. We have applied this to the reconstruction of mitochondrial genomes for archaic and early modern humans and show that it is possible to quantify accurately contamination from present-day individuals.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Additional file</title>
    <sec id="Sec19">
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="13059_2015_776_MOESM1_ESM.pdf">
          <label>Additional file 1</label>
          <caption>
            <p><bold>Supplementary material.</bold> (PDF 2232 kb)</p>
          </caption>
        </media>
      </supplementary-material>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>aDNA</term>
        <def>
          <p>Ancient DNA</p>
        </def>
      </def-item>
      <def-item>
        <term>MIA</term>
        <def>
          <p>Mapping iterative assembler</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Competing interests</bold>
      </p>
      <p>The authors declare that they have no competing interests.</p>
    </fn>
    <fn>
      <p>
        <bold>Authors’ contributions</bold>
      </p>
      <p>GR developed, implemented and tested the algorithm. VS provided aDNA sequencing expertise and test data. ATD helped with haplogroup determination, built the database of putative mitochondrial contaminants and reviewed the manuscript. JK provided guidance for the project. GR, VS and JK wrote the manuscript. All authors read and approved the final manuscript.</p>
    </fn>
  </fn-group>
  <ack>
    <p>We would like to acknowledge the help of Udo Stenzel, Matthias Meyer, Marie Gansauge, Michael Dannemann and the entire Ancient DNA Methods group at the Max Planck Institute of Evolutionary Anthropology for their expertise. We would like to thank Fernando Racimo and Montgomery Slatkin for their useful input. We are also indebted to Joana Rocha, Susanna Sawyer and Johann Visagie for their help in testing the software and expertise regarding mitochondrial genomes. We are also grateful to Anahita Kazem for proofreading parts of our manuscript. We acknowledge the Max Planck Society for funding and Natural Sciences and Engineering Research Council of Canada (NSERC) for a PGS D scholarship.</p>
  </ack>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prüfer</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Stenzel</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Hofreiter</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pääbo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kelso</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>RE</given-names>
          </name>
        </person-group>
        <article-title>Computational challenges in the analysis of ancient DNA</article-title>
        <source>Genome Biol</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>47</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2010-11-5-r47</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Briggs</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Stenzel</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>PL</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Kelso</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Prüfer</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Patterns of damage in genomic DNA sequences from a Neandertal</article-title>
        <source>Proc Natl Acad Sci</source>
        <year>2007</year>
        <volume>104</volume>
        <fpage>14616</fpage>
        <lpage>21</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0704665104</pub-id>
        <?supplied-pmid 17715061?>
        <pub-id pub-id-type="pmid">17715061</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Poinar</surname>
            <given-names>HN</given-names>
          </name>
          <name>
            <surname>Schwarz</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Qi</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Shapiro</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>MacPhee</surname>
            <given-names>RD</given-names>
          </name>
          <name>
            <surname>Buigues</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metagenomics to paleogenomics: large-scale sequencing of mammoth DNA</article-title>
        <source>Science</source>
        <year>2006</year>
        <volume>311</volume>
        <fpage>392</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1123360</pub-id>
        <?supplied-pmid 16368896?>
        <pub-id pub-id-type="pmid">16368896</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bandelt</surname>
            <given-names>HJ</given-names>
          </name>
        </person-group>
        <article-title>Mosaics of ancient mitochondrial DNA: positive indicators of nonauthenticity</article-title>
        <source>Eur J Hum Genet</source>
        <year>2005</year>
        <volume>13</volume>
        <fpage>1106</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/sj.ejhg.5201476</pub-id>
        <?supplied-pmid 16077732?>
        <pub-id pub-id-type="pmid">16077732</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wall</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>Inconsistencies in Neanderthal genomic DNA sequences</article-title>
        <source>PLoS Genet</source>
        <year>2007</year>
        <volume>3</volume>
        <fpage>175</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.0030175</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Parks</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lambert</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Impacts of low coverage depths and post-mortem DNA damage on variant calling: a simulation study</article-title>
        <source>BMC Genomics</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>19</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-015-1219-8</pub-id>
        <?supplied-pmid 25613391?>
        <pub-id pub-id-type="pmid">25613391</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Green</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Malaspinas</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Briggs</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>PL</given-names>
          </name>
          <name>
            <surname>Uhler</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A complete Neandertal mitochondrial genome sequence determined by high-throughput sequencing</article-title>
        <source>Cell</source>
        <year>2008</year>
        <volume>134</volume>
        <fpage>416</fpage>
        <lpage>26</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2008.06.021</pub-id>
        <?supplied-pmid 18692465?>
        <pub-id pub-id-type="pmid">18692465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sawyer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Guschanski</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Savolainen</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Pääbo</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Temporal patterns of nucleotide misincorporations and DNA fragmentation in ancient DNA</article-title>
        <source>PLoS One</source>
        <year>2012</year>
        <volume>7</volume>
        <fpage>34131</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0034131</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Skoglund</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Northoff</surname>
            <given-names>BH</given-names>
          </name>
          <name>
            <surname>Shunkov</surname>
            <given-names>MV</given-names>
          </name>
          <name>
            <surname>Derevianko</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Pääbo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Separating endogenous ancient DNA from modern day contamination in a Siberian Neandertal</article-title>
        <source>Proc Natl Acad Sci</source>
        <year>2014</year>
        <volume>111</volume>
        <fpage>2229</fpage>
        <lpage>34</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1318934111</pub-id>
        <?supplied-pmid 24469802?>
        <pub-id pub-id-type="pmid">24469802</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meyer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Aximu-Petri</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Glocke</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Nickel</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Arsuaga</surname>
            <given-names>JL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A mitochondrial genome sequence of a hominin from Sima de los Huesos</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>505</volume>
        <fpage>403</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/nature12788</pub-id>
        <?supplied-pmid 24305051?>
        <pub-id pub-id-type="pmid">24305051</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Green</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ptak</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Briggs</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Ronan</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Simons</surname>
            <given-names>JF</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Analysis of one million base pairs of Neanderthal DNA</article-title>
        <source>Nature</source>
        <year>2006</year>
        <volume>444</volume>
        <fpage>330</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/nature05336</pub-id>
        <?supplied-pmid 17108958?>
        <pub-id pub-id-type="pmid">17108958</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prüfer</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Racimo</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Jay</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Sankararaman</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Sawyer</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The complete genome sequence of a Neanderthal from the Altai mountains</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>505</volume>
        <fpage>43</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/nature12886</pub-id>
        <?supplied-pmid 24352235?>
        <pub-id pub-id-type="pmid">24352235</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Olalde</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Allentoft</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Sánchez-Quinto</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Santpere</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Chiang</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>DeGiorgio</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Derived immune and ancestral pigmentation alleles in a 7,000-year-old Mesolithic European</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>507</volume>
        <fpage>225</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="doi">10.1038/nature12960</pub-id>
        <?supplied-pmid 24463515?>
        <pub-id pub-id-type="pmid">24463515</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Mittnik</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>PL</given-names>
          </name>
          <name>
            <surname>Bos</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Lari</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bollongino</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A revised timescale for human evolution based on ancient mitochondrial genomes</article-title>
        <source>Curr Biol</source>
        <year>2013</year>
        <volume>23</volume>
        <fpage>553</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cub.2013.02.044</pub-id>
        <?supplied-pmid 23523248?>
        <pub-id pub-id-type="pmid">23523248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jónsson</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Ginolhac</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schubert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>PL</given-names>
          </name>
          <name>
            <surname>Orlando</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>mapDamage2. 0: fast approximate Bayesian estimates of ancient DNA damage parameters</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <fpage>1682</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btt193</pub-id>
        <?supplied-pmid 23613487?>
        <pub-id pub-id-type="pmid">23613487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Helgason</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Palsson</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lalueza-Fox</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Ghosh</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Sigurdardottir</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Baker</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A statistical approach to identify ancient template DNA</article-title>
        <source>J Mol Evol</source>
        <year>2007</year>
        <volume>65</volume>
        <fpage>92</fpage>
        <lpage>102</lpage>
        <pub-id pub-id-type="doi">10.1007/s00239-006-0259-8</pub-id>
        <?supplied-pmid 17593420?>
        <pub-id pub-id-type="pmid">17593420</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korneliussen</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Albrechtsen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Nielsen</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>ANGSD: analysis of next generation sequencing data</article-title>
        <source>BMC Bioinforma</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>356</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-014-0356-4</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18</label>
      <mixed-citation publication-type="other">Joint estimation of contamination for ancient DNA and endogenous mitochondrial genome inference. <ext-link ext-link-type="uri" xlink:href="https://bioinf.eva.mpg.de/schmutzi/">https://bioinf.eva.mpg.de/schmutzi/</ext-link>. Access date Sept 30th.</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Moorjani</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Jay</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Slepchenko</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Bondarev</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome sequence of a 45,000-year-old modern human from western Siberia</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>514</volume>
        <fpage>445</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/nature13810</pub-id>
        <?supplied-pmid 25341783?>
        <pub-id pub-id-type="pmid">25341783</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meyer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kircher</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gansauge</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Racimo</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Mallick</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A high-coverage genome sequence from an archaic Denisovan individual</article-title>
        <source>Science</source>
        <year>2012</year>
        <volume>338</volume>
        <fpage>222</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1224344</pub-id>
        <?supplied-pmid 22936568?>
        <pub-id pub-id-type="pmid">22936568</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gansauge</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Selective enrichment of damaged DNA molecules for ancient genome sequencing</article-title>
        <source>Genome Res</source>
        <year>2014</year>
        <volume>24</volume>
        <fpage>1543</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.174201.114</pub-id>
        <?supplied-pmid 25081630?>
        <pub-id pub-id-type="pmid">25081630</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lazaridis</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Mittnik</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Renaud</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Mallick</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kirsanow</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ancient human genomes suggest three ancestral populations for present-day Europeans</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>513</volume>
        <fpage>409</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="doi">10.1038/nature13673</pub-id>
        <?supplied-pmid 25230663?>
        <pub-id pub-id-type="pmid">25230663</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duggan</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Whitten</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wiebe</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Crawford</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Butthof</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Spitsyn</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Investigating the prehistory of Tungusic peoples of Siberia and the Amur-Ussuri Region with complete mtDNA genome sequences and Y-chromosomal markers</article-title>
        <source>PloS One</source>
        <year>2013</year>
        <volume>8</volume>
        <fpage>83570</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0083570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Barbieri</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Vicente</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Bostoen</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Rocha</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Stoneking</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Migration and interaction in a contact zone: mtDNA variation among Bantu-speakers in southern Africa</article-title>
        <source>PloS One</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>99117</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0099117</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>David</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Dzamba</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lister</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Ilie</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Brudno</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>SHRiMP2: sensitive yet practical short read mapping</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1011</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr046</pub-id>
        <?supplied-pmid 21278192?>
        <pub-id pub-id-type="pmid">21278192</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Oven</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kayser</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Updated comprehensive phylogenetic tree of global human mitochondrial DNA variation</article-title>
        <source>Hum Mutat</source>
        <year>2009</year>
        <volume>30</volume>
        <fpage>386</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1002/humu.20921</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kloss-Brandstätter</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pacher</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schönherr</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Weissensteiner</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Binna</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Specht</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>HaploGrep: a fast and reliable algorithm for automatic classification of mitochondrial DNA haplogroups</article-title>
        <source>Hum Mutat</source>
        <year>2011</year>
        <volume>32</volume>
        <fpage>25</fpage>
        <lpage>32</lpage>
        <pub-id pub-id-type="doi">10.1002/humu.21382</pub-id>
        <?supplied-pmid 20960467?>
        <pub-id pub-id-type="pmid">20960467</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28</label>
      <mixed-citation publication-type="other">C library for high-throughput sequencing data formats. <ext-link ext-link-type="uri" xlink:href="https://github.com/samtools/htslib">https://github.com/samtools/htslib</ext-link>. Access date Sept 30th.</mixed-citation>
    </ref>
    <ref id="CR29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Green</surname>
            <given-names>RE</given-names>
          </name>
          <name>
            <surname>Briggs</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Prüfer</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Burbano</surname>
            <given-names>HA</given-names>
          </name>
          <name>
            <surname>Siebauer</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The Neandertal genome and ancient DNA authenticity</article-title>
        <source>EMBO J</source>
        <year>2009</year>
        <volume>28</volume>
        <fpage>2494</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/emboj.2009.222</pub-id>
        <?supplied-pmid 19661919?>
        <pub-id pub-id-type="pmid">19661919</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Good</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Viola</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Shunkov</surname>
            <given-names>MV</given-names>
          </name>
          <name>
            <surname>Derevianko</surname>
            <given-names>AP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The complete mitochondrial DNA genome of an unknown hominin from southern Siberia</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>464</volume>
        <fpage>894</fpage>
        <lpage>7</lpage>
        <pub-id pub-id-type="doi">10.1038/nature08976</pub-id>
        <?supplied-pmid 20336068?>
        <pub-id pub-id-type="pmid">20336068</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nakamura</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Oshima</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Morimoto</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ikeda</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Yoshikawa</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Shiwa</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sequence-specific error profile of Illumina sequencers</article-title>
        <source>Nucleic Acids Res</source>
        <year>2011</year>
        <volume>39</volume>
        <fpage>90</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkr344</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Garcia-Garcera</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gigli</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Sanchez-Quinto</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Ramirez</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Calafell</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Civit</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fragmentation of contaminant and endogenous DNA in ancient samples determined by shotgun sequencing; prospects for human palaeogenomics</article-title>
        <source>PloS One</source>
        <year>2011</year>
        <volume>6</volume>
        <fpage>24161</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0024161</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Renaud</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Stenzel</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Kelso</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>leeHom: adaptor trimming and merging for Illumina sequencing reads</article-title>
        <source>Nucleic Acids Res</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>141</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku699</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rohland</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Harney</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mallick</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nordenfelt</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Partial uracil-DNA-glycosylase treatment for screening of ancient DNA</article-title>
        <source>Philos Trans R Soc London B: Biol Sci</source>
        <year>2015</year>
        <volume>370</volume>
        <fpage>20130624</fpage>
        <pub-id pub-id-type="doi">10.1098/rstb.2013.0624</pub-id>
        <pub-id pub-id-type="pmid">25487342</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
