<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS Genet</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS Genet</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosgen</journal-id>
    <journal-title-group>
      <journal-title>PLoS Genetics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1553-7390</issn>
    <issn pub-type="epub">1553-7404</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7704051</article-id>
    <article-id pub-id-type="pmid">33196638</article-id>
    <article-id pub-id-type="publisher-id">PGENETICS-D-19-01408</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pgen.1009049</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Heredity</subject>
            <subj-group>
              <subject>Genetic Mapping</subject>
              <subj-group>
                <subject>Haplotypes</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Computational Biology</subject>
          <subj-group>
            <subject>Genome Analysis</subject>
            <subj-group>
              <subject>Genome-Wide Association Studies</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genome Analysis</subject>
              <subj-group>
                <subject>Genome-Wide Association Studies</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Human Genetics</subject>
            <subj-group>
              <subject>Genome-Wide Association Studies</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Probability theory</subject>
            <subj-group>
              <subject>Markov models</subject>
              <subj-group>
                <subject>Hidden Markov models</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Social Sciences</subject>
        <subj-group>
          <subject>Sociology</subject>
          <subj-group>
            <subject>Consortia</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Applied Mathematics</subject>
            <subj-group>
              <subject>Algorithms</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Simulation and Modeling</subject>
          <subj-group>
            <subject>Algorithms</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Molecular Biology</subject>
          <subj-group>
            <subject>Molecular Biology Techniques</subject>
            <subj-group>
              <subject>Gene Mapping</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Molecular Biology Techniques</subject>
          <subj-group>
            <subject>Gene Mapping</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Molecular Biology</subject>
          <subj-group>
            <subject>Molecular Biology Techniques</subject>
            <subj-group>
              <subject>Genotyping</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Molecular Biology Techniques</subject>
          <subj-group>
            <subject>Genotyping</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Genotype imputation using the Positional Burrows Wheeler Transform</article-title>
      <alt-title alt-title-type="running-head">Genotype imputation using the PBWT</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7725-4813</contrib-id>
        <name>
          <surname>Rubinacci</surname>
          <given-names>Simone</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Conceptualization</role>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3906-8446</contrib-id>
        <name>
          <surname>Delaneau</surname>
          <given-names>Olivier</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-0610-8322</contrib-id>
        <name>
          <surname>Marchini</surname>
          <given-names>Jonathan</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Conceptualization</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Supervision</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of Computational Biology, University of Lausanne, Lausanne, Switzerland</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Swiss Institute of Bioinformatics, University of Lausanne, Lausanne, Switzerland</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Regeneron Genetics Center, Tarrytown, New York, USA</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Scheet</surname>
          <given-names>Paul</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>University of Texas MD Anderson Cancer Center, UNITED STATES</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>jonathan.marchini@regeneron.com</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>16</day>
      <month>11</month>
      <year>2020</year>
    </pub-date>
    <volume>16</volume>
    <issue>11</issue>
    <elocation-id>e1009049</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>8</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>8</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 Rubinacci et al</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Rubinacci et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pgen.1009049.pdf"/>
    <abstract>
      <p>Genotype imputation is the process of predicting unobserved genotypes in a sample of individuals using a reference panel of haplotypes. In the last 10 years reference panels have increased in size by more than 100 fold. Increasing reference panel size improves accuracy of markers with low minor allele frequencies but poses ever increasing computational challenges for imputation methods. Here we present IMPUTE5, a genotype imputation method that can scale to reference panels with millions of samples. This method continues to refine the observation made in the IMPUTE2 method, that accuracy is optimized via use of a custom subset of haplotypes when imputing each individual. It achieves fast, accurate, and memory-efficient imputation by selecting haplotypes using the Positional Burrows Wheeler Transform (PBWT). By using the PBWT data structure at genotyped markers, IMPUTE5 identifies locally best matching haplotypes and long identical by state segments. The method then uses the selected haplotypes as conditioning states within the IMPUTE model. Using the HRC reference panel, which has ∼65,000 haplotypes, we show that IMPUTE5 is up to 30x faster than MINIMAC4 and up to 3x faster than BEAGLE5.1, and uses less memory than both these methods. Using simulated reference panels we show that IMPUTE5 scales sub-linearly with reference panel size. For example, keeping the number of imputed markers constant, increasing the reference panel size from 10,000 to 1 million haplotypes requires less than twice the computation time. As the reference panel increases in size IMPUTE5 is able to utilize a smaller number of reference haplotypes, thus reducing computational cost.</p>
    </abstract>
    <abstract abstract-type="summary">
      <title>Author summary</title>
      <p>Genome-wide association studies (GWAS) typically use microarray technology to measure genotypes at several hundred thousand positions in the genome. However reference panels of genetic variation consist of haplotype data at &gt;100 fold more positions in the genome. Genotype imputation makes genotype predictions at all the reference panel sites using the GWAS data. Reference panels are continuing to grow in size and this improves accuracy of the predictions, however methods need to be able to scale this increased size. We have developed a new version of the popular IMPUTE software than can handle reference panels with millions of haplotypes, and has better performance than other published approaches. A notable property of the new method is that it scales sub-linearly with reference panel size. Keeping the number of imputed markers constant, a 100 fold increase in reference panel size requires less than twice the computation time.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100000781</institution-id>
            <institution>European Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>617306</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-0610-8322</contrib-id>
          <name>
            <surname>Marchini</surname>
            <given-names>Jonathan</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100000266</institution-id>
            <institution>Engineering and Physical Sciences Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>EP/G03706X/1</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7725-4813</contrib-id>
          <name>
            <surname>Rubinacci</surname>
            <given-names>Simone</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>SR was supported by the UK EPSRC <ext-link ext-link-type="uri" xlink:href="https://epsrc.ukri.org">https://epsrc.ukri.org</ext-link> grant EP/G03706X/1. JM acknowledges support from the ERC <ext-link ext-link-type="uri" xlink:href="https://erc.europa.eu">https://erc.europa.eu</ext-link> (Grant no. 617306). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="5"/>
      <table-count count="5"/>
      <page-count count="19"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>PLOS Publication Stage</meta-name>
        <meta-value>vor-update-to-uncorrected-proof</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>Publication Update</meta-name>
        <meta-value>2020-11-30</meta-value>
      </custom-meta>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>The HRC Dataset is a combination of genetic data from 20 unique studies, each with their own data sharing policies and restrictions. These restrictions do not allow for the dataset to be shared in a completely unrestricted way. However, readers may apply for access (for the purposes of phasing and imputation only) from EGA <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/ega/studies/EGAS00001001710">https://www.ebi.ac.uk/ega/studies/EGAS00001001710</ext-link>.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>The HRC Dataset is a combination of genetic data from 20 unique studies, each with their own data sharing policies and restrictions. These restrictions do not allow for the dataset to be shared in a completely unrestricted way. However, readers may apply for access (for the purposes of phasing and imputation only) from EGA <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/ega/studies/EGAS00001001710">https://www.ebi.ac.uk/ega/studies/EGAS00001001710</ext-link>.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Genotype imputation is a widely used method in human genetic studies that infers unobserved genotypes in a sample of individuals. In a typical scenario, the study samples are genotyped on a SNP microarray with between 300,000 to 5 million markers. This data is then combined with a reference panel of haplotypes with many tens of millions of markers, and a statistical model is used to predict the genotypes at these markers in the study samples [<xref rid="pgen.1009049.ref001" ref-type="bibr">1</xref>].</p>
    <p>One of the main applications of genotype imputation is to increase the resolution of genome-wide association studies (GWAS). Imputed datasets increase the number of markers that can be tested for association. For example, in the UK Biobank dataset [<xref rid="pgen.1009049.ref002" ref-type="bibr">2</xref>] imputation increased the number of testable markers from 825,927 to over 96 million. This increased number of SNPs can boost the power of the study. Genotype imputation also facilitates meta-analysis across cohorts that are often genotyped using different SNP microarrays. Imputation from the same reference panel standardizes the set of testable markers, allows simple integration of data and/or results across studies [<xref rid="pgen.1009049.ref003" ref-type="bibr">3</xref>]. Imputation can also be used to predict markers necessary to calculate polygenic risks scores (PRSs), which typically involve a weighted sum of genotypes across the genome.</p>
    <p>Many different methods have been proposed over the years [<xref rid="pgen.1009049.ref004" ref-type="bibr">4</xref>], however the most widely used and accurate methods are based on Hidden Markov Models (HMM). Typically the study samples will have been phased in advance using accurate methods [<xref rid="pgen.1009049.ref005" ref-type="bibr">5</xref>–<xref rid="pgen.1009049.ref007" ref-type="bibr">7</xref>], and this has become known as ‘pre-phasing’ [<xref rid="pgen.1009049.ref008" ref-type="bibr">8</xref>]. The imputation HMM is then used to model the sharing of sequence between the haplotypes in the study sample (which we refer to as the <italic>target haplotypes</italic>) and the haplotypes in the reference panel. The HMM models each study haplotype as an imperfect mosaic of haplotypes in the reference panel [<xref rid="pgen.1009049.ref001" ref-type="bibr">1</xref>]. The output of the HMM at each position in the genome is a vector of copying probabilities for each haplotype in the reference panel. For each of the markers in the reference panel these are used to make a weighted prediction of the unobserved allele at the markers.</p>
    <p>One of the most important factors that determines imputation quality is the number of haplotypes in the reference panel. As the number of haplotypes increases, each study sample haplotype is able to find fewer longer stretches of matching sequence in the reference panel, which increases the accuracy. <xref rid="pgen.1009049.t001" ref-type="table">Table 1</xref> shows how reference panel size has increased over the years due to projects such as the International HapMap Project [<xref rid="pgen.1009049.ref009" ref-type="bibr">9</xref>], the 1000 Genomes Project (1000G) [<xref rid="pgen.1009049.ref010" ref-type="bibr">10</xref>], the UK10K Project [<xref rid="pgen.1009049.ref011" ref-type="bibr">11</xref>], and the Haplotype Reference Consortium (HRC) [<xref rid="pgen.1009049.ref012" ref-type="bibr">12</xref>]. Soon larger reference panels will become available from the Trans-Omics for Precision Medicine (TOPMed) program [<xref rid="pgen.1009049.ref013" ref-type="bibr">13</xref>] and the 100,000 Genomes Project [<xref rid="pgen.1009049.ref014" ref-type="bibr">14</xref>], both of which will exceed 100,000 high-coverage whole genome sequenced samples. Further ahead, as sequencing data on all 500,000 participants of the UK Biobank [<xref rid="pgen.1009049.ref002" ref-type="bibr">2</xref>] becomes available, this will be used as an even larger reference panel.</p>
    <table-wrap id="pgen.1009049.t001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.t001</object-id>
      <label>Table 1</label>
      <caption>
        <title>Evolution of commonly used imputation reference panels over time.</title>
      </caption>
      <alternatives>
        <graphic id="pgen.1009049.t001g" xlink:href="pgen.1009049.t001"/>
        <table frame="box" rules="all" border="0">
          <colgroup span="1">
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">Reference panel</th>
              <th align="left" rowspan="1" colspan="1">Released Year</th>
              <th align="left" rowspan="1" colspan="1">Number of Samples</th>
              <th align="left" rowspan="1" colspan="1">Number of Markers (Millions)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" rowspan="1" colspan="1">HapMap Project phase 3</td>
              <td align="left" rowspan="1" colspan="1">2009</td>
              <td align="left" rowspan="1" colspan="1">1,011</td>
              <td align="char" char="." rowspan="1" colspan="1">1.4</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">1000 Genomes phase 1</td>
              <td align="left" rowspan="1" colspan="1">2012</td>
              <td align="left" rowspan="1" colspan="1">1,092</td>
              <td align="char" char="." rowspan="1" colspan="1">29.0</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">1000 Genomes phase 3</td>
              <td align="left" rowspan="1" colspan="1">2014</td>
              <td align="left" rowspan="1" colspan="1">2,504</td>
              <td align="char" char="." rowspan="1" colspan="1">81.7</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">UK10K Project</td>
              <td align="left" rowspan="1" colspan="1">2015</td>
              <td align="left" rowspan="1" colspan="1">3,781</td>
              <td align="char" char="." rowspan="1" colspan="1">42.0</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">HRC</td>
              <td align="left" rowspan="1" colspan="1">2016</td>
              <td align="left" rowspan="1" colspan="1">32,470</td>
              <td align="char" char="." rowspan="1" colspan="1">40.4</td>
            </tr>
          </tbody>
        </table>
      </alternatives>
    </table-wrap>
    <p>In this paper we present IMPUTE5, a genotype imputation method designed to handle the new generation of reference panels. To achieve this, the method builds on three main components: (i) the use of a new reference panel file format, allowing fast access to data in specific chromosome regions (ii) the use of the PBWT [<xref rid="pgen.1009049.ref015" ref-type="bibr">15</xref>] to select a subset of reference panel haplotypes and reduce the state space in the IMPUTE model [<xref rid="pgen.1009049.ref016" ref-type="bibr">16</xref>] (iii) imputation during output directly into the BGEN [<xref rid="pgen.1009049.ref017" ref-type="bibr">17</xref>] file format that is specifically designed for imputation data.</p>
    <p>To demonstrate the superior performance of IMPUTE5, we benchmark our imputation method against IMPUTE4 [<xref rid="pgen.1009049.ref002" ref-type="bibr">2</xref>], MINIMAC4 [<xref rid="pgen.1009049.ref018" ref-type="bibr">18</xref>] and BEAGLE5.1 [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>], using simulated reference panels up to 1,000,000 haplotypes in size, and real reference panels such as the 1000 Genomes project reference panel [<xref rid="pgen.1009049.ref010" ref-type="bibr">10</xref>] and the Haplotype Reference Consortium [<xref rid="pgen.1009049.ref012" ref-type="bibr">12</xref>].</p>
  </sec>
  <sec sec-type="materials|methods" id="sec002">
    <title>Materials and methods</title>
    <sec id="sec003">
      <title>PBWT</title>
      <p>The main methodological advance in this paper is the incorporation of the PBWT [<xref rid="pgen.1009049.ref015" ref-type="bibr">15</xref>] into the IMPUTE model. This section provides some brief background on the PBWT needed to describe the IMPUTE5 method. The PBWT is a generic way to encode binary matrices, especially useful in the case of haplotypes at a set of binary markers, each with two alleles arbitrarily coded as 0 and 1. Let <italic>H</italic> = {<italic>h</italic><sub>0</sub>, <italic>h</italic><sub>1</sub>, …, <italic>h</italic><sub><italic>N</italic>−1</sub>} be a set of <italic>N</italic> haplotypes genotyped at <italic>M</italic> markers, <italic>h</italic><sub><italic>n</italic></sub> = {<italic>h</italic><sub><italic>n</italic>,0</sub>, <italic>h</italic><sub><italic>n</italic>,1</sub>, …, <italic>h</italic><sub><italic>n</italic>,<italic>M</italic>−1</sub>}, where <italic>h</italic><sub><italic>n</italic>,<italic>m</italic></sub> ∈ {0, 1}, represents the <italic>n</italic>th haplotype. <italic>H</italic> can be thought as a <italic>N</italic> × <italic>M</italic> binary matrix: each entry of the matrix is defined by the reference haplotype (row) and marker (column). For this reason, we refer to <italic>H</italic> using the usual matrix notation.</p>
      <p>The PBWT of <italic>H</italic>, indicated as <italic>Y</italic>, is another <italic>N</italic> × <italic>M</italic> binary matrix, where the <italic>m</italic>-th column of <italic>Y</italic> is an invertible transformation of the <italic>m</italic>-th column of <italic>H</italic>. In its basic form, <italic>Y</italic> is complemented by another <italic>N</italic> × (<italic>M</italic> + 1) matrix <italic>A</italic>, where every column <italic>A</italic><sub>:,<italic>m</italic></sub>, called the <italic>positional prefix array</italic>, is a permutation of {0, …, <italic>N</italic> − 1} which defines the reverse prefix order of the haplotypes in <italic>H</italic> up to marker <italic>m</italic> − 1.</p>
      <p>Using a similar notation as in [<xref rid="pgen.1009049.ref020" ref-type="bibr">20</xref>], we define the binary string <inline-formula id="pgen.1009049.e001"><alternatives><graphic xlink:href="pgen.1009049.e001.jpg" id="pgen.1009049.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> as the reverse prefix of the <italic>n</italic>-th haplotype ending at marker <italic>m</italic>:
<disp-formula id="pgen.1009049.e002"><alternatives><graphic xlink:href="pgen.1009049.e002.jpg" id="pgen.1009049.e002g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M2"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
and let be <inline-formula id="pgen.1009049.e003"><alternatives><graphic xlink:href="pgen.1009049.e003.jpg" id="pgen.1009049.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:msub><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mo>}</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:msub></mml:math></alternatives></inline-formula> be the set of all the <italic>N</italic> reverse prefixes at marker <italic>m</italic>. We then define <italic>A</italic><sub><italic>n</italic>,<italic>m</italic></sub> to be the index of the <italic>n</italic>-th lexicographically sorted reverse prefix along the set <inline-formula id="pgen.1009049.e004"><alternatives><graphic xlink:href="pgen.1009049.e004.jpg" id="pgen.1009049.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:msub><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mo>}</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:msub></mml:math></alternatives></inline-formula>. <italic>A</italic><sub>:,<italic>m</italic></sub> represents a bijection on {0, …, <italic>N</italic> − 1} and thus is invertible. As a special case, we define <italic>A</italic><sub><italic>n</italic>,−1</sub> = <italic>n</italic>, representing the order of empty reverse prefixes.</p>
      <p>The PBWT of <italic>H</italic> is directly derivable from <italic>H</italic> and the prefix array <italic>A</italic>:
<disp-formula id="pgen.1009049.e005"><alternatives><graphic xlink:href="pgen.1009049.e005.jpg" id="pgen.1009049.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
in other words, the PBWT at marker <italic>m</italic> is the vector of values of the haplotypes in <italic>H</italic> at marker <italic>m</italic>, (<italic>H</italic><sub>:,<italic>m</italic></sub>), in the order defined by the reverse prefix array at marker <italic>m</italic> − 1, <italic>A</italic><sub>:,<italic>m</italic>−1</sub>.</p>
      <p>One use of <italic>Y</italic><sub>:,<italic>m</italic></sub> is to update <italic>A</italic><sub>:,<italic>m</italic>−1</sub> to <italic>A</italic><sub>:,<italic>m</italic></sub>. Suppose <italic>b</italic> is a symbol, <italic>b</italic> ∈ {0, 1}. We can define a mapping between positional prefix array at markers <italic>m</italic> − 1 and <italic>m</italic>:
<disp-formula id="pgen.1009049.e006"><alternatives><graphic xlink:href="pgen.1009049.e006.jpg" id="pgen.1009049.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(3)</label></disp-formula>
where <italic>c</italic><sub><italic>m</italic></sub>(<italic>b</italic>) gives the number of symbols in <italic>Y</italic><sub>:,<italic>m</italic></sub> that are lexicographically smaller than <italic>b</italic> and <italic>rank</italic><sub><italic>m</italic></sub>(<italic>b</italic>, <italic>n</italic>) the number of <italic>b</italic> symbols in <italic>Y</italic><sub>:,<italic>m</italic></sub> before position <italic>n</italic>. The <italic>n</italic>-th haplotype in the positional prefix order at column <italic>m</italic> − 1 is ranked <italic>ϕ</italic><sub><italic>m</italic></sub>(<italic>n</italic>) in column <italic>m</italic>. Thus
<disp-formula id="pgen.1009049.e007"><alternatives><graphic xlink:href="pgen.1009049.e007.jpg" id="pgen.1009049.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(4)</label></disp-formula></p>
      <p>Eqs (<xref ref-type="disp-formula" rid="pgen.1009049.e005">2</xref>) and (<xref ref-type="disp-formula" rid="pgen.1009049.e007">4</xref>) give a procedural algorithm to compute <italic>A</italic><sub>:,<italic>m</italic></sub> and <italic>Y</italic><sub>:,<italic>m</italic></sub> from <italic>H</italic><sub>:,<italic>m</italic></sub> and <italic>A</italic><sub>:,<italic>m</italic>−1</sub>. Since there is strong correlation between adjacent markers in <italic>H</italic> due to linkage disequilibrium, there are long runs of the same symbol in the columns of <italic>Y</italic>. This makes columns of <italic>Y</italic> much more compressible than the columns of <italic>H</italic>.</p>
      <p><italic>Y</italic> and <italic>A</italic> represent only the basic form of the PBWT. It is possible to complement them by storing additional information such as the rank indices <italic>U</italic>, <italic>V</italic> (usually called FM index [<xref rid="pgen.1009049.ref021" ref-type="bibr">21</xref>]). Each column <italic>m</italic> of these two matrices store information about the <italic>rank</italic><sub><italic>m</italic></sub>(<italic>b</italic>, <italic>n</italic>) for symbol <italic>b</italic> = 0 and <italic>b</italic> = 1 respectively. It is also important to notice that there is no need to store both these matrices because it is possible to derive one from the other: <italic>rank</italic><sub><italic>m</italic></sub>(1 − <italic>b</italic>, <italic>n</italic>) = <italic>n</italic> + 1 − <italic>rank</italic><sub><italic>m</italic></sub>(<italic>b</italic>, <italic>n</italic>) since <italic>rank</italic><sub><italic>m</italic></sub>(0, <italic>n</italic>) + <italic>rank</italic><sub><italic>m</italic></sub>(1, <italic>n</italic>) = <italic>n</italic> + 1.</p>
      <p>Another important information that can be added is the divergence matrix <italic>D</italic>. Columns of <italic>D</italic> contain the position of the last (reverse prefix) mismatch between adjacent haplotypes in the order <italic>A</italic>. The value of <italic>D</italic><sub><italic>n</italic>,<italic>m</italic></sub> is defined to be the smallest value <italic>m</italic>′ such that <inline-formula id="pgen.1009049.e008"><alternatives><graphic xlink:href="pgen.1009049.e008.jpg" id="pgen.1009049.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> matches <inline-formula id="pgen.1009049.e009"><alternatives><graphic xlink:href="pgen.1009049.e009.jpg" id="pgen.1009049.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. In the case of a mismatch, the value of <italic>D</italic><sub><italic>n</italic>,<italic>m</italic></sub> is set to <italic>m</italic>. An important property is that the start of any maximal match ending at <italic>m</italic> between any {<inline-formula id="pgen.1009049.e010"><alternatives><graphic xlink:href="pgen.1009049.e010.jpg" id="pgen.1009049.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pgen.1009049.e011"><alternatives><graphic xlink:href="pgen.1009049.e011.jpg" id="pgen.1009049.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>}, (<italic>i</italic> &lt; <italic>j</italic>) is given by:
<disp-formula id="pgen.1009049.e012"><alternatives><graphic xlink:href="pgen.1009049.e012.jpg" id="pgen.1009049.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>n</mml:mi><mml:mo>≤</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(5)</label></disp-formula></p>
      <p>The cost of building a PBWT <italic>Y</italic> from <italic>H</italic> is <italic>O</italic>(<italic>NM</italic>), including all the complementary matrices described above. Using the PBWT indices, it is possible to find maximal matchings within <italic>H</italic> in linear time and find maximal matchings of a new sequence <italic>z</italic> in <italic>H</italic> in <italic>O</italic>(<italic>M</italic>), independently from the number of haplotypes in <italic>H</italic>.</p>
    </sec>
    <sec id="sec004">
      <title>IMPUTE model</title>
      <p>IMPUTE5 is a haploid imputation method, assumes that both the reference and study samples are phased and contain no missing alleles at any site. In what follows we will refer to the phased study samples as the <italic>target panel</italic> of haplotypes. IMPUTE5 uses the same HMM used in previous versions of the IMPUTE software [<xref rid="pgen.1009049.ref016" ref-type="bibr">16</xref>] that is based on the Li and Stephens model [<xref rid="pgen.1009049.ref022" ref-type="bibr">22</xref>]. Each reference haplotype represents a hidden state of the HMM. The model assumes that each target haplotype is an imperfect mosaic of haplotypes emitted from the sequence of hidden states representing the reference panel haplotypes. The changes from one state to another are modelled as recombination events and the observed target allele may differ from the alleles on the underlying true haplotypes to allow for mutation and genotype error.</p>
      <sec id="sec005">
        <title>HMM definition</title>
        <p>Let <italic>H</italic> be the set of <italic>N</italic> haplotypes genotyped at <italic>M</italic> markers, that have been selected as a subset from a reference panel of haplotypes. The way in which the <italic>N</italic> haplotypes are chosen in each window is described in a later section. We also have a set of <italic>K</italic> study sample (target) haplotypes, defined only at a subset of the <italic>M</italic> markers. We refer to the set of <italic>T</italic> markers that are genotyped in both the panels as <italic>target markers</italic> (<inline-formula id="pgen.1009049.e013"><alternatives><graphic xlink:href="pgen.1009049.e013.jpg" id="pgen.1009049.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>), and the others, present only in the reference panel, as <italic>reference markers</italic> (<inline-formula id="pgen.1009049.e014"><alternatives><graphic xlink:href="pgen.1009049.e014.jpg" id="pgen.1009049.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:mi mathvariant="script">R</mml:mi></mml:math></alternatives></inline-formula>). Consecutive pairs of haplotypes represent the diplotype of each study individual. We define the HMM model only at target markers. Therefore, we use the symbol <inline-formula id="pgen.1009049.e015"><alternatives><graphic xlink:href="pgen.1009049.e015.jpg" id="pgen.1009049.e015g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M15"><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup></mml:math></alternatives></inline-formula> to indicate the restriction of the reference panel <italic>H</italic> to target markers and we use the symbol <italic>m</italic> to indicate a marker in <inline-formula id="pgen.1009049.e016"><alternatives><graphic xlink:href="pgen.1009049.e016.jpg" id="pgen.1009049.e016g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M16"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>.</p>
        <p>Given a target haplotype <italic>t</italic> the probability of observing <italic>t</italic> from <inline-formula id="pgen.1009049.e017"><alternatives><graphic xlink:href="pgen.1009049.e017.jpg" id="pgen.1009049.e017g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M17"><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup></mml:math></alternatives></inline-formula> can be then written as:
<disp-formula id="pgen.1009049.e018"><alternatives><graphic xlink:href="pgen.1009049.e018.jpg" id="pgen.1009049.e018g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M18"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>Z</mml:mi></mml:munder><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>|</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(6)</label></disp-formula>
where <italic>Z</italic> is a sequence of unobserved copying labels, one for each target marker, <italic>Z</italic><sub><italic>m</italic></sub> ∈ {0, 1, …, <italic>N</italic> − 1} and the term <inline-formula id="pgen.1009049.e019"><alternatives><graphic xlink:href="pgen.1009049.e019.jpg" id="pgen.1009049.e019g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M19"><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> models sequence of transitions of the HMM and is defined by
<disp-formula id="pgen.1009049.e020"><alternatives><graphic xlink:href="pgen.1009049.e020.jpg" id="pgen.1009049.e020g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M20"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(7)</label></disp-formula>
<disp-formula id="pgen.1009049.e021"><alternatives><graphic xlink:href="pgen.1009049.e021.jpg" id="pgen.1009049.e021g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M21"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:mo>;</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(8)</label></disp-formula>
<disp-formula id="pgen.1009049.e022"><alternatives><graphic xlink:href="pgen.1009049.e022.jpg" id="pgen.1009049.e022g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M22"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>i</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:msub><mml:mi>ρ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mi>N</mml:mi></mml:mfrac><mml:mspace width="0.277778em"/></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="0.277778em"/><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mtext>,</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>ρ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mi>N</mml:mi></mml:mfrac><mml:mspace width="0.277778em"/><mml:mspace width="0.277778em"/></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="0.277778em"/><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(9)</label></disp-formula>
where <italic>ρ</italic><sub><italic>m</italic></sub> is a locus specific parameter modelling genetic recombination events, defined as <inline-formula id="pgen.1009049.e023"><alternatives><graphic xlink:href="pgen.1009049.e023.jpg" id="pgen.1009049.e023g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M23"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:mn>4</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>N</mml:mi></mml:mfrac></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>N</italic><sub><italic>e</italic></sub> is the effective diploid population size and <italic>r</italic><sub><italic>m</italic>+1</sub> − <italic>r</italic><sub><italic>m</italic></sub> is the average rate of crossover per unit physical distance per meiosis between target markers <italic>m</italic> + 1 and <italic>m</italic> multiplied by their physical distance. <xref ref-type="disp-formula" rid="pgen.1009049.e022">Eq (9)</xref> is motivated by the fact that recombination events can be described as a Poisson process having rate 4<italic>N</italic><sub><italic>e</italic></sub>(<italic>r</italic><sub><italic>m</italic>+1</sub> − <italic>r</italic><sub><italic>m</italic></sub>)/<italic>N</italic>.</p>
        <p>We model the emission probability <italic>Pr</italic>(<italic>t</italic>|<italic>Z</italic>) in <xref ref-type="disp-formula" rid="pgen.1009049.e018">Eq (6)</xref> differently to the standard IMPUTE model, and we adopt a simpler version as in the SHAPEIT4 model [<xref rid="pgen.1009049.ref006" ref-type="bibr">6</xref>], reducing the equation to:
<disp-formula id="pgen.1009049.e024"><alternatives><graphic xlink:href="pgen.1009049.e024.jpg" id="pgen.1009049.e024g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M24"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>|</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(10)</label></disp-formula>
<disp-formula id="pgen.1009049.e025"><alternatives><graphic xlink:href="pgen.1009049.e025.jpg" id="pgen.1009049.e025g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M25"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>9999</mml:mn><mml:mspace width="0.277778em"/><mml:mspace width="0.277778em"/><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>0001</mml:mn><mml:mspace width="0.277778em"/><mml:mspace width="0.277778em"/><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(11)</label></disp-formula>
where <italic>a</italic> ∈ {0, 1} is a haplotype value. It has been shown that imputation is relatively insensitive to the mutation parameter [<xref rid="pgen.1009049.ref023" ref-type="bibr">23</xref>], and we tested that the new emission probability slightly increases accuracy, especially in the case of big reference panels.</p>
      </sec>
      <sec id="sec006">
        <title>Imputation</title>
        <p>The posterior probability of the hidden states is computed using the forward-backward algorithm [<xref rid="pgen.1009049.ref024" ref-type="bibr">24</xref>]. IMPUTE5 calculates and stores these quantities at each target marker. The imputation step is performed after the marginal posterior distribution of the copying states has been computed. The state probabilities at reference markers <inline-formula id="pgen.1009049.e026"><alternatives><graphic xlink:href="pgen.1009049.e026.jpg" id="pgen.1009049.e026g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M26"><mml:mi mathvariant="script">R</mml:mi></mml:math></alternatives></inline-formula> can be linearly interpolated from the probability at the two bounding target markers. The motivation of using linear interpolation is, that over short genetic distance, the change in state probabilities can be approximated by a straight line [<xref rid="pgen.1009049.ref002" ref-type="bibr">2</xref>, <xref rid="pgen.1009049.ref023" ref-type="bibr">23</xref>]. The imputed probability for a particular allele is then just the sum of all the state probabilities at that marker in which the correspondent reference haplotypes carry the allele.</p>
        <p>As performed by BEAGLE5 [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>], we store state probabilities at consecutive markers for a reference haplotype only if one of the state probabilities is greater than the inverse of the number of states considered in the HMM. Since only a small subset of the state probabilities at consecutive markers needs to be stored, imputation can be delayed during output, saving the memory required to store imputed probabilities at reference markers.</p>
        <p>At the end of the forward-backward pass, a small subset of posterior probabilities are stored at each target site. When performing imputation, IMPUTE5 exploits the fact that, when imputing from large reference panels, a sizeable fraction of the imputed variants will be imputed as monomorphic and therefore imputation could be avoided for these markers. If the variant is rare, a simple test is performed to verify that at least one of the thresholded states carries the alternative allele in the reference panel. If that is the case, standard imputation is performed at the marker, otherwise a monomorphic variant is printed in output and no additional computation is required. We refer to this as delayed lazy imputation. This simple procedure has an impact in the case of big reference panels containing a large number of rare variants.</p>
        <p>In addition to this, IMPUTE5 does not store the reference panel at imputed variants in memory, but they are streamed by reading the reference panel during imputation. This, combined with delayed lazy imputation, allows quick imputation from extremely large reference panels, consuming only a small amount of the memory.</p>
      </sec>
    </sec>
    <sec id="sec007">
      <title>State selection using the PBWT</title>
      <p>IMPUTE5 uses the PBWT of the reference panel at target markers to identify a subset of states that share long identity by state (IBS) sequences with target haplotypes. Using just a subset of haplotypes saves computation time and memory usage. The copying state selection is performed upfront before the HMM calculations and determines the set of <italic>N</italic> haplotypes in <inline-formula id="pgen.1009049.e027"><alternatives><graphic xlink:href="pgen.1009049.e027.jpg" id="pgen.1009049.e027g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M27"><mml:msup><mml:mi>H</mml:mi><mml:mi mathvariant="script">T</mml:mi></mml:msup></mml:math></alternatives></inline-formula>. This set will be different for each target haplotype.</p>
      <p>The PBWT of the reference panel at the target markers is calculated sequentially from left to right across the region being imputed and the state selection occurs at the same time. So after one pass through the full dataset the state selection has been performed for <italic>all</italic> the target haplotypes. This means that there is no need to store the full PBWT of the reference panel in memory.</p>
      <p>The selection procedure occurs in two steps. First, each target haplotpes is inserted (or located) in the PBWT. Second, haplotypes ‘close’ to the target haplotype in the PBWT are identified. This selection only occurs at a relatively sparse set of target markers. Moving left to right through the PBWT the set of ‘close’ haplotypes are added to a list and this list is then used as the copying set of states in the HMM. <xref ref-type="fig" rid="pgen.1009049.g001">Fig 1</xref> illustrates the method on a small example.</p>
      <fig id="pgen.1009049.g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>IMPUTE5 copying state selection.</title>
          <p>Small example to illustrate IMPUTE5 copying state selection. (A) A reference panel of haplotypes <italic>H</italic> = {<italic>h</italic><sub>0</sub>, …, <italic>h</italic><sub>9</sub>} is restricted to the set of target markers and is shown together with a target panel of two haplotypes <italic>T</italic> = {<italic>t</italic><sub>0</sub>, <italic>t</italic><sub>1</sub>}. The copying state selection is only performed at a subsetof target markers. In this example, these are the 4th and 8th markers, and are shaded green. (B) The target haplotypes are inserted into the PBWT, using the rank operations (FM-index). In (B1) target haplotypes {<italic>t</italic><sub>0</sub>, <italic>t</italic><sub>1</sub>} are searched in the positional prefix array of the reference panel up to marker 4 and <italic>L</italic> = 2 reference haplotypes are selected for each target haplotype. In (B2) <italic>t</italic><sub>0</sub> and <italic>t</italic><sub>1</sub> are searched in the positional prefix array of the reference panel up to marker 8 and again <italic>L</italic> reference haplotypes are selected. (B3) The selected haplotypes are then merged to form a list of copying states for each target haploype. The resulting lists may not necessarily have the same length. These states will be used in the HMM to perform imputation.</p>
        </caption>
        <graphic xlink:href="pgen.1009049.g001"/>
      </fig>
      <p>Inserting each target haplotype into the PBWT involves searching the prefix array of the reference panel using <xref ref-type="disp-formula" rid="pgen.1009049.e006">Eq (3)</xref> and the FM-index. For a target <italic>t</italic> at marker <italic>m</italic>, this search finds the location of the reference haplotype in the PBWT that shares the longest reverse prefix with <italic>t</italic> up to marker <italic>m</italic>.</p>
      <p>The updated matched position <italic>f</italic> of the target <italic>t</italic> at marker <italic>m</italic> is given by:
<disp-formula id="pgen.1009049.e028"><alternatives><graphic xlink:href="pgen.1009049.e028.jpg" id="pgen.1009049.e028g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M28"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:msub><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(12)</label></disp-formula>
where <italic>c</italic><sub><italic>m</italic></sub>, <italic>U</italic><sub>:,<italic>m</italic></sub> and <italic>V</italic><sub>:,<italic>m</italic></sub> are respectively the number of 0s in each marker <italic>m</italic> and the rank matrices for the reference panel at marker <italic>m</italic>. The search itself costs <italic>O</italic>(1) at each marker using the FM-index of the PBWT and it is therefore independent of the number of haplotypes in the reference panel.</p>
      <p>We keep the list of locations for each target haplotype. At each marker, we first update the PBWT of the reference marker and then we update the list of target locations. The selection is performed every interval of length <italic>I</italic> (0.02 cM by default). We call <italic>selection markers</italic> the markers where the selection is performed. The cost of the search is <italic>O</italic>((<italic>N</italic> + <italic>K</italic>)<italic>M</italic>), where <italic>K</italic> is the number of target haplotypes.</p>
      <sec id="sec008">
        <title>Selection algorithms</title>
        <p>IMPUTE5 has two algorithms that select the ‘closest’ <italic>L</italic> haplotypes to the target haplotype within the PBWT. Both selection methods have <italic>O</italic>(<italic>LK</italic>) computational cost. The first one, which we call <italic>divergence selection</italic>, and first proposed in the software package SHAPEIT4 [<xref rid="pgen.1009049.ref006" ref-type="bibr">6</xref>], selects the best <italic>L</italic> states in the neighbourhood of the current match position <italic>f</italic> by using the divergence matrix, exploiting <xref ref-type="disp-formula" rid="pgen.1009049.e012">Eq (5)</xref>.</p>
        <p>By design the PBWT encapsulates a large amount of local linkage disequilibrium information. The longest reverse prefixes are by definition in the neighbourhood of the best matching haplotype found during the search. In order to take only the best haplotypes, the divergence matrix is used.</p>
        <p>Starting from an optimal position <italic>f</italic> at marker <italic>m</italic>, it checks the values of the divergence array at <italic>i</italic> = <italic>f</italic> − 1 and <italic>j</italic> = <italic>f</italic> + 1. If <italic>D</italic><sub><italic>i</italic>,<italic>m</italic></sub> &lt;= <italic>D</italic><sub><italic>j</italic>,<italic>m</italic></sub> then <italic>i</italic> is decreased and positional prefix <italic>A</italic><sub><italic>i</italic>,<italic>m</italic></sub> is added to the list of selected states, otherwise <italic>j</italic> is increased and <italic>A</italic><sub><italic>j</italic>,<italic>m</italic></sub> is added to the list. The algorithm continues until <italic>L</italic> states are selected. A pseudo algorithm of the copying state selection is shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s001">S1 Algorithm</xref>.</p>
        <p>The second selection algorithm, which we call <italic>neighbour selection</italic>, does not use the divergence matrix. At every selection marker, it simply takes the <italic>L</italic> neighbouring states (<italic>L</italic>/2 in both the directions) of the current best match position. This algorithm only guarantees to select the best <italic>L</italic>/2 reverse prefixes, but it requires less operations than the divergence selection, because it does not need to compute and interrogate the divergence array for that marker. The only checks needed are when the target haplotype occurs close to a border (start or end of the positional prefix array), and to avoid copying a mismatch position. In the case that the target haplotype is close to a border, less than <italic>L</italic> states are selected for that marker. A pseudo algorithm of the copying state selection is shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s002">S2 Algorithm</xref>.</p>
        <p>Durbin et al. [<xref rid="pgen.1009049.ref015" ref-type="bibr">15</xref>] proposed an algorithm to find the set of set maximal matches with the target haplotypes. The set of set maximal matching is the set of states that share the longest stretches with the target haplotype. We tested the use of the set maximal matches as a selection algorithm and we found that these contain a lot, but not all of the relevant information, and there is a small but evident loss in accuracy when we use only those matches.</p>
      </sec>
      <sec id="sec009">
        <title>IMP5 file format</title>
        <p>We developed a new file format, called imp5 to read the reference panel quickly into memory. Each marker is stored independently in one of two different ways: if the alternative allele is rare (MAF &lt; 1/256), the indices of the haplotypes that carry the alternative allele are stored, otherwise the sequence of alleles is stored using one bit per allele. Imp5 files are compact in memory and do not require other compression algorithms like gzip. This makes reading from a file an efficient operation, similar to bref3 [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>].</p>
        <p>The binary stored data structure coded in the imp5 file format is also used internally within IMPUTE5 to store the reference panel in memory. When imputing each target haplotype, at each target marker, the set of selected reference haplotypes that carry the alternate allele are needed. If the target site is stored as a bitset in the reference panel then the lookup is straightforward. If the site is stored as a list of indices of alternate alleles then either the list of reference panel indices is searched for the selected state index, or vice versa, depending upon which search is likely to be quicker.</p>
        <p>Another feature of the imp5 files is that they are indexed, so that regions can be extracted efficiently. The indexing was developed along the same lines as <italic>bgenix</italic> [<xref rid="pgen.1009049.ref017" ref-type="bibr">17</xref>], using sqlite3. The indexing is an important feature for imputation, especially when imputing different windows on the same chromosome independently. Other file formats like bref3 [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>] and m3vcf [<xref rid="pgen.1009049.ref018" ref-type="bibr">18</xref>] do not provide an index so far and therefore cannot directly interrogate arbitrary regions in constant time. In addition to this, IMPUTE5 can also read reference panels stored in VCF/BCF format.</p>
        <p>IMPUTE5 requires that the reference and the target panel files are indexed, using the native imp5 index or tabix in the case of VCF/BCF files. In this way, several independent imputation jobs can be run at the same time, using a multi-process parallelization approach. A comparison of the memory required to store m3vcf, bref3 and imp5 file formats is given in <xref rid="pgen.1009049.t002" ref-type="table">Table 2</xref>.</p>
        <table-wrap id="pgen.1009049.t002" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.t002</object-id>
          <label>Table 2</label>
          <caption>
            <title>Memory (GB) required by reference file formats.</title>
          </caption>
          <alternatives>
            <graphic id="pgen.1009049.t002g" xlink:href="pgen.1009049.t002"/>
            <table frame="box" rules="all" border="0">
              <colgroup span="1">
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
              </colgroup>
              <thead>
                <tr>
                  <th align="left" rowspan="1" colspan="1">Reference panel</th>
                  <th align="left" rowspan="1" colspan="1">vcf.gz</th>
                  <th align="left" rowspan="1" colspan="1">bcf</th>
                  <th align="left" rowspan="1" colspan="1">m3vcf.gz</th>
                  <th align="left" rowspan="1" colspan="1">bref v3</th>
                  <th align="left" rowspan="1" colspan="1">imp5</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                  <td align="left" rowspan="1" colspan="1">0.33</td>
                  <td align="left" rowspan="1" colspan="1">0.28</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.09</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.19</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.38</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                  <td align="left" rowspan="1" colspan="1">0.73</td>
                  <td align="left" rowspan="1" colspan="1">0.62</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.21</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.42</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.85</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                  <td align="left" rowspan="1" colspan="1">1.70</td>
                  <td align="left" rowspan="1" colspan="1">1.50</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.29</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.61</td>
                  <td align="char" char="." rowspan="1" colspan="1">1.90</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                  <td align="left" rowspan="1" colspan="1">3.90</td>
                  <td align="left" rowspan="1" colspan="1">3.40</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.60</td>
                  <td align="char" char="." rowspan="1" colspan="1">1.30</td>
                  <td align="char" char="." rowspan="1" colspan="1">4.30</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">Sim10K</td>
                  <td align="left" rowspan="1" colspan="1">0.06</td>
                  <td align="left" rowspan="1" colspan="1">0.04</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.02</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.02</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.04</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">Sim100K</td>
                  <td align="left" rowspan="1" colspan="1">0.83</td>
                  <td align="left" rowspan="1" colspan="1">0.56</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.15</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.11</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.42</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">Sim1M</td>
                  <td align="left" rowspan="1" colspan="1">18</td>
                  <td align="left" rowspan="1" colspan="1">10</td>
                  <td align="char" char="." rowspan="1" colspan="1">1.90</td>
                  <td align="char" char="." rowspan="1" colspan="1">0.75</td>
                  <td align="char" char="." rowspan="1" colspan="1">4.06</td>
                </tr>
              </tbody>
            </table>
          </alternatives>
          <table-wrap-foot>
            <fn id="t002fn001">
              <p>Memory usage in Gigabytes required to store the HRC and 1000 Genomes project reference panels (chromosome 10 and 20) and 10 Mb of reference sample data for 10K, 100K, and 1M simulated UK European reference samples. The reported memory value is the amount of space used to store the data in vcf.gz, bcf, m3vcf.gz, bref3 and imp5 file formats. For the imp5 file format, the value reported is the sum of the memory required by the imp5 file plus the index file. Imp5 has been optimised to provide random access and fast reading time for a region of the chromosome and not for data compression.</p>
            </fn>
          </table-wrap-foot>
        </table-wrap>
      </sec>
    </sec>
    <sec id="sec010">
      <title>Parallelization</title>
      <p>A typical IMPUTE5 job runs on multiple 5-20cM regions in parallel. Each region is completely independent from the others and can be run on different machines. The use of the indexing of the IMP5 files allows each process to read the reference panel efficiently.</p>
      <p>Output is written in VCF, BCF or in BGEN v1.2 file format [<xref rid="pgen.1009049.ref017" ref-type="bibr">17</xref>], the latter explicitly designed to store imputed data. Concatenating VCF, BCF and BGEN files at the end of imputation is an efficient process and allows to impute each window independently (<italic>bcftools concat</italic> or <italic>cat-bgen</italic> commands are used to merge output files).</p>
      <p>IMPUTE5 can also multi-thread each process. We developed multi-threading using a shared memory approach. Each thread is responsible for a single target haplotype when running the HMM, or an imputation region between two target markers. The data sharing approach is crucial for reducing the memory required by each computational thread.</p>
    </sec>
    <sec id="sec011">
      <title>Real and simulated data experiments</title>
      <p>We compared IMPUTE5 to other existing imputation methods using real reference panels from the 1000 Genomes Project [<xref rid="pgen.1009049.ref010" ref-type="bibr">10</xref>] and the Haplotype Reference Consortium [<xref rid="pgen.1009049.ref012" ref-type="bibr">12</xref>]. We used data from both chromosome 10 and chromosome 20. For both panels we extracted a subset of samples, thinned down to a subset of sites, that are used as the target haplotype panel, and used the remaining samples as reference panel. We also use a UK-European reference panel of simulated data for 10K, 100K, and 1M samples generated using MSPRIME [<xref rid="pgen.1009049.ref025" ref-type="bibr">25</xref>]. Details of the real and simulated datasets are summarised in <xref rid="pgen.1009049.t003" ref-type="table">Table 3</xref>.</p>
      <table-wrap id="pgen.1009049.t003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.t003</object-id>
        <label>Table 3</label>
        <caption>
          <title>Summary of the real and simulated datasets used in comparing methods.</title>
        </caption>
        <alternatives>
          <graphic id="pgen.1009049.t003g" xlink:href="pgen.1009049.t003"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="left" rowspan="1" colspan="1">Reference Panel</th>
                <th align="left" rowspan="1" colspan="1">Length (Mb)</th>
                <th align="left" rowspan="1" colspan="1">Number of Reference Samples</th>
                <th align="left" rowspan="1" colspan="1">Number of Reference Markers</th>
                <th align="left" rowspan="1" colspan="1">Target Marker Description</th>
                <th align="left" rowspan="1" colspan="1">Number of Target Markers</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                <td align="char" char="." rowspan="1" colspan="1">62.9</td>
                <td align="left" rowspan="1" colspan="1">2,452</td>
                <td align="left" rowspan="1" colspan="1">1,569,377</td>
                <td align="left" rowspan="1" colspan="1">Illumina Omni2.5</td>
                <td align="left" rowspan="1" colspan="1">53,183</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                <td align="char" char="." rowspan="1" colspan="1">62.9</td>
                <td align="left" rowspan="1" colspan="1">2,452</td>
                <td align="left" rowspan="1" colspan="1">1,569,377</td>
                <td align="left" rowspan="1" colspan="1">Infinium OmniExpress-24</td>
                <td align="left" rowspan="1" colspan="1">17,806</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                <td align="char" char="." rowspan="1" colspan="1">135.5</td>
                <td align="left" rowspan="1" colspan="1">2,452</td>
                <td align="left" rowspan="1" colspan="1">3,431,035</td>
                <td align="left" rowspan="1" colspan="1">Illumina Omni2.5</td>
                <td align="left" rowspan="1" colspan="1">111,570</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                <td align="char" char="." rowspan="1" colspan="1">135.5</td>
                <td align="left" rowspan="1" colspan="1">2,452</td>
                <td align="left" rowspan="1" colspan="1">3,431,035</td>
                <td align="left" rowspan="1" colspan="1">Infinium OmniExpress-24</td>
                <td align="left" rowspan="1" colspan="1">37,798</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                <td align="char" char="." rowspan="1" colspan="1">62.9</td>
                <td align="left" rowspan="1" colspan="1">31,470</td>
                <td align="left" rowspan="1" colspan="1">884,983</td>
                <td align="left" rowspan="1" colspan="1">Illumina Omni2.5</td>
                <td align="left" rowspan="1" colspan="1">53,600</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                <td align="char" char="." rowspan="1" colspan="1">62.9</td>
                <td align="left" rowspan="1" colspan="1">31,470</td>
                <td align="left" rowspan="1" colspan="1">884,983</td>
                <td align="left" rowspan="1" colspan="1">Infinium OmniExpress-24</td>
                <td align="left" rowspan="1" colspan="1">18,002</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                <td align="char" char="." rowspan="1" colspan="1">135.5</td>
                <td align="left" rowspan="1" colspan="1">31,470</td>
                <td align="left" rowspan="1" colspan="1">1,927,503</td>
                <td align="left" rowspan="1" colspan="1">Illumina Omni2.5</td>
                <td align="left" rowspan="1" colspan="1">111,657</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                <td align="char" char="." rowspan="1" colspan="1">135.5</td>
                <td align="left" rowspan="1" colspan="1">31,470</td>
                <td align="left" rowspan="1" colspan="1">1,927,503</td>
                <td align="left" rowspan="1" colspan="1">Infinium OmniExpress-24</td>
                <td align="left" rowspan="1" colspan="1">38,206</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel A Sim10K</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">10,000</td>
                <td align="left" rowspan="1" colspan="1">223,116</td>
                <td align="left" rowspan="1" colspan="1">&gt;5% MAF</td>
                <td align="left" rowspan="1" colspan="1">3,333</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel A Sim100K</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">100,000</td>
                <td align="left" rowspan="1" colspan="1">747,162</td>
                <td align="left" rowspan="1" colspan="1">&gt;5% MAF</td>
                <td align="left" rowspan="1" colspan="1">3,333</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel A Sim1M</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">1,000,000</td>
                <td align="left" rowspan="1" colspan="1">2,274,530</td>
                <td align="left" rowspan="1" colspan="1">&gt;5% MAF</td>
                <td align="left" rowspan="1" colspan="1">3,333</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel B Sim10K</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">10,000</td>
                <td align="left" rowspan="1" colspan="1">223,116</td>
                <td align="left" rowspan="1" colspan="1">&gt;0.05% MAF in Panel B Sim1M</td>
                <td align="left" rowspan="1" colspan="1">33,333</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel B Sim100K</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">100,000</td>
                <td align="left" rowspan="1" colspan="1">223,116</td>
                <td align="left" rowspan="1" colspan="1">&gt;0.05% MAF in Panel B Sim1M</td>
                <td align="left" rowspan="1" colspan="1">33,333</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Panel B Sim1M</td>
                <td align="char" char="." rowspan="1" colspan="1">10.0</td>
                <td align="left" rowspan="1" colspan="1">1,000,000</td>
                <td align="left" rowspan="1" colspan="1">223,116</td>
                <td align="left" rowspan="1" colspan="1">&gt;0.05% MAF in Panel B Sim1M</td>
                <td align="left" rowspan="1" colspan="1">33,333</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <sec id="sec012">
        <title>1000 Genomes Project</title>
        <p>The 1000 Genomes Project phase 3 dataset contains phased sequenced data of 2,504 individuals sampled from 26 different populations. As performed in the BEAGLE5 paper [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>], we selected two random individuals from each population for the imputation target and used the remaining data as a reference panel. We restricted the 1000 Genomes reference data to markers having at least one copy of the minor allele in the reference panel, getting 3,431,035 markers on chromosome 10 and 1,569,377 markers on chromosome 20. In the 52 target samples, we masked markers that were not on the Illumina Omni2.5 array and the less dense Infinium OmniExpress-24 v1.2, resulting in 111,570 (Omni 2.5) or 37,798 (Infinium OmniExpress-24) target markers on chromosome 10 and 53,183 (Omni 2.5) or 17,806 (Infinium OmniExpress-24) target markers on chromosome 20. The list of markers has been obtained from <ext-link ext-link-type="uri" xlink:href="https://www.well.ox.ac.uk/~wrayner/strand/">https://www.well.ox.ac.uk/~wrayner/strand/</ext-link>.</p>
      </sec>
      <sec id="sec013">
        <title>The Haplotype Reference Consortium</title>
        <p>The Haplotype Reference Consortium (HRC) [<xref rid="pgen.1009049.ref012" ref-type="bibr">12</xref>] reference panel combines sequence data across 32,470 individuals from 20 sequencing studies. We randomly selected 1,000 target individuals from the HRC panel and used the other 31,470 as a reference panel.</p>
        <p>We removed monomorphic markers in the reference samples. In the target samples, we masked markers that were not on the Omni2.5 array and Infinium OmniExpress-24 v1.2, resulting in 111,657 (Omni2.5) or 38,206 (Infinium OmniExpress-24) target markers on chromosome 10 and 53,600 (Omni 2.5) or 18,002 (Infinium OmniExpress-24) target markers on chromosome 20.</p>
        <p>In order to verify the sub-linear properties of IMPUTE5, we also randomly downsampled the HRC dataset to a subsets containing 30,000, 20,000, 10,000, 5,000, 3,000, 2,000 and 1,000 samples.</p>
      </sec>
      <sec id="sec014">
        <title>Simulated reference panels</title>
        <p>We used MSPRIME [<xref rid="pgen.1009049.ref025" ref-type="bibr">25</xref>] to simulate a 10Mb region of sequence data of UK-European samples. We simulated 11,000, 101,000 and 1,001,000 samples and extracted 1,000 samples from each of the three dataset, in order to have three reference panels of size 10K, 100K and 1M samples. We split each of the 1,000 target samples into three different target panels of size 10, 100 and 1,000.</p>
        <p>In the target panels, we masked all but 3,333 markers, randomly selected between the markers having MAF &gt; 5%, to simulate chip sites. The reference panels have 223,116, 747,162 and 2,271,530 markers respectively. We refer to this setting (reference panel + target panels) as Panel A.</p>
        <p>We created 3 other simulated datasets (called Panel B), with 1 million, 100,000 and 10,000 samples, and each with the same number of 223,116 markers. We created 3 target panels of size 10, 100 and 1,000 samples at a subset of 33,333 markers by randomly selecting markers having MAF &gt; 0.05% in the 1M reference panel. Panel B is used to benchmark imputation on the same set of markers, varying the size of the reference panels.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results" id="sec015">
    <title>Results</title>
    <sec id="sec016">
      <title>Comparison of methods</title>
      <p>We compared IMPUTE5 to IMPUTE4, MINIMAC4 (v.1.0.0) [<xref rid="pgen.1009049.ref018" ref-type="bibr">18</xref>] and BEAGLE5.1 (version 25Nov19.28d) [<xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>]. For simulated datasets, we used default parameters for each program. For real datasets we used different imputation window sizes, depending on the imputation program. For IMPUTE4 we used imputation regions of 5Mb and 500kb of buffer, as perfomed for the UK Biobank imputation [<xref rid="pgen.1009049.ref002" ref-type="bibr">2</xref>]. For MINIMAC4 we used the default settings (20Mb region). We ran IMPUTE5 and BEAGLE5.1 on the same regions of 20 cM. In this case we used a 1Mb buffer region for IMPUTE5 and 2cM buffer region for BEAGLE5.1.</p>
      <p>We used the HapMap2 [<xref rid="pgen.1009049.ref009" ref-type="bibr">9</xref>] genetic map for BEAGLE5.1 and IMPUTE5 for real data imputation and the true genetic map for analyses with simulated data. MINIMAC does not require a genetic map, as recombination parameters are estimated and stored when producing the m3vcf format input file for the reference data.</p>
      <p>BEAGLE5.1, MINIMAC4 and IMPUTE5 use their specialized formats for reference panel data: bref3 for BEAGLE5.1, m3vcf 4 for MINIMAC4 and imp5 for IMPUTE5. IMPUTE5 has two different haplotype selection algorithms that we call <italic>divergence selection</italic> and <italic>neighbour selection</italic> (see <xref ref-type="sec" rid="sec002">Methods</xref>), both of which have a parameter <italic>L</italic> that controls the number of selected haplotypes. We tested both selection algorithms using <italic>L</italic> = 4 and <italic>L</italic> = 8. IMPUTE4 was run with all reference panels except on the simulated reference panels, beceause IMPUTE4 is limited to 65,536 reference haplotypes and does not run on the two largest reference panels (100K and 1M samples).</p>
      <p>As in previous papers [<xref rid="pgen.1009049.ref010" ref-type="bibr">10</xref>, <xref rid="pgen.1009049.ref012" ref-type="bibr">12</xref>, <xref rid="pgen.1009049.ref019" ref-type="bibr">19</xref>], we measured performance by comparing the imputed allele probabilities to the true (masked) alleles. Markers were binned into bins according to the minor allele frequency of the marker in the reference panel. In each bin we report the squared correlation (<italic>r</italic><sup>2</sup>) between the vector of all the true (masked) alleles and the vector of all posterior imputed allele probabilities.</p>
      <p>All imputation analyses were run on a 16-core computer with Intel Xeon CPU E5-2667 3.20GHz processors and 512 GB of memory.</p>
      <sec id="sec017">
        <title>Imputation accuracy</title>
        <p><xref ref-type="fig" rid="pgen.1009049.g002">Fig 2</xref> shows the performance of all the methods on the Panel A simulated reference panels of size 10K, 100K, and 1M samples using <italic>L</italic> = 4 and <italic>I</italic> = 0.002cM for IMPUTE5. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s005">S1 Fig</xref>. These results illustrate the very close agreement between the methods. All the methods compared use the same Li and Stephens probabilistic model [<xref rid="pgen.1009049.ref022" ref-type="bibr">22</xref>] so this is not surprising. The imputation performance increases as expected with the reference panel size. For example, the imputation accuracy of the 10K reference panel at the 10<sup>−4</sup> MAF bin reaches a <italic>r</italic><sup>2</sup> ≈ 0.4, while reaches a <italic>r</italic><sup>2</sup> ≈ 0.9 and <italic>r</italic><sup>2</sup> ≈ 0.98 for the 100K and 1M reference panel, respectively.</p>
        <fig id="pgen.1009049.g002" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.g002</object-id>
          <label>Fig 2</label>
          <caption>
            <title>Imputation accuracy for the Panel A dataset.</title>
            <p>Imputation accuracy when imputing genotypes from a simulated reference panel of 10K, 100K and 1M UK-European reference samples (Panel A dataset). Imputed alleles are binned according to their minor allele frequency in each reference panel. The horizontal axis in each panel is on a log scale.</p>
          </caption>
          <graphic xlink:href="pgen.1009049.g002"/>
        </fig>
        <p><xref ref-type="fig" rid="pgen.1009049.g003">Fig 3</xref> shows the results using the real reference panels and shows a very slight increase in accuracy when MINIMAC4 is used for small reference panels. The likely explanation is that MINIMAC4 performs an HMM parameter estimation step when m3vcf files are created, and this adds some adaption to genotyping errors and recombination rate variation. This explains also why we do not see differences between methods in <xref ref-type="fig" rid="pgen.1009049.g002">Fig 2</xref>, because in that case the real recombination map in known and no genotyping errors are present for the MSPRIME simulations. We also note that IMPUTE4 reaches the same imputation accuracy as other methods, even if run on smaller imputation windows. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s006">S2 Fig</xref>.</p>
        <fig id="pgen.1009049.g003" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.g003</object-id>
          <label>Fig 3</label>
          <caption>
            <title>Imputation accuracy for the 1000 Genomes and the HRC datasets.</title>
            <p>Imputation accuracy when imputing genotypes using the 1000 Genomes Project reference panel (<italic>n</italic> = 2452) and the Haplotype Reference Consortium reference panel (<italic>n</italic> = 31470). Imputed alleles are binned according to their minor allele frequency in each reference panel. The horizontal axis in each panel is on a log scale.</p>
          </caption>
          <graphic xlink:href="pgen.1009049.g003"/>
        </fig>
        <p><xref ref-type="supplementary-material" rid="pgen.1009049.s007">S3</xref> and <xref ref-type="supplementary-material" rid="pgen.1009049.s008">S4</xref> Figs show the performance of IMPUTE5 for a range of values of <italic>L</italic> ∈ {1, 2, 4, 8, 16}) for both the selection algorithms proposed on simulated and real reference panels. As expected, increasing the value of <italic>L</italic> also accuracy increases, however, for values of <italic>L</italic> &gt;= 4 imputation accuracy is almost indistinguishable. Both the selection algorithms perform well for values of <italic>L</italic> ≥ 4, however neighbour selection algorithm seems to perform better for values of <italic>L</italic> &lt; 4. This is probably explained by the fact that neighbour selection algorithm tends to select more states than divergence selection algorithm, making it more robust even with smaller values of <italic>L</italic>.</p>
        <p>We also verified the imputation accuracy in the case that the target panel presents phasing errors. For this purpose we used our simulated datasets of Panel A., containing perfectly phased data. We added ≈ 2% switch error rate to each of the target datasets containing 1,000 samples. Overall, we note that a modest amount of phasing errors result in a drop in the imputation accuracy, especially in the rare frequency spectrum (<xref ref-type="supplementary-material" rid="pgen.1009049.s009">S5 Fig</xref>).</p>
        <p>Finally, we used chromosome 10 data from the 1000 Genomes Project and HRC reference panel to explore the distribution of the selected states in our imputation experiments. We extracted 52 target samples from 1000 Genomes Project and 1000 target samples from the HRC, and phased them against the remaining haplotypes in the reference panels. We then recorded which haplotypes were selected as states across the ten 20cM chunks on chromosome 10. <xref ref-type="supplementary-material" rid="pgen.1009049.s010">S6 Fig</xref> top shows the number of times each reference haplotypes was selected. The uneven pattern across reference haplotypes is a consequence of the spectrum of ancestry and different cohorts included in the 1000 Genomes and HRC reference panels respectively. <xref ref-type="supplementary-material" rid="pgen.1009049.s010">S6 Fig</xref> bottom shows the distribution of the number of times a state was selected.</p>
      </sec>
      <sec id="sec018">
        <title>Computational efficiency</title>
        <p><xref rid="pgen.1009049.t004" ref-type="table">Table 4</xref> shows single core memory usage and time of running MINIMAC4, BEAGLE5.1 and IMPUTE5 to impute the whole chromosome 20 and 10 for 1000 Genomes and HRC reference panels. In order to compare the methods, we ran MINIMAC4 using its default chunk size (20 Mb chunk size and 2 Mb buffer size). IMPUTE5 and BEAGLE5 were run using 20 cM imputation regions and 1Mb and 2cM buffer respectively. IMPUTE5 was run with the parameter <italic>L</italic> = 4 and using BGEN as output file format (zstd compression). We used default settings otherwise. For both the 1000 Genomes and HRC reference panel IMPUTE5 is faster than BEAGLE5 and on the HRC reference panel it is over 20 times faster than MINIMAC4. IMPUTE5 is also several times more memory efficient than other methods. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s003">S1 Table</xref>.</p>
        <table-wrap id="pgen.1009049.t004" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.t004</object-id>
          <label>Table 4</label>
          <caption>
            <title>Memory usage and time to impute 1000 Genomes and HRC datasets using 20Mb or 20cM imputation regions.</title>
            <p>Memory usage and total time to impute a whole chromosome (chr 10 and chr 20) for 52 target samples when using the 1000 Genomes reference panel and 1000 target samples when using the HRC reference panel. MINIMAC4 was run on chunks of size 20 Mb (default settings). IMPUTE5 and BEAGLE5.1 were run on chunks of size 20cM. Time is shown using the format mm:ss. Bold font is used to indicate the method with the lowest memory and time.</p>
          </caption>
          <alternatives>
            <graphic id="pgen.1009049.t004g" xlink:href="pgen.1009049.t004"/>
            <table frame="box" rules="all" border="0">
              <colgroup span="1">
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
              </colgroup>
              <tbody>
                <tr>
                  <td align="left" rowspan="2" colspan="1">
                    <bold>Dataset</bold>
                  </td>
                  <td align="center" colspan="4" rowspan="1">
                    <bold>Memory usage (MB)—Omni 2.5 chip</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 neigh</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 div</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                  <td align="center" rowspan="1" colspan="1">1,792</td>
                  <td align="center" rowspan="1" colspan="1">6,706</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>428</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">435</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                  <td align="center" rowspan="1" colspan="1">2,472</td>
                  <td align="center" rowspan="1" colspan="1">12,089</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>480</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">489</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                  <td align="center" rowspan="1" colspan="1">4,842</td>
                  <td align="center" rowspan="1" colspan="1">13,087</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>4,361</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">4,368</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                  <td align="center" rowspan="1" colspan="1">4,896</td>
                  <td align="center" rowspan="1" colspan="1">14,480</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>4,842</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">4,850</td>
                </tr>
                <tr>
                  <td align="left" rowspan="2" colspan="1"/>
                  <td align="center" colspan="4" rowspan="1">
                    <bold>Memory usage (MB)—OmniExpress-24 chip</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 neigh</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 div</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                  <td align="center" rowspan="1" colspan="1">1,696</td>
                  <td align="center" rowspan="1" colspan="1">6,232</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>197</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">200</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                  <td align="center" rowspan="1" colspan="1">2,316</td>
                  <td align="center" rowspan="1" colspan="1">11,572</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>215</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">221</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                  <td align="center" rowspan="1" colspan="1">4,405</td>
                  <td align="center" rowspan="1" colspan="1">13,381</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>1,965</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">1,969</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                  <td align="center" rowspan="1" colspan="1">4,417</td>
                  <td align="center" rowspan="1" colspan="1">13,351</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>1,779</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">1,788</td>
                </tr>
                <tr>
                  <td align="left" rowspan="2" colspan="1"/>
                  <td align="center" colspan="4" rowspan="1">
                    <bold>Time ([hh:]mm:ss)—Omni 2.5 chip</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 neigh</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 div</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                  <td align="center" rowspan="1" colspan="1">02:33</td>
                  <td align="center" rowspan="1" colspan="1">00:55</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>00:48</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">00:49</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                  <td align="center" rowspan="1" colspan="1">05:16</td>
                  <td align="center" rowspan="1" colspan="1">01:44</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>01:42</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">01:42</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                  <td align="center" rowspan="1" colspan="1">04:07:39</td>
                  <td align="center" rowspan="1" colspan="1">15:47</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>08:15</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">8:29</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                  <td align="center" rowspan="1" colspan="1">08:07:42</td>
                  <td align="center" rowspan="1" colspan="1">30:47</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>17:27</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">17:52</td>
                </tr>
                <tr>
                  <td align="left" rowspan="2" colspan="1"/>
                  <td align="center" colspan="4" rowspan="1">
                    <bold>Time ([hh:]mm:ss)—OmniExpress-24 chip</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 neigh</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5 div</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 20</td>
                  <td align="center" rowspan="1" colspan="1">01:37</td>
                  <td align="center" rowspan="1" colspan="1">00:46</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>00:28</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">00:28</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1000 Genomes chr 10</td>
                  <td align="center" rowspan="1" colspan="1">01:56</td>
                  <td align="center" rowspan="1" colspan="1">01:33</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>00:59</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">01:00</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 20</td>
                  <td align="center" rowspan="1" colspan="1">02:02:29</td>
                  <td align="center" rowspan="1" colspan="1">11:03</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>03:38</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">03:43</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">HRC chr 10</td>
                  <td align="center" rowspan="1" colspan="1">04:04:04</td>
                  <td align="center" rowspan="1" colspan="1">20:28</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>07:52</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">08:02</td>
                </tr>
              </tbody>
            </table>
          </alternatives>
        </table-wrap>
        <p><xref ref-type="fig" rid="pgen.1009049.g004">Fig 4</xref> and <xref rid="pgen.1009049.t005" ref-type="table">Table 5</xref> show the per-sample computation times for IMPUTE5, BEAGLE5.1 and MINIMAC4 for 10K, 100K and 1M simulated reference panels when imputing a set of 1,000 target samples on a 10Mb region. All methods were run using a single core on the same machine and in this case we reduced the value of the IMPUTE5 <italic>I</italic> parameter to 0.002 cM to take into account the fact that no proper map is available for the simulated region. The results are plotted on log-log scale, which illustrates that both BEAGLE5.1 and IMPUTE5 exhibit sub-linear scaling as reference panel size increases. For Panel A results, moving from 10K to 1M reference samples increases the number of reference samples by a factor of 100 and the number of reference markers by a factor of 10, but IMPUTE5’s imputation time increases by only a factor of 2.5. Overall the results show that IMPUTE5 is consistently faster than all the alternative methods. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s011">S7 Fig</xref> and <xref ref-type="supplementary-material" rid="pgen.1009049.s004">S2 Table</xref>.</p>
        <fig id="pgen.1009049.g004" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.g004</object-id>
          <label>Fig 4</label>
          <caption>
            <title>Per sample imputation time for Panel A and Panel B datasets.</title>
            <p>Per-sample CPU time when imputing a 10 Mb region from 10K, 100K and 1M simulated UK-European reference samples into 1,000 target samples using one computational thread per job. (A) Imputation time when using Panel A dataset (3,333 target markers). (B) Imputation time when using Panel B dataset (33,333 target markers). Axes are on log scale. Hypothetical linear scaling of MINIMAC4, BEAGLE5 and IMPUTE5 are shown as dotted lines, generated by projecting the time using the 10K reference panel. Minimac4 was not able to run using the Panel A 1M reference panel due to time constraints in the construction of the m3vcf file.</p>
          </caption>
          <graphic xlink:href="pgen.1009049.g004"/>
        </fig>
        <table-wrap id="pgen.1009049.t005" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.t005</object-id>
          <label>Table 5</label>
          <caption>
            <title>Memory usage and time to impute Panel A and Panel B datasets.</title>
            <p>Memory usage and total time to impute 1, 000 target samples in a 10 Mb window using simulation data in Panel A and Panel B dataset. Time is shown using the format [hh:]mm:ss. Bold font is used to indicate the method with the lowest memory and time. MINIMAC4 was not able to run using the Panel A 1M samples reference panel due to time constraints in the construction of the m3vcf file.</p>
          </caption>
          <alternatives>
            <graphic id="pgen.1009049.t005g" xlink:href="pgen.1009049.t005"/>
            <table frame="box" rules="all" border="0">
              <colgroup span="1">
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
              </colgroup>
              <tbody>
                <tr>
                  <td align="left" rowspan="3" colspan="1">
                    <bold>Dataset</bold>
                  </td>
                  <td align="center" colspan="6" rowspan="1">
                    <bold>Memory usage (MB)</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" colspan="3" rowspan="1">Panel A</td>
                  <td align="center" colspan="3" rowspan="1">Panel B</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5</td>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">10K reference panel</td>
                  <td align="center" rowspan="1" colspan="1">1,048</td>
                  <td align="center" rowspan="1" colspan="1">9,058</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>1,210</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>1,253</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">7,278</td>
                  <td align="center" rowspan="1" colspan="1">12,241</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">100K reference panel</td>
                  <td align="center" rowspan="1" colspan="1">5,858</td>
                  <td align="center" rowspan="1" colspan="1">10,452</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>1,283</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>5,122</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">7,994</td>
                  <td align="center" rowspan="1" colspan="1">11,842</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1M reference panel</td>
                  <td align="center" rowspan="1" colspan="1">-</td>
                  <td align="center" rowspan="1" colspan="1">8.805</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>2,217</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">43,246</td>
                  <td align="center" rowspan="1" colspan="1">25,868</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>15,659</bold>
                  </td>
                </tr>
                <tr>
                  <td align="left" rowspan="3" colspan="1">
                    <bold>Dataset</bold>
                  </td>
                  <td align="center" colspan="6" rowspan="1">
                    <bold>Time ([hh:]mm:ss)</bold>
                  </td>
                </tr>
                <tr>
                  <td align="center" colspan="3" rowspan="1">Panel A</td>
                  <td align="center" colspan="3" rowspan="1">Panel B</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5</td>
                  <td align="center" rowspan="1" colspan="1">MINIMAC4</td>
                  <td align="center" rowspan="1" colspan="1">BEAGLE5.1</td>
                  <td align="center" rowspan="1" colspan="1">IMPUTE5</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">10K reference panel</td>
                  <td align="center" rowspan="1" colspan="1">05:30</td>
                  <td align="center" rowspan="1" colspan="1">01:11</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>00:32</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">29:54</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>01:58</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">02:39</td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">100K reference panel</td>
                  <td align="center" rowspan="1" colspan="1">32:20</td>
                  <td align="center" rowspan="1" colspan="1">02:23</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>00:36</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">03:02:21</td>
                  <td align="center" rowspan="1" colspan="1">03:23</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>03:20</bold>
                  </td>
                </tr>
                <tr>
                  <td align="left" rowspan="1" colspan="1">1M reference panel</td>
                  <td align="center" rowspan="1" colspan="1">-</td>
                  <td align="center" rowspan="1" colspan="1">05:39</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>01:17</bold>
                  </td>
                  <td align="center" rowspan="1" colspan="1">28:10:50</td>
                  <td align="center" rowspan="1" colspan="1">17:15</td>
                  <td align="center" rowspan="1" colspan="1">
                    <bold>05:51</bold>
                  </td>
                </tr>
              </tbody>
            </table>
          </alternatives>
        </table-wrap>
        <p><xref ref-type="fig" rid="pgen.1009049.g004">Fig 4B</xref> and <xref rid="pgen.1009049.t005" ref-type="table">Table 5</xref> show the imputation time for Panel B dataset. All the reference panels in Panel B have the same number of markers. In this case we have a very dense set of target markers (33,333) and so more time is spent for the Li and Stephens calculations compared to Panel A scenario. The time spent by IMPUTE5 for the Li and Stephens HMM and imputation actually decreases when the number of reference haplotypes is increased. The increase in time shown in <xref ref-type="fig" rid="pgen.1009049.g004">Fig 4B</xref> from 10K reference panel to 1M reference panel is only due to increased time to read the input and run the selection algorithm, the only linear components of IMPUTE5.</p>
        <p><xref ref-type="fig" rid="pgen.1009049.g005">Fig 5A</xref> shows that the imputation time per sample decreases when the number of target haplotypes increases. This is mainly explained by the fact that typically, for a small number of target haplotypes, the PBWT construction is the main part of the selection algorithm and the copying states selection is a small fraction of the time. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s012">S8(A) Fig</xref>.</p>
        <fig id="pgen.1009049.g005" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pgen.1009049.g005</object-id>
          <label>Fig 5</label>
          <caption>
            <title>Sub-linear scaling of IMPUTE5.</title>
            <p>(A) Time per sample spent to impute a marker in a 10Mb region for reference panel size 10K, 100K and 1M samples, when imputing 10, 100 and 1,000 target samples. The vertical axis is on a log scale. (B) Mean number of copying states selected for the simulated reference panels. (C) Mean number of copying states selected for the downsampled HRC reference panels containing 1,000 to 30,000 thousands samples. Time and number of conditioning states are obtained using IMPUTE5 neighbours select and <italic>L</italic> = 4.</p>
          </caption>
          <graphic xlink:href="pgen.1009049.g005"/>
        </fig>
        <p><xref ref-type="fig" rid="pgen.1009049.g005">Fig 5B and 5C</xref> show that the mean number of copying states selected by IMPUTE5 decreases as the number of reference haplotypes increases for both simulated and real reference panels. For real reference panels, we used a downsampled version of the HRC containing an increasing amount of samples from 1,000 to 30,000. This property is predicted from the Li and Stephens model <xref ref-type="disp-formula" rid="pgen.1009049.e022">Eq 9</xref>, that is itself an approximation to the coalescent model, whereby the probability of switching between copying states decreases as the number of reference haplotypes increases. The number of selected copying states decreases relatively slowly with reference panel size using the real HRC data versus the simulated dataset. One explanation of this might be that the simulated dataset is free from genotyping and phasing errors, and the HRC dataset was constructed from relatively low-coverage sequence data. As larger, higher coverage sequence datasets become available, it is likely that genotyping and phasing quality will dramatically increase and the number of copying states selected may decrease. Results using <italic>L</italic> = 8 are shown in <xref ref-type="supplementary-material" rid="pgen.1009049.s012">S8(B) Fig</xref>.</p>
        <p>IMPUTE5 takes advantage of the BGEN file format. This is especially useful for very dense reference panels, containing millions of markers in a single chunk. In this case, we observe a 20 to 50% additional increase of speed, compared to using VCF/BCF file formats.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec019">
    <title>Discussion</title>
    <p>In this work we have developed a new genotype imputation method called IMPUTE5 that has the same accuracy and faster computation time and memory requirements compared to other currently available imputation methods. IMPUTE5 has the lowest computation time for all reference panel sizes and target sample sizes considered, both for small regions and for chromosome wide imputation.</p>
    <p>IMPUTE5 shares the same model as IMPUTE4, but has several improvements, making IMPUTE5 suitable for new generation reference panels. A new reference file format (imp5) and the ability to read indexed input files allows quick imputation on a small region of the genome. IMPUTE5’s new copy states selection makes imputation more efficient when increasing the reference panel or target panel size. IMPUTE5 exhibits sub-linear scaling with reference panel sample size and provides highly accurate imputation for large scale data sets.</p>
    <p>The ability to impute quickly specific regions of the genome makes IMPUTE5 very suitable to be used as a part of an imputation server [<xref rid="pgen.1009049.ref018" ref-type="bibr">18</xref>]. In addition, IMPUTE5 could be optimized to be used after the pre-phasing step. For example, using SHAPEIT4 [<xref rid="pgen.1009049.ref006" ref-type="bibr">6</xref>] to pre-phase target haplotypes using a reference panel of haplotypes, it internally computes the PBWT of the reference panel at target markers to provide an accurate phase. Since the same data structure is used in a similar way by the two programs, IMPUTE5’s selection algorithm could run as a last step of phasing.</p>
    <p>We also believe that there is space for further improvements. For example, imp5 file format only provide a basic representation of the haplotypes and additional information can be added (i.e. PBWT divergence arrays). The ideas presented in this paper could be applied in other research areas, such as imputation for low coverage sequences, since the use of PBWT-based methods can improve speed and accuracy of imputation when imputing from a reference panel.</p>
    <p>It seems likely that genotype imputation will continue to be an important part of most genome-wide association studies, since genotyping microarrays are relatively cheaper than whole-genome sequencing and as reference panels continue to grow. Researchers will increasingly be able to impute (and re-impute) a larger number of rare variants and they will be imputed to a higher quality.</p>
    <p>The increased length of haplotype matching that occurs as reference panels grow in size (see <xref ref-type="fig" rid="pgen.1009049.g005">Fig 5B and 5C</xref>) suggests that it could be interesting to investigate whether genotyping microarrays could reduce the number of variants they assay without losing accuracy.</p>
  </sec>
  <sec id="sec020">
    <title>Software</title>
    <p>The IMPUTE5 software is available at <ext-link ext-link-type="uri" xlink:href="https://jmarchini.org/impute5/">https://jmarchini.org/impute5/</ext-link>.</p>
  </sec>
  <sec sec-type="supplementary-material" id="sec021">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pgen.1009049.s001">
      <label>S1 Algorithm</label>
      <caption>
        <title>Divergence selection algorithm.</title>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s001.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s002">
      <label>S2 Algorithm</label>
      <caption>
        <title>Neighbour selection algorithm.</title>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s002.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s003">
      <label>S1 Table</label>
      <caption>
        <title>Memory usage and time to impute 1000 Genomes and HRC datasets using <italic>L</italic> = 8.</title>
        <p>Memory usage and total time to impute a whole chromosome (chr 10 and chr 20) for 52 target samples when using the 1000 Genomes reference panel and 1,000 target samples when using the HRC reference panel. MINIMAC4 was run on chunks of size 20 Mb while BEAGLE5 and IMPUTE5 on chunks of size 20 cM. Time is shown using the format mm:ss. Bold font is used to indicate the method with the lowest time.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s003.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s004">
      <label>S2 Table</label>
      <caption>
        <title>Single core time to impute Panel A and Panel B datasets using <italic>L</italic> = 8.</title>
        <p>Total time to impute 1, 000 target samples in a 10Mb window using simulation data in Panel A and Panel B dataset. Time is shown using the format mm:ss. Bold font is used to indicate the method with the lowest time. Minimac4 was not able to run using the Panel A 1M reference panel due to time constraints in the construction of the m3vcf file.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s004.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s005">
      <label>S1 Fig</label>
      <caption>
        <title>Imputation accuracy for the Panel A dataset and <italic>L</italic> = 8.</title>
        <p>Imputation accuracy when imputing genotypes from a simulated reference panel of 10K, 100K and 1M UK-European reference samples (Panel A). The horizontal axis in each panel is on a log scale.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s005.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s006">
      <label>S2 Fig</label>
      <caption>
        <title>Imputation accuracy for the 1000 Genomes and the HRC datasets using <italic>L</italic> = 8.</title>
        <p>Genotype imputation accuracy when imputing genotypes using the 1000 Genomes Project reference panel (<italic>n</italic> = 2452) and the Haplotype Reference Consortium reference panel (<italic>n</italic> = 31470). The horizontal axis in each panel is on a log scale.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s006.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s007">
      <label>S3 Fig</label>
      <caption>
        <title>Imputation accuracy varying parameter <italic>L</italic> and the selection algorithm using Panel A dataset.</title>
        <p>Genotype imputation accuracy when imputing genotypes using the 1000 Genomes Project reference panel (<italic>n</italic> = 2452) and the Haplotype Reference Consortium reference panel (<italic>n</italic> = 31470) for diffent values of the parameter <italic>L</italic> using the neighbour selection algorithm and the divergence selection algorithm. The horizontal axis in each panel is on a log scale.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s007.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s008">
      <label>S4 Fig</label>
      <caption>
        <title>Imputation accuracy varying parameter <italic>L</italic> and the selection algorithm using 1000 Genomes and HRC datasets.</title>
        <p>Imputation accuracy when imputing genotypes using the 1000 Genomes Project reference panel (<italic>n</italic> = 2452) and the Haplotype Reference Consortium reference panel (<italic>n</italic> = 31470) for different values of the parameter <italic>L</italic> using the neighbour selection algorithm and the divergence selection algorithm. The horizontal axis in each panel is on a log scale.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s008.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s009">
      <label>S5 Fig</label>
      <caption>
        <title>Imputation performance in the case of phasing errors.</title>
        <p>Imputation accuracy when imputing 1000 target samples from a simulated reference panel of 10K, 100K and 1M UK-European samples (Panel A) with no phasing errors (blue) and with a ≈ 2% switch error rate (red). The horizontal axis in each panel is on a log scale.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s009.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s010">
      <label>S6 Fig</label>
      <caption>
        <title>Distribution of the selected states on real datasets.</title>
        <p>Count of the number each reference haplotypes selected along the ten imputation chunks of chromosome 10 for the 1000 Genomes Project and HRC reference panel (top). Histogram of the selected counts for the two datasets (bottom).</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s010.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s011">
      <label>S7 Fig</label>
      <caption>
        <title>Per sample imputation time for Panel A and Panel B datasets and <italic>L</italic> = 8.</title>
        <p>Per-sample CPU time when imputing a 10 Mb region from 10K, 100K and 1M simulated UK-European reference samples into 1,000 target samples using one computational thread. (A) Imputation time when using Panel A dataset (3,333 target markers). (B) Imputation time when using Panel B dataset (33,333 target markers). Axes are on log scale. Hypothetical linear scaling of MINIMAC4, BEAGLE5 and IMPUTE5 are shown as dotted lines, generated by projecting the time using the 10K reference panel. Minimac4 was not able to run using the Panel A 1M reference panel due to time constraints in the construction of the m3vcf file.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s011.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pgen.1009049.s012">
      <label>S8 Fig</label>
      <caption>
        <title>Sub-linear scaling using <italic>L</italic> = 8.</title>
        <p>(A) Time per sample spent to impute a marker in a 10Mb region for reference panel size 10K, 100K, 1000K, when imputing 10, 100 and 1000 target samples. The vertical axis is on a log scale. (B) Mean number of copying states selected for the simulated reference panels. The number of selected states decreases by increasing the size of the reference panel, showing sub-linear scaling. Time and number of conditioning states are obtained with neighbours select and <italic>L</italic> = 8.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pgen.1009049.s012.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Professor Pier Palamara for useful discussions and support.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pgen.1009049.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Marchini</surname><given-names>J</given-names></name>, <name><surname>Howie</surname><given-names>B</given-names></name>. <article-title>Genotype imputation for genome-wide association studies</article-title>. <source>Nature Reviews Genetics</source>. <year>2010</year>;<volume>11</volume>(<issue>7</issue>):<fpage>499</fpage>–<lpage>511</lpage>. <pub-id pub-id-type="doi">10.1038/nrg2796</pub-id><?supplied-pmid 20517342?><pub-id pub-id-type="pmid">20517342</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Bycroft</surname><given-names>C</given-names></name>, <name><surname>Freeman</surname><given-names>C</given-names></name>, <name><surname>Petkova</surname><given-names>D</given-names></name>, <name><surname>Band</surname><given-names>G</given-names></name>, <name><surname>Elliott</surname><given-names>LT</given-names></name>, <name><surname>Sharp</surname><given-names>K</given-names></name>, <etal>et al</etal><article-title>The UK Biobank resource with deep phenotyping and genomic data</article-title>. <source>Nature</source>. <year>2018</year>;<volume>562</volume>(<issue>7726</issue>):<fpage>203</fpage>–<lpage>209</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-018-0579-z</pub-id><?supplied-pmid 30305743?><pub-id pub-id-type="pmid">30305743</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Zeggini</surname><given-names>E</given-names></name>, <name><surname>Ioannidis</surname><given-names>JPA</given-names></name>. <article-title>Meta-analysis in genome-wide association studies</article-title>. <source>Pharmacogenomics</source>. <year>2009</year>;<volume>10</volume>(<issue>2</issue>):<fpage>191</fpage>–<lpage>201</lpage>. <pub-id pub-id-type="doi">10.2217/14622416.10.2.191</pub-id><?supplied-pmid 19207020?><pub-id pub-id-type="pmid">19207020</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref004">
      <label>4</label>
      <mixed-citation publication-type="book"><name><surname>Marchini</surname><given-names>JL</given-names></name>. <chapter-title>Haplotype Estimation and Genotype Imputation</chapter-title> In: <source>Handbook of Statistical Genomics</source>. <edition>4th ed</edition>; <year>2019</year>.</mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Delaneau</surname><given-names>O</given-names></name>, <name><surname>Zagury</surname><given-names>JF</given-names></name>, <name><surname>Marchini</surname><given-names>J</given-names></name>. <article-title>Improved whole-chromosome phasing for disease and population genetic studies</article-title>. <source>Nature Methods</source>. <year>2013</year>;<volume>10</volume>(<issue>1</issue>):<fpage>5</fpage>–<lpage>6</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.2307</pub-id><?supplied-pmid 23269371?><pub-id pub-id-type="pmid">23269371</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Delaneau</surname><given-names>O</given-names></name>, <name><surname>Zagury</surname><given-names>JF</given-names></name>, <name><surname>Robinson</surname><given-names>MR</given-names></name>, <name><surname>Marchini</surname><given-names>J</given-names></name>, <name><surname>Dermitzakis</surname><given-names>E</given-names></name>. <article-title>Accurate, scalable and integrative haplotype estimation</article-title>. <source>Nature Communications</source>. <year>2019</year>; (<issue>10</issue>)<fpage>5436</fpage><pub-id pub-id-type="doi">10.1038/s41467-019-13225-y</pub-id><?supplied-pmid 31780650?><pub-id pub-id-type="pmid">31780650</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Loh</surname><given-names>PR</given-names></name>, <name><surname>Danecek</surname><given-names>P</given-names></name>, <name><surname>Palamara</surname><given-names>PF</given-names></name>, <name><surname>Fuchsberger</surname><given-names>C</given-names></name>, <name><surname>Reshef</surname><given-names>YA</given-names></name>, <name><surname>Finucane</surname><given-names>HK</given-names></name>, <etal>et al</etal><article-title>Reference-based phasing using the Haplotype Reference Consortium panel</article-title>. <source>Nature Genetics</source>. <year>2016</year>;<volume>48</volume>(<issue>11</issue>):<fpage>1443</fpage>–<lpage>1448</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3679</pub-id><?supplied-pmid 27694958?><pub-id pub-id-type="pmid">27694958</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Howie</surname><given-names>B</given-names></name>, <name><surname>Marchini</surname><given-names>J</given-names></name>, <name><surname>Stephens</surname><given-names>M</given-names></name>. <article-title>Genotype Imputation with Thousands of Genomes</article-title>. <source>G3: Genes, Genomes, Genetics</source>. <year>2011</year>;<volume>1</volume>(<issue>6</issue>):<fpage>457</fpage>–<lpage>470</lpage>. <pub-id pub-id-type="doi">10.1534/g3.111.001198</pub-id><pub-id pub-id-type="pmid">22384356</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><collab>International HapMap Consortium</collab>, <name><surname>Frazer</surname><given-names>KA</given-names></name>, <name><surname>Ballinger</surname><given-names>DG</given-names></name>, <name><surname>Cox</surname><given-names>DR</given-names></name>, <name><surname>Hinds</surname><given-names>DA</given-names></name>, <name><surname>Stuve</surname><given-names>LL</given-names></name>, <etal>et al</etal><article-title>A second generation human haplotype map of over 3.1 million SNPs</article-title>. <source>Nature</source>. <year>2007</year>;<volume>449</volume>(<issue>7164</issue>):<fpage>851</fpage>–<lpage>861</lpage>. <pub-id pub-id-type="doi">10.1038/nature06258</pub-id><?supplied-pmid 17943122?><pub-id pub-id-type="pmid">17943122</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><collab>1000 Genomes Project Consortium</collab>, <name><surname>Auton</surname><given-names>A</given-names></name>, <name><surname>Brooks</surname><given-names>LD</given-names></name>, <name><surname>Durbin</surname><given-names>RM</given-names></name>, <name><surname>Garrison</surname><given-names>EP</given-names></name>, <name><surname>Kang</surname><given-names>HM</given-names></name>, <etal>et al</etal><article-title>A global reference for human genetic variation</article-title>. <source>Nature</source>. <year>2015</year>;<volume>526</volume>(<issue>7571</issue>):<fpage>68</fpage>–<lpage>74</lpage>. <pub-id pub-id-type="doi">10.1038/nature15393</pub-id><?supplied-pmid 26432245?><pub-id pub-id-type="pmid">26432245</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Huang</surname><given-names>J</given-names></name>, <name><surname>Howie</surname><given-names>B</given-names></name>, <name><surname>McCarthy</surname><given-names>S</given-names></name>, <name><surname>Memari</surname><given-names>Y</given-names></name>, <name><surname>Walter</surname><given-names>K</given-names></name>, <name><surname>Min</surname><given-names>JL</given-names></name>, <etal>et al</etal><article-title>Improved imputation of low-frequency and rare variants using the UK10K haplotype reference panel</article-title>. <source>Nature Communications</source>. <year>2015</year>;<volume>6</volume>:<fpage>8111</fpage><pub-id pub-id-type="doi">10.1038/ncomms9111</pub-id><?supplied-pmid 26368830?><pub-id pub-id-type="pmid">26368830</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>McCarthy</surname><given-names>S</given-names></name>, <name><surname>Das</surname><given-names>S</given-names></name>, <name><surname>Kretzschmar</surname><given-names>W</given-names></name>, <name><surname>Delaneau</surname><given-names>O</given-names></name>, <name><surname>Wood</surname><given-names>AR</given-names></name>, <name><surname>Teumer</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>A reference panel of 64,976 haplotypes for genotype imputation</article-title>. <source>Nature genetics</source>. <year>2016</year>;<volume>48</volume>(<issue>10</issue>):<fpage>1279</fpage>–<lpage>1283</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3643</pub-id><?supplied-pmid 27548312?><pub-id pub-id-type="pmid">27548312</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Brody</surname><given-names>J</given-names></name>, <name><surname>Morrison</surname><given-names>A</given-names></name>, <name><surname>Bis</surname><given-names>J</given-names></name>, <name><surname>O’Connell</surname><given-names>J</given-names></name>, <name><surname>Brown</surname><given-names>M</given-names></name>, <name><surname>Huffman</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>Analysis commons, a team approach to discovery in a big-data environment for genetic epidemiology</article-title>. <source>Nature genetics</source>. <year>2017</year>;<volume>49</volume>(<issue>11</issue>):<fpage>1560</fpage>–<lpage>1563</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3968</pub-id><?supplied-pmid 29074945?><pub-id pub-id-type="pmid">29074945</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref014">
      <label>14</label>
      <mixed-citation publication-type="other">Caulfield M, Davies J, Dennys M, Elbahy L, Fowler T, Hill S, et al. The 100,000 Genomes Project Protocol. <ext-link ext-link-type="uri" xlink:href="https://doiorg/106084/m9figshare4530893v4">https://doiorg/106084/m9figshare4530893v4</ext-link>. 2017.</mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Durbin</surname><given-names>R</given-names></name>. <article-title>Efficient haplotype matching and storage using the positional Burrows-Wheeler transform (PBWT)</article-title>. <source>Bioinformatics</source>. <year>2014</year>;<volume>30</volume>(<issue>9</issue>):<fpage>1266</fpage>–<lpage>1272</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btu014</pub-id><?supplied-pmid 24413527?><pub-id pub-id-type="pmid">24413527</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Howie</surname><given-names>B</given-names></name>, <name><surname>Fuchsberger</surname><given-names>C</given-names></name>, <name><surname>Stephens</surname><given-names>M</given-names></name>, <name><surname>Marchini</surname><given-names>J</given-names></name>, <name><surname>Abecasis</surname><given-names>GR</given-names></name>. <article-title>Fast and accurate genotype imputation in genome-wide association studies through pre-phasing</article-title>. <source>Nature genetics</source>. <year>2012</year>;<volume>44</volume>(<issue>8</issue>):<fpage>955</fpage>–<lpage>959</lpage>. <pub-id pub-id-type="doi">10.1038/ng.2354</pub-id><?supplied-pmid 22820512?><pub-id pub-id-type="pmid">22820512</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref017">
      <label>17</label>
      <mixed-citation publication-type="other">Band G, Marchini J. BGEN: a binary file format for imputed genotype and haplotype data. BioRxiv. 2018;</mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Das</surname><given-names>S</given-names></name>, <name><surname>Forer</surname><given-names>L</given-names></name>, <name><surname>Schönherr</surname><given-names>S</given-names></name>, <name><surname>Sidore</surname><given-names>C</given-names></name>, <name><surname>Locke</surname><given-names>AE</given-names></name>, <name><surname>Kwong</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Next-generation genotype imputation service and methods</article-title>. <source>Nature Genetics</source>. <year>2016</year>;<volume>48</volume>(<issue>10</issue>):<fpage>1284</fpage>–<lpage>1287</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3656</pub-id><?supplied-pmid 27571263?><pub-id pub-id-type="pmid">27571263</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Browning</surname><given-names>BL</given-names></name>, <name><surname>Zhou</surname><given-names>Y</given-names></name>, <name><surname>Browning</surname><given-names>SR</given-names></name>. <article-title>A One-Penny Imputed Genome from Next-Generation Reference Panels</article-title>. <source>American Journal of Human Genetics</source>. <year>2018</year>;<volume>103</volume>(<issue>3</issue>):<fpage>338</fpage>–<lpage>348</lpage>. <pub-id pub-id-type="doi">10.1016/j.ajhg.2018.07.015</pub-id><?supplied-pmid 30100085?><pub-id pub-id-type="pmid">30100085</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name>. <article-title>BGT: efficient and flexible genotype query across many samples</article-title>. <source>Bioinformatics</source>. <year>2016</year>;<volume>32</volume>(<issue>4</issue>):<fpage>590</fpage>–<lpage>592</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btv613</pub-id><?supplied-pmid 26500154?><pub-id pub-id-type="pmid">26500154</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref021">
      <label>21</label>
      <mixed-citation publication-type="other">Ferragina P, Manzini G. Opportunistic data structures with applications. In: Proceedings 41st Annual Symposium on Foundations of Computer Science; 2000. p. 390–398.</mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>N</given-names></name>, <name><surname>Stephens</surname><given-names>M</given-names></name>. <article-title>Modeling Linkage Disequilibrium and Identifying Recombination Hotspots Using Single-Nucleotide Polymorphism Data</article-title>. <source>Genetics</source>. <year>2003</year>;<volume>165</volume>(<issue>4</issue>):<fpage>2213</fpage>–<lpage>2233</lpage>. <?supplied-pmid 14704198?><pub-id pub-id-type="pmid">14704198</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Browning</surname><given-names>BL</given-names></name>, <name><surname>Browning</surname><given-names>SR</given-names></name>. <article-title>Genotype Imputation with Millions of Reference Samples</article-title>. <source>American Journal of Human Genetics</source>. <year>2016</year>;<volume>98</volume>(<issue>1</issue>):<fpage>116</fpage>–<lpage>126</lpage>. <pub-id pub-id-type="doi">10.1016/j.ajhg.2015.11.020</pub-id><?supplied-pmid 26748515?><pub-id pub-id-type="pmid">26748515</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>Rabiner</surname><given-names>LR</given-names></name>. <article-title>A tutorial on hidden Markov models and selected applications in speech recognition</article-title>. <source>Proceedings of the IEEE</source>. <year>1989</year>;<volume>77</volume>(<issue>2</issue>):<fpage>257</fpage>–<lpage>286</lpage>. <pub-id pub-id-type="doi">10.1109/5.18626</pub-id></mixed-citation>
    </ref>
    <ref id="pgen.1009049.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Kelleher</surname><given-names>J</given-names></name>, <name><surname>Etheridge</surname><given-names>AM</given-names></name>, <name><surname>McVean</surname><given-names>G</given-names></name>. <article-title>Efficient Coalescent Simulation and Genealogical Analysis for Large Sample Sizes</article-title>. <source>PLoS computational biology</source>. <year>2016</year>;<volume>12</volume>(<issue>5</issue>):<fpage>e1004842</fpage><pub-id pub-id-type="doi">10.1371/journal.pcbi.1004842</pub-id><?supplied-pmid 27145223?><pub-id pub-id-type="pmid">27145223</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
