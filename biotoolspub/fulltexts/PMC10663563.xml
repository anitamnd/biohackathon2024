<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10663563</article-id>
    <article-id pub-id-type="publisher-id">43220</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43220-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SPACEL: deep learning-based characterization of spatial transcriptome architectures</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xu</surname>
          <given-names>Hao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Wang</surname>
          <given-names>Shuyan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fang</surname>
          <given-names>Minghao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luo</surname>
          <given-names>Songwen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Chunpeng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Siyuan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Rirui</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tang</surname>
          <given-names>Meifang</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6187-122X</contrib-id>
        <name>
          <surname>Xue</surname>
          <given-names>Tian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0485-3724</contrib-id>
        <name>
          <surname>Li</surname>
          <given-names>Bin</given-names>
        </name>
        <address>
          <email>libin@nibs.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7087-6540</contrib-id>
        <name>
          <surname>Lin</surname>
          <given-names>Jun</given-names>
        </name>
        <address>
          <email>linjun7@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5555-8437</contrib-id>
        <name>
          <surname>Qu</surname>
          <given-names>Kun</given-names>
        </name>
        <address>
          <email>qukun@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Department of Oncology, The First Affiliated Hospital of USTC, School of Basic Medical Sciences, Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff2"><label>2</label>Institute of Artificial Intelligence, Hefei Comprehensive National Science Center, Hefei, 230088 China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>School of Data Science, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/00wksha49</institution-id><institution-id institution-id-type="GRID">grid.410717.4</institution-id><institution-id institution-id-type="ISNI">0000 0004 0644 5086</institution-id><institution>National Institute of Biological Sciences, </institution></institution-wrap>Beijing, 102206 China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7603</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Spatial transcriptomics (ST) technologies detect mRNA expression in single cells/spots while preserving their two-dimensional (2D) spatial coordinates, allowing researchers to study the spatial distribution of the transcriptome in tissues; however, joint analysis of multiple ST slices and aligning them to construct a three-dimensional (3D) stack of the tissue still remain a challenge. Here, we introduce spatial architecture characterization by deep learning (SPACEL) for ST data analysis. SPACEL comprises three modules: Spoint embeds a multiple-layer perceptron with a probabilistic model to deconvolute cell type composition for each spot in a single ST slice; Splane employs a graph convolutional network approach and an adversarial learning algorithm to identify spatial domains that are transcriptomically and spatially coherent across multiple ST slices; and Scube automatically transforms the spatial coordinate systems of consecutive slices and stacks them together to construct a 3D architecture of the tissue. Comparisons against 19 state-of-the-art methods using both simulated and real ST datasets from various tissues and ST technologies demonstrate that SPACEL outperforms the others for cell type deconvolution, for spatial domain identification, and for 3D alignment, thus showcasing SPACEL as a valuable integrated toolkit for ST data processing and analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Spatial transcriptomics (ST) technologies detect transcript distribution in space. Here, authors present a deep learning based method SPACEL for cell type deconvolution, spatial domain identification and 3D alignment, showcasing it as a valuable toolkit for ST data analysis</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Bioinformatics</kwd>
      <kwd>Computational models</kwd>
      <kwd>Sequencing</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200),the National Natural Science Foundation of China grants (T2125012 and 91940306), CAS Project for Young Scientists in Basic Research YSBR-005, Anhui Province Science and Technology Key Program (202003a07020021) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (32170668),</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (81871479), the Fundamental Research Funds for the Central Universities (WK9100000001).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Spatial transcriptomics (ST) technologies have enabled researchers to detect the spatial distribution of, in principle, the entire transcriptome in histological tissue slices and thereby substantially improved our understanding of organ architecture<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup> and disease microenvironments<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>. There are two broad categories of experimental ST techniques that can either i) detect the expression of a partial transcriptome at single cell resolution or ii) detect an entire transcriptome without single-cell resolution. ST techniques based on in situ hybridization and fluorescence microscopy (image-based), such as seqFISH<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, osmFISH<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, and MERFISH<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> probe only hundreds to thousands of transcripts in a slice, but can achieve single cell and even subcellular resolution. ST techniques based on next-generation sequencing (seq-based), such as 10X Visium<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>, Slide-seq<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref></sup> and Stereo-seq<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> detect the expression of the whole transcriptome, but the resolution is restricted by the size of spots in the ST slices. Owing to limitations of these experimental ST techniques, many analytical methods have been developed to impute the undetected transcripts on each slice<sup><xref ref-type="bibr" rid="CR17">17</xref>–<xref ref-type="bibr" rid="CR20">20</xref></sup> and/or to deconvolute the cell types in each spot<sup><xref ref-type="bibr" rid="CR21">21</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, aiming to detect an entire transcriptome while retaining single-cell resolution.</p>
    <p id="Par4">A recent computational task for ST data analysis is the identification of clusters of cells/spots that are coherent in both transcriptome expression and spatial coordinates—i.e., dissecting the so-called spatial domains to characterize the spatial architecture present within an ST slice. Several methods have been developed to accomplish this task. For example, BayesSpace employs a Bayesian model and a Markov chain Monte Carlo approach to improve the resolution of ST data to the subspot level and then identifies spatial domains by clustering these subspots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. SpaGCN adopts a graph convolutional network to integrate the transcript expression level data with their spatial location information to identify spatial domains<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. STAGATE uses an adaptive graph attention auto-encoder model to learn the similarities between the neighboring spots to identify spatial domains<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. stLearn leverages a Louvain clustering algorithm and k-d tree nearest neighbor searching to identify spatial domains in ST slices<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The above-mentioned methods were designed for analyzing single ST slices.</p>
    <p id="Par5">The current trends for the rapid development and application of ST technologies suggest that a large number of ST slices from diverse tissues (and conditions) will be generated in scientific and medical studies for the foreseeable future<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR34">34</xref>–<xref ref-type="bibr" rid="CR37">37</xref></sup>. Accordingly, there is an urgent need for computational tools that can quickly and efficiently implement integrated analysis of data from multiple ST slices. STACI<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, PRECAST<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> aimed to identify spatial domains jointly across multiple ST slices. These methods utilize gene expression as the input for their models, specifically, STACI adopts an over-parameterization approach, PRECAST uses simple projections of the batch effects onto the space of biological effects and STAligner employs triplet-loss for training. However, it has been reported that cell-type distribution is more robust for identifying uniform domains across multiple slices<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>.</p>
    <p id="Par6">Accurately identifying functional spatial domains across multiple slices and reconstructing the 3D architecture of tissues offer invaluable opportunities for significant biological discoveries in various practical applications. The PASTE<sup><xref ref-type="bibr" rid="CR41">41</xref></sup> and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> methods made an effort to address these difficulties by integrating multiple slices into a single center slice, and/or aligning the consecutive slices to construct a 3D architecture of the tissue. PASTE assumes complete 2D overlap of slices, which restricts its applicability to cases where slices have only partial overlap. STAligner relies on selected landmark domains shared across slices for alignment and does not utilize correspondences for each individual spot in adjacent slices. As a result, these approaches can encounter misalignment issues in accurately capturing the global structure. Overall, constructing a stacked 3D alignment of the tissue still remains a great challenge for ST datasets with substantial defects.</p>
    <p id="Par7">Here, we developed SPACEL, a deep-learning-based toolkit comprising three modules—Spoint, Splane, and Scube—covering three analysis tasks for ST data (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). Spoint predicts the cell type composition of spots obtained by seq-based ST technologies such as 10X Visium. Splane jointly analyzes multiple ST slices and identifies spatial domains based on the cell type composition and spatial coordinate information of spots/cells. Scube aligns multiple consecutive slices and constructs a stacked 3D architecture of the tissue based on the coordinates of the spatial domains identified by Splane. We applied SPACEL to analyze 11 ST datasets comprising 156 slices acquired using the 10X Visium, STARmap, MERFISH, Stereo-seq, and Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> technologies (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). SPACEL outperformed other state-of-the-art methods for each of the three examined analysis tasks and thus represents a valuable integrated toolkit for ST data processing and analysis.<fig id="Fig1"><label>Fig. 1</label><caption><title>Workflow of SPACEL.</title><p><bold>a</bold> Three modules of SPACEL: Spoint, Splane, and Scube. <bold>b</bold> Spoint deconvolutes cell types of spots using an MLP and a probability model. MLP, multiple-layer perceptron; VAE, variational autoencoder. <bold>c</bold> Splane employs a GCN model and an adversarial learning algorithm to identify spatial domains across multiple slices. GCN, graph convolutional network. <bold>d</bold> For consecutive slices, Scube adopts a mutual nearest neighbor (MNN) graph and the differential evolution algorithm to transform slices and construct a stacked 3D alignment of a tissue.</p></caption><graphic xlink:href="41467_2023_43220_Fig1_HTML" id="d32e409"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Workflow of SPACEL</title>
      <p id="Par8">The full architecture of SPACEL is illustrated in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, including the modules Spoint, Splane and Scube. Our motivation for developing the Spoint module is the need to perform cell type deconvolution on ST slices generated by seq-base ST technologies, which is also required for subsequent analysis of SPACEL. Spoint embedded a multiple-layer perceptron (MLP) with a probabilistic model to deconvolute the cell type composition of each ST spot (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>, Methods). Spoint leverages a combination of simulated pseudo-spots, neural network modeling, and statistical recovery of expression profiles, which allows it to provide a more robust and accurate framework for estimating cell-type proportions in real ST data. For image-based ST data (i.e., single-cell resolution), users can simply use single-cell analysis tools (e.g., Seurat<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> and Scanpy<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>) to cluster cells and use marker genes to identify the cell type of each cell cluster.</p>
      <p id="Par9">Splane employs a graph convolutional network (GCN) approach<sup><xref ref-type="bibr" rid="CR44">44</xref>,<xref ref-type="bibr" rid="CR45">45</xref></sup> and an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to identify spatial domains by jointly analyzing multiple ST slices (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>, Methods). First, for each ST slice, Splane calculates an adjacency matrix of cells/spots based on their distance in space. Then, Splane constructs a GCN model from the adjacency matrix and the cell type composition of cells/spots, and employs an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to learn the latent features shared across all of the analyzed ST slices; we term this a joint analysis scheme. Next, Splane applies a K-means clustering algorithm<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> to aggregate cells/spots with similar patterns of the shared latent features, where each of these cell/spot clusters is referred to as a spatial domain. All existing spatial-domain identification tools commonly utilize gene expression as input for their analyses and most of them follow a single analysis scheme. Splane distinguishes itself by utilizing cell-type composition as the input and adopting a joint analysis scheme. Furthermore, Splane incorporates an adversarial training to explicitly tackle and eliminate batch effects across multiple slices.</p>
      <p id="Par10">For ST datasets containing consecutive slices, Scube aligns the Splane predicted coordinate systems for each pair of adjacent slices and then constructs a stacked 3D architecture of the tissue, which is fully automated and does not require any manual alignment (Fig. <xref rid="Fig1" ref-type="fig">1d</xref>, Methods). Briefly, Scube builds a mutual nearest neighbor (MNN) graph between the cells/spots of two adjacent slices based on the coordinate information of spots and constructs an alignment objective function between them. This function serves as the foundation for aligning the slices and treats the alignment task as an optimization problem. Unlike existing tools like PASTE or STAligner, Scube is specifically designed to handle partially overlapped slices by incorporating a penalty term that accounts for the proportion of overlapped spots in adjacent slices. Scube then employs a differential evolution optimization algorithm<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> to search for the optimal translation vectors and rotation angles for each slice, and aligns them by transforming the coordinates of every slice accordingly. Finally, Scube stacks the transformed slices to construct the 3D architecture of the tissue.</p>
      <p id="Par11">In summary, Spoint, Splane, and Scube accomplished three analysis tasks of ST data in turn: cell type deconvolution, spatial domain identification, and 3D architecture construction. We have carefully designed each module of our method in an innovative way to address the potential limitations of current state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>). Specifically, Spoint employs a statistical model, a pseudo-spot simulation, a deep learning technique, and an elimination of variation between reference and ST data. In contrast, other tools often miss one or more of these features. Splane is unique in its combination of a cell type composition as input — a feature not utilized by any other tools, and adversarial training in the GCN model — a common approach first been employed to mitigate batch effects in ST data. Scube employs a unique global optimization strategy for 3D alignment, setting it apart from its peers. While each of these modules can operate independently, they are also optimized to work seamlessly in a unified workflow. This adaptability enables SPACEL to analyze data from diverse experimental platforms while simultaneously providing an all-encompassing and streamlined solution for ST data interpretation.</p>
      <p id="Par12">To ensure the robustness of SPACEL, we conducted extensive experiments to evaluate its performance across various hyperparameter settings. Our results demonstrate that Spoint, Splane, and Scube exhibit superior robustness to hyperparameter variation compared to other state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a–c</xref>), highlighting the effectiveness of SPACEL in providing reliable and consistent results across different experimental settings.</p>
    </sec>
    <sec id="Sec4">
      <title>Spoint accurately deconvolutes cell-type composition</title>
      <p id="Par13">To construct the training set for Spoint and other deconvolution methods, we simulated pseudo-spots using the scRNA-seq dataset by assuming a normal distribution of the number of cells and the number of cell types per spot. Our simulations generated pseudo-spots similar to real ST data (MERFISH data from human brain tissue<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2d–k</xref>). We compared the performance of Spoint with state-of-the-art methods for cell type deconvolution, including Cell2lacation, SpatialDWLS, RCTD, STRIDE, Stereoscope, Tangram, DestVI, Seurat, SPOTlight, and DSTG using 32 simulated datasets from a benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). We adopted Pearson’s correlation coefficient (PCC) and structural similarity index measure (SSIM) to assess the similarity between the predicted and true cell type compositions, and used root mean square deviation (RMSE) and Jensen-Shannon divergence (JSD) to assess the error of each method. Spoint yielded the highest average PCC/SSIM values (= 0.73/0.69), and the lowest average RMSE/JSD values (=0.05/0.41) among the 11 deconvolution methods (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Additionally, we applied the accuracy score (AS) defined in the benchmark study to evaluate the performance of each method: the average AS of Spoint ( = 0.93) was obviously higher than that of the other methods (AS = 0.24–0.82; Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Cell type deconvolution of spots using Spoint and other deconvolution methods.</title><p><bold>a</bold> Average PCC, SSIM, RMSE, and JSD values of the deconvolution methods for 32 simulated datasets from the benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>; PCC, pearson’s correlation coefficient<bold>;</bold> SSIM, structural similarity index measure; RMSE, root mean square error; JSD, Jensen-Shannon divergence; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>b</bold> Accuracy scores of the deconvolution methods for the 32 simulated datasets. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>c</bold> Spatial distributions of excitatory layer 3/4 RORB<sup>+</sup>RPS3P6<sup>+</sup> neurons predicted by the deconvolution methods for the DLPFC dataset. <bold>d</bold> Accuracy scores of the deconvolution methods for the DLPFC dataset. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 56 cell types. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig2_HTML" id="d32e541"/></fig></p>
      <p id="Par14">To evaluate Spoint’s performance in cell type deconvolution on real ST experimental data, we used two datasets as input: a 10X Visium dataset for the human dorsolateral prefrontal cortex (DLPFC) that contains 12 ST slices<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> and a human brain scRNA-seq dataset downloaded from the Allen Brain Map<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. As there is no experimental evidence for the cell type composition of each spot in this dataset, we took the cortical layers annotated by the original studies as ground truth (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c</xref>). As one example, we found that the distribution of excitatory L3/4 neurons predicted by Spoint had a higher AS value (= 0.85) than the other examined deconvolution methods (AS = 0.29–0.64; Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Collectively, for all 56 cell types<sup><xref ref-type="bibr" rid="CR52">52</xref>,<xref ref-type="bibr" rid="CR53">53</xref></sup> in all 12 ST slices, the average AS of Spoint ( = 0.60) was again higher than those of the other methods (average AS = 0.30–0.48; Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Furthermore, we calculated the significance (using the Wilcoxon Rank Sum test) of any difference in the proportion of one cell type between the layers, with a lower <italic>P</italic>-value representing increased deconvolution accuracy<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. We found that the average <italic>P</italic>-value of Spoint ( = 0.01) was lower than that of the other methods (average <italic>P</italic>-values = 0.05–0.64; Supplementary Fig. <xref rid="MOESM1" ref-type="media">3d</xref>).</p>
      <p id="Par15">To further evaluate Spoint’s performance in real ST datasets, we collected three single-cell resolution ST datasets: Chen et al. mouse embryo brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Chen et al. mouse brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and Fang et al. human brain (MERFISH with 4000 genes)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup> to simulate spot-level ST data with known cell-type composition and spatial context. We also obtained the corresponding scRNA-seq data from the same tissue types as reference. Using these data, we aggregated approximately 10 cells into each pseudo spot, creating three distinct spot-level ST datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). As an example, we observed that Spoint achieved the highest PCC compare to other cell type deconvolution methods for forebrain glutamatergic neuroblast in dataset 1 (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). We then evaluated the deconvolution performance of the Spoint module on all cell types across the three datasets using four evaluation metrics. Our findings demonstrate that Spoint consistently outperformed existing methods, achieving the highest accuracy scores in all three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c, d</xref>). In addition, we evaluated the relative error between the summed predicted cell type proportions and the ground truth, and found that SpatialDWLS (with rankings of 1, 2, and 3) and Spoint (with rankings of 4, 3, and 1) registered the lowest average relative error across the three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>). These results provide strong evidence of the Spoint module’s superior performance over other methods, and an accurate deconvolution result will facilitate subsequent identification of spatial domains using Splane.</p>
    </sec>
    <sec id="Sec5">
      <title>Splane identifies spatial domains for multiple slices</title>
      <p id="Par16">After cell types were deconvoluted with Spoint, we applied Splane to identify the spatial domains of the aforementioned ST slices of the DLPFC dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). We used the original study’s manual annotation of cortical layers as the ground truth<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, and used three metrics to evaluate the prediction performance. Specifically, we used the Jaccard index (JI) and Adjusted Rand Index (ARI) between a spatial domain identified by Splane and the corresponding cortical layer from the ground truth to assess the accuracy of the method, and computed the shifting distance (SD) between the prediction and the ground truth to quantify the error of Splane (see Methods). A higher JI/ARI value or a lower SD value indicates that the prediction is closer to the ground truth.</p>
      <p id="Par17">First, we compared the results obtained by processing all slices jointly (joint analysis, by default) to those obtained by processing each slice individually (single analysis). To enable this comparison, we built a test version of Splane, namely, Splane-single, that constructs a GCN model for each slice individually. Taking slices 151508, 151510, 151670, and 151673 from the DLPFC dataset as examples, the JI values obtained by the joint analysis were higher than those obtained by the single analysis, and the SD values obtained by the joint analysis were lower than those obtained by the single analysis (Fig. <xref rid="Fig3" ref-type="fig">3a, b</xref>). Moreover, upon processing the entire 12 slices dataset, the average JI/median ARI values by joint analysis were 0.61/0.61, higher than that by the single analysis ( = 0.53/0.57; Fig. <xref rid="Fig3" ref-type="fig">3c, d</xref>); the average SD value by the joint analysis was 50 μm, much lower than that by the single analysis ( = 262 μm; Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). This comparison implies that the joint analysis scheme improves the accuracy of Splane for spatial identification.<fig id="Fig3"><label>Fig. 3</label><caption><title>Identification of spatial domains from 12 10X Visium slices of DLPFC.</title><p><bold>a</bold> Comparison of spatial domains identified by Splane, STAligner, PRECAST, and STACI for slice 151508, 151510, 151670, and 151673. Layer1~Layer6, cortical layer 1 ~ 6; WM, white matter; JI, Jaccard index; SD, shifting distance. <bold>b</bold> Spatial domains identified by Splane-single, STAGATE, SpaGCN, BayerSpace, and stLearn for the four slices. <bold>c</bold>–<bold>e</bold> Jaccard indexes (<bold>c</bold>), Adjusted Rand Indexes (<bold>d</bold>), and shifting distances (<bold>e</bold>) between cortical layers and corresponding spatial domains identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. The gray background represents for the methods for multiple slice analysis. Center line, median value; bar height, mean value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range for box plots, mean values ± 95% confidence intervals for bar plots; <italic>n</italic> = 12 slices. <bold>f</bold> Proportion of SVGs identified by the spatial-domain-identification methods when using fold-change &gt; 0.5 and <italic>P</italic>-value &lt; 0.01 (two-sided Wilcoxon rank-sum test) as cut-offs. The gray background represents the methods used for multiple slice analysis. SVGs, spatial variable genes; bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 5 methods for single analysis. <bold>g</bold> Receiver operating characteristic (ROC) curves of SVGs identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. Whiskers, standard errors; <italic>n</italic> = 12 slices. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig3_HTML" id="d32e686"/></fig></p>
      <p id="Par18">We then compared the performance of Splane against other state-of-the-art spatial-domain-identification methods, including methods designed for analyzing multiple ST slices such as STAligner, PRECAST and STACI, as well as methods that are designed for analyzing single ST slice such as STAGATE, SpaGCN, BayesSpace, and stLearn, using the same evaluation criteria (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). In analyzing all 12 ST slices of the DLPFC dataset, Splane exhibited the highest accuracy (average JI/median ARI = 0.61/0.61) and the lowest error (average SD = 53 μm), while other tools had JI/ARI and SD ranges of 0.41–0.56/0.36–0.54 and 75–548 μm (Fig. <xref rid="Fig3" ref-type="fig">3a–e</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>). Thus, Splane outperforms available alternative methods for spatial domain identification.</p>
      <p id="Par19">Spatial expression variation of genes can reflect the states, communications, and dynamics of cells, and therefore accurate identification of spatial variable genes (SVGs) from ST slices is crucial for determining the functions and phenotypes of cells in spatial domains. We thereby compared these methods for the task of identifying SVGs that represent specific cortical layers. We adopted the SVGs for cortical layers 1 ~ 6 and white matter (WM) annotated by the original study<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> as the ground truth, and evaluated the performance of each method by computing the overlap between the identified SVGs and the ground truth. Using a fold-change &gt; 0.5 and a <italic>P</italic>-value &lt; 0.01 as cut-offs for SVGs, we found that tools designed for analyzing multiple ST slices identified more SVGs compared to those designed for analyzing single ST slice. Splane, PRECAST, STAligner and STACI identified 1714, 1671, 1669 and 1527 out of 1917 SVGs of cortical layers 1 ~ 6 and WM, while the other examined methods identified only 179 ~ 1336 SVGs for each slice when the same cut-offs were applied (Fig. <xref rid="Fig3" ref-type="fig">3f</xref>). Similarly, using the receiver operating characteristic (ROC) curves as indicators for SVG prediction accuracy, we found that Splane, PRECAST and STAligner yielded the highest area under the curve value (AUC = 0.90, 0.89 and 0.88 respectively) among all examined methods (AUCs &lt; 0.83; Fig. <xref rid="Fig3" ref-type="fig">3g</xref>). These results emphasize the power of the Splane’s joint analysis scheme for identifying SVGs from multiple ST slices.</p>
      <p id="Par20">To assess the importance of the Spoint module in facilitating accurate spatial-domain identification using the Splane module, we conducted two comparative analyses on the human DFPLC datasets. First, we compared the performance of Splane using three different input types: highly variable gene expression matrix, PCA reduction of highly variable gene expression matrix, and cell-type proportions predicted by Spoint. Results showed that using only the cell-type proportion predicted by Spoint as input yielded spatial-domain identification results that closely resembled the ground truth, with significantly higher JI values in all 12 slices compared to the other input types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>). Second, we evaluated the performance of Splane using cell-type deconvolution results from other methods as input. Results demonstrated that using the cell-type proportions predicted by Spoint yielded the best spatial-domain identification outcome (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>). Notably, the identification of Layer4 was only possible when using the cell-type proportions predicted from Spoint as input.</p>
    </sec>
    <sec id="Sec6">
      <title>Splane identifies spatial domains from cancer slices</title>
      <p id="Par21">To test the performance of Splane in identifying spatial domains from disease slices, we applied Splane to jointly analyze 11 breast cancer 10X Visium slices from three experimental batches, including six slices reported in ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, four slices released by 10X Genomics<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>, and one slice from the study conducted in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. We first performed cell type deconvolution in each slice using Spoint and obtained the cell type identification (based on the expression of selected marker genes) and composition of each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>).</p>
      <p id="Par22">Subsequently, we applied Splane and identified ten spatial domains across the 11 slices (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). Notably, the extent of the batch effect between slices from different experiments was significantly reduced in Splane compared to that of the raw data and Splane without adversarial learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). We then explored the cell type composition of each predicted spatial domain and annotated these domains accordingly: domains D0-3, D4–6 and D7–9 were defined as tumor (tumor cell-enriched), intermediate (mixed cell types) and immune (immune cell-enriched) domains, respectively (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d</xref>, Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Joint analysis of 11 breast cancer ST slices from three different datasets.</title><p><bold>a</bold> Spatial domains identified by Splane in slice S2 and S5 from Wu et al. dataset, slice S10 from Zhao et al. dataset, and slice S11 released by 10X Genomics. <bold>b</bold>, <bold>c</bold> Spatial distribution of chromosome 1q&amp;8q copy number gains (<bold>b</bold>) and 1p copy number losses (<bold>c</bold>) of ST spots in slices S11, calculated by inferCNV. Dashed lines represent the tumor domain. <bold>d</bold>, <bold>e</bold> CNVs of chromosome 1q &amp; 8q (<bold>d</bold>) and chromosome 1p (<bold>e</bold>) in each spatial domain calculated by inferCNV. CNVs, copy number variations; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 11 slices. <bold>f</bold> From left to right: Splane predicted spatial domains in slice S5, distribution of Splane predicted immune domains D7/D8/D9, distribution of Spoint predicted immune cells, and distribution of H&amp;E staining marked immune spots. <bold>g</bold> Percentage of H&amp;E staining marked immune spots in each domain of slice S1, S2, S5, and S6. The four slices were H&amp;E stained in the original study. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 4 slices. <bold>h</bold> From left to right: Splane predicted spatial domains in slice S10, distribution of Splane predicted immune domains D7, D8, and D9, distribution of Spoint predicted immune cells, and distribution of CD3<sup>+</sup> immunofluorescence (IF) staining marked immune spots. <bold>i</bold> Percentage of CD3<sup>+</sup> IF staining marked immune spots in each domain of slice S10. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig4_HTML" id="d32e812"/></fig></p>
      <p id="Par23">We then applied two distinct approaches to assess the accuracy of the Splane predictions for the tumor and immune domains. Since tumor cells in breast cancer patients often bear chromosomal copy number variations (CNVs)—including chromosome 1q and 8q gains and/or chromosome 1p losses<sup><xref ref-type="bibr" rid="CR55">55</xref>,<xref ref-type="bibr" rid="CR56">56</xref></sup> —our first approach was to calculate the CNVs of each ST spot and check for enrichment of CNVs in the predicted tumor domains. Using inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>, we calculated the CNVs for all spots in all 11 ST slices from the expression matrix of the ST data. Taking slice 11 as an example, the four tumor domains predicted by Splane had copy number gains in chromosomes 1q and 8q (inferred CNV ≥ 0.2) as well as copy number losses for chromosome 1p (inferred CNV ≤ −0.2; Fig. <xref rid="Fig4" ref-type="fig">4b, c</xref>). In contrast, fewer or no copy number gains or losses were detected in the Splane-predicted intermediate or immune domains (inferred CNV = −0.2 ~ 0.2). Taking all 11 slices into account by the average CNV values, we also observed chromosome 1q and 8q gains (average CNV &gt; 0.2) and chromosome 1p losses (average CNV &lt; −0.2) in tumor domains, but less in intermediate and none in immune domains (Fig. <xref rid="Fig4" ref-type="fig">4d, e</xref>).</p>
      <p id="Par24">Our second approach was to calculate the percentage of experimentally annotated immune spots and check for enrichment of immune spots in spatial domains. We took the H&amp;E-staining-marked lymphocyte-enriched spots in slice S1, S2, S5, and S6 from ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and the CD3<sup>+</sup> immunofluorescence(IF)-marked T cell-enriched spots in slice S10 from ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup> as the ground truth for immune spots. We then calculated the percentage of immune spots in each of the Splane identified domains. We found higher percentages of H&amp;E-staining-marked immune spots in immune domains D9, D8, and D7 in slice S1, S2, S5, and S6 (44%, 8%, and 6%, respectively) than in the intermediate and tumor domains ( &lt; 1%) (Fig. <xref rid="Fig4" ref-type="fig">4f, g</xref>). Similarly, in slice S10, we found more CD3<sup>+</sup> IF-marked immune spots in immune domains D9, D8, and D7 (72%, 70%, and 63% respectively) than in intermediate and tumor domains ( &lt; 47%) (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref>). These results support Splane’s prediction of tumor and immune domains.</p>
      <p id="Par25">In the context of tumor systems, accurately identifying tumor boundaries is crucial for immuno-oncology research. We compared the ability of Splane and other multi-slice analysis algorithms, including STAligner, PRECAST, and STACI, to identify tumor boundaries. In the human breast cancer 10X Visium data, only Splane accurately identified tumor regions with distinct boundaries (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12a</xref>). The tumor regions predicted by Splane were consistent with CNV gains or losses in specific chromosomes, and they aligned well with evident tumor tissue regions in H&amp;E images. Furthermore, we observed a significant correlation between the proportion of tumor cells and CNV scores specifically in the spatial domains identified by Splane (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12b</xref>). These results highlight Splane’s ability to identify consistent tumor regions and boundaries across multiple slices in tumor systems.</p>
    </sec>
    <sec id="Sec7">
      <title>Scube constructs 3D architecture of tissue from consecutive 2D slices</title>
      <p id="Par26">Most current experimental ST techniques measure the distribution of transcripts in 2D space, yet tissues are obviously 3D, and functions of cells are distributed in space. We thereby developed the Scube module of SPACEL to construct and investigate the 3D architecture of a given tissue. We first employed a 3D STARmap dataset of the mouse brain from ref. <sup><xref ref-type="bibr" rid="CR58">58</xref></sup> (originally 1400 μm × 1700 μm × 100 μm) and divided it into ten slices of 10 μm thickness each as the ground truth (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). We randomly rotated, flipped, and cropped each slice to simulate a perturbed ST dataset comprising consecutive 2D slices (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, see Methods). We defined the percentage of a slice that was randomly cropped out as the crop ratio of that slice. At each level of crop ratio, we used Splane to identify the spatial domains across the ten slices, and applied Scube to align these slices by transforming their coordinate systems based on the Splane-identified spatial domains.<fig id="Fig5"><label>Fig. 5</label><caption><title>3D alignments of consecutive ST slices for the mouse brain.</title><p><bold>a</bold> The 3D STARmap dataset of the mouse brain. <bold>b</bold> Simulating an ST dataset with consecutive 2D slices by dividing the 3D STARmap dataset into ten 2D slices and randomly rotating/flipping/cropping each slice. <bold>c</bold> Alignment of the simulated dataset with crop ratio=0.25, generated by Scube, STAligner, and PASTE. Dashed lines represent the positions of the ground truths. SSIM, structural similarity index measure; PCC, Pearson’s correlation coefficient. <bold>d</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s results for simulated datasets with crop ratios from 0 to 0.25. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 10 slices. <bold>e</bold> Stacked 3D alignments constructed by Scube (left), STAligner (middle), and PASTE (right) from 33 MERFISH slices of mouse primary motor cortex. <bold>f</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s alignment results for the MERFISH dataset. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 33 slices. <bold>g</bold> Continuous expression distribution of the genes <italic>Cux2</italic>, <italic>Slc30a3</italic>, and <italic>Bcl11b</italic> on the surface of the 3D architecture of the mouse brain after applying the GPR model in Scube. BF, Bayes factor. <bold>h</bold> Continuous expression distribution of <italic>Cux2</italic> in the coronal plane of the 3D architecture of the mouse brain. BF, Bayes factor. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig5_HTML" id="d32e926"/></fig></p>
      <p id="Par27">We adopted SSIM and PCC as the metrics to assess the similarity between the transformed coordinate system and the ground truth for each slice. Higher SSIM and PCC values indicate better alignment. Recall that STAligner and PASTE are two state-of-the-art methods for constructing 3D alignments of tissue from consecutive ST slices<sup><xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, we compared the performance of Scube with STAligner and PASTE for aligning the simulated dataset under crop ratios from 0 to 0.25. Since the alignment results of STAligner and PASTE can be affected by their hyperparameters, we first performed a parameter optimization search to achieve the best alignment results of STAligner and PASTE (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13</xref>), before it was compared with Scube. With a crop ratio equal to 0.25, the average SSIM/PCC values of the Scube-transformed slices were 0.96/0.97, whereas the values for the STAligner-transformed slices were 0.76/0.77 and for the PASTE-transformed slices were 0.72/0.75. (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). With crop ratios range = 0.10, 0.15, 0.20, and 0.25, the average SSIM values of the Scube-transformed slices were 0.98, 0.98, 0.97 and 0.96, higher than those by STAligner ( = 0.79, 0.79, 0.72, and 0.76) or PASTE ( = 0.82, 0.77, 0.74, and 0.72; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Similarly, the average PCC values of the Scube-transformed slices were 0.99, 0.98, 0.98, and 0.97, which were also higher than those by STAligner ( = 0.80, 0.81, 0.73, and 0.77) or PASTE ( = 0.85, 0.79, 0.76, and 0.75; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), suggesting a better alignment in Scube for the simulated dataset.</p>
      <p id="Par28">To further compare the performance of Scube, STAligner and PASTE in constructing a 3D architecture on real ST dataset, we examined a mouse primary motor cortex (MOp) profile, which contains 33 consecutive 2D slices from the MERFISH experiment<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. We first applied Splane and identified seven spatial domains from the 33 consecutive 2D slices, which exhibited the highest accuracy in spatial domain identification (average JI/median ARI = 0.44/0.43) compared to STACI (average JI/median ARI = 0.43/0.38), STAligner (average JI/median ARI = 0.33/0.25) and PRECAST (average JI/median ARI = 0.23/0.16; Supplementary Fig. <xref rid="MOESM1" ref-type="media">14</xref>). We then used Scube to align these slices by transforming the coordinate systems of each pair of adjacent slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15a, b</xref>). Next, by stacking the transformed 2D slices together, we constructed a 3D architecture of MOp in Scube, enabling a 3D illustration of spatial domains and cell types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par29">In parallel, we applied STAligner and PASTE to perform an alignment and 3D construction from the same dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15</xref>). Since no ground truth is known in this case, we calculated the SSIM/PCC values between every two adjacent transformed slices to evaluate the alignment performance of the two methods, and found that the average SSIM/PCC values of the Scube-transformed slices were 0.71/0.76, significantly higher than those by STAligner (SSIM/PCC = 0.61/0.65) or PASTE (SSIM/PCC = 0.57/0.61; Fig. <xref rid="Fig5" ref-type="fig">5f</xref>). Notably, when stacking the 2D transformed slices using either STAligner or PASTE, we obtained a twisted 3D architecture of MOp (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par30">SPACEL also integrated a Gaussian process regression (GPR) model<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in Scube, which predicts the expression level of a gene at any position in the 3D architecture, enabling a continuous illustration of transcript distribution along any direction in space (Fig. <xref rid="Fig5" ref-type="fig">5g</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16a, b</xref>). By quantifying the Bayes Factor (BF, see Methods) of the GPR model, SPACEL is capable of identifying genes that vary significantly in any direction within the 3D space of tissue (Fig. <xref rid="Fig5" ref-type="fig">5h</xref>). SPACEL thereby allows users to explore the dynamics of transcript distributions from any direction, and hence reveals a real 3D structure of the spatial architecture of complex tissues or organs.</p>
      <p id="Par31">Accurate reconstruction of detailed 3D structures is crucial for unraveling biological phenomena in spatial omics data. In the mouse embryo Stereo-seq data<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Scube achieved better performance compared to STAligner and PASTE in accurately reconstructing and depicting structures like brain, liver and paws (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a, b</xref>). Furthermore, Scube (SSIM/PCC = 0.62/0.66) exhibited higher consistency in the distribution of tissue regions between slices compared to STAligner (0.57/0.61) and PASTE (0.24/0.25) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17c</xref>). In summary, the Scube module of SPACEL outperformed STAligner and PASTE in alignment and 3D architecture construction in both the simulated (STARmap) and real (MERFISH and Stereo-seq) datasets.</p>
    </sec>
    <sec id="Sec8">
      <title>SPACEL as an integrated toolkit for ST data processing and analysis</title>
      <p id="Par32">To highlight the integrated nature of SPACEL, we applied a fully integrated workflow to analyze mouse whole brain ST data<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>. The dataset consisted of 75 consecutive slices generated by Spatial Transcriptomics technology<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> with a spot resolution of 100 μm, covering a large portion of the mouse brain region. Using the original brain region annotations as the reference ground truth, we evaluated the performance of each module. In Spoint, the predicted distribution of major region-specific cell types matched well with the corresponding brain regions, such as excitatory neurons and hippocampus CA1 and CA3 cells predominantly predicted in the hippocampal region (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b</xref>). In Splane, we compared its performance against STAligner, PRECAST and STACI. The average JI/median ARI values of the spatial domains identified by Splane (0.42/0.56) were higher than those identified by STAligner (0.36/0.40), PRECAST (0.35/0.38) and STACI (0.31/0.40) across the 75 slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18c, d</xref>). In Scube, the 3D tissue reconstruction achieved by Scube (SSIM/PCC = 0.83/0.85) exhibited high coherence and accuracy, surpassing the results obtained by PASTE (0.82/0.84) and STAligner (0.79/0.81) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18e, f</xref>). These results clearly demonstrate that SPACEL serves as an effective integrated toolkit for analyzing multiple ST slices.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par33">In this study, we introduced a deep learning-based toolkit, SPACEL, comprising three modules: Spoint for cell type deconvolution, Splane for the identification of spatial domains across multiple ST slices, and Scube for the construction of 3D architecture from consecutive ST slices. We have demonstrated that the SPACEL modules outperform state-of-the-art methods for each of these tasks through analyses of 32 simulated and 11 real ST datasets acquired using five distinct ST technologies. While each module can be utilized separately, their synergistic interplay within the SPACEL platform offers an all-encompassing and streamlined solution for the best results of ST data interpretation, particularly accurate 3D tissue alignment, precise spatial domain identification, and effective batch effect removal.</p>
    <p id="Par34">Unlike the other state-of-the-art methods, the Splane module of SPACEL combines the cell type composition as input and adversarial training in the GCN model. Since the spatial distribution of genes, cells, and cell clusters from distinct ST experiments can be extremely heterogeneous, using cell type composition as input and introducing adversarial training to the GCN model significantly minimizes batch effects, leading to a more robust and efficient method for spatial domain identification. The joint analysis scheme that Splane incorporated is also particularly powerful to identify common features, and hence to accurately predict SVGs across multiple slices.</p>
    <p id="Par35">Spatial domains identified in Splane also set a foundation for Scube to achieve an accurate alignment of the consecutive slices and hence a precise 3D architecture construction. In contrast, the PASTE algorithm uses the raw expression matrix and spatial coordinates from the ST data as input for alignment, and a hyperparameter α to adjust the relative contributions of transcriptional dissimilarity and spatial distances among the aligned spots. This design makes PASTE’s alignment results sensitive to hyperparameters in datasets with significant defects (e.g., slices with crop ratios ≥ 0.25). On the other hand, STAligner constructs MNN based on the raw expression matrix to select landmark spots/cells and relies on user-defined landmark domains shared across slices for alignment. However, this approach does not utilize complete information on each spot of the whole slice, which limits its ability to balance global structure similarity and alignment accuracy, particularly in the case of partially overlapped slices. In contrast, Scube adopts a global optimization strategy for 3D alignment, taking into account the correspondences between all spots in adjacent slices. This innovative method enables Scube to achieve more precise alignment, preserving the overall structural integrity in the process of spatial alignment.</p>
    <p id="Par36">To enhance the accessibility of the GPR model for 3D spatial transcriptomics, we have developed a user-friendly Python code by integrating the original MATLAB code and third-party GUI software. This integration enables researchers to easily access and utilize the model, fostering advancements in the field and promoting broader adoption of this technology within the scientific community. There are opportunities to improve the performance of SPACEL and extend its application. For example, Splane uses cell type composition information as input for the model; this means that to process seq-based ST datasets such as 10X Visium, one has to employ a cell type deconvolution algorithm such as Spoint to obtain the cell type composition information before Splane can be applied. Besides, the current version of Scube does not support nonlinear alignment as well as STAligner and PASTE. Although there are several tools that can nonlinearly align image data by setting anchor points manually, to our knowledge there is no method yet to do it automatically for ST data analysis. We acknowledge this limitation and plan to address this issue in a future version of Scube. Another issue for SPACEL is that when a new slice is added to the dataset, the entire deep learning model needs to be retrained from scratch, which may affect the computational efficiency of SPACEL to analyze large-scale datasets. We anticipate that transfer learning models and algorithms (e.g., ImageNet<sup><xref ref-type="bibr" rid="CR61">61</xref></sup> and BERT<sup><xref ref-type="bibr" rid="CR62">62</xref></sup>), which have been used in bioinformatics tasks such as cell type classification for large-scale single-cell data<sup><xref ref-type="bibr" rid="CR63">63</xref>–<xref ref-type="bibr" rid="CR66">66</xref></sup>, can help us to overcome this limitation.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Construction of simulated ST data from scRNA-seq data</title>
      <p id="Par37">To establish training sets for Spoint and other deconvolution methods, we employed cells from a scRNA-seq dataset to simulate pseudo-spots, where the cell type composition of each pseudo-spot can be ascertained from its constituent cells. Specifically, assuming that the number of cells at each spot (<inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq1.gif"/></alternatives></inline-formula>) follows a normal distribution <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{c},{\delta }_{c})$$\end{document}</tex-math><mml:math id="M4"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq2.gif"/></alternatives></inline-formula>, and the number of cell types at each spot (<italic>N</italic><sub><italic>t</italic></sub>) follows a normal distribution <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{t},{\delta }_{t})$$\end{document}</tex-math><mml:math id="M6"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq3.gif"/></alternatives></inline-formula>, we set the default parameters as <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{c}=10,{\delta }_{c}=5,{\mu }_{t}={\mu }_{c}/2,{\delta }_{t}={\delta }_{c}/2$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq4.gif"/></alternatives></inline-formula>. Researchers can also detect <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq5.gif"/></alternatives></inline-formula> from the image of an ST slice using stardist<sup><xref ref-type="bibr" rid="CR67">67</xref></sup> or DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup>, and use it as the input parameter. We first generated <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{t}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq6.gif"/></alternatives></inline-formula> for each sampled spot, and then sampled cells from the scRNA-seq data associated with each spot. Each cell was sampled based on its sampling probability which is determined by <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq7.gif"/></alternatives></inline-formula>. <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq8.gif"/></alternatives></inline-formula> for each spot is defined as:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}=\left\{\begin{array}{c}{f}_{t}\,{if}\, 0 \, &lt; \, {r}_{c} \, &lt; \, \frac{1}{3}\hfill\\ \frac{1/{f}_{t}}{\mathop{\sum}\limits_{t}\left(1/{f}_{t}\right)}\,{if}\,\frac{1}{3}\le {r}_{c} &lt; \frac{2}{3}\hfill\hfill\\ \frac{\sqrt{{f}_{t}}}{\mathop{\sum}\limits_{t}\left(\sqrt{{f}_{t}}\right)}\,{if}\,\frac{2}{3}\le {r}_{c} &lt; 1\end{array}\right.$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced open="{"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq9"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{t}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq9.gif"/></alternatives></inline-formula> is the composition of each cell type in the scRNA-seq data, and <inline-formula id="IEq10"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${r}_{c}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq10.gif"/></alternatives></inline-formula> is a random value between 0 and 1. We then randomly sampled cells of each cell type from the scRNA-seq data, and combined the gene expression of <inline-formula id="IEq11"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq11.gif"/></alternatives></inline-formula> sampled cells to generate an original spot. During the cell sampling process, we calculated the cell type numbers of these sampled cells. These cell type numbers serve as the cell type labels for the spot. We then estimated the mean value <inline-formula id="IEq12"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }^{L}$$\end{document}</tex-math><mml:math id="M26"><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq12.gif"/></alternatives></inline-formula> and standard deviation <inline-formula id="IEq13"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }^{L}$$\end{document}</tex-math><mml:math id="M28"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq13.gif"/></alternatives></inline-formula> of gene expression for each spot from a real ST data, and down-sampled the original spot using the downsampleMatrix function of the Scuttle package<sup><xref ref-type="bibr" rid="CR69">69</xref></sup> to obtain a simulated spot that has gene expression distribution similar to that of the real ST data.</p>
    </sec>
    <sec id="Sec12">
      <title>Deconvolution model of Spoint</title>
      <p id="Par38">Spoint contains three deep learning models. The first model is a variational autoencoder (VAE) model, consisting of an encoder layer, a decoder layer, and three hidden layers. The three hidden layers contain 128, 64, and 128 nodes, respectively. The input variables of the encoder and decoder layers are gene expression levels at each spot, <inline-formula id="IEq14"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M30"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq14.gif"/></alternatives></inline-formula>, so the dimension of these two layers is equal to the number of detected genes. We inputted the expression matrices of the simulated ST data <inline-formula id="IEq15"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \}$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq15.gif"/></alternatives></inline-formula> and the real ST data <inline-formula id="IEq16"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }\}$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq16.gif"/></alternatives></inline-formula> into the VAE model, and used the latent variables of the middle hidden layer as the output results, <inline-formula id="IEq17"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\prime}$$\end{document}</tex-math><mml:math id="M36"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq17.gif"/></alternatives></inline-formula> and <inline-formula id="IEq18"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M38"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq18.gif"/></alternatives></inline-formula>. Note that the simulated ST dataset should be constructed from a single-cell dataset obtained from the same type of tissue as the real ST dataset.</p>
      <p id="Par39">The second model <inline-formula id="IEq19"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M40"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq19.gif"/></alternatives></inline-formula> consists of an input layer that accepts the latent variable <inline-formula id="IEq20"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M42"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq20.gif"/></alternatives></inline-formula> of the VAE model, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer that outputs the proportion of each cell type in the spot with Softmax activation function. We adopted the maximum mean discrepancy (MMD) distance between the variable of model <inline-formula id="IEq21"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M44"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq21.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data as the objective function, as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}={{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\big({E}_{2}\big(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\big),\, {E}_{2}\big({\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }}^{{\prime} }\big)\big)$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\left(U,\, V\right)=	 \frac{1}{{n}^{2}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{{i}^{{\prime} }}^{n}k\left({u}_{i},\,{{u}^{{\prime} }}_{i}\right)-\frac{2}{{nm}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{m}k\left({u}_{i},\, {v}_{i}\right) \\ 	+\frac{1}{{m}^{2}}\mathop{\sum }\limits_{j}^{m}\mathop{\sum }\limits_{{j}^{{\prime} }}^{m}k\left({v}_{i},\,{{v}^{{\prime} }}_{i}\right)$$\end{document}</tex-math><mml:math id="M48"><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>V</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k\left(u,\, v\right)={e}^{\frac{-{\left|u-v\right|}^{2}}{\sigma }}$$\end{document}</tex-math><mml:math id="M50"><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>v</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime}$$\end{document}</tex-math><mml:math id="M52"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq22.gif"/></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M54"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq23.gif"/></alternatives></inline-formula> are the latent variables of the simulated ST data and real ST data, respectively, generated by the VAE model, and <inline-formula id="IEq24"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><mml:math id="M56"><mml:mi>σ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq24.gif"/></alternatives></inline-formula> represents the dimension of the hidden layer. The third model <inline-formula id="IEq25"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M58"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq25.gif"/></alternatives></inline-formula> consists of an input layer that accepts the output of model <inline-formula id="IEq26"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M60"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq26.gif"/></alternatives></inline-formula>, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer is represents the recovery of latent variable <inline-formula id="IEq27"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M62"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq27.gif"/></alternatives></inline-formula> of the VAE model. Then, we used the following objective function to constrain the outputs of the model <inline-formula id="IEq28"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M64"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq28.gif"/></alternatives></inline-formula> and the ground truth cell-type proportion of simulated ST data:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}={{{{{\rm{Cosine}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>and constrain the similarity between the outputs of the model <inline-formula id="IEq29"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M68"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq29.gif"/></alternatives></inline-formula> and the latent variable <inline-formula id="IEq30"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M70"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq30.gif"/></alternatives></inline-formula> of the simulated ST data and the real ST dataset:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}={{{{{\rm{Cosine}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cosine}}}}}}\left(a,\, {a}^{{\prime} }\right)=\frac{\sum a\times {a}^{{\prime} }}{\sqrt{\sum {a}^{2}}\times \sqrt{\sum {{a}^{{\prime} }}^{2}}}$$\end{document}</tex-math><mml:math id="M74"><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt><mml:mo>×</mml:mo><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overline{{{{{{\rm{KL}}}}}}}\left(a,\,{a}^{{\prime} }\right)=\sum a\times \log \frac{a}{{a}^{{\prime} }}\mathop{{{{{{\rm{Min}}}}}}}\limits_{a}{{{{{\rm{Cosine}}}}}}\left(a,\,{a}^{{\prime} }\right)+{{{{{\rm{KL}}}}}}\left(a,\,{a}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M76"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo accent="true">¯</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mi mathvariant="normal">Min</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:munder><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq31"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M78"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq31.gif"/></alternatives></inline-formula> is the ground truth cell-type proportion of simulated ST data, the <inline-formula id="IEq32"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M80"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq32.gif"/></alternatives></inline-formula> is the outputs of model <inline-formula id="IEq33"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M82"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq33.gif"/></alternatives></inline-formula> for the real and simulated ST data, <inline-formula id="IEq34"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}(a,a{\prime} )$$\end{document}</tex-math><mml:math id="M84"><mml:mi mathvariant="normal">KL</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq34.gif"/></alternatives></inline-formula> is the Kullback-Leibler Divergence<sup><xref ref-type="bibr" rid="CR71">71</xref></sup>.</p>
      <p id="Par40">The weight of the model is initialized using the He initialization method<sup><xref ref-type="bibr" rid="CR72">72</xref></sup>. The training of Spoint contains the following steps: 1) We calculated <inline-formula id="IEq35"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq35.gif"/></alternatives></inline-formula> using <inline-formula id="IEq36"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M88"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq36.gif"/></alternatives></inline-formula> predicted from the simulated ST data and ground truth cell-type proportion <inline-formula id="IEq37"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M90"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq37.gif"/></alternatives></inline-formula>, then adopted the Adam optimization algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup> to obtain optimal parameters for model <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M92"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq38.gif"/></alternatives></inline-formula>. 2) We calculated <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}$$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq39.gif"/></alternatives></inline-formula> using <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M96"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq40.gif"/></alternatives></inline-formula> from the real and simulated ST data and latent variable <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M98"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq41.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq42.gif"/></alternatives></inline-formula> using <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq43.gif"/></alternatives></inline-formula> and <inline-formula id="IEq44"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M104"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq44.gif"/></alternatives></inline-formula> from the variable of model <inline-formula id="IEq45"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M106"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq45.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data, then updated the parameters of model <inline-formula id="IEq46"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M108"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq46.gif"/></alternatives></inline-formula> and model <inline-formula id="IEq47"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M110"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq47.gif"/></alternatives></inline-formula> using the Adam optimization algorithm. 3) We repeated steps 1) and 2) iteratively to update the parameters of models <inline-formula id="IEq48"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M112"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq48.gif"/></alternatives></inline-formula> and <inline-formula id="IEq49"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M114"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq49.gif"/></alternatives></inline-formula> until the <inline-formula id="IEq50"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M116"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq50.gif"/></alternatives></inline-formula> of two adjacent training epochs reached a convergence value, i.e., <inline-formula id="IEq51"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\Delta {{{{{\rm{Loss}}}}}}}_{Q} &lt; 0.001$$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0.001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq51.gif"/></alternatives></inline-formula>. After the training of Spoint, the values <inline-formula id="IEq52"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M120"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq52.gif"/></alternatives></inline-formula> at the final convergence epoch were used to predict the cell type composition of the real spatial data.</p>
    </sec>
    <sec id="Sec13">
      <title>Graph convolutional network of Splane</title>
      <p id="Par41">In Splane, we first used the spatial coordinates of spots/cells as inputs to construct an undirected graph. In the graph, each node represents a spot/cell, and an edge connects two spots/cells that are physically adjacent in space. The graph structure is stored in an <inline-formula id="IEq53"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N\times N$$\end{document}</tex-math><mml:math id="M122"><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq53.gif"/></alternatives></inline-formula> adjacency matrix <inline-formula id="IEq54"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M124"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq54.gif"/></alternatives></inline-formula>, in which <inline-formula id="IEq55"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M126"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq55.gif"/></alternatives></inline-formula> is the number of spots/cells, and <inline-formula id="IEq56"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=1$$\end{document}</tex-math><mml:math id="M128"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq56.gif"/></alternatives></inline-formula> if spot/cell <inline-formula id="IEq57"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v$$\end{document}</tex-math><mml:math id="M130"><mml:mi>v</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq57.gif"/></alternatives></inline-formula> belongs to the k nearest neighbors of spot/cell <inline-formula id="IEq58"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u$$\end{document}</tex-math><mml:math id="M132"><mml:mi>u</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq58.gif"/></alternatives></inline-formula>, otherwise <inline-formula id="IEq59"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=0$$\end{document}</tex-math><mml:math id="M134"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq59.gif"/></alternatives></inline-formula>. For single-cell resolution ST data, such as MERFISH and STARmap, we set the default value of <italic>k</italic> = 25; but for 10X Visium data, we set the default value of <italic>k</italic> = 6, since each spot in the 10X Visium data is surrounded by 6 spots, and approximately 50–100 cells are contained in the 6 neighbor spots when <italic>k</italic> = 6.</p>
      <p id="Par42">Then, we used the cell type composition of spots/cells <inline-formula id="IEq60"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q$$\end{document}</tex-math><mml:math id="M136"><mml:mi>Q</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq60.gif"/></alternatives></inline-formula> and the adjacency matrix <inline-formula id="IEq61"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M138"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq61.gif"/></alternatives></inline-formula> to construct a graph convolutional network (GCN) model <inline-formula id="IEq62"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M140"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq62.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{l+1}\left(Q\right)=f\left({H}_{l}\left(Q\right),\, A\right)$$\end{document}</tex-math><mml:math id="M142"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq63"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M144"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq63.gif"/></alternatives></inline-formula> is the index of the layer, so <inline-formula id="IEq64"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M146"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq64.gif"/></alternatives></inline-formula> is the input layer. We used the cell type composition of each spot/cell as the input layer for this model. According to Kipf and Welling’s study<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, the propagation rule in GCN can be written as<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left({H}_{l},\, A\right)={{{{{\rm{ReLU}}}}}}\left({\widehat{D}}^{-\frac{1}{2}}\hat{A}{\widehat{D}}^{-\frac{1}{2}}{H}_{l}{W}_{l}\right)$$\end{document}</tex-math><mml:math id="M148"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ReLU</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{A}=A+I$$\end{document}</tex-math><mml:math id="M150"><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>+</mml:mo><mml:mi>I</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq65"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I$$\end{document}</tex-math><mml:math id="M152"><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq65.gif"/></alternatives></inline-formula> is an identity matrix, <inline-formula id="IEq66"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{D}$$\end{document}</tex-math><mml:math id="M154"><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq66.gif"/></alternatives></inline-formula> is the diagonal matrix of <inline-formula id="IEq67"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M156"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq67.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq68"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${W}_{l}$$\end{document}</tex-math><mml:math id="M158"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq68.gif"/></alternatives></inline-formula> is the weight matrix of the <inline-formula id="IEq69"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}^{{th}}$$\end{document}</tex-math><mml:math id="M160"><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq69.gif"/></alternatives></inline-formula> layer. We used a Chebyshev polynomial filter to estimate the convolution kernel of the GCN model<sup><xref ref-type="bibr" rid="CR74">74</xref></sup>. In this process, a signal <inline-formula id="IEq70"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x$$\end{document}</tex-math><mml:math id="M162"><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq70.gif"/></alternatives></inline-formula> is filtered by <inline-formula id="IEq71"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }$$\end{document}</tex-math><mml:math id="M164"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq71.gif"/></alternatives></inline-formula> as<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }\left(L\right)x={g}_{\theta }\left(U\Lambda {U}^{T}\right)x=U{g}_{\theta }\left(\Lambda \right){U}^{T}x$$\end{document}</tex-math><mml:math id="M166"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">Λ</mml:mi></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mi>x</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>where Laplacian matrix <inline-formula id="IEq72"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M168"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq72.gif"/></alternatives></inline-formula> of the graph is given by <inline-formula id="IEq73"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=I-{D}^{-\frac{1}{2}}A{D}^{-\frac{1}{2}}$$\end{document}</tex-math><mml:math id="M170"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mi>A</mml:mi><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq73.gif"/></alternatives></inline-formula>. The Laplacian matrix <inline-formula id="IEq74"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M172"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq74.gif"/></alternatives></inline-formula> is real symmetric positive semidefinite matrix. It possesses a complete set of orthonormal eigenvectors <inline-formula id="IEq75"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{u}_{l}\}}_{l=0}^{n-1}\in {R}^{n}$$\end{document}</tex-math><mml:math id="M174"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq75.gif"/></alternatives></inline-formula>, which are referred to as the graph Fourier modes. These eigenvectors are associated with ordered real nonnegative eigenvalues <inline-formula id="IEq76"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{\lambda }_{l}\}}_{l=0}^{n-1}$$\end{document}</tex-math><mml:math id="M176"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq76.gif"/></alternatives></inline-formula>, and they correspond to the frequencies of the graph. The Fourier basis <inline-formula id="IEq77"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U=\left[{u}_{0},...,{u}_{n-1}\right]\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M178"><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq77.gif"/></alternatives></inline-formula> diagonalizes the Laplacian matrix <inline-formula id="IEq78"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M180"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq78.gif"/></alternatives></inline-formula>, such that <inline-formula id="IEq79"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=U\Lambda {U}^{T}$$\end{document}</tex-math><mml:math id="M182"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq79.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq80"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varLambda={{{{{\rm{diag}}}}}}\left(\left[{\lambda }_{0},...,{\lambda }_{n-1}\right]\right)\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M184"><mml:mi>Λ</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">diag</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq80.gif"/></alternatives></inline-formula>.</p>
      <p id="Par43">The Chebyshev polynomial filter can be expressed as<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }\left(\varLambda \right)=\mathop{\sum }\limits_{k=0}^{K-1}{\theta }_{k}{T}_{k}\left(\widetilde{\varLambda }\right)$$\end{document}</tex-math><mml:math id="M186"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>where the parameter <inline-formula id="IEq81"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta \in {R}^{K}$$\end{document}</tex-math><mml:math id="M188"><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq81.gif"/></alternatives></inline-formula> is a vector of Chebyshev coefficients and <inline-formula id="IEq82"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{\varLambda })\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M190"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq82.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order <inline-formula id="IEq83"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M192"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq83.gif"/></alternatives></inline-formula> evaluated at <inline-formula id="IEq84"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{\varLambda }=2\varLambda /{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M194"><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>Λ</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq84.gif"/></alternatives></inline-formula>, a diagonal matrix of scaled eigenvalues that lie in <inline-formula id="IEq85"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$[-{{{{\mathrm{1,\,1}}}}}]$$\end{document}</tex-math><mml:math id="M196"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="normal">1, 1</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq85.gif"/></alternatives></inline-formula>. Consequently, the filtering operation can be written as <inline-formula id="IEq86"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }(L)x=\mathop{\sum }\nolimits_{k=0}^{K-1}{\theta }_{k}{T}_{k}(\widetilde{L})x$$\end{document}</tex-math><mml:math id="M198"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq86.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq87"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{L})\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M200"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq87.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order k evaluated at the scaled Laplacian <inline-formula id="IEq88"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{L}=2L/{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M202"><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq88.gif"/></alternatives></inline-formula>. Denoting <inline-formula id="IEq89"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}={T}_{k}(\widetilde{L})x\in {R}^{n}$$\end{document}</tex-math><mml:math id="M204"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq89.gif"/></alternatives></inline-formula>, we can use the recurrence relation to compute <inline-formula id="IEq90"><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}=2\widetilde{L}{\bar{x}}_{k-1}-{\bar{x}}_{k-2}$$\end{document}</tex-math><mml:math id="M206"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq90.gif"/></alternatives></inline-formula> iteratively with <inline-formula id="IEq91"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{0}=x$$\end{document}</tex-math><mml:math id="M208"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq91.gif"/></alternatives></inline-formula> and <inline-formula id="IEq92"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{1}=\widetilde{L}x$$\end{document}</tex-math><mml:math id="M210"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq92.gif"/></alternatives></inline-formula> as the initial values. The order of the polynomial <inline-formula id="IEq93"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M212"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq93.gif"/></alternatives></inline-formula>, controls the receptive field of the convolution kernel and is related to the parameter <inline-formula id="IEq94"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M214"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq94.gif"/></alternatives></inline-formula> in the Chebyshev polynomial <inline-formula id="IEq95"><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}$$\end{document}</tex-math><mml:math id="M216"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq95.gif"/></alternatives></inline-formula>. We set the default <inline-formula id="IEq96"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M218"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq96.gif"/></alternatives></inline-formula> equal to 2 to ensure that the GCN model contains the information of the first order neighbors and second order neighbors (i.e., neighbors of neighbors) of each spot.</p>
      <p id="Par44">The GCN model of Splane consists of 5 layers, i.e. <inline-formula id="IEq97"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0} \sim {H}_{4}$$\end{document}</tex-math><mml:math id="M220"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq97.gif"/></alternatives></inline-formula>, where the first layer <inline-formula id="IEq98"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M222"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq98.gif"/></alternatives></inline-formula> and the last layer <inline-formula id="IEq99"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M224"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq99.gif"/></alternatives></inline-formula> both contain the cell type composition of each spot/cell, and the middle layer <inline-formula id="IEq100"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M226"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq100.gif"/></alternatives></inline-formula> is used to cluster spots/cells and identify spatial domains. In Splane we embedded a cosine function <inline-formula id="IEq101"><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M228"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq101.gif"/></alternatives></inline-formula> to minimize the difference between <inline-formula id="IEq102"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M230"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq102.gif"/></alternatives></inline-formula> and <inline-formula id="IEq103"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M232"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq103.gif"/></alternatives></inline-formula>, i.e.<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}={{{{{\rm{Cos}}}}}}{{{{{\rm{ine}}}}}}\left[{H}_{0}\left(Q\right),\,{H}_{4}\left(Q\right)\right]$$\end{document}</tex-math><mml:math id="M234"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cos</mml:mi><mml:mi mathvariant="normal">ine</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>and we used another objective function <inline-formula id="IEq104"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M236"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq104.gif"/></alternatives></inline-formula> to minimize the difference between the <inline-formula id="IEq105"><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M238"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq105.gif"/></alternatives></inline-formula> values of a spot and its neighbors, as<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}=\left|{H}_{2}\left({q}_{i}\right)-\frac{1}{n}\sum {H}_{2}\left({q}_{i}^{{{{{{\rm{neigh}}}}}}}\right)\right|$$\end{document}</tex-math><mml:math id="M240"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo mathsize="big">∑</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq106"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}$$\end{document}</tex-math><mml:math id="M242"><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq106.gif"/></alternatives></inline-formula> and <inline-formula id="IEq107"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}^{{{{{{\rm{neigh}}}}}}}$$\end{document}</tex-math><mml:math id="M244"><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq107.gif"/></alternatives></inline-formula> are the cell type composition of spot/cell <inline-formula id="IEq108"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M246"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq108.gif"/></alternatives></inline-formula> and its neighbors respectively, and <inline-formula id="IEq109"><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M248"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq109.gif"/></alternatives></inline-formula> is the number of neighbors.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial learning for multiple slices</title>
      <p id="Par45">In Splane, we used a discriminator model <inline-formula id="IEq110"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M250"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq110.gif"/></alternatives></inline-formula> containing four layers to conclude uniform features from multiple slices. The input layer of model <inline-formula id="IEq111"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M252"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq111.gif"/></alternatives></inline-formula> is the output latent variables of spot/cell <inline-formula id="IEq112"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M254"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq112.gif"/></alternatives></inline-formula> from model <inline-formula id="IEq113"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M256"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq113.gif"/></alternatives></inline-formula>, i.e., <inline-formula id="IEq114"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}({q}_{i})$$\end{document}</tex-math><mml:math id="M258"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq114.gif"/></alternatives></inline-formula>; the output layer contains the probability <inline-formula id="IEq115"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{i,s}$$\end{document}</tex-math><mml:math id="M260"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq115.gif"/></alternatives></inline-formula> of spot/cell <inline-formula id="IEq116"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M262"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq116.gif"/></alternatives></inline-formula> belonging to slice <inline-formula id="IEq117"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M264"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq117.gif"/></alternatives></inline-formula>; and the two hidden layers are 64 nodes fully-connect layers. We defined the objective function of model <inline-formula id="IEq118"><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M266"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq118.gif"/></alternatives></inline-formula> as<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}=\frac{1}{{N}_{s}}\mathop{\sum}\limits_{s}{y}_{i,s}\log \left({p}_{i,s}\right)$$\end{document}</tex-math><mml:math id="M268"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq119"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{s}$$\end{document}</tex-math><mml:math id="M270"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq119.gif"/></alternatives></inline-formula> is the number of slices and <inline-formula id="IEq120"><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i,s}$$\end{document}</tex-math><mml:math id="M272"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq120.gif"/></alternatives></inline-formula> is the slice label of spot/cell <inline-formula id="IEq121"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M274"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq121.gif"/></alternatives></inline-formula>. The <inline-formula id="IEq122"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M276"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq122.gif"/></alternatives></inline-formula> is minimized when the embeddings for different sections are maximally different, allowing the discriminator to correctly predict the labels of the slices. As shown in the next section, we trained GCN model with spots/cells from multiple ST slices, optimizing it to achieve a maximum <inline-formula id="IEq123"><alternatives><tex-math id="M277">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M278"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq123.gif"/></alternatives></inline-formula>, ensuring that the latent variables of spots/cells from different slices would have the highest similarity.</p>
    </sec>
    <sec id="Sec15">
      <title>Clustering of spots/cells with latent features</title>
      <p id="Par46">The total objective function of Splane is a combination of the objective function of the GCN model and the objective function of the discriminator <inline-formula id="IEq124"><alternatives><tex-math id="M279">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M280"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq124.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M281">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}={{\alpha }_{C}{{{{{\rm{Loss}}}}}}}_{C}+{{\alpha }_{S}{{{{{\rm{Loss}}}}}}}_{S}-{{\alpha }_{D}{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M282"><mml:mi mathvariant="normal">Loss</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq125"><alternatives><tex-math id="M283">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{C}$$\end{document}</tex-math><mml:math id="M284"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq125.gif"/></alternatives></inline-formula>, <inline-formula id="IEq126"><alternatives><tex-math id="M285">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{S}$$\end{document}</tex-math><mml:math id="M286"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq126.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq127"><alternatives><tex-math id="M287">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{D}$$\end{document}</tex-math><mml:math id="M288"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq127.gif"/></alternatives></inline-formula> are the weights of <inline-formula id="IEq128"><alternatives><tex-math id="M289">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M290"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq128.gif"/></alternatives></inline-formula>, <inline-formula id="IEq129"><alternatives><tex-math id="M291">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M292"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq129.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq130"><alternatives><tex-math id="M293">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M294"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq130.gif"/></alternatives></inline-formula>, and their default values are 1, 1, and 0.5, respectively. The weight of the model is initialized using the Xavier initialization method<sup><xref ref-type="bibr" rid="CR75">75</xref></sup>. We used the RMSProp optimization algorithm to minimize the total objective function. Meanwhile, we clustered spots/cells using the output latent variables (termed shared latent features) of the GCN model (i.e. <inline-formula id="IEq131"><alternatives><tex-math id="M295">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}(Q)$$\end{document}</tex-math><mml:math id="M296"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq131.gif"/></alternatives></inline-formula>) and the K-mean algorithm, and we evaluated the clarity of the clustering result using the Davies-Bouldin score (DBS) implemented by scikit-learn package<sup><xref ref-type="bibr" rid="CR76">76</xref>,<xref ref-type="bibr" rid="CR77">77</xref></sup>. We trained the entire model until both <inline-formula id="IEq132"><alternatives><tex-math id="M297">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}$$\end{document}</tex-math><mml:math id="M298"><mml:mi mathvariant="normal">Loss</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq132.gif"/></alternatives></inline-formula> and DBS within two adjacent training epochs reached convergent values, i.e., <inline-formula id="IEq133"><alternatives><tex-math id="M299">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{Loss}}}}}} \, &lt; \, 0.0001$$\end{document}</tex-math><mml:math id="M300"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0.0001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq133.gif"/></alternatives></inline-formula> and <inline-formula id="IEq134"><alternatives><tex-math id="M301">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{DBS}}}}}} \, &lt; \, 0$$\end{document}</tex-math><mml:math id="M302"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">DBS</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq134.gif"/></alternatives></inline-formula>. After the model converged, we adopted the spot/cell clusters obtained by Splane in the last epoch as spatial domains. As the shared latent features of the GCN model contain gene expression and spatial coordinate information of cells/spots, each spatial domain represents a batch of cells/spots that have common ground in both the transcriptome and space.</p>
    </sec>
    <sec id="Sec16">
      <title>Alignment of consecutive ST slices using Scube</title>
      <p id="Par47">In Scube, we first built a nearest neighbor graph between the cells/spots of two adjacent slices based on the coordinate of spots. As an initialization step for optimization algorithms, Scube aligns all slices by translating them so that their center points coincide with the coordinates <inline-formula id="IEq135"><alternatives><tex-math id="M303">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({{{{\mathrm{0,0}}}}})$$\end{document}</tex-math><mml:math id="M304"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">0, 0</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq135.gif"/></alternatives></inline-formula>. Then, we used the spatial domain information for each pair of nearest neighbor spots to construct an alignment objective function of two adjacent slices. We employed a differential evolution optimization to search for the optimal translation vectors and rotation angles, and transformed the coordinates of every slice accordingly. During each iteration of the global optimization process, Scube utilizes the adjusted coordinate information of spots to identify the nearest neighbors between two adjacent slices. By adjusting the coordinates of spots in the source slice, Scube aims to align the source slice to the target slice, ultimately maximizing the alignment objective function value. Finally, in Scube we performed all of the aforementioned steps for all adjacent slices, and used the transformed coordinates to stack these slices and construct the 3D alignment of the tissue.</p>
      <p id="Par48">Specifically, we used rigid body transformations (including mirroring, rotation, and translation) to transfer a slice <inline-formula id="IEq136"><alternatives><tex-math id="M305">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M306"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq136.gif"/></alternatives></inline-formula> as<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M307">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }={RM}{S}_{j}+T$$\end{document}</tex-math><mml:math id="M308"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>T</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M309">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R=\left(\begin{array}{cc}\cos {\theta }_{j} &amp; -\sin {\theta }_{j}\\ \sin {\theta }_{j} &amp; \cos {\theta }_{j}\end{array}\right)$$\end{document}</tex-math><mml:math id="M310"><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>−</mml:mo><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M311">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M=\left(\begin{array}{cc}{{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j} &amp; 0\\ 0 &amp; 1\end{array}\right)$$\end{document}</tex-math><mml:math id="M312"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="center"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M313">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T=\left(\begin{array}{ccc}\Delta {x}_{1} &amp; \ldots &amp; \Delta {x}_{{n}_{j}}\\ \Delta {y}_{1} &amp; \ldots &amp; {\Delta y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M314"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq137"><alternatives><tex-math id="M315">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}\mathop{=}\limits^{{{{{\mathrm{def}}}}}}\left(\begin{array}{ccc}{x}_{1} &amp; \ldots &amp; {x}_{{n}_{j}}\\ {y}_{1} &amp; \ldots &amp; {y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M316"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq137.gif"/></alternatives></inline-formula> is the coordinate matrix of slice <inline-formula id="IEq138"><alternatives><tex-math id="M317">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M318"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq138.gif"/></alternatives></inline-formula>, <inline-formula id="IEq139"><alternatives><tex-math id="M319">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M320"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq139.gif"/></alternatives></inline-formula> is the coordinate matrix after rigid body transformation, and <inline-formula id="IEq140"><alternatives><tex-math id="M321">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M322"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq140.gif"/></alternatives></inline-formula> is the number of spots in slice <inline-formula id="IEq141"><alternatives><tex-math id="M323">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M324"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq141.gif"/></alternatives></inline-formula>; <inline-formula id="IEq142"><alternatives><tex-math id="M325">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M326"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq142.gif"/></alternatives></inline-formula> is the rotation matrix, <inline-formula id="IEq143"><alternatives><tex-math id="M327">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }_{j}$$\end{document}</tex-math><mml:math id="M328"><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq143.gif"/></alternatives></inline-formula> is the rotation angle of slice <inline-formula id="IEq144"><alternatives><tex-math id="M329">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M330"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq144.gif"/></alternatives></inline-formula>; <inline-formula id="IEq145"><alternatives><tex-math id="M331">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M$$\end{document}</tex-math><mml:math id="M332"><mml:mi>M</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq145.gif"/></alternatives></inline-formula> is the mirroring matrix, <inline-formula id="IEq146"><alternatives><tex-math id="M333">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=-1$$\end{document}</tex-math><mml:math id="M334"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq146.gif"/></alternatives></inline-formula> represents the mirror operation of slice <inline-formula id="IEq147"><alternatives><tex-math id="M335">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M336"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq147.gif"/></alternatives></inline-formula>, elsewise <inline-formula id="IEq148"><alternatives><tex-math id="M337">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=1$$\end{document}</tex-math><mml:math id="M338"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq148.gif"/></alternatives></inline-formula>; <inline-formula id="IEq149"><alternatives><tex-math id="M339">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T$$\end{document}</tex-math><mml:math id="M340"><mml:mi>T</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq149.gif"/></alternatives></inline-formula> is the translation matrix. We defined <inline-formula id="IEq150"><alternatives><tex-math id="M341">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${O}_{j}$$\end{document}</tex-math><mml:math id="M342"><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq150.gif"/></alternatives></inline-formula> as the set of overlapped spots/cells for the transformed slice <inline-formula id="IEq151"><alternatives><tex-math id="M343">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M344"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq151.gif"/></alternatives></inline-formula> between slice <inline-formula id="IEq152"><alternatives><tex-math id="M345">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M346"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq152.gif"/></alternatives></inline-formula> and the transformed slice <inline-formula id="IEq153"><alternatives><tex-math id="M347">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M348"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq153.gif"/></alternatives></inline-formula>. This set includes spots/cells in the transformed slice <inline-formula id="IEq154"><alternatives><tex-math id="M349">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M350"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq154.gif"/></alternatives></inline-formula> whose Euclidean distance to their <inline-formula id="IEq155"><alternatives><tex-math id="M351">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M352"><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq155.gif"/></alternatives></inline-formula> mutual nearest neighbor spots/cells in slice <inline-formula id="IEq156"><alternatives><tex-math id="M353">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M354"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq156.gif"/></alternatives></inline-formula> is less than a maximum distance. By default, the maximum distance defined as median Euclidean distance to the <inline-formula id="IEq157"><alternatives><tex-math id="M355">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$2{{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M356"><mml:mn>2</mml:mn><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq157.gif"/></alternatives></inline-formula> nearest neighbor of spots/cells in slice <inline-formula id="IEq158"><alternatives><tex-math id="M357">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M358"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq158.gif"/></alternatives></inline-formula>. Then we defined an alignment objective function (AOF) to measure the alignment between the transformed slices <inline-formula id="IEq159"><alternatives><tex-math id="M359">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M360"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq159.gif"/></alternatives></inline-formula> and slice <inline-formula id="IEq160"><alternatives><tex-math id="M361">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M362"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq160.gif"/></alternatives></inline-formula> as follows:<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M363">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AOF}}}}}}\left({S}_{j}^{{\prime} }|{S}_{j-1}\right) \mathop{=}\limits^{{{{{\mathrm{def}}}}}} \frac{1}{{n}_{o}}\mathop{\sum}\limits_{{{l}_{j}^{\prime }}\in {{O}_{j}}}\frac{1}{m}{\sum }_{{{l}_{j-1}}\in {{\left\langle {l}_{j}^{\prime }\right\rangle }_{k}^{j-1}}}\, \delta \left[{{{{{\rm{domain}}}}}}\left({l}_{j-1}\right),\,{{{{{\rm{domain}}}}}}\left({l}_{j}^{\prime }\right)\right]+f \left(\frac{{n}_{o}}{{n}_{j}}\right)$$\end{document}</tex-math><mml:math id="M364"><mml:mi mathvariant="normal">AOF</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="⟩" open="⟨"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>δ</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq161"><alternatives><tex-math id="M365">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }\in {O}_{j}$$\end{document}</tex-math><mml:math id="M366"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq161.gif"/></alternatives></inline-formula> are overlapped spots/cells in transformed slice <inline-formula id="IEq162"><alternatives><tex-math id="M367">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M368"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq162.gif"/></alternatives></inline-formula>; <inline-formula id="IEq163"><alternatives><tex-math id="M369">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M370"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq163.gif"/></alternatives></inline-formula> is a set of spots/cells in slice <inline-formula id="IEq164"><alternatives><tex-math id="M371">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M372"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq164.gif"/></alternatives></inline-formula> which means the mutual <inline-formula id="IEq165"><alternatives><tex-math id="M373">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M374"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq165.gif"/></alternatives></inline-formula> nearest neighbors of spot/cell <inline-formula id="IEq166"><alternatives><tex-math id="M375">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M376"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq166.gif"/></alternatives></inline-formula>; <inline-formula id="IEq167"><alternatives><tex-math id="M377">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m$$\end{document}</tex-math><mml:math id="M378"><mml:mi>m</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq167.gif"/></alternatives></inline-formula> means the elements number in set <inline-formula id="IEq168"><alternatives><tex-math id="M379">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M380"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq168.gif"/></alternatives></inline-formula>; <inline-formula id="IEq169"><alternatives><tex-math id="M381">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta \left(x,y\right)$$\end{document}</tex-math><mml:math id="M382"><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq169.gif"/></alternatives></inline-formula> is a Kronecker function. <inline-formula id="IEq170"><alternatives><tex-math id="M383">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left(x\right)=-{\left(x-1\right)}^{p}$$\end{document}</tex-math><mml:math id="M384"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq170.gif"/></alternatives></inline-formula> is the penalty term; <inline-formula id="IEq171"><alternatives><tex-math id="M385">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M386"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq171.gif"/></alternatives></inline-formula> is the exponent of the penalty, with a larger <inline-formula id="IEq172"><alternatives><tex-math id="M387">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M388"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq172.gif"/></alternatives></inline-formula> indicates stronger partial alignment capability; <inline-formula id="IEq173"><alternatives><tex-math id="M389">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{o}$$\end{document}</tex-math><mml:math id="M390"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq173.gif"/></alternatives></inline-formula> is the number of overlapped spots/cells in slice <inline-formula id="IEq174"><alternatives><tex-math id="M391">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M392"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq174.gif"/></alternatives></inline-formula>; <inline-formula id="IEq175"><alternatives><tex-math id="M393">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M394"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq175.gif"/></alternatives></inline-formula> is the number of all spots/cells in the transformed slice <inline-formula id="IEq176"><alternatives><tex-math id="M395">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M396"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq176.gif"/></alternatives></inline-formula>; Then we adopted the differential evolution algorithm to determine the best transformation matrices <inline-formula id="IEq177"><alternatives><tex-math id="M397">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{R,M,T\right\}$$\end{document}</tex-math><mml:math id="M398"><mml:mfenced close="}" open="{"><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq177.gif"/></alternatives></inline-formula> to maximize the AOF value between two adjacent slices. After determining transformation matrices for all slices, we can stack these transformed slices to construct a 3D alignment of the tissue.</p>
    </sec>
    <sec id="Sec17">
      <title>Gaussian progress regression model</title>
      <p id="Par49">We embedded a Gaussian process regression method<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in SPACEL to obtain the continuous 3D distribution of a transcript from Scube transformed slices. First, we adopted the Alpha shape algorithm<sup><xref ref-type="bibr" rid="CR78">78</xref>,<xref ref-type="bibr" rid="CR79">79</xref></sup> to generate a 3D meshed manifold from the coordinates of the spots/cells in all slices, and smoothed this manifold using a subdivision algorithm<sup><xref ref-type="bibr" rid="CR80">80</xref></sup>. We built a Gaussian process (GP) model for the expression level <inline-formula id="IEq178"><alternatives><tex-math id="M399">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i}^{\left(j\right)}$$\end{document}</tex-math><mml:math id="M400"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq178.gif"/></alternatives></inline-formula> of gene <inline-formula id="IEq179"><alternatives><tex-math id="M401">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M402"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq179.gif"/></alternatives></inline-formula> in each spot/cell <inline-formula id="IEq180"><alternatives><tex-math id="M403">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M404"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq180.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M405">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{y}_{i}}^{\left(j\right)}|{x}^{\left(j\right)}={f}_{i}({x}^{\left(j\right)})+\epsilon$$\end{document}</tex-math><mml:math id="M406"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>∣</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq181"><alternatives><tex-math id="M407">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M408"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq181.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq182"><alternatives><tex-math id="M409">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M410"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq182.gif"/></alternatives></inline-formula>, ε represents Gaussian additive noise, and the functional form of <inline-formula id="IEq183"><alternatives><tex-math id="M411">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}(\cdot )$$\end{document}</tex-math><mml:math id="M412"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq183.gif"/></alternatives></inline-formula> is unknown and may vary between genes, denoted as<disp-formula id="Equ24"><label>24</label><alternatives><tex-math id="M413">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}\left(x\right) \sim {{{{{\rm{GP}}}}}}\left[\mu \left(\mathop{x}\limits^{ \rightharpoonup }\right),{{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} \right)\right]$$\end{document}</tex-math><mml:math id="M414"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>~</mml:mo><mml:mi mathvariant="normal">GP</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>μ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mo>x</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ25"><label>25</label><alternatives><tex-math id="M415">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \right)=\mathop{\sum}\limits_{j,{j}^{{\prime} }}{\delta }^{2}\exp \left[-\frac{{\left({x}^{\left(j\right)}-{x}^{\left({j}^{{\prime} }\right)}\right)}^{2}}{2{l}^{2}}\right]$$\end{document}</tex-math><mml:math id="M416"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>exp</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq184"><alternatives><tex-math id="M417">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M418"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq184.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq185"><alternatives><tex-math id="M419">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M420"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq185.gif"/></alternatives></inline-formula>, <inline-formula id="IEq186"><alternatives><tex-math id="M421">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M422"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq186.gif"/></alternatives></inline-formula> represents the mean function, <inline-formula id="IEq187"><alternatives><tex-math id="M423">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M424"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq187.gif"/></alternatives></inline-formula> represents the covariance function, and <inline-formula id="IEq188"><alternatives><tex-math id="M425">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M426"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq188.gif"/></alternatives></inline-formula> and <inline-formula id="IEq189"><alternatives><tex-math id="M427">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M428"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq189.gif"/></alternatives></inline-formula> are the process-variance and length-scale hyperparameters, respectively. The objective function for training the GP model is the marginal likelihood,<disp-formula id="Equ26"><label>26</label><alternatives><tex-math id="M429">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L\left({y}_{i}{|x},\, \theta \right)=\int P\left({y}_{i}|{f}_{i},\, x,\, \theta \right)P\left({f}_{i}{|x},\, \theta \right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M430"><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula>of gaussian process model. The hyper-parameter <inline-formula id="IEq190"><alternatives><tex-math id="M431">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta$$\end{document}</tex-math><mml:math id="M432"><mml:mi>θ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq190.gif"/></alternatives></inline-formula> can be set by maximizing a posteriori estimation, defined as:<disp-formula id="Equ27"><label>27</label><alternatives><tex-math id="M433">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }^{*}\leftarrow {{{{{\rm{ar}}}}}}{{{{{{\rm{g}}}}}}}_{\theta }\max \int P\left({y}_{i}|{f}_{i},\, x,\,\theta \right)P\left({f}_{i}{|x},\, \theta \right)P\left({{{{{\rm{\theta }}}}}}\right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M434"><mml:msup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo>←</mml:mo><mml:mi mathvariant="normal">ar</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mi>max</mml:mi><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula>We set the initial values of these hyperparameters as <inline-formula id="IEq191"><alternatives><tex-math id="M435">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu ({\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup }})={{{{{\rm{mean}}}}}}({y}_{i})$$\end{document}</tex-math><mml:math id="M436"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">mean</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq191.gif"/></alternatives></inline-formula>, <inline-formula id="IEq192"><alternatives><tex-math id="M437">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta=4$$\end{document}</tex-math><mml:math id="M438"><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq192.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq193"><alternatives><tex-math id="M439">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l={{{{{\rm{\lambda }}}}}}\cdot {{{{\mathrm{var}}}}}\left({y}_{i}\right)$$\end{document}</tex-math><mml:math id="M440"><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">λ</mml:mi><mml:mo>⋅</mml:mo><mml:mi mathvariant="normal">var</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq193.gif"/></alternatives></inline-formula>, and we used a grid search strategy<sup><xref ref-type="bibr" rid="CR81">81</xref></sup> to determine the value of <inline-formula id="IEq194"><alternatives><tex-math id="M441">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{\lambda }}}}}}$$\end{document}</tex-math><mml:math id="M442"><mml:mi mathvariant="normal">λ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq194.gif"/></alternatives></inline-formula> that maximizes the marginal likelihood. Then, we used the coordinates and gene expression information of spots/cells in all slices to train this GP model, and optimized the hyperparameters <inline-formula id="IEq195"><alternatives><tex-math id="M443">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M444"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq195.gif"/></alternatives></inline-formula>, <inline-formula id="IEq196"><alternatives><tex-math id="M445">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M446"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq196.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq197"><alternatives><tex-math id="M447">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M448"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq197.gif"/></alternatives></inline-formula> using the Adam algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup>. Finally, we uniformly sampled 500,000 points in the 3D meshed manifold, and used the trained GPR model to predict the expression level of a gene at each point. The gene expression information of these points constitutes the distribution of a transcript in 3D space. Based on the GPR model, we can use the Bayes Factor (BF) to quantify the spatial variation of a given gene in 3D space<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>:<disp-formula id="Equ28"><label>28</label><alternatives><tex-math id="M449">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{BF}}}}}}=\frac{L\left({M}_{1}\right)}{L\left({M}_{2}\right)}$$\end{document}</tex-math><mml:math id="M450"><mml:mi mathvariant="normal">BF</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq198"><alternatives><tex-math id="M451">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{1})$$\end{document}</tex-math><mml:math id="M452"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq198.gif"/></alternatives></inline-formula> denotes the marginal likelihood of the optimized GPR model and <inline-formula id="IEq199"><alternatives><tex-math id="M453">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{2})$$\end{document}</tex-math><mml:math id="M454"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq199.gif"/></alternatives></inline-formula> denotes the marginal likelihood of a simplified GPR model in which <inline-formula id="IEq200"><alternatives><tex-math id="M455">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M456"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq200.gif"/></alternatives></inline-formula> was set to <inline-formula id="IEq201"><alternatives><tex-math id="M457">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\infty$$\end{document}</tex-math><mml:math id="M458"><mml:mi>∞</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq201.gif"/></alternatives></inline-formula>. Larger BF values denote greater spatial variation in the gene expression level.</p>
    </sec>
    <sec id="Sec18">
      <title>Robustness test of SPACEL</title>
      <p id="Par50">To test the robustness of SPACEL, we evaluated its performance across various hyperparameters. Each hyperparameter was varied individually while keeping the other hyperparameter values constant. In Spoint, we assessed its performance by varying two user-defined hyperparameters (the number of simulated spots in the training set and the number of marker genes in each single-cell cluster) and three model hyperparameters (the dimensions of latent layers, hidden layers of predicted model, and probability output layers) in real single-cell resolution ST datasets<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR49">49</xref></sup>. In Splane, we compared its performance by varying five hyperparameters (the dropout rate of the model layers, the weight of the adversarial loss, the degree of neighbors in the constructed graph, the dimensions of latent layers, and the dimensions of hidden layers) using human DFPLC data<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. In Scube, we tested its performance by varying the five hyperparameters used in Splane, one additional hyperparameter (the number of spatial domains), and two hyperparameters specific to Scube (the number of nearest neighbors in the MNN graph and the exponent of the penalty for the overlap ratio between adjacent slices) using 3D STARmap data<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> with a crop rate of 0.25.</p>
    </sec>
    <sec id="Sec19">
      <title>Jaccard index and shifting distance</title>
      <p id="Par51">To evaluate the prediction accuracy of the spatial domains identified by each method, we computed the Jaccard Index (JI) for each spatial domain with a manually annotated cortical layer. Specifically, we defined a set <inline-formula id="IEq202"><alternatives><tex-math id="M459">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M460"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq202.gif"/></alternatives></inline-formula> that contains all spots in the spatial domain <inline-formula id="IEq203"><alternatives><tex-math id="M461">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M462"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq203.gif"/></alternatives></inline-formula> and a set <inline-formula id="IEq204"><alternatives><tex-math id="M463">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{l}$$\end{document}</tex-math><mml:math id="M464"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq204.gif"/></alternatives></inline-formula> that contains all spots in the cortical layer <inline-formula id="IEq205"><alternatives><tex-math id="M465">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M466"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq205.gif"/></alternatives></inline-formula>. We calculated <inline-formula id="IEq206"><alternatives><tex-math id="M467">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,\, l\right)=\frac{{P}_{d}\cap {P}_{l}}{{P}_{d}\cup {P}_{l}}$$\end{document}</tex-math><mml:math id="M468"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq206.gif"/></alternatives></inline-formula> between a spatial domain <inline-formula id="IEq207"><alternatives><tex-math id="M469">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M470"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq207.gif"/></alternatives></inline-formula> and all cortical layers, and defined the cortical layer with the largest JI value as the corresponding layer of domain <inline-formula id="IEq208"><alternatives><tex-math id="M471">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M472"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq208.gif"/></alternatives></inline-formula>, i.e., layer <inline-formula id="IEq209"><alternatives><tex-math id="M473">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}$$\end{document}</tex-math><mml:math id="M474"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq209.gif"/></alternatives></inline-formula>:<disp-formula id="Equ29"><label>29</label><alternatives><tex-math id="M475">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}={{\arg }}{{{{{{\rm{m}}}}}}{{{{{\rm{ax}}}}}}}_{l}\left[{{{{{\rm{JI}}}}}}\left(d,\, l\right)\right]$$\end{document}</tex-math><mml:math id="M476"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>arg</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">ax</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">JI</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par52">We then used <inline-formula id="IEq210"><alternatives><tex-math id="M477">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,{l}_{d}\right)$$\end{document}</tex-math><mml:math id="M478"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq210.gif"/></alternatives></inline-formula> to measure the prediction accuracy for the spatial domain <inline-formula id="IEq211"><alternatives><tex-math id="M479">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M480"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq211.gif"/></alternatives></inline-formula>. We calculated the JI values for all spatial domains in a slice and used the average JI value for these domains to represent the prediction accuracy for the slice. In addition, for a spatial domain, we defined the distance from one of its spots to its corresponding cortical layer as the shifting distance (SD) of the spot and used the average SD of all spots in the spatial domain to evaluate the performance of each method. A lower SD value indicates a better consistency between the spatial domain and the corresponding cortical layer.</p>
    </sec>
    <sec id="Sec20">
      <title>Identification of spatial variable genes</title>
      <p id="Par53">We used two strategies to obtain the ground truth for spatial variable genes (SVGs). The first strategy was to use the differentially expressed genes of manually annotated cortical layers as the ground truth. Specifically, after normalizing the expression matrix of the ST data using Scanpy, we applied the two-sided Wilcoxon rank-sum test and the threshold log(fold-change) &gt; 0.5, <italic>P</italic>-value &lt; 0.01 to obtain differentially expressed genes (DEGs) for each cortical layer, which we used as the ground truth for SVGs. We used the same strategy to obtain DEGs for each spatial domain. Then, we calculated the sensitivity and specificity of the DEGs of spatial domains obtained by each method, and plotted receiver operating characteristic curves using the <italic>P</italic>-value ranking of DEGs.</p>
    </sec>
    <sec id="Sec21">
      <title>ASW of slices from different experimental batches</title>
      <p id="Par54">To assess the performance of Splane in reducing the batch effect when jointly analyzing multiple slices, we calculated the Average Silhouette Width (ASW) using the equation:<disp-formula id="Equ30"><label>30</label><alternatives><tex-math id="M481">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{ASW}}}}}}=\frac{1}{K}\mathop{\sum}\limits_{k=1}^{K}\frac{1}{{C}_{k}}\mathop{\sum}\limits_{i=1}^{{C}_{k}}1-|{{{{{\rm{Silhouette}}}}}}\left(i\right)|$$\end{document}</tex-math><mml:math id="M482"><mml:mi mathvariant="normal">ASW</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>∣</mml:mo><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>∣</mml:mo></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ31"><label>31</label><alternatives><tex-math id="M483">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Silhouette}}}}}}=\mathop{\sum }\limits_{i}^{N}\frac{b\left(i\right)-a\left(i\right)}{\max \left[a\left(i\right),b\left(i\right)\right]}$$\end{document}</tex-math><mml:math id="M484"><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ31.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ32"><label>32</label><alternatives><tex-math id="M485">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a\left(i\right)=\frac{1}{{n}_{s}-1}\mathop{\sum }\limits_{j\in s}^{{n}_{s}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)$$\end{document}</tex-math><mml:math id="M486"><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ32.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ33"><label>33</label><alternatives><tex-math id="M487">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b\left(i\right)={\min }_{{s}^{{\prime} }}\left[\frac{1}{{n}_{{s}^{{\prime} }}-1}\mathop{\sum }\limits_{j\in {s}^{{\prime} }}^{{n}_{{s}^{{\prime} }}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)\right]$$\end{document}</tex-math><mml:math id="M488"><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ33.gif" position="anchor"/></alternatives></disp-formula>where spot/cell <inline-formula id="IEq212"><alternatives><tex-math id="M489">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M490"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq212.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq213"><alternatives><tex-math id="M491">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M492"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq213.gif"/></alternatives></inline-formula>, spot/cell <inline-formula id="IEq214"><alternatives><tex-math id="M493">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M494"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq214.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq215"><alternatives><tex-math id="M495">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M496"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq215.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq216"><alternatives><tex-math id="M497">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a$$\end{document}</tex-math><mml:math id="M498"><mml:mi>a</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq216.gif"/></alternatives></inline-formula>) or <inline-formula id="IEq217"><alternatives><tex-math id="M499">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s{{\hbox{'}}}}$$\end{document}</tex-math><mml:math id="M500"><mml:mi>s</mml:mi><mml:mi>’</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq217.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq218"><alternatives><tex-math id="M501">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b$$\end{document}</tex-math><mml:math id="M502"><mml:mi>b</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq218.gif"/></alternatives></inline-formula>), <inline-formula id="IEq219"><alternatives><tex-math id="M503">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M504"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq219.gif"/></alternatives></inline-formula> is the number of cells with the domain/cluster <inline-formula id="IEq220"><alternatives><tex-math id="M505">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M506"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq220.gif"/></alternatives></inline-formula>, <inline-formula id="IEq221"><alternatives><tex-math id="M507">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M508"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq221.gif"/></alternatives></inline-formula> is the number of domains/clusters, <inline-formula id="IEq222"><alternatives><tex-math id="M509">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{s}$$\end{document}</tex-math><mml:math id="M510"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq222.gif"/></alternatives></inline-formula> is the spot/cell number in dataset <inline-formula id="IEq223"><alternatives><tex-math id="M511">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M512"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq223.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq224"><alternatives><tex-math id="M513">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M514"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq224.gif"/></alternatives></inline-formula> is the total number of spots/cells in all datasets. We calculated the Euclidean distance between spots/cells <inline-formula id="IEq225"><alternatives><tex-math id="M515">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M516"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq225.gif"/></alternatives></inline-formula> and <inline-formula id="IEq226"><alternatives><tex-math id="M517">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M518"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq226.gif"/></alternatives></inline-formula> from the raw expression matrix or from the latent features of spots/cells <inline-formula id="IEq227"><alternatives><tex-math id="M519">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M520"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq227.gif"/></alternatives></inline-formula> and <inline-formula id="IEq228"><alternatives><tex-math id="M521">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M522"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq228.gif"/></alternatives></inline-formula>. We used the scib<sup><xref ref-type="bibr" rid="CR82">82</xref></sup> implementation to compute the ASW scores.</p>
    </sec>
    <sec id="Sec22">
      <title>Copy number variation estimated by inferCNV</title>
      <p id="Par55">We employed inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup> to estimate copy number variations (CNVs) for the breast cancer ST slices. We used the default setting cut-off = 0.1 for inferCNV, i.e., only genes with an average count &gt; 0.1 were considered. We used spots containing &lt; 10% cancer cells as reference samples and other spots as malignant samples. To compare the CNV values inferred from different slices and different experimental batches, we scaled the inferred CNV values to −1 ~ 1, and we calculated the average inferred CNV at each genomic locus for all spots in a spatial domain, to represent the mutation information of the spatial domain.</p>
    </sec>
    <sec id="Sec23">
      <title>Validation of immune domains</title>
      <p id="Par56">To validate that D3, D5, and D9 are immune domains, we calculated the percentage of overlap (PO) between the experimental annotation of immune spots and the spatial domains identified by Splane, as<disp-formula id="Equ34"><label>34</label><alternatives><tex-math id="M523">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{PO}}}}}}}_{d}=\frac{{P}_{{{{{{\rm{lym}}}}}}}\cap {P}_{d}}{{P}_{d}}$$\end{document}</tex-math><mml:math id="M524"><mml:msub><mml:mrow><mml:mi mathvariant="normal">PO</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">lym</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ34.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq229"><alternatives><tex-math id="M525">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{{lym}}$$\end{document}</tex-math><mml:math id="M526"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>y</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq229.gif"/></alternatives></inline-formula> is the set of immune spots annotated by experiments, and <inline-formula id="IEq230"><alternatives><tex-math id="M527">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M528"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq230.gif"/></alternatives></inline-formula> is the set of spots in domain d. For slices S1, S2, S5, and S6, we used the H&amp;E staining information from the original study as the experimental annotation of immune spots<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. For slice S10, we used the anti-CD3 immunofluorescence images of the slice to annotate immune spots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Specifically, we first used DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup> and DAPI channel information to filter cells with sizes between 150 and 1000 pixels. Then, we scaled the CD3 fluorescence intensity of each pixel to 0−1, and used the average of the scaled CD3 intensity of pixels within a cell to represent the CD3 intensity of the cell. Cells with CD3 intensity &gt; 0.37 were defined as CD3<sup>+</sup> cells, and spots containing &gt; 30% CD3<sup>+</sup> cells were used as experimentally annotated lymphocyte spots.</p>
    </sec>
    <sec id="Sec24">
      <title>Metrics for benchmarking deconvolution methods</title>
      <p id="Par57">We employed the five metrics from a previous benchmarking study of deconvolution methods<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> to compare the performance of Splane with other state-of-the-art methods in processing the 32 simulated ST datasets:</p>
      <p id="Par58">1. Pearson correlation coefficient (PCC):<disp-formula id="Equ35"><label>35</label><alternatives><tex-math id="M529">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{PCC}}}}}}=\frac{E\left[\left({\widetilde{{{{{{\bf{x}}}}}}}}_{i}-{\widetilde{u}}_{i}\right)\left({{{{{{\bf{x}}}}}}}_{i}-{u}_{i}\right)\right]}{{\widetilde{s}}_{i}{s}_{i}}$$\end{document}</tex-math><mml:math id="M530"><mml:mi mathvariant="normal">PCC</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ35.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq231"><alternatives><tex-math id="M531">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\boldsymbol{x}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M532"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq231.gif"/></alternatives></inline-formula> is the cell type composition of cell type <inline-formula id="IEq232"><alternatives><tex-math id="M533">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M534"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq232.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq233"><alternatives><tex-math id="M535">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${u}_{i}$$\end{document}</tex-math><mml:math id="M536"><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq233.gif"/></alternatives></inline-formula> is the average cell type composition of cell type <inline-formula id="IEq234"><alternatives><tex-math id="M537">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M538"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq234.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq235"><alternatives><tex-math id="M539">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{i}$$\end{document}</tex-math><mml:math id="M540"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq235.gif"/></alternatives></inline-formula> is the standard deviation of the cell type composition of cell type <inline-formula id="IEq236"><alternatives><tex-math id="M541">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M542"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq236.gif"/></alternatives></inline-formula> in the ground truth, and <inline-formula id="IEq237"><alternatives><tex-math id="M543">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{x}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M544"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq237.gif"/></alternatives></inline-formula>, <inline-formula id="IEq238"><alternatives><tex-math id="M545">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{u}}_{i}$$\end{document}</tex-math><mml:math id="M546"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq238.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq239"><alternatives><tex-math id="M547">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{\sigma }}_{i}$$\end{document}</tex-math><mml:math id="M548"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq239.gif"/></alternatives></inline-formula> are the corresponding values in the predicted result. For a cell type, a higher PCC value indicates higher deconvolution accuracy.</p>
      <p id="Par59">2. Structural similarity (SSIM)<bold>:</bold><disp-formula id="Equ36"><label>36</label><alternatives><tex-math id="M549">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{SSIM}}}}}}=\frac{\left({2\widetilde{u}}_{i}{u}_{i}+{C}_{1}^{2}\right)\left(2{{{{\mathrm{cov}}}}}({{{{{{\boldsymbol{x}}}}}}^{\prime }}_{i},{\widetilde{{{{{{\boldsymbol{x}}}}}}}^{\prime} }_{i})+{C}_{2}^{2}\right)}{\left({{\widetilde{u}}_{i}}^{2}{{+u}_{i}}^{2}+{C}_{1}^{2}\right)\left({{\widetilde{s}}_{i}}^{2}{{+s}_{i}}^{2}+{C}_{2}^{2}\right)}$$\end{document}</tex-math><mml:math id="M550"><mml:mi mathvariant="normal">SSIM</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ36.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq240"><alternatives><tex-math id="M551">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{\mathrm{cov}}}}}({{{{{{\bf{x}}}}}}}_{i},{\widetilde{{{{{{\bf{x}}}}}}}}_{i})$$\end{document}</tex-math><mml:math id="M552"><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq240.gif"/></alternatives></inline-formula> is the covariance between the ground truth and the predicted result, and <inline-formula id="IEq241"><alternatives><tex-math id="M553">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{1}$$\end{document}</tex-math><mml:math id="M554"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq241.gif"/></alternatives></inline-formula> and <inline-formula id="IEq242"><alternatives><tex-math id="M555">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{2}$$\end{document}</tex-math><mml:math id="M556"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq242.gif"/></alternatives></inline-formula> are 0.01 and 0.03, respectively. For a cell type, a higher SSIM value indicates higher deconvolution accuracy.</p>
      <p id="Par60">3. Root mean square error (RMSE):<disp-formula id="Equ37"><label>37</label><alternatives><tex-math id="M557">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{RMSE}}}}}}=\sqrt{\frac{1}{M}\mathop{\sum }\limits_{j=1}^{M}{\left({\widetilde{x}}_{{ij}}-{x}_{{ij}}\right)}^{2}}$$\end{document}</tex-math><mml:math id="M558"><mml:mi mathvariant="normal">RMSE</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ37.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par61">For a cell type, a lower RMSE value indicates higher deconvolution accuracy.</p>
      <p id="Par62">4. Jensen-Shannon divergence (JS):<disp-formula id="Equ38"><label>38</label><alternatives><tex-math id="M559">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{JS}}}}}}=\frac{1}{2}{{{{{\rm{KL}}}}}}\left({\widetilde{{{{{{\bf{P}}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)+\frac{1}{2}{{{{{\rm{KL}}}}}}\left({{{{{{\bf{P}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)$$\end{document}</tex-math><mml:math id="M560"><mml:mi mathvariant="normal">JS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ38.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ39"><label>39</label><alternatives><tex-math id="M561">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}\left({{{{{{\boldsymbol{a}}}}}}}_{i}{||}{{{{{{\boldsymbol{b}}}}}}}_{i}\right)={\sum }_{j=0}^{M}\left({a}_{{ij}} * \log \frac{{a}_{{ij}}}{{b}_{{ij}}}\right)$$\end{document}</tex-math><mml:math id="M562"><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ39.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq243"><alternatives><tex-math id="M563">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{P}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M564"><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq243.gif"/></alternatives></inline-formula> and <inline-formula id="IEq244"><alternatives><tex-math id="M565">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{P}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M566"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq244.gif"/></alternatives></inline-formula> are the spatial distribution of cell type <inline-formula id="IEq245"><alternatives><tex-math id="M567">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M568"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq245.gif"/></alternatives></inline-formula> in the ground truth and the predicted result, respectively. For a cell type, a lower JS value indicates higher deconvolution accuracy.</p>
      <p id="Par63">5. Accuracy score (AS): We computed the average PCC, SSIM, RMSE, and JS of all cell types predicted by each method, and sorted the average PCC/SSIM and RMSE/JS of all deconvolution methods in ascending and descending order, respectively, to obtain <inline-formula id="IEq246"><alternatives><tex-math id="M569">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}$$\end{document}</tex-math><mml:math id="M570"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq246.gif"/></alternatives></inline-formula>, <inline-formula id="IEq247"><alternatives><tex-math id="M571">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}$$\end{document}</tex-math><mml:math id="M572"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq247.gif"/></alternatives></inline-formula>, <inline-formula id="IEq248"><alternatives><tex-math id="M573">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}$$\end{document}</tex-math><mml:math id="M574"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq248.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq249"><alternatives><tex-math id="M575">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}$$\end{document}</tex-math><mml:math id="M576"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq249.gif"/></alternatives></inline-formula>. Then, we calculated the average of the four rankings to obtain the AS value of each method as follows:<disp-formula id="Equ40"><label>40</label><alternatives><tex-math id="M577">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AS}}}}}}=\frac{1}{4}\left({{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}\right)$$\end{document}</tex-math><mml:math id="M578"><mml:mi mathvariant="normal">AS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ40.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par64">For a dataset, the method with the highest AS value has the best performance among all deconvolution methods.</p>
      <p id="Par65">For the DPLFC dataset, the cell type composition of each spot in the ST slices has not been validated by any experiments. To benchmark deconvolution methods in processing this real ST dataset, we adopted the cortical layers annotated by the original study as ground truth. We defined the accuracy score for the deconvolution results of the DPLFC datasets as the predicted proportion of one cell type in its corresponding cortical layer. Additionally, we used the Wilcoxon Rank Sum test to calculate P-values for the difference in the average proportion of each excitatory neuron cell type between the corresponding layer and the other layers across all samples. The method with the highest accuracy score and the lowest P-value has the highest deconvolution accuracy.</p>
    </sec>
    <sec id="Sec25">
      <title>Evaluation of alignment on continuous slices</title>
      <p id="Par66">We employed a 3D STARmap dataset of the mouse brain from Wang et al. study to build a ground truth to compare the performance of Scube, PASTE, and STAligner. Specifically, we divided the 1400 µm × 1700 µm × 100 µm mouse brain sample into ten 10 µm thick slices, <inline-formula id="IEq250"><alternatives><tex-math id="M579">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\hat{S}}_{i}\}$$\end{document}</tex-math><mml:math id="M580"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq250.gif"/></alternatives></inline-formula>, and used these slices as a ground truth. To simulate changes in the shape and position of slices during tissue sectioning, we randomly flipped, cropped, translated, and rotated each ground truth slice, to generate an ST dataset comprising consecutive 2D slices, <inline-formula id="IEq251"><alternatives><tex-math id="M581">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{{S}_{i}\right\}$$\end{document}</tex-math><mml:math id="M582"><mml:mfenced close="}" open="{"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq251.gif"/></alternatives></inline-formula>. Specifically, each slice (except the first slice) was randomly flipped, rotated by a random degree of 0°–360°, and translated by a random distance of 300−2000 μm along the x-axis and/or y-axis. Moreover, each slice was cropped from its edges with a crop ratio of 0.05–0.25. Then, we used Scube, PASTE, and STAligner to align each pair of adjacent simulated slices, <inline-formula id="IEq252"><alternatives><tex-math id="M583">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i},{S}_{i+1}\right)$$\end{document}</tex-math><mml:math id="M584"><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq252.gif"/></alternatives></inline-formula>, and obtain the aligned pair of slices, <inline-formula id="IEq253"><alternatives><tex-math id="M585">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i}^{{\prime} },{S}_{i+1}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M586"><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq253.gif"/></alternatives></inline-formula>.</p>
      <p id="Par67">To compare the alignment results of Scube, PASTE, and STAligner with the ground truth, we first calculated the transformation matrix <inline-formula id="IEq254"><alternatives><tex-math id="M587">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M588"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq254.gif"/></alternatives></inline-formula> from an aligned slice <inline-formula id="IEq255"><alternatives><tex-math id="M589">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M590"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq255.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq256"><alternatives><tex-math id="M591">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M592"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq256.gif"/></alternatives></inline-formula> as<disp-formula id="Equ41"><label>41</label><alternatives><tex-math id="M593">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}={S}_{i}^{{\prime} \left(3\right)}{\left(\begin{array}{c}{\hat{S}}_{i}^{\left(3\right)}\\ {{{{{{\bf{1}}}}}}}_{1\times 3}\end{array}\right)}^{-1}$$\end{document}</tex-math><mml:math id="M594"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ41.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq257"><alternatives><tex-math id="M595">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} (3)}$$\end{document}</tex-math><mml:math id="M596"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq257.gif"/></alternatives></inline-formula> and <inline-formula id="IEq258"><alternatives><tex-math id="M597">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}^{(3)}$$\end{document}</tex-math><mml:math id="M598"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq258.gif"/></alternatives></inline-formula> are the first three columns of <inline-formula id="IEq259"><alternatives><tex-math id="M599">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M600"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq259.gif"/></alternatives></inline-formula> and <inline-formula id="IEq260"><alternatives><tex-math id="M601">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M602"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq260.gif"/></alternatives></inline-formula>, respectively. We used the transformation matrix <inline-formula id="IEq261"><alternatives><tex-math id="M603">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M604"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq261.gif"/></alternatives></inline-formula> to transform the aligned slice <inline-formula id="IEq262"><alternatives><tex-math id="M605">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{{\prime} }$$\end{document}</tex-math><mml:math id="M606"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq262.gif"/></alternatives></inline-formula> adjacent to <inline-formula id="IEq263"><alternatives><tex-math id="M607">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M608"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq263.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ42"><label>42</label><alternatives><tex-math id="M609">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}={M}_{i}\left(\begin{array}{c}{S}_{i+1}^{{\prime} }\\ {{{{{{\bf{1}}}}}}}_{1\times {n}_{i+1}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M610"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ42.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par68">Then, we divided the transformed aligned slice <inline-formula id="IEq264"><alternatives><tex-math id="M611">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M612"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq264.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq265"><alternatives><tex-math id="M613">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M614"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq265.gif"/></alternatives></inline-formula> into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type compositions of the grids in <inline-formula id="IEq266"><alternatives><tex-math id="M615">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M616"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq266.gif"/></alternatives></inline-formula> and <inline-formula id="IEq267"><alternatives><tex-math id="M617">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M618"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq267.gif"/></alternatives></inline-formula>, to measure the accuracy of Scube, PASTE, and STAligner.</p>
      <p id="Par69">In addition, we employed mouse brain MERFISH, mouse embryo Stereo-seq, and mouse brain Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> data to assess the performance of Scube, PASTE, and STAligner. As there are no ground truths for these datasets, we divided the common area of each pair of adjacent slices into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type composition of the grids in the two adjacent slices aligned by Scube, PASTE and/or STAligner to measure the performance of the two methods.</p>
    </sec>
    <sec id="Sec26">
      <title>Hyperparameter settings for benchmarking methods</title>
      <p id="Par70">The selection of the hyperparameters for each method was followed by the official tutorials and codes provided by their respective authors:<list list-type="bullet"><list-item><p id="Par71">STAligner: <ext-link ext-link-type="uri" xlink:href="https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html">https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html</ext-link></p></list-item><list-item><p id="Par72">PRECAST: <ext-link ext-link-type="uri" xlink:href="https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html">https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html</ext-link></p></list-item><list-item><p id="Par73">STACI:</p><p id="Par74">STACI GitHub repository for Visium and Spatial Transcriptomes data, and cells with gene number less 10 were filtered:</p><p id="Par75"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb</ext-link></p><p id="Par76">for MERFISH data:</p><p id="Par77"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb</ext-link></p></list-item><list-item><p id="Par78">STAGATE: <ext-link ext-link-type="uri" xlink:href="https://stagate.readthedocs.io/en/latest/T1_DLPFC.html">https://stagate.readthedocs.io/en/latest/T1_DLPFC.html</ext-link></p></list-item><list-item><p id="Par79">SpaGCN: <ext-link ext-link-type="uri" xlink:href="https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb">https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb</ext-link></p></list-item><list-item><p id="Par80">BayesSpace: <ext-link ext-link-type="uri" xlink:href="https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html">https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html</ext-link></p></list-item><list-item><p id="Par81">stLearn: <ext-link ext-link-type="uri" xlink:href="https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex">https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex</ext-link>-(DLPFC)</p></list-item></list><list list-type="bullet"><list-item><p id="Par82">CARD: <ext-link ext-link-type="uri" xlink:href="https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html">https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html</ext-link></p></list-item><list-item><p id="Par83">Cell2location: <ext-link ext-link-type="uri" xlink:href="https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html">https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html</ext-link></p></list-item><list-item><p id="Par84">DestVI:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html">https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html</ext-link></p></list-item><list-item><p id="Par85">DSTG: <ext-link ext-link-type="uri" xlink:href="https://github.com/Su-informatics-lab/DSTG">https://github.com/Su-informatics-lab/DSTG</ext-link></p></list-item><list-item><p id="Par86">RCTD: <ext-link ext-link-type="uri" xlink:href="https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html">https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html</ext-link></p></list-item><list-item><p id="Par87">Seurat: <ext-link ext-link-type="uri" xlink:href="https://satijalab.org/seurat/archive/v3.2/integration.html">https://satijalab.org/seurat/archive/v3.2/integration.html</ext-link></p></list-item><list-item><p id="Par88">SpatialDWLS: <ext-link ext-link-type="uri" xlink:href="https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html">https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html</ext-link></p></list-item><list-item><p id="Par89">SPOTlight: <ext-link ext-link-type="uri" xlink:href="https://marcelosua.github.io/SPOTlight">https://marcelosua.github.io/SPOTlight</ext-link></p></list-item><list-item><p id="Par90">Stereoscope:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html">https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html</ext-link></p></list-item><list-item><p id="Par91">STRIDE: <ext-link ext-link-type="uri" xlink:href="https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html">https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html</ext-link></p></list-item><list-item><p id="Par92">Tangram: <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/Tangram">https://github.com/broadinstitute/Tangram</ext-link></p></list-item></list></p>
      <p id="Par93">The hyperparameters used for each method were reported in Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>.</p>
    </sec>
    <sec id="Sec27">
      <title>Statistics &amp; reproducibility</title>
      <p id="Par94">No statistical method was used to predetermine sample size. In Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>, the CARD was excluded from the benchmark on the scRNA-seq data simulated datasets due to lack of spatial information for these datasets. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>, the STRIDE was not shown in Stereo-seq mouse embryo brain dataset due to a runtime error for this dataset. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a</xref>, two slices were excluded due to the lack of L6b cells, which prevented the definition of ground truth. The experiments were not randomized. The Investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec28">
      <title>Reporting summary</title>
      <p id="Par95">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec29">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43220_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43220_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43220_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43220_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43220_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_43220_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_43220_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec30">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2023_43220_MOESM8_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Hao Xu, Shuyan Wang.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43220-3.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200 to K.Q.), the National Natural Science Foundation of China grants (T2125012 and 91940306 to K.Q.; 32170668 to B.L.), CAS Project for Young Scientists in Basic Research YSBR-005 (to K.Q.), Anhui Province Science and Technology Key Program (202003a07020021 to K.Q.) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158 to K.Q.). We thank the USTC Supercomputing Center and the School of Life Science Bioinformatics Center for providing computing resources for this project.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>K.Q., J.L., and B.L. conceived the project. H.X., J.L., and S.Wang designed the framework and performed data analysis with the help of M.F., S.L., C.C., S.Wan, R.W., M.T., and T.X.; B.L., K.Q., H.X., and J.L. wrote the manuscript with input from all authors. K.Q. and J.L. supervised the entire project. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par96"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. The simulation datasets used for the evaluation of Spoint and other deconvolution methods are available in a GitHub repository at <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SpatialBenchmarking">https://github.com/QuKunLab/SpatialBenchmarking</ext-link>. The raw data of 11 ST datasets and five paired single-cell/nucleus RNA sequence datasets are available from the following studies: (1) 12 slices of human DLPFC 10X Visium data at <ext-link ext-link-type="uri" xlink:href="http://research.libd.org/spatialLIBD/">http://research.libd.org/spatialLIBD/</ext-link><sup><xref ref-type="bibr" rid="CR34">34</xref></sup>; (2) six slices of human breast cancer 10X Visium data at 10.5281/zenodo.4739739<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (3) four slices of human breast cancer 10X Visium data: Parent_Visium_Human_BreastCancer, V1_Breast_Cancer_Block_A_Section_1, V1_Breast_Cancer_Block_A_Section_2 and Visium_FFPE_Human_Breast_Cancer at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR14">14</xref></sup>; (4) one slice of human breast cancer 10X Visium data: Invasive Ductal Carcinoma Stained With Fluorescent CD3 Antibody at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR30">30</xref></sup>; (5) Mouse brain STARmap data at <ext-link ext-link-type="uri" xlink:href="https://www.starmapresources.org/data">https://www.starmapresources.org/data</ext-link><sup><xref ref-type="bibr" rid="CR58">58</xref></sup>; (6) 33 slices of Mouse MOp MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://doi.brainimagelibrary.org/doi/10.35077/g.21">https://doi.brainimagelibrary.org/doi/10.35077/g.21</ext-link><sup><xref ref-type="bibr" rid="CR13">13</xref></sup>; (7) one slice of mouse E16.5 embryo brain Stereo-seq data, one slice of mouse brain Stereo-seq data, and 13 slices of mouse E16.5 whole embryo Stereo-seq data at <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</ext-link><sup><xref ref-type="bibr" rid="CR4">4</xref></sup>; (8) ten slice of human brain MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw">https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw</ext-link><sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; (9) 75 slice of mouse whole brain Spatial Transcriptomics data are available in the GEO database under accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE147747">GSE147747</ext-link><sup><xref ref-type="bibr" rid="CR60">60</xref></sup>; (10) single-nucleus transcriptomics data across multiple human cortical areas at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq">https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq</ext-link><sup><xref ref-type="bibr" rid="CR51">51</xref></sup>; (11) single-cell transcriptomics data of human breast cancer data at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1039">https://singlecell.broadinstitute.org/single_cell/study/SCP1039</ext-link><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (12) single-cell transcriptomics data of mouse embryo brain at <ext-link ext-link-type="uri" xlink:href="http://mousebrain.org/development/downloads.html">http://mousebrain.org/development/downloads.html</ext-link><sup><xref ref-type="bibr" rid="CR83">83</xref></sup>; (13) single-cell transcriptomics data of mouse whole cortex and hippocampus at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x">https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x</ext-link><sup><xref ref-type="bibr" rid="CR52">52</xref></sup>; (14) single-cell transcriptomics data of mouse whole brain at mousebrain.org/adolescent/downloads.html<sup><xref ref-type="bibr" rid="CR84">84</xref></sup>. All the aforementioned data used in this study are available in a public Zenodo repository at 10.5281/zenodo.8316334. Source data for figures are provided with this paper. <xref ref-type="sec" rid="Sec30">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The open-source package of SPACEL is available at a GitHub repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SPACEL">https://github.com/QuKunLab/SPACEL</ext-link><sup><xref ref-type="bibr" rid="CR85">85</xref></sup>. We uploaded all codes and scripts used for the analyses and figure plotting in this study to a public Zenodo repository (10.5281/zenodo.8316334). The documentation, usage instructions and other relevant information related to SPACEL can be accessed through (<ext-link ext-link-type="uri" xlink:href="https://spacel.readthedocs.org">https://spacel.readthedocs.org</ext-link>).</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par97">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>353</volume>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srivatsan</surname>
            <given-names>SR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Embryo-scale, single-cell spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2021</year>
        <volume>373</volume>
        <fpage>111</fpage>
        <lpage>117</lpage>
        <pub-id pub-id-type="pmid">34210887</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <year>2022</year>
        <volume>185</volume>
        <fpage>1777</fpage>
        <lpage>1792</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergmann</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial profiling of early primate gastrulation in utero</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>609</volume>
        <fpage>136</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">35709828</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>SM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial omics and multiplexed imaging to explore cancer biology</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>997</fpage>
        <lpage>1012</lpage>
        <pub-id pub-id-type="pmid">34341583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>W-T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics and in situ sequencing to study Alzheimer’s Disease</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>976</fpage>
        <lpage>991</lpage>
        <pub-id pub-id-type="pmid">32702314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752</lpage>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuppe</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial multi-omic map of human myocardial infarction</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>766</fpage>
        <lpage>777</lpage>
        <pub-id pub-id-type="pmid">35948637</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Erickson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved clonal copy number alterations in benign and malignant tissue</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>360</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="pmid">35948708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shah</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lubeck</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>In situ transcription profiling of single cells reveals spatial organization of cells in the mouse hippocampus</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>92</volume>
        <fpage>342</fpage>
        <lpage>357</lpage>
        <pub-id pub-id-type="pmid">27764670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>932</fpage>
        <lpage>935</lpage>
        <pub-id pub-id-type="pmid">30377364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved cell atlas of the mouse primary motor cortex by MERFISH</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>598</volume>
        <fpage>137</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">34616063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Visium spatial gene expression. <italic>10x Genomics</italic> (2020).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriques</surname>
            <given-names>SG</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>363</volume>
        <fpage>1463</fpage>
        <lpage>1467</lpage>
        <pub-id pub-id-type="pmid">30923225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with Slide-seqV2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Lopez, R. et al. A joint model of unpaired data from scRNA-seq and spatial transcriptomics for imputing missing gene expression measurements. Preprint at <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1905.02269">http://arxiv.org/abs/1905.02269</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Loog</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>van de Wiel</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
          <name>
            <surname>Wessels</surname>
            <given-names>LFA</given-names>
          </name>
        </person-group>
        <article-title>PRECISE: a domain adaptation approach to transfer predictors of drug response from pre-clinical models to tumors</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>i510</fpage>
        <lpage>i519</lpage>
        <pub-id pub-id-type="pmid">31510654</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mahfouz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
        </person-group>
        <article-title>SpaGE: spatial gene enhancement using scRNA-seq</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2020</year>
        <volume>48</volume>
        <fpage>e107</fpage>
        <lpage>e107</lpage>
        <pub-id pub-id-type="pmid">32955565</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Biancalani</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with Tangram</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1352</fpage>
        <lpage>1362</lpage>
        <pub-id pub-id-type="pmid">34711971</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kleshchevnikov</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>661</fpage>
        <lpage>671</lpage>
        <pub-id pub-id-type="pmid">35027729</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cable</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust decomposition of cell type mixtures in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>517</fpage>
        <lpage>526</lpage>
        <pub-id pub-id-type="pmid">33603203</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G-C</given-names>
          </name>
        </person-group>
        <article-title>SpatialDWLS: accurate deconvolution of spatial transcriptomic data</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>145</fpage>
        <pub-id pub-id-type="pmid">33971932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andersson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title>
        <source>Commun. Biol.</source>
        <year>2020</year>
        <volume>3</volume>
        <fpage>565</fpage>
        <pub-id pub-id-type="pmid">33037292</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elosua-Bayes</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Gut</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Heyn</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>SPOTlight: seeded NMF regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>e50</fpage>
        <pub-id pub-id-type="pmid">33544846</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Song</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>DSTG: deconvoluting spatial transcriptomics data through graph-based artificial intelligence</article-title>
        <source>Brief. Bioinform.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>bbaa414</fpage>
        <pub-id pub-id-type="pmid">33480403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>STRIDE: accurately decomposing and integrating spatial transcriptomics using single-cell RNA sequencing</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e42</fpage>
        <lpage>e42</lpage>
        <pub-id pub-id-type="pmid">35253896</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DestVI identifies continuums of cell types in spatial transcriptomics data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1360</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="pmid">35449415</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Spatially informed cell-type deconvolution for spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1349</fpage>
        <lpage>1359</lpage>
        <pub-id pub-id-type="pmid">35501392</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention auto-encoder</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1739</fpage>
        <pub-id pub-id-type="pmid">35365632</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Pham, D. et al. stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. Preprint at 10.1101/2020.05.31.125658 (2020).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maynard</surname>
            <given-names>KR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>425</fpage>
        <lpage>436</lpage>
        <pub-id pub-id-type="pmid">33558695</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multimodal analysis of composition and spatial architecture in human squamous</article-title>
        <source>Cell Carcinoma Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>497</fpage>
        <lpage>514</lpage>
        <pub-id pub-id-type="pmid">32579974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive analysis of spatial architecture in primary liver cancer</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabg3750</fpage>
        <pub-id pub-id-type="pmid">34919432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Shivashankar</surname>
            <given-names>GV</given-names>
          </name>
          <name>
            <surname>Uhler</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Graph-based autoencoder integrates spatial transcriptomics with chromatin images and identifies joint biomarkers for Alzheimer’s disease</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>7480</fpage>
        <pub-id pub-id-type="pmid">36463283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic embedding, clustering, and alignment for integrating spatial transcriptomics data with PRECAST</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="pmid">36653349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Zhou, X., Dong, K. &amp; Zhang, S. Integrating spatial transcriptomics data across different conditions, technologies, and developmental stages. <italic>Nat. Comput. Sci.</italic><bold>3</bold>, 894–906 (2023).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeira</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Land</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Strzalkowski</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Raphael</surname>
            <given-names>BJ</given-names>
          </name>
        </person-group>
        <article-title>Alignment and integration of spatial transcriptomics data</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>567</fpage>
        <lpage>575</lpage>
        <pub-id pub-id-type="pmid">35577957</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <mixed-citation publication-type="other">Defferrard, M., Bresson, X. &amp; Vandergheynst, P. Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering. in <italic>Advances in Neural Information Processing Systems</italic> (2016).</mixed-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Kipf, T. N. &amp; Welling, M. Semi-Supervised Classification with Graph Convolutional Networks. in <italic>International Conference on Learning Representations</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <mixed-citation publication-type="other">Goodfellow, I. et al. Generative Adversarial Nets. in <italic>Advances in Neural Information Processing Systems</italic> (2014).</mixed-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>MacQueen</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Some methods for classification and analysis of multivariate observations</article-title>
        <source>Proc. Fifth Berkeley Symp. Math. Stat. Probab.</source>
        <year>1967</year>
        <volume>1</volume>
        <fpage>281</fpage>
        <lpage>298</lpage>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storn</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Differential Evolution – A Simple and Efficient Heuristic for global Optimization over Continuous Spaces</article-title>
        <source>J. Glob. Optim.</source>
        <year>1997</year>
        <volume>11</volume>
        <fpage>341</fpage>
        <lpage>359</lpage>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fang</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conservation and divergence of cortical cell organization in human and mouse revealed by MERFISH</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>377</volume>
        <fpage>56</fpage>
        <lpage>62</lpage>
        <pub-id pub-id-type="pmid">35771910</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>662</fpage>
        <lpage>670</lpage>
        <pub-id pub-id-type="pmid">35577954</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hodge</surname>
            <given-names>RD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conserved cell types with divergent features in human versus mouse cortex</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>573</volume>
        <fpage>61</fpage>
        <lpage>68</lpage>
        <pub-id pub-id-type="pmid">31435019</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e26</lpage>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Shepherd</surname>
            <given-names>GMG</given-names>
          </name>
        </person-group>
        <article-title>The neocortical circuit: themes and variations</article-title>
        <source>Nat. Neurosci.</source>
        <year>2015</year>
        <volume>18</volume>
        <fpage>170</fpage>
        <lpage>181</lpage>
        <pub-id pub-id-type="pmid">25622573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">10X Genomics Datasets. <italic>10X Genomics</italic><ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets">https://www.10xgenomics.com/resources/datasets</ext-link> (2021).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baslan</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel insights into breast cancer copy number genetic heterogeneity revealed by single-cell genome sequencing</article-title>
        <source>eLife</source>
        <year>2020</year>
        <volume>9</volume>
        <fpage>e51480</fpage>
        <pub-id pub-id-type="pmid">32401198</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Timothy, T., Itay, T., Georgescu, C., Maxwell, B. &amp; Brian, H. inferCNV of the Trinity CTAT Project. (2019).</mixed-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>361</volume>
        <fpage>eaat5691</fpage>
        <pub-id pub-id-type="pmid">29930089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Hagan</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Curve fitting and optimal design for prediction</article-title>
        <source>J. R. Stat. Soc. Ser. B Methodol.</source>
        <year>1978</year>
        <volume>40</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ortiz</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular atlas of the adult mouse brain</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eabb3446</fpage>
        <pub-id pub-id-type="pmid">32637622</pub-id>
      </element-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Krizhevsky, A., Sutskever, I. &amp; Hinton, G. E. ImageNet Classification with Deep Convolutional Neural Networks. in <italic>Advances in Neural Information Processing Systems</italic> (2012).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Devlin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>M-W</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Toutanova</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</article-title>
        <source>Proc. naacL-HLT</source>
        <year>2019</year>
        <volume>1</volume>
        <fpage>4171</fpage>
        <lpage>4186</lpage>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902</lpage>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stein-O’Brien</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Decomposing Cell Identity for Transfer Learning across Cellular Measurements, Platforms, Tissues, and Species</article-title>
        <source>Cell Syst.</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>395</fpage>
        <lpage>411</lpage>
        <pub-id pub-id-type="pmid">31121116</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data denoising with transfer learning in single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>875</fpage>
        <lpage>878</lpage>
        <pub-id pub-id-type="pmid">31471617</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Weigert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Broaddus</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Cell Detection with Star-convex Polygons</article-title>
        <source>Med. Image Comput. Computer Assist. Intervention–MICCAI 2018: 21st Int. Conf., Granada, Spain,</source>
        <year>2018</year>
        <volume>11</volume>
        <fpage>265</fpage>
        <lpage>273</lpage>
      </element-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bannon</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DeepCell Kiosk: scaling deep learning–enabled cellular image analysis with Kubernetes</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>43</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="pmid">33398191</pub-id>
      </element-citation>
    </ref>
    <ref id="CR69">
      <label>69.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR70">
      <label>70.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fukushima</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Cognitron: A self-organizing multilayered neural network</article-title>
        <source>Biol. Cybern.</source>
        <year>1975</year>
        <volume>20</volume>
        <fpage>121</fpage>
        <lpage>136</lpage>
        <pub-id pub-id-type="pmid">1203338</pub-id>
      </element-citation>
    </ref>
    <ref id="CR71">
      <label>71.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kullback</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Leibler</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>On Information and Sufficiency</article-title>
        <source>Ann. Math. Stat.</source>
        <year>1951</year>
        <volume>22</volume>
        <fpage>79</fpage>
        <lpage>86</lpage>
      </element-citation>
    </ref>
    <ref id="CR72">
      <label>72.</label>
      <mixed-citation publication-type="other">He, K., Zhang, X., Ren, S. &amp; Sun, J. Delving Deep into Rectifiers: Surpassing Human-Level Performance on ImageNet Classification. in <italic>Proceedings of the IEEE international conference on computer vision</italic> 1026–1034 (2015).</mixed-citation>
    </ref>
    <ref id="CR73">
      <label>73.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: A Method for Stochastic Optimization. in <italic>International Conference for Learning Representations</italic> (2015).</mixed-citation>
    </ref>
    <ref id="CR74">
      <label>74.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hammond</surname>
            <given-names>DK</given-names>
          </name>
          <name>
            <surname>Vandergheynst</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gribonval</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Wavelets on graphs via spectral graph theory</article-title>
        <source>Appl. Comput. Harmon. Anal.</source>
        <year>2011</year>
        <volume>30</volume>
        <fpage>129</fpage>
        <lpage>150</lpage>
      </element-citation>
    </ref>
    <ref id="CR75">
      <label>75.</label>
      <mixed-citation publication-type="other">Glorot, X. &amp; Bengio, Y. Understanding the difficulty of training deep feedforward neural networks. in <italic>Proceedings of the Thirteenth International Conference on Artificial Intelligence and Statistics</italic><bold>9</bold>, 249–256 (2010).</mixed-citation>
    </ref>
    <ref id="CR76">
      <label>76.</label>
      <mixed-citation publication-type="other">Davies, D. L. &amp; Bouldin, D. W. A Cluster Separation Measure. <italic>IEEE Trans. Pattern Anal. Mach. Intell</italic>. <bold>PAMI-1</bold>, 224–227 (1979).</mixed-citation>
    </ref>
    <ref id="CR77">
      <label>77.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: Machine Learning in Python</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR78">
      <label>78.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edelsbrunner</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Kirkpatrick</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Seidel</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>On the shape of a set of points in the plane</article-title>
        <source>IEEE Trans. Inf. Theory</source>
        <year>1983</year>
        <volume>29</volume>
        <fpage>551</fpage>
        <lpage>559</lpage>
      </element-citation>
    </ref>
    <ref id="CR79">
      <label>79.</label>
      <mixed-citation publication-type="other">Zhou, Q.-Y., Park, J. &amp; Koltun, V. Open3D: A Modern Library for 3D Data Processing. Preprint at 10.48550/arXiv.1801.09847 (2018).</mixed-citation>
    </ref>
    <ref id="CR80">
      <label>80.</label>
      <mixed-citation publication-type="other">Loop, C. Smooth Subdivision Surfaces Based on Triangles. (1987).</mixed-citation>
    </ref>
    <ref id="CR81">
      <label>81.</label>
      <mixed-citation publication-type="other">Basak, S., Petit, S., Bect, J. &amp; Vazquez, E. Numerical issues in maximum likelihood parameter estimation for Gaussian process interpolation. in <italic>International Conference on Machine Learning, Optimization, and Data Science</italic> 116–131 (2021).</mixed-citation>
    </ref>
    <ref id="CR82">
      <label>82.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR83">
      <label>83.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR84">
      <label>84.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular Architecture of the Mouse Nervous System</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>999</fpage>
        <lpage>1014</lpage>
        <pub-id pub-id-type="pmid">30096314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR85">
      <label>85.</label>
      <mixed-citation publication-type="other">Xu, H. &amp; Wang, S. SPACEL: deep-learning based characterization of spatial transcriptome architectures. Zenodo, 10.5281/zenodo.8419717 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10663563</article-id>
    <article-id pub-id-type="publisher-id">43220</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43220-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SPACEL: deep learning-based characterization of spatial transcriptome architectures</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xu</surname>
          <given-names>Hao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Wang</surname>
          <given-names>Shuyan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fang</surname>
          <given-names>Minghao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luo</surname>
          <given-names>Songwen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Chunpeng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Siyuan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Rirui</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tang</surname>
          <given-names>Meifang</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6187-122X</contrib-id>
        <name>
          <surname>Xue</surname>
          <given-names>Tian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0485-3724</contrib-id>
        <name>
          <surname>Li</surname>
          <given-names>Bin</given-names>
        </name>
        <address>
          <email>libin@nibs.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7087-6540</contrib-id>
        <name>
          <surname>Lin</surname>
          <given-names>Jun</given-names>
        </name>
        <address>
          <email>linjun7@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5555-8437</contrib-id>
        <name>
          <surname>Qu</surname>
          <given-names>Kun</given-names>
        </name>
        <address>
          <email>qukun@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Department of Oncology, The First Affiliated Hospital of USTC, School of Basic Medical Sciences, Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff2"><label>2</label>Institute of Artificial Intelligence, Hefei Comprehensive National Science Center, Hefei, 230088 China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>School of Data Science, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/00wksha49</institution-id><institution-id institution-id-type="GRID">grid.410717.4</institution-id><institution-id institution-id-type="ISNI">0000 0004 0644 5086</institution-id><institution>National Institute of Biological Sciences, </institution></institution-wrap>Beijing, 102206 China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7603</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Spatial transcriptomics (ST) technologies detect mRNA expression in single cells/spots while preserving their two-dimensional (2D) spatial coordinates, allowing researchers to study the spatial distribution of the transcriptome in tissues; however, joint analysis of multiple ST slices and aligning them to construct a three-dimensional (3D) stack of the tissue still remain a challenge. Here, we introduce spatial architecture characterization by deep learning (SPACEL) for ST data analysis. SPACEL comprises three modules: Spoint embeds a multiple-layer perceptron with a probabilistic model to deconvolute cell type composition for each spot in a single ST slice; Splane employs a graph convolutional network approach and an adversarial learning algorithm to identify spatial domains that are transcriptomically and spatially coherent across multiple ST slices; and Scube automatically transforms the spatial coordinate systems of consecutive slices and stacks them together to construct a 3D architecture of the tissue. Comparisons against 19 state-of-the-art methods using both simulated and real ST datasets from various tissues and ST technologies demonstrate that SPACEL outperforms the others for cell type deconvolution, for spatial domain identification, and for 3D alignment, thus showcasing SPACEL as a valuable integrated toolkit for ST data processing and analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Spatial transcriptomics (ST) technologies detect transcript distribution in space. Here, authors present a deep learning based method SPACEL for cell type deconvolution, spatial domain identification and 3D alignment, showcasing it as a valuable toolkit for ST data analysis</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Bioinformatics</kwd>
      <kwd>Computational models</kwd>
      <kwd>Sequencing</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200),the National Natural Science Foundation of China grants (T2125012 and 91940306), CAS Project for Young Scientists in Basic Research YSBR-005, Anhui Province Science and Technology Key Program (202003a07020021) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (32170668),</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (81871479), the Fundamental Research Funds for the Central Universities (WK9100000001).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Spatial transcriptomics (ST) technologies have enabled researchers to detect the spatial distribution of, in principle, the entire transcriptome in histological tissue slices and thereby substantially improved our understanding of organ architecture<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup> and disease microenvironments<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>. There are two broad categories of experimental ST techniques that can either i) detect the expression of a partial transcriptome at single cell resolution or ii) detect an entire transcriptome without single-cell resolution. ST techniques based on in situ hybridization and fluorescence microscopy (image-based), such as seqFISH<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, osmFISH<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, and MERFISH<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> probe only hundreds to thousands of transcripts in a slice, but can achieve single cell and even subcellular resolution. ST techniques based on next-generation sequencing (seq-based), such as 10X Visium<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>, Slide-seq<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref></sup> and Stereo-seq<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> detect the expression of the whole transcriptome, but the resolution is restricted by the size of spots in the ST slices. Owing to limitations of these experimental ST techniques, many analytical methods have been developed to impute the undetected transcripts on each slice<sup><xref ref-type="bibr" rid="CR17">17</xref>–<xref ref-type="bibr" rid="CR20">20</xref></sup> and/or to deconvolute the cell types in each spot<sup><xref ref-type="bibr" rid="CR21">21</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, aiming to detect an entire transcriptome while retaining single-cell resolution.</p>
    <p id="Par4">A recent computational task for ST data analysis is the identification of clusters of cells/spots that are coherent in both transcriptome expression and spatial coordinates—i.e., dissecting the so-called spatial domains to characterize the spatial architecture present within an ST slice. Several methods have been developed to accomplish this task. For example, BayesSpace employs a Bayesian model and a Markov chain Monte Carlo approach to improve the resolution of ST data to the subspot level and then identifies spatial domains by clustering these subspots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. SpaGCN adopts a graph convolutional network to integrate the transcript expression level data with their spatial location information to identify spatial domains<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. STAGATE uses an adaptive graph attention auto-encoder model to learn the similarities between the neighboring spots to identify spatial domains<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. stLearn leverages a Louvain clustering algorithm and k-d tree nearest neighbor searching to identify spatial domains in ST slices<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The above-mentioned methods were designed for analyzing single ST slices.</p>
    <p id="Par5">The current trends for the rapid development and application of ST technologies suggest that a large number of ST slices from diverse tissues (and conditions) will be generated in scientific and medical studies for the foreseeable future<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR34">34</xref>–<xref ref-type="bibr" rid="CR37">37</xref></sup>. Accordingly, there is an urgent need for computational tools that can quickly and efficiently implement integrated analysis of data from multiple ST slices. STACI<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, PRECAST<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> aimed to identify spatial domains jointly across multiple ST slices. These methods utilize gene expression as the input for their models, specifically, STACI adopts an over-parameterization approach, PRECAST uses simple projections of the batch effects onto the space of biological effects and STAligner employs triplet-loss for training. However, it has been reported that cell-type distribution is more robust for identifying uniform domains across multiple slices<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>.</p>
    <p id="Par6">Accurately identifying functional spatial domains across multiple slices and reconstructing the 3D architecture of tissues offer invaluable opportunities for significant biological discoveries in various practical applications. The PASTE<sup><xref ref-type="bibr" rid="CR41">41</xref></sup> and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> methods made an effort to address these difficulties by integrating multiple slices into a single center slice, and/or aligning the consecutive slices to construct a 3D architecture of the tissue. PASTE assumes complete 2D overlap of slices, which restricts its applicability to cases where slices have only partial overlap. STAligner relies on selected landmark domains shared across slices for alignment and does not utilize correspondences for each individual spot in adjacent slices. As a result, these approaches can encounter misalignment issues in accurately capturing the global structure. Overall, constructing a stacked 3D alignment of the tissue still remains a great challenge for ST datasets with substantial defects.</p>
    <p id="Par7">Here, we developed SPACEL, a deep-learning-based toolkit comprising three modules—Spoint, Splane, and Scube—covering three analysis tasks for ST data (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). Spoint predicts the cell type composition of spots obtained by seq-based ST technologies such as 10X Visium. Splane jointly analyzes multiple ST slices and identifies spatial domains based on the cell type composition and spatial coordinate information of spots/cells. Scube aligns multiple consecutive slices and constructs a stacked 3D architecture of the tissue based on the coordinates of the spatial domains identified by Splane. We applied SPACEL to analyze 11 ST datasets comprising 156 slices acquired using the 10X Visium, STARmap, MERFISH, Stereo-seq, and Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> technologies (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). SPACEL outperformed other state-of-the-art methods for each of the three examined analysis tasks and thus represents a valuable integrated toolkit for ST data processing and analysis.<fig id="Fig1"><label>Fig. 1</label><caption><title>Workflow of SPACEL.</title><p><bold>a</bold> Three modules of SPACEL: Spoint, Splane, and Scube. <bold>b</bold> Spoint deconvolutes cell types of spots using an MLP and a probability model. MLP, multiple-layer perceptron; VAE, variational autoencoder. <bold>c</bold> Splane employs a GCN model and an adversarial learning algorithm to identify spatial domains across multiple slices. GCN, graph convolutional network. <bold>d</bold> For consecutive slices, Scube adopts a mutual nearest neighbor (MNN) graph and the differential evolution algorithm to transform slices and construct a stacked 3D alignment of a tissue.</p></caption><graphic xlink:href="41467_2023_43220_Fig1_HTML" id="d32e409"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Workflow of SPACEL</title>
      <p id="Par8">The full architecture of SPACEL is illustrated in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, including the modules Spoint, Splane and Scube. Our motivation for developing the Spoint module is the need to perform cell type deconvolution on ST slices generated by seq-base ST technologies, which is also required for subsequent analysis of SPACEL. Spoint embedded a multiple-layer perceptron (MLP) with a probabilistic model to deconvolute the cell type composition of each ST spot (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>, Methods). Spoint leverages a combination of simulated pseudo-spots, neural network modeling, and statistical recovery of expression profiles, which allows it to provide a more robust and accurate framework for estimating cell-type proportions in real ST data. For image-based ST data (i.e., single-cell resolution), users can simply use single-cell analysis tools (e.g., Seurat<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> and Scanpy<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>) to cluster cells and use marker genes to identify the cell type of each cell cluster.</p>
      <p id="Par9">Splane employs a graph convolutional network (GCN) approach<sup><xref ref-type="bibr" rid="CR44">44</xref>,<xref ref-type="bibr" rid="CR45">45</xref></sup> and an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to identify spatial domains by jointly analyzing multiple ST slices (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>, Methods). First, for each ST slice, Splane calculates an adjacency matrix of cells/spots based on their distance in space. Then, Splane constructs a GCN model from the adjacency matrix and the cell type composition of cells/spots, and employs an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to learn the latent features shared across all of the analyzed ST slices; we term this a joint analysis scheme. Next, Splane applies a K-means clustering algorithm<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> to aggregate cells/spots with similar patterns of the shared latent features, where each of these cell/spot clusters is referred to as a spatial domain. All existing spatial-domain identification tools commonly utilize gene expression as input for their analyses and most of them follow a single analysis scheme. Splane distinguishes itself by utilizing cell-type composition as the input and adopting a joint analysis scheme. Furthermore, Splane incorporates an adversarial training to explicitly tackle and eliminate batch effects across multiple slices.</p>
      <p id="Par10">For ST datasets containing consecutive slices, Scube aligns the Splane predicted coordinate systems for each pair of adjacent slices and then constructs a stacked 3D architecture of the tissue, which is fully automated and does not require any manual alignment (Fig. <xref rid="Fig1" ref-type="fig">1d</xref>, Methods). Briefly, Scube builds a mutual nearest neighbor (MNN) graph between the cells/spots of two adjacent slices based on the coordinate information of spots and constructs an alignment objective function between them. This function serves as the foundation for aligning the slices and treats the alignment task as an optimization problem. Unlike existing tools like PASTE or STAligner, Scube is specifically designed to handle partially overlapped slices by incorporating a penalty term that accounts for the proportion of overlapped spots in adjacent slices. Scube then employs a differential evolution optimization algorithm<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> to search for the optimal translation vectors and rotation angles for each slice, and aligns them by transforming the coordinates of every slice accordingly. Finally, Scube stacks the transformed slices to construct the 3D architecture of the tissue.</p>
      <p id="Par11">In summary, Spoint, Splane, and Scube accomplished three analysis tasks of ST data in turn: cell type deconvolution, spatial domain identification, and 3D architecture construction. We have carefully designed each module of our method in an innovative way to address the potential limitations of current state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>). Specifically, Spoint employs a statistical model, a pseudo-spot simulation, a deep learning technique, and an elimination of variation between reference and ST data. In contrast, other tools often miss one or more of these features. Splane is unique in its combination of a cell type composition as input — a feature not utilized by any other tools, and adversarial training in the GCN model — a common approach first been employed to mitigate batch effects in ST data. Scube employs a unique global optimization strategy for 3D alignment, setting it apart from its peers. While each of these modules can operate independently, they are also optimized to work seamlessly in a unified workflow. This adaptability enables SPACEL to analyze data from diverse experimental platforms while simultaneously providing an all-encompassing and streamlined solution for ST data interpretation.</p>
      <p id="Par12">To ensure the robustness of SPACEL, we conducted extensive experiments to evaluate its performance across various hyperparameter settings. Our results demonstrate that Spoint, Splane, and Scube exhibit superior robustness to hyperparameter variation compared to other state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a–c</xref>), highlighting the effectiveness of SPACEL in providing reliable and consistent results across different experimental settings.</p>
    </sec>
    <sec id="Sec4">
      <title>Spoint accurately deconvolutes cell-type composition</title>
      <p id="Par13">To construct the training set for Spoint and other deconvolution methods, we simulated pseudo-spots using the scRNA-seq dataset by assuming a normal distribution of the number of cells and the number of cell types per spot. Our simulations generated pseudo-spots similar to real ST data (MERFISH data from human brain tissue<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2d–k</xref>). We compared the performance of Spoint with state-of-the-art methods for cell type deconvolution, including Cell2lacation, SpatialDWLS, RCTD, STRIDE, Stereoscope, Tangram, DestVI, Seurat, SPOTlight, and DSTG using 32 simulated datasets from a benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). We adopted Pearson’s correlation coefficient (PCC) and structural similarity index measure (SSIM) to assess the similarity between the predicted and true cell type compositions, and used root mean square deviation (RMSE) and Jensen-Shannon divergence (JSD) to assess the error of each method. Spoint yielded the highest average PCC/SSIM values (= 0.73/0.69), and the lowest average RMSE/JSD values (=0.05/0.41) among the 11 deconvolution methods (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Additionally, we applied the accuracy score (AS) defined in the benchmark study to evaluate the performance of each method: the average AS of Spoint ( = 0.93) was obviously higher than that of the other methods (AS = 0.24–0.82; Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Cell type deconvolution of spots using Spoint and other deconvolution methods.</title><p><bold>a</bold> Average PCC, SSIM, RMSE, and JSD values of the deconvolution methods for 32 simulated datasets from the benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>; PCC, pearson’s correlation coefficient<bold>;</bold> SSIM, structural similarity index measure; RMSE, root mean square error; JSD, Jensen-Shannon divergence; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>b</bold> Accuracy scores of the deconvolution methods for the 32 simulated datasets. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>c</bold> Spatial distributions of excitatory layer 3/4 RORB<sup>+</sup>RPS3P6<sup>+</sup> neurons predicted by the deconvolution methods for the DLPFC dataset. <bold>d</bold> Accuracy scores of the deconvolution methods for the DLPFC dataset. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 56 cell types. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig2_HTML" id="d32e541"/></fig></p>
      <p id="Par14">To evaluate Spoint’s performance in cell type deconvolution on real ST experimental data, we used two datasets as input: a 10X Visium dataset for the human dorsolateral prefrontal cortex (DLPFC) that contains 12 ST slices<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> and a human brain scRNA-seq dataset downloaded from the Allen Brain Map<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. As there is no experimental evidence for the cell type composition of each spot in this dataset, we took the cortical layers annotated by the original studies as ground truth (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c</xref>). As one example, we found that the distribution of excitatory L3/4 neurons predicted by Spoint had a higher AS value (= 0.85) than the other examined deconvolution methods (AS = 0.29–0.64; Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Collectively, for all 56 cell types<sup><xref ref-type="bibr" rid="CR52">52</xref>,<xref ref-type="bibr" rid="CR53">53</xref></sup> in all 12 ST slices, the average AS of Spoint ( = 0.60) was again higher than those of the other methods (average AS = 0.30–0.48; Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Furthermore, we calculated the significance (using the Wilcoxon Rank Sum test) of any difference in the proportion of one cell type between the layers, with a lower <italic>P</italic>-value representing increased deconvolution accuracy<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. We found that the average <italic>P</italic>-value of Spoint ( = 0.01) was lower than that of the other methods (average <italic>P</italic>-values = 0.05–0.64; Supplementary Fig. <xref rid="MOESM1" ref-type="media">3d</xref>).</p>
      <p id="Par15">To further evaluate Spoint’s performance in real ST datasets, we collected three single-cell resolution ST datasets: Chen et al. mouse embryo brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Chen et al. mouse brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and Fang et al. human brain (MERFISH with 4000 genes)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup> to simulate spot-level ST data with known cell-type composition and spatial context. We also obtained the corresponding scRNA-seq data from the same tissue types as reference. Using these data, we aggregated approximately 10 cells into each pseudo spot, creating three distinct spot-level ST datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). As an example, we observed that Spoint achieved the highest PCC compare to other cell type deconvolution methods for forebrain glutamatergic neuroblast in dataset 1 (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). We then evaluated the deconvolution performance of the Spoint module on all cell types across the three datasets using four evaluation metrics. Our findings demonstrate that Spoint consistently outperformed existing methods, achieving the highest accuracy scores in all three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c, d</xref>). In addition, we evaluated the relative error between the summed predicted cell type proportions and the ground truth, and found that SpatialDWLS (with rankings of 1, 2, and 3) and Spoint (with rankings of 4, 3, and 1) registered the lowest average relative error across the three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>). These results provide strong evidence of the Spoint module’s superior performance over other methods, and an accurate deconvolution result will facilitate subsequent identification of spatial domains using Splane.</p>
    </sec>
    <sec id="Sec5">
      <title>Splane identifies spatial domains for multiple slices</title>
      <p id="Par16">After cell types were deconvoluted with Spoint, we applied Splane to identify the spatial domains of the aforementioned ST slices of the DLPFC dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). We used the original study’s manual annotation of cortical layers as the ground truth<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, and used three metrics to evaluate the prediction performance. Specifically, we used the Jaccard index (JI) and Adjusted Rand Index (ARI) between a spatial domain identified by Splane and the corresponding cortical layer from the ground truth to assess the accuracy of the method, and computed the shifting distance (SD) between the prediction and the ground truth to quantify the error of Splane (see Methods). A higher JI/ARI value or a lower SD value indicates that the prediction is closer to the ground truth.</p>
      <p id="Par17">First, we compared the results obtained by processing all slices jointly (joint analysis, by default) to those obtained by processing each slice individually (single analysis). To enable this comparison, we built a test version of Splane, namely, Splane-single, that constructs a GCN model for each slice individually. Taking slices 151508, 151510, 151670, and 151673 from the DLPFC dataset as examples, the JI values obtained by the joint analysis were higher than those obtained by the single analysis, and the SD values obtained by the joint analysis were lower than those obtained by the single analysis (Fig. <xref rid="Fig3" ref-type="fig">3a, b</xref>). Moreover, upon processing the entire 12 slices dataset, the average JI/median ARI values by joint analysis were 0.61/0.61, higher than that by the single analysis ( = 0.53/0.57; Fig. <xref rid="Fig3" ref-type="fig">3c, d</xref>); the average SD value by the joint analysis was 50 μm, much lower than that by the single analysis ( = 262 μm; Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). This comparison implies that the joint analysis scheme improves the accuracy of Splane for spatial identification.<fig id="Fig3"><label>Fig. 3</label><caption><title>Identification of spatial domains from 12 10X Visium slices of DLPFC.</title><p><bold>a</bold> Comparison of spatial domains identified by Splane, STAligner, PRECAST, and STACI for slice 151508, 151510, 151670, and 151673. Layer1~Layer6, cortical layer 1 ~ 6; WM, white matter; JI, Jaccard index; SD, shifting distance. <bold>b</bold> Spatial domains identified by Splane-single, STAGATE, SpaGCN, BayerSpace, and stLearn for the four slices. <bold>c</bold>–<bold>e</bold> Jaccard indexes (<bold>c</bold>), Adjusted Rand Indexes (<bold>d</bold>), and shifting distances (<bold>e</bold>) between cortical layers and corresponding spatial domains identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. The gray background represents for the methods for multiple slice analysis. Center line, median value; bar height, mean value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range for box plots, mean values ± 95% confidence intervals for bar plots; <italic>n</italic> = 12 slices. <bold>f</bold> Proportion of SVGs identified by the spatial-domain-identification methods when using fold-change &gt; 0.5 and <italic>P</italic>-value &lt; 0.01 (two-sided Wilcoxon rank-sum test) as cut-offs. The gray background represents the methods used for multiple slice analysis. SVGs, spatial variable genes; bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 5 methods for single analysis. <bold>g</bold> Receiver operating characteristic (ROC) curves of SVGs identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. Whiskers, standard errors; <italic>n</italic> = 12 slices. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig3_HTML" id="d32e686"/></fig></p>
      <p id="Par18">We then compared the performance of Splane against other state-of-the-art spatial-domain-identification methods, including methods designed for analyzing multiple ST slices such as STAligner, PRECAST and STACI, as well as methods that are designed for analyzing single ST slice such as STAGATE, SpaGCN, BayesSpace, and stLearn, using the same evaluation criteria (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). In analyzing all 12 ST slices of the DLPFC dataset, Splane exhibited the highest accuracy (average JI/median ARI = 0.61/0.61) and the lowest error (average SD = 53 μm), while other tools had JI/ARI and SD ranges of 0.41–0.56/0.36–0.54 and 75–548 μm (Fig. <xref rid="Fig3" ref-type="fig">3a–e</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>). Thus, Splane outperforms available alternative methods for spatial domain identification.</p>
      <p id="Par19">Spatial expression variation of genes can reflect the states, communications, and dynamics of cells, and therefore accurate identification of spatial variable genes (SVGs) from ST slices is crucial for determining the functions and phenotypes of cells in spatial domains. We thereby compared these methods for the task of identifying SVGs that represent specific cortical layers. We adopted the SVGs for cortical layers 1 ~ 6 and white matter (WM) annotated by the original study<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> as the ground truth, and evaluated the performance of each method by computing the overlap between the identified SVGs and the ground truth. Using a fold-change &gt; 0.5 and a <italic>P</italic>-value &lt; 0.01 as cut-offs for SVGs, we found that tools designed for analyzing multiple ST slices identified more SVGs compared to those designed for analyzing single ST slice. Splane, PRECAST, STAligner and STACI identified 1714, 1671, 1669 and 1527 out of 1917 SVGs of cortical layers 1 ~ 6 and WM, while the other examined methods identified only 179 ~ 1336 SVGs for each slice when the same cut-offs were applied (Fig. <xref rid="Fig3" ref-type="fig">3f</xref>). Similarly, using the receiver operating characteristic (ROC) curves as indicators for SVG prediction accuracy, we found that Splane, PRECAST and STAligner yielded the highest area under the curve value (AUC = 0.90, 0.89 and 0.88 respectively) among all examined methods (AUCs &lt; 0.83; Fig. <xref rid="Fig3" ref-type="fig">3g</xref>). These results emphasize the power of the Splane’s joint analysis scheme for identifying SVGs from multiple ST slices.</p>
      <p id="Par20">To assess the importance of the Spoint module in facilitating accurate spatial-domain identification using the Splane module, we conducted two comparative analyses on the human DFPLC datasets. First, we compared the performance of Splane using three different input types: highly variable gene expression matrix, PCA reduction of highly variable gene expression matrix, and cell-type proportions predicted by Spoint. Results showed that using only the cell-type proportion predicted by Spoint as input yielded spatial-domain identification results that closely resembled the ground truth, with significantly higher JI values in all 12 slices compared to the other input types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>). Second, we evaluated the performance of Splane using cell-type deconvolution results from other methods as input. Results demonstrated that using the cell-type proportions predicted by Spoint yielded the best spatial-domain identification outcome (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>). Notably, the identification of Layer4 was only possible when using the cell-type proportions predicted from Spoint as input.</p>
    </sec>
    <sec id="Sec6">
      <title>Splane identifies spatial domains from cancer slices</title>
      <p id="Par21">To test the performance of Splane in identifying spatial domains from disease slices, we applied Splane to jointly analyze 11 breast cancer 10X Visium slices from three experimental batches, including six slices reported in ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, four slices released by 10X Genomics<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>, and one slice from the study conducted in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. We first performed cell type deconvolution in each slice using Spoint and obtained the cell type identification (based on the expression of selected marker genes) and composition of each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>).</p>
      <p id="Par22">Subsequently, we applied Splane and identified ten spatial domains across the 11 slices (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). Notably, the extent of the batch effect between slices from different experiments was significantly reduced in Splane compared to that of the raw data and Splane without adversarial learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). We then explored the cell type composition of each predicted spatial domain and annotated these domains accordingly: domains D0-3, D4–6 and D7–9 were defined as tumor (tumor cell-enriched), intermediate (mixed cell types) and immune (immune cell-enriched) domains, respectively (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d</xref>, Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Joint analysis of 11 breast cancer ST slices from three different datasets.</title><p><bold>a</bold> Spatial domains identified by Splane in slice S2 and S5 from Wu et al. dataset, slice S10 from Zhao et al. dataset, and slice S11 released by 10X Genomics. <bold>b</bold>, <bold>c</bold> Spatial distribution of chromosome 1q&amp;8q copy number gains (<bold>b</bold>) and 1p copy number losses (<bold>c</bold>) of ST spots in slices S11, calculated by inferCNV. Dashed lines represent the tumor domain. <bold>d</bold>, <bold>e</bold> CNVs of chromosome 1q &amp; 8q (<bold>d</bold>) and chromosome 1p (<bold>e</bold>) in each spatial domain calculated by inferCNV. CNVs, copy number variations; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 11 slices. <bold>f</bold> From left to right: Splane predicted spatial domains in slice S5, distribution of Splane predicted immune domains D7/D8/D9, distribution of Spoint predicted immune cells, and distribution of H&amp;E staining marked immune spots. <bold>g</bold> Percentage of H&amp;E staining marked immune spots in each domain of slice S1, S2, S5, and S6. The four slices were H&amp;E stained in the original study. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 4 slices. <bold>h</bold> From left to right: Splane predicted spatial domains in slice S10, distribution of Splane predicted immune domains D7, D8, and D9, distribution of Spoint predicted immune cells, and distribution of CD3<sup>+</sup> immunofluorescence (IF) staining marked immune spots. <bold>i</bold> Percentage of CD3<sup>+</sup> IF staining marked immune spots in each domain of slice S10. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig4_HTML" id="d32e812"/></fig></p>
      <p id="Par23">We then applied two distinct approaches to assess the accuracy of the Splane predictions for the tumor and immune domains. Since tumor cells in breast cancer patients often bear chromosomal copy number variations (CNVs)—including chromosome 1q and 8q gains and/or chromosome 1p losses<sup><xref ref-type="bibr" rid="CR55">55</xref>,<xref ref-type="bibr" rid="CR56">56</xref></sup> —our first approach was to calculate the CNVs of each ST spot and check for enrichment of CNVs in the predicted tumor domains. Using inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>, we calculated the CNVs for all spots in all 11 ST slices from the expression matrix of the ST data. Taking slice 11 as an example, the four tumor domains predicted by Splane had copy number gains in chromosomes 1q and 8q (inferred CNV ≥ 0.2) as well as copy number losses for chromosome 1p (inferred CNV ≤ −0.2; Fig. <xref rid="Fig4" ref-type="fig">4b, c</xref>). In contrast, fewer or no copy number gains or losses were detected in the Splane-predicted intermediate or immune domains (inferred CNV = −0.2 ~ 0.2). Taking all 11 slices into account by the average CNV values, we also observed chromosome 1q and 8q gains (average CNV &gt; 0.2) and chromosome 1p losses (average CNV &lt; −0.2) in tumor domains, but less in intermediate and none in immune domains (Fig. <xref rid="Fig4" ref-type="fig">4d, e</xref>).</p>
      <p id="Par24">Our second approach was to calculate the percentage of experimentally annotated immune spots and check for enrichment of immune spots in spatial domains. We took the H&amp;E-staining-marked lymphocyte-enriched spots in slice S1, S2, S5, and S6 from ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and the CD3<sup>+</sup> immunofluorescence(IF)-marked T cell-enriched spots in slice S10 from ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup> as the ground truth for immune spots. We then calculated the percentage of immune spots in each of the Splane identified domains. We found higher percentages of H&amp;E-staining-marked immune spots in immune domains D9, D8, and D7 in slice S1, S2, S5, and S6 (44%, 8%, and 6%, respectively) than in the intermediate and tumor domains ( &lt; 1%) (Fig. <xref rid="Fig4" ref-type="fig">4f, g</xref>). Similarly, in slice S10, we found more CD3<sup>+</sup> IF-marked immune spots in immune domains D9, D8, and D7 (72%, 70%, and 63% respectively) than in intermediate and tumor domains ( &lt; 47%) (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref>). These results support Splane’s prediction of tumor and immune domains.</p>
      <p id="Par25">In the context of tumor systems, accurately identifying tumor boundaries is crucial for immuno-oncology research. We compared the ability of Splane and other multi-slice analysis algorithms, including STAligner, PRECAST, and STACI, to identify tumor boundaries. In the human breast cancer 10X Visium data, only Splane accurately identified tumor regions with distinct boundaries (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12a</xref>). The tumor regions predicted by Splane were consistent with CNV gains or losses in specific chromosomes, and they aligned well with evident tumor tissue regions in H&amp;E images. Furthermore, we observed a significant correlation between the proportion of tumor cells and CNV scores specifically in the spatial domains identified by Splane (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12b</xref>). These results highlight Splane’s ability to identify consistent tumor regions and boundaries across multiple slices in tumor systems.</p>
    </sec>
    <sec id="Sec7">
      <title>Scube constructs 3D architecture of tissue from consecutive 2D slices</title>
      <p id="Par26">Most current experimental ST techniques measure the distribution of transcripts in 2D space, yet tissues are obviously 3D, and functions of cells are distributed in space. We thereby developed the Scube module of SPACEL to construct and investigate the 3D architecture of a given tissue. We first employed a 3D STARmap dataset of the mouse brain from ref. <sup><xref ref-type="bibr" rid="CR58">58</xref></sup> (originally 1400 μm × 1700 μm × 100 μm) and divided it into ten slices of 10 μm thickness each as the ground truth (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). We randomly rotated, flipped, and cropped each slice to simulate a perturbed ST dataset comprising consecutive 2D slices (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, see Methods). We defined the percentage of a slice that was randomly cropped out as the crop ratio of that slice. At each level of crop ratio, we used Splane to identify the spatial domains across the ten slices, and applied Scube to align these slices by transforming their coordinate systems based on the Splane-identified spatial domains.<fig id="Fig5"><label>Fig. 5</label><caption><title>3D alignments of consecutive ST slices for the mouse brain.</title><p><bold>a</bold> The 3D STARmap dataset of the mouse brain. <bold>b</bold> Simulating an ST dataset with consecutive 2D slices by dividing the 3D STARmap dataset into ten 2D slices and randomly rotating/flipping/cropping each slice. <bold>c</bold> Alignment of the simulated dataset with crop ratio=0.25, generated by Scube, STAligner, and PASTE. Dashed lines represent the positions of the ground truths. SSIM, structural similarity index measure; PCC, Pearson’s correlation coefficient. <bold>d</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s results for simulated datasets with crop ratios from 0 to 0.25. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 10 slices. <bold>e</bold> Stacked 3D alignments constructed by Scube (left), STAligner (middle), and PASTE (right) from 33 MERFISH slices of mouse primary motor cortex. <bold>f</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s alignment results for the MERFISH dataset. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 33 slices. <bold>g</bold> Continuous expression distribution of the genes <italic>Cux2</italic>, <italic>Slc30a3</italic>, and <italic>Bcl11b</italic> on the surface of the 3D architecture of the mouse brain after applying the GPR model in Scube. BF, Bayes factor. <bold>h</bold> Continuous expression distribution of <italic>Cux2</italic> in the coronal plane of the 3D architecture of the mouse brain. BF, Bayes factor. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig5_HTML" id="d32e926"/></fig></p>
      <p id="Par27">We adopted SSIM and PCC as the metrics to assess the similarity between the transformed coordinate system and the ground truth for each slice. Higher SSIM and PCC values indicate better alignment. Recall that STAligner and PASTE are two state-of-the-art methods for constructing 3D alignments of tissue from consecutive ST slices<sup><xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, we compared the performance of Scube with STAligner and PASTE for aligning the simulated dataset under crop ratios from 0 to 0.25. Since the alignment results of STAligner and PASTE can be affected by their hyperparameters, we first performed a parameter optimization search to achieve the best alignment results of STAligner and PASTE (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13</xref>), before it was compared with Scube. With a crop ratio equal to 0.25, the average SSIM/PCC values of the Scube-transformed slices were 0.96/0.97, whereas the values for the STAligner-transformed slices were 0.76/0.77 and for the PASTE-transformed slices were 0.72/0.75. (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). With crop ratios range = 0.10, 0.15, 0.20, and 0.25, the average SSIM values of the Scube-transformed slices were 0.98, 0.98, 0.97 and 0.96, higher than those by STAligner ( = 0.79, 0.79, 0.72, and 0.76) or PASTE ( = 0.82, 0.77, 0.74, and 0.72; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Similarly, the average PCC values of the Scube-transformed slices were 0.99, 0.98, 0.98, and 0.97, which were also higher than those by STAligner ( = 0.80, 0.81, 0.73, and 0.77) or PASTE ( = 0.85, 0.79, 0.76, and 0.75; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), suggesting a better alignment in Scube for the simulated dataset.</p>
      <p id="Par28">To further compare the performance of Scube, STAligner and PASTE in constructing a 3D architecture on real ST dataset, we examined a mouse primary motor cortex (MOp) profile, which contains 33 consecutive 2D slices from the MERFISH experiment<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. We first applied Splane and identified seven spatial domains from the 33 consecutive 2D slices, which exhibited the highest accuracy in spatial domain identification (average JI/median ARI = 0.44/0.43) compared to STACI (average JI/median ARI = 0.43/0.38), STAligner (average JI/median ARI = 0.33/0.25) and PRECAST (average JI/median ARI = 0.23/0.16; Supplementary Fig. <xref rid="MOESM1" ref-type="media">14</xref>). We then used Scube to align these slices by transforming the coordinate systems of each pair of adjacent slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15a, b</xref>). Next, by stacking the transformed 2D slices together, we constructed a 3D architecture of MOp in Scube, enabling a 3D illustration of spatial domains and cell types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par29">In parallel, we applied STAligner and PASTE to perform an alignment and 3D construction from the same dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15</xref>). Since no ground truth is known in this case, we calculated the SSIM/PCC values between every two adjacent transformed slices to evaluate the alignment performance of the two methods, and found that the average SSIM/PCC values of the Scube-transformed slices were 0.71/0.76, significantly higher than those by STAligner (SSIM/PCC = 0.61/0.65) or PASTE (SSIM/PCC = 0.57/0.61; Fig. <xref rid="Fig5" ref-type="fig">5f</xref>). Notably, when stacking the 2D transformed slices using either STAligner or PASTE, we obtained a twisted 3D architecture of MOp (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par30">SPACEL also integrated a Gaussian process regression (GPR) model<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in Scube, which predicts the expression level of a gene at any position in the 3D architecture, enabling a continuous illustration of transcript distribution along any direction in space (Fig. <xref rid="Fig5" ref-type="fig">5g</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16a, b</xref>). By quantifying the Bayes Factor (BF, see Methods) of the GPR model, SPACEL is capable of identifying genes that vary significantly in any direction within the 3D space of tissue (Fig. <xref rid="Fig5" ref-type="fig">5h</xref>). SPACEL thereby allows users to explore the dynamics of transcript distributions from any direction, and hence reveals a real 3D structure of the spatial architecture of complex tissues or organs.</p>
      <p id="Par31">Accurate reconstruction of detailed 3D structures is crucial for unraveling biological phenomena in spatial omics data. In the mouse embryo Stereo-seq data<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Scube achieved better performance compared to STAligner and PASTE in accurately reconstructing and depicting structures like brain, liver and paws (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a, b</xref>). Furthermore, Scube (SSIM/PCC = 0.62/0.66) exhibited higher consistency in the distribution of tissue regions between slices compared to STAligner (0.57/0.61) and PASTE (0.24/0.25) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17c</xref>). In summary, the Scube module of SPACEL outperformed STAligner and PASTE in alignment and 3D architecture construction in both the simulated (STARmap) and real (MERFISH and Stereo-seq) datasets.</p>
    </sec>
    <sec id="Sec8">
      <title>SPACEL as an integrated toolkit for ST data processing and analysis</title>
      <p id="Par32">To highlight the integrated nature of SPACEL, we applied a fully integrated workflow to analyze mouse whole brain ST data<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>. The dataset consisted of 75 consecutive slices generated by Spatial Transcriptomics technology<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> with a spot resolution of 100 μm, covering a large portion of the mouse brain region. Using the original brain region annotations as the reference ground truth, we evaluated the performance of each module. In Spoint, the predicted distribution of major region-specific cell types matched well with the corresponding brain regions, such as excitatory neurons and hippocampus CA1 and CA3 cells predominantly predicted in the hippocampal region (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b</xref>). In Splane, we compared its performance against STAligner, PRECAST and STACI. The average JI/median ARI values of the spatial domains identified by Splane (0.42/0.56) were higher than those identified by STAligner (0.36/0.40), PRECAST (0.35/0.38) and STACI (0.31/0.40) across the 75 slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18c, d</xref>). In Scube, the 3D tissue reconstruction achieved by Scube (SSIM/PCC = 0.83/0.85) exhibited high coherence and accuracy, surpassing the results obtained by PASTE (0.82/0.84) and STAligner (0.79/0.81) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18e, f</xref>). These results clearly demonstrate that SPACEL serves as an effective integrated toolkit for analyzing multiple ST slices.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par33">In this study, we introduced a deep learning-based toolkit, SPACEL, comprising three modules: Spoint for cell type deconvolution, Splane for the identification of spatial domains across multiple ST slices, and Scube for the construction of 3D architecture from consecutive ST slices. We have demonstrated that the SPACEL modules outperform state-of-the-art methods for each of these tasks through analyses of 32 simulated and 11 real ST datasets acquired using five distinct ST technologies. While each module can be utilized separately, their synergistic interplay within the SPACEL platform offers an all-encompassing and streamlined solution for the best results of ST data interpretation, particularly accurate 3D tissue alignment, precise spatial domain identification, and effective batch effect removal.</p>
    <p id="Par34">Unlike the other state-of-the-art methods, the Splane module of SPACEL combines the cell type composition as input and adversarial training in the GCN model. Since the spatial distribution of genes, cells, and cell clusters from distinct ST experiments can be extremely heterogeneous, using cell type composition as input and introducing adversarial training to the GCN model significantly minimizes batch effects, leading to a more robust and efficient method for spatial domain identification. The joint analysis scheme that Splane incorporated is also particularly powerful to identify common features, and hence to accurately predict SVGs across multiple slices.</p>
    <p id="Par35">Spatial domains identified in Splane also set a foundation for Scube to achieve an accurate alignment of the consecutive slices and hence a precise 3D architecture construction. In contrast, the PASTE algorithm uses the raw expression matrix and spatial coordinates from the ST data as input for alignment, and a hyperparameter α to adjust the relative contributions of transcriptional dissimilarity and spatial distances among the aligned spots. This design makes PASTE’s alignment results sensitive to hyperparameters in datasets with significant defects (e.g., slices with crop ratios ≥ 0.25). On the other hand, STAligner constructs MNN based on the raw expression matrix to select landmark spots/cells and relies on user-defined landmark domains shared across slices for alignment. However, this approach does not utilize complete information on each spot of the whole slice, which limits its ability to balance global structure similarity and alignment accuracy, particularly in the case of partially overlapped slices. In contrast, Scube adopts a global optimization strategy for 3D alignment, taking into account the correspondences between all spots in adjacent slices. This innovative method enables Scube to achieve more precise alignment, preserving the overall structural integrity in the process of spatial alignment.</p>
    <p id="Par36">To enhance the accessibility of the GPR model for 3D spatial transcriptomics, we have developed a user-friendly Python code by integrating the original MATLAB code and third-party GUI software. This integration enables researchers to easily access and utilize the model, fostering advancements in the field and promoting broader adoption of this technology within the scientific community. There are opportunities to improve the performance of SPACEL and extend its application. For example, Splane uses cell type composition information as input for the model; this means that to process seq-based ST datasets such as 10X Visium, one has to employ a cell type deconvolution algorithm such as Spoint to obtain the cell type composition information before Splane can be applied. Besides, the current version of Scube does not support nonlinear alignment as well as STAligner and PASTE. Although there are several tools that can nonlinearly align image data by setting anchor points manually, to our knowledge there is no method yet to do it automatically for ST data analysis. We acknowledge this limitation and plan to address this issue in a future version of Scube. Another issue for SPACEL is that when a new slice is added to the dataset, the entire deep learning model needs to be retrained from scratch, which may affect the computational efficiency of SPACEL to analyze large-scale datasets. We anticipate that transfer learning models and algorithms (e.g., ImageNet<sup><xref ref-type="bibr" rid="CR61">61</xref></sup> and BERT<sup><xref ref-type="bibr" rid="CR62">62</xref></sup>), which have been used in bioinformatics tasks such as cell type classification for large-scale single-cell data<sup><xref ref-type="bibr" rid="CR63">63</xref>–<xref ref-type="bibr" rid="CR66">66</xref></sup>, can help us to overcome this limitation.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Construction of simulated ST data from scRNA-seq data</title>
      <p id="Par37">To establish training sets for Spoint and other deconvolution methods, we employed cells from a scRNA-seq dataset to simulate pseudo-spots, where the cell type composition of each pseudo-spot can be ascertained from its constituent cells. Specifically, assuming that the number of cells at each spot (<inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq1.gif"/></alternatives></inline-formula>) follows a normal distribution <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{c},{\delta }_{c})$$\end{document}</tex-math><mml:math id="M4"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq2.gif"/></alternatives></inline-formula>, and the number of cell types at each spot (<italic>N</italic><sub><italic>t</italic></sub>) follows a normal distribution <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{t},{\delta }_{t})$$\end{document}</tex-math><mml:math id="M6"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq3.gif"/></alternatives></inline-formula>, we set the default parameters as <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{c}=10,{\delta }_{c}=5,{\mu }_{t}={\mu }_{c}/2,{\delta }_{t}={\delta }_{c}/2$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq4.gif"/></alternatives></inline-formula>. Researchers can also detect <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq5.gif"/></alternatives></inline-formula> from the image of an ST slice using stardist<sup><xref ref-type="bibr" rid="CR67">67</xref></sup> or DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup>, and use it as the input parameter. We first generated <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{t}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq6.gif"/></alternatives></inline-formula> for each sampled spot, and then sampled cells from the scRNA-seq data associated with each spot. Each cell was sampled based on its sampling probability which is determined by <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq7.gif"/></alternatives></inline-formula>. <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq8.gif"/></alternatives></inline-formula> for each spot is defined as:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}=\left\{\begin{array}{c}{f}_{t}\,{if}\, 0 \, &lt; \, {r}_{c} \, &lt; \, \frac{1}{3}\hfill\\ \frac{1/{f}_{t}}{\mathop{\sum}\limits_{t}\left(1/{f}_{t}\right)}\,{if}\,\frac{1}{3}\le {r}_{c} &lt; \frac{2}{3}\hfill\hfill\\ \frac{\sqrt{{f}_{t}}}{\mathop{\sum}\limits_{t}\left(\sqrt{{f}_{t}}\right)}\,{if}\,\frac{2}{3}\le {r}_{c} &lt; 1\end{array}\right.$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced open="{"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq9"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{t}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq9.gif"/></alternatives></inline-formula> is the composition of each cell type in the scRNA-seq data, and <inline-formula id="IEq10"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${r}_{c}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq10.gif"/></alternatives></inline-formula> is a random value between 0 and 1. We then randomly sampled cells of each cell type from the scRNA-seq data, and combined the gene expression of <inline-formula id="IEq11"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq11.gif"/></alternatives></inline-formula> sampled cells to generate an original spot. During the cell sampling process, we calculated the cell type numbers of these sampled cells. These cell type numbers serve as the cell type labels for the spot. We then estimated the mean value <inline-formula id="IEq12"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }^{L}$$\end{document}</tex-math><mml:math id="M26"><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq12.gif"/></alternatives></inline-formula> and standard deviation <inline-formula id="IEq13"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }^{L}$$\end{document}</tex-math><mml:math id="M28"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq13.gif"/></alternatives></inline-formula> of gene expression for each spot from a real ST data, and down-sampled the original spot using the downsampleMatrix function of the Scuttle package<sup><xref ref-type="bibr" rid="CR69">69</xref></sup> to obtain a simulated spot that has gene expression distribution similar to that of the real ST data.</p>
    </sec>
    <sec id="Sec12">
      <title>Deconvolution model of Spoint</title>
      <p id="Par38">Spoint contains three deep learning models. The first model is a variational autoencoder (VAE) model, consisting of an encoder layer, a decoder layer, and three hidden layers. The three hidden layers contain 128, 64, and 128 nodes, respectively. The input variables of the encoder and decoder layers are gene expression levels at each spot, <inline-formula id="IEq14"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M30"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq14.gif"/></alternatives></inline-formula>, so the dimension of these two layers is equal to the number of detected genes. We inputted the expression matrices of the simulated ST data <inline-formula id="IEq15"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \}$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq15.gif"/></alternatives></inline-formula> and the real ST data <inline-formula id="IEq16"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }\}$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq16.gif"/></alternatives></inline-formula> into the VAE model, and used the latent variables of the middle hidden layer as the output results, <inline-formula id="IEq17"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\prime}$$\end{document}</tex-math><mml:math id="M36"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq17.gif"/></alternatives></inline-formula> and <inline-formula id="IEq18"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M38"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq18.gif"/></alternatives></inline-formula>. Note that the simulated ST dataset should be constructed from a single-cell dataset obtained from the same type of tissue as the real ST dataset.</p>
      <p id="Par39">The second model <inline-formula id="IEq19"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M40"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq19.gif"/></alternatives></inline-formula> consists of an input layer that accepts the latent variable <inline-formula id="IEq20"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M42"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq20.gif"/></alternatives></inline-formula> of the VAE model, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer that outputs the proportion of each cell type in the spot with Softmax activation function. We adopted the maximum mean discrepancy (MMD) distance between the variable of model <inline-formula id="IEq21"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M44"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq21.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data as the objective function, as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}={{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\big({E}_{2}\big(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\big),\, {E}_{2}\big({\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }}^{{\prime} }\big)\big)$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\left(U,\, V\right)=	 \frac{1}{{n}^{2}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{{i}^{{\prime} }}^{n}k\left({u}_{i},\,{{u}^{{\prime} }}_{i}\right)-\frac{2}{{nm}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{m}k\left({u}_{i},\, {v}_{i}\right) \\ 	+\frac{1}{{m}^{2}}\mathop{\sum }\limits_{j}^{m}\mathop{\sum }\limits_{{j}^{{\prime} }}^{m}k\left({v}_{i},\,{{v}^{{\prime} }}_{i}\right)$$\end{document}</tex-math><mml:math id="M48"><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>V</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k\left(u,\, v\right)={e}^{\frac{-{\left|u-v\right|}^{2}}{\sigma }}$$\end{document}</tex-math><mml:math id="M50"><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>v</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime}$$\end{document}</tex-math><mml:math id="M52"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq22.gif"/></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M54"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq23.gif"/></alternatives></inline-formula> are the latent variables of the simulated ST data and real ST data, respectively, generated by the VAE model, and <inline-formula id="IEq24"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><mml:math id="M56"><mml:mi>σ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq24.gif"/></alternatives></inline-formula> represents the dimension of the hidden layer. The third model <inline-formula id="IEq25"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M58"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq25.gif"/></alternatives></inline-formula> consists of an input layer that accepts the output of model <inline-formula id="IEq26"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M60"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq26.gif"/></alternatives></inline-formula>, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer is represents the recovery of latent variable <inline-formula id="IEq27"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M62"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq27.gif"/></alternatives></inline-formula> of the VAE model. Then, we used the following objective function to constrain the outputs of the model <inline-formula id="IEq28"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M64"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq28.gif"/></alternatives></inline-formula> and the ground truth cell-type proportion of simulated ST data:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}={{{{{\rm{Cosine}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>and constrain the similarity between the outputs of the model <inline-formula id="IEq29"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M68"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq29.gif"/></alternatives></inline-formula> and the latent variable <inline-formula id="IEq30"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M70"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq30.gif"/></alternatives></inline-formula> of the simulated ST data and the real ST dataset:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}={{{{{\rm{Cosine}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cosine}}}}}}\left(a,\, {a}^{{\prime} }\right)=\frac{\sum a\times {a}^{{\prime} }}{\sqrt{\sum {a}^{2}}\times \sqrt{\sum {{a}^{{\prime} }}^{2}}}$$\end{document}</tex-math><mml:math id="M74"><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt><mml:mo>×</mml:mo><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overline{{{{{{\rm{KL}}}}}}}\left(a,\,{a}^{{\prime} }\right)=\sum a\times \log \frac{a}{{a}^{{\prime} }}\mathop{{{{{{\rm{Min}}}}}}}\limits_{a}{{{{{\rm{Cosine}}}}}}\left(a,\,{a}^{{\prime} }\right)+{{{{{\rm{KL}}}}}}\left(a,\,{a}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M76"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo accent="true">¯</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mi mathvariant="normal">Min</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:munder><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq31"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M78"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq31.gif"/></alternatives></inline-formula> is the ground truth cell-type proportion of simulated ST data, the <inline-formula id="IEq32"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M80"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq32.gif"/></alternatives></inline-formula> is the outputs of model <inline-formula id="IEq33"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M82"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq33.gif"/></alternatives></inline-formula> for the real and simulated ST data, <inline-formula id="IEq34"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}(a,a{\prime} )$$\end{document}</tex-math><mml:math id="M84"><mml:mi mathvariant="normal">KL</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq34.gif"/></alternatives></inline-formula> is the Kullback-Leibler Divergence<sup><xref ref-type="bibr" rid="CR71">71</xref></sup>.</p>
      <p id="Par40">The weight of the model is initialized using the He initialization method<sup><xref ref-type="bibr" rid="CR72">72</xref></sup>. The training of Spoint contains the following steps: 1) We calculated <inline-formula id="IEq35"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq35.gif"/></alternatives></inline-formula> using <inline-formula id="IEq36"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M88"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq36.gif"/></alternatives></inline-formula> predicted from the simulated ST data and ground truth cell-type proportion <inline-formula id="IEq37"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M90"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq37.gif"/></alternatives></inline-formula>, then adopted the Adam optimization algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup> to obtain optimal parameters for model <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M92"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq38.gif"/></alternatives></inline-formula>. 2) We calculated <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}$$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq39.gif"/></alternatives></inline-formula> using <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M96"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq40.gif"/></alternatives></inline-formula> from the real and simulated ST data and latent variable <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M98"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq41.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq42.gif"/></alternatives></inline-formula> using <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq43.gif"/></alternatives></inline-formula> and <inline-formula id="IEq44"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M104"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq44.gif"/></alternatives></inline-formula> from the variable of model <inline-formula id="IEq45"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M106"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq45.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data, then updated the parameters of model <inline-formula id="IEq46"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M108"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq46.gif"/></alternatives></inline-formula> and model <inline-formula id="IEq47"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M110"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq47.gif"/></alternatives></inline-formula> using the Adam optimization algorithm. 3) We repeated steps 1) and 2) iteratively to update the parameters of models <inline-formula id="IEq48"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M112"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq48.gif"/></alternatives></inline-formula> and <inline-formula id="IEq49"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M114"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq49.gif"/></alternatives></inline-formula> until the <inline-formula id="IEq50"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M116"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq50.gif"/></alternatives></inline-formula> of two adjacent training epochs reached a convergence value, i.e., <inline-formula id="IEq51"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\Delta {{{{{\rm{Loss}}}}}}}_{Q} &lt; 0.001$$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0.001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq51.gif"/></alternatives></inline-formula>. After the training of Spoint, the values <inline-formula id="IEq52"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M120"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq52.gif"/></alternatives></inline-formula> at the final convergence epoch were used to predict the cell type composition of the real spatial data.</p>
    </sec>
    <sec id="Sec13">
      <title>Graph convolutional network of Splane</title>
      <p id="Par41">In Splane, we first used the spatial coordinates of spots/cells as inputs to construct an undirected graph. In the graph, each node represents a spot/cell, and an edge connects two spots/cells that are physically adjacent in space. The graph structure is stored in an <inline-formula id="IEq53"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N\times N$$\end{document}</tex-math><mml:math id="M122"><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq53.gif"/></alternatives></inline-formula> adjacency matrix <inline-formula id="IEq54"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M124"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq54.gif"/></alternatives></inline-formula>, in which <inline-formula id="IEq55"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M126"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq55.gif"/></alternatives></inline-formula> is the number of spots/cells, and <inline-formula id="IEq56"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=1$$\end{document}</tex-math><mml:math id="M128"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq56.gif"/></alternatives></inline-formula> if spot/cell <inline-formula id="IEq57"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v$$\end{document}</tex-math><mml:math id="M130"><mml:mi>v</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq57.gif"/></alternatives></inline-formula> belongs to the k nearest neighbors of spot/cell <inline-formula id="IEq58"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u$$\end{document}</tex-math><mml:math id="M132"><mml:mi>u</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq58.gif"/></alternatives></inline-formula>, otherwise <inline-formula id="IEq59"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=0$$\end{document}</tex-math><mml:math id="M134"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq59.gif"/></alternatives></inline-formula>. For single-cell resolution ST data, such as MERFISH and STARmap, we set the default value of <italic>k</italic> = 25; but for 10X Visium data, we set the default value of <italic>k</italic> = 6, since each spot in the 10X Visium data is surrounded by 6 spots, and approximately 50–100 cells are contained in the 6 neighbor spots when <italic>k</italic> = 6.</p>
      <p id="Par42">Then, we used the cell type composition of spots/cells <inline-formula id="IEq60"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q$$\end{document}</tex-math><mml:math id="M136"><mml:mi>Q</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq60.gif"/></alternatives></inline-formula> and the adjacency matrix <inline-formula id="IEq61"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M138"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq61.gif"/></alternatives></inline-formula> to construct a graph convolutional network (GCN) model <inline-formula id="IEq62"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M140"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq62.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{l+1}\left(Q\right)=f\left({H}_{l}\left(Q\right),\, A\right)$$\end{document}</tex-math><mml:math id="M142"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq63"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M144"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq63.gif"/></alternatives></inline-formula> is the index of the layer, so <inline-formula id="IEq64"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M146"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq64.gif"/></alternatives></inline-formula> is the input layer. We used the cell type composition of each spot/cell as the input layer for this model. According to Kipf and Welling’s study<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, the propagation rule in GCN can be written as<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left({H}_{l},\, A\right)={{{{{\rm{ReLU}}}}}}\left({\widehat{D}}^{-\frac{1}{2}}\hat{A}{\widehat{D}}^{-\frac{1}{2}}{H}_{l}{W}_{l}\right)$$\end{document}</tex-math><mml:math id="M148"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ReLU</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{A}=A+I$$\end{document}</tex-math><mml:math id="M150"><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>+</mml:mo><mml:mi>I</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq65"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I$$\end{document}</tex-math><mml:math id="M152"><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq65.gif"/></alternatives></inline-formula> is an identity matrix, <inline-formula id="IEq66"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{D}$$\end{document}</tex-math><mml:math id="M154"><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq66.gif"/></alternatives></inline-formula> is the diagonal matrix of <inline-formula id="IEq67"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M156"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq67.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq68"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${W}_{l}$$\end{document}</tex-math><mml:math id="M158"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq68.gif"/></alternatives></inline-formula> is the weight matrix of the <inline-formula id="IEq69"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}^{{th}}$$\end{document}</tex-math><mml:math id="M160"><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq69.gif"/></alternatives></inline-formula> layer. We used a Chebyshev polynomial filter to estimate the convolution kernel of the GCN model<sup><xref ref-type="bibr" rid="CR74">74</xref></sup>. In this process, a signal <inline-formula id="IEq70"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x$$\end{document}</tex-math><mml:math id="M162"><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq70.gif"/></alternatives></inline-formula> is filtered by <inline-formula id="IEq71"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }$$\end{document}</tex-math><mml:math id="M164"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq71.gif"/></alternatives></inline-formula> as<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }\left(L\right)x={g}_{\theta }\left(U\Lambda {U}^{T}\right)x=U{g}_{\theta }\left(\Lambda \right){U}^{T}x$$\end{document}</tex-math><mml:math id="M166"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">Λ</mml:mi></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mi>x</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>where Laplacian matrix <inline-formula id="IEq72"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M168"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq72.gif"/></alternatives></inline-formula> of the graph is given by <inline-formula id="IEq73"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=I-{D}^{-\frac{1}{2}}A{D}^{-\frac{1}{2}}$$\end{document}</tex-math><mml:math id="M170"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mi>A</mml:mi><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq73.gif"/></alternatives></inline-formula>. The Laplacian matrix <inline-formula id="IEq74"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M172"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq74.gif"/></alternatives></inline-formula> is real symmetric positive semidefinite matrix. It possesses a complete set of orthonormal eigenvectors <inline-formula id="IEq75"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{u}_{l}\}}_{l=0}^{n-1}\in {R}^{n}$$\end{document}</tex-math><mml:math id="M174"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq75.gif"/></alternatives></inline-formula>, which are referred to as the graph Fourier modes. These eigenvectors are associated with ordered real nonnegative eigenvalues <inline-formula id="IEq76"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{\lambda }_{l}\}}_{l=0}^{n-1}$$\end{document}</tex-math><mml:math id="M176"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq76.gif"/></alternatives></inline-formula>, and they correspond to the frequencies of the graph. The Fourier basis <inline-formula id="IEq77"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U=\left[{u}_{0},...,{u}_{n-1}\right]\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M178"><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq77.gif"/></alternatives></inline-formula> diagonalizes the Laplacian matrix <inline-formula id="IEq78"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M180"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq78.gif"/></alternatives></inline-formula>, such that <inline-formula id="IEq79"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=U\Lambda {U}^{T}$$\end{document}</tex-math><mml:math id="M182"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq79.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq80"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varLambda={{{{{\rm{diag}}}}}}\left(\left[{\lambda }_{0},...,{\lambda }_{n-1}\right]\right)\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M184"><mml:mi>Λ</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">diag</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq80.gif"/></alternatives></inline-formula>.</p>
      <p id="Par43">The Chebyshev polynomial filter can be expressed as<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }\left(\varLambda \right)=\mathop{\sum }\limits_{k=0}^{K-1}{\theta }_{k}{T}_{k}\left(\widetilde{\varLambda }\right)$$\end{document}</tex-math><mml:math id="M186"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>where the parameter <inline-formula id="IEq81"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta \in {R}^{K}$$\end{document}</tex-math><mml:math id="M188"><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq81.gif"/></alternatives></inline-formula> is a vector of Chebyshev coefficients and <inline-formula id="IEq82"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{\varLambda })\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M190"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq82.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order <inline-formula id="IEq83"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M192"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq83.gif"/></alternatives></inline-formula> evaluated at <inline-formula id="IEq84"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{\varLambda }=2\varLambda /{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M194"><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>Λ</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq84.gif"/></alternatives></inline-formula>, a diagonal matrix of scaled eigenvalues that lie in <inline-formula id="IEq85"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$[-{{{{\mathrm{1,\,1}}}}}]$$\end{document}</tex-math><mml:math id="M196"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="normal">1, 1</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq85.gif"/></alternatives></inline-formula>. Consequently, the filtering operation can be written as <inline-formula id="IEq86"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }(L)x=\mathop{\sum }\nolimits_{k=0}^{K-1}{\theta }_{k}{T}_{k}(\widetilde{L})x$$\end{document}</tex-math><mml:math id="M198"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq86.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq87"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{L})\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M200"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq87.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order k evaluated at the scaled Laplacian <inline-formula id="IEq88"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{L}=2L/{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M202"><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq88.gif"/></alternatives></inline-formula>. Denoting <inline-formula id="IEq89"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}={T}_{k}(\widetilde{L})x\in {R}^{n}$$\end{document}</tex-math><mml:math id="M204"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq89.gif"/></alternatives></inline-formula>, we can use the recurrence relation to compute <inline-formula id="IEq90"><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}=2\widetilde{L}{\bar{x}}_{k-1}-{\bar{x}}_{k-2}$$\end{document}</tex-math><mml:math id="M206"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq90.gif"/></alternatives></inline-formula> iteratively with <inline-formula id="IEq91"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{0}=x$$\end{document}</tex-math><mml:math id="M208"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq91.gif"/></alternatives></inline-formula> and <inline-formula id="IEq92"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{1}=\widetilde{L}x$$\end{document}</tex-math><mml:math id="M210"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq92.gif"/></alternatives></inline-formula> as the initial values. The order of the polynomial <inline-formula id="IEq93"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M212"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq93.gif"/></alternatives></inline-formula>, controls the receptive field of the convolution kernel and is related to the parameter <inline-formula id="IEq94"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M214"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq94.gif"/></alternatives></inline-formula> in the Chebyshev polynomial <inline-formula id="IEq95"><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}$$\end{document}</tex-math><mml:math id="M216"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq95.gif"/></alternatives></inline-formula>. We set the default <inline-formula id="IEq96"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M218"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq96.gif"/></alternatives></inline-formula> equal to 2 to ensure that the GCN model contains the information of the first order neighbors and second order neighbors (i.e., neighbors of neighbors) of each spot.</p>
      <p id="Par44">The GCN model of Splane consists of 5 layers, i.e. <inline-formula id="IEq97"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0} \sim {H}_{4}$$\end{document}</tex-math><mml:math id="M220"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq97.gif"/></alternatives></inline-formula>, where the first layer <inline-formula id="IEq98"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M222"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq98.gif"/></alternatives></inline-formula> and the last layer <inline-formula id="IEq99"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M224"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq99.gif"/></alternatives></inline-formula> both contain the cell type composition of each spot/cell, and the middle layer <inline-formula id="IEq100"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M226"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq100.gif"/></alternatives></inline-formula> is used to cluster spots/cells and identify spatial domains. In Splane we embedded a cosine function <inline-formula id="IEq101"><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M228"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq101.gif"/></alternatives></inline-formula> to minimize the difference between <inline-formula id="IEq102"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M230"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq102.gif"/></alternatives></inline-formula> and <inline-formula id="IEq103"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M232"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq103.gif"/></alternatives></inline-formula>, i.e.<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}={{{{{\rm{Cos}}}}}}{{{{{\rm{ine}}}}}}\left[{H}_{0}\left(Q\right),\,{H}_{4}\left(Q\right)\right]$$\end{document}</tex-math><mml:math id="M234"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cos</mml:mi><mml:mi mathvariant="normal">ine</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>and we used another objective function <inline-formula id="IEq104"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M236"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq104.gif"/></alternatives></inline-formula> to minimize the difference between the <inline-formula id="IEq105"><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M238"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq105.gif"/></alternatives></inline-formula> values of a spot and its neighbors, as<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}=\left|{H}_{2}\left({q}_{i}\right)-\frac{1}{n}\sum {H}_{2}\left({q}_{i}^{{{{{{\rm{neigh}}}}}}}\right)\right|$$\end{document}</tex-math><mml:math id="M240"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo mathsize="big">∑</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq106"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}$$\end{document}</tex-math><mml:math id="M242"><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq106.gif"/></alternatives></inline-formula> and <inline-formula id="IEq107"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}^{{{{{{\rm{neigh}}}}}}}$$\end{document}</tex-math><mml:math id="M244"><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq107.gif"/></alternatives></inline-formula> are the cell type composition of spot/cell <inline-formula id="IEq108"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M246"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq108.gif"/></alternatives></inline-formula> and its neighbors respectively, and <inline-formula id="IEq109"><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M248"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq109.gif"/></alternatives></inline-formula> is the number of neighbors.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial learning for multiple slices</title>
      <p id="Par45">In Splane, we used a discriminator model <inline-formula id="IEq110"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M250"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq110.gif"/></alternatives></inline-formula> containing four layers to conclude uniform features from multiple slices. The input layer of model <inline-formula id="IEq111"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M252"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq111.gif"/></alternatives></inline-formula> is the output latent variables of spot/cell <inline-formula id="IEq112"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M254"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq112.gif"/></alternatives></inline-formula> from model <inline-formula id="IEq113"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M256"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq113.gif"/></alternatives></inline-formula>, i.e., <inline-formula id="IEq114"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}({q}_{i})$$\end{document}</tex-math><mml:math id="M258"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq114.gif"/></alternatives></inline-formula>; the output layer contains the probability <inline-formula id="IEq115"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{i,s}$$\end{document}</tex-math><mml:math id="M260"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq115.gif"/></alternatives></inline-formula> of spot/cell <inline-formula id="IEq116"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M262"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq116.gif"/></alternatives></inline-formula> belonging to slice <inline-formula id="IEq117"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M264"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq117.gif"/></alternatives></inline-formula>; and the two hidden layers are 64 nodes fully-connect layers. We defined the objective function of model <inline-formula id="IEq118"><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M266"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq118.gif"/></alternatives></inline-formula> as<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}=\frac{1}{{N}_{s}}\mathop{\sum}\limits_{s}{y}_{i,s}\log \left({p}_{i,s}\right)$$\end{document}</tex-math><mml:math id="M268"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq119"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{s}$$\end{document}</tex-math><mml:math id="M270"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq119.gif"/></alternatives></inline-formula> is the number of slices and <inline-formula id="IEq120"><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i,s}$$\end{document}</tex-math><mml:math id="M272"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq120.gif"/></alternatives></inline-formula> is the slice label of spot/cell <inline-formula id="IEq121"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M274"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq121.gif"/></alternatives></inline-formula>. The <inline-formula id="IEq122"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M276"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq122.gif"/></alternatives></inline-formula> is minimized when the embeddings for different sections are maximally different, allowing the discriminator to correctly predict the labels of the slices. As shown in the next section, we trained GCN model with spots/cells from multiple ST slices, optimizing it to achieve a maximum <inline-formula id="IEq123"><alternatives><tex-math id="M277">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M278"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq123.gif"/></alternatives></inline-formula>, ensuring that the latent variables of spots/cells from different slices would have the highest similarity.</p>
    </sec>
    <sec id="Sec15">
      <title>Clustering of spots/cells with latent features</title>
      <p id="Par46">The total objective function of Splane is a combination of the objective function of the GCN model and the objective function of the discriminator <inline-formula id="IEq124"><alternatives><tex-math id="M279">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M280"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq124.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M281">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}={{\alpha }_{C}{{{{{\rm{Loss}}}}}}}_{C}+{{\alpha }_{S}{{{{{\rm{Loss}}}}}}}_{S}-{{\alpha }_{D}{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M282"><mml:mi mathvariant="normal">Loss</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq125"><alternatives><tex-math id="M283">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{C}$$\end{document}</tex-math><mml:math id="M284"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq125.gif"/></alternatives></inline-formula>, <inline-formula id="IEq126"><alternatives><tex-math id="M285">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{S}$$\end{document}</tex-math><mml:math id="M286"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq126.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq127"><alternatives><tex-math id="M287">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{D}$$\end{document}</tex-math><mml:math id="M288"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq127.gif"/></alternatives></inline-formula> are the weights of <inline-formula id="IEq128"><alternatives><tex-math id="M289">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M290"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq128.gif"/></alternatives></inline-formula>, <inline-formula id="IEq129"><alternatives><tex-math id="M291">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M292"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq129.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq130"><alternatives><tex-math id="M293">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M294"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq130.gif"/></alternatives></inline-formula>, and their default values are 1, 1, and 0.5, respectively. The weight of the model is initialized using the Xavier initialization method<sup><xref ref-type="bibr" rid="CR75">75</xref></sup>. We used the RMSProp optimization algorithm to minimize the total objective function. Meanwhile, we clustered spots/cells using the output latent variables (termed shared latent features) of the GCN model (i.e. <inline-formula id="IEq131"><alternatives><tex-math id="M295">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}(Q)$$\end{document}</tex-math><mml:math id="M296"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq131.gif"/></alternatives></inline-formula>) and the K-mean algorithm, and we evaluated the clarity of the clustering result using the Davies-Bouldin score (DBS) implemented by scikit-learn package<sup><xref ref-type="bibr" rid="CR76">76</xref>,<xref ref-type="bibr" rid="CR77">77</xref></sup>. We trained the entire model until both <inline-formula id="IEq132"><alternatives><tex-math id="M297">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}$$\end{document}</tex-math><mml:math id="M298"><mml:mi mathvariant="normal">Loss</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq132.gif"/></alternatives></inline-formula> and DBS within two adjacent training epochs reached convergent values, i.e., <inline-formula id="IEq133"><alternatives><tex-math id="M299">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{Loss}}}}}} \, &lt; \, 0.0001$$\end{document}</tex-math><mml:math id="M300"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0.0001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq133.gif"/></alternatives></inline-formula> and <inline-formula id="IEq134"><alternatives><tex-math id="M301">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{DBS}}}}}} \, &lt; \, 0$$\end{document}</tex-math><mml:math id="M302"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">DBS</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq134.gif"/></alternatives></inline-formula>. After the model converged, we adopted the spot/cell clusters obtained by Splane in the last epoch as spatial domains. As the shared latent features of the GCN model contain gene expression and spatial coordinate information of cells/spots, each spatial domain represents a batch of cells/spots that have common ground in both the transcriptome and space.</p>
    </sec>
    <sec id="Sec16">
      <title>Alignment of consecutive ST slices using Scube</title>
      <p id="Par47">In Scube, we first built a nearest neighbor graph between the cells/spots of two adjacent slices based on the coordinate of spots. As an initialization step for optimization algorithms, Scube aligns all slices by translating them so that their center points coincide with the coordinates <inline-formula id="IEq135"><alternatives><tex-math id="M303">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({{{{\mathrm{0,0}}}}})$$\end{document}</tex-math><mml:math id="M304"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">0, 0</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq135.gif"/></alternatives></inline-formula>. Then, we used the spatial domain information for each pair of nearest neighbor spots to construct an alignment objective function of two adjacent slices. We employed a differential evolution optimization to search for the optimal translation vectors and rotation angles, and transformed the coordinates of every slice accordingly. During each iteration of the global optimization process, Scube utilizes the adjusted coordinate information of spots to identify the nearest neighbors between two adjacent slices. By adjusting the coordinates of spots in the source slice, Scube aims to align the source slice to the target slice, ultimately maximizing the alignment objective function value. Finally, in Scube we performed all of the aforementioned steps for all adjacent slices, and used the transformed coordinates to stack these slices and construct the 3D alignment of the tissue.</p>
      <p id="Par48">Specifically, we used rigid body transformations (including mirroring, rotation, and translation) to transfer a slice <inline-formula id="IEq136"><alternatives><tex-math id="M305">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M306"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq136.gif"/></alternatives></inline-formula> as<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M307">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }={RM}{S}_{j}+T$$\end{document}</tex-math><mml:math id="M308"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>T</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M309">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R=\left(\begin{array}{cc}\cos {\theta }_{j} &amp; -\sin {\theta }_{j}\\ \sin {\theta }_{j} &amp; \cos {\theta }_{j}\end{array}\right)$$\end{document}</tex-math><mml:math id="M310"><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>−</mml:mo><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M311">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M=\left(\begin{array}{cc}{{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j} &amp; 0\\ 0 &amp; 1\end{array}\right)$$\end{document}</tex-math><mml:math id="M312"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="center"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M313">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T=\left(\begin{array}{ccc}\Delta {x}_{1} &amp; \ldots &amp; \Delta {x}_{{n}_{j}}\\ \Delta {y}_{1} &amp; \ldots &amp; {\Delta y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M314"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq137"><alternatives><tex-math id="M315">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}\mathop{=}\limits^{{{{{\mathrm{def}}}}}}\left(\begin{array}{ccc}{x}_{1} &amp; \ldots &amp; {x}_{{n}_{j}}\\ {y}_{1} &amp; \ldots &amp; {y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M316"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq137.gif"/></alternatives></inline-formula> is the coordinate matrix of slice <inline-formula id="IEq138"><alternatives><tex-math id="M317">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M318"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq138.gif"/></alternatives></inline-formula>, <inline-formula id="IEq139"><alternatives><tex-math id="M319">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M320"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq139.gif"/></alternatives></inline-formula> is the coordinate matrix after rigid body transformation, and <inline-formula id="IEq140"><alternatives><tex-math id="M321">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M322"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq140.gif"/></alternatives></inline-formula> is the number of spots in slice <inline-formula id="IEq141"><alternatives><tex-math id="M323">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M324"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq141.gif"/></alternatives></inline-formula>; <inline-formula id="IEq142"><alternatives><tex-math id="M325">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M326"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq142.gif"/></alternatives></inline-formula> is the rotation matrix, <inline-formula id="IEq143"><alternatives><tex-math id="M327">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }_{j}$$\end{document}</tex-math><mml:math id="M328"><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq143.gif"/></alternatives></inline-formula> is the rotation angle of slice <inline-formula id="IEq144"><alternatives><tex-math id="M329">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M330"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq144.gif"/></alternatives></inline-formula>; <inline-formula id="IEq145"><alternatives><tex-math id="M331">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M$$\end{document}</tex-math><mml:math id="M332"><mml:mi>M</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq145.gif"/></alternatives></inline-formula> is the mirroring matrix, <inline-formula id="IEq146"><alternatives><tex-math id="M333">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=-1$$\end{document}</tex-math><mml:math id="M334"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq146.gif"/></alternatives></inline-formula> represents the mirror operation of slice <inline-formula id="IEq147"><alternatives><tex-math id="M335">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M336"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq147.gif"/></alternatives></inline-formula>, elsewise <inline-formula id="IEq148"><alternatives><tex-math id="M337">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=1$$\end{document}</tex-math><mml:math id="M338"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq148.gif"/></alternatives></inline-formula>; <inline-formula id="IEq149"><alternatives><tex-math id="M339">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T$$\end{document}</tex-math><mml:math id="M340"><mml:mi>T</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq149.gif"/></alternatives></inline-formula> is the translation matrix. We defined <inline-formula id="IEq150"><alternatives><tex-math id="M341">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${O}_{j}$$\end{document}</tex-math><mml:math id="M342"><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq150.gif"/></alternatives></inline-formula> as the set of overlapped spots/cells for the transformed slice <inline-formula id="IEq151"><alternatives><tex-math id="M343">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M344"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq151.gif"/></alternatives></inline-formula> between slice <inline-formula id="IEq152"><alternatives><tex-math id="M345">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M346"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq152.gif"/></alternatives></inline-formula> and the transformed slice <inline-formula id="IEq153"><alternatives><tex-math id="M347">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M348"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq153.gif"/></alternatives></inline-formula>. This set includes spots/cells in the transformed slice <inline-formula id="IEq154"><alternatives><tex-math id="M349">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M350"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq154.gif"/></alternatives></inline-formula> whose Euclidean distance to their <inline-formula id="IEq155"><alternatives><tex-math id="M351">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M352"><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq155.gif"/></alternatives></inline-formula> mutual nearest neighbor spots/cells in slice <inline-formula id="IEq156"><alternatives><tex-math id="M353">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M354"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq156.gif"/></alternatives></inline-formula> is less than a maximum distance. By default, the maximum distance defined as median Euclidean distance to the <inline-formula id="IEq157"><alternatives><tex-math id="M355">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$2{{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M356"><mml:mn>2</mml:mn><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq157.gif"/></alternatives></inline-formula> nearest neighbor of spots/cells in slice <inline-formula id="IEq158"><alternatives><tex-math id="M357">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M358"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq158.gif"/></alternatives></inline-formula>. Then we defined an alignment objective function (AOF) to measure the alignment between the transformed slices <inline-formula id="IEq159"><alternatives><tex-math id="M359">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M360"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq159.gif"/></alternatives></inline-formula> and slice <inline-formula id="IEq160"><alternatives><tex-math id="M361">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M362"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq160.gif"/></alternatives></inline-formula> as follows:<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M363">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AOF}}}}}}\left({S}_{j}^{{\prime} }|{S}_{j-1}\right) \mathop{=}\limits^{{{{{\mathrm{def}}}}}} \frac{1}{{n}_{o}}\mathop{\sum}\limits_{{{l}_{j}^{\prime }}\in {{O}_{j}}}\frac{1}{m}{\sum }_{{{l}_{j-1}}\in {{\left\langle {l}_{j}^{\prime }\right\rangle }_{k}^{j-1}}}\, \delta \left[{{{{{\rm{domain}}}}}}\left({l}_{j-1}\right),\,{{{{{\rm{domain}}}}}}\left({l}_{j}^{\prime }\right)\right]+f \left(\frac{{n}_{o}}{{n}_{j}}\right)$$\end{document}</tex-math><mml:math id="M364"><mml:mi mathvariant="normal">AOF</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="⟩" open="⟨"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>δ</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq161"><alternatives><tex-math id="M365">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }\in {O}_{j}$$\end{document}</tex-math><mml:math id="M366"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq161.gif"/></alternatives></inline-formula> are overlapped spots/cells in transformed slice <inline-formula id="IEq162"><alternatives><tex-math id="M367">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M368"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq162.gif"/></alternatives></inline-formula>; <inline-formula id="IEq163"><alternatives><tex-math id="M369">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M370"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq163.gif"/></alternatives></inline-formula> is a set of spots/cells in slice <inline-formula id="IEq164"><alternatives><tex-math id="M371">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M372"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq164.gif"/></alternatives></inline-formula> which means the mutual <inline-formula id="IEq165"><alternatives><tex-math id="M373">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M374"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq165.gif"/></alternatives></inline-formula> nearest neighbors of spot/cell <inline-formula id="IEq166"><alternatives><tex-math id="M375">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M376"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq166.gif"/></alternatives></inline-formula>; <inline-formula id="IEq167"><alternatives><tex-math id="M377">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m$$\end{document}</tex-math><mml:math id="M378"><mml:mi>m</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq167.gif"/></alternatives></inline-formula> means the elements number in set <inline-formula id="IEq168"><alternatives><tex-math id="M379">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M380"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq168.gif"/></alternatives></inline-formula>; <inline-formula id="IEq169"><alternatives><tex-math id="M381">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta \left(x,y\right)$$\end{document}</tex-math><mml:math id="M382"><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq169.gif"/></alternatives></inline-formula> is a Kronecker function. <inline-formula id="IEq170"><alternatives><tex-math id="M383">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left(x\right)=-{\left(x-1\right)}^{p}$$\end{document}</tex-math><mml:math id="M384"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq170.gif"/></alternatives></inline-formula> is the penalty term; <inline-formula id="IEq171"><alternatives><tex-math id="M385">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M386"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq171.gif"/></alternatives></inline-formula> is the exponent of the penalty, with a larger <inline-formula id="IEq172"><alternatives><tex-math id="M387">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M388"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq172.gif"/></alternatives></inline-formula> indicates stronger partial alignment capability; <inline-formula id="IEq173"><alternatives><tex-math id="M389">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{o}$$\end{document}</tex-math><mml:math id="M390"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq173.gif"/></alternatives></inline-formula> is the number of overlapped spots/cells in slice <inline-formula id="IEq174"><alternatives><tex-math id="M391">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M392"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq174.gif"/></alternatives></inline-formula>; <inline-formula id="IEq175"><alternatives><tex-math id="M393">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M394"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq175.gif"/></alternatives></inline-formula> is the number of all spots/cells in the transformed slice <inline-formula id="IEq176"><alternatives><tex-math id="M395">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M396"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq176.gif"/></alternatives></inline-formula>; Then we adopted the differential evolution algorithm to determine the best transformation matrices <inline-formula id="IEq177"><alternatives><tex-math id="M397">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{R,M,T\right\}$$\end{document}</tex-math><mml:math id="M398"><mml:mfenced close="}" open="{"><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq177.gif"/></alternatives></inline-formula> to maximize the AOF value between two adjacent slices. After determining transformation matrices for all slices, we can stack these transformed slices to construct a 3D alignment of the tissue.</p>
    </sec>
    <sec id="Sec17">
      <title>Gaussian progress regression model</title>
      <p id="Par49">We embedded a Gaussian process regression method<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in SPACEL to obtain the continuous 3D distribution of a transcript from Scube transformed slices. First, we adopted the Alpha shape algorithm<sup><xref ref-type="bibr" rid="CR78">78</xref>,<xref ref-type="bibr" rid="CR79">79</xref></sup> to generate a 3D meshed manifold from the coordinates of the spots/cells in all slices, and smoothed this manifold using a subdivision algorithm<sup><xref ref-type="bibr" rid="CR80">80</xref></sup>. We built a Gaussian process (GP) model for the expression level <inline-formula id="IEq178"><alternatives><tex-math id="M399">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i}^{\left(j\right)}$$\end{document}</tex-math><mml:math id="M400"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq178.gif"/></alternatives></inline-formula> of gene <inline-formula id="IEq179"><alternatives><tex-math id="M401">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M402"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq179.gif"/></alternatives></inline-formula> in each spot/cell <inline-formula id="IEq180"><alternatives><tex-math id="M403">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M404"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq180.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M405">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{y}_{i}}^{\left(j\right)}|{x}^{\left(j\right)}={f}_{i}({x}^{\left(j\right)})+\epsilon$$\end{document}</tex-math><mml:math id="M406"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>∣</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq181"><alternatives><tex-math id="M407">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M408"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq181.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq182"><alternatives><tex-math id="M409">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M410"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq182.gif"/></alternatives></inline-formula>, ε represents Gaussian additive noise, and the functional form of <inline-formula id="IEq183"><alternatives><tex-math id="M411">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}(\cdot )$$\end{document}</tex-math><mml:math id="M412"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq183.gif"/></alternatives></inline-formula> is unknown and may vary between genes, denoted as<disp-formula id="Equ24"><label>24</label><alternatives><tex-math id="M413">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}\left(x\right) \sim {{{{{\rm{GP}}}}}}\left[\mu \left(\mathop{x}\limits^{ \rightharpoonup }\right),{{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} \right)\right]$$\end{document}</tex-math><mml:math id="M414"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>~</mml:mo><mml:mi mathvariant="normal">GP</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>μ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mo>x</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ25"><label>25</label><alternatives><tex-math id="M415">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \right)=\mathop{\sum}\limits_{j,{j}^{{\prime} }}{\delta }^{2}\exp \left[-\frac{{\left({x}^{\left(j\right)}-{x}^{\left({j}^{{\prime} }\right)}\right)}^{2}}{2{l}^{2}}\right]$$\end{document}</tex-math><mml:math id="M416"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>exp</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq184"><alternatives><tex-math id="M417">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M418"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq184.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq185"><alternatives><tex-math id="M419">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M420"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq185.gif"/></alternatives></inline-formula>, <inline-formula id="IEq186"><alternatives><tex-math id="M421">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M422"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq186.gif"/></alternatives></inline-formula> represents the mean function, <inline-formula id="IEq187"><alternatives><tex-math id="M423">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M424"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq187.gif"/></alternatives></inline-formula> represents the covariance function, and <inline-formula id="IEq188"><alternatives><tex-math id="M425">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M426"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq188.gif"/></alternatives></inline-formula> and <inline-formula id="IEq189"><alternatives><tex-math id="M427">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M428"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq189.gif"/></alternatives></inline-formula> are the process-variance and length-scale hyperparameters, respectively. The objective function for training the GP model is the marginal likelihood,<disp-formula id="Equ26"><label>26</label><alternatives><tex-math id="M429">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L\left({y}_{i}{|x},\, \theta \right)=\int P\left({y}_{i}|{f}_{i},\, x,\, \theta \right)P\left({f}_{i}{|x},\, \theta \right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M430"><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula>of gaussian process model. The hyper-parameter <inline-formula id="IEq190"><alternatives><tex-math id="M431">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta$$\end{document}</tex-math><mml:math id="M432"><mml:mi>θ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq190.gif"/></alternatives></inline-formula> can be set by maximizing a posteriori estimation, defined as:<disp-formula id="Equ27"><label>27</label><alternatives><tex-math id="M433">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }^{*}\leftarrow {{{{{\rm{ar}}}}}}{{{{{{\rm{g}}}}}}}_{\theta }\max \int P\left({y}_{i}|{f}_{i},\, x,\,\theta \right)P\left({f}_{i}{|x},\, \theta \right)P\left({{{{{\rm{\theta }}}}}}\right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M434"><mml:msup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo>←</mml:mo><mml:mi mathvariant="normal">ar</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mi>max</mml:mi><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula>We set the initial values of these hyperparameters as <inline-formula id="IEq191"><alternatives><tex-math id="M435">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu ({\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup }})={{{{{\rm{mean}}}}}}({y}_{i})$$\end{document}</tex-math><mml:math id="M436"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">mean</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq191.gif"/></alternatives></inline-formula>, <inline-formula id="IEq192"><alternatives><tex-math id="M437">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta=4$$\end{document}</tex-math><mml:math id="M438"><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq192.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq193"><alternatives><tex-math id="M439">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l={{{{{\rm{\lambda }}}}}}\cdot {{{{\mathrm{var}}}}}\left({y}_{i}\right)$$\end{document}</tex-math><mml:math id="M440"><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">λ</mml:mi><mml:mo>⋅</mml:mo><mml:mi mathvariant="normal">var</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq193.gif"/></alternatives></inline-formula>, and we used a grid search strategy<sup><xref ref-type="bibr" rid="CR81">81</xref></sup> to determine the value of <inline-formula id="IEq194"><alternatives><tex-math id="M441">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{\lambda }}}}}}$$\end{document}</tex-math><mml:math id="M442"><mml:mi mathvariant="normal">λ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq194.gif"/></alternatives></inline-formula> that maximizes the marginal likelihood. Then, we used the coordinates and gene expression information of spots/cells in all slices to train this GP model, and optimized the hyperparameters <inline-formula id="IEq195"><alternatives><tex-math id="M443">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M444"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq195.gif"/></alternatives></inline-formula>, <inline-formula id="IEq196"><alternatives><tex-math id="M445">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M446"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq196.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq197"><alternatives><tex-math id="M447">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M448"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq197.gif"/></alternatives></inline-formula> using the Adam algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup>. Finally, we uniformly sampled 500,000 points in the 3D meshed manifold, and used the trained GPR model to predict the expression level of a gene at each point. The gene expression information of these points constitutes the distribution of a transcript in 3D space. Based on the GPR model, we can use the Bayes Factor (BF) to quantify the spatial variation of a given gene in 3D space<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>:<disp-formula id="Equ28"><label>28</label><alternatives><tex-math id="M449">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{BF}}}}}}=\frac{L\left({M}_{1}\right)}{L\left({M}_{2}\right)}$$\end{document}</tex-math><mml:math id="M450"><mml:mi mathvariant="normal">BF</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq198"><alternatives><tex-math id="M451">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{1})$$\end{document}</tex-math><mml:math id="M452"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq198.gif"/></alternatives></inline-formula> denotes the marginal likelihood of the optimized GPR model and <inline-formula id="IEq199"><alternatives><tex-math id="M453">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{2})$$\end{document}</tex-math><mml:math id="M454"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq199.gif"/></alternatives></inline-formula> denotes the marginal likelihood of a simplified GPR model in which <inline-formula id="IEq200"><alternatives><tex-math id="M455">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M456"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq200.gif"/></alternatives></inline-formula> was set to <inline-formula id="IEq201"><alternatives><tex-math id="M457">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\infty$$\end{document}</tex-math><mml:math id="M458"><mml:mi>∞</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq201.gif"/></alternatives></inline-formula>. Larger BF values denote greater spatial variation in the gene expression level.</p>
    </sec>
    <sec id="Sec18">
      <title>Robustness test of SPACEL</title>
      <p id="Par50">To test the robustness of SPACEL, we evaluated its performance across various hyperparameters. Each hyperparameter was varied individually while keeping the other hyperparameter values constant. In Spoint, we assessed its performance by varying two user-defined hyperparameters (the number of simulated spots in the training set and the number of marker genes in each single-cell cluster) and three model hyperparameters (the dimensions of latent layers, hidden layers of predicted model, and probability output layers) in real single-cell resolution ST datasets<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR49">49</xref></sup>. In Splane, we compared its performance by varying five hyperparameters (the dropout rate of the model layers, the weight of the adversarial loss, the degree of neighbors in the constructed graph, the dimensions of latent layers, and the dimensions of hidden layers) using human DFPLC data<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. In Scube, we tested its performance by varying the five hyperparameters used in Splane, one additional hyperparameter (the number of spatial domains), and two hyperparameters specific to Scube (the number of nearest neighbors in the MNN graph and the exponent of the penalty for the overlap ratio between adjacent slices) using 3D STARmap data<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> with a crop rate of 0.25.</p>
    </sec>
    <sec id="Sec19">
      <title>Jaccard index and shifting distance</title>
      <p id="Par51">To evaluate the prediction accuracy of the spatial domains identified by each method, we computed the Jaccard Index (JI) for each spatial domain with a manually annotated cortical layer. Specifically, we defined a set <inline-formula id="IEq202"><alternatives><tex-math id="M459">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M460"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq202.gif"/></alternatives></inline-formula> that contains all spots in the spatial domain <inline-formula id="IEq203"><alternatives><tex-math id="M461">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M462"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq203.gif"/></alternatives></inline-formula> and a set <inline-formula id="IEq204"><alternatives><tex-math id="M463">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{l}$$\end{document}</tex-math><mml:math id="M464"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq204.gif"/></alternatives></inline-formula> that contains all spots in the cortical layer <inline-formula id="IEq205"><alternatives><tex-math id="M465">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M466"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq205.gif"/></alternatives></inline-formula>. We calculated <inline-formula id="IEq206"><alternatives><tex-math id="M467">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,\, l\right)=\frac{{P}_{d}\cap {P}_{l}}{{P}_{d}\cup {P}_{l}}$$\end{document}</tex-math><mml:math id="M468"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq206.gif"/></alternatives></inline-formula> between a spatial domain <inline-formula id="IEq207"><alternatives><tex-math id="M469">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M470"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq207.gif"/></alternatives></inline-formula> and all cortical layers, and defined the cortical layer with the largest JI value as the corresponding layer of domain <inline-formula id="IEq208"><alternatives><tex-math id="M471">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M472"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq208.gif"/></alternatives></inline-formula>, i.e., layer <inline-formula id="IEq209"><alternatives><tex-math id="M473">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}$$\end{document}</tex-math><mml:math id="M474"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq209.gif"/></alternatives></inline-formula>:<disp-formula id="Equ29"><label>29</label><alternatives><tex-math id="M475">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}={{\arg }}{{{{{{\rm{m}}}}}}{{{{{\rm{ax}}}}}}}_{l}\left[{{{{{\rm{JI}}}}}}\left(d,\, l\right)\right]$$\end{document}</tex-math><mml:math id="M476"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>arg</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">ax</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">JI</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par52">We then used <inline-formula id="IEq210"><alternatives><tex-math id="M477">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,{l}_{d}\right)$$\end{document}</tex-math><mml:math id="M478"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq210.gif"/></alternatives></inline-formula> to measure the prediction accuracy for the spatial domain <inline-formula id="IEq211"><alternatives><tex-math id="M479">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M480"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq211.gif"/></alternatives></inline-formula>. We calculated the JI values for all spatial domains in a slice and used the average JI value for these domains to represent the prediction accuracy for the slice. In addition, for a spatial domain, we defined the distance from one of its spots to its corresponding cortical layer as the shifting distance (SD) of the spot and used the average SD of all spots in the spatial domain to evaluate the performance of each method. A lower SD value indicates a better consistency between the spatial domain and the corresponding cortical layer.</p>
    </sec>
    <sec id="Sec20">
      <title>Identification of spatial variable genes</title>
      <p id="Par53">We used two strategies to obtain the ground truth for spatial variable genes (SVGs). The first strategy was to use the differentially expressed genes of manually annotated cortical layers as the ground truth. Specifically, after normalizing the expression matrix of the ST data using Scanpy, we applied the two-sided Wilcoxon rank-sum test and the threshold log(fold-change) &gt; 0.5, <italic>P</italic>-value &lt; 0.01 to obtain differentially expressed genes (DEGs) for each cortical layer, which we used as the ground truth for SVGs. We used the same strategy to obtain DEGs for each spatial domain. Then, we calculated the sensitivity and specificity of the DEGs of spatial domains obtained by each method, and plotted receiver operating characteristic curves using the <italic>P</italic>-value ranking of DEGs.</p>
    </sec>
    <sec id="Sec21">
      <title>ASW of slices from different experimental batches</title>
      <p id="Par54">To assess the performance of Splane in reducing the batch effect when jointly analyzing multiple slices, we calculated the Average Silhouette Width (ASW) using the equation:<disp-formula id="Equ30"><label>30</label><alternatives><tex-math id="M481">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{ASW}}}}}}=\frac{1}{K}\mathop{\sum}\limits_{k=1}^{K}\frac{1}{{C}_{k}}\mathop{\sum}\limits_{i=1}^{{C}_{k}}1-|{{{{{\rm{Silhouette}}}}}}\left(i\right)|$$\end{document}</tex-math><mml:math id="M482"><mml:mi mathvariant="normal">ASW</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>∣</mml:mo><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>∣</mml:mo></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ31"><label>31</label><alternatives><tex-math id="M483">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Silhouette}}}}}}=\mathop{\sum }\limits_{i}^{N}\frac{b\left(i\right)-a\left(i\right)}{\max \left[a\left(i\right),b\left(i\right)\right]}$$\end{document}</tex-math><mml:math id="M484"><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ31.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ32"><label>32</label><alternatives><tex-math id="M485">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a\left(i\right)=\frac{1}{{n}_{s}-1}\mathop{\sum }\limits_{j\in s}^{{n}_{s}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)$$\end{document}</tex-math><mml:math id="M486"><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ32.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ33"><label>33</label><alternatives><tex-math id="M487">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b\left(i\right)={\min }_{{s}^{{\prime} }}\left[\frac{1}{{n}_{{s}^{{\prime} }}-1}\mathop{\sum }\limits_{j\in {s}^{{\prime} }}^{{n}_{{s}^{{\prime} }}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)\right]$$\end{document}</tex-math><mml:math id="M488"><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ33.gif" position="anchor"/></alternatives></disp-formula>where spot/cell <inline-formula id="IEq212"><alternatives><tex-math id="M489">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M490"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq212.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq213"><alternatives><tex-math id="M491">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M492"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq213.gif"/></alternatives></inline-formula>, spot/cell <inline-formula id="IEq214"><alternatives><tex-math id="M493">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M494"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq214.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq215"><alternatives><tex-math id="M495">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M496"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq215.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq216"><alternatives><tex-math id="M497">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a$$\end{document}</tex-math><mml:math id="M498"><mml:mi>a</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq216.gif"/></alternatives></inline-formula>) or <inline-formula id="IEq217"><alternatives><tex-math id="M499">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s{{\hbox{'}}}}$$\end{document}</tex-math><mml:math id="M500"><mml:mi>s</mml:mi><mml:mi>’</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq217.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq218"><alternatives><tex-math id="M501">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b$$\end{document}</tex-math><mml:math id="M502"><mml:mi>b</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq218.gif"/></alternatives></inline-formula>), <inline-formula id="IEq219"><alternatives><tex-math id="M503">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M504"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq219.gif"/></alternatives></inline-formula> is the number of cells with the domain/cluster <inline-formula id="IEq220"><alternatives><tex-math id="M505">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M506"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq220.gif"/></alternatives></inline-formula>, <inline-formula id="IEq221"><alternatives><tex-math id="M507">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M508"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq221.gif"/></alternatives></inline-formula> is the number of domains/clusters, <inline-formula id="IEq222"><alternatives><tex-math id="M509">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{s}$$\end{document}</tex-math><mml:math id="M510"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq222.gif"/></alternatives></inline-formula> is the spot/cell number in dataset <inline-formula id="IEq223"><alternatives><tex-math id="M511">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M512"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq223.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq224"><alternatives><tex-math id="M513">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M514"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq224.gif"/></alternatives></inline-formula> is the total number of spots/cells in all datasets. We calculated the Euclidean distance between spots/cells <inline-formula id="IEq225"><alternatives><tex-math id="M515">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M516"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq225.gif"/></alternatives></inline-formula> and <inline-formula id="IEq226"><alternatives><tex-math id="M517">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M518"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq226.gif"/></alternatives></inline-formula> from the raw expression matrix or from the latent features of spots/cells <inline-formula id="IEq227"><alternatives><tex-math id="M519">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M520"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq227.gif"/></alternatives></inline-formula> and <inline-formula id="IEq228"><alternatives><tex-math id="M521">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M522"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq228.gif"/></alternatives></inline-formula>. We used the scib<sup><xref ref-type="bibr" rid="CR82">82</xref></sup> implementation to compute the ASW scores.</p>
    </sec>
    <sec id="Sec22">
      <title>Copy number variation estimated by inferCNV</title>
      <p id="Par55">We employed inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup> to estimate copy number variations (CNVs) for the breast cancer ST slices. We used the default setting cut-off = 0.1 for inferCNV, i.e., only genes with an average count &gt; 0.1 were considered. We used spots containing &lt; 10% cancer cells as reference samples and other spots as malignant samples. To compare the CNV values inferred from different slices and different experimental batches, we scaled the inferred CNV values to −1 ~ 1, and we calculated the average inferred CNV at each genomic locus for all spots in a spatial domain, to represent the mutation information of the spatial domain.</p>
    </sec>
    <sec id="Sec23">
      <title>Validation of immune domains</title>
      <p id="Par56">To validate that D3, D5, and D9 are immune domains, we calculated the percentage of overlap (PO) between the experimental annotation of immune spots and the spatial domains identified by Splane, as<disp-formula id="Equ34"><label>34</label><alternatives><tex-math id="M523">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{PO}}}}}}}_{d}=\frac{{P}_{{{{{{\rm{lym}}}}}}}\cap {P}_{d}}{{P}_{d}}$$\end{document}</tex-math><mml:math id="M524"><mml:msub><mml:mrow><mml:mi mathvariant="normal">PO</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">lym</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ34.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq229"><alternatives><tex-math id="M525">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{{lym}}$$\end{document}</tex-math><mml:math id="M526"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>y</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq229.gif"/></alternatives></inline-formula> is the set of immune spots annotated by experiments, and <inline-formula id="IEq230"><alternatives><tex-math id="M527">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M528"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq230.gif"/></alternatives></inline-formula> is the set of spots in domain d. For slices S1, S2, S5, and S6, we used the H&amp;E staining information from the original study as the experimental annotation of immune spots<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. For slice S10, we used the anti-CD3 immunofluorescence images of the slice to annotate immune spots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Specifically, we first used DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup> and DAPI channel information to filter cells with sizes between 150 and 1000 pixels. Then, we scaled the CD3 fluorescence intensity of each pixel to 0−1, and used the average of the scaled CD3 intensity of pixels within a cell to represent the CD3 intensity of the cell. Cells with CD3 intensity &gt; 0.37 were defined as CD3<sup>+</sup> cells, and spots containing &gt; 30% CD3<sup>+</sup> cells were used as experimentally annotated lymphocyte spots.</p>
    </sec>
    <sec id="Sec24">
      <title>Metrics for benchmarking deconvolution methods</title>
      <p id="Par57">We employed the five metrics from a previous benchmarking study of deconvolution methods<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> to compare the performance of Splane with other state-of-the-art methods in processing the 32 simulated ST datasets:</p>
      <p id="Par58">1. Pearson correlation coefficient (PCC):<disp-formula id="Equ35"><label>35</label><alternatives><tex-math id="M529">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{PCC}}}}}}=\frac{E\left[\left({\widetilde{{{{{{\bf{x}}}}}}}}_{i}-{\widetilde{u}}_{i}\right)\left({{{{{{\bf{x}}}}}}}_{i}-{u}_{i}\right)\right]}{{\widetilde{s}}_{i}{s}_{i}}$$\end{document}</tex-math><mml:math id="M530"><mml:mi mathvariant="normal">PCC</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ35.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq231"><alternatives><tex-math id="M531">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\boldsymbol{x}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M532"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq231.gif"/></alternatives></inline-formula> is the cell type composition of cell type <inline-formula id="IEq232"><alternatives><tex-math id="M533">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M534"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq232.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq233"><alternatives><tex-math id="M535">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${u}_{i}$$\end{document}</tex-math><mml:math id="M536"><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq233.gif"/></alternatives></inline-formula> is the average cell type composition of cell type <inline-formula id="IEq234"><alternatives><tex-math id="M537">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M538"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq234.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq235"><alternatives><tex-math id="M539">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{i}$$\end{document}</tex-math><mml:math id="M540"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq235.gif"/></alternatives></inline-formula> is the standard deviation of the cell type composition of cell type <inline-formula id="IEq236"><alternatives><tex-math id="M541">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M542"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq236.gif"/></alternatives></inline-formula> in the ground truth, and <inline-formula id="IEq237"><alternatives><tex-math id="M543">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{x}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M544"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq237.gif"/></alternatives></inline-formula>, <inline-formula id="IEq238"><alternatives><tex-math id="M545">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{u}}_{i}$$\end{document}</tex-math><mml:math id="M546"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq238.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq239"><alternatives><tex-math id="M547">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{\sigma }}_{i}$$\end{document}</tex-math><mml:math id="M548"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq239.gif"/></alternatives></inline-formula> are the corresponding values in the predicted result. For a cell type, a higher PCC value indicates higher deconvolution accuracy.</p>
      <p id="Par59">2. Structural similarity (SSIM)<bold>:</bold><disp-formula id="Equ36"><label>36</label><alternatives><tex-math id="M549">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{SSIM}}}}}}=\frac{\left({2\widetilde{u}}_{i}{u}_{i}+{C}_{1}^{2}\right)\left(2{{{{\mathrm{cov}}}}}({{{{{{\boldsymbol{x}}}}}}^{\prime }}_{i},{\widetilde{{{{{{\boldsymbol{x}}}}}}}^{\prime} }_{i})+{C}_{2}^{2}\right)}{\left({{\widetilde{u}}_{i}}^{2}{{+u}_{i}}^{2}+{C}_{1}^{2}\right)\left({{\widetilde{s}}_{i}}^{2}{{+s}_{i}}^{2}+{C}_{2}^{2}\right)}$$\end{document}</tex-math><mml:math id="M550"><mml:mi mathvariant="normal">SSIM</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ36.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq240"><alternatives><tex-math id="M551">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{\mathrm{cov}}}}}({{{{{{\bf{x}}}}}}}_{i},{\widetilde{{{{{{\bf{x}}}}}}}}_{i})$$\end{document}</tex-math><mml:math id="M552"><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq240.gif"/></alternatives></inline-formula> is the covariance between the ground truth and the predicted result, and <inline-formula id="IEq241"><alternatives><tex-math id="M553">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{1}$$\end{document}</tex-math><mml:math id="M554"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq241.gif"/></alternatives></inline-formula> and <inline-formula id="IEq242"><alternatives><tex-math id="M555">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{2}$$\end{document}</tex-math><mml:math id="M556"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq242.gif"/></alternatives></inline-formula> are 0.01 and 0.03, respectively. For a cell type, a higher SSIM value indicates higher deconvolution accuracy.</p>
      <p id="Par60">3. Root mean square error (RMSE):<disp-formula id="Equ37"><label>37</label><alternatives><tex-math id="M557">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{RMSE}}}}}}=\sqrt{\frac{1}{M}\mathop{\sum }\limits_{j=1}^{M}{\left({\widetilde{x}}_{{ij}}-{x}_{{ij}}\right)}^{2}}$$\end{document}</tex-math><mml:math id="M558"><mml:mi mathvariant="normal">RMSE</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ37.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par61">For a cell type, a lower RMSE value indicates higher deconvolution accuracy.</p>
      <p id="Par62">4. Jensen-Shannon divergence (JS):<disp-formula id="Equ38"><label>38</label><alternatives><tex-math id="M559">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{JS}}}}}}=\frac{1}{2}{{{{{\rm{KL}}}}}}\left({\widetilde{{{{{{\bf{P}}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)+\frac{1}{2}{{{{{\rm{KL}}}}}}\left({{{{{{\bf{P}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)$$\end{document}</tex-math><mml:math id="M560"><mml:mi mathvariant="normal">JS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ38.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ39"><label>39</label><alternatives><tex-math id="M561">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}\left({{{{{{\boldsymbol{a}}}}}}}_{i}{||}{{{{{{\boldsymbol{b}}}}}}}_{i}\right)={\sum }_{j=0}^{M}\left({a}_{{ij}} * \log \frac{{a}_{{ij}}}{{b}_{{ij}}}\right)$$\end{document}</tex-math><mml:math id="M562"><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ39.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq243"><alternatives><tex-math id="M563">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{P}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M564"><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq243.gif"/></alternatives></inline-formula> and <inline-formula id="IEq244"><alternatives><tex-math id="M565">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{P}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M566"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq244.gif"/></alternatives></inline-formula> are the spatial distribution of cell type <inline-formula id="IEq245"><alternatives><tex-math id="M567">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M568"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq245.gif"/></alternatives></inline-formula> in the ground truth and the predicted result, respectively. For a cell type, a lower JS value indicates higher deconvolution accuracy.</p>
      <p id="Par63">5. Accuracy score (AS): We computed the average PCC, SSIM, RMSE, and JS of all cell types predicted by each method, and sorted the average PCC/SSIM and RMSE/JS of all deconvolution methods in ascending and descending order, respectively, to obtain <inline-formula id="IEq246"><alternatives><tex-math id="M569">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}$$\end{document}</tex-math><mml:math id="M570"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq246.gif"/></alternatives></inline-formula>, <inline-formula id="IEq247"><alternatives><tex-math id="M571">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}$$\end{document}</tex-math><mml:math id="M572"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq247.gif"/></alternatives></inline-formula>, <inline-formula id="IEq248"><alternatives><tex-math id="M573">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}$$\end{document}</tex-math><mml:math id="M574"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq248.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq249"><alternatives><tex-math id="M575">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}$$\end{document}</tex-math><mml:math id="M576"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq249.gif"/></alternatives></inline-formula>. Then, we calculated the average of the four rankings to obtain the AS value of each method as follows:<disp-formula id="Equ40"><label>40</label><alternatives><tex-math id="M577">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AS}}}}}}=\frac{1}{4}\left({{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}\right)$$\end{document}</tex-math><mml:math id="M578"><mml:mi mathvariant="normal">AS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ40.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par64">For a dataset, the method with the highest AS value has the best performance among all deconvolution methods.</p>
      <p id="Par65">For the DPLFC dataset, the cell type composition of each spot in the ST slices has not been validated by any experiments. To benchmark deconvolution methods in processing this real ST dataset, we adopted the cortical layers annotated by the original study as ground truth. We defined the accuracy score for the deconvolution results of the DPLFC datasets as the predicted proportion of one cell type in its corresponding cortical layer. Additionally, we used the Wilcoxon Rank Sum test to calculate P-values for the difference in the average proportion of each excitatory neuron cell type between the corresponding layer and the other layers across all samples. The method with the highest accuracy score and the lowest P-value has the highest deconvolution accuracy.</p>
    </sec>
    <sec id="Sec25">
      <title>Evaluation of alignment on continuous slices</title>
      <p id="Par66">We employed a 3D STARmap dataset of the mouse brain from Wang et al. study to build a ground truth to compare the performance of Scube, PASTE, and STAligner. Specifically, we divided the 1400 µm × 1700 µm × 100 µm mouse brain sample into ten 10 µm thick slices, <inline-formula id="IEq250"><alternatives><tex-math id="M579">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\hat{S}}_{i}\}$$\end{document}</tex-math><mml:math id="M580"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq250.gif"/></alternatives></inline-formula>, and used these slices as a ground truth. To simulate changes in the shape and position of slices during tissue sectioning, we randomly flipped, cropped, translated, and rotated each ground truth slice, to generate an ST dataset comprising consecutive 2D slices, <inline-formula id="IEq251"><alternatives><tex-math id="M581">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{{S}_{i}\right\}$$\end{document}</tex-math><mml:math id="M582"><mml:mfenced close="}" open="{"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq251.gif"/></alternatives></inline-formula>. Specifically, each slice (except the first slice) was randomly flipped, rotated by a random degree of 0°–360°, and translated by a random distance of 300−2000 μm along the x-axis and/or y-axis. Moreover, each slice was cropped from its edges with a crop ratio of 0.05–0.25. Then, we used Scube, PASTE, and STAligner to align each pair of adjacent simulated slices, <inline-formula id="IEq252"><alternatives><tex-math id="M583">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i},{S}_{i+1}\right)$$\end{document}</tex-math><mml:math id="M584"><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq252.gif"/></alternatives></inline-formula>, and obtain the aligned pair of slices, <inline-formula id="IEq253"><alternatives><tex-math id="M585">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i}^{{\prime} },{S}_{i+1}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M586"><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq253.gif"/></alternatives></inline-formula>.</p>
      <p id="Par67">To compare the alignment results of Scube, PASTE, and STAligner with the ground truth, we first calculated the transformation matrix <inline-formula id="IEq254"><alternatives><tex-math id="M587">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M588"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq254.gif"/></alternatives></inline-formula> from an aligned slice <inline-formula id="IEq255"><alternatives><tex-math id="M589">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M590"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq255.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq256"><alternatives><tex-math id="M591">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M592"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq256.gif"/></alternatives></inline-formula> as<disp-formula id="Equ41"><label>41</label><alternatives><tex-math id="M593">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}={S}_{i}^{{\prime} \left(3\right)}{\left(\begin{array}{c}{\hat{S}}_{i}^{\left(3\right)}\\ {{{{{{\bf{1}}}}}}}_{1\times 3}\end{array}\right)}^{-1}$$\end{document}</tex-math><mml:math id="M594"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ41.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq257"><alternatives><tex-math id="M595">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} (3)}$$\end{document}</tex-math><mml:math id="M596"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq257.gif"/></alternatives></inline-formula> and <inline-formula id="IEq258"><alternatives><tex-math id="M597">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}^{(3)}$$\end{document}</tex-math><mml:math id="M598"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq258.gif"/></alternatives></inline-formula> are the first three columns of <inline-formula id="IEq259"><alternatives><tex-math id="M599">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M600"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq259.gif"/></alternatives></inline-formula> and <inline-formula id="IEq260"><alternatives><tex-math id="M601">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M602"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq260.gif"/></alternatives></inline-formula>, respectively. We used the transformation matrix <inline-formula id="IEq261"><alternatives><tex-math id="M603">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M604"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq261.gif"/></alternatives></inline-formula> to transform the aligned slice <inline-formula id="IEq262"><alternatives><tex-math id="M605">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{{\prime} }$$\end{document}</tex-math><mml:math id="M606"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq262.gif"/></alternatives></inline-formula> adjacent to <inline-formula id="IEq263"><alternatives><tex-math id="M607">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M608"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq263.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ42"><label>42</label><alternatives><tex-math id="M609">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}={M}_{i}\left(\begin{array}{c}{S}_{i+1}^{{\prime} }\\ {{{{{{\bf{1}}}}}}}_{1\times {n}_{i+1}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M610"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ42.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par68">Then, we divided the transformed aligned slice <inline-formula id="IEq264"><alternatives><tex-math id="M611">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M612"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq264.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq265"><alternatives><tex-math id="M613">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M614"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq265.gif"/></alternatives></inline-formula> into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type compositions of the grids in <inline-formula id="IEq266"><alternatives><tex-math id="M615">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M616"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq266.gif"/></alternatives></inline-formula> and <inline-formula id="IEq267"><alternatives><tex-math id="M617">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M618"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq267.gif"/></alternatives></inline-formula>, to measure the accuracy of Scube, PASTE, and STAligner.</p>
      <p id="Par69">In addition, we employed mouse brain MERFISH, mouse embryo Stereo-seq, and mouse brain Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> data to assess the performance of Scube, PASTE, and STAligner. As there are no ground truths for these datasets, we divided the common area of each pair of adjacent slices into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type composition of the grids in the two adjacent slices aligned by Scube, PASTE and/or STAligner to measure the performance of the two methods.</p>
    </sec>
    <sec id="Sec26">
      <title>Hyperparameter settings for benchmarking methods</title>
      <p id="Par70">The selection of the hyperparameters for each method was followed by the official tutorials and codes provided by their respective authors:<list list-type="bullet"><list-item><p id="Par71">STAligner: <ext-link ext-link-type="uri" xlink:href="https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html">https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html</ext-link></p></list-item><list-item><p id="Par72">PRECAST: <ext-link ext-link-type="uri" xlink:href="https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html">https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html</ext-link></p></list-item><list-item><p id="Par73">STACI:</p><p id="Par74">STACI GitHub repository for Visium and Spatial Transcriptomes data, and cells with gene number less 10 were filtered:</p><p id="Par75"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb</ext-link></p><p id="Par76">for MERFISH data:</p><p id="Par77"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb</ext-link></p></list-item><list-item><p id="Par78">STAGATE: <ext-link ext-link-type="uri" xlink:href="https://stagate.readthedocs.io/en/latest/T1_DLPFC.html">https://stagate.readthedocs.io/en/latest/T1_DLPFC.html</ext-link></p></list-item><list-item><p id="Par79">SpaGCN: <ext-link ext-link-type="uri" xlink:href="https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb">https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb</ext-link></p></list-item><list-item><p id="Par80">BayesSpace: <ext-link ext-link-type="uri" xlink:href="https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html">https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html</ext-link></p></list-item><list-item><p id="Par81">stLearn: <ext-link ext-link-type="uri" xlink:href="https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex">https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex</ext-link>-(DLPFC)</p></list-item></list><list list-type="bullet"><list-item><p id="Par82">CARD: <ext-link ext-link-type="uri" xlink:href="https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html">https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html</ext-link></p></list-item><list-item><p id="Par83">Cell2location: <ext-link ext-link-type="uri" xlink:href="https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html">https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html</ext-link></p></list-item><list-item><p id="Par84">DestVI:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html">https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html</ext-link></p></list-item><list-item><p id="Par85">DSTG: <ext-link ext-link-type="uri" xlink:href="https://github.com/Su-informatics-lab/DSTG">https://github.com/Su-informatics-lab/DSTG</ext-link></p></list-item><list-item><p id="Par86">RCTD: <ext-link ext-link-type="uri" xlink:href="https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html">https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html</ext-link></p></list-item><list-item><p id="Par87">Seurat: <ext-link ext-link-type="uri" xlink:href="https://satijalab.org/seurat/archive/v3.2/integration.html">https://satijalab.org/seurat/archive/v3.2/integration.html</ext-link></p></list-item><list-item><p id="Par88">SpatialDWLS: <ext-link ext-link-type="uri" xlink:href="https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html">https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html</ext-link></p></list-item><list-item><p id="Par89">SPOTlight: <ext-link ext-link-type="uri" xlink:href="https://marcelosua.github.io/SPOTlight">https://marcelosua.github.io/SPOTlight</ext-link></p></list-item><list-item><p id="Par90">Stereoscope:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html">https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html</ext-link></p></list-item><list-item><p id="Par91">STRIDE: <ext-link ext-link-type="uri" xlink:href="https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html">https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html</ext-link></p></list-item><list-item><p id="Par92">Tangram: <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/Tangram">https://github.com/broadinstitute/Tangram</ext-link></p></list-item></list></p>
      <p id="Par93">The hyperparameters used for each method were reported in Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>.</p>
    </sec>
    <sec id="Sec27">
      <title>Statistics &amp; reproducibility</title>
      <p id="Par94">No statistical method was used to predetermine sample size. In Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>, the CARD was excluded from the benchmark on the scRNA-seq data simulated datasets due to lack of spatial information for these datasets. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>, the STRIDE was not shown in Stereo-seq mouse embryo brain dataset due to a runtime error for this dataset. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a</xref>, two slices were excluded due to the lack of L6b cells, which prevented the definition of ground truth. The experiments were not randomized. The Investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec28">
      <title>Reporting summary</title>
      <p id="Par95">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec29">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43220_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43220_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43220_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43220_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43220_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_43220_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_43220_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec30">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2023_43220_MOESM8_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Hao Xu, Shuyan Wang.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43220-3.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200 to K.Q.), the National Natural Science Foundation of China grants (T2125012 and 91940306 to K.Q.; 32170668 to B.L.), CAS Project for Young Scientists in Basic Research YSBR-005 (to K.Q.), Anhui Province Science and Technology Key Program (202003a07020021 to K.Q.) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158 to K.Q.). We thank the USTC Supercomputing Center and the School of Life Science Bioinformatics Center for providing computing resources for this project.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>K.Q., J.L., and B.L. conceived the project. H.X., J.L., and S.Wang designed the framework and performed data analysis with the help of M.F., S.L., C.C., S.Wan, R.W., M.T., and T.X.; B.L., K.Q., H.X., and J.L. wrote the manuscript with input from all authors. K.Q. and J.L. supervised the entire project. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par96"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. The simulation datasets used for the evaluation of Spoint and other deconvolution methods are available in a GitHub repository at <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SpatialBenchmarking">https://github.com/QuKunLab/SpatialBenchmarking</ext-link>. The raw data of 11 ST datasets and five paired single-cell/nucleus RNA sequence datasets are available from the following studies: (1) 12 slices of human DLPFC 10X Visium data at <ext-link ext-link-type="uri" xlink:href="http://research.libd.org/spatialLIBD/">http://research.libd.org/spatialLIBD/</ext-link><sup><xref ref-type="bibr" rid="CR34">34</xref></sup>; (2) six slices of human breast cancer 10X Visium data at 10.5281/zenodo.4739739<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (3) four slices of human breast cancer 10X Visium data: Parent_Visium_Human_BreastCancer, V1_Breast_Cancer_Block_A_Section_1, V1_Breast_Cancer_Block_A_Section_2 and Visium_FFPE_Human_Breast_Cancer at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR14">14</xref></sup>; (4) one slice of human breast cancer 10X Visium data: Invasive Ductal Carcinoma Stained With Fluorescent CD3 Antibody at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR30">30</xref></sup>; (5) Mouse brain STARmap data at <ext-link ext-link-type="uri" xlink:href="https://www.starmapresources.org/data">https://www.starmapresources.org/data</ext-link><sup><xref ref-type="bibr" rid="CR58">58</xref></sup>; (6) 33 slices of Mouse MOp MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://doi.brainimagelibrary.org/doi/10.35077/g.21">https://doi.brainimagelibrary.org/doi/10.35077/g.21</ext-link><sup><xref ref-type="bibr" rid="CR13">13</xref></sup>; (7) one slice of mouse E16.5 embryo brain Stereo-seq data, one slice of mouse brain Stereo-seq data, and 13 slices of mouse E16.5 whole embryo Stereo-seq data at <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</ext-link><sup><xref ref-type="bibr" rid="CR4">4</xref></sup>; (8) ten slice of human brain MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw">https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw</ext-link><sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; (9) 75 slice of mouse whole brain Spatial Transcriptomics data are available in the GEO database under accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE147747">GSE147747</ext-link><sup><xref ref-type="bibr" rid="CR60">60</xref></sup>; (10) single-nucleus transcriptomics data across multiple human cortical areas at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq">https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq</ext-link><sup><xref ref-type="bibr" rid="CR51">51</xref></sup>; (11) single-cell transcriptomics data of human breast cancer data at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1039">https://singlecell.broadinstitute.org/single_cell/study/SCP1039</ext-link><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (12) single-cell transcriptomics data of mouse embryo brain at <ext-link ext-link-type="uri" xlink:href="http://mousebrain.org/development/downloads.html">http://mousebrain.org/development/downloads.html</ext-link><sup><xref ref-type="bibr" rid="CR83">83</xref></sup>; (13) single-cell transcriptomics data of mouse whole cortex and hippocampus at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x">https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x</ext-link><sup><xref ref-type="bibr" rid="CR52">52</xref></sup>; (14) single-cell transcriptomics data of mouse whole brain at mousebrain.org/adolescent/downloads.html<sup><xref ref-type="bibr" rid="CR84">84</xref></sup>. All the aforementioned data used in this study are available in a public Zenodo repository at 10.5281/zenodo.8316334. Source data for figures are provided with this paper. <xref ref-type="sec" rid="Sec30">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The open-source package of SPACEL is available at a GitHub repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SPACEL">https://github.com/QuKunLab/SPACEL</ext-link><sup><xref ref-type="bibr" rid="CR85">85</xref></sup>. We uploaded all codes and scripts used for the analyses and figure plotting in this study to a public Zenodo repository (10.5281/zenodo.8316334). The documentation, usage instructions and other relevant information related to SPACEL can be accessed through (<ext-link ext-link-type="uri" xlink:href="https://spacel.readthedocs.org">https://spacel.readthedocs.org</ext-link>).</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par97">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>353</volume>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srivatsan</surname>
            <given-names>SR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Embryo-scale, single-cell spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2021</year>
        <volume>373</volume>
        <fpage>111</fpage>
        <lpage>117</lpage>
        <pub-id pub-id-type="pmid">34210887</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <year>2022</year>
        <volume>185</volume>
        <fpage>1777</fpage>
        <lpage>1792</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergmann</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial profiling of early primate gastrulation in utero</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>609</volume>
        <fpage>136</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">35709828</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>SM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial omics and multiplexed imaging to explore cancer biology</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>997</fpage>
        <lpage>1012</lpage>
        <pub-id pub-id-type="pmid">34341583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>W-T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics and in situ sequencing to study Alzheimer’s Disease</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>976</fpage>
        <lpage>991</lpage>
        <pub-id pub-id-type="pmid">32702314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752</lpage>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuppe</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial multi-omic map of human myocardial infarction</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>766</fpage>
        <lpage>777</lpage>
        <pub-id pub-id-type="pmid">35948637</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Erickson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved clonal copy number alterations in benign and malignant tissue</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>360</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="pmid">35948708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shah</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lubeck</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>In situ transcription profiling of single cells reveals spatial organization of cells in the mouse hippocampus</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>92</volume>
        <fpage>342</fpage>
        <lpage>357</lpage>
        <pub-id pub-id-type="pmid">27764670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>932</fpage>
        <lpage>935</lpage>
        <pub-id pub-id-type="pmid">30377364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved cell atlas of the mouse primary motor cortex by MERFISH</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>598</volume>
        <fpage>137</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">34616063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Visium spatial gene expression. <italic>10x Genomics</italic> (2020).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriques</surname>
            <given-names>SG</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>363</volume>
        <fpage>1463</fpage>
        <lpage>1467</lpage>
        <pub-id pub-id-type="pmid">30923225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with Slide-seqV2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Lopez, R. et al. A joint model of unpaired data from scRNA-seq and spatial transcriptomics for imputing missing gene expression measurements. Preprint at <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1905.02269">http://arxiv.org/abs/1905.02269</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Loog</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>van de Wiel</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
          <name>
            <surname>Wessels</surname>
            <given-names>LFA</given-names>
          </name>
        </person-group>
        <article-title>PRECISE: a domain adaptation approach to transfer predictors of drug response from pre-clinical models to tumors</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>i510</fpage>
        <lpage>i519</lpage>
        <pub-id pub-id-type="pmid">31510654</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mahfouz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
        </person-group>
        <article-title>SpaGE: spatial gene enhancement using scRNA-seq</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2020</year>
        <volume>48</volume>
        <fpage>e107</fpage>
        <lpage>e107</lpage>
        <pub-id pub-id-type="pmid">32955565</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Biancalani</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with Tangram</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1352</fpage>
        <lpage>1362</lpage>
        <pub-id pub-id-type="pmid">34711971</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kleshchevnikov</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>661</fpage>
        <lpage>671</lpage>
        <pub-id pub-id-type="pmid">35027729</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cable</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust decomposition of cell type mixtures in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>517</fpage>
        <lpage>526</lpage>
        <pub-id pub-id-type="pmid">33603203</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G-C</given-names>
          </name>
        </person-group>
        <article-title>SpatialDWLS: accurate deconvolution of spatial transcriptomic data</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>145</fpage>
        <pub-id pub-id-type="pmid">33971932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andersson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title>
        <source>Commun. Biol.</source>
        <year>2020</year>
        <volume>3</volume>
        <fpage>565</fpage>
        <pub-id pub-id-type="pmid">33037292</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elosua-Bayes</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Gut</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Heyn</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>SPOTlight: seeded NMF regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>e50</fpage>
        <pub-id pub-id-type="pmid">33544846</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Song</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>DSTG: deconvoluting spatial transcriptomics data through graph-based artificial intelligence</article-title>
        <source>Brief. Bioinform.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>bbaa414</fpage>
        <pub-id pub-id-type="pmid">33480403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>STRIDE: accurately decomposing and integrating spatial transcriptomics using single-cell RNA sequencing</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e42</fpage>
        <lpage>e42</lpage>
        <pub-id pub-id-type="pmid">35253896</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DestVI identifies continuums of cell types in spatial transcriptomics data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1360</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="pmid">35449415</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Spatially informed cell-type deconvolution for spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1349</fpage>
        <lpage>1359</lpage>
        <pub-id pub-id-type="pmid">35501392</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention auto-encoder</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1739</fpage>
        <pub-id pub-id-type="pmid">35365632</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Pham, D. et al. stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. Preprint at 10.1101/2020.05.31.125658 (2020).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maynard</surname>
            <given-names>KR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>425</fpage>
        <lpage>436</lpage>
        <pub-id pub-id-type="pmid">33558695</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multimodal analysis of composition and spatial architecture in human squamous</article-title>
        <source>Cell Carcinoma Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>497</fpage>
        <lpage>514</lpage>
        <pub-id pub-id-type="pmid">32579974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive analysis of spatial architecture in primary liver cancer</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabg3750</fpage>
        <pub-id pub-id-type="pmid">34919432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Shivashankar</surname>
            <given-names>GV</given-names>
          </name>
          <name>
            <surname>Uhler</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Graph-based autoencoder integrates spatial transcriptomics with chromatin images and identifies joint biomarkers for Alzheimer’s disease</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>7480</fpage>
        <pub-id pub-id-type="pmid">36463283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic embedding, clustering, and alignment for integrating spatial transcriptomics data with PRECAST</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="pmid">36653349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Zhou, X., Dong, K. &amp; Zhang, S. Integrating spatial transcriptomics data across different conditions, technologies, and developmental stages. <italic>Nat. Comput. Sci.</italic><bold>3</bold>, 894–906 (2023).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeira</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Land</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Strzalkowski</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Raphael</surname>
            <given-names>BJ</given-names>
          </name>
        </person-group>
        <article-title>Alignment and integration of spatial transcriptomics data</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>567</fpage>
        <lpage>575</lpage>
        <pub-id pub-id-type="pmid">35577957</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <mixed-citation publication-type="other">Defferrard, M., Bresson, X. &amp; Vandergheynst, P. Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering. in <italic>Advances in Neural Information Processing Systems</italic> (2016).</mixed-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Kipf, T. N. &amp; Welling, M. Semi-Supervised Classification with Graph Convolutional Networks. in <italic>International Conference on Learning Representations</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <mixed-citation publication-type="other">Goodfellow, I. et al. Generative Adversarial Nets. in <italic>Advances in Neural Information Processing Systems</italic> (2014).</mixed-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>MacQueen</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Some methods for classification and analysis of multivariate observations</article-title>
        <source>Proc. Fifth Berkeley Symp. Math. Stat. Probab.</source>
        <year>1967</year>
        <volume>1</volume>
        <fpage>281</fpage>
        <lpage>298</lpage>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storn</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Differential Evolution – A Simple and Efficient Heuristic for global Optimization over Continuous Spaces</article-title>
        <source>J. Glob. Optim.</source>
        <year>1997</year>
        <volume>11</volume>
        <fpage>341</fpage>
        <lpage>359</lpage>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fang</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conservation and divergence of cortical cell organization in human and mouse revealed by MERFISH</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>377</volume>
        <fpage>56</fpage>
        <lpage>62</lpage>
        <pub-id pub-id-type="pmid">35771910</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>662</fpage>
        <lpage>670</lpage>
        <pub-id pub-id-type="pmid">35577954</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hodge</surname>
            <given-names>RD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conserved cell types with divergent features in human versus mouse cortex</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>573</volume>
        <fpage>61</fpage>
        <lpage>68</lpage>
        <pub-id pub-id-type="pmid">31435019</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e26</lpage>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Shepherd</surname>
            <given-names>GMG</given-names>
          </name>
        </person-group>
        <article-title>The neocortical circuit: themes and variations</article-title>
        <source>Nat. Neurosci.</source>
        <year>2015</year>
        <volume>18</volume>
        <fpage>170</fpage>
        <lpage>181</lpage>
        <pub-id pub-id-type="pmid">25622573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">10X Genomics Datasets. <italic>10X Genomics</italic><ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets">https://www.10xgenomics.com/resources/datasets</ext-link> (2021).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baslan</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel insights into breast cancer copy number genetic heterogeneity revealed by single-cell genome sequencing</article-title>
        <source>eLife</source>
        <year>2020</year>
        <volume>9</volume>
        <fpage>e51480</fpage>
        <pub-id pub-id-type="pmid">32401198</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Timothy, T., Itay, T., Georgescu, C., Maxwell, B. &amp; Brian, H. inferCNV of the Trinity CTAT Project. (2019).</mixed-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>361</volume>
        <fpage>eaat5691</fpage>
        <pub-id pub-id-type="pmid">29930089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Hagan</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Curve fitting and optimal design for prediction</article-title>
        <source>J. R. Stat. Soc. Ser. B Methodol.</source>
        <year>1978</year>
        <volume>40</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ortiz</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular atlas of the adult mouse brain</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eabb3446</fpage>
        <pub-id pub-id-type="pmid">32637622</pub-id>
      </element-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Krizhevsky, A., Sutskever, I. &amp; Hinton, G. E. ImageNet Classification with Deep Convolutional Neural Networks. in <italic>Advances in Neural Information Processing Systems</italic> (2012).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Devlin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>M-W</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Toutanova</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</article-title>
        <source>Proc. naacL-HLT</source>
        <year>2019</year>
        <volume>1</volume>
        <fpage>4171</fpage>
        <lpage>4186</lpage>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902</lpage>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stein-O’Brien</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Decomposing Cell Identity for Transfer Learning across Cellular Measurements, Platforms, Tissues, and Species</article-title>
        <source>Cell Syst.</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>395</fpage>
        <lpage>411</lpage>
        <pub-id pub-id-type="pmid">31121116</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data denoising with transfer learning in single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>875</fpage>
        <lpage>878</lpage>
        <pub-id pub-id-type="pmid">31471617</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Weigert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Broaddus</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Cell Detection with Star-convex Polygons</article-title>
        <source>Med. Image Comput. Computer Assist. Intervention–MICCAI 2018: 21st Int. Conf., Granada, Spain,</source>
        <year>2018</year>
        <volume>11</volume>
        <fpage>265</fpage>
        <lpage>273</lpage>
      </element-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bannon</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DeepCell Kiosk: scaling deep learning–enabled cellular image analysis with Kubernetes</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>43</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="pmid">33398191</pub-id>
      </element-citation>
    </ref>
    <ref id="CR69">
      <label>69.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR70">
      <label>70.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fukushima</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Cognitron: A self-organizing multilayered neural network</article-title>
        <source>Biol. Cybern.</source>
        <year>1975</year>
        <volume>20</volume>
        <fpage>121</fpage>
        <lpage>136</lpage>
        <pub-id pub-id-type="pmid">1203338</pub-id>
      </element-citation>
    </ref>
    <ref id="CR71">
      <label>71.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kullback</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Leibler</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>On Information and Sufficiency</article-title>
        <source>Ann. Math. Stat.</source>
        <year>1951</year>
        <volume>22</volume>
        <fpage>79</fpage>
        <lpage>86</lpage>
      </element-citation>
    </ref>
    <ref id="CR72">
      <label>72.</label>
      <mixed-citation publication-type="other">He, K., Zhang, X., Ren, S. &amp; Sun, J. Delving Deep into Rectifiers: Surpassing Human-Level Performance on ImageNet Classification. in <italic>Proceedings of the IEEE international conference on computer vision</italic> 1026–1034 (2015).</mixed-citation>
    </ref>
    <ref id="CR73">
      <label>73.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: A Method for Stochastic Optimization. in <italic>International Conference for Learning Representations</italic> (2015).</mixed-citation>
    </ref>
    <ref id="CR74">
      <label>74.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hammond</surname>
            <given-names>DK</given-names>
          </name>
          <name>
            <surname>Vandergheynst</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gribonval</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Wavelets on graphs via spectral graph theory</article-title>
        <source>Appl. Comput. Harmon. Anal.</source>
        <year>2011</year>
        <volume>30</volume>
        <fpage>129</fpage>
        <lpage>150</lpage>
      </element-citation>
    </ref>
    <ref id="CR75">
      <label>75.</label>
      <mixed-citation publication-type="other">Glorot, X. &amp; Bengio, Y. Understanding the difficulty of training deep feedforward neural networks. in <italic>Proceedings of the Thirteenth International Conference on Artificial Intelligence and Statistics</italic><bold>9</bold>, 249–256 (2010).</mixed-citation>
    </ref>
    <ref id="CR76">
      <label>76.</label>
      <mixed-citation publication-type="other">Davies, D. L. &amp; Bouldin, D. W. A Cluster Separation Measure. <italic>IEEE Trans. Pattern Anal. Mach. Intell</italic>. <bold>PAMI-1</bold>, 224–227 (1979).</mixed-citation>
    </ref>
    <ref id="CR77">
      <label>77.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: Machine Learning in Python</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR78">
      <label>78.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edelsbrunner</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Kirkpatrick</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Seidel</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>On the shape of a set of points in the plane</article-title>
        <source>IEEE Trans. Inf. Theory</source>
        <year>1983</year>
        <volume>29</volume>
        <fpage>551</fpage>
        <lpage>559</lpage>
      </element-citation>
    </ref>
    <ref id="CR79">
      <label>79.</label>
      <mixed-citation publication-type="other">Zhou, Q.-Y., Park, J. &amp; Koltun, V. Open3D: A Modern Library for 3D Data Processing. Preprint at 10.48550/arXiv.1801.09847 (2018).</mixed-citation>
    </ref>
    <ref id="CR80">
      <label>80.</label>
      <mixed-citation publication-type="other">Loop, C. Smooth Subdivision Surfaces Based on Triangles. (1987).</mixed-citation>
    </ref>
    <ref id="CR81">
      <label>81.</label>
      <mixed-citation publication-type="other">Basak, S., Petit, S., Bect, J. &amp; Vazquez, E. Numerical issues in maximum likelihood parameter estimation for Gaussian process interpolation. in <italic>International Conference on Machine Learning, Optimization, and Data Science</italic> 116–131 (2021).</mixed-citation>
    </ref>
    <ref id="CR82">
      <label>82.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR83">
      <label>83.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR84">
      <label>84.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular Architecture of the Mouse Nervous System</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>999</fpage>
        <lpage>1014</lpage>
        <pub-id pub-id-type="pmid">30096314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR85">
      <label>85.</label>
      <mixed-citation publication-type="other">Xu, H. &amp; Wang, S. SPACEL: deep-learning based characterization of spatial transcriptome architectures. Zenodo, 10.5281/zenodo.8419717 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10663563</article-id>
    <article-id pub-id-type="publisher-id">43220</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-43220-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SPACEL: deep learning-based characterization of spatial transcriptome architectures</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xu</surname>
          <given-names>Hao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Wang</surname>
          <given-names>Shuyan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fang</surname>
          <given-names>Minghao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luo</surname>
          <given-names>Songwen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Chunpeng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Siyuan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Rirui</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tang</surname>
          <given-names>Meifang</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6187-122X</contrib-id>
        <name>
          <surname>Xue</surname>
          <given-names>Tian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0485-3724</contrib-id>
        <name>
          <surname>Li</surname>
          <given-names>Bin</given-names>
        </name>
        <address>
          <email>libin@nibs.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7087-6540</contrib-id>
        <name>
          <surname>Lin</surname>
          <given-names>Jun</given-names>
        </name>
        <address>
          <email>linjun7@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5555-8437</contrib-id>
        <name>
          <surname>Qu</surname>
          <given-names>Kun</given-names>
        </name>
        <address>
          <email>qukun@ustc.edu.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Department of Oncology, The First Affiliated Hospital of USTC, School of Basic Medical Sciences, Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff2"><label>2</label>Institute of Artificial Intelligence, Hefei Comprehensive National Science Center, Hefei, 230088 China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>School of Data Science, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/04c4dkn09</institution-id><institution-id institution-id-type="GRID">grid.59053.3a</institution-id><institution-id institution-id-type="ISNI">0000 0001 2167 9639</institution-id><institution>Division of Life Sciences and Medicine, </institution><institution>University of Science and Technology of China, </institution></institution-wrap>Hefei, 230027 China </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/00wksha49</institution-id><institution-id institution-id-type="GRID">grid.410717.4</institution-id><institution-id institution-id-type="ISNI">0000 0004 0644 5086</institution-id><institution>National Institute of Biological Sciences, </institution></institution-wrap>Beijing, 102206 China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>7603</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Spatial transcriptomics (ST) technologies detect mRNA expression in single cells/spots while preserving their two-dimensional (2D) spatial coordinates, allowing researchers to study the spatial distribution of the transcriptome in tissues; however, joint analysis of multiple ST slices and aligning them to construct a three-dimensional (3D) stack of the tissue still remain a challenge. Here, we introduce spatial architecture characterization by deep learning (SPACEL) for ST data analysis. SPACEL comprises three modules: Spoint embeds a multiple-layer perceptron with a probabilistic model to deconvolute cell type composition for each spot in a single ST slice; Splane employs a graph convolutional network approach and an adversarial learning algorithm to identify spatial domains that are transcriptomically and spatially coherent across multiple ST slices; and Scube automatically transforms the spatial coordinate systems of consecutive slices and stacks them together to construct a 3D architecture of the tissue. Comparisons against 19 state-of-the-art methods using both simulated and real ST datasets from various tissues and ST technologies demonstrate that SPACEL outperforms the others for cell type deconvolution, for spatial domain identification, and for 3D alignment, thus showcasing SPACEL as a valuable integrated toolkit for ST data processing and analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Spatial transcriptomics (ST) technologies detect transcript distribution in space. Here, authors present a deep learning based method SPACEL for cell type deconvolution, spatial domain identification and 3D alignment, showcasing it as a valuable toolkit for ST data analysis</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Bioinformatics</kwd>
      <kwd>Computational models</kwd>
      <kwd>Sequencing</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200),the National Natural Science Foundation of China grants (T2125012 and 91940306), CAS Project for Young Scientists in Basic Research YSBR-005, Anhui Province Science and Technology Key Program (202003a07020021) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (32170668),</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>the National Natural Science Foundation of China grants (81871479), the Fundamental Research Funds for the Central Universities (WK9100000001).</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Spatial transcriptomics (ST) technologies have enabled researchers to detect the spatial distribution of, in principle, the entire transcriptome in histological tissue slices and thereby substantially improved our understanding of organ architecture<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR5">5</xref></sup> and disease microenvironments<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR10">10</xref></sup>. There are two broad categories of experimental ST techniques that can either i) detect the expression of a partial transcriptome at single cell resolution or ii) detect an entire transcriptome without single-cell resolution. ST techniques based on in situ hybridization and fluorescence microscopy (image-based), such as seqFISH<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, osmFISH<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, and MERFISH<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> probe only hundreds to thousands of transcripts in a slice, but can achieve single cell and even subcellular resolution. ST techniques based on next-generation sequencing (seq-based), such as 10X Visium<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>, Slide-seq<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref></sup> and Stereo-seq<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> detect the expression of the whole transcriptome, but the resolution is restricted by the size of spots in the ST slices. Owing to limitations of these experimental ST techniques, many analytical methods have been developed to impute the undetected transcripts on each slice<sup><xref ref-type="bibr" rid="CR17">17</xref>–<xref ref-type="bibr" rid="CR20">20</xref></sup> and/or to deconvolute the cell types in each spot<sup><xref ref-type="bibr" rid="CR21">21</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, aiming to detect an entire transcriptome while retaining single-cell resolution.</p>
    <p id="Par4">A recent computational task for ST data analysis is the identification of clusters of cells/spots that are coherent in both transcriptome expression and spatial coordinates—i.e., dissecting the so-called spatial domains to characterize the spatial architecture present within an ST slice. Several methods have been developed to accomplish this task. For example, BayesSpace employs a Bayesian model and a Markov chain Monte Carlo approach to improve the resolution of ST data to the subspot level and then identifies spatial domains by clustering these subspots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. SpaGCN adopts a graph convolutional network to integrate the transcript expression level data with their spatial location information to identify spatial domains<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. STAGATE uses an adaptive graph attention auto-encoder model to learn the similarities between the neighboring spots to identify spatial domains<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. stLearn leverages a Louvain clustering algorithm and k-d tree nearest neighbor searching to identify spatial domains in ST slices<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The above-mentioned methods were designed for analyzing single ST slices.</p>
    <p id="Par5">The current trends for the rapid development and application of ST technologies suggest that a large number of ST slices from diverse tissues (and conditions) will be generated in scientific and medical studies for the foreseeable future<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR34">34</xref>–<xref ref-type="bibr" rid="CR37">37</xref></sup>. Accordingly, there is an urgent need for computational tools that can quickly and efficiently implement integrated analysis of data from multiple ST slices. STACI<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, PRECAST<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> aimed to identify spatial domains jointly across multiple ST slices. These methods utilize gene expression as the input for their models, specifically, STACI adopts an over-parameterization approach, PRECAST uses simple projections of the batch effects onto the space of biological effects and STAligner employs triplet-loss for training. However, it has been reported that cell-type distribution is more robust for identifying uniform domains across multiple slices<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>.</p>
    <p id="Par6">Accurately identifying functional spatial domains across multiple slices and reconstructing the 3D architecture of tissues offer invaluable opportunities for significant biological discoveries in various practical applications. The PASTE<sup><xref ref-type="bibr" rid="CR41">41</xref></sup> and STAligner<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> methods made an effort to address these difficulties by integrating multiple slices into a single center slice, and/or aligning the consecutive slices to construct a 3D architecture of the tissue. PASTE assumes complete 2D overlap of slices, which restricts its applicability to cases where slices have only partial overlap. STAligner relies on selected landmark domains shared across slices for alignment and does not utilize correspondences for each individual spot in adjacent slices. As a result, these approaches can encounter misalignment issues in accurately capturing the global structure. Overall, constructing a stacked 3D alignment of the tissue still remains a great challenge for ST datasets with substantial defects.</p>
    <p id="Par7">Here, we developed SPACEL, a deep-learning-based toolkit comprising three modules—Spoint, Splane, and Scube—covering three analysis tasks for ST data (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). Spoint predicts the cell type composition of spots obtained by seq-based ST technologies such as 10X Visium. Splane jointly analyzes multiple ST slices and identifies spatial domains based on the cell type composition and spatial coordinate information of spots/cells. Scube aligns multiple consecutive slices and constructs a stacked 3D architecture of the tissue based on the coordinates of the spatial domains identified by Splane. We applied SPACEL to analyze 11 ST datasets comprising 156 slices acquired using the 10X Visium, STARmap, MERFISH, Stereo-seq, and Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> technologies (Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). SPACEL outperformed other state-of-the-art methods for each of the three examined analysis tasks and thus represents a valuable integrated toolkit for ST data processing and analysis.<fig id="Fig1"><label>Fig. 1</label><caption><title>Workflow of SPACEL.</title><p><bold>a</bold> Three modules of SPACEL: Spoint, Splane, and Scube. <bold>b</bold> Spoint deconvolutes cell types of spots using an MLP and a probability model. MLP, multiple-layer perceptron; VAE, variational autoencoder. <bold>c</bold> Splane employs a GCN model and an adversarial learning algorithm to identify spatial domains across multiple slices. GCN, graph convolutional network. <bold>d</bold> For consecutive slices, Scube adopts a mutual nearest neighbor (MNN) graph and the differential evolution algorithm to transform slices and construct a stacked 3D alignment of a tissue.</p></caption><graphic xlink:href="41467_2023_43220_Fig1_HTML" id="d32e409"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Workflow of SPACEL</title>
      <p id="Par8">The full architecture of SPACEL is illustrated in Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, including the modules Spoint, Splane and Scube. Our motivation for developing the Spoint module is the need to perform cell type deconvolution on ST slices generated by seq-base ST technologies, which is also required for subsequent analysis of SPACEL. Spoint embedded a multiple-layer perceptron (MLP) with a probabilistic model to deconvolute the cell type composition of each ST spot (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>, Methods). Spoint leverages a combination of simulated pseudo-spots, neural network modeling, and statistical recovery of expression profiles, which allows it to provide a more robust and accurate framework for estimating cell-type proportions in real ST data. For image-based ST data (i.e., single-cell resolution), users can simply use single-cell analysis tools (e.g., Seurat<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> and Scanpy<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>) to cluster cells and use marker genes to identify the cell type of each cell cluster.</p>
      <p id="Par9">Splane employs a graph convolutional network (GCN) approach<sup><xref ref-type="bibr" rid="CR44">44</xref>,<xref ref-type="bibr" rid="CR45">45</xref></sup> and an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to identify spatial domains by jointly analyzing multiple ST slices (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>, Methods). First, for each ST slice, Splane calculates an adjacency matrix of cells/spots based on their distance in space. Then, Splane constructs a GCN model from the adjacency matrix and the cell type composition of cells/spots, and employs an adversarial learning algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> to learn the latent features shared across all of the analyzed ST slices; we term this a joint analysis scheme. Next, Splane applies a K-means clustering algorithm<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> to aggregate cells/spots with similar patterns of the shared latent features, where each of these cell/spot clusters is referred to as a spatial domain. All existing spatial-domain identification tools commonly utilize gene expression as input for their analyses and most of them follow a single analysis scheme. Splane distinguishes itself by utilizing cell-type composition as the input and adopting a joint analysis scheme. Furthermore, Splane incorporates an adversarial training to explicitly tackle and eliminate batch effects across multiple slices.</p>
      <p id="Par10">For ST datasets containing consecutive slices, Scube aligns the Splane predicted coordinate systems for each pair of adjacent slices and then constructs a stacked 3D architecture of the tissue, which is fully automated and does not require any manual alignment (Fig. <xref rid="Fig1" ref-type="fig">1d</xref>, Methods). Briefly, Scube builds a mutual nearest neighbor (MNN) graph between the cells/spots of two adjacent slices based on the coordinate information of spots and constructs an alignment objective function between them. This function serves as the foundation for aligning the slices and treats the alignment task as an optimization problem. Unlike existing tools like PASTE or STAligner, Scube is specifically designed to handle partially overlapped slices by incorporating a penalty term that accounts for the proportion of overlapped spots in adjacent slices. Scube then employs a differential evolution optimization algorithm<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> to search for the optimal translation vectors and rotation angles for each slice, and aligns them by transforming the coordinates of every slice accordingly. Finally, Scube stacks the transformed slices to construct the 3D architecture of the tissue.</p>
      <p id="Par11">In summary, Spoint, Splane, and Scube accomplished three analysis tasks of ST data in turn: cell type deconvolution, spatial domain identification, and 3D architecture construction. We have carefully designed each module of our method in an innovative way to address the potential limitations of current state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>). Specifically, Spoint employs a statistical model, a pseudo-spot simulation, a deep learning technique, and an elimination of variation between reference and ST data. In contrast, other tools often miss one or more of these features. Splane is unique in its combination of a cell type composition as input — a feature not utilized by any other tools, and adversarial training in the GCN model — a common approach first been employed to mitigate batch effects in ST data. Scube employs a unique global optimization strategy for 3D alignment, setting it apart from its peers. While each of these modules can operate independently, they are also optimized to work seamlessly in a unified workflow. This adaptability enables SPACEL to analyze data from diverse experimental platforms while simultaneously providing an all-encompassing and streamlined solution for ST data interpretation.</p>
      <p id="Par12">To ensure the robustness of SPACEL, we conducted extensive experiments to evaluate its performance across various hyperparameter settings. Our results demonstrate that Spoint, Splane, and Scube exhibit superior robustness to hyperparameter variation compared to other state-of-the-art methods (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a–c</xref>), highlighting the effectiveness of SPACEL in providing reliable and consistent results across different experimental settings.</p>
    </sec>
    <sec id="Sec4">
      <title>Spoint accurately deconvolutes cell-type composition</title>
      <p id="Par13">To construct the training set for Spoint and other deconvolution methods, we simulated pseudo-spots using the scRNA-seq dataset by assuming a normal distribution of the number of cells and the number of cell types per spot. Our simulations generated pseudo-spots similar to real ST data (MERFISH data from human brain tissue<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2d–k</xref>). We compared the performance of Spoint with state-of-the-art methods for cell type deconvolution, including Cell2lacation, SpatialDWLS, RCTD, STRIDE, Stereoscope, Tangram, DestVI, Seurat, SPOTlight, and DSTG using 32 simulated datasets from a benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). We adopted Pearson’s correlation coefficient (PCC) and structural similarity index measure (SSIM) to assess the similarity between the predicted and true cell type compositions, and used root mean square deviation (RMSE) and Jensen-Shannon divergence (JSD) to assess the error of each method. Spoint yielded the highest average PCC/SSIM values (= 0.73/0.69), and the lowest average RMSE/JSD values (=0.05/0.41) among the 11 deconvolution methods (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Additionally, we applied the accuracy score (AS) defined in the benchmark study to evaluate the performance of each method: the average AS of Spoint ( = 0.93) was obviously higher than that of the other methods (AS = 0.24–0.82; Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Cell type deconvolution of spots using Spoint and other deconvolution methods.</title><p><bold>a</bold> Average PCC, SSIM, RMSE, and JSD values of the deconvolution methods for 32 simulated datasets from the benchmark study<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>; PCC, pearson’s correlation coefficient<bold>;</bold> SSIM, structural similarity index measure; RMSE, root mean square error; JSD, Jensen-Shannon divergence; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>b</bold> Accuracy scores of the deconvolution methods for the 32 simulated datasets. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 32 datasets. <bold>c</bold> Spatial distributions of excitatory layer 3/4 RORB<sup>+</sup>RPS3P6<sup>+</sup> neurons predicted by the deconvolution methods for the DLPFC dataset. <bold>d</bold> Accuracy scores of the deconvolution methods for the DLPFC dataset. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 56 cell types. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig2_HTML" id="d32e541"/></fig></p>
      <p id="Par14">To evaluate Spoint’s performance in cell type deconvolution on real ST experimental data, we used two datasets as input: a 10X Visium dataset for the human dorsolateral prefrontal cortex (DLPFC) that contains 12 ST slices<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> and a human brain scRNA-seq dataset downloaded from the Allen Brain Map<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. As there is no experimental evidence for the cell type composition of each spot in this dataset, we took the cortical layers annotated by the original studies as ground truth (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a–c</xref>). As one example, we found that the distribution of excitatory L3/4 neurons predicted by Spoint had a higher AS value (= 0.85) than the other examined deconvolution methods (AS = 0.29–0.64; Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Collectively, for all 56 cell types<sup><xref ref-type="bibr" rid="CR52">52</xref>,<xref ref-type="bibr" rid="CR53">53</xref></sup> in all 12 ST slices, the average AS of Spoint ( = 0.60) was again higher than those of the other methods (average AS = 0.30–0.48; Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Furthermore, we calculated the significance (using the Wilcoxon Rank Sum test) of any difference in the proportion of one cell type between the layers, with a lower <italic>P</italic>-value representing increased deconvolution accuracy<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. We found that the average <italic>P</italic>-value of Spoint ( = 0.01) was lower than that of the other methods (average <italic>P</italic>-values = 0.05–0.64; Supplementary Fig. <xref rid="MOESM1" ref-type="media">3d</xref>).</p>
      <p id="Par15">To further evaluate Spoint’s performance in real ST datasets, we collected three single-cell resolution ST datasets: Chen et al. mouse embryo brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Chen et al. mouse brain (Stereo-seq)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and Fang et al. human brain (MERFISH with 4000 genes)<sup><xref ref-type="bibr" rid="CR49">49</xref></sup> to simulate spot-level ST data with known cell-type composition and spatial context. We also obtained the corresponding scRNA-seq data from the same tissue types as reference. Using these data, we aggregated approximately 10 cells into each pseudo spot, creating three distinct spot-level ST datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>). As an example, we observed that Spoint achieved the highest PCC compare to other cell type deconvolution methods for forebrain glutamatergic neuroblast in dataset 1 (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). We then evaluated the deconvolution performance of the Spoint module on all cell types across the three datasets using four evaluation metrics. Our findings demonstrate that Spoint consistently outperformed existing methods, achieving the highest accuracy scores in all three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4c, d</xref>). In addition, we evaluated the relative error between the summed predicted cell type proportions and the ground truth, and found that SpatialDWLS (with rankings of 1, 2, and 3) and Spoint (with rankings of 4, 3, and 1) registered the lowest average relative error across the three datasets (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>). These results provide strong evidence of the Spoint module’s superior performance over other methods, and an accurate deconvolution result will facilitate subsequent identification of spatial domains using Splane.</p>
    </sec>
    <sec id="Sec5">
      <title>Splane identifies spatial domains for multiple slices</title>
      <p id="Par16">After cell types were deconvoluted with Spoint, we applied Splane to identify the spatial domains of the aforementioned ST slices of the DLPFC dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). We used the original study’s manual annotation of cortical layers as the ground truth<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, and used three metrics to evaluate the prediction performance. Specifically, we used the Jaccard index (JI) and Adjusted Rand Index (ARI) between a spatial domain identified by Splane and the corresponding cortical layer from the ground truth to assess the accuracy of the method, and computed the shifting distance (SD) between the prediction and the ground truth to quantify the error of Splane (see Methods). A higher JI/ARI value or a lower SD value indicates that the prediction is closer to the ground truth.</p>
      <p id="Par17">First, we compared the results obtained by processing all slices jointly (joint analysis, by default) to those obtained by processing each slice individually (single analysis). To enable this comparison, we built a test version of Splane, namely, Splane-single, that constructs a GCN model for each slice individually. Taking slices 151508, 151510, 151670, and 151673 from the DLPFC dataset as examples, the JI values obtained by the joint analysis were higher than those obtained by the single analysis, and the SD values obtained by the joint analysis were lower than those obtained by the single analysis (Fig. <xref rid="Fig3" ref-type="fig">3a, b</xref>). Moreover, upon processing the entire 12 slices dataset, the average JI/median ARI values by joint analysis were 0.61/0.61, higher than that by the single analysis ( = 0.53/0.57; Fig. <xref rid="Fig3" ref-type="fig">3c, d</xref>); the average SD value by the joint analysis was 50 μm, much lower than that by the single analysis ( = 262 μm; Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). This comparison implies that the joint analysis scheme improves the accuracy of Splane for spatial identification.<fig id="Fig3"><label>Fig. 3</label><caption><title>Identification of spatial domains from 12 10X Visium slices of DLPFC.</title><p><bold>a</bold> Comparison of spatial domains identified by Splane, STAligner, PRECAST, and STACI for slice 151508, 151510, 151670, and 151673. Layer1~Layer6, cortical layer 1 ~ 6; WM, white matter; JI, Jaccard index; SD, shifting distance. <bold>b</bold> Spatial domains identified by Splane-single, STAGATE, SpaGCN, BayerSpace, and stLearn for the four slices. <bold>c</bold>–<bold>e</bold> Jaccard indexes (<bold>c</bold>), Adjusted Rand Indexes (<bold>d</bold>), and shifting distances (<bold>e</bold>) between cortical layers and corresponding spatial domains identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. The gray background represents for the methods for multiple slice analysis. Center line, median value; bar height, mean value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range for box plots, mean values ± 95% confidence intervals for bar plots; <italic>n</italic> = 12 slices. <bold>f</bold> Proportion of SVGs identified by the spatial-domain-identification methods when using fold-change &gt; 0.5 and <italic>P</italic>-value &lt; 0.01 (two-sided Wilcoxon rank-sum test) as cut-offs. The gray background represents the methods used for multiple slice analysis. SVGs, spatial variable genes; bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 5 methods for single analysis. <bold>g</bold> Receiver operating characteristic (ROC) curves of SVGs identified by Splane, STAligner, PRECAST, STACI, Splane-single, STAGATE, SpaGCN, BayesSpace, and stLearn. Whiskers, standard errors; <italic>n</italic> = 12 slices. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig3_HTML" id="d32e686"/></fig></p>
      <p id="Par18">We then compared the performance of Splane against other state-of-the-art spatial-domain-identification methods, including methods designed for analyzing multiple ST slices such as STAligner, PRECAST and STACI, as well as methods that are designed for analyzing single ST slice such as STAGATE, SpaGCN, BayesSpace, and stLearn, using the same evaluation criteria (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). In analyzing all 12 ST slices of the DLPFC dataset, Splane exhibited the highest accuracy (average JI/median ARI = 0.61/0.61) and the lowest error (average SD = 53 μm), while other tools had JI/ARI and SD ranges of 0.41–0.56/0.36–0.54 and 75–548 μm (Fig. <xref rid="Fig3" ref-type="fig">3a–e</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>). Thus, Splane outperforms available alternative methods for spatial domain identification.</p>
      <p id="Par19">Spatial expression variation of genes can reflect the states, communications, and dynamics of cells, and therefore accurate identification of spatial variable genes (SVGs) from ST slices is crucial for determining the functions and phenotypes of cells in spatial domains. We thereby compared these methods for the task of identifying SVGs that represent specific cortical layers. We adopted the SVGs for cortical layers 1 ~ 6 and white matter (WM) annotated by the original study<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> as the ground truth, and evaluated the performance of each method by computing the overlap between the identified SVGs and the ground truth. Using a fold-change &gt; 0.5 and a <italic>P</italic>-value &lt; 0.01 as cut-offs for SVGs, we found that tools designed for analyzing multiple ST slices identified more SVGs compared to those designed for analyzing single ST slice. Splane, PRECAST, STAligner and STACI identified 1714, 1671, 1669 and 1527 out of 1917 SVGs of cortical layers 1 ~ 6 and WM, while the other examined methods identified only 179 ~ 1336 SVGs for each slice when the same cut-offs were applied (Fig. <xref rid="Fig3" ref-type="fig">3f</xref>). Similarly, using the receiver operating characteristic (ROC) curves as indicators for SVG prediction accuracy, we found that Splane, PRECAST and STAligner yielded the highest area under the curve value (AUC = 0.90, 0.89 and 0.88 respectively) among all examined methods (AUCs &lt; 0.83; Fig. <xref rid="Fig3" ref-type="fig">3g</xref>). These results emphasize the power of the Splane’s joint analysis scheme for identifying SVGs from multiple ST slices.</p>
      <p id="Par20">To assess the importance of the Spoint module in facilitating accurate spatial-domain identification using the Splane module, we conducted two comparative analyses on the human DFPLC datasets. First, we compared the performance of Splane using three different input types: highly variable gene expression matrix, PCA reduction of highly variable gene expression matrix, and cell-type proportions predicted by Spoint. Results showed that using only the cell-type proportion predicted by Spoint as input yielded spatial-domain identification results that closely resembled the ground truth, with significantly higher JI values in all 12 slices compared to the other input types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>). Second, we evaluated the performance of Splane using cell-type deconvolution results from other methods as input. Results demonstrated that using the cell-type proportions predicted by Spoint yielded the best spatial-domain identification outcome (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>). Notably, the identification of Layer4 was only possible when using the cell-type proportions predicted from Spoint as input.</p>
    </sec>
    <sec id="Sec6">
      <title>Splane identifies spatial domains from cancer slices</title>
      <p id="Par21">To test the performance of Splane in identifying spatial domains from disease slices, we applied Splane to jointly analyze 11 breast cancer 10X Visium slices from three experimental batches, including six slices reported in ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, four slices released by 10X Genomics<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>, and one slice from the study conducted in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. We first performed cell type deconvolution in each slice using Spoint and obtained the cell type identification (based on the expression of selected marker genes) and composition of each spot (Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>).</p>
      <p id="Par22">Subsequently, we applied Splane and identified ten spatial domains across the 11 slices (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). Notably, the extent of the batch effect between slices from different experiments was significantly reduced in Splane compared to that of the raw data and Splane without adversarial learning (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). We then explored the cell type composition of each predicted spatial domain and annotated these domains accordingly: domains D0-3, D4–6 and D7–9 were defined as tumor (tumor cell-enriched), intermediate (mixed cell types) and immune (immune cell-enriched) domains, respectively (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a–d</xref>, Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Joint analysis of 11 breast cancer ST slices from three different datasets.</title><p><bold>a</bold> Spatial domains identified by Splane in slice S2 and S5 from Wu et al. dataset, slice S10 from Zhao et al. dataset, and slice S11 released by 10X Genomics. <bold>b</bold>, <bold>c</bold> Spatial distribution of chromosome 1q&amp;8q copy number gains (<bold>b</bold>) and 1p copy number losses (<bold>c</bold>) of ST spots in slices S11, calculated by inferCNV. Dashed lines represent the tumor domain. <bold>d</bold>, <bold>e</bold> CNVs of chromosome 1q &amp; 8q (<bold>d</bold>) and chromosome 1p (<bold>e</bold>) in each spatial domain calculated by inferCNV. CNVs, copy number variations; center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 11 slices. <bold>f</bold> From left to right: Splane predicted spatial domains in slice S5, distribution of Splane predicted immune domains D7/D8/D9, distribution of Spoint predicted immune cells, and distribution of H&amp;E staining marked immune spots. <bold>g</bold> Percentage of H&amp;E staining marked immune spots in each domain of slice S1, S2, S5, and S6. The four slices were H&amp;E stained in the original study. Bar height, mean value; whiskers, mean values ± 95% confidence intervals; <italic>n</italic> = 4 slices. <bold>h</bold> From left to right: Splane predicted spatial domains in slice S10, distribution of Splane predicted immune domains D7, D8, and D9, distribution of Spoint predicted immune cells, and distribution of CD3<sup>+</sup> immunofluorescence (IF) staining marked immune spots. <bold>i</bold> Percentage of CD3<sup>+</sup> IF staining marked immune spots in each domain of slice S10. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig4_HTML" id="d32e812"/></fig></p>
      <p id="Par23">We then applied two distinct approaches to assess the accuracy of the Splane predictions for the tumor and immune domains. Since tumor cells in breast cancer patients often bear chromosomal copy number variations (CNVs)—including chromosome 1q and 8q gains and/or chromosome 1p losses<sup><xref ref-type="bibr" rid="CR55">55</xref>,<xref ref-type="bibr" rid="CR56">56</xref></sup> —our first approach was to calculate the CNVs of each ST spot and check for enrichment of CNVs in the predicted tumor domains. Using inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>, we calculated the CNVs for all spots in all 11 ST slices from the expression matrix of the ST data. Taking slice 11 as an example, the four tumor domains predicted by Splane had copy number gains in chromosomes 1q and 8q (inferred CNV ≥ 0.2) as well as copy number losses for chromosome 1p (inferred CNV ≤ −0.2; Fig. <xref rid="Fig4" ref-type="fig">4b, c</xref>). In contrast, fewer or no copy number gains or losses were detected in the Splane-predicted intermediate or immune domains (inferred CNV = −0.2 ~ 0.2). Taking all 11 slices into account by the average CNV values, we also observed chromosome 1q and 8q gains (average CNV &gt; 0.2) and chromosome 1p losses (average CNV &lt; −0.2) in tumor domains, but less in intermediate and none in immune domains (Fig. <xref rid="Fig4" ref-type="fig">4d, e</xref>).</p>
      <p id="Par24">Our second approach was to calculate the percentage of experimentally annotated immune spots and check for enrichment of immune spots in spatial domains. We took the H&amp;E-staining-marked lymphocyte-enriched spots in slice S1, S2, S5, and S6 from ref. <sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and the CD3<sup>+</sup> immunofluorescence(IF)-marked T cell-enriched spots in slice S10 from ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup> as the ground truth for immune spots. We then calculated the percentage of immune spots in each of the Splane identified domains. We found higher percentages of H&amp;E-staining-marked immune spots in immune domains D9, D8, and D7 in slice S1, S2, S5, and S6 (44%, 8%, and 6%, respectively) than in the intermediate and tumor domains ( &lt; 1%) (Fig. <xref rid="Fig4" ref-type="fig">4f, g</xref>). Similarly, in slice S10, we found more CD3<sup>+</sup> IF-marked immune spots in immune domains D9, D8, and D7 (72%, 70%, and 63% respectively) than in intermediate and tumor domains ( &lt; 47%) (Fig. <xref rid="Fig4" ref-type="fig">4h, i</xref>). These results support Splane’s prediction of tumor and immune domains.</p>
      <p id="Par25">In the context of tumor systems, accurately identifying tumor boundaries is crucial for immuno-oncology research. We compared the ability of Splane and other multi-slice analysis algorithms, including STAligner, PRECAST, and STACI, to identify tumor boundaries. In the human breast cancer 10X Visium data, only Splane accurately identified tumor regions with distinct boundaries (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12a</xref>). The tumor regions predicted by Splane were consistent with CNV gains or losses in specific chromosomes, and they aligned well with evident tumor tissue regions in H&amp;E images. Furthermore, we observed a significant correlation between the proportion of tumor cells and CNV scores specifically in the spatial domains identified by Splane (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12b</xref>). These results highlight Splane’s ability to identify consistent tumor regions and boundaries across multiple slices in tumor systems.</p>
    </sec>
    <sec id="Sec7">
      <title>Scube constructs 3D architecture of tissue from consecutive 2D slices</title>
      <p id="Par26">Most current experimental ST techniques measure the distribution of transcripts in 2D space, yet tissues are obviously 3D, and functions of cells are distributed in space. We thereby developed the Scube module of SPACEL to construct and investigate the 3D architecture of a given tissue. We first employed a 3D STARmap dataset of the mouse brain from ref. <sup><xref ref-type="bibr" rid="CR58">58</xref></sup> (originally 1400 μm × 1700 μm × 100 μm) and divided it into ten slices of 10 μm thickness each as the ground truth (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). We randomly rotated, flipped, and cropped each slice to simulate a perturbed ST dataset comprising consecutive 2D slices (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>, see Methods). We defined the percentage of a slice that was randomly cropped out as the crop ratio of that slice. At each level of crop ratio, we used Splane to identify the spatial domains across the ten slices, and applied Scube to align these slices by transforming their coordinate systems based on the Splane-identified spatial domains.<fig id="Fig5"><label>Fig. 5</label><caption><title>3D alignments of consecutive ST slices for the mouse brain.</title><p><bold>a</bold> The 3D STARmap dataset of the mouse brain. <bold>b</bold> Simulating an ST dataset with consecutive 2D slices by dividing the 3D STARmap dataset into ten 2D slices and randomly rotating/flipping/cropping each slice. <bold>c</bold> Alignment of the simulated dataset with crop ratio=0.25, generated by Scube, STAligner, and PASTE. Dashed lines represent the positions of the ground truths. SSIM, structural similarity index measure; PCC, Pearson’s correlation coefficient. <bold>d</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s results for simulated datasets with crop ratios from 0 to 0.25. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 10 slices. <bold>e</bold> Stacked 3D alignments constructed by Scube (left), STAligner (middle), and PASTE (right) from 33 MERFISH slices of mouse primary motor cortex. <bold>f</bold> SSIM/PCC values of Scube’s, STAligner’s, and PASTE’s alignment results for the MERFISH dataset. Center line, median value; box limits, upper and lower quartiles; whiskers, 1.5× interquartile range; <italic>n</italic> = 33 slices. <bold>g</bold> Continuous expression distribution of the genes <italic>Cux2</italic>, <italic>Slc30a3</italic>, and <italic>Bcl11b</italic> on the surface of the 3D architecture of the mouse brain after applying the GPR model in Scube. BF, Bayes factor. <bold>h</bold> Continuous expression distribution of <italic>Cux2</italic> in the coronal plane of the 3D architecture of the mouse brain. BF, Bayes factor. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_43220_Fig5_HTML" id="d32e926"/></fig></p>
      <p id="Par27">We adopted SSIM and PCC as the metrics to assess the similarity between the transformed coordinate system and the ground truth for each slice. Higher SSIM and PCC values indicate better alignment. Recall that STAligner and PASTE are two state-of-the-art methods for constructing 3D alignments of tissue from consecutive ST slices<sup><xref ref-type="bibr" rid="CR40">40</xref>,<xref ref-type="bibr" rid="CR41">41</xref></sup>, we compared the performance of Scube with STAligner and PASTE for aligning the simulated dataset under crop ratios from 0 to 0.25. Since the alignment results of STAligner and PASTE can be affected by their hyperparameters, we first performed a parameter optimization search to achieve the best alignment results of STAligner and PASTE (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13</xref>), before it was compared with Scube. With a crop ratio equal to 0.25, the average SSIM/PCC values of the Scube-transformed slices were 0.96/0.97, whereas the values for the STAligner-transformed slices were 0.76/0.77 and for the PASTE-transformed slices were 0.72/0.75. (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). With crop ratios range = 0.10, 0.15, 0.20, and 0.25, the average SSIM values of the Scube-transformed slices were 0.98, 0.98, 0.97 and 0.96, higher than those by STAligner ( = 0.79, 0.79, 0.72, and 0.76) or PASTE ( = 0.82, 0.77, 0.74, and 0.72; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Similarly, the average PCC values of the Scube-transformed slices were 0.99, 0.98, 0.98, and 0.97, which were also higher than those by STAligner ( = 0.80, 0.81, 0.73, and 0.77) or PASTE ( = 0.85, 0.79, 0.76, and 0.75; Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), suggesting a better alignment in Scube for the simulated dataset.</p>
      <p id="Par28">To further compare the performance of Scube, STAligner and PASTE in constructing a 3D architecture on real ST dataset, we examined a mouse primary motor cortex (MOp) profile, which contains 33 consecutive 2D slices from the MERFISH experiment<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. We first applied Splane and identified seven spatial domains from the 33 consecutive 2D slices, which exhibited the highest accuracy in spatial domain identification (average JI/median ARI = 0.44/0.43) compared to STACI (average JI/median ARI = 0.43/0.38), STAligner (average JI/median ARI = 0.33/0.25) and PRECAST (average JI/median ARI = 0.23/0.16; Supplementary Fig. <xref rid="MOESM1" ref-type="media">14</xref>). We then used Scube to align these slices by transforming the coordinate systems of each pair of adjacent slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15a, b</xref>). Next, by stacking the transformed 2D slices together, we constructed a 3D architecture of MOp in Scube, enabling a 3D illustration of spatial domains and cell types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par29">In parallel, we applied STAligner and PASTE to perform an alignment and 3D construction from the same dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15</xref>). Since no ground truth is known in this case, we calculated the SSIM/PCC values between every two adjacent transformed slices to evaluate the alignment performance of the two methods, and found that the average SSIM/PCC values of the Scube-transformed slices were 0.71/0.76, significantly higher than those by STAligner (SSIM/PCC = 0.61/0.65) or PASTE (SSIM/PCC = 0.57/0.61; Fig. <xref rid="Fig5" ref-type="fig">5f</xref>). Notably, when stacking the 2D transformed slices using either STAligner or PASTE, we obtained a twisted 3D architecture of MOp (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>).</p>
      <p id="Par30">SPACEL also integrated a Gaussian process regression (GPR) model<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in Scube, which predicts the expression level of a gene at any position in the 3D architecture, enabling a continuous illustration of transcript distribution along any direction in space (Fig. <xref rid="Fig5" ref-type="fig">5g</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16a, b</xref>). By quantifying the Bayes Factor (BF, see Methods) of the GPR model, SPACEL is capable of identifying genes that vary significantly in any direction within the 3D space of tissue (Fig. <xref rid="Fig5" ref-type="fig">5h</xref>). SPACEL thereby allows users to explore the dynamics of transcript distributions from any direction, and hence reveals a real 3D structure of the spatial architecture of complex tissues or organs.</p>
      <p id="Par31">Accurate reconstruction of detailed 3D structures is crucial for unraveling biological phenomena in spatial omics data. In the mouse embryo Stereo-seq data<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Scube achieved better performance compared to STAligner and PASTE in accurately reconstructing and depicting structures like brain, liver and paws (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a, b</xref>). Furthermore, Scube (SSIM/PCC = 0.62/0.66) exhibited higher consistency in the distribution of tissue regions between slices compared to STAligner (0.57/0.61) and PASTE (0.24/0.25) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17c</xref>). In summary, the Scube module of SPACEL outperformed STAligner and PASTE in alignment and 3D architecture construction in both the simulated (STARmap) and real (MERFISH and Stereo-seq) datasets.</p>
    </sec>
    <sec id="Sec8">
      <title>SPACEL as an integrated toolkit for ST data processing and analysis</title>
      <p id="Par32">To highlight the integrated nature of SPACEL, we applied a fully integrated workflow to analyze mouse whole brain ST data<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>. The dataset consisted of 75 consecutive slices generated by Spatial Transcriptomics technology<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> with a spot resolution of 100 μm, covering a large portion of the mouse brain region. Using the original brain region annotations as the reference ground truth, we evaluated the performance of each module. In Spoint, the predicted distribution of major region-specific cell types matched well with the corresponding brain regions, such as excitatory neurons and hippocampus CA1 and CA3 cells predominantly predicted in the hippocampal region (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18a, b</xref>). In Splane, we compared its performance against STAligner, PRECAST and STACI. The average JI/median ARI values of the spatial domains identified by Splane (0.42/0.56) were higher than those identified by STAligner (0.36/0.40), PRECAST (0.35/0.38) and STACI (0.31/0.40) across the 75 slices (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18c, d</xref>). In Scube, the 3D tissue reconstruction achieved by Scube (SSIM/PCC = 0.83/0.85) exhibited high coherence and accuracy, surpassing the results obtained by PASTE (0.82/0.84) and STAligner (0.79/0.81) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18e, f</xref>). These results clearly demonstrate that SPACEL serves as an effective integrated toolkit for analyzing multiple ST slices.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par33">In this study, we introduced a deep learning-based toolkit, SPACEL, comprising three modules: Spoint for cell type deconvolution, Splane for the identification of spatial domains across multiple ST slices, and Scube for the construction of 3D architecture from consecutive ST slices. We have demonstrated that the SPACEL modules outperform state-of-the-art methods for each of these tasks through analyses of 32 simulated and 11 real ST datasets acquired using five distinct ST technologies. While each module can be utilized separately, their synergistic interplay within the SPACEL platform offers an all-encompassing and streamlined solution for the best results of ST data interpretation, particularly accurate 3D tissue alignment, precise spatial domain identification, and effective batch effect removal.</p>
    <p id="Par34">Unlike the other state-of-the-art methods, the Splane module of SPACEL combines the cell type composition as input and adversarial training in the GCN model. Since the spatial distribution of genes, cells, and cell clusters from distinct ST experiments can be extremely heterogeneous, using cell type composition as input and introducing adversarial training to the GCN model significantly minimizes batch effects, leading to a more robust and efficient method for spatial domain identification. The joint analysis scheme that Splane incorporated is also particularly powerful to identify common features, and hence to accurately predict SVGs across multiple slices.</p>
    <p id="Par35">Spatial domains identified in Splane also set a foundation for Scube to achieve an accurate alignment of the consecutive slices and hence a precise 3D architecture construction. In contrast, the PASTE algorithm uses the raw expression matrix and spatial coordinates from the ST data as input for alignment, and a hyperparameter α to adjust the relative contributions of transcriptional dissimilarity and spatial distances among the aligned spots. This design makes PASTE’s alignment results sensitive to hyperparameters in datasets with significant defects (e.g., slices with crop ratios ≥ 0.25). On the other hand, STAligner constructs MNN based on the raw expression matrix to select landmark spots/cells and relies on user-defined landmark domains shared across slices for alignment. However, this approach does not utilize complete information on each spot of the whole slice, which limits its ability to balance global structure similarity and alignment accuracy, particularly in the case of partially overlapped slices. In contrast, Scube adopts a global optimization strategy for 3D alignment, taking into account the correspondences between all spots in adjacent slices. This innovative method enables Scube to achieve more precise alignment, preserving the overall structural integrity in the process of spatial alignment.</p>
    <p id="Par36">To enhance the accessibility of the GPR model for 3D spatial transcriptomics, we have developed a user-friendly Python code by integrating the original MATLAB code and third-party GUI software. This integration enables researchers to easily access and utilize the model, fostering advancements in the field and promoting broader adoption of this technology within the scientific community. There are opportunities to improve the performance of SPACEL and extend its application. For example, Splane uses cell type composition information as input for the model; this means that to process seq-based ST datasets such as 10X Visium, one has to employ a cell type deconvolution algorithm such as Spoint to obtain the cell type composition information before Splane can be applied. Besides, the current version of Scube does not support nonlinear alignment as well as STAligner and PASTE. Although there are several tools that can nonlinearly align image data by setting anchor points manually, to our knowledge there is no method yet to do it automatically for ST data analysis. We acknowledge this limitation and plan to address this issue in a future version of Scube. Another issue for SPACEL is that when a new slice is added to the dataset, the entire deep learning model needs to be retrained from scratch, which may affect the computational efficiency of SPACEL to analyze large-scale datasets. We anticipate that transfer learning models and algorithms (e.g., ImageNet<sup><xref ref-type="bibr" rid="CR61">61</xref></sup> and BERT<sup><xref ref-type="bibr" rid="CR62">62</xref></sup>), which have been used in bioinformatics tasks such as cell type classification for large-scale single-cell data<sup><xref ref-type="bibr" rid="CR63">63</xref>–<xref ref-type="bibr" rid="CR66">66</xref></sup>, can help us to overcome this limitation.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Construction of simulated ST data from scRNA-seq data</title>
      <p id="Par37">To establish training sets for Spoint and other deconvolution methods, we employed cells from a scRNA-seq dataset to simulate pseudo-spots, where the cell type composition of each pseudo-spot can be ascertained from its constituent cells. Specifically, assuming that the number of cells at each spot (<inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq1.gif"/></alternatives></inline-formula>) follows a normal distribution <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{c},{\delta }_{c})$$\end{document}</tex-math><mml:math id="M4"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq2.gif"/></alternatives></inline-formula>, and the number of cell types at each spot (<italic>N</italic><sub><italic>t</italic></sub>) follows a normal distribution <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\mathscr{N}}}}}}({\mu }_{t},{\delta }_{t})$$\end{document}</tex-math><mml:math id="M6"><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq3.gif"/></alternatives></inline-formula>, we set the default parameters as <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{c}=10,{\delta }_{c}=5,{\mu }_{t}={\mu }_{c}/2,{\delta }_{t}={\delta }_{c}/2$$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq4.gif"/></alternatives></inline-formula>. Researchers can also detect <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq5.gif"/></alternatives></inline-formula> from the image of an ST slice using stardist<sup><xref ref-type="bibr" rid="CR67">67</xref></sup> or DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup>, and use it as the input parameter. We first generated <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{t}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq6.gif"/></alternatives></inline-formula> for each sampled spot, and then sampled cells from the scRNA-seq data associated with each spot. Each cell was sampled based on its sampling probability which is determined by <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq7.gif"/></alternatives></inline-formula>. <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq8.gif"/></alternatives></inline-formula> for each spot is defined as:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{t}=\left\{\begin{array}{c}{f}_{t}\,{if}\, 0 \, &lt; \, {r}_{c} \, &lt; \, \frac{1}{3}\hfill\\ \frac{1/{f}_{t}}{\mathop{\sum}\limits_{t}\left(1/{f}_{t}\right)}\,{if}\,\frac{1}{3}\le {r}_{c} &lt; \frac{2}{3}\hfill\hfill\\ \frac{\sqrt{{f}_{t}}}{\mathop{\sum}\limits_{t}\left(\sqrt{{f}_{t}}\right)}\,{if}\,\frac{2}{3}\le {r}_{c} &lt; 1\end{array}\right.$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced open="{"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfrac><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:munder><mml:mfenced close=")" open="("><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.25em"/><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq9"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{t}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq9.gif"/></alternatives></inline-formula> is the composition of each cell type in the scRNA-seq data, and <inline-formula id="IEq10"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${r}_{c}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq10.gif"/></alternatives></inline-formula> is a random value between 0 and 1. We then randomly sampled cells of each cell type from the scRNA-seq data, and combined the gene expression of <inline-formula id="IEq11"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{c}$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq11.gif"/></alternatives></inline-formula> sampled cells to generate an original spot. During the cell sampling process, we calculated the cell type numbers of these sampled cells. These cell type numbers serve as the cell type labels for the spot. We then estimated the mean value <inline-formula id="IEq12"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }^{L}$$\end{document}</tex-math><mml:math id="M26"><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq12.gif"/></alternatives></inline-formula> and standard deviation <inline-formula id="IEq13"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }^{L}$$\end{document}</tex-math><mml:math id="M28"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq13.gif"/></alternatives></inline-formula> of gene expression for each spot from a real ST data, and down-sampled the original spot using the downsampleMatrix function of the Scuttle package<sup><xref ref-type="bibr" rid="CR69">69</xref></sup> to obtain a simulated spot that has gene expression distribution similar to that of the real ST data.</p>
    </sec>
    <sec id="Sec12">
      <title>Deconvolution model of Spoint</title>
      <p id="Par38">Spoint contains three deep learning models. The first model is a variational autoencoder (VAE) model, consisting of an encoder layer, a decoder layer, and three hidden layers. The three hidden layers contain 128, 64, and 128 nodes, respectively. The input variables of the encoder and decoder layers are gene expression levels at each spot, <inline-formula id="IEq14"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M30"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq14.gif"/></alternatives></inline-formula>, so the dimension of these two layers is equal to the number of detected genes. We inputted the expression matrices of the simulated ST data <inline-formula id="IEq15"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \}$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq15.gif"/></alternatives></inline-formula> and the real ST data <inline-formula id="IEq16"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }\}$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq16.gif"/></alternatives></inline-formula> into the VAE model, and used the latent variables of the middle hidden layer as the output results, <inline-formula id="IEq17"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\prime}$$\end{document}</tex-math><mml:math id="M36"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq17.gif"/></alternatives></inline-formula> and <inline-formula id="IEq18"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M38"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq18.gif"/></alternatives></inline-formula>. Note that the simulated ST dataset should be constructed from a single-cell dataset obtained from the same type of tissue as the real ST dataset.</p>
      <p id="Par39">The second model <inline-formula id="IEq19"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M40"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq19.gif"/></alternatives></inline-formula> consists of an input layer that accepts the latent variable <inline-formula id="IEq20"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M42"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq20.gif"/></alternatives></inline-formula> of the VAE model, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer that outputs the proportion of each cell type in the spot with Softmax activation function. We adopted the maximum mean discrepancy (MMD) distance between the variable of model <inline-formula id="IEq21"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M44"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq21.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data as the objective function, as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}={{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\big({E}_{2}\big(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\big),\, {E}_{2}\big({\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }}^{{\prime} }\big)\big)$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{MM}}}}}}{{{{{{\rm{D}}}}}}}^{2}\left(U,\, V\right)=	 \frac{1}{{n}^{2}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{{i}^{{\prime} }}^{n}k\left({u}_{i},\,{{u}^{{\prime} }}_{i}\right)-\frac{2}{{nm}}\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{m}k\left({u}_{i},\, {v}_{i}\right) \\ 	+\frac{1}{{m}^{2}}\mathop{\sum }\limits_{j}^{m}\mathop{\sum }\limits_{{j}^{{\prime} }}^{m}k\left({v}_{i},\,{{v}^{{\prime} }}_{i}\right)$$\end{document}</tex-math><mml:math id="M48"><mml:mi mathvariant="normal">MM</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>V</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k\left(u,\, v\right)={e}^{\frac{-{\left|u-v\right|}^{2}}{\sigma }}$$\end{document}</tex-math><mml:math id="M50"><mml:mi>k</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>v</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq22"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime}$$\end{document}</tex-math><mml:math id="M52"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq22.gif"/></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M54"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq23.gif"/></alternatives></inline-formula> are the latent variables of the simulated ST data and real ST data, respectively, generated by the VAE model, and <inline-formula id="IEq24"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma$$\end{document}</tex-math><mml:math id="M56"><mml:mi>σ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq24.gif"/></alternatives></inline-formula> represents the dimension of the hidden layer. The third model <inline-formula id="IEq25"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M58"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq25.gif"/></alternatives></inline-formula> consists of an input layer that accepts the output of model <inline-formula id="IEq26"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M60"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq26.gif"/></alternatives></inline-formula>, three hidden layers each containing 512 nodes with ReLU activation function<sup><xref ref-type="bibr" rid="CR70">70</xref></sup>, and a output layer is represents the recovery of latent variable <inline-formula id="IEq27"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M62"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq27.gif"/></alternatives></inline-formula> of the VAE model. Then, we used the following objective function to constrain the outputs of the model <inline-formula id="IEq28"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M64"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq28.gif"/></alternatives></inline-formula> and the ground truth cell-type proportion of simulated ST data:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}={{{{{\rm{Cosine}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right),\mathop{p}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>p</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>and constrain the similarity between the outputs of the model <inline-formula id="IEq29"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M68"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq29.gif"/></alternatives></inline-formula> and the latent variable <inline-formula id="IEq30"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M70"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq30.gif"/></alternatives></inline-formula> of the simulated ST data and the real ST dataset:<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}={{{{{\rm{Cosine}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)+\widehat{{{{{{\rm{KL}}}}}}}\left(R\left[E\left(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)\right],\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }\right)$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>R</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cosine}}}}}}\left(a,\, {a}^{{\prime} }\right)=\frac{\sum a\times {a}^{{\prime} }}{\sqrt{\sum {a}^{2}}\times \sqrt{\sum {{a}^{{\prime} }}^{2}}}$$\end{document}</tex-math><mml:math id="M74"><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt><mml:mo>×</mml:mo><mml:msqrt><mml:mrow><mml:mo mathsize="big">∑</mml:mo><mml:msup><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overline{{{{{{\rm{KL}}}}}}}\left(a,\,{a}^{{\prime} }\right)=\sum a\times \log \frac{a}{{a}^{{\prime} }}\mathop{{{{{{\rm{Min}}}}}}}\limits_{a}{{{{{\rm{Cosine}}}}}}\left(a,\,{a}^{{\prime} }\right)+{{{{{\rm{KL}}}}}}\left(a,\,{a}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M76"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow><mml:mo accent="true">¯</mml:mo></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo mathsize="big">∑</mml:mo><mml:mi>a</mml:mi><mml:mo>×</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mi mathvariant="normal">Min</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:munder><mml:mi mathvariant="normal">Cosine</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq31"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M78"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq31.gif"/></alternatives></inline-formula> is the ground truth cell-type proportion of simulated ST data, the <inline-formula id="IEq32"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M80"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq32.gif"/></alternatives></inline-formula> is the outputs of model <inline-formula id="IEq33"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M82"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq33.gif"/></alternatives></inline-formula> for the real and simulated ST data, <inline-formula id="IEq34"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}(a,a{\prime} )$$\end{document}</tex-math><mml:math id="M84"><mml:mi mathvariant="normal">KL</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq34.gif"/></alternatives></inline-formula> is the Kullback-Leibler Divergence<sup><xref ref-type="bibr" rid="CR71">71</xref></sup>.</p>
      <p id="Par40">The weight of the model is initialized using the He initialization method<sup><xref ref-type="bibr" rid="CR72">72</xref></sup>. The training of Spoint contains the following steps: 1) We calculated <inline-formula id="IEq35"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq35.gif"/></alternatives></inline-formula> using <inline-formula id="IEq36"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M88"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq36.gif"/></alternatives></inline-formula> predicted from the simulated ST data and ground truth cell-type proportion <inline-formula id="IEq37"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{p}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M90"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq37.gif"/></alternatives></inline-formula>, then adopted the Adam optimization algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup> to obtain optimal parameters for model <inline-formula id="IEq38"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M92"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq38.gif"/></alternatives></inline-formula>. 2) We calculated <inline-formula id="IEq39"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{R}$$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq39.gif"/></alternatives></inline-formula> using <inline-formula id="IEq40"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R[E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })]$$\end{document}</tex-math><mml:math id="M96"><mml:mi>R</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq40.gif"/></alternatives></inline-formula> from the real and simulated ST data and latent variable <inline-formula id="IEq41"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }$$\end{document}</tex-math><mml:math id="M98"><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq41.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq42"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{M}$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq42.gif"/></alternatives></inline-formula> using <inline-formula id="IEq43"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq43.gif"/></alternatives></inline-formula> and <inline-formula id="IEq44"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{2}(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M104"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq44.gif"/></alternatives></inline-formula> from the variable of model <inline-formula id="IEq45"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M106"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq45.gif"/></alternatives></inline-formula>’s last hidden layer for the simulated ST data and the real ST data, then updated the parameters of model <inline-formula id="IEq46"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M108"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq46.gif"/></alternatives></inline-formula> and model <inline-formula id="IEq47"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M110"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq47.gif"/></alternatives></inline-formula> using the Adam optimization algorithm. 3) We repeated steps 1) and 2) iteratively to update the parameters of models <inline-formula id="IEq48"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E$$\end{document}</tex-math><mml:math id="M112"><mml:mi>E</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq48.gif"/></alternatives></inline-formula> and <inline-formula id="IEq49"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M114"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq49.gif"/></alternatives></inline-formula> until the <inline-formula id="IEq50"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{E}$$\end{document}</tex-math><mml:math id="M116"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq50.gif"/></alternatives></inline-formula> of two adjacent training epochs reached a convergence value, i.e., <inline-formula id="IEq51"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\Delta {{{{{\rm{Loss}}}}}}}_{Q} &lt; 0.001$$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0.001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq51.gif"/></alternatives></inline-formula>. After the training of Spoint, the values <inline-formula id="IEq52"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E(\mathop{{{{{{\bf{z}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M120"><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq52.gif"/></alternatives></inline-formula> at the final convergence epoch were used to predict the cell type composition of the real spatial data.</p>
    </sec>
    <sec id="Sec13">
      <title>Graph convolutional network of Splane</title>
      <p id="Par41">In Splane, we first used the spatial coordinates of spots/cells as inputs to construct an undirected graph. In the graph, each node represents a spot/cell, and an edge connects two spots/cells that are physically adjacent in space. The graph structure is stored in an <inline-formula id="IEq53"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N\times N$$\end{document}</tex-math><mml:math id="M122"><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq53.gif"/></alternatives></inline-formula> adjacency matrix <inline-formula id="IEq54"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M124"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq54.gif"/></alternatives></inline-formula>, in which <inline-formula id="IEq55"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M126"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq55.gif"/></alternatives></inline-formula> is the number of spots/cells, and <inline-formula id="IEq56"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=1$$\end{document}</tex-math><mml:math id="M128"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq56.gif"/></alternatives></inline-formula> if spot/cell <inline-formula id="IEq57"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$v$$\end{document}</tex-math><mml:math id="M130"><mml:mi>v</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq57.gif"/></alternatives></inline-formula> belongs to the k nearest neighbors of spot/cell <inline-formula id="IEq58"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u$$\end{document}</tex-math><mml:math id="M132"><mml:mi>u</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq58.gif"/></alternatives></inline-formula>, otherwise <inline-formula id="IEq59"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${A}_{{uv}}=0$$\end{document}</tex-math><mml:math id="M134"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>u</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq59.gif"/></alternatives></inline-formula>. For single-cell resolution ST data, such as MERFISH and STARmap, we set the default value of <italic>k</italic> = 25; but for 10X Visium data, we set the default value of <italic>k</italic> = 6, since each spot in the 10X Visium data is surrounded by 6 spots, and approximately 50–100 cells are contained in the 6 neighbor spots when <italic>k</italic> = 6.</p>
      <p id="Par42">Then, we used the cell type composition of spots/cells <inline-formula id="IEq60"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q$$\end{document}</tex-math><mml:math id="M136"><mml:mi>Q</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq60.gif"/></alternatives></inline-formula> and the adjacency matrix <inline-formula id="IEq61"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M138"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq61.gif"/></alternatives></inline-formula> to construct a graph convolutional network (GCN) model <inline-formula id="IEq62"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M140"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq62.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{l+1}\left(Q\right)=f\left({H}_{l}\left(Q\right),\, A\right)$$\end{document}</tex-math><mml:math id="M142"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq63"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M144"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq63.gif"/></alternatives></inline-formula> is the index of the layer, so <inline-formula id="IEq64"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M146"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq64.gif"/></alternatives></inline-formula> is the input layer. We used the cell type composition of each spot/cell as the input layer for this model. According to Kipf and Welling’s study<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, the propagation rule in GCN can be written as<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left({H}_{l},\, A\right)={{{{{\rm{ReLU}}}}}}\left({\widehat{D}}^{-\frac{1}{2}}\hat{A}{\widehat{D}}^{-\frac{1}{2}}{H}_{l}{W}_{l}\right)$$\end{document}</tex-math><mml:math id="M148"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>A</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ReLU</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{A}=A+I$$\end{document}</tex-math><mml:math id="M150"><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>+</mml:mo><mml:mi>I</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq65"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I$$\end{document}</tex-math><mml:math id="M152"><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq65.gif"/></alternatives></inline-formula> is an identity matrix, <inline-formula id="IEq66"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{D}$$\end{document}</tex-math><mml:math id="M154"><mml:mover accent="true"><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq66.gif"/></alternatives></inline-formula> is the diagonal matrix of <inline-formula id="IEq67"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M156"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq67.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq68"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${W}_{l}$$\end{document}</tex-math><mml:math id="M158"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq68.gif"/></alternatives></inline-formula> is the weight matrix of the <inline-formula id="IEq69"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}^{{th}}$$\end{document}</tex-math><mml:math id="M160"><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq69.gif"/></alternatives></inline-formula> layer. We used a Chebyshev polynomial filter to estimate the convolution kernel of the GCN model<sup><xref ref-type="bibr" rid="CR74">74</xref></sup>. In this process, a signal <inline-formula id="IEq70"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x$$\end{document}</tex-math><mml:math id="M162"><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq70.gif"/></alternatives></inline-formula> is filtered by <inline-formula id="IEq71"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }$$\end{document}</tex-math><mml:math id="M164"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq71.gif"/></alternatives></inline-formula> as<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }\left(L\right)x={g}_{\theta }\left(U\Lambda {U}^{T}\right)x=U{g}_{\theta }\left(\Lambda \right){U}^{T}x$$\end{document}</tex-math><mml:math id="M166"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">Λ</mml:mi></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mi>x</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula>where Laplacian matrix <inline-formula id="IEq72"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M168"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq72.gif"/></alternatives></inline-formula> of the graph is given by <inline-formula id="IEq73"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=I-{D}^{-\frac{1}{2}}A{D}^{-\frac{1}{2}}$$\end{document}</tex-math><mml:math id="M170"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mi>A</mml:mi><mml:msup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq73.gif"/></alternatives></inline-formula>. The Laplacian matrix <inline-formula id="IEq74"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M172"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq74.gif"/></alternatives></inline-formula> is real symmetric positive semidefinite matrix. It possesses a complete set of orthonormal eigenvectors <inline-formula id="IEq75"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{u}_{l}\}}_{l=0}^{n-1}\in {R}^{n}$$\end{document}</tex-math><mml:math id="M174"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq75.gif"/></alternatives></inline-formula>, which are referred to as the graph Fourier modes. These eigenvectors are associated with ordered real nonnegative eigenvalues <inline-formula id="IEq76"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\{{\lambda }_{l}\}}_{l=0}^{n-1}$$\end{document}</tex-math><mml:math id="M176"><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq76.gif"/></alternatives></inline-formula>, and they correspond to the frequencies of the graph. The Fourier basis <inline-formula id="IEq77"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$U=\left[{u}_{0},...,{u}_{n-1}\right]\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M178"><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq77.gif"/></alternatives></inline-formula> diagonalizes the Laplacian matrix <inline-formula id="IEq78"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L$$\end{document}</tex-math><mml:math id="M180"><mml:mi>L</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq78.gif"/></alternatives></inline-formula>, such that <inline-formula id="IEq79"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L=U\Lambda {U}^{T}$$\end{document}</tex-math><mml:math id="M182"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>U</mml:mi><mml:mi mathvariant="normal">Λ</mml:mi><mml:msup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq79.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq80"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\varLambda={{{{{\rm{diag}}}}}}\left(\left[{\lambda }_{0},...,{\lambda }_{n-1}\right]\right)\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M184"><mml:mi>Λ</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">diag</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq80.gif"/></alternatives></inline-formula>.</p>
      <p id="Par43">The Chebyshev polynomial filter can be expressed as<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${g}_{\theta }\left(\varLambda \right)=\mathop{\sum }\limits_{k=0}^{K-1}{\theta }_{k}{T}_{k}\left(\widetilde{\varLambda }\right)$$\end{document}</tex-math><mml:math id="M186"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>where the parameter <inline-formula id="IEq81"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta \in {R}^{K}$$\end{document}</tex-math><mml:math id="M188"><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq81.gif"/></alternatives></inline-formula> is a vector of Chebyshev coefficients and <inline-formula id="IEq82"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{\varLambda })\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M190"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq82.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order <inline-formula id="IEq83"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M192"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq83.gif"/></alternatives></inline-formula> evaluated at <inline-formula id="IEq84"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{\varLambda }=2\varLambda /{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M194"><mml:mover accent="true"><mml:mrow><mml:mi>Λ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>Λ</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq84.gif"/></alternatives></inline-formula>, a diagonal matrix of scaled eigenvalues that lie in <inline-formula id="IEq85"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$[-{{{{\mathrm{1,\,1}}}}}]$$\end{document}</tex-math><mml:math id="M196"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="normal">1, 1</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq85.gif"/></alternatives></inline-formula>. Consequently, the filtering operation can be written as <inline-formula id="IEq86"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y={g}_{\theta }(L)x=\mathop{\sum }\nolimits_{k=0}^{K-1}{\theta }_{k}{T}_{k}(\widetilde{L})x$$\end{document}</tex-math><mml:math id="M198"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq86.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq87"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}(\widetilde{L})\in {R}^{n\times n}$$\end{document}</tex-math><mml:math id="M200"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq87.gif"/></alternatives></inline-formula> is the Chebyshev polynomial of order k evaluated at the scaled Laplacian <inline-formula id="IEq88"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\widetilde{L}=2L/{\lambda }_{\max }-I$$\end{document}</tex-math><mml:math id="M202"><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>I</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq88.gif"/></alternatives></inline-formula>. Denoting <inline-formula id="IEq89"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}={T}_{k}(\widetilde{L})x\in {R}^{n}$$\end{document}</tex-math><mml:math id="M204"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq89.gif"/></alternatives></inline-formula>, we can use the recurrence relation to compute <inline-formula id="IEq90"><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{k}=2\widetilde{L}{\bar{x}}_{k-1}-{\bar{x}}_{k-2}$$\end{document}</tex-math><mml:math id="M206"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq90.gif"/></alternatives></inline-formula> iteratively with <inline-formula id="IEq91"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{0}=x$$\end{document}</tex-math><mml:math id="M208"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq91.gif"/></alternatives></inline-formula> and <inline-formula id="IEq92"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bar{x}}_{1}=\widetilde{L}x$$\end{document}</tex-math><mml:math id="M210"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq92.gif"/></alternatives></inline-formula> as the initial values. The order of the polynomial <inline-formula id="IEq93"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M212"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq93.gif"/></alternatives></inline-formula>, controls the receptive field of the convolution kernel and is related to the parameter <inline-formula id="IEq94"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M214"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq94.gif"/></alternatives></inline-formula> in the Chebyshev polynomial <inline-formula id="IEq95"><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${T}_{k}$$\end{document}</tex-math><mml:math id="M216"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq95.gif"/></alternatives></inline-formula>. We set the default <inline-formula id="IEq96"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M218"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq96.gif"/></alternatives></inline-formula> equal to 2 to ensure that the GCN model contains the information of the first order neighbors and second order neighbors (i.e., neighbors of neighbors) of each spot.</p>
      <p id="Par44">The GCN model of Splane consists of 5 layers, i.e. <inline-formula id="IEq97"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0} \sim {H}_{4}$$\end{document}</tex-math><mml:math id="M220"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>~</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq97.gif"/></alternatives></inline-formula>, where the first layer <inline-formula id="IEq98"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M222"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq98.gif"/></alternatives></inline-formula> and the last layer <inline-formula id="IEq99"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M224"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq99.gif"/></alternatives></inline-formula> both contain the cell type composition of each spot/cell, and the middle layer <inline-formula id="IEq100"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M226"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq100.gif"/></alternatives></inline-formula> is used to cluster spots/cells and identify spatial domains. In Splane we embedded a cosine function <inline-formula id="IEq101"><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M228"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq101.gif"/></alternatives></inline-formula> to minimize the difference between <inline-formula id="IEq102"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{0}$$\end{document}</tex-math><mml:math id="M230"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq102.gif"/></alternatives></inline-formula> and <inline-formula id="IEq103"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{4}$$\end{document}</tex-math><mml:math id="M232"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq103.gif"/></alternatives></inline-formula>, i.e.<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{C}={{{{{\rm{Cos}}}}}}{{{{{\rm{ine}}}}}}\left[{H}_{0}\left(Q\right),\,{H}_{4}\left(Q\right)\right]$$\end{document}</tex-math><mml:math id="M234"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Cos</mml:mi><mml:mi mathvariant="normal">ine</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>Q</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>and we used another objective function <inline-formula id="IEq104"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Los}}}}}}{{{{{{\rm{s}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M236"><mml:mi mathvariant="normal">Los</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq104.gif"/></alternatives></inline-formula> to minimize the difference between the <inline-formula id="IEq105"><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}$$\end{document}</tex-math><mml:math id="M238"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq105.gif"/></alternatives></inline-formula> values of a spot and its neighbors, as<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}=\left|{H}_{2}\left({q}_{i}\right)-\frac{1}{n}\sum {H}_{2}\left({q}_{i}^{{{{{{\rm{neigh}}}}}}}\right)\right|$$\end{document}</tex-math><mml:math id="M240"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo mathsize="big">∑</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq106"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}$$\end{document}</tex-math><mml:math id="M242"><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq106.gif"/></alternatives></inline-formula> and <inline-formula id="IEq107"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}^{{{{{{\rm{neigh}}}}}}}$$\end{document}</tex-math><mml:math id="M244"><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">neigh</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq107.gif"/></alternatives></inline-formula> are the cell type composition of spot/cell <inline-formula id="IEq108"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M246"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq108.gif"/></alternatives></inline-formula> and its neighbors respectively, and <inline-formula id="IEq109"><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M248"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq109.gif"/></alternatives></inline-formula> is the number of neighbors.</p>
    </sec>
    <sec id="Sec14">
      <title>Adversarial learning for multiple slices</title>
      <p id="Par45">In Splane, we used a discriminator model <inline-formula id="IEq110"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M250"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq110.gif"/></alternatives></inline-formula> containing four layers to conclude uniform features from multiple slices. The input layer of model <inline-formula id="IEq111"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M252"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq111.gif"/></alternatives></inline-formula> is the output latent variables of spot/cell <inline-formula id="IEq112"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M254"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq112.gif"/></alternatives></inline-formula> from model <inline-formula id="IEq113"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H$$\end{document}</tex-math><mml:math id="M256"><mml:mi>H</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq113.gif"/></alternatives></inline-formula>, i.e., <inline-formula id="IEq114"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}({q}_{i})$$\end{document}</tex-math><mml:math id="M258"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq114.gif"/></alternatives></inline-formula>; the output layer contains the probability <inline-formula id="IEq115"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{i,s}$$\end{document}</tex-math><mml:math id="M260"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq115.gif"/></alternatives></inline-formula> of spot/cell <inline-formula id="IEq116"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M262"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq116.gif"/></alternatives></inline-formula> belonging to slice <inline-formula id="IEq117"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M264"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq117.gif"/></alternatives></inline-formula>; and the two hidden layers are 64 nodes fully-connect layers. We defined the objective function of model <inline-formula id="IEq118"><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M266"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq118.gif"/></alternatives></inline-formula> as<disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}=\frac{1}{{N}_{s}}\mathop{\sum}\limits_{s}{y}_{i,s}\log \left({p}_{i,s}\right)$$\end{document}</tex-math><mml:math id="M268"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq119"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${N}_{s}$$\end{document}</tex-math><mml:math id="M270"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq119.gif"/></alternatives></inline-formula> is the number of slices and <inline-formula id="IEq120"><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i,s}$$\end{document}</tex-math><mml:math id="M272"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq120.gif"/></alternatives></inline-formula> is the slice label of spot/cell <inline-formula id="IEq121"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M274"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq121.gif"/></alternatives></inline-formula>. The <inline-formula id="IEq122"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M276"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq122.gif"/></alternatives></inline-formula> is minimized when the embeddings for different sections are maximally different, allowing the discriminator to correctly predict the labels of the slices. As shown in the next section, we trained GCN model with spots/cells from multiple ST slices, optimizing it to achieve a maximum <inline-formula id="IEq123"><alternatives><tex-math id="M277">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M278"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq123.gif"/></alternatives></inline-formula>, ensuring that the latent variables of spots/cells from different slices would have the highest similarity.</p>
    </sec>
    <sec id="Sec15">
      <title>Clustering of spots/cells with latent features</title>
      <p id="Par46">The total objective function of Splane is a combination of the objective function of the GCN model and the objective function of the discriminator <inline-formula id="IEq124"><alternatives><tex-math id="M279">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D$$\end{document}</tex-math><mml:math id="M280"><mml:mi>D</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq124.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M281">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}={{\alpha }_{C}{{{{{\rm{Loss}}}}}}}_{C}+{{\alpha }_{S}{{{{{\rm{Loss}}}}}}}_{S}-{{\alpha }_{D}{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M282"><mml:mi mathvariant="normal">Loss</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq125"><alternatives><tex-math id="M283">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{C}$$\end{document}</tex-math><mml:math id="M284"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq125.gif"/></alternatives></inline-formula>, <inline-formula id="IEq126"><alternatives><tex-math id="M285">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{S}$$\end{document}</tex-math><mml:math id="M286"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq126.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq127"><alternatives><tex-math id="M287">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\alpha }_{D}$$\end{document}</tex-math><mml:math id="M288"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq127.gif"/></alternatives></inline-formula> are the weights of <inline-formula id="IEq128"><alternatives><tex-math id="M289">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{C}$$\end{document}</tex-math><mml:math id="M290"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq128.gif"/></alternatives></inline-formula>, <inline-formula id="IEq129"><alternatives><tex-math id="M291">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{S}$$\end{document}</tex-math><mml:math id="M292"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq129.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq130"><alternatives><tex-math id="M293">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{Loss}}}}}}}_{D}$$\end{document}</tex-math><mml:math id="M294"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Loss</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq130.gif"/></alternatives></inline-formula>, and their default values are 1, 1, and 0.5, respectively. The weight of the model is initialized using the Xavier initialization method<sup><xref ref-type="bibr" rid="CR75">75</xref></sup>. We used the RMSProp optimization algorithm to minimize the total objective function. Meanwhile, we clustered spots/cells using the output latent variables (termed shared latent features) of the GCN model (i.e. <inline-formula id="IEq131"><alternatives><tex-math id="M295">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${H}_{2}(Q)$$\end{document}</tex-math><mml:math id="M296"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq131.gif"/></alternatives></inline-formula>) and the K-mean algorithm, and we evaluated the clarity of the clustering result using the Davies-Bouldin score (DBS) implemented by scikit-learn package<sup><xref ref-type="bibr" rid="CR76">76</xref>,<xref ref-type="bibr" rid="CR77">77</xref></sup>. We trained the entire model until both <inline-formula id="IEq132"><alternatives><tex-math id="M297">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Loss}}}}}}$$\end{document}</tex-math><mml:math id="M298"><mml:mi mathvariant="normal">Loss</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq132.gif"/></alternatives></inline-formula> and DBS within two adjacent training epochs reached convergent values, i.e., <inline-formula id="IEq133"><alternatives><tex-math id="M299">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{Loss}}}}}} \, &lt; \, 0.0001$$\end{document}</tex-math><mml:math id="M300"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Loss</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0.0001</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq133.gif"/></alternatives></inline-formula> and <inline-formula id="IEq134"><alternatives><tex-math id="M301">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\Delta {{{{{\rm{DBS}}}}}} \, &lt; \, 0$$\end{document}</tex-math><mml:math id="M302"><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">DBS</mml:mi><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq134.gif"/></alternatives></inline-formula>. After the model converged, we adopted the spot/cell clusters obtained by Splane in the last epoch as spatial domains. As the shared latent features of the GCN model contain gene expression and spatial coordinate information of cells/spots, each spatial domain represents a batch of cells/spots that have common ground in both the transcriptome and space.</p>
    </sec>
    <sec id="Sec16">
      <title>Alignment of consecutive ST slices using Scube</title>
      <p id="Par47">In Scube, we first built a nearest neighbor graph between the cells/spots of two adjacent slices based on the coordinate of spots. As an initialization step for optimization algorithms, Scube aligns all slices by translating them so that their center points coincide with the coordinates <inline-formula id="IEq135"><alternatives><tex-math id="M303">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({{{{\mathrm{0,0}}}}})$$\end{document}</tex-math><mml:math id="M304"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">0, 0</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq135.gif"/></alternatives></inline-formula>. Then, we used the spatial domain information for each pair of nearest neighbor spots to construct an alignment objective function of two adjacent slices. We employed a differential evolution optimization to search for the optimal translation vectors and rotation angles, and transformed the coordinates of every slice accordingly. During each iteration of the global optimization process, Scube utilizes the adjusted coordinate information of spots to identify the nearest neighbors between two adjacent slices. By adjusting the coordinates of spots in the source slice, Scube aims to align the source slice to the target slice, ultimately maximizing the alignment objective function value. Finally, in Scube we performed all of the aforementioned steps for all adjacent slices, and used the transformed coordinates to stack these slices and construct the 3D alignment of the tissue.</p>
      <p id="Par48">Specifically, we used rigid body transformations (including mirroring, rotation, and translation) to transfer a slice <inline-formula id="IEq136"><alternatives><tex-math id="M305">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M306"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq136.gif"/></alternatives></inline-formula> as<disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M307">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }={RM}{S}_{j}+T$$\end{document}</tex-math><mml:math id="M308"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>T</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M309">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R=\left(\begin{array}{cc}\cos {\theta }_{j} &amp; -\sin {\theta }_{j}\\ \sin {\theta }_{j} &amp; \cos {\theta }_{j}\end{array}\right)$$\end{document}</tex-math><mml:math id="M310"><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>−</mml:mo><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi>sin</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mi>cos</mml:mi><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M311">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M=\left(\begin{array}{cc}{{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j} &amp; 0\\ 0 &amp; 1\end{array}\right)$$\end{document}</tex-math><mml:math id="M312"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="center"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ21"><label>21</label><alternatives><tex-math id="M313">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T=\left(\begin{array}{ccc}\Delta {x}_{1} &amp; \ldots &amp; \Delta {x}_{{n}_{j}}\\ \Delta {y}_{1} &amp; \ldots &amp; {\Delta y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M314"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq137"><alternatives><tex-math id="M315">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}\mathop{=}\limits^{{{{{\mathrm{def}}}}}}\left(\begin{array}{ccc}{x}_{1} &amp; \ldots &amp; {x}_{{n}_{j}}\\ {y}_{1} &amp; \ldots &amp; {y}_{{n}_{j}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M316"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="center"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq137.gif"/></alternatives></inline-formula> is the coordinate matrix of slice <inline-formula id="IEq138"><alternatives><tex-math id="M317">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M318"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq138.gif"/></alternatives></inline-formula>, <inline-formula id="IEq139"><alternatives><tex-math id="M319">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M320"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq139.gif"/></alternatives></inline-formula> is the coordinate matrix after rigid body transformation, and <inline-formula id="IEq140"><alternatives><tex-math id="M321">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M322"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq140.gif"/></alternatives></inline-formula> is the number of spots in slice <inline-formula id="IEq141"><alternatives><tex-math id="M323">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M324"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq141.gif"/></alternatives></inline-formula>; <inline-formula id="IEq142"><alternatives><tex-math id="M325">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$R$$\end{document}</tex-math><mml:math id="M326"><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq142.gif"/></alternatives></inline-formula> is the rotation matrix, <inline-formula id="IEq143"><alternatives><tex-math id="M327">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }_{j}$$\end{document}</tex-math><mml:math id="M328"><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq143.gif"/></alternatives></inline-formula> is the rotation angle of slice <inline-formula id="IEq144"><alternatives><tex-math id="M329">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M330"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq144.gif"/></alternatives></inline-formula>; <inline-formula id="IEq145"><alternatives><tex-math id="M331">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$M$$\end{document}</tex-math><mml:math id="M332"><mml:mi>M</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq145.gif"/></alternatives></inline-formula> is the mirroring matrix, <inline-formula id="IEq146"><alternatives><tex-math id="M333">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=-1$$\end{document}</tex-math><mml:math id="M334"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq146.gif"/></alternatives></inline-formula> represents the mirror operation of slice <inline-formula id="IEq147"><alternatives><tex-math id="M335">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M336"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq147.gif"/></alternatives></inline-formula>, elsewise <inline-formula id="IEq148"><alternatives><tex-math id="M337">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{fli}}}}}}{{{{{{\rm{p}}}}}}}_{j}=1$$\end{document}</tex-math><mml:math id="M338"><mml:mi mathvariant="normal">fli</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">p</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq148.gif"/></alternatives></inline-formula>; <inline-formula id="IEq149"><alternatives><tex-math id="M339">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T$$\end{document}</tex-math><mml:math id="M340"><mml:mi>T</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq149.gif"/></alternatives></inline-formula> is the translation matrix. We defined <inline-formula id="IEq150"><alternatives><tex-math id="M341">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${O}_{j}$$\end{document}</tex-math><mml:math id="M342"><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq150.gif"/></alternatives></inline-formula> as the set of overlapped spots/cells for the transformed slice <inline-formula id="IEq151"><alternatives><tex-math id="M343">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M344"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq151.gif"/></alternatives></inline-formula> between slice <inline-formula id="IEq152"><alternatives><tex-math id="M345">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M346"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq152.gif"/></alternatives></inline-formula> and the transformed slice <inline-formula id="IEq153"><alternatives><tex-math id="M347">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M348"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq153.gif"/></alternatives></inline-formula>. This set includes spots/cells in the transformed slice <inline-formula id="IEq154"><alternatives><tex-math id="M349">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M350"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq154.gif"/></alternatives></inline-formula> whose Euclidean distance to their <inline-formula id="IEq155"><alternatives><tex-math id="M351">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M352"><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq155.gif"/></alternatives></inline-formula> mutual nearest neighbor spots/cells in slice <inline-formula id="IEq156"><alternatives><tex-math id="M353">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M354"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq156.gif"/></alternatives></inline-formula> is less than a maximum distance. By default, the maximum distance defined as median Euclidean distance to the <inline-formula id="IEq157"><alternatives><tex-math id="M355">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$2{{{{{\rm{kth}}}}}}$$\end{document}</tex-math><mml:math id="M356"><mml:mn>2</mml:mn><mml:mi mathvariant="normal">kth</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq157.gif"/></alternatives></inline-formula> nearest neighbor of spots/cells in slice <inline-formula id="IEq158"><alternatives><tex-math id="M357">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M358"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq158.gif"/></alternatives></inline-formula>. Then we defined an alignment objective function (AOF) to measure the alignment between the transformed slices <inline-formula id="IEq159"><alternatives><tex-math id="M359">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M360"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq159.gif"/></alternatives></inline-formula> and slice <inline-formula id="IEq160"><alternatives><tex-math id="M361">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M362"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq160.gif"/></alternatives></inline-formula> as follows:<disp-formula id="Equ22"><label>22</label><alternatives><tex-math id="M363">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AOF}}}}}}\left({S}_{j}^{{\prime} }|{S}_{j-1}\right) \mathop{=}\limits^{{{{{\mathrm{def}}}}}} \frac{1}{{n}_{o}}\mathop{\sum}\limits_{{{l}_{j}^{\prime }}\in {{O}_{j}}}\frac{1}{m}{\sum }_{{{l}_{j-1}}\in {{\left\langle {l}_{j}^{\prime }\right\rangle }_{k}^{j-1}}}\, \delta \left[{{{{{\rm{domain}}}}}}\left({l}_{j-1}\right),\,{{{{{\rm{domain}}}}}}\left({l}_{j}^{\prime }\right)\right]+f \left(\frac{{n}_{o}}{{n}_{j}}\right)$$\end{document}</tex-math><mml:math id="M364"><mml:mi mathvariant="normal">AOF</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mrow><mml:mo>=</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">def</mml:mi></mml:mrow></mml:mover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="⟩" open="⟨"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:mi>δ</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">domain</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq161"><alternatives><tex-math id="M365">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }\in {O}_{j}$$\end{document}</tex-math><mml:math id="M366"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq161.gif"/></alternatives></inline-formula> are overlapped spots/cells in transformed slice <inline-formula id="IEq162"><alternatives><tex-math id="M367">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M368"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq162.gif"/></alternatives></inline-formula>; <inline-formula id="IEq163"><alternatives><tex-math id="M369">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M370"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq163.gif"/></alternatives></inline-formula> is a set of spots/cells in slice <inline-formula id="IEq164"><alternatives><tex-math id="M371">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M372"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq164.gif"/></alternatives></inline-formula> which means the mutual <inline-formula id="IEq165"><alternatives><tex-math id="M373">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M374"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq165.gif"/></alternatives></inline-formula> nearest neighbors of spot/cell <inline-formula id="IEq166"><alternatives><tex-math id="M375">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{j}^{{\prime} }$$\end{document}</tex-math><mml:math id="M376"><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq166.gif"/></alternatives></inline-formula>; <inline-formula id="IEq167"><alternatives><tex-math id="M377">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m$$\end{document}</tex-math><mml:math id="M378"><mml:mi>m</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq167.gif"/></alternatives></inline-formula> means the elements number in set <inline-formula id="IEq168"><alternatives><tex-math id="M379">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\langle {l}_{j}^{{\prime} }\rangle }_{k}^{j-1}$$\end{document}</tex-math><mml:math id="M380"><mml:msubsup><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq168.gif"/></alternatives></inline-formula>; <inline-formula id="IEq169"><alternatives><tex-math id="M381">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta \left(x,y\right)$$\end{document}</tex-math><mml:math id="M382"><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq169.gif"/></alternatives></inline-formula> is a Kronecker function. <inline-formula id="IEq170"><alternatives><tex-math id="M383">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left(x\right)=-{\left(x-1\right)}^{p}$$\end{document}</tex-math><mml:math id="M384"><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq170.gif"/></alternatives></inline-formula> is the penalty term; <inline-formula id="IEq171"><alternatives><tex-math id="M385">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M386"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq171.gif"/></alternatives></inline-formula> is the exponent of the penalty, with a larger <inline-formula id="IEq172"><alternatives><tex-math id="M387">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p$$\end{document}</tex-math><mml:math id="M388"><mml:mi>p</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq172.gif"/></alternatives></inline-formula> indicates stronger partial alignment capability; <inline-formula id="IEq173"><alternatives><tex-math id="M389">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{o}$$\end{document}</tex-math><mml:math id="M390"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq173.gif"/></alternatives></inline-formula> is the number of overlapped spots/cells in slice <inline-formula id="IEq174"><alternatives><tex-math id="M391">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j-1$$\end{document}</tex-math><mml:math id="M392"><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq174.gif"/></alternatives></inline-formula>; <inline-formula id="IEq175"><alternatives><tex-math id="M393">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{j}$$\end{document}</tex-math><mml:math id="M394"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq175.gif"/></alternatives></inline-formula> is the number of all spots/cells in the transformed slice <inline-formula id="IEq176"><alternatives><tex-math id="M395">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M396"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq176.gif"/></alternatives></inline-formula>; Then we adopted the differential evolution algorithm to determine the best transformation matrices <inline-formula id="IEq177"><alternatives><tex-math id="M397">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{R,M,T\right\}$$\end{document}</tex-math><mml:math id="M398"><mml:mfenced close="}" open="{"><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq177.gif"/></alternatives></inline-formula> to maximize the AOF value between two adjacent slices. After determining transformation matrices for all slices, we can stack these transformed slices to construct a 3D alignment of the tissue.</p>
    </sec>
    <sec id="Sec17">
      <title>Gaussian progress regression model</title>
      <p id="Par49">We embedded a Gaussian process regression method<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR59">59</xref></sup> in SPACEL to obtain the continuous 3D distribution of a transcript from Scube transformed slices. First, we adopted the Alpha shape algorithm<sup><xref ref-type="bibr" rid="CR78">78</xref>,<xref ref-type="bibr" rid="CR79">79</xref></sup> to generate a 3D meshed manifold from the coordinates of the spots/cells in all slices, and smoothed this manifold using a subdivision algorithm<sup><xref ref-type="bibr" rid="CR80">80</xref></sup>. We built a Gaussian process (GP) model for the expression level <inline-formula id="IEq178"><alternatives><tex-math id="M399">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${y}_{i}^{\left(j\right)}$$\end{document}</tex-math><mml:math id="M400"><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq178.gif"/></alternatives></inline-formula> of gene <inline-formula id="IEq179"><alternatives><tex-math id="M401">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M402"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq179.gif"/></alternatives></inline-formula> in each spot/cell <inline-formula id="IEq180"><alternatives><tex-math id="M403">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M404"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq180.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ23"><label>23</label><alternatives><tex-math id="M405">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{y}_{i}}^{\left(j\right)}|{x}^{\left(j\right)}={f}_{i}({x}^{\left(j\right)})+\epsilon$$\end{document}</tex-math><mml:math id="M406"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>∣</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq181"><alternatives><tex-math id="M407">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M408"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq181.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq182"><alternatives><tex-math id="M409">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M410"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq182.gif"/></alternatives></inline-formula>, ε represents Gaussian additive noise, and the functional form of <inline-formula id="IEq183"><alternatives><tex-math id="M411">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}(\cdot )$$\end{document}</tex-math><mml:math id="M412"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq183.gif"/></alternatives></inline-formula> is unknown and may vary between genes, denoted as<disp-formula id="Equ24"><label>24</label><alternatives><tex-math id="M413">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{i}\left(x\right) \sim {{{{{\rm{GP}}}}}}\left[\mu \left(\mathop{x}\limits^{ \rightharpoonup }\right),{{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} \right)\right]$$\end{document}</tex-math><mml:math id="M414"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>~</mml:mo><mml:mi mathvariant="normal">GP</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>μ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mo>x</mml:mo></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ25"><label>25</label><alternatives><tex-math id="M415">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}\left(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\prime} \right)=\mathop{\sum}\limits_{j,{j}^{{\prime} }}{\delta }^{2}\exp \left[-\frac{{\left({x}^{\left(j\right)}-{x}^{\left({j}^{{\prime} }\right)}\right)}^{2}}{2{l}^{2}}\right]$$\end{document}</tex-math><mml:math id="M416"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>′</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>exp</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq184"><alternatives><tex-math id="M417">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${x}^{(j)}$$\end{document}</tex-math><mml:math id="M418"><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq184.gif"/></alternatives></inline-formula> is the coordinate of spot/cell <inline-formula id="IEq185"><alternatives><tex-math id="M419">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M420"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq185.gif"/></alternatives></inline-formula>, <inline-formula id="IEq186"><alternatives><tex-math id="M421">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M422"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq186.gif"/></alternatives></inline-formula> represents the mean function, <inline-formula id="IEq187"><alternatives><tex-math id="M423">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Cov}}}}}}(\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup },\mathop{{{{{{\bf{x}}}}}}}\limits^{ \rightharpoonup }{\!}^{\prime} )$$\end{document}</tex-math><mml:math id="M424"><mml:mi mathvariant="normal">Cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover><mml:msup><mml:mrow/><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq187.gif"/></alternatives></inline-formula> represents the covariance function, and <inline-formula id="IEq188"><alternatives><tex-math id="M425">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M426"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq188.gif"/></alternatives></inline-formula> and <inline-formula id="IEq189"><alternatives><tex-math id="M427">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M428"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq189.gif"/></alternatives></inline-formula> are the process-variance and length-scale hyperparameters, respectively. The objective function for training the GP model is the marginal likelihood,<disp-formula id="Equ26"><label>26</label><alternatives><tex-math id="M429">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L\left({y}_{i}{|x},\, \theta \right)=\int P\left({y}_{i}|{f}_{i},\, x,\, \theta \right)P\left({f}_{i}{|x},\, \theta \right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M430"><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula>of gaussian process model. The hyper-parameter <inline-formula id="IEq190"><alternatives><tex-math id="M431">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\theta$$\end{document}</tex-math><mml:math id="M432"><mml:mi>θ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq190.gif"/></alternatives></inline-formula> can be set by maximizing a posteriori estimation, defined as:<disp-formula id="Equ27"><label>27</label><alternatives><tex-math id="M433">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\theta }^{*}\leftarrow {{{{{\rm{ar}}}}}}{{{{{{\rm{g}}}}}}}_{\theta }\max \int P\left({y}_{i}|{f}_{i},\, x,\,\theta \right)P\left({f}_{i}{|x},\, \theta \right)P\left({{{{{\rm{\theta }}}}}}\right)d{f}_{i}$$\end{document}</tex-math><mml:math id="M434"><mml:msup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo>←</mml:mo><mml:mi mathvariant="normal">ar</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">g</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mi>max</mml:mi><mml:mo>∫</mml:mo><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>P</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="normal">θ</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula>We set the initial values of these hyperparameters as <inline-formula id="IEq191"><alternatives><tex-math id="M435">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu ({\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup }})={{{{{\rm{mean}}}}}}({y}_{i})$$\end{document}</tex-math><mml:math id="M436"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">mean</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq191.gif"/></alternatives></inline-formula>, <inline-formula id="IEq192"><alternatives><tex-math id="M437">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta=4$$\end{document}</tex-math><mml:math id="M438"><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq192.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq193"><alternatives><tex-math id="M439">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l={{{{{\rm{\lambda }}}}}}\cdot {{{{\mathrm{var}}}}}\left({y}_{i}\right)$$\end{document}</tex-math><mml:math id="M440"><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">λ</mml:mi><mml:mo>⋅</mml:mo><mml:mi mathvariant="normal">var</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq193.gif"/></alternatives></inline-formula>, and we used a grid search strategy<sup><xref ref-type="bibr" rid="CR81">81</xref></sup> to determine the value of <inline-formula id="IEq194"><alternatives><tex-math id="M441">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{\lambda }}}}}}$$\end{document}</tex-math><mml:math id="M442"><mml:mi mathvariant="normal">λ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq194.gif"/></alternatives></inline-formula> that maximizes the marginal likelihood. Then, we used the coordinates and gene expression information of spots/cells in all slices to train this GP model, and optimized the hyperparameters <inline-formula id="IEq195"><alternatives><tex-math id="M443">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu (\mathop{{{{{{\mathbf{x}}}}}}}\limits^{ \rightharpoonup })$$\end{document}</tex-math><mml:math id="M444"><mml:mi>μ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo>⇀</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq195.gif"/></alternatives></inline-formula>, <inline-formula id="IEq196"><alternatives><tex-math id="M445">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M446"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq196.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq197"><alternatives><tex-math id="M447">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M448"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq197.gif"/></alternatives></inline-formula> using the Adam algorithm<sup><xref ref-type="bibr" rid="CR73">73</xref></sup>. Finally, we uniformly sampled 500,000 points in the 3D meshed manifold, and used the trained GPR model to predict the expression level of a gene at each point. The gene expression information of these points constitutes the distribution of a transcript in 3D space. Based on the GPR model, we can use the Bayes Factor (BF) to quantify the spatial variation of a given gene in 3D space<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>:<disp-formula id="Equ28"><label>28</label><alternatives><tex-math id="M449">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{BF}}}}}}=\frac{L\left({M}_{1}\right)}{L\left({M}_{2}\right)}$$\end{document}</tex-math><mml:math id="M450"><mml:mi mathvariant="normal">BF</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq198"><alternatives><tex-math id="M451">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{1})$$\end{document}</tex-math><mml:math id="M452"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq198.gif"/></alternatives></inline-formula> denotes the marginal likelihood of the optimized GPR model and <inline-formula id="IEq199"><alternatives><tex-math id="M453">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$L({M}_{2})$$\end{document}</tex-math><mml:math id="M454"><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq199.gif"/></alternatives></inline-formula> denotes the marginal likelihood of a simplified GPR model in which <inline-formula id="IEq200"><alternatives><tex-math id="M455">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M456"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq200.gif"/></alternatives></inline-formula> was set to <inline-formula id="IEq201"><alternatives><tex-math id="M457">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\infty$$\end{document}</tex-math><mml:math id="M458"><mml:mi>∞</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq201.gif"/></alternatives></inline-formula>. Larger BF values denote greater spatial variation in the gene expression level.</p>
    </sec>
    <sec id="Sec18">
      <title>Robustness test of SPACEL</title>
      <p id="Par50">To test the robustness of SPACEL, we evaluated its performance across various hyperparameters. Each hyperparameter was varied individually while keeping the other hyperparameter values constant. In Spoint, we assessed its performance by varying two user-defined hyperparameters (the number of simulated spots in the training set and the number of marker genes in each single-cell cluster) and three model hyperparameters (the dimensions of latent layers, hidden layers of predicted model, and probability output layers) in real single-cell resolution ST datasets<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR49">49</xref></sup>. In Splane, we compared its performance by varying five hyperparameters (the dropout rate of the model layers, the weight of the adversarial loss, the degree of neighbors in the constructed graph, the dimensions of latent layers, and the dimensions of hidden layers) using human DFPLC data<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. In Scube, we tested its performance by varying the five hyperparameters used in Splane, one additional hyperparameter (the number of spatial domains), and two hyperparameters specific to Scube (the number of nearest neighbors in the MNN graph and the exponent of the penalty for the overlap ratio between adjacent slices) using 3D STARmap data<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> with a crop rate of 0.25.</p>
    </sec>
    <sec id="Sec19">
      <title>Jaccard index and shifting distance</title>
      <p id="Par51">To evaluate the prediction accuracy of the spatial domains identified by each method, we computed the Jaccard Index (JI) for each spatial domain with a manually annotated cortical layer. Specifically, we defined a set <inline-formula id="IEq202"><alternatives><tex-math id="M459">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M460"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq202.gif"/></alternatives></inline-formula> that contains all spots in the spatial domain <inline-formula id="IEq203"><alternatives><tex-math id="M461">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M462"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq203.gif"/></alternatives></inline-formula> and a set <inline-formula id="IEq204"><alternatives><tex-math id="M463">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{l}$$\end{document}</tex-math><mml:math id="M464"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq204.gif"/></alternatives></inline-formula> that contains all spots in the cortical layer <inline-formula id="IEq205"><alternatives><tex-math id="M465">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l$$\end{document}</tex-math><mml:math id="M466"><mml:mi>l</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq205.gif"/></alternatives></inline-formula>. We calculated <inline-formula id="IEq206"><alternatives><tex-math id="M467">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,\, l\right)=\frac{{P}_{d}\cap {P}_{l}}{{P}_{d}\cup {P}_{l}}$$\end{document}</tex-math><mml:math id="M468"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq206.gif"/></alternatives></inline-formula> between a spatial domain <inline-formula id="IEq207"><alternatives><tex-math id="M469">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M470"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq207.gif"/></alternatives></inline-formula> and all cortical layers, and defined the cortical layer with the largest JI value as the corresponding layer of domain <inline-formula id="IEq208"><alternatives><tex-math id="M471">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M472"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq208.gif"/></alternatives></inline-formula>, i.e., layer <inline-formula id="IEq209"><alternatives><tex-math id="M473">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}$$\end{document}</tex-math><mml:math id="M474"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq209.gif"/></alternatives></inline-formula>:<disp-formula id="Equ29"><label>29</label><alternatives><tex-math id="M475">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${l}_{d}={{\arg }}{{{{{{\rm{m}}}}}}{{{{{\rm{ax}}}}}}}_{l}\left[{{{{{\rm{JI}}}}}}\left(d,\, l\right)\right]$$\end{document}</tex-math><mml:math id="M476"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>arg</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">ax</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mi mathvariant="normal">JI</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>l</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par52">We then used <inline-formula id="IEq210"><alternatives><tex-math id="M477">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{J}}}}}}{{{{{\rm{I}}}}}}\left(d,{l}_{d}\right)$$\end{document}</tex-math><mml:math id="M478"><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>d</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq210.gif"/></alternatives></inline-formula> to measure the prediction accuracy for the spatial domain <inline-formula id="IEq211"><alternatives><tex-math id="M479">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d$$\end{document}</tex-math><mml:math id="M480"><mml:mi>d</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq211.gif"/></alternatives></inline-formula>. We calculated the JI values for all spatial domains in a slice and used the average JI value for these domains to represent the prediction accuracy for the slice. In addition, for a spatial domain, we defined the distance from one of its spots to its corresponding cortical layer as the shifting distance (SD) of the spot and used the average SD of all spots in the spatial domain to evaluate the performance of each method. A lower SD value indicates a better consistency between the spatial domain and the corresponding cortical layer.</p>
    </sec>
    <sec id="Sec20">
      <title>Identification of spatial variable genes</title>
      <p id="Par53">We used two strategies to obtain the ground truth for spatial variable genes (SVGs). The first strategy was to use the differentially expressed genes of manually annotated cortical layers as the ground truth. Specifically, after normalizing the expression matrix of the ST data using Scanpy, we applied the two-sided Wilcoxon rank-sum test and the threshold log(fold-change) &gt; 0.5, <italic>P</italic>-value &lt; 0.01 to obtain differentially expressed genes (DEGs) for each cortical layer, which we used as the ground truth for SVGs. We used the same strategy to obtain DEGs for each spatial domain. Then, we calculated the sensitivity and specificity of the DEGs of spatial domains obtained by each method, and plotted receiver operating characteristic curves using the <italic>P</italic>-value ranking of DEGs.</p>
    </sec>
    <sec id="Sec21">
      <title>ASW of slices from different experimental batches</title>
      <p id="Par54">To assess the performance of Splane in reducing the batch effect when jointly analyzing multiple slices, we calculated the Average Silhouette Width (ASW) using the equation:<disp-formula id="Equ30"><label>30</label><alternatives><tex-math id="M481">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{ASW}}}}}}=\frac{1}{K}\mathop{\sum}\limits_{k=1}^{K}\frac{1}{{C}_{k}}\mathop{\sum}\limits_{i=1}^{{C}_{k}}1-|{{{{{\rm{Silhouette}}}}}}\left(i\right)|$$\end{document}</tex-math><mml:math id="M482"><mml:mi mathvariant="normal">ASW</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>∣</mml:mo><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>∣</mml:mo></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ31"><label>31</label><alternatives><tex-math id="M483">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{Silhouette}}}}}}=\mathop{\sum }\limits_{i}^{N}\frac{b\left(i\right)-a\left(i\right)}{\max \left[a\left(i\right),b\left(i\right)\right]}$$\end{document}</tex-math><mml:math id="M484"><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ31.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ32"><label>32</label><alternatives><tex-math id="M485">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a\left(i\right)=\frac{1}{{n}_{s}-1}\mathop{\sum }\limits_{j\in s}^{{n}_{s}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)$$\end{document}</tex-math><mml:math id="M486"><mml:mi>a</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ32.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ33"><label>33</label><alternatives><tex-math id="M487">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b\left(i\right)={\min }_{{s}^{{\prime} }}\left[\frac{1}{{n}_{{s}^{{\prime} }}-1}\mathop{\sum }\limits_{j\in {s}^{{\prime} }}^{{n}_{{s}^{{\prime} }}}{{{{{\rm{distance}}}}}}\left(i,\, j\right)\right]$$\end{document}</tex-math><mml:math id="M488"><mml:mi>b</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mi mathvariant="normal">distance</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ33.gif" position="anchor"/></alternatives></disp-formula>where spot/cell <inline-formula id="IEq212"><alternatives><tex-math id="M489">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M490"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq212.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq213"><alternatives><tex-math id="M491">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M492"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq213.gif"/></alternatives></inline-formula>, spot/cell <inline-formula id="IEq214"><alternatives><tex-math id="M493">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M494"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq214.gif"/></alternatives></inline-formula> is from dataset <inline-formula id="IEq215"><alternatives><tex-math id="M495">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M496"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq215.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq216"><alternatives><tex-math id="M497">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a$$\end{document}</tex-math><mml:math id="M498"><mml:mi>a</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq216.gif"/></alternatives></inline-formula>) or <inline-formula id="IEq217"><alternatives><tex-math id="M499">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s{{\hbox{'}}}}$$\end{document}</tex-math><mml:math id="M500"><mml:mi>s</mml:mi><mml:mi>’</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq217.gif"/></alternatives></inline-formula> (for <inline-formula id="IEq218"><alternatives><tex-math id="M501">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b$$\end{document}</tex-math><mml:math id="M502"><mml:mi>b</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq218.gif"/></alternatives></inline-formula>), <inline-formula id="IEq219"><alternatives><tex-math id="M503">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M504"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq219.gif"/></alternatives></inline-formula> is the number of cells with the domain/cluster <inline-formula id="IEq220"><alternatives><tex-math id="M505">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M506"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq220.gif"/></alternatives></inline-formula>, <inline-formula id="IEq221"><alternatives><tex-math id="M507">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K$$\end{document}</tex-math><mml:math id="M508"><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq221.gif"/></alternatives></inline-formula> is the number of domains/clusters, <inline-formula id="IEq222"><alternatives><tex-math id="M509">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${n}_{s}$$\end{document}</tex-math><mml:math id="M510"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq222.gif"/></alternatives></inline-formula> is the spot/cell number in dataset <inline-formula id="IEq223"><alternatives><tex-math id="M511">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s$$\end{document}</tex-math><mml:math id="M512"><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq223.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq224"><alternatives><tex-math id="M513">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N$$\end{document}</tex-math><mml:math id="M514"><mml:mi>N</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq224.gif"/></alternatives></inline-formula> is the total number of spots/cells in all datasets. We calculated the Euclidean distance between spots/cells <inline-formula id="IEq225"><alternatives><tex-math id="M515">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M516"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq225.gif"/></alternatives></inline-formula> and <inline-formula id="IEq226"><alternatives><tex-math id="M517">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M518"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq226.gif"/></alternatives></inline-formula> from the raw expression matrix or from the latent features of spots/cells <inline-formula id="IEq227"><alternatives><tex-math id="M519">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M520"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq227.gif"/></alternatives></inline-formula> and <inline-formula id="IEq228"><alternatives><tex-math id="M521">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$j$$\end{document}</tex-math><mml:math id="M522"><mml:mi>j</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq228.gif"/></alternatives></inline-formula>. We used the scib<sup><xref ref-type="bibr" rid="CR82">82</xref></sup> implementation to compute the ASW scores.</p>
    </sec>
    <sec id="Sec22">
      <title>Copy number variation estimated by inferCNV</title>
      <p id="Par55">We employed inferCNV<sup><xref ref-type="bibr" rid="CR57">57</xref></sup> to estimate copy number variations (CNVs) for the breast cancer ST slices. We used the default setting cut-off = 0.1 for inferCNV, i.e., only genes with an average count &gt; 0.1 were considered. We used spots containing &lt; 10% cancer cells as reference samples and other spots as malignant samples. To compare the CNV values inferred from different slices and different experimental batches, we scaled the inferred CNV values to −1 ~ 1, and we calculated the average inferred CNV at each genomic locus for all spots in a spatial domain, to represent the mutation information of the spatial domain.</p>
    </sec>
    <sec id="Sec23">
      <title>Validation of immune domains</title>
      <p id="Par56">To validate that D3, D5, and D9 are immune domains, we calculated the percentage of overlap (PO) between the experimental annotation of immune spots and the spatial domains identified by Splane, as<disp-formula id="Equ34"><label>34</label><alternatives><tex-math id="M523">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{PO}}}}}}}_{d}=\frac{{P}_{{{{{{\rm{lym}}}}}}}\cap {P}_{d}}{{P}_{d}}$$\end{document}</tex-math><mml:math id="M524"><mml:msub><mml:mrow><mml:mi mathvariant="normal">PO</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">lym</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ34.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq229"><alternatives><tex-math id="M525">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{{lym}}$$\end{document}</tex-math><mml:math id="M526"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>y</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq229.gif"/></alternatives></inline-formula> is the set of immune spots annotated by experiments, and <inline-formula id="IEq230"><alternatives><tex-math id="M527">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${P}_{d}$$\end{document}</tex-math><mml:math id="M528"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq230.gif"/></alternatives></inline-formula> is the set of spots in domain d. For slices S1, S2, S5, and S6, we used the H&amp;E staining information from the original study as the experimental annotation of immune spots<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. For slice S10, we used the anti-CD3 immunofluorescence images of the slice to annotate immune spots<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Specifically, we first used DeepCell<sup><xref ref-type="bibr" rid="CR68">68</xref></sup> and DAPI channel information to filter cells with sizes between 150 and 1000 pixels. Then, we scaled the CD3 fluorescence intensity of each pixel to 0−1, and used the average of the scaled CD3 intensity of pixels within a cell to represent the CD3 intensity of the cell. Cells with CD3 intensity &gt; 0.37 were defined as CD3<sup>+</sup> cells, and spots containing &gt; 30% CD3<sup>+</sup> cells were used as experimentally annotated lymphocyte spots.</p>
    </sec>
    <sec id="Sec24">
      <title>Metrics for benchmarking deconvolution methods</title>
      <p id="Par57">We employed the five metrics from a previous benchmarking study of deconvolution methods<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> to compare the performance of Splane with other state-of-the-art methods in processing the 32 simulated ST datasets:</p>
      <p id="Par58">1. Pearson correlation coefficient (PCC):<disp-formula id="Equ35"><label>35</label><alternatives><tex-math id="M529">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{PCC}}}}}}=\frac{E\left[\left({\widetilde{{{{{{\bf{x}}}}}}}}_{i}-{\widetilde{u}}_{i}\right)\left({{{{{{\bf{x}}}}}}}_{i}-{u}_{i}\right)\right]}{{\widetilde{s}}_{i}{s}_{i}}$$\end{document}</tex-math><mml:math id="M530"><mml:mi mathvariant="normal">PCC</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mfenced close="]" open="["><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ35.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq231"><alternatives><tex-math id="M531">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\boldsymbol{x}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M532"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq231.gif"/></alternatives></inline-formula> is the cell type composition of cell type <inline-formula id="IEq232"><alternatives><tex-math id="M533">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M534"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq232.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq233"><alternatives><tex-math id="M535">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${u}_{i}$$\end{document}</tex-math><mml:math id="M536"><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq233.gif"/></alternatives></inline-formula> is the average cell type composition of cell type <inline-formula id="IEq234"><alternatives><tex-math id="M537">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M538"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq234.gif"/></alternatives></inline-formula> in the ground truth, <inline-formula id="IEq235"><alternatives><tex-math id="M539">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{i}$$\end{document}</tex-math><mml:math id="M540"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq235.gif"/></alternatives></inline-formula> is the standard deviation of the cell type composition of cell type <inline-formula id="IEq236"><alternatives><tex-math id="M541">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M542"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq236.gif"/></alternatives></inline-formula> in the ground truth, and <inline-formula id="IEq237"><alternatives><tex-math id="M543">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{x}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M544"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq237.gif"/></alternatives></inline-formula>, <inline-formula id="IEq238"><alternatives><tex-math id="M545">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{u}}_{i}$$\end{document}</tex-math><mml:math id="M546"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq238.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq239"><alternatives><tex-math id="M547">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{\sigma }}_{i}$$\end{document}</tex-math><mml:math id="M548"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq239.gif"/></alternatives></inline-formula> are the corresponding values in the predicted result. For a cell type, a higher PCC value indicates higher deconvolution accuracy.</p>
      <p id="Par59">2. Structural similarity (SSIM)<bold>:</bold><disp-formula id="Equ36"><label>36</label><alternatives><tex-math id="M549">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{SSIM}}}}}}=\frac{\left({2\widetilde{u}}_{i}{u}_{i}+{C}_{1}^{2}\right)\left(2{{{{\mathrm{cov}}}}}({{{{{{\boldsymbol{x}}}}}}^{\prime }}_{i},{\widetilde{{{{{{\boldsymbol{x}}}}}}}^{\prime} }_{i})+{C}_{2}^{2}\right)}{\left({{\widetilde{u}}_{i}}^{2}{{+u}_{i}}^{2}+{C}_{1}^{2}\right)\left({{\widetilde{s}}_{i}}^{2}{{+s}_{i}}^{2}+{C}_{2}^{2}\right)}$$\end{document}</tex-math><mml:math id="M550"><mml:mi mathvariant="normal">SSIM</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mn>2</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mo>+</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ36.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq240"><alternatives><tex-math id="M551">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{\mathrm{cov}}}}}({{{{{{\bf{x}}}}}}}_{i},{\widetilde{{{{{{\bf{x}}}}}}}}_{i})$$\end{document}</tex-math><mml:math id="M552"><mml:mi mathvariant="normal">cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq240.gif"/></alternatives></inline-formula> is the covariance between the ground truth and the predicted result, and <inline-formula id="IEq241"><alternatives><tex-math id="M553">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{1}$$\end{document}</tex-math><mml:math id="M554"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq241.gif"/></alternatives></inline-formula> and <inline-formula id="IEq242"><alternatives><tex-math id="M555">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{2}$$\end{document}</tex-math><mml:math id="M556"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq242.gif"/></alternatives></inline-formula> are 0.01 and 0.03, respectively. For a cell type, a higher SSIM value indicates higher deconvolution accuracy.</p>
      <p id="Par60">3. Root mean square error (RMSE):<disp-formula id="Equ37"><label>37</label><alternatives><tex-math id="M557">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{RMSE}}}}}}=\sqrt{\frac{1}{M}\mathop{\sum }\limits_{j=1}^{M}{\left({\widetilde{x}}_{{ij}}-{x}_{{ij}}\right)}^{2}}$$\end{document}</tex-math><mml:math id="M558"><mml:mi mathvariant="normal">RMSE</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ37.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par61">For a cell type, a lower RMSE value indicates higher deconvolution accuracy.</p>
      <p id="Par62">4. Jensen-Shannon divergence (JS):<disp-formula id="Equ38"><label>38</label><alternatives><tex-math id="M559">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{JS}}}}}}=\frac{1}{2}{{{{{\rm{KL}}}}}}\left({\widetilde{{{{{{\bf{P}}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)+\frac{1}{2}{{{{{\rm{KL}}}}}}\left({{{{{{\bf{P}}}}}}}_{i}\bigg|\frac{{\widetilde{{{{{{\bf{P}}}}}}}}_{i}+{{{{{{\bf{P}}}}}}}_{i}}{2}\right)$$\end{document}</tex-math><mml:math id="M560"><mml:mi mathvariant="normal">JS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="2.03em"><mml:mfenced open="∣"><mml:mrow/></mml:mfenced></mml:mstyle><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ38.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ39"><label>39</label><alternatives><tex-math id="M561">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{KL}}}}}}\left({{{{{{\boldsymbol{a}}}}}}}_{i}{||}{{{{{{\boldsymbol{b}}}}}}}_{i}\right)={\sum }_{j=0}^{M}\left({a}_{{ij}} * \log \frac{{a}_{{ij}}}{{b}_{{ij}}}\right)$$\end{document}</tex-math><mml:math id="M562"><mml:mi mathvariant="normal">KL</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:msubsup><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ39.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq243"><alternatives><tex-math id="M563">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{P}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M564"><mml:msub><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq243.gif"/></alternatives></inline-formula> and <inline-formula id="IEq244"><alternatives><tex-math id="M565">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{{{{{{\bf{P}}}}}}}}_{i}$$\end{document}</tex-math><mml:math id="M566"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq244.gif"/></alternatives></inline-formula> are the spatial distribution of cell type <inline-formula id="IEq245"><alternatives><tex-math id="M567">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i$$\end{document}</tex-math><mml:math id="M568"><mml:mi>i</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq245.gif"/></alternatives></inline-formula> in the ground truth and the predicted result, respectively. For a cell type, a lower JS value indicates higher deconvolution accuracy.</p>
      <p id="Par63">5. Accuracy score (AS): We computed the average PCC, SSIM, RMSE, and JS of all cell types predicted by each method, and sorted the average PCC/SSIM and RMSE/JS of all deconvolution methods in ascending and descending order, respectively, to obtain <inline-formula id="IEq246"><alternatives><tex-math id="M569">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}$$\end{document}</tex-math><mml:math id="M570"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq246.gif"/></alternatives></inline-formula>, <inline-formula id="IEq247"><alternatives><tex-math id="M571">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}$$\end{document}</tex-math><mml:math id="M572"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq247.gif"/></alternatives></inline-formula>, <inline-formula id="IEq248"><alternatives><tex-math id="M573">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}$$\end{document}</tex-math><mml:math id="M574"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq248.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq249"><alternatives><tex-math id="M575">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}$$\end{document}</tex-math><mml:math id="M576"><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq249.gif"/></alternatives></inline-formula>. Then, we calculated the average of the four rankings to obtain the AS value of each method as follows:<disp-formula id="Equ40"><label>40</label><alternatives><tex-math id="M577">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{\rm{AS}}}}}}=\frac{1}{4}\left({{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{PCC}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{SSIM}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{RMSE}}}}}}}+{{{{{{\rm{RANK}}}}}}}_{{{{{{\rm{JS}}}}}}}\right)$$\end{document}</tex-math><mml:math id="M578"><mml:mi mathvariant="normal">AS</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">PCC</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">SSIM</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">RMSE</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">RANK</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">JS</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ40.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par64">For a dataset, the method with the highest AS value has the best performance among all deconvolution methods.</p>
      <p id="Par65">For the DPLFC dataset, the cell type composition of each spot in the ST slices has not been validated by any experiments. To benchmark deconvolution methods in processing this real ST dataset, we adopted the cortical layers annotated by the original study as ground truth. We defined the accuracy score for the deconvolution results of the DPLFC datasets as the predicted proportion of one cell type in its corresponding cortical layer. Additionally, we used the Wilcoxon Rank Sum test to calculate P-values for the difference in the average proportion of each excitatory neuron cell type between the corresponding layer and the other layers across all samples. The method with the highest accuracy score and the lowest P-value has the highest deconvolution accuracy.</p>
    </sec>
    <sec id="Sec25">
      <title>Evaluation of alignment on continuous slices</title>
      <p id="Par66">We employed a 3D STARmap dataset of the mouse brain from Wang et al. study to build a ground truth to compare the performance of Scube, PASTE, and STAligner. Specifically, we divided the 1400 µm × 1700 µm × 100 µm mouse brain sample into ten 10 µm thick slices, <inline-formula id="IEq250"><alternatives><tex-math id="M579">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{{\hat{S}}_{i}\}$$\end{document}</tex-math><mml:math id="M580"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq250.gif"/></alternatives></inline-formula>, and used these slices as a ground truth. To simulate changes in the shape and position of slices during tissue sectioning, we randomly flipped, cropped, translated, and rotated each ground truth slice, to generate an ST dataset comprising consecutive 2D slices, <inline-formula id="IEq251"><alternatives><tex-math id="M581">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{{S}_{i}\right\}$$\end{document}</tex-math><mml:math id="M582"><mml:mfenced close="}" open="{"><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq251.gif"/></alternatives></inline-formula>. Specifically, each slice (except the first slice) was randomly flipped, rotated by a random degree of 0°–360°, and translated by a random distance of 300−2000 μm along the x-axis and/or y-axis. Moreover, each slice was cropped from its edges with a crop ratio of 0.05–0.25. Then, we used Scube, PASTE, and STAligner to align each pair of adjacent simulated slices, <inline-formula id="IEq252"><alternatives><tex-math id="M583">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i},{S}_{i+1}\right)$$\end{document}</tex-math><mml:math id="M584"><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq252.gif"/></alternatives></inline-formula>, and obtain the aligned pair of slices, <inline-formula id="IEq253"><alternatives><tex-math id="M585">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left({S}_{i}^{{\prime} },{S}_{i+1}^{{\prime} }\right)$$\end{document}</tex-math><mml:math id="M586"><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq253.gif"/></alternatives></inline-formula>.</p>
      <p id="Par67">To compare the alignment results of Scube, PASTE, and STAligner with the ground truth, we first calculated the transformation matrix <inline-formula id="IEq254"><alternatives><tex-math id="M587">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M588"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq254.gif"/></alternatives></inline-formula> from an aligned slice <inline-formula id="IEq255"><alternatives><tex-math id="M589">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M590"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq255.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq256"><alternatives><tex-math id="M591">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M592"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq256.gif"/></alternatives></inline-formula> as<disp-formula id="Equ41"><label>41</label><alternatives><tex-math id="M593">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}={S}_{i}^{{\prime} \left(3\right)}{\left(\begin{array}{c}{\hat{S}}_{i}^{\left(3\right)}\\ {{{{{{\bf{1}}}}}}}_{1\times 3}\end{array}\right)}^{-1}$$\end{document}</tex-math><mml:math id="M594"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ41.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq257"><alternatives><tex-math id="M595">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} (3)}$$\end{document}</tex-math><mml:math id="M596"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq257.gif"/></alternatives></inline-formula> and <inline-formula id="IEq258"><alternatives><tex-math id="M597">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}^{(3)}$$\end{document}</tex-math><mml:math id="M598"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq258.gif"/></alternatives></inline-formula> are the first three columns of <inline-formula id="IEq259"><alternatives><tex-math id="M599">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M600"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq259.gif"/></alternatives></inline-formula> and <inline-formula id="IEq260"><alternatives><tex-math id="M601">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i}$$\end{document}</tex-math><mml:math id="M602"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq260.gif"/></alternatives></inline-formula>, respectively. We used the transformation matrix <inline-formula id="IEq261"><alternatives><tex-math id="M603">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${M}_{i}$$\end{document}</tex-math><mml:math id="M604"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq261.gif"/></alternatives></inline-formula> to transform the aligned slice <inline-formula id="IEq262"><alternatives><tex-math id="M605">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{{\prime} }$$\end{document}</tex-math><mml:math id="M606"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq262.gif"/></alternatives></inline-formula> adjacent to <inline-formula id="IEq263"><alternatives><tex-math id="M607">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i}^{{\prime} }$$\end{document}</tex-math><mml:math id="M608"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq263.gif"/></alternatives></inline-formula>, as<disp-formula id="Equ42"><label>42</label><alternatives><tex-math id="M609">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}={M}_{i}\left(\begin{array}{c}{S}_{i+1}^{{\prime} }\\ {{{{{{\bf{1}}}}}}}_{1\times {n}_{i+1}}\end{array}\right)$$\end{document}</tex-math><mml:math id="M610"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_43220_Article_Equ42.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par68">Then, we divided the transformed aligned slice <inline-formula id="IEq264"><alternatives><tex-math id="M611">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M612"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq264.gif"/></alternatives></inline-formula> and its corresponding ground truth slice <inline-formula id="IEq265"><alternatives><tex-math id="M613">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M614"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq265.gif"/></alternatives></inline-formula> into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type compositions of the grids in <inline-formula id="IEq266"><alternatives><tex-math id="M615">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${S}_{i+1}^{*}$$\end{document}</tex-math><mml:math id="M616"><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq266.gif"/></alternatives></inline-formula> and <inline-formula id="IEq267"><alternatives><tex-math id="M617">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{S}}_{i+1}$$\end{document}</tex-math><mml:math id="M618"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_43220_Article_IEq267.gif"/></alternatives></inline-formula>, to measure the accuracy of Scube, PASTE, and STAligner.</p>
      <p id="Par69">In addition, we employed mouse brain MERFISH, mouse embryo Stereo-seq, and mouse brain Spatial Transcriptomics<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> data to assess the performance of Scube, PASTE, and STAligner. As there are no ground truths for these datasets, we divided the common area of each pair of adjacent slices into 10 × 10 grids, and calculated the SSIM/PCC values between the cell type composition of the grids in the two adjacent slices aligned by Scube, PASTE and/or STAligner to measure the performance of the two methods.</p>
    </sec>
    <sec id="Sec26">
      <title>Hyperparameter settings for benchmarking methods</title>
      <p id="Par70">The selection of the hyperparameters for each method was followed by the official tutorials and codes provided by their respective authors:<list list-type="bullet"><list-item><p id="Par71">STAligner: <ext-link ext-link-type="uri" xlink:href="https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html">https://staligner.readthedocs.io/en/latest/Tutorial_DLPFC.html</ext-link></p></list-item><list-item><p id="Par72">PRECAST: <ext-link ext-link-type="uri" xlink:href="https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html">https://feiyoung.github.io/PRECAST/articles/PRECAST.BreastCancer.html</ext-link></p></list-item><list-item><p id="Par73">STACI:</p><p id="Par74">STACI GitHub repository for Visium and Spatial Transcriptomes data, and cells with gene number less 10 were filtered:</p><p id="Par75"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_visium_10xADFFPE.ipynb</ext-link></p><p id="Par76">for MERFISH data:</p><p id="Par77"><ext-link ext-link-type="uri" xlink:href="https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb">https://github.com/uhlerlab/STACI/blob/master/train_gae_starmap_multisamples.ipynb</ext-link></p></list-item><list-item><p id="Par78">STAGATE: <ext-link ext-link-type="uri" xlink:href="https://stagate.readthedocs.io/en/latest/T1_DLPFC.html">https://stagate.readthedocs.io/en/latest/T1_DLPFC.html</ext-link></p></list-item><list-item><p id="Par79">SpaGCN: <ext-link ext-link-type="uri" xlink:href="https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb">https://github.com/jianhuupenn/SpaGCN/blob/master/tutorial/tutorial.ipynb</ext-link></p></list-item><list-item><p id="Par80">BayesSpace: <ext-link ext-link-type="uri" xlink:href="https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html">https://edward130603.github.io/BayesSpace/articles/maynard_DLPFC.html</ext-link></p></list-item><list-item><p id="Par81">stLearn: <ext-link ext-link-type="uri" xlink:href="https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex">https://stlearn.readthedocs.io/en/latest/tutorials/stSME_clustering.html#Human-Brain-dorsolateral-prefrontal-cortex</ext-link>-(DLPFC)</p></list-item></list><list list-type="bullet"><list-item><p id="Par82">CARD: <ext-link ext-link-type="uri" xlink:href="https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html">https://yingma0107.github.io/CARD/documentation/04_CARD_Example.html</ext-link></p></list-item><list-item><p id="Par83">Cell2location: <ext-link ext-link-type="uri" xlink:href="https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html">https://cell2location.readthedocs.io/en/latest/notebooks/cell2location_tutorial.html</ext-link></p></list-item><list-item><p id="Par84">DestVI:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html">https://docs.scvi-tools.org/en/stable/tutorials/notebooks/spatial/DestVI_tutorial.html</ext-link></p></list-item><list-item><p id="Par85">DSTG: <ext-link ext-link-type="uri" xlink:href="https://github.com/Su-informatics-lab/DSTG">https://github.com/Su-informatics-lab/DSTG</ext-link></p></list-item><list-item><p id="Par86">RCTD: <ext-link ext-link-type="uri" xlink:href="https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html">https://raw.githack.com/dmcable/spacexr/master/vignettes/spatial-transcriptomics.html</ext-link></p></list-item><list-item><p id="Par87">Seurat: <ext-link ext-link-type="uri" xlink:href="https://satijalab.org/seurat/archive/v3.2/integration.html">https://satijalab.org/seurat/archive/v3.2/integration.html</ext-link></p></list-item><list-item><p id="Par88">SpatialDWLS: <ext-link ext-link-type="uri" xlink:href="https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html">https://drieslab.github.io/Giotto_site_suite/articles/analyses_deconvolution_Oct2021.html</ext-link></p></list-item><list-item><p id="Par89">SPOTlight: <ext-link ext-link-type="uri" xlink:href="https://marcelosua.github.io/SPOTlight">https://marcelosua.github.io/SPOTlight</ext-link></p></list-item><list-item><p id="Par90">Stereoscope:<ext-link ext-link-type="uri" xlink:href="https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html">https://docs.scvi-tools.org/en/stable/user_guide/models/stereoscope.html</ext-link></p></list-item><list-item><p id="Par91">STRIDE: <ext-link ext-link-type="uri" xlink:href="https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html">https://stridespatial.readthedocs.io/en/latest/tutorials/Mouse_embryo.html</ext-link></p></list-item><list-item><p id="Par92">Tangram: <ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/Tangram">https://github.com/broadinstitute/Tangram</ext-link></p></list-item></list></p>
      <p id="Par93">The hyperparameters used for each method were reported in Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>.</p>
    </sec>
    <sec id="Sec27">
      <title>Statistics &amp; reproducibility</title>
      <p id="Par94">No statistical method was used to predetermine sample size. In Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>, the CARD was excluded from the benchmark on the scRNA-seq data simulated datasets due to lack of spatial information for these datasets. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">4e</xref>, the STRIDE was not shown in Stereo-seq mouse embryo brain dataset due to a runtime error for this dataset. In Supplementary Fig. <xref rid="MOESM1" ref-type="media">14a</xref>, two slices were excluded due to the lack of L6b cells, which prevented the definition of ground truth. The experiments were not randomized. The Investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec28">
      <title>Reporting summary</title>
      <p id="Par95">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec29">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_43220_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_43220_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_43220_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_43220_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_43220_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_43220_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_43220_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
    <sec id="Sec30">
      <title>Source data</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM8">
          <media xlink:href="41467_2023_43220_MOESM8_ESM.zip">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Hao Xu, Shuyan Wang.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-43220-3.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the National Key R&amp;D Program of China (2020YFA0112200 and 2022YFA1303200 to K.Q.), the National Natural Science Foundation of China grants (T2125012 and 91940306 to K.Q.; 32170668 to B.L.), CAS Project for Young Scientists in Basic Research YSBR-005 (to K.Q.), Anhui Province Science and Technology Key Program (202003a07020021 to K.Q.) and the Fundamental Research Funds for the Central Universities (YD2070002019, WK9110000141, and WK2070000158 to K.Q.). We thank the USTC Supercomputing Center and the School of Life Science Bioinformatics Center for providing computing resources for this project.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>K.Q., J.L., and B.L. conceived the project. H.X., J.L., and S.Wang designed the framework and performed data analysis with the help of M.F., S.L., C.C., S.Wan, R.W., M.T., and T.X.; B.L., K.Q., H.X., and J.L. wrote the manuscript with input from all authors. K.Q. and J.L. supervised the entire project. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par96"><italic>Nature Communications</italic> thanks the anonymous reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All relevant data supporting the key findings of this study are available within the article and its Supplementary Information files. The simulation datasets used for the evaluation of Spoint and other deconvolution methods are available in a GitHub repository at <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SpatialBenchmarking">https://github.com/QuKunLab/SpatialBenchmarking</ext-link>. The raw data of 11 ST datasets and five paired single-cell/nucleus RNA sequence datasets are available from the following studies: (1) 12 slices of human DLPFC 10X Visium data at <ext-link ext-link-type="uri" xlink:href="http://research.libd.org/spatialLIBD/">http://research.libd.org/spatialLIBD/</ext-link><sup><xref ref-type="bibr" rid="CR34">34</xref></sup>; (2) six slices of human breast cancer 10X Visium data at 10.5281/zenodo.4739739<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (3) four slices of human breast cancer 10X Visium data: Parent_Visium_Human_BreastCancer, V1_Breast_Cancer_Block_A_Section_1, V1_Breast_Cancer_Block_A_Section_2 and Visium_FFPE_Human_Breast_Cancer at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR14">14</xref></sup>; (4) one slice of human breast cancer 10X Visium data: Invasive Ductal Carcinoma Stained With Fluorescent CD3 Antibody at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link><sup><xref ref-type="bibr" rid="CR30">30</xref></sup>; (5) Mouse brain STARmap data at <ext-link ext-link-type="uri" xlink:href="https://www.starmapresources.org/data">https://www.starmapresources.org/data</ext-link><sup><xref ref-type="bibr" rid="CR58">58</xref></sup>; (6) 33 slices of Mouse MOp MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://doi.brainimagelibrary.org/doi/10.35077/g.21">https://doi.brainimagelibrary.org/doi/10.35077/g.21</ext-link><sup><xref ref-type="bibr" rid="CR13">13</xref></sup>; (7) one slice of mouse E16.5 embryo brain Stereo-seq data, one slice of mouse brain Stereo-seq data, and 13 slices of mouse E16.5 whole embryo Stereo-seq data at <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</ext-link><sup><xref ref-type="bibr" rid="CR4">4</xref></sup>; (8) ten slice of human brain MERFISH data at <ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw">https://datadryad.org/stash/dataset/doi:10.5061/dryad.x3ffbg7mw</ext-link><sup><xref ref-type="bibr" rid="CR49">49</xref></sup>; (9) 75 slice of mouse whole brain Spatial Transcriptomics data are available in the GEO database under accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE147747">GSE147747</ext-link><sup><xref ref-type="bibr" rid="CR60">60</xref></sup>; (10) single-nucleus transcriptomics data across multiple human cortical areas at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq">https://portal.brain-map.org/atlases-and-data/rnaseq/human-multiple-cortical-areas-smart-seq</ext-link><sup><xref ref-type="bibr" rid="CR51">51</xref></sup>; (11) single-cell transcriptomics data of human breast cancer data at <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1039">https://singlecell.broadinstitute.org/single_cell/study/SCP1039</ext-link><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; (12) single-cell transcriptomics data of mouse embryo brain at <ext-link ext-link-type="uri" xlink:href="http://mousebrain.org/development/downloads.html">http://mousebrain.org/development/downloads.html</ext-link><sup><xref ref-type="bibr" rid="CR83">83</xref></sup>; (13) single-cell transcriptomics data of mouse whole cortex and hippocampus at <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x">https://portal.brain-map.org/atlases-and-data/rnaseq/mouse-whole-cortex-and-hippocampus-10x</ext-link><sup><xref ref-type="bibr" rid="CR52">52</xref></sup>; (14) single-cell transcriptomics data of mouse whole brain at mousebrain.org/adolescent/downloads.html<sup><xref ref-type="bibr" rid="CR84">84</xref></sup>. All the aforementioned data used in this study are available in a public Zenodo repository at 10.5281/zenodo.8316334. Source data for figures are provided with this paper. <xref ref-type="sec" rid="Sec30">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The open-source package of SPACEL is available at a GitHub repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/QuKunLab/SPACEL">https://github.com/QuKunLab/SPACEL</ext-link><sup><xref ref-type="bibr" rid="CR85">85</xref></sup>. We uploaded all codes and scripts used for the analyses and figure plotting in this study to a public Zenodo repository (10.5281/zenodo.8316334). The documentation, usage instructions and other relevant information related to SPACEL can be accessed through (<ext-link ext-link-type="uri" xlink:href="https://spacel.readthedocs.org">https://spacel.readthedocs.org</ext-link>).</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par97">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>353</volume>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>GS</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srivatsan</surname>
            <given-names>SR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Embryo-scale, single-cell spatial transcriptomics</article-title>
        <source>Science</source>
        <year>2021</year>
        <volume>373</volume>
        <fpage>111</fpage>
        <lpage>117</lpage>
        <pub-id pub-id-type="pmid">34210887</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <year>2022</year>
        <volume>185</volume>
        <fpage>1777</fpage>
        <lpage>1792</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bergmann</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial profiling of early primate gastrulation in utero</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>609</volume>
        <fpage>136</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">35709828</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>SM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial omics and multiplexed imaging to explore cancer biology</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>997</fpage>
        <lpage>1012</lpage>
        <pub-id pub-id-type="pmid">34341583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>W-T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics and in situ sequencing to study Alzheimer’s Disease</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>976</fpage>
        <lpage>991</lpage>
        <pub-id pub-id-type="pmid">32702314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752</lpage>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuppe</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial multi-omic map of human myocardial infarction</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>766</fpage>
        <lpage>777</lpage>
        <pub-id pub-id-type="pmid">35948637</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Erickson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved clonal copy number alterations in benign and malignant tissue</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>608</volume>
        <fpage>360</fpage>
        <lpage>367</lpage>
        <pub-id pub-id-type="pmid">35948708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shah</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lubeck</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>In situ transcription profiling of single cells reveals spatial organization of cells in the mouse hippocampus</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>92</volume>
        <fpage>342</fpage>
        <lpage>357</lpage>
        <pub-id pub-id-type="pmid">27764670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>932</fpage>
        <lpage>935</lpage>
        <pub-id pub-id-type="pmid">30377364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially resolved cell atlas of the mouse primary motor cortex by MERFISH</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>598</volume>
        <fpage>137</fpage>
        <lpage>143</lpage>
        <pub-id pub-id-type="pmid">34616063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Visium spatial gene expression. <italic>10x Genomics</italic> (2020).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriques</surname>
            <given-names>SG</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>363</volume>
        <fpage>1463</fpage>
        <lpage>1467</lpage>
        <pub-id pub-id-type="pmid">30923225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with Slide-seqV2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Lopez, R. et al. A joint model of unpaired data from scRNA-seq and spatial transcriptomics for imputing missing gene expression measurements. Preprint at <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1905.02269">http://arxiv.org/abs/1905.02269</ext-link> (2019).</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Loog</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>van de Wiel</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
          <name>
            <surname>Wessels</surname>
            <given-names>LFA</given-names>
          </name>
        </person-group>
        <article-title>PRECISE: a domain adaptation approach to transfer predictors of drug response from pre-clinical models to tumors</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>i510</fpage>
        <lpage>i519</lpage>
        <pub-id pub-id-type="pmid">31510654</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mahfouz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
        </person-group>
        <article-title>SpaGE: spatial gene enhancement using scRNA-seq</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2020</year>
        <volume>48</volume>
        <fpage>e107</fpage>
        <lpage>e107</lpage>
        <pub-id pub-id-type="pmid">32955565</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Biancalani</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with Tangram</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1352</fpage>
        <lpage>1362</lpage>
        <pub-id pub-id-type="pmid">34711971</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kleshchevnikov</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>661</fpage>
        <lpage>671</lpage>
        <pub-id pub-id-type="pmid">35027729</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cable</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust decomposition of cell type mixtures in spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>517</fpage>
        <lpage>526</lpage>
        <pub-id pub-id-type="pmid">33603203</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G-C</given-names>
          </name>
        </person-group>
        <article-title>SpatialDWLS: accurate deconvolution of spatial transcriptomic data</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>145</fpage>
        <pub-id pub-id-type="pmid">33971932</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andersson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title>
        <source>Commun. Biol.</source>
        <year>2020</year>
        <volume>3</volume>
        <fpage>565</fpage>
        <pub-id pub-id-type="pmid">33037292</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elosua-Bayes</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Gut</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Heyn</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>SPOTlight: seeded NMF regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>e50</fpage>
        <pub-id pub-id-type="pmid">33544846</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Song</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>DSTG: deconvoluting spatial transcriptomics data through graph-based artificial intelligence</article-title>
        <source>Brief. Bioinform.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>bbaa414</fpage>
        <pub-id pub-id-type="pmid">33480403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>STRIDE: accurately decomposing and integrating spatial transcriptomics using single-cell RNA sequencing</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>e42</fpage>
        <lpage>e42</lpage>
        <pub-id pub-id-type="pmid">35253896</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DestVI identifies continuums of cell types in spatial transcriptomics data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1360</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="pmid">35449415</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Spatially informed cell-type deconvolution for spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1349</fpage>
        <lpage>1359</lpage>
        <pub-id pub-id-type="pmid">35501392</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention auto-encoder</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>1739</fpage>
        <pub-id pub-id-type="pmid">35365632</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <mixed-citation publication-type="other">Pham, D. et al. stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues. Preprint at 10.1101/2020.05.31.125658 (2020).</mixed-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maynard</surname>
            <given-names>KR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>
        <source>Nat. Neurosci.</source>
        <year>2021</year>
        <volume>24</volume>
        <fpage>425</fpage>
        <lpage>436</lpage>
        <pub-id pub-id-type="pmid">33558695</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>AL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multimodal analysis of composition and spatial architecture in human squamous</article-title>
        <source>Cell Carcinoma Cell</source>
        <year>2020</year>
        <volume>182</volume>
        <fpage>497</fpage>
        <lpage>514</lpage>
        <pub-id pub-id-type="pmid">32579974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive analysis of spatial architecture in primary liver cancer</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabg3750</fpage>
        <pub-id pub-id-type="pmid">34919432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Shivashankar</surname>
            <given-names>GV</given-names>
          </name>
          <name>
            <surname>Uhler</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Graph-based autoencoder integrates spatial transcriptomics with chromatin images and identifies joint biomarkers for Alzheimer’s disease</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>7480</fpage>
        <pub-id pub-id-type="pmid">36463283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic embedding, clustering, and alignment for integrating spatial transcriptomics data with PRECAST</article-title>
        <source>Nat. Commun.</source>
        <year>2023</year>
        <volume>14</volume>
        <fpage>296</fpage>
        <pub-id pub-id-type="pmid">36653349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Zhou, X., Dong, K. &amp; Zhang, S. Integrating spatial transcriptomics data across different conditions, technologies, and developmental stages. <italic>Nat. Comput. Sci.</italic><bold>3</bold>, 894–906 (2023).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeira</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Land</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Strzalkowski</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Raphael</surname>
            <given-names>BJ</given-names>
          </name>
        </person-group>
        <article-title>Alignment and integration of spatial transcriptomics data</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>567</fpage>
        <lpage>575</lpage>
        <pub-id pub-id-type="pmid">35577957</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <mixed-citation publication-type="other">Defferrard, M., Bresson, X. &amp; Vandergheynst, P. Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering. in <italic>Advances in Neural Information Processing Systems</italic> (2016).</mixed-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <mixed-citation publication-type="other">Kipf, T. N. &amp; Welling, M. Semi-Supervised Classification with Graph Convolutional Networks. in <italic>International Conference on Learning Representations</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <mixed-citation publication-type="other">Goodfellow, I. et al. Generative Adversarial Nets. in <italic>Advances in Neural Information Processing Systems</italic> (2014).</mixed-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>MacQueen</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Some methods for classification and analysis of multivariate observations</article-title>
        <source>Proc. Fifth Berkeley Symp. Math. Stat. Probab.</source>
        <year>1967</year>
        <volume>1</volume>
        <fpage>281</fpage>
        <lpage>298</lpage>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storn</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Differential Evolution – A Simple and Efficient Heuristic for global Optimization over Continuous Spaces</article-title>
        <source>J. Glob. Optim.</source>
        <year>1997</year>
        <volume>11</volume>
        <fpage>341</fpage>
        <lpage>359</lpage>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fang</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conservation and divergence of cortical cell organization in human and mouse revealed by MERFISH</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>377</volume>
        <fpage>56</fpage>
        <lpage>62</lpage>
        <pub-id pub-id-type="pmid">35771910</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>662</fpage>
        <lpage>670</lpage>
        <pub-id pub-id-type="pmid">35577954</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hodge</surname>
            <given-names>RD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Conserved cell types with divergent features in human versus mouse cortex</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>573</volume>
        <fpage>61</fpage>
        <lpage>68</lpage>
        <pub-id pub-id-type="pmid">31435019</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3222</fpage>
        <lpage>3241.e26</lpage>
        <pub-id pub-id-type="pmid">34004146</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Shepherd</surname>
            <given-names>GMG</given-names>
          </name>
        </person-group>
        <article-title>The neocortical circuit: themes and variations</article-title>
        <source>Nat. Neurosci.</source>
        <year>2015</year>
        <volume>18</volume>
        <fpage>170</fpage>
        <lpage>181</lpage>
        <pub-id pub-id-type="pmid">25622573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">10X Genomics Datasets. <italic>10X Genomics</italic><ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets">https://www.10xgenomics.com/resources/datasets</ext-link> (2021).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baslan</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel insights into breast cancer copy number genetic heterogeneity revealed by single-cell genome sequencing</article-title>
        <source>eLife</source>
        <year>2020</year>
        <volume>9</volume>
        <fpage>e51480</fpage>
        <pub-id pub-id-type="pmid">32401198</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gao</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>599</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="pmid">33462507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Timothy, T., Itay, T., Georgescu, C., Maxwell, B. &amp; Brian, H. inferCNV of the Trinity CTAT Project. (2019).</mixed-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>361</volume>
        <fpage>eaat5691</fpage>
        <pub-id pub-id-type="pmid">29930089</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Hagan</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Curve fitting and optimal design for prediction</article-title>
        <source>J. R. Stat. Soc. Ser. B Methodol.</source>
        <year>1978</year>
        <volume>40</volume>
        <fpage>1</fpage>
        <lpage>24</lpage>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ortiz</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular atlas of the adult mouse brain</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eabb3446</fpage>
        <pub-id pub-id-type="pmid">32637622</pub-id>
      </element-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Krizhevsky, A., Sutskever, I. &amp; Hinton, G. E. ImageNet Classification with Deep Convolutional Neural Networks. in <italic>Advances in Neural Information Processing Systems</italic> (2012).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Devlin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>M-W</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Toutanova</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</article-title>
        <source>Proc. naacL-HLT</source>
        <year>2019</year>
        <volume>1</volume>
        <fpage>4171</fpage>
        <lpage>4186</lpage>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902</lpage>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stein-O’Brien</surname>
            <given-names>GL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Decomposing Cell Identity for Transfer Learning across Cellular Measurements, Platforms, Tissues, and Species</article-title>
        <source>Cell Syst.</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>395</fpage>
        <lpage>411</lpage>
        <pub-id pub-id-type="pmid">31121116</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data denoising with transfer learning in single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>875</fpage>
        <lpage>878</lpage>
        <pub-id pub-id-type="pmid">31471617</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Weigert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Broaddus</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Cell Detection with Star-convex Polygons</article-title>
        <source>Med. Image Comput. Computer Assist. Intervention–MICCAI 2018: 21st Int. Conf., Granada, Spain,</source>
        <year>2018</year>
        <volume>11</volume>
        <fpage>265</fpage>
        <lpage>273</lpage>
      </element-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bannon</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DeepCell Kiosk: scaling deep learning–enabled cellular image analysis with Kubernetes</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>43</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="pmid">33398191</pub-id>
      </element-citation>
    </ref>
    <ref id="CR69">
      <label>69.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
        <pub-id pub-id-type="pmid">28088763</pub-id>
      </element-citation>
    </ref>
    <ref id="CR70">
      <label>70.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fukushima</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Cognitron: A self-organizing multilayered neural network</article-title>
        <source>Biol. Cybern.</source>
        <year>1975</year>
        <volume>20</volume>
        <fpage>121</fpage>
        <lpage>136</lpage>
        <pub-id pub-id-type="pmid">1203338</pub-id>
      </element-citation>
    </ref>
    <ref id="CR71">
      <label>71.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kullback</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Leibler</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>On Information and Sufficiency</article-title>
        <source>Ann. Math. Stat.</source>
        <year>1951</year>
        <volume>22</volume>
        <fpage>79</fpage>
        <lpage>86</lpage>
      </element-citation>
    </ref>
    <ref id="CR72">
      <label>72.</label>
      <mixed-citation publication-type="other">He, K., Zhang, X., Ren, S. &amp; Sun, J. Delving Deep into Rectifiers: Surpassing Human-Level Performance on ImageNet Classification. in <italic>Proceedings of the IEEE international conference on computer vision</italic> 1026–1034 (2015).</mixed-citation>
    </ref>
    <ref id="CR73">
      <label>73.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Ba, J. Adam: A Method for Stochastic Optimization. in <italic>International Conference for Learning Representations</italic> (2015).</mixed-citation>
    </ref>
    <ref id="CR74">
      <label>74.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hammond</surname>
            <given-names>DK</given-names>
          </name>
          <name>
            <surname>Vandergheynst</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Gribonval</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Wavelets on graphs via spectral graph theory</article-title>
        <source>Appl. Comput. Harmon. Anal.</source>
        <year>2011</year>
        <volume>30</volume>
        <fpage>129</fpage>
        <lpage>150</lpage>
      </element-citation>
    </ref>
    <ref id="CR75">
      <label>75.</label>
      <mixed-citation publication-type="other">Glorot, X. &amp; Bengio, Y. Understanding the difficulty of training deep feedforward neural networks. in <italic>Proceedings of the Thirteenth International Conference on Artificial Intelligence and Statistics</italic><bold>9</bold>, 249–256 (2010).</mixed-citation>
    </ref>
    <ref id="CR76">
      <label>76.</label>
      <mixed-citation publication-type="other">Davies, D. L. &amp; Bouldin, D. W. A Cluster Separation Measure. <italic>IEEE Trans. Pattern Anal. Mach. Intell</italic>. <bold>PAMI-1</bold>, 224–227 (1979).</mixed-citation>
    </ref>
    <ref id="CR77">
      <label>77.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: Machine Learning in Python</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR78">
      <label>78.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edelsbrunner</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Kirkpatrick</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Seidel</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>On the shape of a set of points in the plane</article-title>
        <source>IEEE Trans. Inf. Theory</source>
        <year>1983</year>
        <volume>29</volume>
        <fpage>551</fpage>
        <lpage>559</lpage>
      </element-citation>
    </ref>
    <ref id="CR79">
      <label>79.</label>
      <mixed-citation publication-type="other">Zhou, Q.-Y., Park, J. &amp; Koltun, V. Open3D: A Modern Library for 3D Data Processing. Preprint at 10.48550/arXiv.1801.09847 (2018).</mixed-citation>
    </ref>
    <ref id="CR80">
      <label>80.</label>
      <mixed-citation publication-type="other">Loop, C. Smooth Subdivision Surfaces Based on Triangles. (1987).</mixed-citation>
    </ref>
    <ref id="CR81">
      <label>81.</label>
      <mixed-citation publication-type="other">Basak, S., Petit, S., Bect, J. &amp; Vazquez, E. Numerical issues in maximum likelihood parameter estimation for Gaussian process interpolation. in <italic>International Conference on Machine Learning, Optimization, and Data Science</italic> 116–131 (2021).</mixed-citation>
    </ref>
    <ref id="CR82">
      <label>82.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR83">
      <label>83.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR84">
      <label>84.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular Architecture of the Mouse Nervous System</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>999</fpage>
        <lpage>1014</lpage>
        <pub-id pub-id-type="pmid">30096314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR85">
      <label>85.</label>
      <mixed-citation publication-type="other">Xu, H. &amp; Wang, S. SPACEL: deep-learning based characterization of spatial transcriptome architectures. Zenodo, 10.5281/zenodo.8419717 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
