<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8289377</article-id>
    <article-id pub-id-type="pmid">33471068</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab015</article-id>
    <article-id pub-id-type="publisher-id">btab015</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>V-pipe: a computational pipeline for assessing viral genetic diversity from high-throughput data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Posada-Céspedes</surname>
          <given-names>Susana</given-names>
        </name>
        <aff><institution>Department of Biosystems Science and Engineering, ETH Zurich</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <aff><institution>SIB Swiss Institute of Bioinformatics</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Seifert</surname>
          <given-names>David</given-names>
        </name>
        <aff><institution>Department of Biosystems Science and Engineering, ETH Zurich</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <aff><institution>SIB Swiss Institute of Bioinformatics</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7561-0810</contrib-id>
        <name>
          <surname>Topolsky</surname>
          <given-names>Ivan</given-names>
        </name>
        <aff><institution>Department of Biosystems Science and Engineering, ETH Zurich</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <aff><institution>SIB Swiss Institute of Bioinformatics</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jablonski</surname>
          <given-names>Kim Philipp</given-names>
        </name>
        <aff><institution>Department of Biosystems Science and Engineering, ETH Zurich</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <aff><institution>SIB Swiss Institute of Bioinformatics</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Metzner</surname>
          <given-names>Karin J</given-names>
        </name>
        <aff><institution>Division of Infectious Diseases and Hospital Epidemiology, University Hospital Zurich, University of Zurich</institution>, 8091 Zurich, <country country="CH">Switzerland</country></aff>
        <aff><institution>Institute of Medical Virology, University of Zurich</institution>, 8091 Zurich, <country country="CH">Switzerland</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-0573-6119</contrib-id>
        <name>
          <surname>Beerenwinkel</surname>
          <given-names>Niko</given-names>
        </name>
        <xref rid="btab015-cor1" ref-type="corresp"/>
        <aff><institution>Department of Biosystems Science and Engineering, ETH Zurich</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <aff><institution>SIB Swiss Institute of Bioinformatics</institution>, 4058 Basel, <country country="CH">Switzerland</country></aff>
        <!--niko.beerenwinkel@bsse.ethz.ch-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Xu</surname>
          <given-names>Jinbo</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab015-cor1">To whom correspondence should be addressed. <email>niko.beerenwinkel@bsse.ethz.ch</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-01-20">
      <day>20</day>
      <month>1</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>1</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>12</issue>
    <fpage>1673</fpage>
    <lpage>1680</lpage>
    <history>
      <date date-type="received">
        <day>11</day>
        <month>6</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>09</day>
        <month>12</month>
        <year>2020</year>
      </date>
      <date date-type="editorial-decision">
        <day>02</day>
        <month>1</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>08</day>
        <month>1</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab015.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>High-throughput sequencing technologies are used increasingly not only in viral genomics research but also in clinical surveillance and diagnostics. These technologies facilitate the assessment of the genetic diversity in intra-host virus populations, which affects transmission, virulence and pathogenesis of viral infections. However, there are two major challenges in analysing viral diversity. First, amplification and sequencing errors confound the identification of true biological variants, and second, the large data volumes represent computational limitations.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>To support viral high-throughput sequencing studies, we developed V-pipe, a bioinformatics pipeline combining various state-of-the-art statistical models and computational tools for automated end-to-end analyses of raw sequencing reads. V-pipe supports quality control, read mapping and alignment, low-frequency mutation calling, and inference of viral haplotypes. For generating high-quality read alignments, we developed a novel method, called <italic toggle="yes">ngshmmalign</italic>, based on profile hidden Markov models and tailored to small and highly diverse viral genomes. V-pipe also includes benchmarking functionality providing a standardized environment for comparative evaluations of different pipeline configurations. We demonstrate this capability by assessing the impact of three different read aligners (Bowtie 2, BWA MEM, ngshmmalign) and two different variant callers (LoFreq, ShoRAH) on the performance of calling single-nucleotide variants in intra-host virus populations. V-pipe supports various pipeline configurations and is implemented in a modular fashion to facilitate adaptations to the continuously changing technology landscape.</p>
      </sec>
      <sec id="s3">
        <title>Availabilityand implementation</title>
        <p>V-pipe is freely available at <ext-link xlink:href="https://github.com/cbg-ethz/V-pipe" ext-link-type="uri">https://github.com/cbg-ethz/V-pipe</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>SystemsX.ch</institution>
            <institution-id institution-id-type="DOI">10.13039/501100012390</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>RNA viruses are regarded as important models in evolutionary biology, because they exhibit short generation times and higher mutation rates compared to cellular organisms (<xref rid="btab015-B9" ref-type="bibr">Duffy <italic toggle="yes">et al.</italic>, 2008</xref>). As a result, they evolve rapidly and often exist within their host as a collection of distinct, yet genetically related, viral strains (<xref rid="btab015-B23" ref-type="bibr">Lauring and Andino, 2010</xref>). This heterogeneity impacts viral transmission, virulence and pathogenesis (<xref rid="btab015-B38" ref-type="bibr">Rozera <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab015-B42" ref-type="bibr">Tsibris et al., 2009</xref>; <xref rid="btab015-B44" ref-type="bibr">Vignuzzi et al., 2006</xref>), and is of relevance in the context of immune escape (<xref rid="btab015-B21" ref-type="bibr">Kuroda <italic toggle="yes">et al.</italic>, 2010</xref>; <xref rid="btab015-B34" ref-type="bibr">Nowak <italic toggle="yes">et al.</italic>, 1991</xref>), vaccine design (<xref rid="btab015-B12" ref-type="bibr">Gaschen, 2002</xref>) and drug resistance (<xref rid="btab015-B31" ref-type="bibr">Mason <italic toggle="yes">et al.</italic>, 2018</xref>).</p>
    <p>High-throughput sequencing (HTS) technologies have opened up new possibilities for in-depth characterization of the genetic diversity of virus samples (<xref rid="btab015-B4" ref-type="bibr">Barzon <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btab015-B6" ref-type="bibr">Capobianchi <italic toggle="yes">et al.</italic>, 2013</xref>). However, analysing viral HTS data is complicated by large volumes of data, short length of the sequencing reads and the high amplification and sequencing error rates relative to the expected intra-host viral diversity (<xref rid="btab015-B13" ref-type="bibr">Goodwin <italic toggle="yes">et al.</italic>, 2016</xref>). Therefore, statistical and computational challenges remain in disentangling true biological variation from technical errors, especially for low-frequency variants (<xref rid="btab015-B5" ref-type="bibr">Beerenwinkel <italic toggle="yes">et al.</italic>, 2012</xref>).</p>
    <p>Several methods have been proposed for studying genetic diversity in virus populations (<xref rid="btab015-B11" ref-type="bibr">Eliseev <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btab015-B37" ref-type="bibr">Posada-Céspedes <italic toggle="yes">et al.</italic>, 2017</xref>), but some of these tools appear no longer actively maintained or limited in terms of robustness and usability. Also, the analysis of HTS data involves additional steps implemented by separate tools, e.g. quality control and read alignment. A prerequisite for incorporating such HTS data into routine diagnostics is to standardize the processing steps end-to-end from raw data input to final output. To this end, several bioinformatics pipelines have been developed for, e.g. virus discovery and metagenomics applications (<xref rid="btab015-B14" ref-type="bibr">Ho and Tzanetakis, 2014</xref>; <xref rid="btab015-B28" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btab015-B29" ref-type="bibr">Maarala <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab015-B33" ref-type="bibr">Naccache <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab015-B51" ref-type="bibr">Zhao et al., 2017</xref>; <xref rid="btab015-B52" ref-type="bibr">Zheng et al., 2017</xref>). Other pipelines focus on either (i) the construction of the consensus sequence via reference-guided assembly (<xref rid="btab015-B45" ref-type="bibr">Wan et al., 2015</xref>; <xref rid="btab015-B47" ref-type="bibr">Wymant <italic toggle="yes">et al.</italic>, 2018</xref>), (ii) the identification of single nucleotide variants (SNVs) (<xref rid="btab015-B15" ref-type="bibr">Howison <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="btab015-B17" ref-type="bibr">Huber <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab015-B40" ref-type="bibr">Taylor et al., 2019</xref>) or (iii) the reconstruction of viral haplotypes (<xref rid="btab015-B18" ref-type="bibr">Jayasundara <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btab015-B30" ref-type="bibr">Mangul <italic toggle="yes">et al.</italic>, 2014</xref>). Often these tools either target specific viruses (<xref rid="btab015-B15" ref-type="bibr">Howison <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="btab015-B17" ref-type="bibr">Huber <italic toggle="yes">et al.</italic>, 2017</xref>; Taylor <italic toggle="yes">et al.</italic>, 2019; <xref rid="btab015-B47" ref-type="bibr">Wymant <italic toggle="yes">et al.</italic>, 2018</xref>) or provide limited support for broader applications. For HIV drug resistance testing, <xref rid="btab015-B24" ref-type="bibr">Lee <italic toggle="yes">et al.</italic> (2020)</xref> have recently evaluated various bioinformatics pipelines for this specific application.</p>
    <p>An important step in inferring viral genetic diversity is the alignment of HTS reads. There are two general strategies for read alignment, namely reference-based approaches and <italic toggle="yes">de novo</italic> assembly. Shortcomings of the former are the introduction of biases due to low similarity between the reference genome and viral haplotypes (<xref rid="btab015-B2" ref-type="bibr">Archer <italic toggle="yes">et al.</italic>, 2010</xref>), as well as inaccurate alignment of reads containing insertions or deletions (indels) (<xref rid="btab015-B37" ref-type="bibr">Posada-Céspedes <italic toggle="yes">et al.</italic>, 2017</xref>). On the other hand, limitations of <italic toggle="yes">de novo</italic> assembly include increased sensitivity to chimeric reads leading to erroneous contigs, and a segmented coverage of the genome by the assembled contigs (<xref rid="btab015-B47" ref-type="bibr">Wymant <italic toggle="yes">et al.</italic>, 2018</xref>). To address these limitations, we have developed a read aligner, called <italic toggle="yes">ngshmmalign</italic>. The aligner borrows ideas from the alignment of protein families to align HTS reads from small and highly diverse genomes. Ngshmmalign models the multiple read alignment as a profile hidden Markov model (HMM) and aligns all reads to this profile. By doing so, ngshmmalign accounts for local heterogeneity, including structural variations.</p>
    <p>To support reproducible viral genomics studies for basic research and clinical diagnostics, we have developed V-pipe, a flexible bioinformatics pipeline integrating several tools for analysing viral HTS data. V-pipe allows for assessing viral diversity at the level of SNVs, short variant sequences (or local haplotypes) and long-range haplotypes (or global haplotypes). To provide the flexibility required for adapting to future methodological and technological developments, V-pipe provides a modular and extensible framework which facilitates the introduction of new tools. V-pipe also supports the comparative assessment of different workflows in a standardized environment. To this end, it contains modules to generate synthetic data and to assess the accuracy of the computational inference. We demonstrate the benchmark capabilities of V-pipe by assessing the impact of different read aligners and variant callers on the accuracy of SNV calling. While our focus here is on SNV calling, the performance of various methods for viral haplotype reconstruction has been recently evaluated by <xref rid="btab015-B11" ref-type="bibr">Eliseev <italic toggle="yes">et al.</italic> (2020)</xref>. We validate V-pipe using sequencing data from a control sample composed of five well-defined HIV-1 strains (<xref rid="btab015-B7" ref-type="bibr">Di Giallonardo <italic toggle="yes">et al.</italic>, 2014</xref>), and to demonstrate its applicability, we process 92 HIV-1 whole-genome sequencing samples from 11 patients previously reported in <xref rid="btab015-B50" ref-type="bibr">Zanini et al. (2015)</xref>.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>We first summarize the core components of V-pipe. We then present the read aligner ngshmmalign and explain the benchmarking functionalities of the pipeline. Lastly, we describe the simulation setup and the control sequencing datasets used to assess the performance of different components of V-pipe.</p>
    <sec>
      <title>2.1 Computational pipeline</title>
      <p>V-pipe uses the Snakemake workflow management system (<xref rid="btab015-B20" ref-type="bibr">Köster and Rahmann, 2012</xref>), which enables the well-controlled and scalable execution of the pipeline in local as well as in high-performance computing (HPC) environments. The pipeline integrates various open-source software packages developed for analysing virus samples. For deployment, we provide Conda (<ext-link xlink:href="https://conda.io" ext-link-type="uri">https://conda.io</ext-link>) environments to automatically download and install the required tools. The environments include all dependencies and versions which is key for full reproducibility of the analysis settings.</p>
      <p>As input, V-pipe requires the raw sequencing data, a reference sequence and a configuration file containing user-defined options. V-pipe supports both single-end and paired-end FASTQ files. In short, the analysis workflow implemented by V-pipe involves the following main steps: (i) quality control, (ii) reference-guided mapping and alignment of sequencing reads and (iii) identification of SNVs and reconstruction of viral haplotypes (<xref rid="btab015-F1" ref-type="fig">Fig. 1</xref>).</p>
      <fig position="float" id="btab015-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>Workflow of V-pipe for the analysis of viral HTS data. As input, the pipeline requires raw sequencing data (FASTQ format) and a reference sequence (FASTA format), which defines the indexing frame for the reporting of variants. (<bold>A</bold>) For quality control, low-quality bases are removed from both termini. (<bold>B</bold>) Reads are aligned employing a reference-guided approach using ngshmmalign. (<bold>C</bold>) For the read alignment, the reference sequence may be provided or it can be built <italic toggle="yes">de novo</italic> from the read data. (<bold>D</bold>) Alternatively, reads can be aligned using BWA MEM or Bowtie2. (<bold>E</bold>) Intermediate results are provided in the form of a consensus sequence per sample, a multiple sequence alignment of all consensus sequences, and the minor allele frequencies (MAFs) for all samples and all loci. (<bold>F</bold>) Single-nucleotide variants (SNVs) are identified, and (<bold>G</bold>) local and (<bold>H</bold>) global haplotypes are reconstructed. Whenever applicable, the pertinent reporting frame (con.: consensus, prof.: profile, ref: reference) is indicated in red. Dotted lines indicate alternative processing steps included in V-pipe</p>
        </caption>
        <graphic xlink:href="btab015f1" position="float"/>
      </fig>
      <p>Relatively high error rates are a limitation of HTS technologies. Error sources include the reverse transcription of viral RNA into cDNA, the amplification of the material by multiple cycles of PCR, and the sequencing process itself (<xref rid="btab015-B5" ref-type="bibr">Beerenwinkel <italic toggle="yes">et al.</italic>, 2012</xref>). To avoid propagating biases to the downstream analysis steps, it is imperative to include quality checks and filtering steps. To this end, we include FastQC (<xref rid="btab015-B1" ref-type="bibr">Andrews, 2019</xref>) to provide quality control reports and PRINSEQ (<xref rid="btab015-B39" ref-type="bibr">Schmieder and Edwards, 2011</xref>) for removing low-quality or ambiguous bases from both termini of reads.</p>
      <p>For aligning sequencing reads, we developed a novel read aligner called ngshmmalign which is described below. This aligner requires as input a reference sequence to approximately locate reads. The reference sequence can be provided by the user or constructed <italic toggle="yes">de novo</italic> using the VICUNA software (<xref rid="btab015-B48" ref-type="bibr">Yang et al., 2012</xref>). We also include two alternative aligners, namely BWA MEM (<xref rid="btab015-B26" ref-type="bibr">Li, 2013</xref>) and Bowtie2 (<xref rid="btab015-B22" ref-type="bibr">Langmead and Salzberg, 2012</xref>), to choose from according to particular needs and computational resources. In addition to the alignment file, ngshmmalign outputs two types of consensus sequences constructed from the aligned reads, namely by (i) using a majority vote at each position, and (ii) incorporating ambiguous bases. V-pipe produces these consensus sequences in case an alternative aligner is chosen. We use lowercase characters in the consensus sequences to mark positions with read counts below 50 reads, by default. To report ambiguous bases, every base with a relative frequency greater or equal to a certain threshold, 5% by default, is accounted for, and the corresponding IUPAC ambiguity code is used. V-pipe also reports basic summary statistics, including the number of reads retained after quality control, the number of aligned reads, the region of the genome covered with a minimum number of aligned reads, and the minor allele frequencies per locus for all analysed samples.</p>
      <p>We derive SNV calls from local haplotype reconstruction using ShoRAH (<xref rid="btab015-B49" ref-type="bibr">Zagordi et al., 2011</xref>). By considering co-occurring variants at multiple loci simultaneously, ShoRAH can effectively lower the SNV detection limit, i.e. the minimum frequency at which variants can be called reliably (<xref rid="btab015-B32" ref-type="bibr">McElroy <italic toggle="yes">et al.</italic>, 2013</xref>). Alternatively, V-pipe also includes the variant caller LoFreq (version 2) (<xref rid="btab015-B46" ref-type="bibr">Wilm et al., 2012</xref>), which uses a position-wise and hence faster approach. A more complete characterization of the structure of a virus population consists in reconstructing the sequences and relative abundances of all viral haplotypes. For this purpose, we incorporate the quasispecies assembly tools HaploClique (<xref rid="btab015-B41" ref-type="bibr">Töpfer et al., 2014</xref>) and SAVAGE (<xref rid="btab015-B3" ref-type="bibr">Baaijens <italic toggle="yes">et al.</italic>, 2017</xref>) to support reference-based and <italic toggle="yes">de novo</italic> haplotype reconstruction, respectively. Both methods use the overlap between reads to iteratively extend local haplotypes into full-length haplotypes.</p>
      <p>As an additional feature, V-pipe includes a module to detect flow-cell cross contamination. To do so, reads are aligned to a panel of reference sequences containing suspected contaminants. We then detect and report the number of reads preferentially mapped to other references. The code developed to support this functionality, as well as various other steps of our pipeline, are maintained as an independent Python package called <italic toggle="yes">smallgenomeutilities</italic> (Supplementary Section S1.1).</p>
      <p>V-pipe allows for constructing, maintaining and using reproducible and traceable data analysis pipelines. In addition to providing a reproducible workflow and pinning dependency versions, V-pipe supports numerical reproducibility by fixing the seeds of all processing steps involving random sampling. Traceability is achieved by providing a well-documented pipeline in a well-defined framework and by ensuring meaningful log output in all processing steps. We have also made additional efforts to improve the reliability of individual tools used as part of our pipeline, such as ShoRAH and HaploClique (Supplementary Section S1.2).</p>
      <p>V-pipe is an open source project, the source code is freely available at <ext-link xlink:href="https://github.com/cbg-ethz/V-pipe" ext-link-type="uri">https://github.com/cbg-ethz/V-pipe</ext-link>. Documentation including user guides can be found on the Wiki (<ext-link xlink:href="https://github.com/cbg-ethz/V-pipe/wiki" ext-link-type="uri">https://github.com/cbg-ethz/V-pipe/wiki</ext-link>) and tutorials for specific viruses are available on our project page (<ext-link xlink:href="https://cbg-ethz.github.io/V-pipe/" ext-link-type="uri">https://cbg-ethz.github.io/V-pipe/</ext-link>). We also promote community involvement by maintaining a mailing list, providing user support and offering workshops.</p>
    </sec>
    <sec>
      <title>2.2 ngshmmalign: read aligner</title>
      <p>Ngshmmalign performs a three-step alignment (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S1</xref>). In the first step, reads are mapped to the reference genome to roughly determine their position. This initial mapping is done using a <italic toggle="yes">k</italic>-mer index of the reference genome. We then determine the mean and standard deviation of the returned location on the genome. If the standard deviation is above a certain threshold, the <italic toggle="yes">k</italic>-mer index match is considered suboptimal, and we perform a full genome-wide exhaustive alignment (Supplementary Section S1.3.2). After this initial mapping, reads are aligned in a semi-global mode using the Smith-Waterman algorithm. In the second step, the genome is partitioned into overlapping windows, and reads are assigned to windows based on the read-window overlaps. A multiple sequence alignment of the reads is performed independently for each of the windows by employing the L-INS-i iterative refinement approach implemented by MAFFT (<xref rid="btab015-B19" ref-type="bibr">Katoh and Standley, 2013</xref>) (Supplementary Section S1.3.3). We then infer the parameters of the profile HMM in a supervised manner, by assuming that the multiple read alignment represents a local sample of the profile HMM. In the third step, the final read alignment is obtained by re-aligning all reads to the profile HMM (Supplementary Section S1.3.4). The source code of ngshmmalign is available at <ext-link xlink:href="https://github.com/cbg-ethz/ngshmmalign" ext-link-type="uri">https://github.com/cbg-ethz/ngshmmalign</ext-link>.</p>
      <p>For every dataset analysed within a single execution of the pipeline, ngshmmalign reports the read alignment using a position numbering relative to the profile. To standardize the position numbering, V-pipe performs a lift-over to report the alignment relative the user-specified reference sequence. To do so, we construct and use a multiple sequence alignment, containing the reference sequence and all consensus sequences from datasets included in the data analysis. This multiple sequence alignment is also an intermediate result of V-pipe, which can be used for other applications, such as phylogenetic analyses.</p>
    </sec>
    <sec>
      <title>2.3 Benchmarking</title>
      <p>V-pipe provides benchmarking functionality by including two additional modules: (i) <italic toggle="yes">simBench</italic> can simulate sequencing reads from a mock virus population, and (ii) <italic toggle="yes">testBench</italic> can evaluate the accuracy of the inference results.</p>
      <p>SimBench supports three modes. The first mode can be regarded as a simple quasispecies model (<xref rid="btab015-B8" ref-type="bibr">Domingo <italic toggle="yes">et al.</italic>, 2005</xref>). A master sequence may be provided or generated by sampling a user-defined number of nucleotides uniformly at random. Simulated haplotype sequences are generated from the master sequence by introducing substitutions, insertions and deletions with user-configurable rates. Additionally, hyper-variable regions are simulated in the form of long deletions of variable length. In the second mode, the simulated haplotype sequences are sampled from a perfect binary tree. Every child node is generated from the parent sequence by introducing substitutions, insertions and deletions with user-configurable rates. Here, we emulate explicitly the hierarchical evolutionary relationships among viral haplotypes. In the third mode, haplotype sequences are defined <italic toggle="yes">a priori</italic> and given as input to the pipeline, e.g. based on other models of viral evolution or on known viral sequences. The haplotype relative abundances are either (i) set to equal proportions (i.e. <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> where <italic toggle="yes">n</italic> is the number of haplotypes), (ii) drawn from a Dirichlet distribution <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Dir</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>α</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> with concentration parameters <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for all haplotypes by default or (iii) obtained using a geometric series with a given common ratio (0.75 by default).</p>
      <p>After haplotype sequences have been generated, we use the ART software (<xref rid="btab015-B16" ref-type="bibr">Huang <italic toggle="yes">et al.</italic>, 2012</xref>) to simulate either single-end or paired-end reads with configurable read length. ART is a read simulator with various built-in, technology-specific read error models and supports common sequencing errors, such as base substitutions, insertions and deletions. We simulate reads from every individual haplotype with read coverage proportional to its relative abundance.</p>
      <p>Instead of simulating sequencing reads, a user can also provide FASTQ files as input for the benchmark. This option allows for providing sequences simulated by different means, and it supports the analysis of control sequencing experiments with known haplotypes and relative abundances.</p>
      <p>The evaluation module testBench is used to assess the accuracy of the inference results by comparing them to the ground truth. For SNV calling, we obtain a list of true SNVs by constructing a multiple sequence alignment of the underlying haplotypes and the reference sequence. Positions of expected SNVs are reported relative to the reference sequence. We then report the number of true positive, false positive, false negative and true negative SNVs, as well as the inferred versus the expected SNV frequencies, the frequencies of false positives and the number of false negatives per underlying haplotype.</p>
      <p>V-pipe supports two modes for carrying out the benchmark, either evaluating a single pipeline arrangement at a time (<italic toggle="yes">vpipeBench</italic>), or multiple pipeline arrangements simultaneously (<italic toggle="yes">vpipeBenchRunner</italic>). Although the generation of synthetic datasets is reproducible, the latter mode should be preferred to ensure that other configuration settings are kept constant across different pipeline arrangements (i.e. combinations of processing steps).</p>
    </sec>
    <sec>
      <title>2.4 Simulated datasets</title>
      <p>We employ simBench to generate simulated reads, varying the number of haplotypes (ranging from 8 to 60), their relative abundances and the total read coverage (either 10 000× or 40 000×, Supplementary Section S1.4). We use equal proportions for the haplotype abundances (denoted as <italic toggle="yes">Equal prop.</italic>) or sample their frequencies from a Dirichlet distribution. We either use a symmetric Dirichlet distribution with <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for all <italic toggle="yes">i</italic> (denoted as <italic toggle="yes">Uniform</italic>), or choose one haplotype at random and assign to it a greater weight (<inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>20</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for all <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) to emulate a dominant viral strain (denoted as <italic toggle="yes">Dirichlet</italic>). For all datasets, we simulate paired-end reads with 250 bp read length by using ART with the built-in quality profile for the MiSeq platform.</p>
      <p>The datasets are based on HIV-1 or HCV sequences (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). For HIV-1, we employ sequences of the subtype B envelope glycoprotein (<italic toggle="yes">env</italic>) gene obtained for subjects 1051 and BORI0637 in <xref rid="btab015-B25" ref-type="bibr">Lee <italic toggle="yes">et al.</italic> (2009)</xref> by single-genome amplification. For HCV, we use sequences from naturally occurring HCV genotype 1 subtype a (1a) E1E2 genes (<xref rid="btab015-B10" ref-type="bibr">El-Diwany <italic toggle="yes">et al.</italic>, 2017</xref>). Emulating populations using sequences derived from plasma samples of individual patients allows us to mimic the structure of viral populations more faithfully. Moreover, testing different viruses is crucial, as they may display different mechanisms of evolution and, hence, distinct forms of genetic variation.</p>
    </sec>
    <sec>
      <title>2.5 Control sample for pipeline validation on real datasets</title>
      <p>The control sample consists of an <italic toggle="yes">in vitro</italic> mixture of five known HIV-1 strains mixed at equal proportions. Four sequencing experiments were carried out starting with approximately 10<sup>4</sup> (denoted <italic toggle="yes">10 K</italic>) and 10<sup>5</sup> (denoted <italic toggle="yes">100 K</italic>) HIV-1 RNA copies. The samples were sequenced by using the Illumina MiSeq platform in paired-end read mode (2 × 250 bp length, v2 kit). The protocol described by <xref rid="btab015-B7" ref-type="bibr">Di Giallonardo <italic toggle="yes">et al.</italic> (2014)</xref> was employed for the amplification and sequencing. Primers were designed to cover almost the full HIV genome in five overlapping segments. Two types of sequencing experiments were carried out: one including all five amplicons (denoted <italic toggle="yes">A</italic>) and another one using only amplicon B (denoted <italic toggle="yes">B</italic>). This 2 × 2 design gives rise to four datasets referred to as A-10K, A-100K, B-10K and B-100K.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We demonstrate the benchmarking capabilities of V-pipe and evaluate the accuracy of SNV detection using different read aligners and mutation callers. In addition, we analyse an <italic toggle="yes">in vitro</italic> mixture of well-defined viral strains to assess the performance of one particular pipeline configuration on actual sequencing data. We also employ V-pipe to process publicly available longitudinal data from 11 patients (<xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic>, 2015</xref>) to demonstrate the applicability of the pipeline as well as its run time performance.</p>
    <sec>
      <title>3.1 Simulation studies</title>
      <p>We simulate reads from <italic toggle="yes">in silico</italic> mixtures of sequences derived from two different viruses, namely HIV-1 and HCV (Section 2.4). We align simulated reads using ngshmmalign and compare it against two widely used read aligners, namely BWA MEM and Bowtie 2. For this comparison, we employ <italic toggle="yes">vpipeBenchRunner</italic> for the simultaneous execution of all pipeline configurations.</p>
      <p>Averaged over all simulated datasets, the evaluated tools align more than 89% of the read pairs concordantly (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref>). Although BWA MEM reports the highest percentage of aligned reads, ngshmmalign aligns a larger portion of sequenced bases resulting in a higher average coverage (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S2</xref>). To investigate potential read alignment bias due to differences in sequence similarity to the reference sequence, we report the fraction of aligned reads and aligned bases per haplotype. For the HCV-based datasets, sequences exhibit a broad range of divergence from the reference strain (0.005–0.112). BWA MEM aligns most of the reads regardless of the divergence from the reference (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S3A</xref>), but a large fraction of the bases are soft-clipped, whereas ngshmmalign aligns a higher fraction of the bases for all haplotypes (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S3B</xref>).</p>
      <p>Since the main focus of V-pipe is to infer viral genetic diversity, we evaluate the accuracy of the read aligners based on the <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> score of detecting SNVs using ShoRAH. The <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> score is the harmonic mean of precision and recall. To make the scores comparable, we report the performance metric for the union of all genomic loci covered by at least one of the aligners for each of the evaluated conditions. We evaluate two read coverages (10 000× and 40 000×) and three strategies to generate the underlying haplotype abundances. In most cases, ngshmmalign outperforms BWA MEM and Bowtie 2 in terms of the <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> score (<xref rid="btab015-F2" ref-type="fig">Fig. 2A</xref>), and the difference in the scores is statistically significant (corrected <italic toggle="yes">P</italic>-value &lt; 0.05, Wilcoxon signed-rank test, Supplementary Section S1.5.1). On the other hand, we do not observe substantial differences in the performance of the individual aligners while varying the distribution of haplotype frequencies, the number of haplotypes or the evaluated coverages (Supplementary Figs S4–S6).</p>
      <fig position="float" id="btab015-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Performance of SNV detection on simulated datasets. (<bold>A</bold>) We compare ngshmmalign, BWA MEM and Bowtie 2 for read alignment, and fix ShoRAH for mutation calling. (<bold>B</bold>) We use ngshmmalign for the read alignment, and compare ShoRAH with LoFreq for mutation calling. In both panels, <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> scores are averaged over datasets with various numbers of haplotypes based on HIV-1 subtype B sequences from subjects 1051 and BORI0637, and HCV genotype 1a sequences. Results are shown for a read coverage of 10 000× and for different distributions of haplotype frequencies as described in the Methods Section 2.4 (Dirichlet: <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">D</mml:mi><mml:mi mathvariant="bold">i</mml:mi><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Uniform: <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Dir</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Equal prop.: all haplotype frequencies equal). The error bar corresponds to the standard error</p>
        </caption>
        <graphic xlink:href="btab015f2" position="float"/>
      </fig>
      <p>For the evaluations, in addition to single-nucleotide substitutions, we account for position-wise deletions, by including the gap symbol as an alternative base. We further compare the performance in identifying such deletions and find that ngshmmalign outperforms BWA MEM and Bowtie2 for all evaluated conditions (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S10A</xref>). In addition to the position-wise performance, we also account for the length of individual deletion events and again find ngshmmalign to perform best (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S11A</xref>).</p>
      <p>Next, we focus on mutation calling and compare the accuracy of SNVs obtained by using ShoRAH versus LoFreq, while fixing ngshmmalign for the read alignment. We observe significant differences in the <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> scores for most datasets based on HIV-1 sequences from subject 1051 (corrected <italic toggle="yes">P</italic>-value &lt; 0.05, Wilcoxon signed-rank test, <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S3</xref>); otherwise both tools appear to perform equally well (<xref rid="btab015-F2" ref-type="fig">Fig. 2B</xref> and Supplementary Fig. S7). Similar results are obtained when comparing performance based on detection of deletions; ShoRAH displays higher <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> scores than LoFreq for most datasets based on HIV-1 sequences from subject 1051 (Supplementary Figs S10B and S11B). Small discrepancies in the <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> scores can be attributed to differences in recall, whereas both tools show almost perfect precision (Supplementary Figs S8 and S9).</p>
      <p>Although aligning reads with ngshmmalign and performing mutation calling with ShoRAH resulted in better <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">F</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> scores in most cases, we note that there is a trade-off between accuracy and computational resources (Supplementary Section S1.5).</p>
    </sec>
    <sec>
      <title>3.2 Validation of V-Pipe on a mixture of five HIV-1 strains</title>
      <p>We employ V-pipe using ngshmmalign with a <italic toggle="yes">de novo</italic> constructed reference sequence, and ShoRAH for SNV calling. In all cases, V-pipe detected more than 86% of the expected SNVs, with almost perfect specificity (<xref rid="btab015-T1" ref-type="table">Table 1</xref>). In datasets for which only amplicon B is sequenced (B-10k and B-100k), V-pipe reports perfect recall, whereas for datasets sequenced with all sets of primers (A-10k and A-100k), V-pipe misses a small fraction of the expected SNVs. The missed variants are predominately located at the genome termini, which correspond to regions of lower coverage. We also observe a decrease in precision for datasets A-100k, B-10k and B-100k. Most of the falsely reported SNVs correspond to single-nucleotide deletions at very low frequencies, whereas such errors are less prominent in sample A-10k. When inspecting the precision of the mutation calls as a function of the variant frequencies, we find that a precision higher than 98% can be attained for SNVs with frequencies at least 0.5% for all the analysed datasets (<xref rid="btab015-F3" ref-type="fig">Fig. 3A</xref>). In addition to detecting most of the expected variants, we find the frequencies of unique SNVs per haplotype reported by ShoRAH to be in good agreement with the relative abundances originally reported by <xref rid="btab015-B7" ref-type="bibr">Di Giallonardo <italic toggle="yes">et al.</italic> (2014)</xref> (<xref rid="btab015-F3" ref-type="fig">Fig. 3B</xref>).</p>
      <fig position="float" id="btab015-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Evaluation of the performance of V-pipe on HTS data derived from the five-virus-mix. (<bold>A</bold>) Precision of SNV calls as a function of SNV frequency. (<bold>B</bold>) Distribution of inferred frequencies of unique SNVs for each haplotype in the mix for dataset A-10k. Green diamonds show the corresponding average frequency. The values reported in <xref rid="btab015-B7" ref-type="bibr">Di Giallonardo <italic toggle="yes">et al.</italic> (2014)</xref> for the mean and standard deviation of the frequencies estimated from Illumina reads are indicated in red</p>
        </caption>
        <graphic xlink:href="btab015f3" position="float"/>
      </fig>
      <table-wrap position="float" id="btab015-T1">
        <label>Table 1.</label>
        <caption>
          <p>Evaluating mutation calling using V-pipe</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset</th>
              <th rowspan="1" colspan="1">Recall</th>
              <th rowspan="1" colspan="1">Precision</th>
              <th rowspan="1" colspan="1">Specificity</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">A-10k</td>
              <td rowspan="1" colspan="1">0.860</td>
              <td rowspan="1" colspan="1">0.944</td>
              <td rowspan="1" colspan="1">0.992</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">A-100k</td>
              <td rowspan="1" colspan="1">0.873</td>
              <td rowspan="1" colspan="1">0.631</td>
              <td rowspan="1" colspan="1">0.925</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">B-10k</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0.770</td>
              <td rowspan="1" colspan="1">0.977</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">B-100k</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0.403</td>
              <td rowspan="1" colspan="1">0.885</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p><italic toggle="yes">Note</italic>: Datasets A and B result from using five overlapping amplicons (A) or only the second amplicon covering mainly HIV-1 pol (B), respectively, and the suffix indicates the initial amount of RNA copies.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>3.3 Application to clinical samples</title>
      <p>To test V-pipe on clinical samples, we analyse publicly available datasets corresponding to longitudinal samples from one of the patients studied by <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015)</xref> (ENA study accession number PRJEB9618). We employ V-pipe to infer local haplotypes on the 6 longitudinal datasets available for patient p2, using ngshmmalign and ShoRAH for local haplotype reconstruction. We compare the inferred haplotypes to the haplotype sequences reported by <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015)</xref> on a region of the <italic toggle="yes">p17</italic> gene spanning nucleotides 872–1072 with respect to the HXB2 reference genome. This region has been arbitrarily chosen from regions displaying genetic diversity. After filtering out inferred haplotypes with a posterior probability smaller than 0.9 and an average read count of less than 10 reads, we find a perfect match between haplotype sequences reconstructed using V-pipe and the sequences previously reported by <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015)</xref> using manually curated read alignments. However, V-pipe finds 1, 11, 3 and 8 additional haplotypes in the samples taken 561, 1255, 1628 and 2018 days after the estimated date of infection, respectively. The estimated frequencies of these haplotypes range from 0.08% to 6%. For the matching haplotypes, the absolute error in the estimated abundances is below 4% for all the considered datasets (Supplementary <xref rid="sup1" ref-type="supplementary-material">Fig. S12</xref>).</p>
      <p>We visualise the reconstructed local haplotypes by representing pairwise Hamming distances in a two-dimensional plane (<xref rid="btab015-F4" ref-type="fig">Fig. 4</xref>). We observe a drift in sequence space from the initial haplotype (in red, <xref rid="btab015-F4" ref-type="fig">Fig. 4</xref>) as time progresses. Sequences of haplotypes recovered after 561 and 1255 days of infection are situated closer to the initial haplotype sequence, whereas sequences corresponding to later time points (after 1628 and 2018 days of infection) are further away.</p>
      <fig position="float" id="btab015-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>Representation of the reconstructed viral haplotypes in a region of the HIV-1 <italic toggle="yes">p17</italic> gene from longitudinal samples of patient p2 of <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015)</xref>. Discs represent inferred haplotypes, and their size reflect the relative abundances. Haplotypes are placed in a two-dimensional plane with the aim of preserving all pairwise Hamming distances as much as possible, using multi-dimensional scaling as implemented in scikit-learn (<xref rid="btab015-B35" ref-type="bibr">Pedregosa, 2011</xref>). The colours indicate the number of days after infection and encircled discs denote haplotypes identified by V-pipe but not by <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015</xref><xref rid="btab015-B50" ref-type="bibr">)</xref></p>
        </caption>
        <graphic xlink:href="btab015f4" position="float"/>
      </fig>
      <p>To illustrate the large-scale applicability of the pipeline, we note that using V-pipe to process all 92 datasets reported in <xref rid="btab015-B50" ref-type="bibr">Zanini <italic toggle="yes">et al.</italic> (2015)</xref> yielded an average run time per sample of 16 h on 12-core Intel Xeon E5-2680v3 processors (2.5–3.3 GHz), for an average coverage across samples of <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mn>31</mml:mn><mml:mo> </mml:mo><mml:mn>871</mml:mn><mml:mo>×</mml:mo></mml:mrow></mml:math></inline-formula>. Depending on the computational resources available, the total throughput can be largely independent of the number of samples, because the processing steps for individual datasets can be executed in parallel. Moreover, when computational resources are limited, V-pipe can be executed using alternative aligners, such as BWA MEM. For these particular datasets, BWA MEM aligned reads within 86 s on average, whereas ngshmmalign took on average 4 h 38 min. Similarly, LoFreq can be used for mutation calling as opposed to ShoRAH. In this case, ShoRAH took on average 11 h 7 min using 12 threads, whereas LoFreq took 2 h 42 min executed as a single-threaded program.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion and conclusions</title>
    <p>Incorporating HTS technologies into viral genomics studies provides new opportunities to characterize intra-host virus populations in unprecedented depth. However, the applicability of these technologies is challenged by the amount and quality of the resulting data. In a clinical diagnostics setting, these large volumes of data need to be analysed accurately and efficiently within a short period of time.</p>
    <p>To ensure reproducibility and traceability of the analysis workflows, we developed and implemented the bioinformatics pipeline V-pipe. V-pipe is tailored to studying intra-host diversity from viral HTS data. Although workflows for either the identification of minor variants (<xref rid="btab015-B17" ref-type="bibr">Huber <italic toggle="yes">et al.</italic>, 2017</xref>) or the reconstruction of viral haplotypes (<xref rid="btab015-B18" ref-type="bibr">Jayasundara <italic toggle="yes">et al.</italic>, 2015</xref>) have been proposed, to our knowledge, V-pipe is the first pipeline assessing viral diversity at all spatial levels of the viral genome, i.e. SNVs, as well as local and global haplotypes.</p>
    <p>We also present a novel read alignment approach tailored to relatively small, yet highly diverse genomes. The aligner prioritizes accuracy over speed and is based on profile hidden Markov models, which allow for capturing features shared among related sequences, such as mutations and indels, through position-specific probabilities.</p>
    <p>We evaluated ngshmmalign on simulated reads from mock viral populations that attempt to mimic hyper-variable regions of HIV-1 (<italic toggle="yes">env</italic> gene) and HCV (<italic toggle="yes">E1E2</italic> region). The performance of the aligner was indirectly evaluated based on the detection of SNVs from the aligned reads. In most cases, the <italic toggle="yes">F</italic><sub>1</sub> score was found to be larger than 0.8, and SNV calls based on alignments obtained using ngshmmalign also reported a higher score compared to alignments by BWA MEM or Bowtie 2. Furthermore, comparing performance outcomes based on HIV-1 datasets, showing variation in the form of indels, with HCV-based datasets, the advantage of using ngshmmalign over conventional aligners became apparent. We further evaluated the performance based solely on detection of deletions, finding that ngshmmalign outperforms the other evaluated aligner. We thus argue that ngshmmalign should be the preferred choice for populations containing indels as sources of variation. Although ngshmmalign performed better under the evaluation conditions, it is possible that the alignments produced by BWA MEM or Bowtie 2 could be further improved by fine-tuning their hyper-parameters. Nevertheless, our results suggest that the SNV detection accuracy is to a larger extent influenced by the upstream alignment step than by the choice of the SNV caller. More importantly, with this simulation study, we demonstrated the benchmarking component implemented in V-pipe, which can be useful for assessing the actual run times of individual tools and adjusting the pipeline to meet specific requirements, e.g. on accuracy of the results or availability of computational resources.</p>
    <p>Intrinsic parameters of the analysed sample such as diversity and number of mutations can generally impact the performance of the individual tools integrated in V-pipe. In our simulation study, we analysed synthetic data from populations ranging from 8 to 60 haplotypes, as well as different distributions for the haplotype frequencies, and did not find substantial changes in the F1 score (Supplementary Figs S4 and S7).</p>
    <p>Using V-pipe, we were able to reconstruct the genetic diversity present in a five-virus-mix control sample dataset with high recall. While we observed lower precision, this could be improved substantially by filtering out deletion calls with frequencies below 0.5%. Choosing such thresholds for mutation and structural variant calling is highly dependent on the HTS protocols, but detecting SNVs at frequencies as low as 1% is already very close to the Illumina sequencing error rate.</p>
    <p>In addition to simulated datasets and control sequencing samples, we demonstrated the applicability of the pipeline by processing data from 92 clinical samples resulting in typical run times of 16 h per sample. Thus, we believe that total turnaround times of a few days are feasible using V-pipe’s default configuration (i.e. with ngshmmalign and ShoRAH) and including sample collection and preparation, sequencing and data analysis. Hence, the accuracy as well as the run times of V-pipe make it suitable for many applications.</p>
    <p>Most studies on viral genetic diversity have been limited to the identification of SNVs. Yet, the occurrence of mutations on the same genome might not be independent and the combined effect of co-occurring mutations might not be additive. On the other hand, it is not entirely obvious how to incorporate haplotype information, e.g. into monitoring epidemics, drug resistance surveillance or supporting treatment decisions. There is, however, supporting evidence for using viral haplotypes to infer transmission pairs (<xref rid="btab015-B36" ref-type="bibr">Poon <italic toggle="yes">et al.</italic>, 2016</xref>). V-pipe can support such research towards the understanding of the missing links in viral haplotyping.</p>
    <p>In general, viral haplotype reconstruction is an active research field. Consequently, new computational methods for this task are regularly being proposed. In addition to novel methods, technological improvements are deployed at a high rate. Therefore, any pipeline needs to be actively maintained and constantly adapted to new requirements. We addressed this aspect from two directions. First, additional efforts have been directed into making the individual components of our pipeline, such as ShoRAH and HaploClique, more performant to handle current sequencing throughputs. Second, V-pipe features a modular and extensible architecture, such that the pipeline can be adapted to incorporate new tools.</p>
    <p>Furthermore, there is a pressing need to establish standards for data analysis. We thus introduced a benchmark component to support testing of different pipeline configurations. While we mainly focused on performance assessment of mutation calling, the benchmark utilities can be employed in a similar fashion to evaluate haplotype reconstruction, which is subject to future work.</p>
    <p>One limitation of the pipeline is that it currently focuses on Illumina data. Other sequencing technologies such as Pacific Biosciences and Oxford Nanopore can produce longer reads which have the potential to reduce the complexity of the haplotype reconstruction problem. However, the higher error rates, compared to Illumina sequencing, can be a limiting factor. Combining data from both short-read and long-read sequencing is a promising direction (<xref rid="btab015-B43" ref-type="bibr">Viehweger et al., 2019</xref>), and future developments should include extending the pipeline to support Pacific Biosciences and Oxford Nanopore data. Given that long-read technologies often do not provide an output in FASTQ format, the minimum changes required entail input file conversion as well as a customized pipeline configuration, e.g. using BWA-MEM as the aligner. As the need arises, dedicated long-read tools such as minimap2 (<xref rid="btab015-B27" ref-type="bibr">Li, 2018</xref>) or pbmm2 (<ext-link xlink:href="https://github.com/PacificBiosciences/pbmm2" ext-link-type="uri">https://github.com/PacificBiosciences/pbmm2</ext-link>), read assemblers and even base callers should be added to the pipeline.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab015_Supplementary_Data</label>
      <media xlink:href="btab015_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank Tobias Marschall for outlining the needs of the community, contributing to the initial design of V-pipe and co-organizing the 2017 Basel Computational Biology Conference (BC2) tutorial on ‘Production Pipelines for Virus Sequencing Data’. They thank Maryam Zaheri for testing, refactoring and adding a continuous integration pipeline to the HaploClique software. They also thank Marek Pikulski and Nico Borgsmüller for critical reading.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by the SystemsX.ch [<inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mo>#</mml:mo><mml:mn>51</mml:mn><mml:mtext>MRP</mml:mtext><mml:mn>0</mml:mn><mml:mo>_</mml:mo><mml:mn>158328</mml:mn></mml:mrow></mml:math></inline-formula> to K.J.M and N.B.]. V-pipe is supported as a Competitive Resource by the Swiss Institute of Bioinformatics.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared. </p>
    </sec>
    <sec sec-type="data-availability">
      <title>Data availability</title>
      <p>The sequencing data underlying this article are available in Github at <ext-link xlink:href="https://github.com/cbg-ethz/5-virus-mix" ext-link-type="uri">https://github.com/cbg-ethz/5-virus-mix</ext-link> and in ENA at <ext-link xlink:href="https://www.ebi.ac.uk/ena/browser/home" ext-link-type="uri">https://www.ebi.ac.uk/ena/browser/home</ext-link> and can be accesed with study accession number PRJEB9618.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab015-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Andrews</surname><given-names>S.</given-names></string-name></person-group> (<year>2019</year>) <source>FastQC a Quality Control Tool for High Throughput Sequence Data</source>. 
<publisher-name>Babraham Institute</publisher-name>. <ext-link xlink:href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" ext-link-type="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</ext-link>.</mixed-citation>
    </ref>
    <ref id="btab015-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Archer</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) 
<article-title>The evolutionary analysis of emerging low frequency HIV-1 CXCR4 using variants through time–an ultra-deep approach</article-title>. <source>PLoS Comput. Biol</source>., <volume>6</volume>, <fpage>e1001022</fpage>.<pub-id pub-id-type="pmid">21187908</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baaijens</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>De novo assembly of viral quasispecies using overlap graphs</article-title>. <source>Genome Res</source>., <volume>27</volume>, <fpage>835</fpage>–<lpage>848</lpage>.<pub-id pub-id-type="pmid">28396522</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barzon</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Next-generation sequencing technologies in diagnostic virology</article-title>. <source>J. Clin. Virol</source>., <volume>58</volume>, <fpage>346</fpage>–<lpage>350</lpage>.<pub-id pub-id-type="pmid">23523339</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Beerenwinkel</surname><given-names>N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>Challenges and opportunities in estimating viral genetic diversity from next-generation sequencing data</article-title>. <source>Front Microbiol</source>, <volume>3</volume>, <fpage>329</fpage>.<pub-id pub-id-type="pmid">22973268</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Capobianchi</surname><given-names>M.R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Next-generation sequencing technology in clinical virology</article-title>. <source>Clin. Microbiol. Infect</source>., <volume>19</volume>, <fpage>15</fpage>–<lpage>22</lpage>.<pub-id pub-id-type="pmid">23279287</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Di Giallonardo</surname><given-names>F.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>Full-length haplotype reconstruction to infer the structure of heterogeneous virus populations</article-title>. <source>Nucleic Acids Res</source>., <volume>42</volume>, <fpage>e115</fpage>.<pub-id pub-id-type="pmid">24972832</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Domingo</surname><given-names>E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2005</year>) 
<article-title>Quasispecies dynamics and RNA virus extinction</article-title>. <source>Virus Res</source>., <volume>107</volume>, <fpage>129</fpage>–<lpage>139</lpage>.<pub-id pub-id-type="pmid">15649559</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Duffy</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) 
<article-title>Rates of evolutionary change in viruses: patterns and determinants</article-title>. <source>Nat. Rev. Genet</source>, .<volume>9</volume>, <fpage>267</fpage>–<lpage>276</lpage>.<pub-id pub-id-type="pmid">18319742</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>El-Diwany</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>Extra-epitopic hepatitis C virus polymorphisms confer resistance to broadly neutralizing antibodies by modulating binding to scavenger receptor B1</article-title>. <source>PLoS Pathog</source>., <volume>13</volume>, <fpage>e1006235</fpage>.<pub-id pub-id-type="pmid">28235087</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Eliseev</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) 
<article-title>Evaluation of haplotype callers for next-generation sequencing of viruses</article-title>. <source>Infect. Genet. Evol</source>., <volume>82</volume>, <fpage>104277</fpage>.<pub-id pub-id-type="pmid">32151775</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gaschen</surname><given-names>B.</given-names></string-name></person-group> (<year>2002</year>) 
<article-title>Diversity considerations in HIV-1 vaccine selection</article-title>. <source>Science</source>, <volume>296</volume>, <fpage>2354</fpage>–<lpage>2360</lpage>.<pub-id pub-id-type="pmid">12089434</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goodwin</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) 
<article-title>Coming of age: ten years of next-generation sequencing technologies</article-title>. <source>Nat. Rev. Genet</source>., <volume>17</volume>, <fpage>333</fpage>–<lpage>351</lpage>.<pub-id pub-id-type="pmid">27184599</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ho</surname><given-names>T.</given-names></string-name>, <string-name><surname>Tzanetakis</surname><given-names>I.E.</given-names></string-name></person-group> (<year>2014</year>) 
<article-title>Development of a virus detection and discovery pipeline using next generation sequencing</article-title>. <source>Virology</source>, <volume>471–473</volume>, <fpage>54</fpage>–<lpage>60</lpage>.</mixed-citation>
    </ref>
    <ref id="btab015-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Howison</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>Measurement error and variant-calling in deep Illumina sequencing of HIV</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>2029</fpage>–<lpage>2035</lpage>.<pub-id pub-id-type="pmid">30407489</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huang</surname><given-names>W.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>ART: a next-generation sequencing read simulator</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>593</fpage>–<lpage>594</lpage>.<pub-id pub-id-type="pmid">22199392</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huber</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>MinVar: a rapid and versatile tool for HIV-1 drug resistance genotyping by deep sequencing</article-title>. <source>J. Virol. Methods</source>, <volume>240</volume>, <fpage>7</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">27867045</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jayasundara</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) 
<article-title>ViQuaS: an improved reconstruction pipeline for viral quasispecies spectra generated by next-generation sequencing</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>886</fpage>–<lpage>896</lpage>.<pub-id pub-id-type="pmid">25398613</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Katoh</surname><given-names>K.</given-names></string-name>, <string-name><surname>Standley</surname><given-names>D.M.</given-names></string-name></person-group> (<year>2013</year>) 
<article-title>MAFFT multiple sequence alignment software version 7: improvements in Performance and Usability</article-title>. <source>Mol. Biol. Evol</source>., <volume>30</volume>, <fpage>772</fpage>–<lpage>780</lpage>.<pub-id pub-id-type="pmid">23329690</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group> (<year>2012</year>) 
<article-title>Snakemake – a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kuroda</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) 
<article-title>Characterization of quasispecies of pandemic 2009 influenza A virus (A/H1N1/2009) by <italic toggle="yes">de novo</italic> sequencing using a next-generation DNA sequencer</article-title>. <source>PLoS One</source>, <volume>5</volume>, <fpage>e10256</fpage>.<pub-id pub-id-type="pmid">20428231</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Langmead</surname><given-names>B.</given-names></string-name>, <string-name><surname>Salzberg</surname><given-names>S.</given-names></string-name></person-group> (<year>2012</year>) 
<article-title>Fast gapped-read alignment with Bowtie 2</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>357</fpage>–<lpage>359</lpage>.<pub-id pub-id-type="pmid">22388286</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lauring</surname><given-names>A.S.</given-names></string-name>, <string-name><surname>Andino</surname><given-names>R.</given-names></string-name></person-group> (<year>2010</year>) 
<article-title>Quasispecies theory and the behavior of RNA viruses</article-title>. <source>PLoS Pathog</source>., <volume>6</volume>, <fpage>e1001005</fpage>.<pub-id pub-id-type="pmid">20661479</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>E.R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) 
<article-title>Performance comparison of next generation sequencing analysis pipelines for HIV-1 drug resistance testing</article-title>. <source>Sci Rep</source>, <volume>10</volume>, <fpage>1634</fpage>.<pub-id pub-id-type="pmid">32005884</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>H.Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) 
<article-title>Modeling sequence evolution in acute HIV-1 infection</article-title>. <source>J. Theor. Biol</source>., <volume>261</volume>, <fpage>341</fpage>–<lpage>360</lpage>.<pub-id pub-id-type="pmid">19660475</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>H.</given-names></string-name></person-group> (<year>2013</year>) 
<article-title>Aligning sequence reads, clone sequences and assembly contigs with BWA-MEM</article-title>. <source>arXiv:1303.3997</source>.</mixed-citation>
    </ref>
    <ref id="btab015-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>H.</given-names></string-name></person-group> (<year>2018</year>) 
<article-title>Minimap2: pairwise alignment for nucleotide sequences</article-title>. <source>Bioinformatics</source>, <volume>34</volume>, <fpage>3094</fpage>–<lpage>3100</lpage>.<pub-id pub-id-type="pmid">29750242</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) 
<article-title>VIP: an integrated pipeline for metagenomics of virus identification and discovery</article-title>. <source>Sci. Rep</source>., <volume>6</volume>, <fpage>23774</fpage>.<pub-id pub-id-type="pmid">27026381</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maarala</surname><given-names>A.I.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) 
<article-title>ViraPipe: scalable parallel pipeline for viral metagenome analysis from next generation sequencing reads</article-title>. <source>Bioinformatics</source>, <volume>34</volume>, <fpage>928</fpage>–<lpage>935</lpage>.<pub-id pub-id-type="pmid">29106455</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mangul</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>Accurate viral population assembly from ultra-deep sequencing data</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>i329</fpage>–<lpage>i337</lpage>.<pub-id pub-id-type="pmid">24932001</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mason</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) 
<article-title>Comparison of antiviral resistance across acute and chronic viral infections</article-title>. <source>Antiviral Res</source>., <volume>158</volume>, <fpage>103</fpage>–<lpage>112</lpage>.<pub-id pub-id-type="pmid">30086337</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McElroy</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Accurate single nucleotide variant detection in viral populations by combining probabilistic clustering with a statistical test of strand bias</article-title>. <source>BMC Genomics</source>, <volume>14</volume>, <fpage>501</fpage>–<lpage>512</lpage>.<pub-id pub-id-type="pmid">23879730</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Naccache</surname><given-names>S.N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>A cloud-compatible bioinformatics pipeline for ultrarapid pathogen identification from next-generation sequencing of clinical samples</article-title>. <source>Genome Res</source>., <volume>24</volume>, <fpage>1180</fpage>–<lpage>1192</lpage>.<pub-id pub-id-type="pmid">24899342</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nowak</surname><given-names>M.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>1991</year>) 
<article-title>Antigenic diversity thresholds and the development of AIDS</article-title>. <source>Science</source>, <volume>254</volume>, <fpage>963</fpage>–<lpage>969</lpage>.<pub-id pub-id-type="pmid">1683006</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pedregosa</surname><given-names>F.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2011</year>) 
<article-title>Scikit-learn: machine learning in Python</article-title>. <source>J. Mach. Learn. Res</source>., <volume>12</volume>, <fpage>2825</fpage>–<lpage>2830</lpage>.</mixed-citation>
    </ref>
    <ref id="btab015-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poon</surname><given-names>L.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) 
<article-title>Quantifying influenza virus diversity and transmission in humans</article-title>. <source>Nat. Genet</source>., <volume>48</volume>, <fpage>195</fpage>–<lpage>200</lpage>.<pub-id pub-id-type="pmid">26727660</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Posada-Céspedes</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>Recent advances in inferring viral diversity from high-throughput sequencing data</article-title>. <source>Virus Res</source>., <volume>239</volume>, <fpage>17</fpage>–<lpage>32</lpage>.<pub-id pub-id-type="pmid">27693290</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rozera</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>Quasispecies tropism and compartmentalization in gut and peripheral blood during early and chronic phases of HIV-1 infection: possible correlation with immune activation markers</article-title>. <source>Clin. Microbiol. Infect</source>., <volume>20</volume>, <fpage>O157</fpage>–<lpage>O166</lpage>.<pub-id pub-id-type="pmid">24134524</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schmieder</surname><given-names>R.</given-names></string-name>, <string-name><surname>Edwards</surname><given-names>R.</given-names></string-name></person-group> (<year>2011</year>) 
<article-title>Quality control and preprocessing of metagenomic datasets</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>863</fpage>–<lpage>864</lpage>.<pub-id pub-id-type="pmid">21278185</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Taylor</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>A MiSeq-HyDRA platform for enhanced HIV drug resistance genotyping and surveillance</article-title>. <source>Sci. Rep</source>., <volume>9</volume>, <fpage>8970</fpage>.<pub-id pub-id-type="pmid">31222149</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Töpfer</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) 
<article-title>Viral quasispecies assembly via maximal clique enumeration</article-title>. <source>PLoS Comput. Biol</source>., <volume>10</volume>, <fpage>e1003515</fpage>.<pub-id pub-id-type="pmid">24675810</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tsibris</surname><given-names>A.M.N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) 
<article-title>Quantitative deep sequencing reveals dynamic HIV-1 escape and large population shifts during CCR5 antagonist therapy <italic toggle="yes">in vivo</italic></article-title>. <source>PLoS One</source>, <volume>4</volume>, <fpage>e5683</fpage>.<pub-id pub-id-type="pmid">19479085</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Viehweger</surname>,<given-names>A.</given-names></string-name>  <etal>et al</etal>. </person-group> (<year>2019</year>) 
<article-title>Direct RNA nanopore sequencing of full-length coronavirus genomes provides novel insights into structural variants and enables modification analysis</article-title>. <source><italic toggle="yes">Genome Research</italic></source>, <volume>29</volume>, <fpage>1545</fpage>–<lpage>1554</lpage>. <pub-id pub-id-type="doi">10.1101/gr.247064.118</pub-id><pub-id pub-id-type="pmid">31439691</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vignuzzi</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2006</year>) 
<article-title>Quasispecies diversity determines pathogenesis through cooperative interactions in a viral population</article-title>. <source>Nature</source>, <volume>439</volume>, <fpage>344</fpage>–<lpage>348</lpage>.<pub-id pub-id-type="pmid">16327776</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wan</surname><given-names>Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) 
<article-title>VirAmp: a galaxy-based viral genome assembly pipeline</article-title>. <source>Gigascience</source>, <volume>4</volume>, <fpage>19</fpage>.<pub-id pub-id-type="pmid">25918639</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wilm</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>LoFreq: a sequence-quality aware, ultra-sensitive variant caller for uncovering cell-population heterogeneity from high-throughput sequencing datasets</article-title>. <source>Nucleic Acids Res</source>., <volume>40</volume>, <fpage>11189</fpage>–<lpage>11201</lpage>.<pub-id pub-id-type="pmid">23066108</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wymant</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal>; BEEHIVE Collaboration. (<year>2018</year>) 
<article-title>Easy and accurate reconstruction of whole HIV genomes from short-read sequence data with shiver</article-title>. <source>Virus Evol</source>., <volume>4</volume>, <fpage>vey007</fpage>.<pub-id pub-id-type="pmid">29876136</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>X.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>De novo assembly of highly diverse viral populations</article-title>. <source>BMC Genomics</source>, <volume>13</volume>, <fpage>475</fpage>.<pub-id pub-id-type="pmid">22974120</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zagordi</surname><given-names>O.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2011</year>) 
<article-title>ShoRAH: estimating the genetic diversity of a mixed sample from next-generation sequencing data</article-title>. <source>BMC Bioinformatics</source>, <volume>12</volume>, <fpage>119</fpage>.<pub-id pub-id-type="pmid">21521499</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B50">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zanini</surname><given-names>F.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) 
<article-title>Population genomics of intrapatient HIV-1 evolution</article-title>. <source>eLife</source>, <volume>4</volume>, <fpage>e11282</fpage>.<pub-id pub-id-type="pmid">26652000</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B51">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>VirusSeeker, a computational pipeline for virus discovery and virome composition analysis</article-title>. <source>Virology</source>, <volume>503</volume>, <fpage>21</fpage>–<lpage>30</lpage>.<pub-id pub-id-type="pmid">28110145</pub-id></mixed-citation>
    </ref>
    <ref id="btab015-B52">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) 
<article-title>VirusDetect: an automated pipeline for efficient virus discovery using deep sequencing of small RNAs</article-title>. <source>Virology</source>, <volume>500</volume>, <fpage>130</fpage>–<lpage>138</lpage>.<pub-id pub-id-type="pmid">27825033</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
