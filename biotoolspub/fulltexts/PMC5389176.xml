<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5389176</article-id>
    <article-id pub-id-type="publisher-id">1623</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-017-1623-y</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Empirical Bayes method for reducing false discovery rates of correlation matrices with block diagonal structure</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7791-0940</contrib-id>
        <name>
          <surname>Pacini</surname>
          <given-names>Clare</given-names>
        </name>
        <address>
          <email>cep46@cam.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ajioka</surname>
          <given-names>James W.</given-names>
        </name>
        <address>
          <email>ja131@hermes.cam.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Micklem</surname>
          <given-names>Gos</given-names>
        </name>
        <address>
          <email>gm263@cam.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution>CCBI, Department Applied Mathematics and Theoretical Physics, </institution><institution>University of Cambridge, </institution></institution-wrap>Wilberforce Road, Cambridge, CB3 0WA UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution>Department of Pathology, </institution><institution>University of Cambridge, </institution></institution-wrap>Tennis Court Road, Cambridge, CB2 1QP UK </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution>Cambridge Systems Biology Centre, </institution><institution>University of Cambridge, </institution></institution-wrap>Tennis Court Road, Cambridge, CB2 1QR UK </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>4</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>4</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2017</year>
    </pub-date>
    <volume>18</volume>
    <elocation-id>213</elocation-id>
    <history>
      <date date-type="received">
        <day>5</day>
        <month>7</month>
        <year>2016</year>
      </date>
      <date date-type="accepted">
        <day>1</day>
        <month>4</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2017</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p>Correlation matrices are important in inferring relationships and networks between regulatory or signalling elements in biological systems. With currently available technology sample sizes for experiments are typically small, meaning that these correlations can be difficult to estimate. At a genome-wide scale estimation of correlation matrices can also be computationally demanding.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>We develop an empirical Bayes approach to improve covariance estimates for gene expression, where we assume the covariance matrix takes a block diagonal form. Our method shows lower false discovery rates than existing methods on simulated data. Applied to a real data set from <italic>Bacillus subtilis</italic> we demonstrate it’s ability to detecting known regulatory units and interactions between them.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p>We demonstrate that, compared to existing methods, our method is able to find significant covariances and also to control false discovery rates, even when the sample size is small (<italic>n</italic>=10). The method can be used to find potential regulatory networks, and it may also be used as a pre-processing step for methods that calculate, for example, partial correlations, so enabling the inference of the causal and hierarchical structure of the networks.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Empirical Bayes</kwd>
      <kwd>Correlation</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000266</institution-id>
            <institution>Engineering and Physical Sciences Research Council</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2017</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p>Correlation analysis is a common approach for identifying relationships between the expression of genes or proteins. Initially the covariance matrix would be calculated which may then be either inverted to find a partial correlation matrix, or standardised to give the correlation matrix. The correlation matrix is often used in downstream analysis such as graphical inference or using partial correlations, that further provides causal information. One problem with this type of analysis is that often, by necessity, sample sizes are small and this reduces the power of detecting correlations and increases the false discovery rate.</p>
    <p>Methods for improving the estimation of correlations have to date included the shrinkage approach, Corpcor [<xref ref-type="bibr" rid="CR1">1</xref>]. However, this method is applied uniformly to the full correlation matrix. In practice, recent graphical model approaches have used the block diagonal form of the covariance matrix to improve computational efficiency and interpretation [<xref ref-type="bibr" rid="CR2">2</xref>]. In our case, we assume that sets of genes, within an operon for prokaryotes or under the control of one transcription factor for eukaryotes, will strongly correlate with each other. Such correlated sets are then represented by a single block, and the full correlation matrix is then split into separate blocks or transcriptional units. Consequently, a block diagonal structure of the covariance matrix is used to model this. A different covariance matrix in block diagonal form is used for each condition present in the data, meaning that different transcriptional units may be present in a case compared to a control matrix.</p>
    <p>In conjunction with assuming the block diagonal form of the covariance matrix, we have taken an empirical Bayes approach to model the covariance, and similarly calculate correlations. This approach uses the data to generate the prior information matrix and borrows information from across the genes to estimate covariances in such a way as to lower the false discovery rates (FDRs). This is important in downstream analysis where we would like to limit the number of false discoveries when identifying candidates to test experimentally.</p>
  </sec>
  <sec id="Sec2">
    <title>Implementation</title>
    <p>We use an empirical Bayes approach to infer covariances and by simple extension, correlations. The theoretical basis of this, using conjugate priors, is derived in [<xref ref-type="bibr" rid="CR3">3</xref>]. In that paper, Champion et al. use an independence prior, and a flat prior with constant covariance. We introduce a new prior that is a mixture of these two extremes, the block diagonal prior.</p>
    <p>Bayes theorem relates the posterior distribution of the parameters given the data <italic>p</italic>(<italic>Θ</italic>|<italic>X</italic>) to the likelihood of the data <italic>p</italic>(<italic>X</italic>|<italic>Θ</italic>) and the prior distribution of the parameters <italic>p</italic>(<italic>Θ</italic>) via 
<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(\Theta|X) \propto p(X|\Theta)p(\Theta) $$ \end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>Θ</mml:mi><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>)</mml:mo><mml:mo>∝</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo><mml:mi>Θ</mml:mi><mml:mo>)</mml:mo><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>Θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>
</p>
    <p>We assume the data <italic>X</italic> are multivariate normal with sample size <italic>n</italic>, covariance matrix <italic>Σ</italic>, mean <italic>μ</italic> and number of variables (genes) <italic>p</italic>, and thus the likelihood is proportional to 
<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$p(X|\Theta) \propto |\Sigma|^{-\frac{1}{2}}{\exp}\left\{-\frac{1}{2}(x-\mu)^{T}\Sigma^{-1}(x-\mu)\right\} $$ \end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo><mml:mi>Θ</mml:mi><mml:mo>)</mml:mo><mml:mo>∝</mml:mo><mml:mo>|</mml:mo><mml:mi>Σ</mml:mi><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>exp</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>
</p>
    <p>We wish to obtain a Bayesian estimate for the covariance matrix <italic>Σ</italic>, which we denote by <italic>η</italic>, and we assume that <italic>μ</italic> is known. The conjugate prior for estimating a covariance matrix (<italic>η</italic>) is an inverse Wishart distribution. We adopt the same parameterisation as [<xref ref-type="bibr" rid="CR3">3</xref>]: <italic>η</italic>∼<italic>W</italic>
<sup>−1</sup>(<italic>ψ</italic>,<italic>λ</italic>) where <italic>ψ</italic> is the mean of the Inverse Wishart distribution (<inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\frac {\lambda z}{\lambda }$\end{document}</tex-math><mml:math id="M6"><mml:mfrac><mml:mrow><mml:mi>λz</mml:mi></mml:mrow><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="12859_2017_1623_Article_IEq1.gif"/></alternatives></inline-formula>) and <italic>λ</italic>+<italic>p</italic>+1 are the degrees of freedom. The probability density function (pdf) for the inverse Wishart is proportional to 
<disp-formula id="Equc"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ p(\Theta) \propto |\eta|^{-(\lambda +2p+2)/2)}{\exp}\left\{-\frac{1}{2}\text{tr}(\lambda z \eta^{-1})\right\} $$ \end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mi>Θ</mml:mi><mml:mo>)</mml:mo><mml:mo>∝</mml:mo><mml:mo>|</mml:mo><mml:mi>η</mml:mi><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mo>(</mml:mo><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>p</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>exp</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mtext>tr</mml:mtext><mml:mo>(</mml:mo><mml:mi>λz</mml:mi><mml:msup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equc.gif" position="anchor"/></alternatives></disp-formula>
</p>
    <p>To obtain the joint posterior distribution we multiply the likelihood for sample data (which is multivariate normal) with the prior. Let <inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$S=\sum {(x'-\mu ')(x'-\mu ')^{T}}$\end{document}</tex-math><mml:math id="M10"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mo>∑</mml:mo><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2017_1623_Article_IEq2.gif"/></alternatives></inline-formula>, where <italic>x</italic>
<sup>′</sup> is the sample data and <italic>μ</italic>
<sup>′</sup> the sample mean. Then the joint posterior distribution <italic>p</italic>(<italic>Θ</italic>|<italic>X</italic>) is proportional to 
<disp-formula id="Equd"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$|\eta|^{-(n+\lambda+2p+2)/2}\exp\left\{-\frac{1}{2}\text{tr}(\eta^{-1}(\lambda z + S))\right\} $$ \end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:mo>|</mml:mo><mml:mi>η</mml:mi><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>p</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>exp</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mtext>tr</mml:mtext><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi>λz</mml:mi><mml:mo>+</mml:mo><mml:mi>S</mml:mi><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equd.gif" position="anchor"/></alternatives></disp-formula> which is an inverse Wishart distribution with parameters <inline-formula id="IEq3"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\left (\frac {\lambda z+S} {\lambda +n},\lambda +n\right)$\end{document}</tex-math><mml:math id="M14"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>λz</mml:mi><mml:mo>+</mml:mo><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="12859_2017_1623_Article_IEq3.gif"/></alternatives></inline-formula>. We then estimate <italic>η</italic> by <italic>η</italic>
<sup>0</sup>, the expected value of the distribution: 
<disp-formula id="Eque"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \hspace{70pt} \eta^{0} = \frac{\lambda z + S}{\lambda +n } \end{array} $$ \end{document}</tex-math><mml:math id="M16"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mspace width="70.0pt"/><mml:msup><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>λz</mml:mi><mml:mo>+</mml:mo><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12859_2017_1623_Article_Eque.gif" position="anchor"/></alternatives></disp-formula>
</p>
    <p>From this we can see that the inverse Wishart requires two hyperparameters, the matrix z and scalar <italic>λ</italic>.</p>
    <sec id="Sec3">
      <title>Calculating hyperparameters</title>
      <p>In empirical Bayes methods both hyperparameters <italic>λ</italic> and <italic>z</italic> are estimated from the data, rather than using a hierarchical model and assigning a prior distribution to each of the parameters, or by having to choose the parameter values where little prior knowledge is available. In choosing the matrix <italic>z</italic> we are looking for an appropriate prior matrix for the covariance matrix <italic>η</italic>. The Inverse Wishart distribution requires that the matrix <italic>z</italic> is positive definite, block diagonal matrices are positive definite if and only if each of the blocks are positive definite. Therefore we construct a block diagonal prior matrix where each of the blocks have a constant (non perfect) correlation. The estimated correlation matrix from this method <italic>η</italic>
<sup>0</sup> is then a mixture of the sample correlation matrix S and the block diagonal prior matrix z.</p>
      <p>As we are using a block diagonal matrix for <italic>z</italic> we have added an extra level of estimation to the model over other methods that fix the structure of the prior matrix <italic>z</italic> a priori as, for example, the independence or flat correlation matrix. By using the block diagonal matrix the different groupings or blocks need to be determined for each data set separately. There are three methods for generating the blocks for the matrix z available in the package covEB. The first is to provide a list of the block assignments for each variable in the covariance matrix. Each entry in the list should comprise a set of variables that together will form one block. The algorithm then uses the average correlation within these blocks to calculate a constant value for this block in the matrix z, with all elements outside the block set to zero.</p>
      <p>The second method is to provide a threshold parameter (or correlation level). This could be based on prior knowledge or calculated using an existing method for thresholding covariance matrices such as those described in Bickel et al. [<xref ref-type="bibr" rid="CR4">4</xref>]. Given this correlation level (used for simplicity to allow the user to set thresholds in [-1,1]), we set all elements of the sample correlation matrix below this threshold to zero and identify the block diagonal structure. This is done by treating the correlation matrix as a weighted graph and using the cluster function in the R package igraph [<xref ref-type="bibr" rid="CR5">5</xref>] to separate the graph into disjoint subnetworks such that each element in one subnetwork is completely separate from all elements in the other subnetworks, that is the correlation between them is zero. Each subnetwork then represents one block in the block diagonal matrix.</p>
      <p>The third method requires no prior information from the user, instead the Akaike’s Information Criteria (AIC) metric is used to select the threshold level that determines the block diagonal structure. The AIC is defined as <italic>AIC</italic>=2<italic>p</italic>−2 ln(<italic>L</italic>), where <italic>p</italic> are the number of parameters estimated in the model and ln(<italic>L</italic>) is the log-likelihood of the data given the model. In our case, we calculate the likelihood of observing the given covariance matrix for different block diagonal matrices (models). We assume the data is from a multivariate normal distribution with covariance matrix <italic>Ω</italic>. <italic>Ω</italic> is the diagonal matrix calculated (as outlined above) for different threshold values, this threshold value is chosen to minimise the AIC statistic.</p>
      <p>Once the groupings are known, it remains to find the correlation level within each block that together with the groupings will define the prior matrix <italic>z</italic>.This is done by averaging the correlations within each block to give a constant correlation value for that block in the prior matrix z. For example, in the block diagonal matrix z below we have 5 blocks, membership of variables in these 5 blocks having being determined by one of the three methods outlined above. 
<disp-formula id="Equf"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \hspace{60pt} \left(\begin{array}{ccccc} \delta_{1} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \delta_{2} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \delta_{3} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; \delta_{4} &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \delta_{5} \end{array} \right) \end{array} $$ \end{document}</tex-math><mml:math id="M18"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mspace width="60.0pt"/><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>5</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12859_2017_1623_Article_Equf.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>If, for example block 1 contains 4 variables (or genes) then, <italic>δ</italic>
<sub>1</sub> (the first block in the matrix z) takes the form: 
<disp-formula id="Equg"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\hspace{70pt} \left(\begin{array}{cccc} 1 &amp; \gamma &amp; \gamma &amp; \gamma \\ \gamma &amp;1 &amp; \gamma &amp; \gamma \\ \gamma &amp; \gamma &amp; 1 &amp; \gamma \\ \gamma &amp; \gamma &amp; \gamma &amp; 1 \end{array} \right) $$ \end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:mspace width="70.0pt"/><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mi>γ</mml:mi></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equg.gif" position="anchor"/></alternatives></disp-formula> and <italic>γ</italic> is estimated from the data as the average of the sample correlations between the four variables.</p>
      <p>Given the current estimate of <italic>z</italic> we then calculate <italic>λ</italic> using the following approximation suggested by [<xref ref-type="bibr" rid="CR3">3</xref>]: 
<disp-formula id="Equh"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$E((\rho_{ij}[\!\eta]-\rho_{ij}[\!z])^{2}) \simeq \frac{(1-\rho_{ij}[\!z]^{2})^{2}}{\lambda+3} \text{for} i \neq j, $$ \end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:mi>E</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>η</mml:mi><mml:mo>]</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>z</mml:mi><mml:mo>]</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:mo>≃</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mspace width="0.3em"/><mml:mi>z</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:mfrac><mml:mtext>for</mml:mtext><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math><graphic xlink:href="12859_2017_1623_Article_Equh.gif" position="anchor"/></alternatives></disp-formula> where <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>η</italic>] is the correlation based on <italic>η</italic>. We approximate <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>η</italic>] by the sample correlations, and <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>z</italic>] are the correlations based on <italic>z</italic> for the selected value of <italic>γ</italic>. See [<xref ref-type="bibr" rid="CR3">3</xref>] for full details of this derivation. However, briefly, this result follows from the distribution of the sample correlations <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>η</italic>] that is a two parameter distribution whose mean is <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>z</italic>]. Given the distribution of the <italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>η</italic>], the variance <italic>var</italic>(<italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>η</italic>])=<italic>E</italic>((<italic>ρ</italic>
<sub><italic>ij</italic></sub>[<italic>η</italic>]−<italic>ρ</italic>
<sub><italic>ij</italic></sub>[ <italic>z</italic>])<sup>2</sup>) is approximated using the moments of this distribution.</p>
    </sec>
    <sec id="Sec4">
      <title>Simulated data</title>
      <p>For the simulated data we use the method of Hardin to generate block diagonal matrices [<xref ref-type="bibr" rid="CR6">6</xref>]. We generated 100 sample covariance matrices for 50 genes, each covariance matrix had a block diagonal structure with 5 blocks of different sizes. Correlations within blocks were set to 0.7, random samples were generated for each of these correlation matrices for three different sample sizes of 10, 15 and 20. We include a simulated dataset under these parameters in the R package covEB. We denote the empirical Bayes method using a block diagonal prior as EB, for comparison two other methods are used to calculate the correlation matrix, the Pearson correlation matrix, and the Corpcor method of Schäfer et al. are used to estimate elements within blocks and all the elements outside these blocks are set to zero. We calculated the Frobenius norm between each of the estimation methods and the true block diagonal matrix. We estimated the correlation matrices and calculated the average false and true positive rates and their standard deviations over the 100 simulations, for each of the methods mentioned above.</p>
    </sec>
    <sec id="Sec5">
      <title>Biological data</title>
      <p>The <italic>Bacillus subtilis</italic> data were taken from the paper [<xref ref-type="bibr" rid="CR7">7</xref>]. A subset of 19 samples that are clustered according to the affinity propagation clustering with Euclidean distance was used. The genes were filtered leaving those with variance above the median. For each method we used known transcriptional unit information from BSubCyc (<ext-link ext-link-type="uri" xlink:href="http://www.bsubcyc.org">http://www.bsubcyc.org</ext-link>) to generate the prior groupings, selecting 56 known transcriptional units each with at least 5 genes in them.</p>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>Results and discussion</title>
    <p>First we compared the estimation of elements within blocks only for the three methods using the Frobenius norm, assuming known groups. The estimation using the EB method resulted in a matrix that was closer to the true matrix within blocks with similar standard deviation across simulations when compared to all of the other methods. This is shown in Table <xref rid="Tab1" ref-type="table">1</xref> which gives the average and standard deviation of the Frobenius norm between the estimated and true matrix over 100 simulations, for example when n=15, the EB method has a distance (according to the Frobenius norm) of 2.81, compared to 4.10 for the Pearson matrix and 17.99 for the Corpcor method. When the groupings are known, using the Pearson estimation within blocks and setting elements outside blocks to zero will give a smaller distance than the EB method. This is because the Frobenius norm of the elements outside blocks will be exactly zero by construction, in contrast, the EB method will shrink these elements to zero rather than setting them to be exactly to zero, and gives and increase to 7.59 from 2.81 when <italic>n</italic>=15. Therefore, in the case where the groupings are known, we would expect using the EB method within blocks and setting elements outside blocks to zero will give the closest result to the true matrix under the Frobenius norm.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Simulation results for the empirical Bayes method with known groupings (blocks)</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Pearson block</th><th align="left">Corpcor block</th><th align="left">EB block</th><th align="left">EB</th></tr></thead><tbody><tr><td align="left">Mean <italic>n</italic>=10</td><td align="left">5.67</td><td align="left">20.41</td><td align="left">4.08</td><td align="left">9.23</td></tr><tr><td align="left">Sd <italic>n</italic>=10</td><td align="left">1.49</td><td align="left">1.44</td><td align="left">1.64</td><td align="left">1.72</td></tr><tr><td align="left">Mean <italic>n</italic>=15</td><td align="left">4.10</td><td align="left">17.99</td><td align="left">2.81</td><td align="left">7.59</td></tr><tr><td align="left">Sd <italic>n</italic>=15</td><td align="left">0.98</td><td align="left">0.93</td><td align="left">1.05</td><td align="left">1.13</td></tr><tr><td align="left">Mean <italic>n</italic>=20</td><td align="left">4.08</td><td align="left">18.42</td><td align="left">2.69</td><td align="left">7.39</td></tr><tr><td align="left">Sd <italic>n</italic>=20</td><td align="left">0.76</td><td align="left">0.80</td><td align="left">0.75</td><td align="left">0.90</td></tr></tbody></table><table-wrap-foot><p>We calculate the Frobenius norm between the estimated and true matrix for elements within the blocks. The estimates for the full matrices are the same for the Pearson and the Corpcor methods by construction, in contrast there is a small increase in the Frobenius norm for the EB method. This is due to the fact that for the Pearson and Corpcor method we set all elements outside the known blocks to zero whilst the EB method sets these elements to zero in the prior matrix, rather than the final estimated matrix</p></table-wrap-foot></table-wrap>
</p>
    <p>As a second test we also generated group assignments using the thresholding method (where the threshold level is known) and compared the EB estimate and the matrices estimated using either Pearson or Corpcor within blocks with elements outside blocks set to zero. The results given in Table <xref rid="Tab2" ref-type="table">2</xref> showed improvement of the EB method over the Corpcor and Pearson estimation methods. In particular, the EB method shows the largest improvement over the other methods when the sample size is smallest (<italic>n</italic>=10). For comparison purposes we also show the results from the EB method using no prior information (EB AIC). For this estimate the threshold level is selected from the data using the AIC metric. For <italic>n</italic>=10 the EB AIC method is still closer to the true matrix than any of the other methods, and has comparable distances for the larger sample sizes.
<table-wrap id="Tab2"><label>Table 2</label><caption><p>Simulation results with known threshold level and groups then estimated from the data</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Pearson</th><th align="left">Corpcor</th><th align="left">EB</th><th align="left">EB AIC</th></tr></thead><tbody><tr><td align="left">Mean <italic>n</italic>=10</td><td align="left">19.27</td><td align="left">23.48</td><td align="left">17.65</td><td align="left">17.86</td></tr><tr><td align="left">Sd <italic>n</italic>=10</td><td align="left">3.42</td><td align="left">3.70</td><td align="left">3.34</td><td align="left">3.14</td></tr><tr><td align="left">Mean <italic>n</italic>=15</td><td align="left">12.30</td><td align="left">17.45</td><td align="left">12.72</td><td align="left">13.89</td></tr><tr><td align="left">Sd <italic>n</italic>=15</td><td align="left">4.34</td><td align="left">2.04</td><td align="left">3.81</td><td align="left">3.21</td></tr><tr><td align="left">Mean <italic>n</italic>=20</td><td align="left">10.52</td><td align="left">17.52</td><td align="left">11.46</td><td align="left">13.19</td></tr><tr><td align="left">Sd <italic>n</italic>=20</td><td align="left">3.96</td><td align="left">1.81</td><td align="left">3.28</td><td align="left">2.81</td></tr></tbody></table><table-wrap-foot><p>We calculate the Frobenius norm between the estimated and true matrix for the full matrix. This shows a particular improvement when sample size is small (<italic>n</italic>=10) for the EB method, as the matrix is closer to the true matrix than for either the Pearson or Corpcor method. We also compare the result when the AIC method is used to estimate the threshold level (EB AIC). This method shows similar improvements when <italic>n</italic>=10 and comparable results to the other methods with the larger sample sizes. Indicating the AIC function has provided a reasonable estimate of the threshold level</p></table-wrap-foot></table-wrap>
</p>
    <p>With simulated data, we also compared the FDR and TPR at a 5% significance level for each of the three methods. The first three columns of Table <xref rid="Tab3" ref-type="table">3</xref> compare the results when the groups are known. In this case there are zero false positives, which occur by definition of the covariance matrix for the Corpcor and Pearson estimates, but are also matched by the EB method. When the groups are not known, but the threshold value is, the next three columns show improved or similar FDR for the EB threshold method, particularly at the smaller sample sizes. However, there is a trade-off as the TPR is lower for EB block when <italic>n</italic>=10, though it is comparable for <italic>n</italic>=15 and improved for <italic>n</italic>=20. We also compare the rates where no prior information was used and the AIC method was used instead to select the threshold (EB AIC). This is shown in the final column, although we expect there may be further errors due to the extra level of estimation, this method again shows close results to the EB threshold method, meaning that at small sample sizes it has improved FDR over other methods but with lower TPR rates that improve as the sample size increases.
<table-wrap id="Tab3"><label>Table 3</label><caption><p>Simulation results with known groups (first three columns) and using a known threshold level to estimate groups or blocks from the data (threshold) and the EB AIC method for when neither the threshold or groups are known</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"/><th align="left">EB</th><th align="left">Corpcor</th><th align="left">Pearson</th><th align="left">EB threshold</th><th align="left">CorpCor threshold</th><th align="left">Pearson threshold</th><th align="left">EB AIC</th></tr></thead><tbody><tr><td align="left"><italic>n</italic>=10</td><td align="left">FDR mean</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.04</td><td align="left">0.26</td><td align="left">0.16</td><td align="left">0.04</td></tr><tr><td align="left"/><td align="left">FDR sd</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.09</td><td align="left">0.12</td><td align="left">0.09</td><td align="left">0.09</td></tr><tr><td align="left"/><td align="left">TPR mean</td><td align="left">0.70</td><td align="left">0.54</td><td align="left">0.66</td><td align="left">0.39</td><td align="left">0.56</td><td align="left">0.66</td><td align="left">0.36</td></tr><tr><td align="left"/><td align="left">TPR sd</td><td align="left">0.21</td><td align="left">0.12</td><td align="left">0.15</td><td align="left">0.21</td><td align="left">0.13</td><td align="left">0.15</td><td align="left">0.21</td></tr><tr><td align="left"><italic>n</italic>=15</td><td align="left">FDR mean</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.09</td><td align="left">0.16</td><td align="left">0.13</td><td align="left">0.06</td></tr><tr><td align="left"/><td align="left">FDR sd</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.11</td><td align="left">0.12</td><td align="left">0.11</td><td align="left">0.11</td></tr><tr><td align="left"/><td align="left">TPR mean</td><td align="left">0.90</td><td align="left">0.32</td><td align="left">0.83</td><td align="left">0.75</td><td align="left">0.59</td><td align="left">0.81</td><td align="left">0.61</td></tr><tr><td align="left"/><td align="left">TPR sd</td><td align="left">0.10</td><td align="left">0.08</td><td align="left">0.10</td><td align="left">0.19</td><td align="left">0.19</td><td align="left">0.12</td><td align="left">0.21</td></tr><tr><td align="left"><italic>n</italic>=20</td><td align="left">FDR mean</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.11</td><td align="left">0.11</td><td align="left">0.10</td><td align="left">0.10</td></tr><tr><td align="left"/><td align="left">FDR sd</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.00</td><td align="left">0.10</td><td align="left">0.10</td><td align="left">0.09</td><td align="left">0.10</td></tr><tr><td align="left"/><td align="left">TPR mean</td><td align="left">0.97</td><td align="left">0.44</td><td align="left">0.90</td><td align="left">0.91</td><td align="left">0.55</td><td align="left">0.88</td><td align="left">0.79</td></tr><tr><td align="left"/><td align="left">TPR sd</td><td align="left">0.04</td><td align="left">0.09</td><td align="left">0.06</td><td align="left">0.09</td><td align="left">0.14</td><td align="left">0.08</td><td align="left">0.11</td></tr></tbody></table><table-wrap-foot><p>We calculate the FDR and TPR for all the variables by comparing them to the true matrix, significance of correlations was determined using a t-test. We see improved or comparable FDR’s for the EB methods across all sample sizes. There is a particular improvement for <italic>n</italic>=10, however, there is a trade-off in terms of lower TPR. However, together we would still expect the EB method to find high value interactions as significant, which is important in designing downstream validation experiments</p></table-wrap-foot></table-wrap>
</p>
    <p>For the <italic>Bacillus subtilis</italic> data, we calculated the FDR rates based on the known transcriptional units for the EB method at 6%, this is an acceptable error level for most experiments that usually aim for a FDR of 5%. By construction with the Pearson and Corpcor method we set elements outside blocks to zero, therefore comparing these to the prior information the FDR for both methods is zero. As a comparison, without imposing the block diagonal structure on these matrices, the Pearson and Corpcor method had an FDR of 20% and 39% respectively. The EB method also resulted in similar or improved true positive rates of 93% compared to 92% and 43% for Pearson and Corpcor respectively.</p>
    <p>One potential downside of setting elements outside known transcriptional units to zero (as we did with the Pearson and Corpcor estimates) is that the inference may miss interactions between transcriptional units supported by the data. By using the t-test on the significance of the correlations from the EB estimate, we identified edges between genes in different transcriptional units at a 5% significance level. As an example we looked at the transcriptional unit of Pur(E,K,B,C,S,Q,L,F,M,N,H,D) that is regulated by PurR, this is shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref> and its genes are coloured pink. This transcriptional unit also has significant connections to the transcriptional unit of pyr(AA,AB,B,C,D,E,F,K) that is also known to be regulated by PurR. Other connected genes in the same transcriptional units include ytr(B,C,D,E,F), regulated by Sigma Factor A and the transcriptional regulator YtrA of the GntR family. The transcriptional unit combining cys(C,H,P), sat, sumT and sir(B,C), also regulated by Sigma Factor A. Hem(B,C,X) that is regulated by PerR and the transcriptional unit containing mrp(A,B,C,D,E,F,G) and two genes yhcG and yhcI in the same operon, neither of these units currently have any known regulators.
<fig id="Fig1"><label>Fig. 1</label><caption><p>This is an example of the EB estimated network containing a transcriptional unit regulated by PurR (pur(E,K,B,C,S,Q,L,F,M,N,H,D)), that are shown in <italic>pink</italic>. As the EB method was the only method used that allowed for connections between transcriptional units, we can see the additional information gained from this by those elements connected to this transcriptional unit. These include the pyr transcriptional unit that is also known to be regulated by PurR</p></caption><graphic xlink:href="12859_2017_1623_Fig1_HTML" id="MO1"/></fig>
</p>
  </sec>
  <sec id="Sec7" sec-type="conclusion">
    <title>Conclusions</title>
    <p>Above we show that the EB method is closer to the blocks within the true matrix, as calculated using the Frobenius norm, for each of the sample sizes when using either the known groupings or those generated from the simulated data (using a known thresholding level). Further using a 5% significance level the EB method has lower false discovery rates than the Pearson covariance matrix and existing Corpcor method.</p>
    <p>The simulation results indicate that we are able to improve the false discovery rates when estimating correlations that can be used in downstream analysis. The EB shows particular improvements when the sample size was as small as ten replicates. This is important as many experiments have comparable levels of replication by necessity.</p>
    <p>Further, controlling the false discovery rate is particularly useful when the network inferences are used to drive experimental hypotheses, as we are interested in identifying the highest possible value links for subsequent laboratory analysis. The EB method was also able to find connections between transcriptional units sharing the same regulator (PurR). This shows how the EB method is flexible, controlling error rates whilst also allowing significance connections between genes or transcriptional units that are supported by the data.</p>
  </sec>
  <sec id="Sec8">
    <title>Availability of data and materials</title>
    <p><bold>Project name</bold>: covEB</p>
    <p><bold>Project home page</bold>: <ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/covEB/">http://bioconductor.org/packages/covEB/</ext-link></p>
    <p><bold>Operating system(s)</bold>: Platform independent</p>
    <p><bold>Programming language</bold>: R</p>
    <p><bold>Other requirements</bold>: R (≥ 3.3)</p>
    <p><bold>License</bold>: GPL-3</p>
    <p><bold>Any restrictions to use by non-academics</bold>: None</p>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>cys(C,H,P)</term>
        <def>
          <p>Cysteine -C,H,P</p>
        </def>
      </def-item>
      <def-item>
        <term>EB</term>
        <def>
          <p>Empirical Bayes</p>
        </def>
      </def-item>
      <def-item>
        <term>FDRs</term>
        <def>
          <p>False discovery rates</p>
        </def>
      </def-item>
      <def-item>
        <term>hem(B,C,X)</term>
        <def>
          <p>Heme -B,C,X’</p>
        </def>
      </def-item>
      <def-item>
        <term>PerR</term>
        <def>
          <p>Transcriptional repressor of the peroxide region</p>
        </def>
      </def-item>
      <def-item>
        <term>PurR</term>
        <def>
          <p>Purine biosynthesis</p>
        </def>
      </def-item>
      <def-item>
        <term>TPR</term>
        <def>
          <p>True positive rate</p>
        </def>
      </def-item>
      <def-item>
        <term>YtrA</term>
        <def>
          <p>Transcriptional regulator YtrA (GntR family)</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Simon Tavaré for his advice and useful comments on the manuscript. The authors are also grateful to the reviewer for their suggestions that greatly improved this manuscript.</p>
    <sec id="d29e2227">
      <title>Funding</title>
      <p>CP is funded by the Engineering and Physical Sciences Research Council (EPSRC) doctoral program.</p>
    </sec>
    <sec id="d29e2232">
      <title>Authors’ contributions</title>
      <p>CP conceived study and carried out the work with advice from JWA and GM. CP, JWA and GM wrote the manuscript. All authors read and approved the final manuscript.</p>
    </sec>
    <sec id="d29e2237">
      <title>Competing interests</title>
      <p>The authors declare that they have no competing interests.</p>
    </sec>
    <sec id="d29e2242">
      <title>Consent for publication</title>
      <p>Not applicable.</p>
    </sec>
    <sec id="d29e2247">
      <title>Ethics approval and consent to participate</title>
      <p>Not applicable.</p>
    </sec>
    <sec id="d29e2252">
      <title>Publisher’s Note</title>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </sec>
  </ack>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schäfer</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Strimmer</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>A shrinkage approach to large-scale covariance matrix estimation and implications for functional genomics</article-title>
        <source>Stat Appl Genet Mol Biol</source>
        <year>2005</year>
        <volume>4</volume>
        <issue>1</issue>
        <fpage>32</fpage>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Danaher</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Witten</surname>
            <given-names>DM</given-names>
          </name>
        </person-group>
        <article-title>The joint graphical lasso for inverse covariance estimation across multiple classes</article-title>
        <source>J R Stat Soc Ser B Stat Methodol</source>
        <year>2014</year>
        <volume>76</volume>
        <issue>2</issue>
        <fpage>373</fpage>
        <lpage>97</lpage>
        <pub-id pub-id-type="doi">10.1111/rssb.12033</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Champion</surname>
            <given-names>CJ</given-names>
          </name>
        </person-group>
        <article-title>Empirical Bayesian estimation of normal variances and covariances</article-title>
        <source>J Multivar Anal</source>
        <year>2003</year>
        <volume>87</volume>
        <issue>1</issue>
        <fpage>60</fpage>
        <lpage>79</lpage>
        <pub-id pub-id-type="doi">10.1016/S0047-259X(02)00076-3</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bickel</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Levina</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Covariance regularization by thresholding</article-title>
        <source>Ann Stat</source>
        <year>2008</year>
        <volume>36</volume>
        <issue>6</issue>
        <fpage>2577</fpage>
        <lpage>604</lpage>
        <pub-id pub-id-type="doi">10.1214/08-AOS600</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Csardi</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Nepusz</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>The igraph software package for complex network research</article-title>
        <source>InterJournal</source>
        <year>2006</year>
        <volume>Complex Systems</volume>
        <fpage>1695</fpage>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hardin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Golan</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>A method for generating realistic correlation matrices</article-title>
        <source>Ann Appl Stat</source>
        <year>2013</year>
        <volume>7</volume>
        <issue>3</issue>
        <fpage>1733</fpage>
        <lpage>62</lpage>
        <pub-id pub-id-type="doi">10.1214/13-AOAS638</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nicolas</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mäder</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Dervyn</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Rochat</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Leduc</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pigeonneau</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Condition-dependent transcriptome reveals high-level regulatory architecture in Bacillus subtilis</article-title>
        <source>Science</source>
        <year>2012</year>
        <volume>335</volume>
        <issue>6072</issue>
        <fpage>1103</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1206848</pub-id>
        <?supplied-pmid 22383849?>
        <pub-id pub-id-type="pmid">22383849</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
