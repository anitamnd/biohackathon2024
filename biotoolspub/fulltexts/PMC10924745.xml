<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Syst Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Syst Biol</journal-id>
    <journal-id journal-id-type="publisher-id">sysbio</journal-id>
    <journal-title-group>
      <journal-title>Systematic Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1063-5157</issn>
    <issn pub-type="epub">1076-836X</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
      <publisher-loc>US</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10924745</article-id>
    <article-id pub-id-type="pmid">37703335</article-id>
    <article-id pub-id-type="doi">10.1093/sysbio/syad059</article-id>
    <article-id pub-id-type="publisher-id">syad059</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Regular Manuscripts</subject>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI00960</subject>
        <subject>AcademicSubjects/SCI01130</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Fast and Accurate Maximum-Likelihood Estimation of Multi-Type Birth–Death Epidemiological Models from Phylogenetic Trees</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2200-7935</contrib-id>
        <name>
          <surname>Zhukova</surname>
          <given-names>Anna</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Bioinformatics and Biostatistics Hub, Institut Pasteur</institution>, <addr-line>Université de Paris, 28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c1" ref-type="corresp"/>
        <!--anna.zhukova@pasteur.fr-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hecht</surname>
          <given-names>Frédéric</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Maday</surname>
          <given-names>Yvon</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut Universitaire de France, 1 rue Descartes</institution>, <addr-line>75231 Paris CEDEX 05</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9412-9723</contrib-id>
        <name>
          <surname>Gascuel</surname>
          <given-names>Olivier</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut de Systématique, Evolution</institution>, <addr-line>Biodiversité (ISYEB) - URM 7205 CNRS, Museum National d’Histoire Naturelle, SU, EPHE &amp; UA, 57 rue Cuvier, CP 50 75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c2" ref-type="corresp"/>
        <!--olivier.gascuel@mnhn.fr-->
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="c1">Correspondence to be sent to: Anna Zhukova, Bioinformatics and Biostatistics Hub, Institut Pasteur, Universit#x00E9; de Paris, 28 rue du docteur Roux 75015 Paris, France; E-mail: <email>anna.zhukova@pasteur.fr</email>;</corresp>
      <corresp id="c2">Olivier Gascuel, Institut de Syst#x00E9;matique, Evolution, Biodiversit#x00E9; (ISYEB UMR7205–CNRS, Mus#x00E9;um National d’Histoire Naturelle, SU, EPHE, UA), 57 rue Cuvier, CP 50 75005 Paris, France; E-mail: <email>olivier.gascuel@mnhn.fr</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-13">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>72</volume>
    <issue>6</issue>
    <fpage>1387</fpage>
    <lpage>1402</lpage>
    <history>
      <date date-type="received">
        <day>02</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>21</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press on behalf of the Society of Systematic Biologists.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution-NonCommercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non.commercial re.use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re.use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="syad059.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>Multi-type birth–death (MTBD) models are phylodynamic analogies of compartmental models in classical epidemiology. They serve to infer such epidemiological parameters as the average number of secondary infections <italic toggle="yes">R<sub>e</sub></italic> and the infectious time from a phylogenetic tree (a genealogy of pathogen sequences). The representatives of this model family focus on various aspects of pathogen epidemics. For instance, the birth–death exposed-infectious (BDEI) model describes the transmission of pathogens featuring an incubation period (when there is a delay between the moment of infection and becoming infectious, as for Ebola and SARS-CoV-2), and permits its estimation along with other parameters. With constantly growing sequencing data, MTBD models should be extremely useful for unravelling information on pathogen epidemics. However, existing implementations of these models in a phylodynamic framework have not yet caught up with the sequencing speed. Computing time and numerical instability issues limit their applicability to medium data sets (≤ 500 samples), while the accuracy of estimations should increase with more data.</p>
      <p>We propose a new highly parallelizable formulation of ordinary differential equations for MTBD models. We also extend them to forests to represent situations when a (sub-)epidemic started from several cases (e.g., multiple introductions to a country). We implemented it for the BDEI model in a maximum likelihood framework using a combination of numerical analysis methods for efficient equation resolution. Our implementation estimates epidemiological parameter values and their confidence intervals in two minutes on a phylogenetic tree of 10,000 samples. Comparison to the existing implementations on simulated data shows that it is not only much faster but also more accurate. An application of our tool to the 2014 Ebola epidemic in Sierra-Leone is also convincing, with very fast calculation and precise estimates. As MTBD models are closely related to Cladogenetic State Speciation and Extinction (ClaSSE)-like models, our findings could also be easily transferred to the macroevolution domain.</p>
    </abstract>
    <kwd-group>
      <kwd>Birth–death model</kwd>
      <kwd>Ebola</kwd>
      <kwd>epidemiology</kwd>
      <kwd>mathematical modelling</kwd>
      <kwd>ordinary differential equations</kwd>
      <kwd>phylodynamics</kwd>
    </kwd-group>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>PRAIRIE</institution>
          </institution-wrap>
        </funding-source>
        <award-id>ANR-19-P3IA-0001</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000781</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>810367</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="16"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>The interaction of epidemiological and evolutionary processes leaves a footprint in pathogen genomes. Phylodynamics leverages this footprint to estimate epidemiological parameters, such as the average number of secondary infections, <inline-formula><mml:math id="m20" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> (<xref rid="CIT0013" ref-type="bibr">Grenfell et al., 2004</xref>; <xref rid="CIT0042" ref-type="bibr">Volz et al., 2013</xref>). It relies on models that bridge the gap between traditional epidemiology and sequence data. Under these models, the parameter inference is drawn from topology and branch lengths of pathogen phylogenetic trees (i.e., genealogies of the pathogen population, approximating the transmission trees) combined with metadata on the samples. This is particularly useful for emerging epidemics, for which not enough data (e.g., incidence curves) might yet be gathered for accurate estimations with classical epidemiological methods. Rapidly growing genetic data coupled with phylodynamic estimations can provide valuable insights at an early stage of the epidemic spread and help prevent it (e.g., accurate estimation of <inline-formula><mml:math id="m21" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> is crucial for adjusting potential non-pharmaceutical interventions, such as lockdowns).</p>
  <p>Phylodynamic models can be classified into two main families: coalescent (<xref rid="CIT0043" ref-type="bibr">Volz et al., 2009</xref>; <xref rid="CIT0007" ref-type="bibr">Drummond et al., 2005</xref>; <xref rid="CIT0029" ref-type="bibr">Pybus et al., 2000</xref>) and birth–death (BD) (<xref rid="CIT0021" ref-type="bibr">Kendall, 1948</xref>; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>, <xref rid="CIT0033" ref-type="bibr">2010</xref>). Coalescent models are often preferred for estimating deterministic population dynamics; however, BD models are better adapted for highly stochastic processes, such as the dynamics of emerging pathogens (<xref rid="CIT0026" ref-type="bibr">Macpherson et al., 2021</xref>). In BD models, births represent pathogen transmission events, while deaths correspond to becoming non-infectious (e.g., due to healing, self-isolation, starting a treatment, or death). Models of the BD family are phylodynamic analogies of compartmental models in classical epidemiology (e.g., SIR, Susceptible-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>). Many extensions of the classical BD model with incomplete sampling (BDS; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) were developed over time, including multi-type birth-death (MTBD) models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). They add a population structure to the classical birth-death process by allowing for different types of individuals. A particularly useful representative of the MTBD family is the birth–death exposed-infectious (BDEI) model (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>). It was designed for pathogens featuring an incubation period between the moments of infection and of becoming infectious, e.g., Ebola and SARS-CoV-2. It is closely related to the SEIR (Susceptible-Exposed-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>) model, widely used in classical epidemiology.</p>
  <p>In MTBD framework, the evolution of a transmission tree is described with a system of master differential equations with respect to global time. The model parameters can be estimated with maximum-likelihood (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) or Bayesian methods (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) by exploring the likelihood (or posterior probability) landscape of trees. However, the closed form solution of the master equations exists only for the initial BDS model (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), while for its extensions (like the BDEI model and MTBD models in general) the master equations for likelihood calculation need to be resolved with numerical methods. The complexity of the master equations and their boundary conditions (which recursively depend on the tree evolution later in time), make their numerical resolution challenging and time consuming (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>).</p>
  <p>The trade-off between the complexity of the biological questions a model can address and the computational speed for its parameter estimation is crucial in phylodynamics. On one hand, denser sampling should improve the accuracy of parameter estimations with complex models. On the other hand, denser sampling leads to larger data sets (thousands of samples), while computational issues often limit model applicability to medium or small ones (hundreds of samples). Calculations become time-consuming and numerically challenging (e.g., due to underflow issues) as tree size increases, resulting in numerical instability and inaccuracy (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). Existing likelihood-based implementations of MTBD models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>; <xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) can handle trees of medium size. In <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) we proposed PhyloDeep, a likelihood-free deep-learning-based solution to the numerical instability issue. While being very efficient and accurate at the prediction stage, this approach however requires a computationally heavy training stage: Millions of trees covering a wide parameter range (where the real data is expected to fall) need to be simulated for training the deep learning predictor.</p>
  <p>In the macroevolution domain, there exist several models that are closely related to the MTBD models. These are the models of the State Speciation and Extinction (SSE) family, in which the births correspond to species specifications and the deaths correspond to extinctions. The main difference is that in epidemiological models sampling happens through time, while in the macroevolution ones it usually occurs at present (at the extant species). Important representatives of the SSE model family include the Binary SSE (BiSSE; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>) model, which introduced two compartments with a possibility of anagenetic state change between them (i.e., along the tree branches), its extension to any number of states (multiple SSE, MuSSE; <xref rid="CIT0010" ref-type="bibr">FitzJohn et al., 2009</xref>), and the cladogenetic SSE (ClaSSE; <xref rid="CIT0012" ref-type="bibr">Goldberg and Igić, 2012</xref>) model, which introduced a possibility of cladogenetic state changes (i.e., when one of the offsprings may have a different state from its parent’s one right after the speciation event). In a recent work, <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>) described a general mathematical framework for efficient likelihood calculation of these types of models, based on the “flow”, and implemented it for the MuSSE-like models but not for the ClaSSE-like ones. However, macroevolutionary analogues of the BDEI and general MTBD models belong to the ClaSSE-like family (as they permit a donor and a recipient to be in different states at the moment of transmission), and an efficient parameter estimator for these models on very large trees is currently lacking.</p>
  <p>In this study, we introduce a likelihood-based approach that intends to improve the accuracy and reduce the likelihood computation time of MTBD models. We propose a new formulation of the MTBD master equations that (i) removes the recursive dependency between child and parent nodes in the tree, hence permitting their parallel computation, and (ii) avoids numerical issues that could arise from very small boundary condition values. Under our approach, the master equations are resolved in parallel for different tree nodes, and then combined into the tree likelihood. In the general MTBD case the combination step is performed in a computationally light recursive way. However, we identified a subclass of MTBD models (including the BDEI model) whose likelihood formulae can be expressed in a non-recursive manner, thus allowing for even simpler calculations. Additionally, we extend the MTBD model-applicability from single trees to forests. Forests could correspond to multiple introductions of the epidemic to the region of interest, or to a health policy change, which led to a new epidemic stage starting with severalcases.</p>
  <p>We applied our findings to the BDEI model and implemented its parameter estimator PyBDEI, employing targeted numerical analysis methods for accurate and fast resolution of its equations. We show the accuracy and speed of PyBDEI on simulated data and compare it to the gold standard Bayesian tool BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep-learning-based tool PhyloDeep (<xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). We find that our approach outperforms the competitors and makes the BDEI model applicable to very large data sets. Lastly, we apply PyBDEI to infer the epidemiological parameters that shaped the Ebola epidemic in Sierra-Leone in 2014. Our estimator is freely available at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">https://github.com/evolbioinfo/bdei</ext-link>.</p>
  <sec id="s1">
    <title>MTBD models and their special case, the BDEI model</title>
    <p>In a pathogen transmission tree <inline-formula><mml:math id="m22" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> (approximated by a time-scaled pathogen phylogeny) the tips represent sampled pathogens, patient state transitions occur along the branches, and bifurcations (i.e., internal nodes) correspond to transmissions (<xref rid="F1" ref-type="fig">Fig. 1</xref>). The tree branch lengths are measured in units of time, where <inline-formula><mml:math id="m23" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> is the time that passed between the beginning of the (sub-)epidemic (<inline-formula><mml:math id="m24" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:math></inline-formula>, corresponding to the time of the root in <xref rid="F1" ref-type="fig">Fig. 1</xref>) and the last sampled tip.</p>
    <fig position="float" id="F1">
      <label>Figure 1</label>
      <caption>
        <p>A transmission tree <inline-formula><mml:math id="m25" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> with <inline-formula><mml:math id="m26" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula> external nodes (i.e., tips, which correspond to sampling events: <inline-formula><mml:math id="m27" display="inline" overflow="scroll"><mml:mrow><mml:mn>0000</mml:mn><mml:mo>,</mml:mo><mml:mn>0001</mml:mn><mml:mo>,</mml:mo><mml:mn>001</mml:mn><mml:mo>,</mml:mo><mml:mn>010</mml:mn><mml:mo>,</mml:mo><mml:mn>011</mml:mn></mml:mrow></mml:math></inline-formula>), <inline-formula><mml:math id="m28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> internal nodes (which correspond to transmissions: <inline-formula><mml:math id="m29" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> (the root) and <inline-formula><mml:math id="m30" display="inline" overflow="scroll"><mml:mrow><mml:mn>00</mml:mn><mml:mo>,</mml:mo><mml:mn>01</mml:mn><mml:mo>,</mml:mo><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula>) and <inline-formula><mml:math id="m31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> branches (plus the root branch of zero length). Time <inline-formula><mml:math id="m32" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> starts at the beginning of the (sub-)epidemic (here represented by the root of the tree, <inline-formula><mml:math id="m33" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) and goes till the last sampled tip. The times of the nodes are shown on the left, e.g., <inline-formula><mml:math id="m34" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mn>0001</mml:mn></mml:msub></mml:math></inline-formula> is the time of tip <inline-formula><mml:math id="m35" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula> (when <inline-formula><mml:math id="m36" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula>’s pathogen was sampled). <inline-formula><mml:math id="m37" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> corresponds to the end of the sampling period (when the most recent tip, <inline-formula><mml:math id="m38" display="inline" overflow="scroll"><mml:mn>0000</mml:mn></mml:math></inline-formula>, was sampled).</p>
      </caption>
      <graphic xlink:href="syad059_fig1" position="float"/>
    </fig>
    <p><bold>The basic BDS model</bold> (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) has only one state: <italic toggle="yes">infectious</italic><inline-formula><mml:math id="m39" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. An individual in state <inline-formula><mml:math id="m40" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit their pathogen to another individual (whose state will be also <inline-formula><mml:math id="m41" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m42" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or stop being infectious at a constant average rate <inline-formula><mml:math id="m43" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (due to treatment start, healing, self-isolation or death). After stopping being infectious, the individual and their pathogen exit the study, at which point the pathogen might get sampled with a probability <inline-formula><mml:math id="m44" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. The sampling is incomplete: an infectious individual may be removed from the system without being sampled (i.e., unobserved in the transmission tree), for example due to healing. The BDS model permits inference of such important epidemiological parameters as</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">effective reproduction number</italic><inline-formula><mml:math id="m45" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mi>λ</mml:mi><mml:mi>ψ</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula>, expected number of individuals directly infected by an infectious case;</p>
      </list-item>
      <list-item>
        <p><italic toggle="yes">infectious time</italic><inline-formula><mml:math id="m46" display="inline" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>ψ</mml:mi></mml:mfrac></mml:math></inline-formula>, time during which an infectious individual can further spread the epidemic.</p>
      </list-item>
    </list>
    <p>The BDS model is asymptotically unidentifiable (see <xref rid="CIT0032" ref-type="bibr">Remark 3.4 by Stadler, 2009</xref>), but to become identifiable it requires one of the parameters to be fixed.</p>
    <p><bold>MTBD models</bold> (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) add population structure by allowing different individual states, transmissions between them and state changes. A general MTBD model with <inline-formula><mml:math id="m47" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> individual states has <inline-formula><mml:math id="m48" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> parameters: An individual in state <inline-formula><mml:math id="m49" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m50" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be removed at a constant average rate <inline-formula><mml:math id="m51" display="inline" overflow="scroll"><mml:msub><mml:mi>ψ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> (with pathogen sampling probability <inline-formula><mml:math id="m52" display="inline" overflow="scroll"><mml:msub><mml:mi>ρ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>), change their state to state <inline-formula><mml:math id="m53" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m54" display="inline" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m55" display="inline" overflow="scroll"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (where <inline-formula><mml:math id="m56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), and transmit their pathogen to an individual in state <inline-formula><mml:math id="m57" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> at a constant average rate <inline-formula><mml:math id="m58" display="inline" overflow="scroll"><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The time between events of the same type is hence modelled with exponential distribution.</p>
    <p><bold>The BDEI model</bold> (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>) (<xref rid="F2" ref-type="fig">Fig. 2</xref>), for example, is a special case of MTBD models that adds a second possible state to the state <inline-formula><mml:math id="m59" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>: <italic toggle="yes">exposed</italic><inline-formula><mml:math id="m60" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>, an individual who is already infected but not yet infectious (cannot transmit), and will eventually become infectious.</p>
    <fig position="float" id="F2">
      <label>Figure 2</label>
      <caption>
        <p>The BDEI model. An individual in exposed state <inline-formula><mml:math id="m61" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> becomes infectious at a rate <inline-formula><mml:math id="m62" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>. An infectious individual <inline-formula><mml:math id="m63" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> transmits the pathogen at a rate <inline-formula><mml:math id="m64" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> (hence creating a new exposed individual <inline-formula><mml:math id="m65" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>), and gets removed at a rate <inline-formula><mml:math id="m66" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (decreasing the number of infectious individuals <inline-formula><mml:math id="m67" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). Upon removal, the individual’s pathogen might be observed with a probability <inline-formula><mml:math id="m68" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. Note, that the BDEI model does not include a susceptible state <inline-formula><mml:math id="m69" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> (as for example SEIR) and makes the assumption that the susceptible population is unlimited (as for example in the beginning of an epidemic, or when the removed individuals could get reinfected).</p>
      </caption>
      <graphic xlink:href="syad059_fig2" position="float"/>
    </fig>
    <p>Under the BDEI model, the only allowed transmissions are from <inline-formula><mml:math id="m70" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m71" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>: At the moment of a transmission, the transmitter is always in state <inline-formula><mml:math id="m72" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, while the recipient is in state <inline-formula><mml:math id="m73" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>. Hence the only non-zero transmission rate is <inline-formula><mml:math id="m74" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, while the other 3 transmission rates are trivial: <inline-formula><mml:math id="m75" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. As we typically do not have the information to distinguish a transmitter from a recipient in a phylogenetic tree (which approximates the transmission tree), we have to consider both possibilities during parameter estimation. For the MTBD models where multiple states can transmit, the number of possibilities increases combinatorially.</p>
    <p>Under the BDEI model, we assume that only the individuals in state <inline-formula><mml:math id="m76" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can exit the study (at rate <inline-formula><mml:math id="m77" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>) and be detected and sampled (with a probability <inline-formula><mml:math id="m78" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:math></inline-formula>): For instance, for many pathogens with an incubation period, the detection is triggered by the onset of symptoms, which in turn happens in the infectious state. Hence all the BDEI tree tips are in state <inline-formula><mml:math id="m79" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, and <inline-formula><mml:math id="m80" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>In addition to <inline-formula><mml:math id="m81" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> and infectious time, the BDEI model permits inference of a third epidemiological parameter:</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">incubation period</italic><inline-formula><mml:math id="m82" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, time between the infection and becoming infectious.</p>
      </list-item>
    </list>
    <p>The incubation period can be expressed via becoming infectious rate <inline-formula><mml:math id="m83" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, corresponding to a state transition from <inline-formula><mml:math id="m84" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m85" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. The inverse state change is not allowed: <inline-formula><mml:math id="m86" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>MTBD models, as extensions of the BDS model, are asymptotically unidentifiable and require one of their parameters to be fixed in order to become identifiable. In practice, it is often the sampling probability, as it may be approximated from epidemiological data (e.g., the proportion of sampled cases among the declared ones) or the infectious time (estimated from observations of infected cases).</p>
    <sec id="s2">
      <title>Master Equations</title>
      <p>In the standard MTBD master equations proposed by <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>), time goes backward from the last sampling event (the most recent tip in the tree) till the beginning of the epidemic. These equations permit calculation of the likelihood density of the data (observed tree) given the model parameter values <inline-formula><mml:math id="m87" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula>. In the general MTBD case, the observed tree, reconstructed from sampled pathogen genomes, differs from the real transmission tree: the states of its internal nodes (corresponding to transmissions) are unknown, we cannot distinguish between the transmitter and the recipient branches, the moments of state changes are also unknown, and due to incomplete sampling some parts of the real transmission tree are unobserved in the reconstructed tree. We therefore need to integrate over all possibilities while calculating the likelihood. The BDEI model is a slightly simpler case as only infectious individuals can transmit or get sampled, hence all the node states are known (<inline-formula><mml:math id="m88" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). For the BDEI model <inline-formula><mml:math id="m89" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>In System (1) we show the MTBD master equations for a model with <inline-formula><mml:math id="m90" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> states (for the BDEI model <inline-formula><mml:math id="m91" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>); however, presenting them with the time <inline-formula><mml:math id="m92" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> going forward from the time of the epidemic start (<inline-formula><mml:math id="m93" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, i.e., tree root) to the time of the last sampled tip (<inline-formula><mml:math id="m94" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>). These equations describe the likelihood density functions (LDFs) <inline-formula><mml:math id="m95" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving as in the reconstructed tree, starting at time <inline-formula><mml:math id="m96" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m97" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (for the BDEI model <inline-formula><mml:math id="m98" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) on a branch connecting a node <inline-formula><mml:math id="m99" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, and till the end of the sampling period. The boundary condition is defined at time <inline-formula><mml:math id="m100" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (i.e., at the node <inline-formula><mml:math id="m101" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>). To account for incomplete sampling, the system also includes the probabilities <inline-formula><mml:math id="m102" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving unobserved till the time <inline-formula><mml:math id="m103" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula>, starting at time <inline-formula><mml:math id="m104" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> instate <inline-formula><mml:math id="m105" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula>.</p>
      <p>From now on, we use the following notation: the id of the root node is <inline-formula><mml:math id="m106" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula>; the ids of its children are <inline-formula><mml:math id="m107" display="inline" overflow="scroll"><mml:mn>00</mml:mn></mml:math></inline-formula> and <inline-formula><mml:math id="m108" display="inline" overflow="scroll"><mml:mn>01</mml:mn></mml:math></inline-formula>; and, by extension, the children of a node <inline-formula><mml:math id="m109" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> (if they exist) have ids <inline-formula><mml:math id="m110" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m111" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (as in <xref rid="F1" ref-type="fig">Fig. 1</xref>). Additionally if the state of a node <inline-formula><mml:math id="m112" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known, then we will name it <inline-formula><mml:math id="m113" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. (For example for the BDEI model <inline-formula><mml:math id="m114" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>I</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.)</p>
      <disp-formula>
        <mml:math id="m1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>L</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, followed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolution from the new state</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>s</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">recipient subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">transmitter subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mn>0</mml:mn>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,      if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>ψ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:msub>
                                <mml:mi>ρ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,  if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is a sampled tip in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:munderover>
                                  <mml:mo>∑</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>k</mml:mi>
                                    <mml:mo>=</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mi>d</mml:mi>
                                </mml:munderover>
                              </mml:mstyle>
                              <mml:msub>
                                <mml:mi>λ</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>k</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>s</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>1</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:mo>+</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mo rspace="0.392em">×</mml:mo>
                              <mml:msubsup>
                                <mml:mi>L</mml:mi>
                                <mml:mi>s</mml:mi>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>i</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mi>i</mml:mi>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is internal, in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>λ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>s</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">next infinitesimal time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, folowed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">unsampled evolution from the new state </mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmission, then unsampled </mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:msub>
                            <mml:mi>ρ</mml:mi>
                            <mml:mi>s</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to stay unsampled over time 0 is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(1)</label>
      </disp-formula>
    </sec>
    <sec id="s3">
      <title>Tree likelihood density</title>
      <p>The likelihood density of a tree <inline-formula><mml:math id="m115" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> for given parameter values <inline-formula><mml:math id="m116" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is then calculated as the LDF at time <inline-formula><mml:math id="m117" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> on the root, whose id is <inline-formula><mml:math id="m118" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> and whose state is <inline-formula><mml:math id="m119" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>L</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mn>0</mml:mn>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mn>0</mml:mn>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:msub>
                  <mml:mi>t</mml:mi>
                  <mml:mn>0</mml:mn>
                </mml:msub>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(2)</label>
      </disp-formula>
      <p>So far, we assumed that the epidemic started directly with the first transmission, however we can relax this assumption. The root of the tree in <xref rid="F1" ref-type="fig">Fig. 1</xref> is placed at <inline-formula><mml:math id="m120" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and does not have a branch (its length is zero). Allowing for a non-zero root branch corresponds to an epidemic start some time before the first transmission (<inline-formula><mml:math id="m121" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>). This implies that the state of the individual represented by the root branch at time <inline-formula><mml:math id="m122" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> is unknown, and all possible states should be considered (Eq. (3)). The same formula applies to cases where the root state is unknown. Assuming that the relative number of individuals in each state is at equilibrium, we can calculate the weight <inline-formula><mml:math id="m123" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> of each possible state <inline-formula><mml:math id="m124" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (derived by <xref rid="CIT0035" ref-type="bibr">Stadler et al., 2013</xref> for the general MTBD case and in Equation (16) for the BDEI model).</p>
      <disp-formula>
        <mml:math id="m3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mi>t</mml:mi>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(3)</label>
      </disp-formula>
      <p>Root’s LDF <italic toggle="yes">recursively</italic> depends on the LDFs of the child node branches via the boundary condition <inline-formula><mml:math id="m125" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> (System 1), and hence is calculated with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>) while climbing the tree from tips till the root. Therefore when parallelized to maximum, it still requires <inline-formula><mml:math id="m126" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> consecutive steps, where <inline-formula><mml:math id="m127" display="inline" overflow="scroll"><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub></mml:math></inline-formula> stands for the height of the tree <inline-formula><mml:math id="m128" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> and depends on its topology: (balanced tree) <inline-formula><mml:math id="m129" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> (ladder-like tree). At each step System (1) needs to be resolved for the corresponding nodes. Moreover, the values of <inline-formula><mml:math id="m130" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at internal nodes and their boundary conditions <inline-formula><mml:math id="m131" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> progressively become smaller as getting deeper in the tree, due to successive additions and multiplications of the LDF values. In trees with many tips, this might lead to numerical underflow, and hence such measures as rescaling need to be taken (<xref rid="CIT0001" ref-type="bibr">Berger and Stamatakis, 2009</xref>; <xref rid="CIT0006" ref-type="bibr">Defour, 2010</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>).</p>
    </sec>
    <sec id="s4">
      <title>Extension to Forests</title>
      <p>In some cases, the assumption that a (sub-)epidemic started with one infected individual might be too constraining. For instance, there could be multiple pathogen introductions to a country of interest (e.g., while in China the SARS-CoV-2 epidemic is commonly assumed to have started with one case, there were multiple independent introductions to other countries (<xref rid="CIT0049" ref-type="bibr">Zhukova et al., 2020</xref>)). This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3b</xref>. Another example is a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage. This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3a</xref>. In Bayesian settings, the situations when the system behaviour (and parameters) change over time, are modeled via skyline methods. <xref rid="CIT0035" ref-type="bibr">Stadler et al. (2013</xref>) developed the one-state Bayesian birth-death skyline plot that divides the time into intervals and allows for different piece-wise constant rates on them. <xref rid="CIT0024" ref-type="bibr">Kühnert et al. (2016</xref>) combined the MTBD model with the skyline to allow for both piece-wise constant rate changes over time and multiple individual types. The skyline approach therefore relies on a single tree, but estimates a separate set of parameters for each time interval, all under the same model. As the number of parameters increases with multiple skyline intervals, MTBD-skyline models therefore require more data and computational time for their accurate estimation, and are more prone to numerical instability than the classical MTBD models.</p>
      <fig position="float" id="F3">
        <label>Figure 3</label>
        <caption>
          <p>Forest <inline-formula><mml:math id="m132" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> representing a (sub-)epidemic that started with multiple infected cases. a) The observed forest trees (<inline-formula><mml:math id="m133" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m134" display="inline" overflow="scroll"><mml:mi>c</mml:mi></mml:math></inline-formula>), corresponding to three different initial infected cases, are shown with solid lines. All the forest trees start at the same time <inline-formula><mml:math id="m135" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). This scenario can correspond to a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage (shown with dashed lines). b) The observed forest trees (<inline-formula><mml:math id="m136" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>), corresponding to two different initial infected cases, are shown with solid lines. They start at different times (<inline-formula><mml:math id="m137" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>). This scenario can correspond to multiple introduction to the same country from other countries (shown with dashed lines).</p>
        </caption>
        <graphic xlink:href="syad059_fig3" position="float"/>
      </fig>
      <p>We propose a simpler alternative, where the (sub-)epidemic starts with multiple individuals (not necessarily at the same time) and leads to a forest <inline-formula><mml:math id="m138" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> of <inline-formula><mml:math id="m139" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed trees: <inline-formula><mml:math id="m140" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>𝒯</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The forest might also include a certain number <inline-formula><mml:math id="m141" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> of unobserved trees, i.e., individuals who were infected at the beginning of the (sub-) epidemic, but whose trees stayed unobserved as none of their tips got sampled. This can be incorporated in the likelihood calculation. Forest likelihood formula hence combines the likelihoods of <inline-formula><mml:math id="m142" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed and <inline-formula><mml:math id="m143" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> hidden trees, and can be represented in logarithmic form (Eq. (4)). Tree likelihood formula is its special case, where <inline-formula><mml:math id="m144" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m145" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <disp-formula>
        <mml:math id="m4" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi>log</mml:mi>
                    <mml:mo lspace="0.167em">⁡</mml:mo>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>ℱ</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Θ</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mi>u</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>u</mml:mi>
                        <mml:mo lspace="0.337em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mi>log</mml:mi>
                          <mml:mo lspace="0.167em">⁡</mml:mo>
                          <mml:msub>
                            <mml:mi>U</mml:mi>
                            <mml:mtext>hidden</mml:mtext>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi mathvariant="normal">Θ</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>j</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>f</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mi>log</mml:mi>
                            <mml:mo lspace="0.167em">⁡</mml:mo>
                            <mml:mi>L</mml:mi>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>𝒯</mml:mi>
                                <mml:mi>j</mml:mi>
                              </mml:msub>
                              <mml:mo fence="false">|</mml:mo>
                              <mml:mi mathvariant="normal">Θ</mml:mi>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>,</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mtext> where </mml:mtext>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mtext>hidden</mml:mtext>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mtext>start</mml:mtext>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(4)</label>
      </disp-formula>
      <p>In Equation (4) we assumed that all the <inline-formula><mml:math id="m146" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:math></inline-formula> sub-epidemics in the forest <inline-formula><mml:math id="m147" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> started at the same time (<inline-formula><mml:math id="m148" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>). This condition can be easily relaxed by replacing zeros with the corresponding tree starting times for observed and unobserved tree evolutions. As in practice we do not know the starting times of the unobserved trees if the sub-epidemics could start at different times, we approximate the unobserved tree starting times with the mean of the observed tree starting times: <inline-formula><mml:math id="m149" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mover><mml:mi>t</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mtext>start</mml:mtext></mml:msub><mml:mo rspace="0.111em">=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>f</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo symmetric="true">/</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mi>U</mml:mi>
                <mml:mrow>
                  <mml:mi>h</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>e</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>n</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi mathvariant="normal">Θ</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>U</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mover>
                      <mml:mi>t</mml:mi>
                      <mml:mo>~</mml:mo>
                    </mml:mover>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(5)</label>
      </disp-formula>
      <p>In our parameter estimator implementation for the BDEI model (see “Efficient parameter and CI estimation for the BDEI model” section), mean can be replaced with median, maximum or minimum of the observed tree times, via a user-specified parameter <inline-formula><mml:math id="m150" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">_</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>c</mml:mi><mml:mo>⁢</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
      <p>For given model parameter values <inline-formula><mml:math id="m151" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> we can estimate the number of hidden trees <inline-formula><mml:math id="m152" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> from the number of observed trees <inline-formula><mml:math id="m153" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> as</p>
      <disp-formula>
        <mml:math id="m6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>u</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mi>f</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>U</mml:mi>
                    <mml:mrow>
                      <mml:mi>h</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>i</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>e</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>n</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mn>1</mml:mn>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mrow>
                        <mml:mi>h</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>e</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>n</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(6)</label>
      </disp-formula>
      <p>Hence, working with forests does not add an additional parameter to likelihood estimation. Moreover, as our simulations show (see “Performance on simulated data and comparison to other tools” section), the value of <inline-formula><mml:math id="m154" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> has little impact on the parameter estimation. However, in some cases (e.g., change in health policy and thus of parameter values), it might be better to estimate <inline-formula><mml:math id="m155" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> based on external data (e.g., number of cases at <inline-formula><mml:math id="m156" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>), rather than assuming that the parameter values predating the trees in the forest were the same as those in the forest. We explore both approaches in the “Application: Ebola in Sierra-Leone” section.</p>
      <p>Using forests permits estimation of the model parameters on the last skyline interval without the restriction that the epidemic followed the same model before this interval (i.e., the top part of the tree, which includes the common ancestors of the forest roots, <xref rid="F3" ref-type="fig">Fig. 3a</xref>). It reduces the number of parameters to those of the last interval. It also permits estimation of parameters for a (sub-)epidemic that started with several individuals but not at the same time (e.g., due to multiple introductions to a country, <xref rid="F3" ref-type="fig">Fig. 3b</xref>).</p>
    </sec>
  </sec>
  <sec id="s5">
    <title>Avoiding numerical problems and parallelizing calculations</title>
    <p>In this section we introduce a way to rewrite LDFs in System (1) that permits (i) obtaining simpler boundary conditions to avoid potential numerical issues during resolution of equations; and (ii) removing recursion and resolving equations for each tree node in parallel, hence speeding up the calculations.</p>
    <p>System (1) has several properties. First of all, its subsystem that defines unobserved probabilities (<inline-formula><mml:math id="m157" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) is self-defined, and hence can be calculated independently from the rest. Secondly, in the subsystem that defines observed LDFs (<inline-formula><mml:math id="m158" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) the right-hand side of the differential equations is a sum where each element is linear with respect to one of the <inline-formula><mml:math id="m159" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m160" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and this sum does not contain any free term. This condition implies that if we rescale <inline-formula><mml:math id="m161" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> by a common factor, the differential equations will not change. Moreover, if the boundary conditions for all states but one are zero (<inline-formula><mml:math id="m162" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow><mml:mo>≠</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mo rspace="0.447em">;</mml:mo><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>), the rescaling will change the boundary condition only for <inline-formula><mml:math id="m163" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The latter is the case when tree node states are known, for example for the BDEI model, under which all nodes are in state <inline-formula><mml:math id="m164" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>.</p>
    <p>Assuming the state of the node <inline-formula><mml:math id="m165" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known (<inline-formula><mml:math id="m166" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>), let us define <inline-formula><mml:math id="m167" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as</p>
    <disp-formula>
      <mml:math id="m7" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>p</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>,</mml:mo>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>i</mml:mi>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>t</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mrow>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>i</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo symmetric="true">/</mml:mo>
              <mml:msubsup>
                <mml:mi>C</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
            </mml:mrow>
          </mml:mrow>
          <mml:mo lspace="0em">.</mml:mo>
        </mml:mrow>
      </mml:math>
      <label>(7)</label>
    </disp-formula>
    <p>Then the differential equations for <inline-formula><mml:math id="m168" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> will only differ from those for <inline-formula><mml:math id="m169" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in the boundary condition for <inline-formula><mml:math id="m170" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, which is <inline-formula><mml:math id="m171" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (the other boundary conditions stay zero). Conceptually, <inline-formula><mml:math id="m172" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a probability of an individual evolving as on an observed branch that connects a node <inline-formula><mml:math id="m173" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, starting at time <inline-formula><mml:math id="m174" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m175" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> on this branch and finishing at time <inline-formula><mml:math id="m176" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in state <inline-formula><mml:math id="m177" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> (without taking into account <inline-formula><mml:math id="m178" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>’s subtree and the event atnode <inline-formula><mml:math id="m179" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>).</p>
    <p>Solving the master equations for <inline-formula><mml:math id="m180" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m181" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> permits us to both (i) remove the recursive dependency between child and parent nodes (during ordinary differential equation (ODE) resolutions); and (ii) avoid numerical issues that could arise from very small values of the boundary condition of <inline-formula><mml:math id="m182" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which is particularly pertinent for large trees. The calculation of <inline-formula><mml:math id="m183" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can be done in parallel for each node <inline-formula><mml:math id="m184" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>. Hence, when parallelized to maximum, the computing time to resolve all these master equations become constant (i.e., the problem is ”embarrassingly parallelizable” following computer science terminology).</p>
    <p>In the general case, where the tree node states are unknown, all the possibilities (<inline-formula><mml:math id="m185" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) for each node <inline-formula><mml:math id="m186" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> can be considered separately and in parallel. Calculating <inline-formula><mml:math id="m187" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all the <inline-formula><mml:math id="m188" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo lspace="0.222em" rspace="0.222em">×</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> possible combinations of <inline-formula><mml:math id="m189" display="inline" overflow="scroll"><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> corresponds to the flow matrix <inline-formula><mml:math id="m190" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">G</mml:mi></mml:math></inline-formula> calculation in the general formulation recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>).</p>
    <p>In the case where all node states are known (e.g., from metadata or due to model itself, as for the BDEI case), using <inline-formula><mml:math id="m191" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m192" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> also permits us to express tree likelihood for model parameters <inline-formula><mml:math id="m193" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> in a non-recursive way, and easily transform it to a logarithmic form (Eq. (8)) (to avoid underflow issues while multiplying small numbers at the likelihood combination step). In Materials and Methods we show its equivalence to the recursive representa-tion (Eq. (2)).</p>
    <disp-formula>
      <mml:math id="m8" display="block" overflow="scroll">
        <mml:mtable>
          <mml:mtr>
            <mml:mtd>
              <mml:mrow>
                <mml:mi>l</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>o</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>g</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>L</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>𝒯</mml:mi>
                    <mml:mo fence="false">|</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
            <mml:mtd>
              <mml:mrow>
                <mml:mi/>
                <mml:mo>=</mml:mo>
                <mml:mrow>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mrow>
                          <mml:mi>t</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>p</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mrow>
                    <mml:mi>l</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>o</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>ρ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> sampling of </mml:mtext>
                      <mml:mi>n</mml:mi>
                      <mml:mtext mathvariant="italic"> tips</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo>+</mml:mo>
                <mml:mstyle>
                  <mml:munder>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                    </mml:mrow>
                  </mml:munder>
                </mml:mstyle>
                <mml:mi>l</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>g</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> transmission events</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mi>events</mml:mi>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo rspace="0.222em">⋅</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mo mathvariant="normal">←</mml:mo>
              <mml:mi>i’s child branch evolutions</mml:mi>
            </mml:mtd>
          </mml:mtr>
        </mml:mtable>
      </mml:math>
      <label>(8)</label>
    </disp-formula>
    <p>For the general case, the combination of different internal node state configurations into tree likelihood formula need to be performed with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>). The likelihood-combining tree traversal starts from the tips and climbs the tree till the root, while calculating a subtree LDF <inline-formula><mml:math id="m194" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for each visited node <inline-formula><mml:math id="m195" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> for each possible state <inline-formula><mml:math id="m196" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>:</p>
    <disp-formula>
      <mml:math id="m9" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:msubsup>
              <mml:mi>L</mml:mi>
              <mml:mi>k</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>i</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:msubsup>
            <mml:mo>⁢</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:msub>
                <mml:mi>t</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
          <mml:mo>=</mml:mo>
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,         if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>ψ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>ρ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,    if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> is a tip whose state can be </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>λ</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>l</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic"> if </mml:mtext>
                        <mml:mi>i</mml:mi>
                        <mml:mtext mathvariant="italic"> is an internal node whose state can be </mml:mtext>
                        <mml:mi>k</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.222em">⋅</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo rspace="0.055em">)</mml:mo>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mi>p</mml:mi>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>s</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mi>i</mml:mi>
                            </mml:msub>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:msubsup>
                            <mml:mi>L</mml:mi>
                            <mml:mi>s</mml:mi>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo rspace="0.055em">)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo rspace="0.222em">⋅</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>l</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>0</mml:mn>
                                </mml:mrow>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.392em">×</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:mrow>
      </mml:math>
      <label>(9)</label>
    </disp-formula>
    <p>Note that unlike the known-tree-node-state likelihood (Eq. (8)), the recursive unknown-tree-node-state likelihood (Eq. (9)) does not allow for an easy logarithmic representation, and hence is prone to underflow issues. Its calculation on large trees therefore requires additional small number rescaling techniques as recently described in (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) and common in phylogenetic inference. However, unlike in the original MTBD representation, master equation resolutions (for <inline-formula><mml:math id="m197" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m198" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be performed independently, in parallel, and avoiding underflow issues for boundary conditions.</p>
    <p>Overall, the PDF reconditioning technique can be applied to any model of the MTBD family, and facilitates its parameter estimation by separating master equation resolution (non-recursive and parallelizable) from likelihood calculation (recursive, but negligible in time cost compared to equation resolution). Recursive likelihood calculation can be performed with a standard pruning algorithm and rescaling techniques to control for potential underflow. For parameter estimation on trees with known node states (e.g., from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled, like the BDEI model), tree likelihood can be calculated with a non-recursive formula in a logarithmic form (Eq. (8)), fully avoiding underflow.</p>
    <sec id="s6">
      <title>Efficient Parameter and CI Estimation for the BDEI Model</title>
      <p>We applied our theoretical findings to implement a fast and efficient parameter estimator for the BDEI model (which we called PyBDEI). It estimates the BDEI model parameters <inline-formula><mml:math id="m199" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> for a forest <inline-formula><mml:math id="m200" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> comprising <inline-formula><mml:math id="m201" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> observed trees in the maximum-likelihood framework, where one of the parameters in <inline-formula><mml:math id="m202" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is fixed (for identifiability reasons). The number of hidden trees <inline-formula><mml:math id="m203" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> can be either given by the user, or estimated from BDEI model parameters (as in Eq. (6)).</p>
      <p>Once the optimal parameter values are found, we calculate their confidence intervals (CIs) using Wilks’ method (<xref rid="CIT0047" ref-type="bibr">Wilks, 1938</xref>). For each non-fixed parameter <inline-formula><mml:math id="m204" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow></mml:math></inline-formula>, we calculate its <inline-formula><mml:math id="m205" display="inline" overflow="scroll"><mml:mrow><mml:mn>95</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>-CI as including the values <inline-formula><mml:math id="m206" display="inline" overflow="scroll"><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:math></inline-formula> such that <inline-formula><mml:math id="m207" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>&gt;</mml:mo><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mtext>opt</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m208" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the value of chi-squared distribution with 1 degree of freedom corresponding to the significance level of <inline-formula><mml:math id="m209" display="inline" overflow="scroll"><mml:mn>0.95</mml:mn></mml:math></inline-formula> (i.e., <inline-formula><mml:math id="m210" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>3.84</mml:mn></mml:mrow></mml:math></inline-formula>). <inline-formula><mml:math id="m211" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:math></inline-formula> corresponds to the maximum-likelihood estimates for the other non-fixed parameters when <inline-formula><mml:math id="m212" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec id="s7">
      <title>Performance on Simulated Data and Comparison to Other Tools</title>
      <p>To assess the performance of our maximum-likelihood estimator PyBDEI, we used the simulated data from <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>), where we generated 100 medium trees with 200–500 tips under the BDEI model, with the parameter values sampled uniformly at random within the following boundaries: incubation period <inline-formula><mml:math id="m213" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.2</mml:mn><mml:mo>,</mml:mo><mml:mn>50</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m214" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>5</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, infectious time <inline-formula><mml:math id="m215" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>10</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, sampling probability <inline-formula><mml:math id="m216" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. These trees were evaluated with the standard Bayesian method BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep learning-based estimator PhyloDeep (detailed configurations are described in Materials and Methods). Additionally 100 large trees (5000–10,000 tips) were generated for the same parameter values, and assessed with PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). PhyloDeep’s maximal pre-trained tree size is 500 tips; however, for larger trees it estimates BDEI parameters by (i) extracting the largest non-intersecting set of subtrees of sizes covered by the pre-trained set (50–500 tips), (ii) estimating parameters on each of the subtrees independently, and (iii) averaging each parameter’s estimate over the subtrees (weighted by subtree sizes).</p>
      <p>To evaluate PyBDEI performance on forests, we additionally generated two types of forests for the large data set. The first type of forests was produced by cutting the oldest (i.e., closest to the root) 25% of each full tree, and keeping the forest of bottom-75% subtrees (in terms of time). We hence obtained 100 forests representing sup-epidemics that all started at the same time (<inline-formula><mml:math id="m217" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, as in <xref rid="F3" ref-type="fig">Fig. 3a</xref>). These forests contained <inline-formula><mml:math id="m218" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>114</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m219" display="inline" overflow="scroll"><mml:mrow><mml:mn>5031</mml:mn><mml:mo>−</mml:mo><mml:mn>9953</mml:mn></mml:mrow></mml:math></inline-formula> tips.</p>
      <p>The second type of forests represented epidemics that started with multiple introductions happening at different times (as in <xref rid="F3" ref-type="fig">Fig. 3b</xref>). To generate them, we used the parameter values <inline-formula><mml:math id="m220" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> corresponding to each tree <inline-formula><mml:math id="m221" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in the large dataset (<inline-formula><mml:math id="m222" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mn>100</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and the times <inline-formula><mml:math id="m223" display="inline" overflow="scroll"><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> between the start of the tree <inline-formula><mml:math id="m224" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> and the time of its last sampled tip. Each (potentially hidden) tree <inline-formula><mml:math id="m225" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in the forest was then generated under parameters <inline-formula><mml:math id="m226" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> till reaching the time <inline-formula><mml:math id="m227" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (drawn uniformly and independently for each tree). Trees were added to the forest till their total number of sampled tips reached at least <inline-formula><mml:math id="m228" display="inline" overflow="scroll"><mml:mn>5000</mml:mn></mml:math></inline-formula>: <inline-formula><mml:math id="m229" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>≥</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math></inline-formula>. The resulting forest <inline-formula><mml:math id="m230" display="inline" overflow="scroll"><mml:msub><mml:mi>ℱ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> included those of the trees <inline-formula><mml:math id="m231" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> that contained at least one sampled tip (i.e., observed trees). These forests contained <inline-formula><mml:math id="m232" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>4582</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m233" display="inline" overflow="scroll"><mml:mrow><mml:mn>5000</mml:mn><mml:mo>−</mml:mo><mml:mn>9897</mml:mn></mml:mrow></mml:math></inline-formula> tips, and <inline-formula><mml:math id="m234" display="inline" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>−</mml:mo><mml:mn>10687</mml:mn></mml:mrow></mml:math></inline-formula> hidden trees.</p>
      <p>We applied PyBDEI to these data sets, and compared the results to those reported for BEAST2 and PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). For the large data set, we applied PyBDEI to full trees, but also to the two types of forests.</p>
      <p>We calculated the relative error (normalized distance between the estimated and the target values: <inline-formula><mml:math id="m235" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>) and the relative bias [(<inline-formula><mml:math id="m236" display="inline" overflow="scroll"><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mo>)</mml:mo><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] for each parameter on each tree/forest. Average relative errors for PyBDEI were <inline-formula><mml:math id="m237" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>13</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the medium trees and <inline-formula><mml:math id="m238" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the large trees (hence decreasing with the data set size, as expected), and well centered around zero (i.e., unbiased), as shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. The relative 95%-CI width [<inline-formula><mml:math id="m239" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>97.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>2.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] also decreased: from <inline-formula><mml:math id="m240" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula> on the medium data set to <inline-formula><mml:math id="m241" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> on the large one. The target values of rates <inline-formula><mml:math id="m242" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m243" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> were within the estimated CIs in correspondingly 92%, 89%, and 98% of cases on the medium data set, and in 95%, 90%, and 95% of cases on the large one.</p>
      <fig position="float" id="F4">
        <label>Figure 4</label>
        <caption>
          <p>Comparison of inference accuracy of different methods on the a) medium (200-500 tips) and b) large (5000–10000 tips) 100-tree data sets. For the medium data set BEAST2 (in orange), PhyloDeep (in green) and our estimator (PyBDEI, in blue) are compared. Two (out of 100) trees of the medium data set on which BEAST2 did not converge after <inline-formula><mml:math id="m244" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps are excluded from the analysis and not shown in the figure. For large trees (<inline-formula><mml:math id="m245" display="inline" overflow="scroll"><mml:mo>&gt;</mml:mo></mml:math></inline-formula>500 tips), PhyloDeep extracts the largest non-intersecting set of subtrees of 50–500 tips, estimates parameters on each of the subtrees independently, and averages each parameter’s estimate over the subtrees (weighted by subtree sizes). We assessed our method on full trees (dark-blue), on forests obtained from the full trees by removing the oldest (closest to the root) 25% (in terms of height) of those trees (forests 1, light-blue), and on forests whose trees were generated using varying sampling period durations (forests 2, pink). We show the swarmplots (colored by method) of relative errors for each test tree/forest and parameter, which are measured as the normalized distance between the median a posteriori estimate by BEAST2 or a point estimate by PhyloDeep/PyBDEI and the real value. Average relative error (and in parentheses average relative bias) are displayed for each parameter and method below their swarmplot. The accuracy of the methods is compared by a paired <italic toggle="yes">z</italic>-test; <inline-formula><mml:math id="m246" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> are shown above each method pair; non-significant <italic toggle="yes">P</italic>-values are not shown.</p>
        </caption>
        <graphic xlink:href="syad059_fig4" position="float"/>
      </fig>
      <p>To assess method accuracy we calculated <italic toggle="yes">P</italic>-values based on two-sided z-tests for each parameter and method pair. On the medium data set for <inline-formula><mml:math id="m247" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> all the methods performed in a comparable way. For the infectious time, <inline-formula><mml:math id="m248" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was at least as accurate as PhyloDeep and more accurate than BEAST2 (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m249" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>). For the incubation period, <inline-formula><mml:math id="m250" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was more accurate than both other methods (see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the large data set BEAST2 was inapplicable due to computation times (57 CPU hours were already required for each medium-sized tree, on average), while PyBDEI was more accurate than PhyloDeep, both using full trees and the forests of the first type (i.e., where all the trees started at the same time, <italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m251" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> for all the parameters, see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the forests of the second type (i.e., trees starting at different times) PyBDEI’s performance was comparable to the one of PhyloDeep for all the parameters. While the mean relative errors were low (<inline-formula><mml:math id="m252" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), PyBDEI performed worse (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m253" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula>) on forests of type 2 than on full trees or forests of type 1 for the infectious period and incubation time. This can be explained by the fact that the starting times of the hidden trees in forests of type 2 were not known and hence needed to be approximated. Moreover, forests of type 2 contained less branches (mean 13155) than forests of type 1 (14896) or full trees (14969), and hence less data for parameter inference.</p>
      <p>For two trees in the medium data set, BEAST2 did not converge after <inline-formula><mml:math id="m254" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> Markov Chain Monte Carlo (MCMC) steps: We did not include these two data points in the analysis. PyBDEI performed well on these two trees: real parameters were within estimated confidence intervals, relative errors for <inline-formula><mml:math id="m255" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>15</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, relative errors for incubation period and infectious time <inline-formula><mml:math id="m256" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>There were also several trees where BEAST2 seems to have converged to a local optimum (estimates with relative errors close to 1). To investigate this hypothesis further, we calculated the tree likelihoods for the real parameter values and those estimated by the three methods (<xref rid="T1" ref-type="table">Table 1</xref>). Indeed, BEAST2 had a likelihood lower than the one obtained on real values for 8% of trees in the medium dataset (8 out of 98 trees on which BEAST2 converged), which corresponds to a local optimum. These 8 data points correspond to the high BEAST2 relative error values (<inline-formula><mml:math id="m257" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for infectious time and <inline-formula><mml:math id="m258" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&gt;</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula> for incubation period) shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. PyBDEI estimates had a higher or equal likelihood than any other method and real values for all the trees of both data sets, suggesting that PyBDEI reaches the global optimum of the likelihood function. On the medium dataset, PyBDEI estimates had an equal likelihood to the ones of BEAST2 for 85% of trees, and a higher likelihood for the other 15% of trees. Comparing to PhyloDeep, PyBDEI estimates had an equal likelihood for 48% of trees, and a higher likelihood for the other 52% of trees. Interestingly, PhyloDeep, while being a likelihood-free method, performed very well on the medium data set: on 81% of trees it estimated parameters with higher or equal likelihood to the one of the real parameters. On the large data set it performed worse in terms of likelihood, estimating parameters with higher or equal likelihood to the one of the real parameters only on 29% of trees. It could however be explained by the fact that PhyloDeep estimated parameters on each of the smaller (50–500 tip) subtrees selected by its subtree picker procedure, and averaged the result, instead of being retrained on large 5000–10000-tip trees.</p>
      <table-wrap position="float" id="T1">
        <label>Table 1</label>
        <caption>
          <p>Tree likelihood comparison between the real parameter values and those estimated by different methods on medium and large data sets.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="center" rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" colspan="2" rowspan="1">Real values</th>
              <th align="left" rowspan="1" colspan="1">BEAST2</th>
              <th align="left" colspan="2" rowspan="1">PhyloDeep</th>
              <th align="left" colspan="2" rowspan="1">PyBDEI</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">real values</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">BEAST2</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PhyloDeep</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PyBDEI</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="T1fn01">
            <p>The value provided in row i, column j indicates the proportion of trees for which the likelihood with parameters estimated by method i is either higher (sub-row &gt;), equal (sub-row <inline-formula><mml:math id="m259" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>) or lower (sub-row &lt;) than the likelihood estimated by method j. For example, 0.847 in the row “BEAST2 <inline-formula><mml:math id="m260" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>” and the column “PyBDEI medium” means that the estimates of BEAST2 had an equal likelihood to those of PyBDEI on 84.7% of trees of the medium data set. According to a sign test, the differences between all the pairs of methods are significant (<inline-formula><mml:math id="m261" display="inline" overflow="scroll"><mml:mi>P</mml:mi></mml:math></inline-formula>-value &lt; 0.01).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>In terms of time, on the medium data set PyBDEI needed on average <inline-formula><mml:math id="m262" display="inline" overflow="scroll"><mml:mn>4</mml:mn></mml:math></inline-formula> seconds per tree on 1 CPU, and converged in 864 iterations (including CI calculation). These times cannot be directly compared to BEAST2 times, as BEAST2 performs a Markov Chain Monte Carlo (MCMC) parameter space exploration instead of looking for the optimum (as PyBDEI does), hence requires many more steps: for <inline-formula><mml:math id="m263" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps it took on average <inline-formula><mml:math id="m264" display="inline" overflow="scroll"><mml:mn>57</mml:mn></mml:math></inline-formula> CPU hours. While the number of MCMC steps could probably be reduced for some runs, for two out of 100 trees it was not sufficient for convergence. Implementing likelihood calculation with our new MTBD formulation and targeted numerical analysis methods, could be helpful in Bayesian context as well: comparing time per iteration (which is roughly time per likelihood calculation), our optimizer required <inline-formula><mml:math id="m265" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds, while BEAST2 took one order of magnitude longer: <inline-formula><mml:math id="m266" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds. This is probably due to the fact that BEAST2 uses the general MTBD model formulation, configured for BDEI, while our implementation uses a BDEI-tailored implementation. Moreover, the ODE reconditioning allows to avoid underflow errors (and rescaling efforts during tree pruning (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>)), which could also play a role. Using several CPUs would allow for an even larger gain (see the results on the large data set below). PhyloDeep took <inline-formula><mml:math id="m267" display="inline" overflow="scroll"><mml:mn>0.2</mml:mn></mml:math></inline-formula> CPU seconds per tree, which is faster than our method’s time but does not include the training time of deep learning predictors (hundreds of hours). To our knowledge, the only other available maximum-likelihood estimator for BDEI is implemented in the TreePar package (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). However, as it suffers from underflow issues for BDEI already on trees of small size, its developers suggest using BEAST2 instead (private communication).</p>
      <p>The average time of PyBDEI convergence on the large data set was 2 min 28 s on 1 CPU, and required 960 iterations. Parallelization on 2 CPUs reduced it to 1 min and 24 s (1.8 times faster). The speed up is close to the number of cores, which shows the efficiency of parallelization of master equation resolution despite the pre- and post-processing steps (tree reading, distribution of jobs between the threads, combining their results), which are always performed on one CPU. This suggests that our estimator will be easily applicable to much largertrees.</p>
      <p>As the BDEI model requires one of the parameters to be fixed in order to become asymptomatically identifiable (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we fixed <inline-formula><mml:math id="m268" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> to the real value, both in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) and in the comparison described above. However, to assess PyBDEI performance with other parameters fixed, we estimated parameters for trees in the large data set under three additional settings: with (1) <inline-formula><mml:math id="m269" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>, (2) <inline-formula><mml:math id="m270" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or (3) <inline-formula><mml:math id="m271" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> fixed to its real value. The results are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S1</ext-link> (online Appendix, available at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>). Average relative errors were <inline-formula><mml:math id="m272" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all parameters when <inline-formula><mml:math id="m273" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> was fixed to the real value, <inline-formula><mml:math id="m274" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m275" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> was fixed, <inline-formula><mml:math id="m276" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m277" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m278" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> were fixed. For estimates of <inline-formula><mml:math id="m279" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> we calculated absolute errors <inline-formula><mml:math id="m280" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> instead of relative ones: their average was <inline-formula><mml:math id="m281" display="inline" overflow="scroll"><mml:mn>0.02</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m282" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m283" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> , and <inline-formula><mml:math id="m284" display="inline" overflow="scroll"><mml:mn>0.01</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m285" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>. Hence, the estimations can be successfully performed with any of the parameters being fixed, but fixing <inline-formula><mml:math id="m286" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m287" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> might be particularly useful. Moreover, these parameters are relatively easy to estimate with real data (e.g., patient observations for <inline-formula><mml:math id="m288" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>, and proportion of sampled cases among the declared ones for <inline-formula><mml:math id="m289" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>).</p>
      <p>Finally, we assessed the impact of the number of hidden trees <inline-formula><mml:math id="m290" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> on the parameter estimation. We estimated parameters with <inline-formula><mml:math id="m291" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m292" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being estimated from model parameters on the two types of forests of the large dataset. For forests of type 2 (where trees started at different times), we additionally compared <inline-formula><mml:math id="m293" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> estimations using minimum, mean, median and maximum of observed tree-specific times (see Eq. (5)). Note that the minimum time and <inline-formula><mml:math id="m294" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> represent the two extremes, as the probability of a tree to stay fully unobserved decreases with time. The relative errors for different parameters are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S2</ext-link> (online Appendix). While estimating <inline-formula><mml:math id="m295" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> using mean, median or maximum times seems to have a slightly smaller relative error for <inline-formula><mml:math id="m296" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> (3% vs. 4% for minimum time or <inline-formula><mml:math id="m297" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), these differences are non-significant. Overall, <inline-formula><mml:math id="m298" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> seems to have little impact on parameter estimation.</p>
      <p>The assessment of our maximum-likelihood estimator on simulated data shows that it opens new possibilities to fast and accurate analyses of extremely large data sets, while being flexible with respect to parameter settings (e.g., the parameter to be fixed). The use of forests makes it possible to focus on a specific part of a large tree, e.g., the most recent period, the subtrees corresponding to a given region or country, or the origin of the epidemic.</p>
    </sec>
  </sec>
  <sec id="s8">
    <title>Application: Ebola in Sierra-Leone</title>
    <p>Using PyBDEI, we analysed the 2014 Ebola epidemic in Sierra-Leone (SLE). Ebola virus features an incubation period (reported by the World Health Organisation (WHO) to take between 2 and 21 d (<xref rid="CIT0046" ref-type="bibr">WHO, 2021</xref>)). Using statistical methods based on time series of reported Ebola cases, the incubation period of Ebola during the 2014 SLE epidemic was previously estimated to be around 10–11 d, the infectious time around 4–5 d, and the reproduction number to decrease from around 2 in the beginning of the epidemic to values close to 1 by late 2014 (due to control measures) (<xref rid="CIT0038" ref-type="bibr">Team, 2014</xref>, <xref rid="CIT0039" ref-type="bibr">2015</xref>; <xref rid="CIT0030" ref-type="bibr">Rivers et al., 2014</xref>; see also <xref rid="CIT0041" ref-type="bibr">Van Kerkhove et al., 2015</xref> for a review).</p>
    <p>Sequence data could improve and complement these estimates. However, the existing phylodynamic study of these parameters was limited by the data set size: <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>) applied the BDEI model to the early spread of Ebola in SLE by analysing 72 Ebola samples from late May to mid June 2014 (sequences from <xref rid="CIT0011" ref-type="bibr">Gire et al. (2014</xref>)). They estimated the expected length of the incubation period to be 4.9 d (median; 95% HPD 2.1–23.2), and the infectious time of 2.6 d (median; 95% HPD 1.2–7).</p>
    <p>To show the power of phylodynamic analyses on larger data sets, we took the 1610-sequence alignment and metadata (sampling times and countries) that were used in the study by <xref rid="CIT0008" ref-type="bibr">Dudas et al. (2017</xref>), who analysed the factors that spread the 2014–2016 Ebola epidemic in West Africa. Using these data, we reconstructed a time-tree of the Ebola epidemic in West Africa, which we then used to extract a forest of time-subtrees representing the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in the data set). This was done to obtain a forest of subtrees with a homogenous health policy (after July 30). The details on the forest reconstruction are given in Materials and Methods. To check for robustness of the estimates, forest reconstruction was performed 10 times, obtaining slightly different forests.</p>
    <p>We estimated the BDEI parameters on these 10 forests. As the BDEI model requires one of the parameters to be fixed for identifiability (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we performed the estimations fixing the sampling probability <inline-formula><mml:math id="m299" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. We estimated <inline-formula><mml:math id="m300" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> as the proportion of cases represented by our forests (853–854) with respect to the total number of SLE Ebola cases reported by the Centers for Disease Control and Prevention (<xref rid="CIT0004" ref-type="bibr">CDC, 2020</xref>) between September 8, 2015 (the closest date to the last SLE sample in our data set, 13683 cases) and July 31, 2014 (the day following the quarantine measures start, 533 cases): <inline-formula><mml:math id="m301" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mrow><mml:mn>854</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>13683</mml:mn><mml:mo>−</mml:mo><mml:mn>533</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≈</mml:mo><mml:mn>0.065</mml:mn></mml:mrow></mml:math></inline-formula> (calculated independently for each forest). To check the robustness of the predictions with respect to this estimation of <inline-formula><mml:math id="m302" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>, we additionally estimated the parameter values assuming 20% more (15780, <inline-formula><mml:math id="m303" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.054</mml:mn></mml:mrow></mml:math></inline-formula>) and 20% less (10520, <inline-formula><mml:math id="m304" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.081</mml:mn></mml:mrow></mml:math></inline-formula>) total cases. For each of these settings we performed three estimations: (1) with the number of unobserved trees being estimated, (2) with it being fixed (via setting the parameter <inline-formula><mml:math id="m305" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>) to the difference between the total number of SLE Ebola cases reported by the CDC on July 31 (533) and the number of trees in the corresponding forest (varying between 143 and 174), and (3) with it being fixed to zero.</p>
    <p>The results for different <inline-formula><mml:math id="m306" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> values, estimated vs. fixed <inline-formula><mml:math id="m307" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>, and different trees were compatible, with intersecting CIs (see <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Table S1</ext-link> in online Appendix). We estimated the <inline-formula><mml:math id="m308" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> value between 0.95 and 1, suggesting a contained epidemic (which is in a good agreement with the quarantine measures and the end of the epidemic in early 2016). The incubation period was estimated between 11 and 14 days. These estimates are fully compatible with the previous studies and allow to narrow down the WHO incubation period estimate (2–21 d, non-specific to the SLE epidemic). We estimated a very short infectious period <inline-formula><mml:math id="m309" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>≈</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> hour. While it does not correspond to the epidemiological estimates (4–5 d) reported in previous studies, it makes sense in the setting we are looking at. The BDEI infectious period corresponds to the time interval between the moment when a person becomes infectious and the moment when they cannot transmit anymore. In the beginning of an epidemic impossibility to transmit is typically defined by biological factors, such as healing or death, and corresponds to the epidemiological definition. However, it could also be influenced by logistic reasons, such as self-isolation. As we are looking at the lock-down period, with strict surveillance, it seems likely that a person who develops symptoms (i.e., passes from the exposed to the infectious state) is immediately detected and isolated, hence having very limited time to transmit on average. Our estimate therefore corresponds to this logistic scenario.</p>
    <p>Note, that comparing the setting with <inline-formula><mml:math id="m310" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being fixed according to the CDC-declared case count to the one when it is estimated, <inline-formula><mml:math id="m311" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> estimates were slightly smaller with <inline-formula><mml:math id="m312" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> fixed (while the CIs intersected). As the number of cases is defined by the epidemic preceding the studied period, <inline-formula><mml:math id="m313" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> might not correspond to the number estimated from the studied period parameters, and it might be more accurate to fix it.</p>
    <p>Overall, the analysis took <inline-formula><mml:math id="m314" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> h for the reconstruction of forests and <inline-formula><mml:math id="m315" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> min per forest for the BDEI parameter estimation.</p>
    <p>This application shows the advantages of PyBDEI not only in terms of calculation times, but also in terms of flexibility of input settings (extracting information from multiple trees).</p>
  </sec>
  <sec id="s9">
    <title>Discussion</title>
    <p>We proposed a highly parallelizable formulation of master equations for MTBD models. We also proposed an extension of the MTBD models to forests, to tackle situations where health policies change over time (providing a flexible alternative to the Bayesian skyline), as well as situations of multiple (not necessarily simultaneous) pathogen introductions to a country of interest. The extension to forests does not introduce additional model parameters; however, when available, it allows to incorporate external data on the number of infectious cases at the start of the forest.</p>
    <p>The peculiar properties of original MTBD equations permitted us to rewrite them in a branch-specific way. This representation features simple boundary conditions with 0 or 1 values, and avoids numerical and underflow problems that could occur in the original system due to very small positive values of the boundary conditions. Even more importantly, our branch-specific representation removes the recursive dependency between the equations corresponding to parent and child tree nodes, and permits their time-consuming resolution to be performed in parallel and independently. The results can then be combined into tree likelihood with a nearly standard pruning algorithm. While the likelihood-combining step in the most general MTBD case remains recursive, its time cost should be negligible in comparison with the recursive master equation resolution used in previous studies. Moreover, for cases where tree node states are known we obtained an explicit likelihood formula, which can be represented in a logarithmic form (Eq. 8) to avoid potential underflow issues during the likelihood-combining step. Tree node states could be known from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled.</p>
    <p>We implemented our theoretical findings in a maximum likelihood parameter and CI estimator for the BDEI model, which is a special case of MTBD models. It is also one of the most useful models in epidemiology, being applicable to Ebola, Sars-CoV 1 and 2, Tuberculosis and other pathogens that feature an incubation period. Under this model tree node states are known, as only the infectious individuals can transmit their pathogen or get detected (after symptom onset). Our parameter estimator, PyBDEI, drastically increases parameter optimization performance, accuracy and speed with respect to previously available estimators.</p>
    <p>We applied our estimator to the 2014 Ebola epidemic in Sierra Leone, after the introduction of quarantine measures. The analysis took <inline-formula><mml:math id="m316" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> h (the majority of which was the tree reconstruction). The obtained estimates of epidemiological parameters are in agreement with what we now know about this epidemic. In particular, the estimate of <inline-formula><mml:math id="m317" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula>, slightly less than 1, suggests a contained epidemic, and indeed Sierra Leone was declared Ebola free in early 2016, a few months after the sampling date (September 7, 2015) of the most recent Ebola sequence in our data set.</p>
    <p>The accuracy of estimations improves with the data set size (as expected, see our simulations). In the world of rapidly growing sequencing data sets (<xref rid="CIT0016" ref-type="bibr">Hodcroft et al., 2021</xref>), we can gain important insights on epidemic spreads by harvesting all available information. PyBDEI is applicable to very large data sets (2 min on a 10000-tip tree), making parameter and CI estimation instantaneous with respect to phylogenetic tree reconstruction times (hours or even days). Our approach could be easily used in a Bayesian setting as well, and could potentially be implemented in BEAST2.</p>
    <p>As the MTBD models are epidemiological analogues of the ClaSSE-like models, our findings could also be easily transferred to the macroevolution domain. Our parallelizable MTBD model formulation is closely related to general matrix-based flow framework recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>). Using this framework, they implemented an efficient parameter estimator <italic toggle="yes">castor</italic> for MuSSE-like models; however, this type of models does not cover cladogenetic changes possible in ClaSSE-like and MTBD models. Moreover, our approach, thanks to forests, allows for multiple introductions, for example, of an epidemic in a given country, or of species from the same clade within a given ecological realm, which could be useful in the macroevolution domain. With rapidly growing genome sequence data, castor and PyBDEI open way to fast and accurate parameter estimations for ecology and epidemiology.</p>
  </sec>
  <sec id="s10">
    <title>Materials and Methods</title>
    <sec id="s11">
      <title>Reconditioned BDEI master equations</title>
      <disp-formula>
        <mml:math id="m10" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>E</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by evolution</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m11" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>I</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the recipient</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the transmitter</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to evolve from I to I over zero time is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> an individual in state </mml:mtext>
                      <mml:mi>E</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot change their state to I</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext>𝑖𝑛𝑠𝑡𝑎𝑛𝑡𝑒𝑛𝑖𝑜𝑢𝑠𝑙𝑦</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>E</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">evolution from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>I</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, then unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>ψ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:mi>ρ</mml:mi>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> the probability to stay unsampled over</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">zero time is 1</mml:mtext>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(10)</label>
      </disp-formula>
    </sec>
    <sec id="s12">
      <title>Equivalence between Equations (2) and (8)</title>
      <p>The likelihood Equation (2) for a tree <inline-formula><mml:math id="m318" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> is recursive, and when using <inline-formula><mml:math id="m319" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m320" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) needs to be resolved with a pruning algorithm while climbing the tree. However, for a tree with known node states, we can transform it into a non-recursive Equation (8) with <inline-formula><mml:math id="m321" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, by alternating <italic toggle="yes">replacement</italic> and <italic toggle="yes">unfolding</italic> steps. A replacement step consists in replacing <inline-formula><mml:math id="m322" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="m323" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo rspace="0.055em">)</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.222em">⋅</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and is followed by an unfolding step. An unfolding step either (if <inline-formula><mml:math id="m324" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is a tip) unfolds <inline-formula><mml:math id="m325" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m326" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and stops; or (if <inline-formula><mml:math id="m327" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is an internal node) unfolds <inline-formula><mml:math id="m328" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m329" display="inline" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and proceeds with replacements. In Equation (11) we show the transformation process.</p>
      <disp-formula>
        <mml:math id="m12" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>𝒯</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mn>0</mml:mn>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext>Equation (2)</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m13" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>p</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mn>0</mml:mn>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo rspace="0.055em">)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mi>(note that</mml:mi>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo mathvariant="italic">⁢</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo mathvariant="normal">(</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                        <mml:mo mathvariant="normal">)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo mathvariant="normal">(</mml:mo>
                      <mml:mn mathvariant="normal">0</mml:mn>
                      <mml:mo mathvariant="normal">)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo mathvariant="normal">=</mml:mo>
                  <mml:mn mathvariant="normal">1</mml:mn>
                </mml:mrow>
                <mml:mi>as the root branch is of length zero)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>L</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mn>0</mml:mn>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> unfolding of </mml:mtext>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>0</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m14" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> (note that </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>00</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> and </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>01</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> do not depend</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mi>on k, and can be put outside of the sum)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>00</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if left child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>x</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>00</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>000</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>x</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>001</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo>+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>000</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>001</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do not</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">depend on </mml:mtext>
                            <mml:mi>x</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">←</mml:mo>
                <mml:mi> unfolding of</mml:mi>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if right child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>y</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>01</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>010</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>y</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>011</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo rspace="0.392em">+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>010</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>011</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">not depend on </mml:mtext>
                            <mml:mi>y</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">← unfolding of</mml:mo>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mi mathvariant="normal">…</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> keep unfolding and replacing</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>j</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext>𝑡𝑖𝑝𝑠</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>ψ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:msub>
                    <mml:mi>ρ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> non-log Eq. (</mml:mtext>
                    <mml:mn>8</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(11)</label>
      </disp-formula>
    </sec>
    <sec id="s13">
      <title>Stationary Distribution</title>
      <p>Stationary state distribution <inline-formula><mml:math id="m330" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Π</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo rspace="0.278em">}</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.558em">:</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the ratios of states <inline-formula><mml:math id="m331" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="m332" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> at a given time <inline-formula><mml:math id="m333" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> after these ratios stopped changing (assuming that this may happen). <inline-formula><mml:math id="m334" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m335" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the number of individuals of type <inline-formula><mml:math id="m336" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m337" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the total number of infected (infectious or not) individuals at time <inline-formula><mml:math id="m338" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula>. Hence, the derivative of the number of individuals of type <inline-formula><mml:math id="m339" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> is proportional to the derivative of the total number of infected individuals:</p>
      <disp-formula>
        <mml:math id="m15" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>N</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(12)</label>
      </disp-formula>
      <p>The number of individuals in state <inline-formula><mml:math id="m340" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> increases due to becoming infectious of individuals in state <inline-formula><mml:math id="m341" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and decreases due to removal, while the number of individuals in state <inline-formula><mml:math id="m342" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> decreases due to becoming infectious and increases due to transmissions:</p>
      <disp-formula>
        <mml:math id="m16" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mrow>
                            <mml:mi>μ</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>N</mml:mi>
                              <mml:mi>E</mml:mi>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mi>t</mml:mi>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mi>λ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(13)</label>
      </disp-formula>
      <p>Becoming infectious changes the corresponding individual’s state but does not affect the total number of infected individuals, transmissions increase the total number, and removal decreases it. Note that only individuals in state <inline-formula><mml:math id="m343" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit or be removed:</p>
      <disp-formula>
        <mml:math id="m17" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mi>λ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mrow>
                  <mml:mi>ψ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(14)</label>
      </disp-formula>
      <p>Combining [13] and [14] we rewrite [12] as a system of multivariate algebraic equations:</p>
      <disp-formula>
        <mml:math id="m18" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                          <mml:mn>2</mml:mn>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>λ</mml:mi>
                            <mml:mo>−</mml:mo>
                            <mml:mi>ψ</mml:mi>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>E</mml:mi>
                        </mml:msub>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(15)</label>
      </disp-formula>
      <p>from which we derive a quadratic equation for <inline-formula><mml:math id="m344" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="m345" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo>−</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and the following stationary distribution:</p>
      <disp-formula>
        <mml:math id="m19" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mrow>
                                <mml:mstyle>
                                  <mml:mfrac>
                                    <mml:mi>μ</mml:mi>
                                    <mml:mrow>
                                      <mml:mi>μ</mml:mi>
                                      <mml:mo>+</mml:mo>
                                      <mml:mi>ψ</mml:mi>
                                    </mml:mrow>
                                  </mml:mfrac>
                                </mml:mstyle>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mtext mathvariant="italic"> if </mml:mtext>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>λ</mml:mi>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mo>=</mml:mo>
                              <mml:mi>ψ</mml:mi>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:mfrac>
                                  <mml:mrow>
                                    <mml:mrow>
                                      <mml:mo>−</mml:mo>
                                      <mml:mrow>
                                        <mml:mo>(</mml:mo>
                                        <mml:mrow>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>+</mml:mo>
                                          <mml:mi>ψ</mml:mi>
                                        </mml:mrow>
                                        <mml:mo>)</mml:mo>
                                      </mml:mrow>
                                    </mml:mrow>
                                    <mml:mo>+</mml:mo>
                                    <mml:msqrt>
                                      <mml:mrow>
                                        <mml:msup>
                                          <mml:mrow>
                                            <mml:mo>(</mml:mo>
                                            <mml:mrow>
                                              <mml:mi>μ</mml:mi>
                                              <mml:mo>−</mml:mo>
                                              <mml:mi>ψ</mml:mi>
                                            </mml:mrow>
                                            <mml:mo>)</mml:mo>
                                          </mml:mrow>
                                          <mml:mn>2</mml:mn>
                                        </mml:msup>
                                        <mml:mo>+</mml:mo>
                                        <mml:mrow>
                                          <mml:mn>4</mml:mn>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>λ</mml:mi>
                                        </mml:mrow>
                                      </mml:mrow>
                                    </mml:msqrt>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mn>2</mml:mn>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mrow>
                                      <mml:mo>(</mml:mo>
                                      <mml:mrow>
                                        <mml:mi>λ</mml:mi>
                                        <mml:mo>−</mml:mo>
                                        <mml:mi>ψ</mml:mi>
                                      </mml:mrow>
                                      <mml:mo>)</mml:mo>
                                    </mml:mrow>
                                  </mml:mrow>
                                </mml:mfrac>
                              </mml:mstyle>
                              <mml:mo>⁢</mml:mo>
                              <mml:mtext mathvariant="italic">, otherwise </mml:mtext>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>E</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo>−</mml:mo>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(16)</label>
      </disp-formula>
    </sec>
    <sec id="s14">
      <title>PyBDEI, Its Code and Data Availability</title>
      <p>Parameter estimation starts with a preprocessing step of reading the input trees, calculating the time <inline-formula><mml:math id="m346" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> at each node <inline-formula><mml:math id="m347" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and memorising the association between each node and its child nodes: <inline-formula><mml:math id="m348" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This step requires one tree traversal, and its time is negligible with respect to the numerical master equation resolution performed in the next steps.</p>
      <p>The estimation then proceeds with a search for the optimal parameter set <inline-formula><mml:math id="m349" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>arg</mml:mi><mml:mo lspace="0.450em">⁢</mml:mo><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>∈</mml:mo><mml:mi>𝒬</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m350" display="inline" overflow="scroll"><mml:mi>𝒬</mml:mi></mml:math></inline-formula> is the set of admissible parameter values. We use the globally-convergent method of moving asymptotes (<xref rid="CIT0037" ref-type="bibr">Svanberg, 2002</xref>) for the optimization. At each optimization step <inline-formula><mml:math id="m351" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> the corresponding likelihood <inline-formula><mml:math id="m352" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> needs to be calculated, which implies calculating <inline-formula><mml:math id="m353" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> for each of the <inline-formula><mml:math id="m354" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed internal nodes of <inline-formula><mml:math id="m355" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula>, and combining them as in the forest likelihood formula (Eq. (4)). The reconditioned version of BDEI master equations (10) for the parameter values <inline-formula><mml:math id="m356" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> can be resolved in parallel for each of the <inline-formula><mml:math id="m357" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed forest nodes (differing in the times <inline-formula><mml:math id="m358" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> of their boundary conditions).</p>
      <p>To resolve these master equations numerically, we start by separating the self-defined subsystem for the unknowns <inline-formula><mml:math id="m359" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m360" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from the rest of System (10), and calculate it independently. Taking into account the fact that the equations in System (10) are either linear (for <inline-formula><mml:math id="m361" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m362" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) or quadratic (for <inline-formula><mml:math id="m363" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m364" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) the use of an implicit scheme is simple. We chose implicit schemes with an automatic computation of the time step, such that the error is less than a given tolerance. In our implementation, we used the implicit Euler scheme (<xref rid="CIT0003" ref-type="bibr">Butcher, 2016</xref>) for solving the linear equations and the Crank-Nicolson implicit scheme (<xref rid="CIT0005" ref-type="bibr">Crank and Nicolson, 1947</xref>) for the non-linear ones. This permits us to avoid possible stability time restrictions and only choose the time steps for precision.</p>
      <p>The core of our estimator is implemented in C++ and uses the NLopt library (Johnson, <xref rid="CIT0020" ref-type="bibr"> </xref>) for non-linear optimization. The parallelization is achieved with the C++ <monospace>thread_pool</monospace> tools (<xref rid="CIT0048" ref-type="bibr">Williams, 2012</xref>). To facilitate the use of our estimator in Python and perform additional validation of input trees, we wrapped the core estimator into a Python 3 library PyBDEI. PyBDEI uses ETE 3 framework for tree manipulation (<xref rid="CIT0017" ref-type="bibr">Huerta-Cepas et al., 2016</xref>) and NumPy package for array operations (<xref rid="CIT0014" ref-type="bibr">Harris et al., 2020</xref>).</p>
      <p>Our estimator is available as a command-line program and a Python 3 library via PyPi (<ext-link xlink:href="https://pypi.org/project/pybdei" ext-link-type="uri">https://pypi.org/project/pybdei</ext-link>), and via Docker/Singularity (<ext-link xlink:href="https://hub.docker.com/r/evolbioinfo/bdei" ext-link-type="uri">https://hub.docker.com/r/evolbioinfo/bdei</ext-link>). Its source code, the simulated and real data used for its assessment, as well as the Snakemake (<xref rid="CIT0022" ref-type="bibr">Köster and Rahmann, 2012</xref>) data analysis pipelines, and the installation and usage documentation are available on GitHub at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">github.com/evolbioinfo/bdei</ext-link>. The simulated data are also available from the Dryad Digital Repository: <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
    </sec>
    <sec id="s15">
      <title>BEAST2 and PhyloDeep Settings</title>
      <p>BEAST2 (v2.6.2 with package bdmm (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) v1.0) was configured for <inline-formula><mml:math id="m365" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps with the following priors: <inline-formula><mml:math id="m366" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.02</mml:mn><mml:mo>,</mml:mo><mml:mn>5.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m367" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>1.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m368" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value (<inline-formula><mml:math id="m369" display="inline" overflow="scroll"><mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, different for different trees). The initial values in the MCMC were set to the medians used in the PhyloDeep training set, namely <inline-formula><mml:math id="m370" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>2.51</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m371" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.55</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m372" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. The tree was fixed to the real tree. For each tree, the Effective Sample Size (ESS) on all parameters was evaluated, and the median of a posteriori values was reported, corresponding to all recorded steps (i.e., actual MCMC steps spaced by 1000) past the 10% burn-in. The simulations for which BEAST2 did not converge after <inline-formula><mml:math id="m373" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps (2%) were discarded from the analyses.</p>
      <p>PhyloDeep (v0.2.51) was run with <inline-formula><mml:math id="m374" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value and Convolutional Neural Networks trained on the Compact Bijective Ladderized Vector full tree representation (CNN-CBLV).</p>
      <p>The visualizations of the analyses of simulated data were performed with the Python 3 library seaborn (v0.11.2) (<xref rid="CIT0045" ref-type="bibr">Waskom, 2021</xref>; <xref rid="CIT0018" ref-type="bibr">Hunter, 2007</xref>).</p>
    </sec>
    <sec id="s16">
      <title>Tree Reconstruction for Ebola SLE Epidemic Analysis</title>
      <p>We reconstructed a maximum-likelihood phylogeny of 1610 tips for the Ebola samples from (<xref rid="CIT0008" ref-type="bibr">Dudas et al., 2017</xref>) with RAxML-NG (v1.0.2, GTR+G4+FO+IO) (<xref rid="CIT0023" ref-type="bibr">Kozlov et al., 2019</xref>), and rooted it based on sampling dates using LSD2 (v2.4.1) (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>). As Ebola’s mutation rate is slower than its transmission rate, the initial phylogeny contained <inline-formula><mml:math id="m375" display="inline" overflow="scroll"><mml:mn>242</mml:mn></mml:math></inline-formula> polytomies (i.e., multiple transmissions, which happened faster than the virus acquired a mutation, hence making them undistinguishable in the phylogeny). The BDEI model, on the other hand, assumes a binary tree. We therefore resolved these polytomies randomly (10 times, to check for robustness of the estimates) using a coalescent approach.</p>
      <p>We then dated each of the 10 trees with LSD2 (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>) (v2.4.1: <ext-link xlink:href="https://github.com/tothuhien/lsd2/tree/v.2.4.1" ext-link-type="uri">https://github.com/tothuhien/lsd2/tree/v.2.4.1</ext-link>, under strict molecular clock with outlier removal) using tip sampling dates, and reconstructed the ancestral characters for country with PastML (<xref rid="CIT0019" ref-type="bibr">Ishikawa et al., 2019</xref>) (v1.9.40, MPPA+F81).</p>
      <p>Lastly, we extracted 10 SLE forests from these trees to represent the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in our dataset) by (1) cutting each tree on July 30, 2014 to remove the more ancient part (with a different health policy); (2) among the July-31-on trees, picking those whose root’s predicted character state for country was SLE (light-green branches at the level of July 31, 2014 in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link> in online Appendix); (3) removing the non-SLE subtrees (indicated with other colors in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link>) from the selected July-31-on SLE trees to focus on the epidemic within the country, without further reintroductions.</p>
      <p>The reconstruction took 1 hour for the phylogeny, 10 minutes for tree dating, and 1 minute for country ancestral character prediction.</p>
    </sec>
  </sec>
</body>
<back>
  <ack id="a1">
    <title>Acknowledgments</title>
    <p>The authors thank Dr Jakub Voznica for valuable discussions.</p>
  </ack>
  <sec id="s17">
    <title>Supplementary Material</title>
    <p>Supplementary material, including data files and the online-only appendix, can be found in the Dryad data repository at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
  </sec>
  <sec id="s18">
    <title>Funding</title>
    <p>O.G. was supported by PRAIRIE (ANR-19-P3IA-0001). Y.M. was supported by European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation program (grant agreement No 810367), project EMC2.</p>
  </sec>
  <sec id="s19">
    <title>Author Contributions</title>
    <p>O.G. initiated the project and provided critical assessment of project progression; A.Z. conceived the new master equation representation, extension to forests, applications to Ebola and simulated data, and coordinated the project; F.H. and Y.M. conceived the numerical approach for fast and efficient parameter optimization; F.H. implemented the numerical approach; A.Z. wrote the manuscript with input from all the authors; all authors discussed the intermediate and final results.</p>
  </sec>
  <ref-list id="r1">
    <title>REFERENCES</title>
    <ref id="CIT0001">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2009</year>. <article-title>Accuracy and Performance of single versus double precision arithmetics for maximum likelihood phylogeny reconstruction Lecture Notes in Computer Science (including subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics)</article-title>. <volume>6068 LNCS</volume>:<fpage>270</fpage>–<lpage>279</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0002">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bouckaert</surname><given-names>R.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Duchêne</surname><given-names>S.</given-names></string-name>, <string-name><surname>Fourment</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gavryushkina</surname><given-names>A.</given-names></string-name>, <string-name><surname>Heled</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jones</surname><given-names>G.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Matschiner</surname><given-names>M.</given-names></string-name>, <string-name><surname>Mendes</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Müller</surname><given-names>N.F.</given-names></string-name>, <string-name><surname>Ogilvie</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Du Plessis</surname><given-names>L.</given-names></string-name>, <string-name><surname>Popinga</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.</given-names></string-name>, <string-name><surname>Siveroni</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C.H.</given-names></string-name>, <string-name><surname>Xie</surname><given-names>D.</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>C.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2019</year>. <article-title>BEAST 25: An advanced software platform for Bayesian evolutionary analysis</article-title>. <source>PLoS Comput. Biol</source>. <volume>15</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0003">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Butcher</surname><given-names>JC.</given-names></string-name></person-group><year>2016</year>. <source>Numerical methods for ordinary differential equations</source>. <edition>3 ed</edition>. <publisher-name>Wiley</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0004">
      <mixed-citation publication-type="other"><collab>CDC</collab>. <year>2020</year>. <comment>2014–2016 Ebola outbreak in West Africa: case counts</comment>. Available from <ext-link xlink:href="https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html" ext-link-type="uri">https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0005">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Crank</surname><given-names>J.</given-names></string-name>, <string-name><surname>Nicolson</surname><given-names>P.</given-names></string-name></person-group><year>1947</year>. <article-title>A practical method for numerical evaluation of solutions of partial differential equations of the heat-conduction type</article-title>. <source>Math. Proc. Camb. Philos. Soc</source>. <volume>43</volume>:<fpage>50</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0006">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Defour</surname><given-names>D.</given-names></string-name></person-group><year>2010</year>. <comment>Accuracy of a maximum likelihood phylogeny reconstruction. Technical report. LIRMM</comment>. Available from <ext-link xlink:href="https://hal.archives-ouvertes.fr/hal-00726409" ext-link-type="uri">https://hal.archives-ouvertes.fr/hal-00726409</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0007">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Shapiro</surname><given-names>B.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name></person-group><year>2005</year>. <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>. <source>Mol. Biol. Evol</source>. <volume>22</volume>:<fpage>1185</fpage>–<lpage>1192</lpage>.<pub-id pub-id-type="pmid">15703244</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0008">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Carvalho</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Tatem</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Baele</surname><given-names>G.</given-names></string-name>, <string-name><surname>Faria</surname><given-names>N.R.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Ladner</surname><given-names>J.T.</given-names></string-name>, <string-name><surname>Arias</surname><given-names>A.</given-names></string-name>, <string-name><surname>Asogun</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bielejec</surname><given-names>F.</given-names></string-name>, <string-name><surname>Caddy</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M.</given-names></string-name>, <string-name><surname>D’Ambrozio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Dellicour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Di Caro</surname><given-names>A.</given-names></string-name>, <string-name><surname>Diclaro</surname><given-names>J.W.</given-names></string-name>, <string-name><surname>Duraffour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Elmore</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Fakoli</surname><given-names>L.S.</given-names></string-name>, <string-name><surname>Faye</surname><given-names>O.</given-names></string-name>, <string-name><surname>Gilbert</surname><given-names>M.L.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gire</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gladden-Young</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Haagmans</surname><given-names>B.L.</given-names></string-name>, <string-name><surname>Hiscox</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Jah</surname><given-names>U.</given-names></string-name>, <string-name><surname>Kugelman</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Liu</surname><given-names>D.</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Mate</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matthews</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Meredith</surname><given-names>L.W.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Quick</surname><given-names>J.</given-names></string-name>, <string-name><surname>Pas</surname><given-names>S.D.</given-names></string-name>, <string-name><surname>Phan</surname><given-names>M.V.T.</given-names></string-name>, <string-name><surname>Pollakis</surname><given-names>G.</given-names></string-name>, <string-name><surname>Reusken</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Sanchez-Lockhart</surname><given-names>M.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Schieffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Simon-Loriere</surname><given-names>E.</given-names></string-name>, <string-name><surname>Smits</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Stoecker</surname><given-names>K.</given-names></string-name>, <string-name><surname>Thorne</surname><given-names>L.</given-names></string-name>, <string-name><surname>Tobin</surname><given-names>E.A.</given-names></string-name>, <string-name><surname>Vandi</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Watson</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>West</surname><given-names>K.</given-names></string-name>, <string-name><surname>Whitmer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wiley</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wölfel</surname><given-names>R.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Blyden</surname><given-names>S.O.</given-names></string-name>, <string-name><surname>Bolay</surname><given-names>F.</given-names></string-name>, <string-name><surname>Carroll</surname><given-names>M.W.</given-names></string-name>, <string-name><surname>Dahn</surname><given-names>B.</given-names></string-name>, <string-name><surname>Diallo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Formenty</surname><given-names>P.</given-names></string-name>, <string-name><surname>Fraser</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gao</surname><given-names>G.F.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Goodfellow</surname><given-names>I.</given-names></string-name>, <string-name><surname>Günther</surname><given-names>S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.T.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Keïta</surname><given-names>S.</given-names></string-name>, <string-name><surname>Kellam</surname><given-names>P.</given-names></string-name>, <string-name><surname>Koopmans</surname><given-names>M.P.G.</given-names></string-name>, <string-name><surname>Kuhn</surname><given-names>J.H.</given-names></string-name>, <string-name><surname>Loman</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Magassouba</surname><given-names>N.</given-names></string-name>, <string-name><surname>Naidoo</surname><given-names>D.</given-names></string-name>, <string-name><surname>Nichol</surname><given-names>S.T.</given-names></string-name>, <string-name><surname>Nyenswah</surname><given-names>T.</given-names></string-name>, <string-name><surname>Palacios</surname><given-names>G.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name>, <string-name><surname>Sall</surname><given-names>A.</given-names></string-name>, <string-name><surname>Ströher</surname><given-names>U.</given-names></string-name>, <string-name><surname>Wurie</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Lemey</surname><given-names>P.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name></person-group><year>2017</year>. <article-title>Virus genomes reveal factors that spread and sustained the Ebola epidemic</article-title>. <source>Nature</source>. <volume>544</volume>:<fpage>309</fpage>–<lpage>315</lpage>.<pub-id pub-id-type="pmid">28405027</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0009">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Felsenstein</surname><given-names>J.</given-names></string-name></person-group><year>1973</year>. <article-title>Maximum likelihood and minimum-steps methods for estimating evolutionary trees from data on discrete characters</article-title>. <source>Syst. Biol</source>. <volume>22</volume>:<fpage>240</fpage>–<lpage>249</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0010">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>FitzJohn</surname><given-names>R.G.</given-names></string-name>, <string-name><surname>Maddison</surname><given-names>W.P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.P.</given-names></string-name></person-group><year>2009</year>. <article-title>Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies</article-title>. <source>Syst. Biol</source>. <volume>58</volume>:<fpage>595</fpage>–<lpage>611</lpage>.<pub-id pub-id-type="pmid">20525612</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0011">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gire</surname><given-names>S.K.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>L.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>S.</given-names></string-name>, <string-name><surname>Momoh</surname><given-names>M.</given-names></string-name>, <string-name><surname>Fullah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Moses</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gladden</surname><given-names>A.D.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X.</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>P.P.</given-names></string-name>, <string-name><surname>Nekoui</surname><given-names>M.</given-names></string-name>, <string-name><surname>Colubri</surname><given-names>A.</given-names></string-name>, <string-name><surname>Coomber</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Fonnie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Moigboi</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gbakie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kamara</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Tucker</surname><given-names>V.</given-names></string-name>, <string-name><surname>Konuwa</surname><given-names>E.</given-names></string-name>, <string-name><surname>Saffa</surname><given-names>S.</given-names></string-name>, <string-name><surname>Sellu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>A.A.</given-names></string-name>, <string-name><surname>Kovoma</surname><given-names>A.</given-names></string-name>, <string-name><surname>Koninga</surname><given-names>J.</given-names></string-name>, <string-name><surname>Mustapha</surname><given-names>I.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>K.</given-names></string-name>, <string-name><surname>Foday</surname><given-names>M.</given-names></string-name>, <string-name><surname>Yillah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>F.</given-names></string-name>, <string-name><surname>Robert</surname><given-names>W.</given-names></string-name>, <string-name><surname>Massally</surname><given-names>J.L.</given-names></string-name>, <string-name><surname>Chapman</surname><given-names>S.B.</given-names></string-name>, <string-name><surname>Bochicchio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>C.</given-names></string-name>, <string-name><surname>Nusbaum</surname><given-names>C.</given-names></string-name>, <string-name><surname>Young</surname><given-names>S.</given-names></string-name>, <string-name><surname>Birren</surname><given-names>B.W.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Scheiffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Lander</surname><given-names>E.S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Khan</surname><given-names>S.H.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name></person-group><year>2014</year>. <article-title>Genomic surveillance elucidates Ebola virus origin and transmission during the 2014 outbreak</article-title>. <source>Science</source>. <volume>345</volume>:<fpage>1369</fpage>–<lpage>1372</lpage>.<pub-id pub-id-type="pmid">25214632</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0012">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goldberg</surname><given-names>E.E.</given-names></string-name>, <string-name><surname>Igić</surname><given-names>B.</given-names></string-name></person-group><year>2012</year>. <article-title>Tempo and mode in plant breeding system evolution</article-title>. <source>Evolution</source><volume>66</volume>:<fpage>3701</fpage>–<lpage>3709</lpage>. _eprint: <ext-link xlink:href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x" ext-link-type="uri">https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x</ext-link><pub-id pub-id-type="pmid">23206129</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0013">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grenfell</surname><given-names>B.T.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Gog</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Wood</surname><given-names>J.L.N.</given-names></string-name>, <string-name><surname>Daly</surname><given-names>J.M.</given-names></string-name>, <string-name><surname>Mumford</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name></person-group><year>2004</year>. <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source>. <volume>303</volume>(<issue>5656</issue>):<fpage>327</fpage>–<lpage>332</lpage>.<pub-id pub-id-type="pmid">14726583</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0014">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Harris</surname><given-names>C.R.</given-names></string-name>, <string-name><surname>Millman</surname><given-names>K.J.</given-names></string-name>, <string-name><surname>van der Walt</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>Gommers</surname><given-names>R.</given-names></string-name>, <string-name><surname>Virtanen</surname><given-names>P.</given-names></string-name>, <string-name><surname>Cournapeau</surname><given-names>D.</given-names></string-name>, <string-name><surname>Wieser</surname><given-names>E.</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>J.</given-names></string-name>, <string-name><surname>Berg</surname><given-names>S.</given-names></string-name>, <string-name><surname>Smith</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Kern</surname><given-names>R.</given-names></string-name>, <string-name><surname>Picus</surname><given-names>M.</given-names></string-name>, <string-name><surname>Hoyer</surname><given-names>S.</given-names></string-name>, <string-name><surname>van Kerkwijk</surname><given-names>M.H.</given-names></string-name>, <string-name><surname>Brett</surname><given-names>M.</given-names></string-name>, <string-name><surname>Haldane</surname><given-names>A.</given-names></string-name>, <string-name><surname>del Río</surname><given-names>J.F.</given-names></string-name>, <string-name><surname>Wiebe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Peterson</surname><given-names>P.</given-names></string-name>, <string-name><surname>Gérard-Marchant</surname><given-names>P.</given-names></string-name>, <string-name><surname>Sheppard</surname><given-names>K.</given-names></string-name>, <string-name><surname>Reddy</surname><given-names>T.</given-names></string-name>, <string-name><surname>Weckesser</surname><given-names>W.</given-names></string-name>, <string-name><surname>Abbasi</surname><given-names>H.</given-names></string-name>, <string-name><surname>Gohlke</surname><given-names>C.</given-names></string-name>, <string-name><surname>Oliphant</surname><given-names>T.E.</given-names></string-name></person-group><year>2020</year>. <article-title>Array programming with NumPy</article-title>. <source>Nature</source>. <volume>585</volume>:<fpage>357</fpage>–<lpage>362</lpage>.<pub-id pub-id-type="pmid">32939066</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0015">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hethcote</surname><given-names>H.W.</given-names></string-name></person-group><year>2000</year>. <article-title>The mathematics of infectious diseases</article-title>. <source>SIAM Rev</source>. <volume>42</volume>:<fpage>599</fpage>–<lpage>653</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0016">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hodcroft</surname><given-names>E.B.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Lanfear</surname><given-names>R.</given-names></string-name>, <string-name><surname>MacCannell</surname><given-names>D.R.</given-names></string-name>, <string-name><surname>Minh</surname><given-names>B.Q.</given-names></string-name>, <string-name><surname>Schmidt</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goldman</surname><given-names>N.</given-names></string-name>, <string-name><surname>Dessimoz</surname><given-names>C.</given-names></string-name></person-group><year>2021</year>. <article-title>Want to track pandemic variants faster? Fix the bioinformatics bottleneck</article-title>. <source>Nature</source>. <volume>591</volume>:<fpage>30</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">33649511</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0017">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huerta-Cepas</surname><given-names>J.</given-names></string-name>, <string-name><surname>Serra</surname><given-names>F.</given-names></string-name>, <string-name><surname>Bork</surname><given-names>P.</given-names></string-name></person-group><year>2016</year>. <article-title>ETE 3: reconstruction, analysis, and visualization of phylogenomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>1635</fpage>–<lpage>1638</lpage>.<pub-id pub-id-type="pmid">26921390</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0018">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hunter</surname><given-names>J.D.</given-names></string-name></person-group><year>2007</year>. <article-title>Matplotlib: A 2D graphics environment</article-title>. <source>Comput. Sci. Eng</source>. <volume>9</volume>:<fpage>90</fpage>–<lpage>95</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0019">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ishikawa</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Iwasaki</surname><given-names>W.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2019</year>. <article-title>A fast likelihood method to reconstruct and visualize ancestral scenarios</article-title>. <source>Mol. Biol. Evol</source>. <volume>36</volume>:<fpage>2069</fpage>–<lpage>2085</lpage>.<pub-id pub-id-type="pmid">31127303</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0020">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>SG.</given-names></string-name></person-group><comment>The nlopt nonlinear-optimization package</comment>. Accessed: <comment>2021-01-26</comment>.</mixed-citation>
    </ref>
    <ref id="CIT0021">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kendall</surname><given-names>D.G.</given-names></string-name></person-group><year>1948</year>. <article-title>On the generalized “birth-and-death” process</article-title>. <source>Ann. Math</source>. <volume>19</volume>:<fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0022">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><year>2012</year>. <article-title>Snakemake-a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source>. <volume>28</volume>:<fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0023">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>A.M.</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D.</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>B.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2019</year>. <article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source>. <volume>35</volume>:<fpage>4453</fpage>–<lpage>4455</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0024">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2016</year>. <article-title>Phylodynamics with migration: a computational framework to quantify population structure from genomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>2102</fpage>–<lpage>2116</lpage>.<pub-id pub-id-type="pmid">27189573</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0025">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2020</year>. <article-title>A general and efficient algorithm for the likelihood of diversification and discrete-trait evolutionary models</article-title>. <source>Syst. Biol</source>. <volume>69</volume>:<fpage>545</fpage>–<lpage>556</lpage>.<pub-id pub-id-type="pmid">31432088</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0026">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Macpherson</surname><given-names>A.</given-names></string-name>, <string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Mclaughlin</surname><given-names>A.</given-names></string-name>, <string-name><surname>Joy</surname><given-names>J.B.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2021</year>. <article-title>Unifying phylogenetic birth-death models in epidemiology and macroevolution</article-title>. <source>Syst. Biol</source>. <volume>71</volume>(<issue>1</issue>):<fpage>172</fpage>–<lpage>189</lpage>.<pub-id pub-id-type="pmid">34165577</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0027">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maddison</surname><given-names>W.</given-names></string-name>, <string-name><surname>Midford</surname><given-names>P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.</given-names></string-name></person-group><year>2007</year>. <article-title>Estimating a binary character’s effect on speciation and extinction</article-title>. <source>Syst. Biol</source>. <volume>56</volume>:<fpage>701</fpage>–<lpage>710</lpage>.<pub-id pub-id-type="pmid">17849325</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0028">
      <mixed-citation publication-type="other"><collab>News24</collab>. <year>2014</year>. <comment>Sierra leone, liberia deploy troops for ebola</comment>. Available from <ext-link xlink:href="https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804" ext-link-type="uri">https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0029">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Harvey</surname><given-names>P.H.</given-names></string-name></person-group><year>2000</year>. <article-title>An integrated framework for the inference of viral population history from reconstructed genealogies</article-title>. <source>Genetics</source>. <volume>155</volume>:<fpage>1429</fpage>–<lpage>1437</lpage>.<pub-id pub-id-type="pmid">10880500</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0030">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rivers</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Lofgren</surname><given-names>E.T.</given-names></string-name>, <string-name><surname>Marathe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Eubank</surname><given-names>S.</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>B.L.</given-names></string-name></person-group><year>2014</year>. <article-title>Modeling the impact of interventions on an epidemic of Ebola in Sierra Leone and Liberia</article-title>. <source>PLoS Curr</source>. <volume>6</volume>:ecurrents.outbreaks.4d41fe5d6c05e9df30ddce33c66d084c.</mixed-citation>
    </ref>
    <ref id="CIT0031">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scire</surname><given-names>J.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2022</year>. <article-title>Robust phylodynamic analysis of genetic sequencing data from structured populations</article-title>. <source>Viruses</source>. <volume>14</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0032">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2009</year>. <article-title>On incomplete sampling under birth-death models and connections to the sampling-based coalescent</article-title>. <source>J. Theor. Biol</source>. <volume>261</volume>:<fpage>58</fpage>–<lpage>66</lpage>.<pub-id pub-id-type="pmid">19631666</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0033">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2010</year>. <article-title>Sampling-through-time in birth-death trees</article-title>. <source>J. Theor. Biol</source>. <volume>267</volume>:<fpage>396</fpage>–<lpage>404</lpage>.<pub-id pub-id-type="pmid">20851708</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0034">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name></person-group><year>2013</year>. <article-title>Uncovering epidemiological dynamics in heterogeneous host populations using phylogenetic methods</article-title>. <source>Philos. Trans. R. Soc. B Biol. Sci</source><volume>368</volume>:<fpage>20120198</fpage>–<lpage>20120198</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0035">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2013</year>. <article-title>Birth-death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>110</volume>:<fpage>228</fpage>–<lpage>233</lpage>.<pub-id pub-id-type="pmid">23248286</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0036">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>du Plessis</surname><given-names>L.</given-names></string-name></person-group><year>2014</year>. <article-title>Insights into the early epidemic spread of Ebola in Sierra Leone provided by viral sequence data</article-title>. <source>PLoS Curr</source><volume>6</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0037">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Svanberg</surname><given-names>K.</given-names></string-name></person-group><year>2002</year>. <article-title>A class of globally convergent optimization methods based on conservative convex separable approximations</article-title>. <source>SIAM J. Optimiz</source><volume>12</volume>:<fpage>555</fpage>–<lpage>573</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0038">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2014</year>. <article-title>Ebola Virus disease in West Africa — the first 9 months of the epidemic and forward projections</article-title>. <source>N. Engl. J. Med</source>. <volume>371</volume>:<fpage>1481</fpage>–<lpage>1495</lpage>.<pub-id pub-id-type="pmid">25244186</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0039">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2015</year>. <article-title>West African ebola epidemic after one year — slowing but not yet under control</article-title>. <source>N. Engl. J. Med</source>. <volume>372</volume>:<fpage>584</fpage>–<lpage>587</lpage>.<pub-id pub-id-type="pmid">25539446</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0040">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>To</surname><given-names>T.H.</given-names></string-name>, <string-name><surname>Jung</surname><given-names>M.</given-names></string-name>, <string-name><surname>Lycett</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2016</year>. <article-title>Fast dating using least-squares criteria and algorithms</article-title>. <source>Syst. Biol</source>. <volume>65</volume>:<fpage>82</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">26424727</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0041">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Van Kerkhove</surname><given-names>M.D.</given-names></string-name>, <string-name><surname>Bento</surname><given-names>A.I.</given-names></string-name>, <string-name><surname>Mills</surname><given-names>H.L.</given-names></string-name>, <string-name><surname>Ferguson</surname><given-names>N.M.</given-names></string-name>, <string-name><surname>Donnelly</surname><given-names>C.A.</given-names></string-name></person-group><year>2015</year>. <article-title>A review of epidemiological parameters from Ebola outbreaks to inform early public health decision-making</article-title>. <source>Sci. Data</source>. <volume>2</volume>:<fpage>1</fpage>–<lpage>10</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0042">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Koelle</surname><given-names>K.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bhattacharya</surname><given-names>T.</given-names></string-name>, <string-name><surname>Delaporte</surname><given-names>E.</given-names></string-name></person-group><year>2013</year>. <article-title>Viral phylodynamics</article-title>. <source>PLoS Comput. Biol</source>. <volume>9</volume>:<fpage>e1002947</fpage>.<pub-id pub-id-type="pmid">23555203</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0043">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Kosakovsky Pond</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Ward</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Leigh Brown</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Frost</surname><given-names>S.D.</given-names></string-name></person-group><year>2009</year>. <article-title>Phylodynamics of infectious disease epidemics</article-title>. <source>Genetics</source>. <volume>183</volume>:<fpage>1421</fpage>–<lpage>1430</lpage>.<pub-id pub-id-type="pmid">19797047</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0044">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Boskova</surname><given-names>V.</given-names></string-name>, <string-name><surname>Saulnier</surname><given-names>E.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Moslonka-Lefebvre</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2022</year>. <article-title>Deep learning from phylogenies to uncover the transmission dynamics of epidemics</article-title>. <source>Nat. Commun</source>. <volume>13</volume>:<fpage>3896</fpage>.<pub-id pub-id-type="pmid">35794110</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0045">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Waskom</surname><given-names>M.L.</given-names></string-name></person-group><year>2021</year>. <article-title>seaborn: statistical data visualization</article-title>. <source>J. Open Source Software</source>. <volume>6</volume>:<fpage>3021</fpage>.</mixed-citation>
    </ref>
    <ref id="CIT0046">
      <mixed-citation publication-type="other"><collab>WHO</collab>. <year>2021</year>. <comment>Ebola virus disease [fact sheet]</comment>. Available from <ext-link xlink:href="https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease" ext-link-type="uri">https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0047">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wilks</surname><given-names>S.S.</given-names></string-name></person-group><year>1938</year>. <article-title>The large-sample distribution of the likelihood ratio for testing composite hypotheses</article-title>. <source>Ann. Math. Stat</source>. <volume>9</volume>:<fpage>60</fpage>–<lpage>62</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0048">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Williams</surname><given-names>A.</given-names></string-name></person-group><year>2012</year>. <source>C++ concurrency in action: practical multithreading</source>, <edition>1</edition>st ed. <publisher-loc>Shelter Island, NY</publisher-loc>: <publisher-name>Manning Publications</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0049">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Blassel</surname><given-names>L.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>M.</given-names></string-name>, <string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2020</year>. <article-title>Origin, evolution and global spread of SARS-CoV-2</article-title>. <source>C.R. Biol</source>. <volume>344</volume>(<issue>1</issue>):<fpage>57</fpage>–<lpage>75</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Syst Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Syst Biol</journal-id>
    <journal-id journal-id-type="publisher-id">sysbio</journal-id>
    <journal-title-group>
      <journal-title>Systematic Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1063-5157</issn>
    <issn pub-type="epub">1076-836X</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
      <publisher-loc>US</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10924745</article-id>
    <article-id pub-id-type="pmid">37703335</article-id>
    <article-id pub-id-type="doi">10.1093/sysbio/syad059</article-id>
    <article-id pub-id-type="publisher-id">syad059</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Regular Manuscripts</subject>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI00960</subject>
        <subject>AcademicSubjects/SCI01130</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Fast and Accurate Maximum-Likelihood Estimation of Multi-Type Birth–Death Epidemiological Models from Phylogenetic Trees</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2200-7935</contrib-id>
        <name>
          <surname>Zhukova</surname>
          <given-names>Anna</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Bioinformatics and Biostatistics Hub, Institut Pasteur</institution>, <addr-line>Université de Paris, 28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c1" ref-type="corresp"/>
        <!--anna.zhukova@pasteur.fr-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hecht</surname>
          <given-names>Frédéric</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Maday</surname>
          <given-names>Yvon</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut Universitaire de France, 1 rue Descartes</institution>, <addr-line>75231 Paris CEDEX 05</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9412-9723</contrib-id>
        <name>
          <surname>Gascuel</surname>
          <given-names>Olivier</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut de Systématique, Evolution</institution>, <addr-line>Biodiversité (ISYEB) - URM 7205 CNRS, Museum National d’Histoire Naturelle, SU, EPHE &amp; UA, 57 rue Cuvier, CP 50 75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c2" ref-type="corresp"/>
        <!--olivier.gascuel@mnhn.fr-->
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="c1">Correspondence to be sent to: Anna Zhukova, Bioinformatics and Biostatistics Hub, Institut Pasteur, Universit#x00E9; de Paris, 28 rue du docteur Roux 75015 Paris, France; E-mail: <email>anna.zhukova@pasteur.fr</email>;</corresp>
      <corresp id="c2">Olivier Gascuel, Institut de Syst#x00E9;matique, Evolution, Biodiversit#x00E9; (ISYEB UMR7205–CNRS, Mus#x00E9;um National d’Histoire Naturelle, SU, EPHE, UA), 57 rue Cuvier, CP 50 75005 Paris, France; E-mail: <email>olivier.gascuel@mnhn.fr</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-13">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>72</volume>
    <issue>6</issue>
    <fpage>1387</fpage>
    <lpage>1402</lpage>
    <history>
      <date date-type="received">
        <day>02</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>21</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press on behalf of the Society of Systematic Biologists.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution-NonCommercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non.commercial re.use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re.use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="syad059.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>Multi-type birth–death (MTBD) models are phylodynamic analogies of compartmental models in classical epidemiology. They serve to infer such epidemiological parameters as the average number of secondary infections <italic toggle="yes">R<sub>e</sub></italic> and the infectious time from a phylogenetic tree (a genealogy of pathogen sequences). The representatives of this model family focus on various aspects of pathogen epidemics. For instance, the birth–death exposed-infectious (BDEI) model describes the transmission of pathogens featuring an incubation period (when there is a delay between the moment of infection and becoming infectious, as for Ebola and SARS-CoV-2), and permits its estimation along with other parameters. With constantly growing sequencing data, MTBD models should be extremely useful for unravelling information on pathogen epidemics. However, existing implementations of these models in a phylodynamic framework have not yet caught up with the sequencing speed. Computing time and numerical instability issues limit their applicability to medium data sets (≤ 500 samples), while the accuracy of estimations should increase with more data.</p>
      <p>We propose a new highly parallelizable formulation of ordinary differential equations for MTBD models. We also extend them to forests to represent situations when a (sub-)epidemic started from several cases (e.g., multiple introductions to a country). We implemented it for the BDEI model in a maximum likelihood framework using a combination of numerical analysis methods for efficient equation resolution. Our implementation estimates epidemiological parameter values and their confidence intervals in two minutes on a phylogenetic tree of 10,000 samples. Comparison to the existing implementations on simulated data shows that it is not only much faster but also more accurate. An application of our tool to the 2014 Ebola epidemic in Sierra-Leone is also convincing, with very fast calculation and precise estimates. As MTBD models are closely related to Cladogenetic State Speciation and Extinction (ClaSSE)-like models, our findings could also be easily transferred to the macroevolution domain.</p>
    </abstract>
    <kwd-group>
      <kwd>Birth–death model</kwd>
      <kwd>Ebola</kwd>
      <kwd>epidemiology</kwd>
      <kwd>mathematical modelling</kwd>
      <kwd>ordinary differential equations</kwd>
      <kwd>phylodynamics</kwd>
    </kwd-group>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>PRAIRIE</institution>
          </institution-wrap>
        </funding-source>
        <award-id>ANR-19-P3IA-0001</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000781</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>810367</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="16"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>The interaction of epidemiological and evolutionary processes leaves a footprint in pathogen genomes. Phylodynamics leverages this footprint to estimate epidemiological parameters, such as the average number of secondary infections, <inline-formula><mml:math id="m20" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> (<xref rid="CIT0013" ref-type="bibr">Grenfell et al., 2004</xref>; <xref rid="CIT0042" ref-type="bibr">Volz et al., 2013</xref>). It relies on models that bridge the gap between traditional epidemiology and sequence data. Under these models, the parameter inference is drawn from topology and branch lengths of pathogen phylogenetic trees (i.e., genealogies of the pathogen population, approximating the transmission trees) combined with metadata on the samples. This is particularly useful for emerging epidemics, for which not enough data (e.g., incidence curves) might yet be gathered for accurate estimations with classical epidemiological methods. Rapidly growing genetic data coupled with phylodynamic estimations can provide valuable insights at an early stage of the epidemic spread and help prevent it (e.g., accurate estimation of <inline-formula><mml:math id="m21" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> is crucial for adjusting potential non-pharmaceutical interventions, such as lockdowns).</p>
  <p>Phylodynamic models can be classified into two main families: coalescent (<xref rid="CIT0043" ref-type="bibr">Volz et al., 2009</xref>; <xref rid="CIT0007" ref-type="bibr">Drummond et al., 2005</xref>; <xref rid="CIT0029" ref-type="bibr">Pybus et al., 2000</xref>) and birth–death (BD) (<xref rid="CIT0021" ref-type="bibr">Kendall, 1948</xref>; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>, <xref rid="CIT0033" ref-type="bibr">2010</xref>). Coalescent models are often preferred for estimating deterministic population dynamics; however, BD models are better adapted for highly stochastic processes, such as the dynamics of emerging pathogens (<xref rid="CIT0026" ref-type="bibr">Macpherson et al., 2021</xref>). In BD models, births represent pathogen transmission events, while deaths correspond to becoming non-infectious (e.g., due to healing, self-isolation, starting a treatment, or death). Models of the BD family are phylodynamic analogies of compartmental models in classical epidemiology (e.g., SIR, Susceptible-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>). Many extensions of the classical BD model with incomplete sampling (BDS; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) were developed over time, including multi-type birth-death (MTBD) models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). They add a population structure to the classical birth-death process by allowing for different types of individuals. A particularly useful representative of the MTBD family is the birth–death exposed-infectious (BDEI) model (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>). It was designed for pathogens featuring an incubation period between the moments of infection and of becoming infectious, e.g., Ebola and SARS-CoV-2. It is closely related to the SEIR (Susceptible-Exposed-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>) model, widely used in classical epidemiology.</p>
  <p>In MTBD framework, the evolution of a transmission tree is described with a system of master differential equations with respect to global time. The model parameters can be estimated with maximum-likelihood (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) or Bayesian methods (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) by exploring the likelihood (or posterior probability) landscape of trees. However, the closed form solution of the master equations exists only for the initial BDS model (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), while for its extensions (like the BDEI model and MTBD models in general) the master equations for likelihood calculation need to be resolved with numerical methods. The complexity of the master equations and their boundary conditions (which recursively depend on the tree evolution later in time), make their numerical resolution challenging and time consuming (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>).</p>
  <p>The trade-off between the complexity of the biological questions a model can address and the computational speed for its parameter estimation is crucial in phylodynamics. On one hand, denser sampling should improve the accuracy of parameter estimations with complex models. On the other hand, denser sampling leads to larger data sets (thousands of samples), while computational issues often limit model applicability to medium or small ones (hundreds of samples). Calculations become time-consuming and numerically challenging (e.g., due to underflow issues) as tree size increases, resulting in numerical instability and inaccuracy (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). Existing likelihood-based implementations of MTBD models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>; <xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) can handle trees of medium size. In <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) we proposed PhyloDeep, a likelihood-free deep-learning-based solution to the numerical instability issue. While being very efficient and accurate at the prediction stage, this approach however requires a computationally heavy training stage: Millions of trees covering a wide parameter range (where the real data is expected to fall) need to be simulated for training the deep learning predictor.</p>
  <p>In the macroevolution domain, there exist several models that are closely related to the MTBD models. These are the models of the State Speciation and Extinction (SSE) family, in which the births correspond to species specifications and the deaths correspond to extinctions. The main difference is that in epidemiological models sampling happens through time, while in the macroevolution ones it usually occurs at present (at the extant species). Important representatives of the SSE model family include the Binary SSE (BiSSE; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>) model, which introduced two compartments with a possibility of anagenetic state change between them (i.e., along the tree branches), its extension to any number of states (multiple SSE, MuSSE; <xref rid="CIT0010" ref-type="bibr">FitzJohn et al., 2009</xref>), and the cladogenetic SSE (ClaSSE; <xref rid="CIT0012" ref-type="bibr">Goldberg and Igić, 2012</xref>) model, which introduced a possibility of cladogenetic state changes (i.e., when one of the offsprings may have a different state from its parent’s one right after the speciation event). In a recent work, <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>) described a general mathematical framework for efficient likelihood calculation of these types of models, based on the “flow”, and implemented it for the MuSSE-like models but not for the ClaSSE-like ones. However, macroevolutionary analogues of the BDEI and general MTBD models belong to the ClaSSE-like family (as they permit a donor and a recipient to be in different states at the moment of transmission), and an efficient parameter estimator for these models on very large trees is currently lacking.</p>
  <p>In this study, we introduce a likelihood-based approach that intends to improve the accuracy and reduce the likelihood computation time of MTBD models. We propose a new formulation of the MTBD master equations that (i) removes the recursive dependency between child and parent nodes in the tree, hence permitting their parallel computation, and (ii) avoids numerical issues that could arise from very small boundary condition values. Under our approach, the master equations are resolved in parallel for different tree nodes, and then combined into the tree likelihood. In the general MTBD case the combination step is performed in a computationally light recursive way. However, we identified a subclass of MTBD models (including the BDEI model) whose likelihood formulae can be expressed in a non-recursive manner, thus allowing for even simpler calculations. Additionally, we extend the MTBD model-applicability from single trees to forests. Forests could correspond to multiple introductions of the epidemic to the region of interest, or to a health policy change, which led to a new epidemic stage starting with severalcases.</p>
  <p>We applied our findings to the BDEI model and implemented its parameter estimator PyBDEI, employing targeted numerical analysis methods for accurate and fast resolution of its equations. We show the accuracy and speed of PyBDEI on simulated data and compare it to the gold standard Bayesian tool BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep-learning-based tool PhyloDeep (<xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). We find that our approach outperforms the competitors and makes the BDEI model applicable to very large data sets. Lastly, we apply PyBDEI to infer the epidemiological parameters that shaped the Ebola epidemic in Sierra-Leone in 2014. Our estimator is freely available at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">https://github.com/evolbioinfo/bdei</ext-link>.</p>
  <sec id="s1">
    <title>MTBD models and their special case, the BDEI model</title>
    <p>In a pathogen transmission tree <inline-formula><mml:math id="m22" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> (approximated by a time-scaled pathogen phylogeny) the tips represent sampled pathogens, patient state transitions occur along the branches, and bifurcations (i.e., internal nodes) correspond to transmissions (<xref rid="F1" ref-type="fig">Fig. 1</xref>). The tree branch lengths are measured in units of time, where <inline-formula><mml:math id="m23" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> is the time that passed between the beginning of the (sub-)epidemic (<inline-formula><mml:math id="m24" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:math></inline-formula>, corresponding to the time of the root in <xref rid="F1" ref-type="fig">Fig. 1</xref>) and the last sampled tip.</p>
    <fig position="float" id="F1">
      <label>Figure 1</label>
      <caption>
        <p>A transmission tree <inline-formula><mml:math id="m25" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> with <inline-formula><mml:math id="m26" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula> external nodes (i.e., tips, which correspond to sampling events: <inline-formula><mml:math id="m27" display="inline" overflow="scroll"><mml:mrow><mml:mn>0000</mml:mn><mml:mo>,</mml:mo><mml:mn>0001</mml:mn><mml:mo>,</mml:mo><mml:mn>001</mml:mn><mml:mo>,</mml:mo><mml:mn>010</mml:mn><mml:mo>,</mml:mo><mml:mn>011</mml:mn></mml:mrow></mml:math></inline-formula>), <inline-formula><mml:math id="m28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> internal nodes (which correspond to transmissions: <inline-formula><mml:math id="m29" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> (the root) and <inline-formula><mml:math id="m30" display="inline" overflow="scroll"><mml:mrow><mml:mn>00</mml:mn><mml:mo>,</mml:mo><mml:mn>01</mml:mn><mml:mo>,</mml:mo><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula>) and <inline-formula><mml:math id="m31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> branches (plus the root branch of zero length). Time <inline-formula><mml:math id="m32" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> starts at the beginning of the (sub-)epidemic (here represented by the root of the tree, <inline-formula><mml:math id="m33" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) and goes till the last sampled tip. The times of the nodes are shown on the left, e.g., <inline-formula><mml:math id="m34" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mn>0001</mml:mn></mml:msub></mml:math></inline-formula> is the time of tip <inline-formula><mml:math id="m35" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula> (when <inline-formula><mml:math id="m36" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula>’s pathogen was sampled). <inline-formula><mml:math id="m37" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> corresponds to the end of the sampling period (when the most recent tip, <inline-formula><mml:math id="m38" display="inline" overflow="scroll"><mml:mn>0000</mml:mn></mml:math></inline-formula>, was sampled).</p>
      </caption>
      <graphic xlink:href="syad059_fig1" position="float"/>
    </fig>
    <p><bold>The basic BDS model</bold> (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) has only one state: <italic toggle="yes">infectious</italic><inline-formula><mml:math id="m39" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. An individual in state <inline-formula><mml:math id="m40" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit their pathogen to another individual (whose state will be also <inline-formula><mml:math id="m41" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m42" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or stop being infectious at a constant average rate <inline-formula><mml:math id="m43" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (due to treatment start, healing, self-isolation or death). After stopping being infectious, the individual and their pathogen exit the study, at which point the pathogen might get sampled with a probability <inline-formula><mml:math id="m44" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. The sampling is incomplete: an infectious individual may be removed from the system without being sampled (i.e., unobserved in the transmission tree), for example due to healing. The BDS model permits inference of such important epidemiological parameters as</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">effective reproduction number</italic><inline-formula><mml:math id="m45" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mi>λ</mml:mi><mml:mi>ψ</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula>, expected number of individuals directly infected by an infectious case;</p>
      </list-item>
      <list-item>
        <p><italic toggle="yes">infectious time</italic><inline-formula><mml:math id="m46" display="inline" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>ψ</mml:mi></mml:mfrac></mml:math></inline-formula>, time during which an infectious individual can further spread the epidemic.</p>
      </list-item>
    </list>
    <p>The BDS model is asymptotically unidentifiable (see <xref rid="CIT0032" ref-type="bibr">Remark 3.4 by Stadler, 2009</xref>), but to become identifiable it requires one of the parameters to be fixed.</p>
    <p><bold>MTBD models</bold> (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) add population structure by allowing different individual states, transmissions between them and state changes. A general MTBD model with <inline-formula><mml:math id="m47" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> individual states has <inline-formula><mml:math id="m48" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> parameters: An individual in state <inline-formula><mml:math id="m49" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m50" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be removed at a constant average rate <inline-formula><mml:math id="m51" display="inline" overflow="scroll"><mml:msub><mml:mi>ψ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> (with pathogen sampling probability <inline-formula><mml:math id="m52" display="inline" overflow="scroll"><mml:msub><mml:mi>ρ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>), change their state to state <inline-formula><mml:math id="m53" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m54" display="inline" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m55" display="inline" overflow="scroll"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (where <inline-formula><mml:math id="m56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), and transmit their pathogen to an individual in state <inline-formula><mml:math id="m57" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> at a constant average rate <inline-formula><mml:math id="m58" display="inline" overflow="scroll"><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The time between events of the same type is hence modelled with exponential distribution.</p>
    <p><bold>The BDEI model</bold> (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>) (<xref rid="F2" ref-type="fig">Fig. 2</xref>), for example, is a special case of MTBD models that adds a second possible state to the state <inline-formula><mml:math id="m59" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>: <italic toggle="yes">exposed</italic><inline-formula><mml:math id="m60" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>, an individual who is already infected but not yet infectious (cannot transmit), and will eventually become infectious.</p>
    <fig position="float" id="F2">
      <label>Figure 2</label>
      <caption>
        <p>The BDEI model. An individual in exposed state <inline-formula><mml:math id="m61" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> becomes infectious at a rate <inline-formula><mml:math id="m62" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>. An infectious individual <inline-formula><mml:math id="m63" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> transmits the pathogen at a rate <inline-formula><mml:math id="m64" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> (hence creating a new exposed individual <inline-formula><mml:math id="m65" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>), and gets removed at a rate <inline-formula><mml:math id="m66" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (decreasing the number of infectious individuals <inline-formula><mml:math id="m67" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). Upon removal, the individual’s pathogen might be observed with a probability <inline-formula><mml:math id="m68" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. Note, that the BDEI model does not include a susceptible state <inline-formula><mml:math id="m69" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> (as for example SEIR) and makes the assumption that the susceptible population is unlimited (as for example in the beginning of an epidemic, or when the removed individuals could get reinfected).</p>
      </caption>
      <graphic xlink:href="syad059_fig2" position="float"/>
    </fig>
    <p>Under the BDEI model, the only allowed transmissions are from <inline-formula><mml:math id="m70" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m71" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>: At the moment of a transmission, the transmitter is always in state <inline-formula><mml:math id="m72" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, while the recipient is in state <inline-formula><mml:math id="m73" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>. Hence the only non-zero transmission rate is <inline-formula><mml:math id="m74" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, while the other 3 transmission rates are trivial: <inline-formula><mml:math id="m75" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. As we typically do not have the information to distinguish a transmitter from a recipient in a phylogenetic tree (which approximates the transmission tree), we have to consider both possibilities during parameter estimation. For the MTBD models where multiple states can transmit, the number of possibilities increases combinatorially.</p>
    <p>Under the BDEI model, we assume that only the individuals in state <inline-formula><mml:math id="m76" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can exit the study (at rate <inline-formula><mml:math id="m77" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>) and be detected and sampled (with a probability <inline-formula><mml:math id="m78" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:math></inline-formula>): For instance, for many pathogens with an incubation period, the detection is triggered by the onset of symptoms, which in turn happens in the infectious state. Hence all the BDEI tree tips are in state <inline-formula><mml:math id="m79" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, and <inline-formula><mml:math id="m80" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>In addition to <inline-formula><mml:math id="m81" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> and infectious time, the BDEI model permits inference of a third epidemiological parameter:</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">incubation period</italic><inline-formula><mml:math id="m82" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, time between the infection and becoming infectious.</p>
      </list-item>
    </list>
    <p>The incubation period can be expressed via becoming infectious rate <inline-formula><mml:math id="m83" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, corresponding to a state transition from <inline-formula><mml:math id="m84" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m85" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. The inverse state change is not allowed: <inline-formula><mml:math id="m86" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>MTBD models, as extensions of the BDS model, are asymptotically unidentifiable and require one of their parameters to be fixed in order to become identifiable. In practice, it is often the sampling probability, as it may be approximated from epidemiological data (e.g., the proportion of sampled cases among the declared ones) or the infectious time (estimated from observations of infected cases).</p>
    <sec id="s2">
      <title>Master Equations</title>
      <p>In the standard MTBD master equations proposed by <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>), time goes backward from the last sampling event (the most recent tip in the tree) till the beginning of the epidemic. These equations permit calculation of the likelihood density of the data (observed tree) given the model parameter values <inline-formula><mml:math id="m87" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula>. In the general MTBD case, the observed tree, reconstructed from sampled pathogen genomes, differs from the real transmission tree: the states of its internal nodes (corresponding to transmissions) are unknown, we cannot distinguish between the transmitter and the recipient branches, the moments of state changes are also unknown, and due to incomplete sampling some parts of the real transmission tree are unobserved in the reconstructed tree. We therefore need to integrate over all possibilities while calculating the likelihood. The BDEI model is a slightly simpler case as only infectious individuals can transmit or get sampled, hence all the node states are known (<inline-formula><mml:math id="m88" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). For the BDEI model <inline-formula><mml:math id="m89" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>In System (1) we show the MTBD master equations for a model with <inline-formula><mml:math id="m90" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> states (for the BDEI model <inline-formula><mml:math id="m91" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>); however, presenting them with the time <inline-formula><mml:math id="m92" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> going forward from the time of the epidemic start (<inline-formula><mml:math id="m93" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, i.e., tree root) to the time of the last sampled tip (<inline-formula><mml:math id="m94" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>). These equations describe the likelihood density functions (LDFs) <inline-formula><mml:math id="m95" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving as in the reconstructed tree, starting at time <inline-formula><mml:math id="m96" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m97" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (for the BDEI model <inline-formula><mml:math id="m98" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) on a branch connecting a node <inline-formula><mml:math id="m99" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, and till the end of the sampling period. The boundary condition is defined at time <inline-formula><mml:math id="m100" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (i.e., at the node <inline-formula><mml:math id="m101" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>). To account for incomplete sampling, the system also includes the probabilities <inline-formula><mml:math id="m102" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving unobserved till the time <inline-formula><mml:math id="m103" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula>, starting at time <inline-formula><mml:math id="m104" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> instate <inline-formula><mml:math id="m105" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula>.</p>
      <p>From now on, we use the following notation: the id of the root node is <inline-formula><mml:math id="m106" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula>; the ids of its children are <inline-formula><mml:math id="m107" display="inline" overflow="scroll"><mml:mn>00</mml:mn></mml:math></inline-formula> and <inline-formula><mml:math id="m108" display="inline" overflow="scroll"><mml:mn>01</mml:mn></mml:math></inline-formula>; and, by extension, the children of a node <inline-formula><mml:math id="m109" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> (if they exist) have ids <inline-formula><mml:math id="m110" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m111" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (as in <xref rid="F1" ref-type="fig">Fig. 1</xref>). Additionally if the state of a node <inline-formula><mml:math id="m112" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known, then we will name it <inline-formula><mml:math id="m113" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. (For example for the BDEI model <inline-formula><mml:math id="m114" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>I</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.)</p>
      <disp-formula>
        <mml:math id="m1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>L</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, followed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolution from the new state</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>s</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">recipient subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">transmitter subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mn>0</mml:mn>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,      if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>ψ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:msub>
                                <mml:mi>ρ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,  if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is a sampled tip in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:munderover>
                                  <mml:mo>∑</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>k</mml:mi>
                                    <mml:mo>=</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mi>d</mml:mi>
                                </mml:munderover>
                              </mml:mstyle>
                              <mml:msub>
                                <mml:mi>λ</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>k</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>s</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>1</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:mo>+</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mo rspace="0.392em">×</mml:mo>
                              <mml:msubsup>
                                <mml:mi>L</mml:mi>
                                <mml:mi>s</mml:mi>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>i</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mi>i</mml:mi>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is internal, in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>λ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>s</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">next infinitesimal time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, folowed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">unsampled evolution from the new state </mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmission, then unsampled </mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:msub>
                            <mml:mi>ρ</mml:mi>
                            <mml:mi>s</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to stay unsampled over time 0 is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(1)</label>
      </disp-formula>
    </sec>
    <sec id="s3">
      <title>Tree likelihood density</title>
      <p>The likelihood density of a tree <inline-formula><mml:math id="m115" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> for given parameter values <inline-formula><mml:math id="m116" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is then calculated as the LDF at time <inline-formula><mml:math id="m117" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> on the root, whose id is <inline-formula><mml:math id="m118" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> and whose state is <inline-formula><mml:math id="m119" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>L</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mn>0</mml:mn>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mn>0</mml:mn>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:msub>
                  <mml:mi>t</mml:mi>
                  <mml:mn>0</mml:mn>
                </mml:msub>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(2)</label>
      </disp-formula>
      <p>So far, we assumed that the epidemic started directly with the first transmission, however we can relax this assumption. The root of the tree in <xref rid="F1" ref-type="fig">Fig. 1</xref> is placed at <inline-formula><mml:math id="m120" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and does not have a branch (its length is zero). Allowing for a non-zero root branch corresponds to an epidemic start some time before the first transmission (<inline-formula><mml:math id="m121" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>). This implies that the state of the individual represented by the root branch at time <inline-formula><mml:math id="m122" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> is unknown, and all possible states should be considered (Eq. (3)). The same formula applies to cases where the root state is unknown. Assuming that the relative number of individuals in each state is at equilibrium, we can calculate the weight <inline-formula><mml:math id="m123" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> of each possible state <inline-formula><mml:math id="m124" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (derived by <xref rid="CIT0035" ref-type="bibr">Stadler et al., 2013</xref> for the general MTBD case and in Equation (16) for the BDEI model).</p>
      <disp-formula>
        <mml:math id="m3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mi>t</mml:mi>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(3)</label>
      </disp-formula>
      <p>Root’s LDF <italic toggle="yes">recursively</italic> depends on the LDFs of the child node branches via the boundary condition <inline-formula><mml:math id="m125" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> (System 1), and hence is calculated with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>) while climbing the tree from tips till the root. Therefore when parallelized to maximum, it still requires <inline-formula><mml:math id="m126" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> consecutive steps, where <inline-formula><mml:math id="m127" display="inline" overflow="scroll"><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub></mml:math></inline-formula> stands for the height of the tree <inline-formula><mml:math id="m128" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> and depends on its topology: (balanced tree) <inline-formula><mml:math id="m129" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> (ladder-like tree). At each step System (1) needs to be resolved for the corresponding nodes. Moreover, the values of <inline-formula><mml:math id="m130" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at internal nodes and their boundary conditions <inline-formula><mml:math id="m131" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> progressively become smaller as getting deeper in the tree, due to successive additions and multiplications of the LDF values. In trees with many tips, this might lead to numerical underflow, and hence such measures as rescaling need to be taken (<xref rid="CIT0001" ref-type="bibr">Berger and Stamatakis, 2009</xref>; <xref rid="CIT0006" ref-type="bibr">Defour, 2010</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>).</p>
    </sec>
    <sec id="s4">
      <title>Extension to Forests</title>
      <p>In some cases, the assumption that a (sub-)epidemic started with one infected individual might be too constraining. For instance, there could be multiple pathogen introductions to a country of interest (e.g., while in China the SARS-CoV-2 epidemic is commonly assumed to have started with one case, there were multiple independent introductions to other countries (<xref rid="CIT0049" ref-type="bibr">Zhukova et al., 2020</xref>)). This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3b</xref>. Another example is a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage. This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3a</xref>. In Bayesian settings, the situations when the system behaviour (and parameters) change over time, are modeled via skyline methods. <xref rid="CIT0035" ref-type="bibr">Stadler et al. (2013</xref>) developed the one-state Bayesian birth-death skyline plot that divides the time into intervals and allows for different piece-wise constant rates on them. <xref rid="CIT0024" ref-type="bibr">Kühnert et al. (2016</xref>) combined the MTBD model with the skyline to allow for both piece-wise constant rate changes over time and multiple individual types. The skyline approach therefore relies on a single tree, but estimates a separate set of parameters for each time interval, all under the same model. As the number of parameters increases with multiple skyline intervals, MTBD-skyline models therefore require more data and computational time for their accurate estimation, and are more prone to numerical instability than the classical MTBD models.</p>
      <fig position="float" id="F3">
        <label>Figure 3</label>
        <caption>
          <p>Forest <inline-formula><mml:math id="m132" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> representing a (sub-)epidemic that started with multiple infected cases. a) The observed forest trees (<inline-formula><mml:math id="m133" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m134" display="inline" overflow="scroll"><mml:mi>c</mml:mi></mml:math></inline-formula>), corresponding to three different initial infected cases, are shown with solid lines. All the forest trees start at the same time <inline-formula><mml:math id="m135" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). This scenario can correspond to a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage (shown with dashed lines). b) The observed forest trees (<inline-formula><mml:math id="m136" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>), corresponding to two different initial infected cases, are shown with solid lines. They start at different times (<inline-formula><mml:math id="m137" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>). This scenario can correspond to multiple introduction to the same country from other countries (shown with dashed lines).</p>
        </caption>
        <graphic xlink:href="syad059_fig3" position="float"/>
      </fig>
      <p>We propose a simpler alternative, where the (sub-)epidemic starts with multiple individuals (not necessarily at the same time) and leads to a forest <inline-formula><mml:math id="m138" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> of <inline-formula><mml:math id="m139" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed trees: <inline-formula><mml:math id="m140" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>𝒯</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The forest might also include a certain number <inline-formula><mml:math id="m141" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> of unobserved trees, i.e., individuals who were infected at the beginning of the (sub-) epidemic, but whose trees stayed unobserved as none of their tips got sampled. This can be incorporated in the likelihood calculation. Forest likelihood formula hence combines the likelihoods of <inline-formula><mml:math id="m142" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed and <inline-formula><mml:math id="m143" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> hidden trees, and can be represented in logarithmic form (Eq. (4)). Tree likelihood formula is its special case, where <inline-formula><mml:math id="m144" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m145" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <disp-formula>
        <mml:math id="m4" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi>log</mml:mi>
                    <mml:mo lspace="0.167em">⁡</mml:mo>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>ℱ</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Θ</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mi>u</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>u</mml:mi>
                        <mml:mo lspace="0.337em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mi>log</mml:mi>
                          <mml:mo lspace="0.167em">⁡</mml:mo>
                          <mml:msub>
                            <mml:mi>U</mml:mi>
                            <mml:mtext>hidden</mml:mtext>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi mathvariant="normal">Θ</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>j</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>f</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mi>log</mml:mi>
                            <mml:mo lspace="0.167em">⁡</mml:mo>
                            <mml:mi>L</mml:mi>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>𝒯</mml:mi>
                                <mml:mi>j</mml:mi>
                              </mml:msub>
                              <mml:mo fence="false">|</mml:mo>
                              <mml:mi mathvariant="normal">Θ</mml:mi>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>,</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mtext> where </mml:mtext>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mtext>hidden</mml:mtext>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mtext>start</mml:mtext>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(4)</label>
      </disp-formula>
      <p>In Equation (4) we assumed that all the <inline-formula><mml:math id="m146" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:math></inline-formula> sub-epidemics in the forest <inline-formula><mml:math id="m147" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> started at the same time (<inline-formula><mml:math id="m148" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>). This condition can be easily relaxed by replacing zeros with the corresponding tree starting times for observed and unobserved tree evolutions. As in practice we do not know the starting times of the unobserved trees if the sub-epidemics could start at different times, we approximate the unobserved tree starting times with the mean of the observed tree starting times: <inline-formula><mml:math id="m149" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mover><mml:mi>t</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mtext>start</mml:mtext></mml:msub><mml:mo rspace="0.111em">=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>f</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo symmetric="true">/</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mi>U</mml:mi>
                <mml:mrow>
                  <mml:mi>h</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>e</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>n</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi mathvariant="normal">Θ</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>U</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mover>
                      <mml:mi>t</mml:mi>
                      <mml:mo>~</mml:mo>
                    </mml:mover>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(5)</label>
      </disp-formula>
      <p>In our parameter estimator implementation for the BDEI model (see “Efficient parameter and CI estimation for the BDEI model” section), mean can be replaced with median, maximum or minimum of the observed tree times, via a user-specified parameter <inline-formula><mml:math id="m150" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">_</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>c</mml:mi><mml:mo>⁢</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
      <p>For given model parameter values <inline-formula><mml:math id="m151" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> we can estimate the number of hidden trees <inline-formula><mml:math id="m152" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> from the number of observed trees <inline-formula><mml:math id="m153" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> as</p>
      <disp-formula>
        <mml:math id="m6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>u</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mi>f</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>U</mml:mi>
                    <mml:mrow>
                      <mml:mi>h</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>i</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>e</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>n</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mn>1</mml:mn>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mrow>
                        <mml:mi>h</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>e</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>n</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(6)</label>
      </disp-formula>
      <p>Hence, working with forests does not add an additional parameter to likelihood estimation. Moreover, as our simulations show (see “Performance on simulated data and comparison to other tools” section), the value of <inline-formula><mml:math id="m154" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> has little impact on the parameter estimation. However, in some cases (e.g., change in health policy and thus of parameter values), it might be better to estimate <inline-formula><mml:math id="m155" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> based on external data (e.g., number of cases at <inline-formula><mml:math id="m156" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>), rather than assuming that the parameter values predating the trees in the forest were the same as those in the forest. We explore both approaches in the “Application: Ebola in Sierra-Leone” section.</p>
      <p>Using forests permits estimation of the model parameters on the last skyline interval without the restriction that the epidemic followed the same model before this interval (i.e., the top part of the tree, which includes the common ancestors of the forest roots, <xref rid="F3" ref-type="fig">Fig. 3a</xref>). It reduces the number of parameters to those of the last interval. It also permits estimation of parameters for a (sub-)epidemic that started with several individuals but not at the same time (e.g., due to multiple introductions to a country, <xref rid="F3" ref-type="fig">Fig. 3b</xref>).</p>
    </sec>
  </sec>
  <sec id="s5">
    <title>Avoiding numerical problems and parallelizing calculations</title>
    <p>In this section we introduce a way to rewrite LDFs in System (1) that permits (i) obtaining simpler boundary conditions to avoid potential numerical issues during resolution of equations; and (ii) removing recursion and resolving equations for each tree node in parallel, hence speeding up the calculations.</p>
    <p>System (1) has several properties. First of all, its subsystem that defines unobserved probabilities (<inline-formula><mml:math id="m157" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) is self-defined, and hence can be calculated independently from the rest. Secondly, in the subsystem that defines observed LDFs (<inline-formula><mml:math id="m158" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) the right-hand side of the differential equations is a sum where each element is linear with respect to one of the <inline-formula><mml:math id="m159" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m160" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and this sum does not contain any free term. This condition implies that if we rescale <inline-formula><mml:math id="m161" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> by a common factor, the differential equations will not change. Moreover, if the boundary conditions for all states but one are zero (<inline-formula><mml:math id="m162" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow><mml:mo>≠</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mo rspace="0.447em">;</mml:mo><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>), the rescaling will change the boundary condition only for <inline-formula><mml:math id="m163" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The latter is the case when tree node states are known, for example for the BDEI model, under which all nodes are in state <inline-formula><mml:math id="m164" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>.</p>
    <p>Assuming the state of the node <inline-formula><mml:math id="m165" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known (<inline-formula><mml:math id="m166" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>), let us define <inline-formula><mml:math id="m167" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as</p>
    <disp-formula>
      <mml:math id="m7" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>p</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>,</mml:mo>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>i</mml:mi>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>t</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mrow>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>i</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo symmetric="true">/</mml:mo>
              <mml:msubsup>
                <mml:mi>C</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
            </mml:mrow>
          </mml:mrow>
          <mml:mo lspace="0em">.</mml:mo>
        </mml:mrow>
      </mml:math>
      <label>(7)</label>
    </disp-formula>
    <p>Then the differential equations for <inline-formula><mml:math id="m168" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> will only differ from those for <inline-formula><mml:math id="m169" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in the boundary condition for <inline-formula><mml:math id="m170" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, which is <inline-formula><mml:math id="m171" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (the other boundary conditions stay zero). Conceptually, <inline-formula><mml:math id="m172" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a probability of an individual evolving as on an observed branch that connects a node <inline-formula><mml:math id="m173" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, starting at time <inline-formula><mml:math id="m174" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m175" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> on this branch and finishing at time <inline-formula><mml:math id="m176" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in state <inline-formula><mml:math id="m177" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> (without taking into account <inline-formula><mml:math id="m178" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>’s subtree and the event atnode <inline-formula><mml:math id="m179" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>).</p>
    <p>Solving the master equations for <inline-formula><mml:math id="m180" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m181" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> permits us to both (i) remove the recursive dependency between child and parent nodes (during ordinary differential equation (ODE) resolutions); and (ii) avoid numerical issues that could arise from very small values of the boundary condition of <inline-formula><mml:math id="m182" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which is particularly pertinent for large trees. The calculation of <inline-formula><mml:math id="m183" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can be done in parallel for each node <inline-formula><mml:math id="m184" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>. Hence, when parallelized to maximum, the computing time to resolve all these master equations become constant (i.e., the problem is ”embarrassingly parallelizable” following computer science terminology).</p>
    <p>In the general case, where the tree node states are unknown, all the possibilities (<inline-formula><mml:math id="m185" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) for each node <inline-formula><mml:math id="m186" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> can be considered separately and in parallel. Calculating <inline-formula><mml:math id="m187" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all the <inline-formula><mml:math id="m188" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo lspace="0.222em" rspace="0.222em">×</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> possible combinations of <inline-formula><mml:math id="m189" display="inline" overflow="scroll"><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> corresponds to the flow matrix <inline-formula><mml:math id="m190" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">G</mml:mi></mml:math></inline-formula> calculation in the general formulation recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>).</p>
    <p>In the case where all node states are known (e.g., from metadata or due to model itself, as for the BDEI case), using <inline-formula><mml:math id="m191" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m192" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> also permits us to express tree likelihood for model parameters <inline-formula><mml:math id="m193" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> in a non-recursive way, and easily transform it to a logarithmic form (Eq. (8)) (to avoid underflow issues while multiplying small numbers at the likelihood combination step). In Materials and Methods we show its equivalence to the recursive representa-tion (Eq. (2)).</p>
    <disp-formula>
      <mml:math id="m8" display="block" overflow="scroll">
        <mml:mtable>
          <mml:mtr>
            <mml:mtd>
              <mml:mrow>
                <mml:mi>l</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>o</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>g</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>L</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>𝒯</mml:mi>
                    <mml:mo fence="false">|</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
            <mml:mtd>
              <mml:mrow>
                <mml:mi/>
                <mml:mo>=</mml:mo>
                <mml:mrow>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mrow>
                          <mml:mi>t</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>p</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mrow>
                    <mml:mi>l</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>o</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>ρ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> sampling of </mml:mtext>
                      <mml:mi>n</mml:mi>
                      <mml:mtext mathvariant="italic"> tips</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo>+</mml:mo>
                <mml:mstyle>
                  <mml:munder>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                    </mml:mrow>
                  </mml:munder>
                </mml:mstyle>
                <mml:mi>l</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>g</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> transmission events</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mi>events</mml:mi>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo rspace="0.222em">⋅</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mo mathvariant="normal">←</mml:mo>
              <mml:mi>i’s child branch evolutions</mml:mi>
            </mml:mtd>
          </mml:mtr>
        </mml:mtable>
      </mml:math>
      <label>(8)</label>
    </disp-formula>
    <p>For the general case, the combination of different internal node state configurations into tree likelihood formula need to be performed with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>). The likelihood-combining tree traversal starts from the tips and climbs the tree till the root, while calculating a subtree LDF <inline-formula><mml:math id="m194" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for each visited node <inline-formula><mml:math id="m195" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> for each possible state <inline-formula><mml:math id="m196" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>:</p>
    <disp-formula>
      <mml:math id="m9" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:msubsup>
              <mml:mi>L</mml:mi>
              <mml:mi>k</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>i</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:msubsup>
            <mml:mo>⁢</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:msub>
                <mml:mi>t</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
          <mml:mo>=</mml:mo>
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,         if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>ψ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>ρ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,    if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> is a tip whose state can be </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>λ</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>l</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic"> if </mml:mtext>
                        <mml:mi>i</mml:mi>
                        <mml:mtext mathvariant="italic"> is an internal node whose state can be </mml:mtext>
                        <mml:mi>k</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.222em">⋅</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo rspace="0.055em">)</mml:mo>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mi>p</mml:mi>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>s</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mi>i</mml:mi>
                            </mml:msub>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:msubsup>
                            <mml:mi>L</mml:mi>
                            <mml:mi>s</mml:mi>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo rspace="0.055em">)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo rspace="0.222em">⋅</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>l</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>0</mml:mn>
                                </mml:mrow>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.392em">×</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:mrow>
      </mml:math>
      <label>(9)</label>
    </disp-formula>
    <p>Note that unlike the known-tree-node-state likelihood (Eq. (8)), the recursive unknown-tree-node-state likelihood (Eq. (9)) does not allow for an easy logarithmic representation, and hence is prone to underflow issues. Its calculation on large trees therefore requires additional small number rescaling techniques as recently described in (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) and common in phylogenetic inference. However, unlike in the original MTBD representation, master equation resolutions (for <inline-formula><mml:math id="m197" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m198" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be performed independently, in parallel, and avoiding underflow issues for boundary conditions.</p>
    <p>Overall, the PDF reconditioning technique can be applied to any model of the MTBD family, and facilitates its parameter estimation by separating master equation resolution (non-recursive and parallelizable) from likelihood calculation (recursive, but negligible in time cost compared to equation resolution). Recursive likelihood calculation can be performed with a standard pruning algorithm and rescaling techniques to control for potential underflow. For parameter estimation on trees with known node states (e.g., from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled, like the BDEI model), tree likelihood can be calculated with a non-recursive formula in a logarithmic form (Eq. (8)), fully avoiding underflow.</p>
    <sec id="s6">
      <title>Efficient Parameter and CI Estimation for the BDEI Model</title>
      <p>We applied our theoretical findings to implement a fast and efficient parameter estimator for the BDEI model (which we called PyBDEI). It estimates the BDEI model parameters <inline-formula><mml:math id="m199" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> for a forest <inline-formula><mml:math id="m200" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> comprising <inline-formula><mml:math id="m201" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> observed trees in the maximum-likelihood framework, where one of the parameters in <inline-formula><mml:math id="m202" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is fixed (for identifiability reasons). The number of hidden trees <inline-formula><mml:math id="m203" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> can be either given by the user, or estimated from BDEI model parameters (as in Eq. (6)).</p>
      <p>Once the optimal parameter values are found, we calculate their confidence intervals (CIs) using Wilks’ method (<xref rid="CIT0047" ref-type="bibr">Wilks, 1938</xref>). For each non-fixed parameter <inline-formula><mml:math id="m204" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow></mml:math></inline-formula>, we calculate its <inline-formula><mml:math id="m205" display="inline" overflow="scroll"><mml:mrow><mml:mn>95</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>-CI as including the values <inline-formula><mml:math id="m206" display="inline" overflow="scroll"><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:math></inline-formula> such that <inline-formula><mml:math id="m207" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>&gt;</mml:mo><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mtext>opt</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m208" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the value of chi-squared distribution with 1 degree of freedom corresponding to the significance level of <inline-formula><mml:math id="m209" display="inline" overflow="scroll"><mml:mn>0.95</mml:mn></mml:math></inline-formula> (i.e., <inline-formula><mml:math id="m210" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>3.84</mml:mn></mml:mrow></mml:math></inline-formula>). <inline-formula><mml:math id="m211" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:math></inline-formula> corresponds to the maximum-likelihood estimates for the other non-fixed parameters when <inline-formula><mml:math id="m212" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec id="s7">
      <title>Performance on Simulated Data and Comparison to Other Tools</title>
      <p>To assess the performance of our maximum-likelihood estimator PyBDEI, we used the simulated data from <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>), where we generated 100 medium trees with 200–500 tips under the BDEI model, with the parameter values sampled uniformly at random within the following boundaries: incubation period <inline-formula><mml:math id="m213" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.2</mml:mn><mml:mo>,</mml:mo><mml:mn>50</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m214" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>5</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, infectious time <inline-formula><mml:math id="m215" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>10</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, sampling probability <inline-formula><mml:math id="m216" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. These trees were evaluated with the standard Bayesian method BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep learning-based estimator PhyloDeep (detailed configurations are described in Materials and Methods). Additionally 100 large trees (5000–10,000 tips) were generated for the same parameter values, and assessed with PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). PhyloDeep’s maximal pre-trained tree size is 500 tips; however, for larger trees it estimates BDEI parameters by (i) extracting the largest non-intersecting set of subtrees of sizes covered by the pre-trained set (50–500 tips), (ii) estimating parameters on each of the subtrees independently, and (iii) averaging each parameter’s estimate over the subtrees (weighted by subtree sizes).</p>
      <p>To evaluate PyBDEI performance on forests, we additionally generated two types of forests for the large data set. The first type of forests was produced by cutting the oldest (i.e., closest to the root) 25% of each full tree, and keeping the forest of bottom-75% subtrees (in terms of time). We hence obtained 100 forests representing sup-epidemics that all started at the same time (<inline-formula><mml:math id="m217" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, as in <xref rid="F3" ref-type="fig">Fig. 3a</xref>). These forests contained <inline-formula><mml:math id="m218" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>114</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m219" display="inline" overflow="scroll"><mml:mrow><mml:mn>5031</mml:mn><mml:mo>−</mml:mo><mml:mn>9953</mml:mn></mml:mrow></mml:math></inline-formula> tips.</p>
      <p>The second type of forests represented epidemics that started with multiple introductions happening at different times (as in <xref rid="F3" ref-type="fig">Fig. 3b</xref>). To generate them, we used the parameter values <inline-formula><mml:math id="m220" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> corresponding to each tree <inline-formula><mml:math id="m221" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in the large dataset (<inline-formula><mml:math id="m222" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mn>100</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and the times <inline-formula><mml:math id="m223" display="inline" overflow="scroll"><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> between the start of the tree <inline-formula><mml:math id="m224" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> and the time of its last sampled tip. Each (potentially hidden) tree <inline-formula><mml:math id="m225" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in the forest was then generated under parameters <inline-formula><mml:math id="m226" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> till reaching the time <inline-formula><mml:math id="m227" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (drawn uniformly and independently for each tree). Trees were added to the forest till their total number of sampled tips reached at least <inline-formula><mml:math id="m228" display="inline" overflow="scroll"><mml:mn>5000</mml:mn></mml:math></inline-formula>: <inline-formula><mml:math id="m229" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>≥</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math></inline-formula>. The resulting forest <inline-formula><mml:math id="m230" display="inline" overflow="scroll"><mml:msub><mml:mi>ℱ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> included those of the trees <inline-formula><mml:math id="m231" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> that contained at least one sampled tip (i.e., observed trees). These forests contained <inline-formula><mml:math id="m232" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>4582</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m233" display="inline" overflow="scroll"><mml:mrow><mml:mn>5000</mml:mn><mml:mo>−</mml:mo><mml:mn>9897</mml:mn></mml:mrow></mml:math></inline-formula> tips, and <inline-formula><mml:math id="m234" display="inline" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>−</mml:mo><mml:mn>10687</mml:mn></mml:mrow></mml:math></inline-formula> hidden trees.</p>
      <p>We applied PyBDEI to these data sets, and compared the results to those reported for BEAST2 and PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). For the large data set, we applied PyBDEI to full trees, but also to the two types of forests.</p>
      <p>We calculated the relative error (normalized distance between the estimated and the target values: <inline-formula><mml:math id="m235" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>) and the relative bias [(<inline-formula><mml:math id="m236" display="inline" overflow="scroll"><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mo>)</mml:mo><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] for each parameter on each tree/forest. Average relative errors for PyBDEI were <inline-formula><mml:math id="m237" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>13</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the medium trees and <inline-formula><mml:math id="m238" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the large trees (hence decreasing with the data set size, as expected), and well centered around zero (i.e., unbiased), as shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. The relative 95%-CI width [<inline-formula><mml:math id="m239" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>97.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>2.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] also decreased: from <inline-formula><mml:math id="m240" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula> on the medium data set to <inline-formula><mml:math id="m241" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> on the large one. The target values of rates <inline-formula><mml:math id="m242" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m243" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> were within the estimated CIs in correspondingly 92%, 89%, and 98% of cases on the medium data set, and in 95%, 90%, and 95% of cases on the large one.</p>
      <fig position="float" id="F4">
        <label>Figure 4</label>
        <caption>
          <p>Comparison of inference accuracy of different methods on the a) medium (200-500 tips) and b) large (5000–10000 tips) 100-tree data sets. For the medium data set BEAST2 (in orange), PhyloDeep (in green) and our estimator (PyBDEI, in blue) are compared. Two (out of 100) trees of the medium data set on which BEAST2 did not converge after <inline-formula><mml:math id="m244" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps are excluded from the analysis and not shown in the figure. For large trees (<inline-formula><mml:math id="m245" display="inline" overflow="scroll"><mml:mo>&gt;</mml:mo></mml:math></inline-formula>500 tips), PhyloDeep extracts the largest non-intersecting set of subtrees of 50–500 tips, estimates parameters on each of the subtrees independently, and averages each parameter’s estimate over the subtrees (weighted by subtree sizes). We assessed our method on full trees (dark-blue), on forests obtained from the full trees by removing the oldest (closest to the root) 25% (in terms of height) of those trees (forests 1, light-blue), and on forests whose trees were generated using varying sampling period durations (forests 2, pink). We show the swarmplots (colored by method) of relative errors for each test tree/forest and parameter, which are measured as the normalized distance between the median a posteriori estimate by BEAST2 or a point estimate by PhyloDeep/PyBDEI and the real value. Average relative error (and in parentheses average relative bias) are displayed for each parameter and method below their swarmplot. The accuracy of the methods is compared by a paired <italic toggle="yes">z</italic>-test; <inline-formula><mml:math id="m246" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> are shown above each method pair; non-significant <italic toggle="yes">P</italic>-values are not shown.</p>
        </caption>
        <graphic xlink:href="syad059_fig4" position="float"/>
      </fig>
      <p>To assess method accuracy we calculated <italic toggle="yes">P</italic>-values based on two-sided z-tests for each parameter and method pair. On the medium data set for <inline-formula><mml:math id="m247" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> all the methods performed in a comparable way. For the infectious time, <inline-formula><mml:math id="m248" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was at least as accurate as PhyloDeep and more accurate than BEAST2 (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m249" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>). For the incubation period, <inline-formula><mml:math id="m250" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was more accurate than both other methods (see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the large data set BEAST2 was inapplicable due to computation times (57 CPU hours were already required for each medium-sized tree, on average), while PyBDEI was more accurate than PhyloDeep, both using full trees and the forests of the first type (i.e., where all the trees started at the same time, <italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m251" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> for all the parameters, see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the forests of the second type (i.e., trees starting at different times) PyBDEI’s performance was comparable to the one of PhyloDeep for all the parameters. While the mean relative errors were low (<inline-formula><mml:math id="m252" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), PyBDEI performed worse (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m253" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula>) on forests of type 2 than on full trees or forests of type 1 for the infectious period and incubation time. This can be explained by the fact that the starting times of the hidden trees in forests of type 2 were not known and hence needed to be approximated. Moreover, forests of type 2 contained less branches (mean 13155) than forests of type 1 (14896) or full trees (14969), and hence less data for parameter inference.</p>
      <p>For two trees in the medium data set, BEAST2 did not converge after <inline-formula><mml:math id="m254" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> Markov Chain Monte Carlo (MCMC) steps: We did not include these two data points in the analysis. PyBDEI performed well on these two trees: real parameters were within estimated confidence intervals, relative errors for <inline-formula><mml:math id="m255" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>15</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, relative errors for incubation period and infectious time <inline-formula><mml:math id="m256" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>There were also several trees where BEAST2 seems to have converged to a local optimum (estimates with relative errors close to 1). To investigate this hypothesis further, we calculated the tree likelihoods for the real parameter values and those estimated by the three methods (<xref rid="T1" ref-type="table">Table 1</xref>). Indeed, BEAST2 had a likelihood lower than the one obtained on real values for 8% of trees in the medium dataset (8 out of 98 trees on which BEAST2 converged), which corresponds to a local optimum. These 8 data points correspond to the high BEAST2 relative error values (<inline-formula><mml:math id="m257" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for infectious time and <inline-formula><mml:math id="m258" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&gt;</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula> for incubation period) shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. PyBDEI estimates had a higher or equal likelihood than any other method and real values for all the trees of both data sets, suggesting that PyBDEI reaches the global optimum of the likelihood function. On the medium dataset, PyBDEI estimates had an equal likelihood to the ones of BEAST2 for 85% of trees, and a higher likelihood for the other 15% of trees. Comparing to PhyloDeep, PyBDEI estimates had an equal likelihood for 48% of trees, and a higher likelihood for the other 52% of trees. Interestingly, PhyloDeep, while being a likelihood-free method, performed very well on the medium data set: on 81% of trees it estimated parameters with higher or equal likelihood to the one of the real parameters. On the large data set it performed worse in terms of likelihood, estimating parameters with higher or equal likelihood to the one of the real parameters only on 29% of trees. It could however be explained by the fact that PhyloDeep estimated parameters on each of the smaller (50–500 tip) subtrees selected by its subtree picker procedure, and averaged the result, instead of being retrained on large 5000–10000-tip trees.</p>
      <table-wrap position="float" id="T1">
        <label>Table 1</label>
        <caption>
          <p>Tree likelihood comparison between the real parameter values and those estimated by different methods on medium and large data sets.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="center" rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" colspan="2" rowspan="1">Real values</th>
              <th align="left" rowspan="1" colspan="1">BEAST2</th>
              <th align="left" colspan="2" rowspan="1">PhyloDeep</th>
              <th align="left" colspan="2" rowspan="1">PyBDEI</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">real values</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">BEAST2</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PhyloDeep</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PyBDEI</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="T1fn01">
            <p>The value provided in row i, column j indicates the proportion of trees for which the likelihood with parameters estimated by method i is either higher (sub-row &gt;), equal (sub-row <inline-formula><mml:math id="m259" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>) or lower (sub-row &lt;) than the likelihood estimated by method j. For example, 0.847 in the row “BEAST2 <inline-formula><mml:math id="m260" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>” and the column “PyBDEI medium” means that the estimates of BEAST2 had an equal likelihood to those of PyBDEI on 84.7% of trees of the medium data set. According to a sign test, the differences between all the pairs of methods are significant (<inline-formula><mml:math id="m261" display="inline" overflow="scroll"><mml:mi>P</mml:mi></mml:math></inline-formula>-value &lt; 0.01).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>In terms of time, on the medium data set PyBDEI needed on average <inline-formula><mml:math id="m262" display="inline" overflow="scroll"><mml:mn>4</mml:mn></mml:math></inline-formula> seconds per tree on 1 CPU, and converged in 864 iterations (including CI calculation). These times cannot be directly compared to BEAST2 times, as BEAST2 performs a Markov Chain Monte Carlo (MCMC) parameter space exploration instead of looking for the optimum (as PyBDEI does), hence requires many more steps: for <inline-formula><mml:math id="m263" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps it took on average <inline-formula><mml:math id="m264" display="inline" overflow="scroll"><mml:mn>57</mml:mn></mml:math></inline-formula> CPU hours. While the number of MCMC steps could probably be reduced for some runs, for two out of 100 trees it was not sufficient for convergence. Implementing likelihood calculation with our new MTBD formulation and targeted numerical analysis methods, could be helpful in Bayesian context as well: comparing time per iteration (which is roughly time per likelihood calculation), our optimizer required <inline-formula><mml:math id="m265" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds, while BEAST2 took one order of magnitude longer: <inline-formula><mml:math id="m266" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds. This is probably due to the fact that BEAST2 uses the general MTBD model formulation, configured for BDEI, while our implementation uses a BDEI-tailored implementation. Moreover, the ODE reconditioning allows to avoid underflow errors (and rescaling efforts during tree pruning (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>)), which could also play a role. Using several CPUs would allow for an even larger gain (see the results on the large data set below). PhyloDeep took <inline-formula><mml:math id="m267" display="inline" overflow="scroll"><mml:mn>0.2</mml:mn></mml:math></inline-formula> CPU seconds per tree, which is faster than our method’s time but does not include the training time of deep learning predictors (hundreds of hours). To our knowledge, the only other available maximum-likelihood estimator for BDEI is implemented in the TreePar package (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). However, as it suffers from underflow issues for BDEI already on trees of small size, its developers suggest using BEAST2 instead (private communication).</p>
      <p>The average time of PyBDEI convergence on the large data set was 2 min 28 s on 1 CPU, and required 960 iterations. Parallelization on 2 CPUs reduced it to 1 min and 24 s (1.8 times faster). The speed up is close to the number of cores, which shows the efficiency of parallelization of master equation resolution despite the pre- and post-processing steps (tree reading, distribution of jobs between the threads, combining their results), which are always performed on one CPU. This suggests that our estimator will be easily applicable to much largertrees.</p>
      <p>As the BDEI model requires one of the parameters to be fixed in order to become asymptomatically identifiable (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we fixed <inline-formula><mml:math id="m268" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> to the real value, both in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) and in the comparison described above. However, to assess PyBDEI performance with other parameters fixed, we estimated parameters for trees in the large data set under three additional settings: with (1) <inline-formula><mml:math id="m269" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>, (2) <inline-formula><mml:math id="m270" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or (3) <inline-formula><mml:math id="m271" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> fixed to its real value. The results are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S1</ext-link> (online Appendix, available at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>). Average relative errors were <inline-formula><mml:math id="m272" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all parameters when <inline-formula><mml:math id="m273" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> was fixed to the real value, <inline-formula><mml:math id="m274" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m275" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> was fixed, <inline-formula><mml:math id="m276" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m277" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m278" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> were fixed. For estimates of <inline-formula><mml:math id="m279" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> we calculated absolute errors <inline-formula><mml:math id="m280" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> instead of relative ones: their average was <inline-formula><mml:math id="m281" display="inline" overflow="scroll"><mml:mn>0.02</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m282" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m283" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> , and <inline-formula><mml:math id="m284" display="inline" overflow="scroll"><mml:mn>0.01</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m285" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>. Hence, the estimations can be successfully performed with any of the parameters being fixed, but fixing <inline-formula><mml:math id="m286" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m287" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> might be particularly useful. Moreover, these parameters are relatively easy to estimate with real data (e.g., patient observations for <inline-formula><mml:math id="m288" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>, and proportion of sampled cases among the declared ones for <inline-formula><mml:math id="m289" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>).</p>
      <p>Finally, we assessed the impact of the number of hidden trees <inline-formula><mml:math id="m290" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> on the parameter estimation. We estimated parameters with <inline-formula><mml:math id="m291" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m292" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being estimated from model parameters on the two types of forests of the large dataset. For forests of type 2 (where trees started at different times), we additionally compared <inline-formula><mml:math id="m293" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> estimations using minimum, mean, median and maximum of observed tree-specific times (see Eq. (5)). Note that the minimum time and <inline-formula><mml:math id="m294" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> represent the two extremes, as the probability of a tree to stay fully unobserved decreases with time. The relative errors for different parameters are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S2</ext-link> (online Appendix). While estimating <inline-formula><mml:math id="m295" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> using mean, median or maximum times seems to have a slightly smaller relative error for <inline-formula><mml:math id="m296" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> (3% vs. 4% for minimum time or <inline-formula><mml:math id="m297" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), these differences are non-significant. Overall, <inline-formula><mml:math id="m298" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> seems to have little impact on parameter estimation.</p>
      <p>The assessment of our maximum-likelihood estimator on simulated data shows that it opens new possibilities to fast and accurate analyses of extremely large data sets, while being flexible with respect to parameter settings (e.g., the parameter to be fixed). The use of forests makes it possible to focus on a specific part of a large tree, e.g., the most recent period, the subtrees corresponding to a given region or country, or the origin of the epidemic.</p>
    </sec>
  </sec>
  <sec id="s8">
    <title>Application: Ebola in Sierra-Leone</title>
    <p>Using PyBDEI, we analysed the 2014 Ebola epidemic in Sierra-Leone (SLE). Ebola virus features an incubation period (reported by the World Health Organisation (WHO) to take between 2 and 21 d (<xref rid="CIT0046" ref-type="bibr">WHO, 2021</xref>)). Using statistical methods based on time series of reported Ebola cases, the incubation period of Ebola during the 2014 SLE epidemic was previously estimated to be around 10–11 d, the infectious time around 4–5 d, and the reproduction number to decrease from around 2 in the beginning of the epidemic to values close to 1 by late 2014 (due to control measures) (<xref rid="CIT0038" ref-type="bibr">Team, 2014</xref>, <xref rid="CIT0039" ref-type="bibr">2015</xref>; <xref rid="CIT0030" ref-type="bibr">Rivers et al., 2014</xref>; see also <xref rid="CIT0041" ref-type="bibr">Van Kerkhove et al., 2015</xref> for a review).</p>
    <p>Sequence data could improve and complement these estimates. However, the existing phylodynamic study of these parameters was limited by the data set size: <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>) applied the BDEI model to the early spread of Ebola in SLE by analysing 72 Ebola samples from late May to mid June 2014 (sequences from <xref rid="CIT0011" ref-type="bibr">Gire et al. (2014</xref>)). They estimated the expected length of the incubation period to be 4.9 d (median; 95% HPD 2.1–23.2), and the infectious time of 2.6 d (median; 95% HPD 1.2–7).</p>
    <p>To show the power of phylodynamic analyses on larger data sets, we took the 1610-sequence alignment and metadata (sampling times and countries) that were used in the study by <xref rid="CIT0008" ref-type="bibr">Dudas et al. (2017</xref>), who analysed the factors that spread the 2014–2016 Ebola epidemic in West Africa. Using these data, we reconstructed a time-tree of the Ebola epidemic in West Africa, which we then used to extract a forest of time-subtrees representing the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in the data set). This was done to obtain a forest of subtrees with a homogenous health policy (after July 30). The details on the forest reconstruction are given in Materials and Methods. To check for robustness of the estimates, forest reconstruction was performed 10 times, obtaining slightly different forests.</p>
    <p>We estimated the BDEI parameters on these 10 forests. As the BDEI model requires one of the parameters to be fixed for identifiability (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we performed the estimations fixing the sampling probability <inline-formula><mml:math id="m299" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. We estimated <inline-formula><mml:math id="m300" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> as the proportion of cases represented by our forests (853–854) with respect to the total number of SLE Ebola cases reported by the Centers for Disease Control and Prevention (<xref rid="CIT0004" ref-type="bibr">CDC, 2020</xref>) between September 8, 2015 (the closest date to the last SLE sample in our data set, 13683 cases) and July 31, 2014 (the day following the quarantine measures start, 533 cases): <inline-formula><mml:math id="m301" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mrow><mml:mn>854</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>13683</mml:mn><mml:mo>−</mml:mo><mml:mn>533</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≈</mml:mo><mml:mn>0.065</mml:mn></mml:mrow></mml:math></inline-formula> (calculated independently for each forest). To check the robustness of the predictions with respect to this estimation of <inline-formula><mml:math id="m302" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>, we additionally estimated the parameter values assuming 20% more (15780, <inline-formula><mml:math id="m303" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.054</mml:mn></mml:mrow></mml:math></inline-formula>) and 20% less (10520, <inline-formula><mml:math id="m304" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.081</mml:mn></mml:mrow></mml:math></inline-formula>) total cases. For each of these settings we performed three estimations: (1) with the number of unobserved trees being estimated, (2) with it being fixed (via setting the parameter <inline-formula><mml:math id="m305" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>) to the difference between the total number of SLE Ebola cases reported by the CDC on July 31 (533) and the number of trees in the corresponding forest (varying between 143 and 174), and (3) with it being fixed to zero.</p>
    <p>The results for different <inline-formula><mml:math id="m306" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> values, estimated vs. fixed <inline-formula><mml:math id="m307" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>, and different trees were compatible, with intersecting CIs (see <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Table S1</ext-link> in online Appendix). We estimated the <inline-formula><mml:math id="m308" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> value between 0.95 and 1, suggesting a contained epidemic (which is in a good agreement with the quarantine measures and the end of the epidemic in early 2016). The incubation period was estimated between 11 and 14 days. These estimates are fully compatible with the previous studies and allow to narrow down the WHO incubation period estimate (2–21 d, non-specific to the SLE epidemic). We estimated a very short infectious period <inline-formula><mml:math id="m309" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>≈</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> hour. While it does not correspond to the epidemiological estimates (4–5 d) reported in previous studies, it makes sense in the setting we are looking at. The BDEI infectious period corresponds to the time interval between the moment when a person becomes infectious and the moment when they cannot transmit anymore. In the beginning of an epidemic impossibility to transmit is typically defined by biological factors, such as healing or death, and corresponds to the epidemiological definition. However, it could also be influenced by logistic reasons, such as self-isolation. As we are looking at the lock-down period, with strict surveillance, it seems likely that a person who develops symptoms (i.e., passes from the exposed to the infectious state) is immediately detected and isolated, hence having very limited time to transmit on average. Our estimate therefore corresponds to this logistic scenario.</p>
    <p>Note, that comparing the setting with <inline-formula><mml:math id="m310" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being fixed according to the CDC-declared case count to the one when it is estimated, <inline-formula><mml:math id="m311" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> estimates were slightly smaller with <inline-formula><mml:math id="m312" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> fixed (while the CIs intersected). As the number of cases is defined by the epidemic preceding the studied period, <inline-formula><mml:math id="m313" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> might not correspond to the number estimated from the studied period parameters, and it might be more accurate to fix it.</p>
    <p>Overall, the analysis took <inline-formula><mml:math id="m314" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> h for the reconstruction of forests and <inline-formula><mml:math id="m315" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> min per forest for the BDEI parameter estimation.</p>
    <p>This application shows the advantages of PyBDEI not only in terms of calculation times, but also in terms of flexibility of input settings (extracting information from multiple trees).</p>
  </sec>
  <sec id="s9">
    <title>Discussion</title>
    <p>We proposed a highly parallelizable formulation of master equations for MTBD models. We also proposed an extension of the MTBD models to forests, to tackle situations where health policies change over time (providing a flexible alternative to the Bayesian skyline), as well as situations of multiple (not necessarily simultaneous) pathogen introductions to a country of interest. The extension to forests does not introduce additional model parameters; however, when available, it allows to incorporate external data on the number of infectious cases at the start of the forest.</p>
    <p>The peculiar properties of original MTBD equations permitted us to rewrite them in a branch-specific way. This representation features simple boundary conditions with 0 or 1 values, and avoids numerical and underflow problems that could occur in the original system due to very small positive values of the boundary conditions. Even more importantly, our branch-specific representation removes the recursive dependency between the equations corresponding to parent and child tree nodes, and permits their time-consuming resolution to be performed in parallel and independently. The results can then be combined into tree likelihood with a nearly standard pruning algorithm. While the likelihood-combining step in the most general MTBD case remains recursive, its time cost should be negligible in comparison with the recursive master equation resolution used in previous studies. Moreover, for cases where tree node states are known we obtained an explicit likelihood formula, which can be represented in a logarithmic form (Eq. 8) to avoid potential underflow issues during the likelihood-combining step. Tree node states could be known from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled.</p>
    <p>We implemented our theoretical findings in a maximum likelihood parameter and CI estimator for the BDEI model, which is a special case of MTBD models. It is also one of the most useful models in epidemiology, being applicable to Ebola, Sars-CoV 1 and 2, Tuberculosis and other pathogens that feature an incubation period. Under this model tree node states are known, as only the infectious individuals can transmit their pathogen or get detected (after symptom onset). Our parameter estimator, PyBDEI, drastically increases parameter optimization performance, accuracy and speed with respect to previously available estimators.</p>
    <p>We applied our estimator to the 2014 Ebola epidemic in Sierra Leone, after the introduction of quarantine measures. The analysis took <inline-formula><mml:math id="m316" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> h (the majority of which was the tree reconstruction). The obtained estimates of epidemiological parameters are in agreement with what we now know about this epidemic. In particular, the estimate of <inline-formula><mml:math id="m317" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula>, slightly less than 1, suggests a contained epidemic, and indeed Sierra Leone was declared Ebola free in early 2016, a few months after the sampling date (September 7, 2015) of the most recent Ebola sequence in our data set.</p>
    <p>The accuracy of estimations improves with the data set size (as expected, see our simulations). In the world of rapidly growing sequencing data sets (<xref rid="CIT0016" ref-type="bibr">Hodcroft et al., 2021</xref>), we can gain important insights on epidemic spreads by harvesting all available information. PyBDEI is applicable to very large data sets (2 min on a 10000-tip tree), making parameter and CI estimation instantaneous with respect to phylogenetic tree reconstruction times (hours or even days). Our approach could be easily used in a Bayesian setting as well, and could potentially be implemented in BEAST2.</p>
    <p>As the MTBD models are epidemiological analogues of the ClaSSE-like models, our findings could also be easily transferred to the macroevolution domain. Our parallelizable MTBD model formulation is closely related to general matrix-based flow framework recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>). Using this framework, they implemented an efficient parameter estimator <italic toggle="yes">castor</italic> for MuSSE-like models; however, this type of models does not cover cladogenetic changes possible in ClaSSE-like and MTBD models. Moreover, our approach, thanks to forests, allows for multiple introductions, for example, of an epidemic in a given country, or of species from the same clade within a given ecological realm, which could be useful in the macroevolution domain. With rapidly growing genome sequence data, castor and PyBDEI open way to fast and accurate parameter estimations for ecology and epidemiology.</p>
  </sec>
  <sec id="s10">
    <title>Materials and Methods</title>
    <sec id="s11">
      <title>Reconditioned BDEI master equations</title>
      <disp-formula>
        <mml:math id="m10" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>E</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by evolution</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m11" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>I</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the recipient</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the transmitter</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to evolve from I to I over zero time is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> an individual in state </mml:mtext>
                      <mml:mi>E</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot change their state to I</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext>𝑖𝑛𝑠𝑡𝑎𝑛𝑡𝑒𝑛𝑖𝑜𝑢𝑠𝑙𝑦</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>E</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">evolution from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>I</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, then unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>ψ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:mi>ρ</mml:mi>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> the probability to stay unsampled over</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">zero time is 1</mml:mtext>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(10)</label>
      </disp-formula>
    </sec>
    <sec id="s12">
      <title>Equivalence between Equations (2) and (8)</title>
      <p>The likelihood Equation (2) for a tree <inline-formula><mml:math id="m318" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> is recursive, and when using <inline-formula><mml:math id="m319" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m320" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) needs to be resolved with a pruning algorithm while climbing the tree. However, for a tree with known node states, we can transform it into a non-recursive Equation (8) with <inline-formula><mml:math id="m321" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, by alternating <italic toggle="yes">replacement</italic> and <italic toggle="yes">unfolding</italic> steps. A replacement step consists in replacing <inline-formula><mml:math id="m322" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="m323" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo rspace="0.055em">)</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.222em">⋅</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and is followed by an unfolding step. An unfolding step either (if <inline-formula><mml:math id="m324" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is a tip) unfolds <inline-formula><mml:math id="m325" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m326" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and stops; or (if <inline-formula><mml:math id="m327" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is an internal node) unfolds <inline-formula><mml:math id="m328" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m329" display="inline" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and proceeds with replacements. In Equation (11) we show the transformation process.</p>
      <disp-formula>
        <mml:math id="m12" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>𝒯</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mn>0</mml:mn>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext>Equation (2)</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m13" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>p</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mn>0</mml:mn>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo rspace="0.055em">)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mi>(note that</mml:mi>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo mathvariant="italic">⁢</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo mathvariant="normal">(</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                        <mml:mo mathvariant="normal">)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo mathvariant="normal">(</mml:mo>
                      <mml:mn mathvariant="normal">0</mml:mn>
                      <mml:mo mathvariant="normal">)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo mathvariant="normal">=</mml:mo>
                  <mml:mn mathvariant="normal">1</mml:mn>
                </mml:mrow>
                <mml:mi>as the root branch is of length zero)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>L</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mn>0</mml:mn>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> unfolding of </mml:mtext>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>0</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m14" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> (note that </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>00</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> and </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>01</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> do not depend</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mi>on k, and can be put outside of the sum)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>00</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if left child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>x</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>00</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>000</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>x</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>001</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo>+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>000</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>001</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do not</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">depend on </mml:mtext>
                            <mml:mi>x</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">←</mml:mo>
                <mml:mi> unfolding of</mml:mi>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if right child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>y</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>01</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>010</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>y</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>011</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo rspace="0.392em">+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>010</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>011</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">not depend on </mml:mtext>
                            <mml:mi>y</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">← unfolding of</mml:mo>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mi mathvariant="normal">…</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> keep unfolding and replacing</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>j</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext>𝑡𝑖𝑝𝑠</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>ψ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:msub>
                    <mml:mi>ρ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> non-log Eq. (</mml:mtext>
                    <mml:mn>8</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(11)</label>
      </disp-formula>
    </sec>
    <sec id="s13">
      <title>Stationary Distribution</title>
      <p>Stationary state distribution <inline-formula><mml:math id="m330" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Π</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo rspace="0.278em">}</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.558em">:</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the ratios of states <inline-formula><mml:math id="m331" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="m332" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> at a given time <inline-formula><mml:math id="m333" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> after these ratios stopped changing (assuming that this may happen). <inline-formula><mml:math id="m334" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m335" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the number of individuals of type <inline-formula><mml:math id="m336" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m337" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the total number of infected (infectious or not) individuals at time <inline-formula><mml:math id="m338" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula>. Hence, the derivative of the number of individuals of type <inline-formula><mml:math id="m339" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> is proportional to the derivative of the total number of infected individuals:</p>
      <disp-formula>
        <mml:math id="m15" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>N</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(12)</label>
      </disp-formula>
      <p>The number of individuals in state <inline-formula><mml:math id="m340" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> increases due to becoming infectious of individuals in state <inline-formula><mml:math id="m341" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and decreases due to removal, while the number of individuals in state <inline-formula><mml:math id="m342" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> decreases due to becoming infectious and increases due to transmissions:</p>
      <disp-formula>
        <mml:math id="m16" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mrow>
                            <mml:mi>μ</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>N</mml:mi>
                              <mml:mi>E</mml:mi>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mi>t</mml:mi>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mi>λ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(13)</label>
      </disp-formula>
      <p>Becoming infectious changes the corresponding individual’s state but does not affect the total number of infected individuals, transmissions increase the total number, and removal decreases it. Note that only individuals in state <inline-formula><mml:math id="m343" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit or be removed:</p>
      <disp-formula>
        <mml:math id="m17" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mi>λ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mrow>
                  <mml:mi>ψ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(14)</label>
      </disp-formula>
      <p>Combining [13] and [14] we rewrite [12] as a system of multivariate algebraic equations:</p>
      <disp-formula>
        <mml:math id="m18" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                          <mml:mn>2</mml:mn>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>λ</mml:mi>
                            <mml:mo>−</mml:mo>
                            <mml:mi>ψ</mml:mi>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>E</mml:mi>
                        </mml:msub>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(15)</label>
      </disp-formula>
      <p>from which we derive a quadratic equation for <inline-formula><mml:math id="m344" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="m345" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo>−</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and the following stationary distribution:</p>
      <disp-formula>
        <mml:math id="m19" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mrow>
                                <mml:mstyle>
                                  <mml:mfrac>
                                    <mml:mi>μ</mml:mi>
                                    <mml:mrow>
                                      <mml:mi>μ</mml:mi>
                                      <mml:mo>+</mml:mo>
                                      <mml:mi>ψ</mml:mi>
                                    </mml:mrow>
                                  </mml:mfrac>
                                </mml:mstyle>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mtext mathvariant="italic"> if </mml:mtext>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>λ</mml:mi>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mo>=</mml:mo>
                              <mml:mi>ψ</mml:mi>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:mfrac>
                                  <mml:mrow>
                                    <mml:mrow>
                                      <mml:mo>−</mml:mo>
                                      <mml:mrow>
                                        <mml:mo>(</mml:mo>
                                        <mml:mrow>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>+</mml:mo>
                                          <mml:mi>ψ</mml:mi>
                                        </mml:mrow>
                                        <mml:mo>)</mml:mo>
                                      </mml:mrow>
                                    </mml:mrow>
                                    <mml:mo>+</mml:mo>
                                    <mml:msqrt>
                                      <mml:mrow>
                                        <mml:msup>
                                          <mml:mrow>
                                            <mml:mo>(</mml:mo>
                                            <mml:mrow>
                                              <mml:mi>μ</mml:mi>
                                              <mml:mo>−</mml:mo>
                                              <mml:mi>ψ</mml:mi>
                                            </mml:mrow>
                                            <mml:mo>)</mml:mo>
                                          </mml:mrow>
                                          <mml:mn>2</mml:mn>
                                        </mml:msup>
                                        <mml:mo>+</mml:mo>
                                        <mml:mrow>
                                          <mml:mn>4</mml:mn>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>λ</mml:mi>
                                        </mml:mrow>
                                      </mml:mrow>
                                    </mml:msqrt>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mn>2</mml:mn>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mrow>
                                      <mml:mo>(</mml:mo>
                                      <mml:mrow>
                                        <mml:mi>λ</mml:mi>
                                        <mml:mo>−</mml:mo>
                                        <mml:mi>ψ</mml:mi>
                                      </mml:mrow>
                                      <mml:mo>)</mml:mo>
                                    </mml:mrow>
                                  </mml:mrow>
                                </mml:mfrac>
                              </mml:mstyle>
                              <mml:mo>⁢</mml:mo>
                              <mml:mtext mathvariant="italic">, otherwise </mml:mtext>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>E</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo>−</mml:mo>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(16)</label>
      </disp-formula>
    </sec>
    <sec id="s14">
      <title>PyBDEI, Its Code and Data Availability</title>
      <p>Parameter estimation starts with a preprocessing step of reading the input trees, calculating the time <inline-formula><mml:math id="m346" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> at each node <inline-formula><mml:math id="m347" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and memorising the association between each node and its child nodes: <inline-formula><mml:math id="m348" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This step requires one tree traversal, and its time is negligible with respect to the numerical master equation resolution performed in the next steps.</p>
      <p>The estimation then proceeds with a search for the optimal parameter set <inline-formula><mml:math id="m349" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>arg</mml:mi><mml:mo lspace="0.450em">⁢</mml:mo><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>∈</mml:mo><mml:mi>𝒬</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m350" display="inline" overflow="scroll"><mml:mi>𝒬</mml:mi></mml:math></inline-formula> is the set of admissible parameter values. We use the globally-convergent method of moving asymptotes (<xref rid="CIT0037" ref-type="bibr">Svanberg, 2002</xref>) for the optimization. At each optimization step <inline-formula><mml:math id="m351" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> the corresponding likelihood <inline-formula><mml:math id="m352" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> needs to be calculated, which implies calculating <inline-formula><mml:math id="m353" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> for each of the <inline-formula><mml:math id="m354" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed internal nodes of <inline-formula><mml:math id="m355" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula>, and combining them as in the forest likelihood formula (Eq. (4)). The reconditioned version of BDEI master equations (10) for the parameter values <inline-formula><mml:math id="m356" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> can be resolved in parallel for each of the <inline-formula><mml:math id="m357" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed forest nodes (differing in the times <inline-formula><mml:math id="m358" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> of their boundary conditions).</p>
      <p>To resolve these master equations numerically, we start by separating the self-defined subsystem for the unknowns <inline-formula><mml:math id="m359" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m360" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from the rest of System (10), and calculate it independently. Taking into account the fact that the equations in System (10) are either linear (for <inline-formula><mml:math id="m361" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m362" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) or quadratic (for <inline-formula><mml:math id="m363" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m364" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) the use of an implicit scheme is simple. We chose implicit schemes with an automatic computation of the time step, such that the error is less than a given tolerance. In our implementation, we used the implicit Euler scheme (<xref rid="CIT0003" ref-type="bibr">Butcher, 2016</xref>) for solving the linear equations and the Crank-Nicolson implicit scheme (<xref rid="CIT0005" ref-type="bibr">Crank and Nicolson, 1947</xref>) for the non-linear ones. This permits us to avoid possible stability time restrictions and only choose the time steps for precision.</p>
      <p>The core of our estimator is implemented in C++ and uses the NLopt library (Johnson, <xref rid="CIT0020" ref-type="bibr"> </xref>) for non-linear optimization. The parallelization is achieved with the C++ <monospace>thread_pool</monospace> tools (<xref rid="CIT0048" ref-type="bibr">Williams, 2012</xref>). To facilitate the use of our estimator in Python and perform additional validation of input trees, we wrapped the core estimator into a Python 3 library PyBDEI. PyBDEI uses ETE 3 framework for tree manipulation (<xref rid="CIT0017" ref-type="bibr">Huerta-Cepas et al., 2016</xref>) and NumPy package for array operations (<xref rid="CIT0014" ref-type="bibr">Harris et al., 2020</xref>).</p>
      <p>Our estimator is available as a command-line program and a Python 3 library via PyPi (<ext-link xlink:href="https://pypi.org/project/pybdei" ext-link-type="uri">https://pypi.org/project/pybdei</ext-link>), and via Docker/Singularity (<ext-link xlink:href="https://hub.docker.com/r/evolbioinfo/bdei" ext-link-type="uri">https://hub.docker.com/r/evolbioinfo/bdei</ext-link>). Its source code, the simulated and real data used for its assessment, as well as the Snakemake (<xref rid="CIT0022" ref-type="bibr">Köster and Rahmann, 2012</xref>) data analysis pipelines, and the installation and usage documentation are available on GitHub at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">github.com/evolbioinfo/bdei</ext-link>. The simulated data are also available from the Dryad Digital Repository: <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
    </sec>
    <sec id="s15">
      <title>BEAST2 and PhyloDeep Settings</title>
      <p>BEAST2 (v2.6.2 with package bdmm (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) v1.0) was configured for <inline-formula><mml:math id="m365" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps with the following priors: <inline-formula><mml:math id="m366" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.02</mml:mn><mml:mo>,</mml:mo><mml:mn>5.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m367" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>1.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m368" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value (<inline-formula><mml:math id="m369" display="inline" overflow="scroll"><mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, different for different trees). The initial values in the MCMC were set to the medians used in the PhyloDeep training set, namely <inline-formula><mml:math id="m370" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>2.51</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m371" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.55</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m372" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. The tree was fixed to the real tree. For each tree, the Effective Sample Size (ESS) on all parameters was evaluated, and the median of a posteriori values was reported, corresponding to all recorded steps (i.e., actual MCMC steps spaced by 1000) past the 10% burn-in. The simulations for which BEAST2 did not converge after <inline-formula><mml:math id="m373" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps (2%) were discarded from the analyses.</p>
      <p>PhyloDeep (v0.2.51) was run with <inline-formula><mml:math id="m374" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value and Convolutional Neural Networks trained on the Compact Bijective Ladderized Vector full tree representation (CNN-CBLV).</p>
      <p>The visualizations of the analyses of simulated data were performed with the Python 3 library seaborn (v0.11.2) (<xref rid="CIT0045" ref-type="bibr">Waskom, 2021</xref>; <xref rid="CIT0018" ref-type="bibr">Hunter, 2007</xref>).</p>
    </sec>
    <sec id="s16">
      <title>Tree Reconstruction for Ebola SLE Epidemic Analysis</title>
      <p>We reconstructed a maximum-likelihood phylogeny of 1610 tips for the Ebola samples from (<xref rid="CIT0008" ref-type="bibr">Dudas et al., 2017</xref>) with RAxML-NG (v1.0.2, GTR+G4+FO+IO) (<xref rid="CIT0023" ref-type="bibr">Kozlov et al., 2019</xref>), and rooted it based on sampling dates using LSD2 (v2.4.1) (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>). As Ebola’s mutation rate is slower than its transmission rate, the initial phylogeny contained <inline-formula><mml:math id="m375" display="inline" overflow="scroll"><mml:mn>242</mml:mn></mml:math></inline-formula> polytomies (i.e., multiple transmissions, which happened faster than the virus acquired a mutation, hence making them undistinguishable in the phylogeny). The BDEI model, on the other hand, assumes a binary tree. We therefore resolved these polytomies randomly (10 times, to check for robustness of the estimates) using a coalescent approach.</p>
      <p>We then dated each of the 10 trees with LSD2 (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>) (v2.4.1: <ext-link xlink:href="https://github.com/tothuhien/lsd2/tree/v.2.4.1" ext-link-type="uri">https://github.com/tothuhien/lsd2/tree/v.2.4.1</ext-link>, under strict molecular clock with outlier removal) using tip sampling dates, and reconstructed the ancestral characters for country with PastML (<xref rid="CIT0019" ref-type="bibr">Ishikawa et al., 2019</xref>) (v1.9.40, MPPA+F81).</p>
      <p>Lastly, we extracted 10 SLE forests from these trees to represent the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in our dataset) by (1) cutting each tree on July 30, 2014 to remove the more ancient part (with a different health policy); (2) among the July-31-on trees, picking those whose root’s predicted character state for country was SLE (light-green branches at the level of July 31, 2014 in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link> in online Appendix); (3) removing the non-SLE subtrees (indicated with other colors in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link>) from the selected July-31-on SLE trees to focus on the epidemic within the country, without further reintroductions.</p>
      <p>The reconstruction took 1 hour for the phylogeny, 10 minutes for tree dating, and 1 minute for country ancestral character prediction.</p>
    </sec>
  </sec>
</body>
<back>
  <ack id="a1">
    <title>Acknowledgments</title>
    <p>The authors thank Dr Jakub Voznica for valuable discussions.</p>
  </ack>
  <sec id="s17">
    <title>Supplementary Material</title>
    <p>Supplementary material, including data files and the online-only appendix, can be found in the Dryad data repository at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
  </sec>
  <sec id="s18">
    <title>Funding</title>
    <p>O.G. was supported by PRAIRIE (ANR-19-P3IA-0001). Y.M. was supported by European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation program (grant agreement No 810367), project EMC2.</p>
  </sec>
  <sec id="s19">
    <title>Author Contributions</title>
    <p>O.G. initiated the project and provided critical assessment of project progression; A.Z. conceived the new master equation representation, extension to forests, applications to Ebola and simulated data, and coordinated the project; F.H. and Y.M. conceived the numerical approach for fast and efficient parameter optimization; F.H. implemented the numerical approach; A.Z. wrote the manuscript with input from all the authors; all authors discussed the intermediate and final results.</p>
  </sec>
  <ref-list id="r1">
    <title>REFERENCES</title>
    <ref id="CIT0001">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2009</year>. <article-title>Accuracy and Performance of single versus double precision arithmetics for maximum likelihood phylogeny reconstruction Lecture Notes in Computer Science (including subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics)</article-title>. <volume>6068 LNCS</volume>:<fpage>270</fpage>–<lpage>279</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0002">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bouckaert</surname><given-names>R.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Duchêne</surname><given-names>S.</given-names></string-name>, <string-name><surname>Fourment</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gavryushkina</surname><given-names>A.</given-names></string-name>, <string-name><surname>Heled</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jones</surname><given-names>G.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Matschiner</surname><given-names>M.</given-names></string-name>, <string-name><surname>Mendes</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Müller</surname><given-names>N.F.</given-names></string-name>, <string-name><surname>Ogilvie</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Du Plessis</surname><given-names>L.</given-names></string-name>, <string-name><surname>Popinga</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.</given-names></string-name>, <string-name><surname>Siveroni</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C.H.</given-names></string-name>, <string-name><surname>Xie</surname><given-names>D.</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>C.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2019</year>. <article-title>BEAST 25: An advanced software platform for Bayesian evolutionary analysis</article-title>. <source>PLoS Comput. Biol</source>. <volume>15</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0003">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Butcher</surname><given-names>JC.</given-names></string-name></person-group><year>2016</year>. <source>Numerical methods for ordinary differential equations</source>. <edition>3 ed</edition>. <publisher-name>Wiley</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0004">
      <mixed-citation publication-type="other"><collab>CDC</collab>. <year>2020</year>. <comment>2014–2016 Ebola outbreak in West Africa: case counts</comment>. Available from <ext-link xlink:href="https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html" ext-link-type="uri">https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0005">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Crank</surname><given-names>J.</given-names></string-name>, <string-name><surname>Nicolson</surname><given-names>P.</given-names></string-name></person-group><year>1947</year>. <article-title>A practical method for numerical evaluation of solutions of partial differential equations of the heat-conduction type</article-title>. <source>Math. Proc. Camb. Philos. Soc</source>. <volume>43</volume>:<fpage>50</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0006">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Defour</surname><given-names>D.</given-names></string-name></person-group><year>2010</year>. <comment>Accuracy of a maximum likelihood phylogeny reconstruction. Technical report. LIRMM</comment>. Available from <ext-link xlink:href="https://hal.archives-ouvertes.fr/hal-00726409" ext-link-type="uri">https://hal.archives-ouvertes.fr/hal-00726409</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0007">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Shapiro</surname><given-names>B.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name></person-group><year>2005</year>. <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>. <source>Mol. Biol. Evol</source>. <volume>22</volume>:<fpage>1185</fpage>–<lpage>1192</lpage>.<pub-id pub-id-type="pmid">15703244</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0008">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Carvalho</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Tatem</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Baele</surname><given-names>G.</given-names></string-name>, <string-name><surname>Faria</surname><given-names>N.R.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Ladner</surname><given-names>J.T.</given-names></string-name>, <string-name><surname>Arias</surname><given-names>A.</given-names></string-name>, <string-name><surname>Asogun</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bielejec</surname><given-names>F.</given-names></string-name>, <string-name><surname>Caddy</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M.</given-names></string-name>, <string-name><surname>D’Ambrozio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Dellicour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Di Caro</surname><given-names>A.</given-names></string-name>, <string-name><surname>Diclaro</surname><given-names>J.W.</given-names></string-name>, <string-name><surname>Duraffour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Elmore</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Fakoli</surname><given-names>L.S.</given-names></string-name>, <string-name><surname>Faye</surname><given-names>O.</given-names></string-name>, <string-name><surname>Gilbert</surname><given-names>M.L.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gire</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gladden-Young</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Haagmans</surname><given-names>B.L.</given-names></string-name>, <string-name><surname>Hiscox</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Jah</surname><given-names>U.</given-names></string-name>, <string-name><surname>Kugelman</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Liu</surname><given-names>D.</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Mate</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matthews</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Meredith</surname><given-names>L.W.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Quick</surname><given-names>J.</given-names></string-name>, <string-name><surname>Pas</surname><given-names>S.D.</given-names></string-name>, <string-name><surname>Phan</surname><given-names>M.V.T.</given-names></string-name>, <string-name><surname>Pollakis</surname><given-names>G.</given-names></string-name>, <string-name><surname>Reusken</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Sanchez-Lockhart</surname><given-names>M.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Schieffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Simon-Loriere</surname><given-names>E.</given-names></string-name>, <string-name><surname>Smits</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Stoecker</surname><given-names>K.</given-names></string-name>, <string-name><surname>Thorne</surname><given-names>L.</given-names></string-name>, <string-name><surname>Tobin</surname><given-names>E.A.</given-names></string-name>, <string-name><surname>Vandi</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Watson</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>West</surname><given-names>K.</given-names></string-name>, <string-name><surname>Whitmer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wiley</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wölfel</surname><given-names>R.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Blyden</surname><given-names>S.O.</given-names></string-name>, <string-name><surname>Bolay</surname><given-names>F.</given-names></string-name>, <string-name><surname>Carroll</surname><given-names>M.W.</given-names></string-name>, <string-name><surname>Dahn</surname><given-names>B.</given-names></string-name>, <string-name><surname>Diallo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Formenty</surname><given-names>P.</given-names></string-name>, <string-name><surname>Fraser</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gao</surname><given-names>G.F.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Goodfellow</surname><given-names>I.</given-names></string-name>, <string-name><surname>Günther</surname><given-names>S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.T.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Keïta</surname><given-names>S.</given-names></string-name>, <string-name><surname>Kellam</surname><given-names>P.</given-names></string-name>, <string-name><surname>Koopmans</surname><given-names>M.P.G.</given-names></string-name>, <string-name><surname>Kuhn</surname><given-names>J.H.</given-names></string-name>, <string-name><surname>Loman</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Magassouba</surname><given-names>N.</given-names></string-name>, <string-name><surname>Naidoo</surname><given-names>D.</given-names></string-name>, <string-name><surname>Nichol</surname><given-names>S.T.</given-names></string-name>, <string-name><surname>Nyenswah</surname><given-names>T.</given-names></string-name>, <string-name><surname>Palacios</surname><given-names>G.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name>, <string-name><surname>Sall</surname><given-names>A.</given-names></string-name>, <string-name><surname>Ströher</surname><given-names>U.</given-names></string-name>, <string-name><surname>Wurie</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Lemey</surname><given-names>P.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name></person-group><year>2017</year>. <article-title>Virus genomes reveal factors that spread and sustained the Ebola epidemic</article-title>. <source>Nature</source>. <volume>544</volume>:<fpage>309</fpage>–<lpage>315</lpage>.<pub-id pub-id-type="pmid">28405027</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0009">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Felsenstein</surname><given-names>J.</given-names></string-name></person-group><year>1973</year>. <article-title>Maximum likelihood and minimum-steps methods for estimating evolutionary trees from data on discrete characters</article-title>. <source>Syst. Biol</source>. <volume>22</volume>:<fpage>240</fpage>–<lpage>249</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0010">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>FitzJohn</surname><given-names>R.G.</given-names></string-name>, <string-name><surname>Maddison</surname><given-names>W.P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.P.</given-names></string-name></person-group><year>2009</year>. <article-title>Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies</article-title>. <source>Syst. Biol</source>. <volume>58</volume>:<fpage>595</fpage>–<lpage>611</lpage>.<pub-id pub-id-type="pmid">20525612</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0011">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gire</surname><given-names>S.K.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>L.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>S.</given-names></string-name>, <string-name><surname>Momoh</surname><given-names>M.</given-names></string-name>, <string-name><surname>Fullah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Moses</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gladden</surname><given-names>A.D.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X.</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>P.P.</given-names></string-name>, <string-name><surname>Nekoui</surname><given-names>M.</given-names></string-name>, <string-name><surname>Colubri</surname><given-names>A.</given-names></string-name>, <string-name><surname>Coomber</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Fonnie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Moigboi</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gbakie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kamara</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Tucker</surname><given-names>V.</given-names></string-name>, <string-name><surname>Konuwa</surname><given-names>E.</given-names></string-name>, <string-name><surname>Saffa</surname><given-names>S.</given-names></string-name>, <string-name><surname>Sellu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>A.A.</given-names></string-name>, <string-name><surname>Kovoma</surname><given-names>A.</given-names></string-name>, <string-name><surname>Koninga</surname><given-names>J.</given-names></string-name>, <string-name><surname>Mustapha</surname><given-names>I.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>K.</given-names></string-name>, <string-name><surname>Foday</surname><given-names>M.</given-names></string-name>, <string-name><surname>Yillah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>F.</given-names></string-name>, <string-name><surname>Robert</surname><given-names>W.</given-names></string-name>, <string-name><surname>Massally</surname><given-names>J.L.</given-names></string-name>, <string-name><surname>Chapman</surname><given-names>S.B.</given-names></string-name>, <string-name><surname>Bochicchio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>C.</given-names></string-name>, <string-name><surname>Nusbaum</surname><given-names>C.</given-names></string-name>, <string-name><surname>Young</surname><given-names>S.</given-names></string-name>, <string-name><surname>Birren</surname><given-names>B.W.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Scheiffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Lander</surname><given-names>E.S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Khan</surname><given-names>S.H.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name></person-group><year>2014</year>. <article-title>Genomic surveillance elucidates Ebola virus origin and transmission during the 2014 outbreak</article-title>. <source>Science</source>. <volume>345</volume>:<fpage>1369</fpage>–<lpage>1372</lpage>.<pub-id pub-id-type="pmid">25214632</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0012">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goldberg</surname><given-names>E.E.</given-names></string-name>, <string-name><surname>Igić</surname><given-names>B.</given-names></string-name></person-group><year>2012</year>. <article-title>Tempo and mode in plant breeding system evolution</article-title>. <source>Evolution</source><volume>66</volume>:<fpage>3701</fpage>–<lpage>3709</lpage>. _eprint: <ext-link xlink:href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x" ext-link-type="uri">https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x</ext-link><pub-id pub-id-type="pmid">23206129</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0013">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grenfell</surname><given-names>B.T.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Gog</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Wood</surname><given-names>J.L.N.</given-names></string-name>, <string-name><surname>Daly</surname><given-names>J.M.</given-names></string-name>, <string-name><surname>Mumford</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name></person-group><year>2004</year>. <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source>. <volume>303</volume>(<issue>5656</issue>):<fpage>327</fpage>–<lpage>332</lpage>.<pub-id pub-id-type="pmid">14726583</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0014">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Harris</surname><given-names>C.R.</given-names></string-name>, <string-name><surname>Millman</surname><given-names>K.J.</given-names></string-name>, <string-name><surname>van der Walt</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>Gommers</surname><given-names>R.</given-names></string-name>, <string-name><surname>Virtanen</surname><given-names>P.</given-names></string-name>, <string-name><surname>Cournapeau</surname><given-names>D.</given-names></string-name>, <string-name><surname>Wieser</surname><given-names>E.</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>J.</given-names></string-name>, <string-name><surname>Berg</surname><given-names>S.</given-names></string-name>, <string-name><surname>Smith</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Kern</surname><given-names>R.</given-names></string-name>, <string-name><surname>Picus</surname><given-names>M.</given-names></string-name>, <string-name><surname>Hoyer</surname><given-names>S.</given-names></string-name>, <string-name><surname>van Kerkwijk</surname><given-names>M.H.</given-names></string-name>, <string-name><surname>Brett</surname><given-names>M.</given-names></string-name>, <string-name><surname>Haldane</surname><given-names>A.</given-names></string-name>, <string-name><surname>del Río</surname><given-names>J.F.</given-names></string-name>, <string-name><surname>Wiebe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Peterson</surname><given-names>P.</given-names></string-name>, <string-name><surname>Gérard-Marchant</surname><given-names>P.</given-names></string-name>, <string-name><surname>Sheppard</surname><given-names>K.</given-names></string-name>, <string-name><surname>Reddy</surname><given-names>T.</given-names></string-name>, <string-name><surname>Weckesser</surname><given-names>W.</given-names></string-name>, <string-name><surname>Abbasi</surname><given-names>H.</given-names></string-name>, <string-name><surname>Gohlke</surname><given-names>C.</given-names></string-name>, <string-name><surname>Oliphant</surname><given-names>T.E.</given-names></string-name></person-group><year>2020</year>. <article-title>Array programming with NumPy</article-title>. <source>Nature</source>. <volume>585</volume>:<fpage>357</fpage>–<lpage>362</lpage>.<pub-id pub-id-type="pmid">32939066</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0015">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hethcote</surname><given-names>H.W.</given-names></string-name></person-group><year>2000</year>. <article-title>The mathematics of infectious diseases</article-title>. <source>SIAM Rev</source>. <volume>42</volume>:<fpage>599</fpage>–<lpage>653</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0016">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hodcroft</surname><given-names>E.B.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Lanfear</surname><given-names>R.</given-names></string-name>, <string-name><surname>MacCannell</surname><given-names>D.R.</given-names></string-name>, <string-name><surname>Minh</surname><given-names>B.Q.</given-names></string-name>, <string-name><surname>Schmidt</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goldman</surname><given-names>N.</given-names></string-name>, <string-name><surname>Dessimoz</surname><given-names>C.</given-names></string-name></person-group><year>2021</year>. <article-title>Want to track pandemic variants faster? Fix the bioinformatics bottleneck</article-title>. <source>Nature</source>. <volume>591</volume>:<fpage>30</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">33649511</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0017">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huerta-Cepas</surname><given-names>J.</given-names></string-name>, <string-name><surname>Serra</surname><given-names>F.</given-names></string-name>, <string-name><surname>Bork</surname><given-names>P.</given-names></string-name></person-group><year>2016</year>. <article-title>ETE 3: reconstruction, analysis, and visualization of phylogenomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>1635</fpage>–<lpage>1638</lpage>.<pub-id pub-id-type="pmid">26921390</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0018">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hunter</surname><given-names>J.D.</given-names></string-name></person-group><year>2007</year>. <article-title>Matplotlib: A 2D graphics environment</article-title>. <source>Comput. Sci. Eng</source>. <volume>9</volume>:<fpage>90</fpage>–<lpage>95</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0019">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ishikawa</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Iwasaki</surname><given-names>W.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2019</year>. <article-title>A fast likelihood method to reconstruct and visualize ancestral scenarios</article-title>. <source>Mol. Biol. Evol</source>. <volume>36</volume>:<fpage>2069</fpage>–<lpage>2085</lpage>.<pub-id pub-id-type="pmid">31127303</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0020">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>SG.</given-names></string-name></person-group><comment>The nlopt nonlinear-optimization package</comment>. Accessed: <comment>2021-01-26</comment>.</mixed-citation>
    </ref>
    <ref id="CIT0021">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kendall</surname><given-names>D.G.</given-names></string-name></person-group><year>1948</year>. <article-title>On the generalized “birth-and-death” process</article-title>. <source>Ann. Math</source>. <volume>19</volume>:<fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0022">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><year>2012</year>. <article-title>Snakemake-a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source>. <volume>28</volume>:<fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0023">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>A.M.</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D.</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>B.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2019</year>. <article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source>. <volume>35</volume>:<fpage>4453</fpage>–<lpage>4455</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0024">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2016</year>. <article-title>Phylodynamics with migration: a computational framework to quantify population structure from genomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>2102</fpage>–<lpage>2116</lpage>.<pub-id pub-id-type="pmid">27189573</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0025">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2020</year>. <article-title>A general and efficient algorithm for the likelihood of diversification and discrete-trait evolutionary models</article-title>. <source>Syst. Biol</source>. <volume>69</volume>:<fpage>545</fpage>–<lpage>556</lpage>.<pub-id pub-id-type="pmid">31432088</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0026">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Macpherson</surname><given-names>A.</given-names></string-name>, <string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Mclaughlin</surname><given-names>A.</given-names></string-name>, <string-name><surname>Joy</surname><given-names>J.B.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2021</year>. <article-title>Unifying phylogenetic birth-death models in epidemiology and macroevolution</article-title>. <source>Syst. Biol</source>. <volume>71</volume>(<issue>1</issue>):<fpage>172</fpage>–<lpage>189</lpage>.<pub-id pub-id-type="pmid">34165577</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0027">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maddison</surname><given-names>W.</given-names></string-name>, <string-name><surname>Midford</surname><given-names>P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.</given-names></string-name></person-group><year>2007</year>. <article-title>Estimating a binary character’s effect on speciation and extinction</article-title>. <source>Syst. Biol</source>. <volume>56</volume>:<fpage>701</fpage>–<lpage>710</lpage>.<pub-id pub-id-type="pmid">17849325</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0028">
      <mixed-citation publication-type="other"><collab>News24</collab>. <year>2014</year>. <comment>Sierra leone, liberia deploy troops for ebola</comment>. Available from <ext-link xlink:href="https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804" ext-link-type="uri">https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0029">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Harvey</surname><given-names>P.H.</given-names></string-name></person-group><year>2000</year>. <article-title>An integrated framework for the inference of viral population history from reconstructed genealogies</article-title>. <source>Genetics</source>. <volume>155</volume>:<fpage>1429</fpage>–<lpage>1437</lpage>.<pub-id pub-id-type="pmid">10880500</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0030">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rivers</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Lofgren</surname><given-names>E.T.</given-names></string-name>, <string-name><surname>Marathe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Eubank</surname><given-names>S.</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>B.L.</given-names></string-name></person-group><year>2014</year>. <article-title>Modeling the impact of interventions on an epidemic of Ebola in Sierra Leone and Liberia</article-title>. <source>PLoS Curr</source>. <volume>6</volume>:ecurrents.outbreaks.4d41fe5d6c05e9df30ddce33c66d084c.</mixed-citation>
    </ref>
    <ref id="CIT0031">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scire</surname><given-names>J.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2022</year>. <article-title>Robust phylodynamic analysis of genetic sequencing data from structured populations</article-title>. <source>Viruses</source>. <volume>14</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0032">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2009</year>. <article-title>On incomplete sampling under birth-death models and connections to the sampling-based coalescent</article-title>. <source>J. Theor. Biol</source>. <volume>261</volume>:<fpage>58</fpage>–<lpage>66</lpage>.<pub-id pub-id-type="pmid">19631666</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0033">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2010</year>. <article-title>Sampling-through-time in birth-death trees</article-title>. <source>J. Theor. Biol</source>. <volume>267</volume>:<fpage>396</fpage>–<lpage>404</lpage>.<pub-id pub-id-type="pmid">20851708</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0034">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name></person-group><year>2013</year>. <article-title>Uncovering epidemiological dynamics in heterogeneous host populations using phylogenetic methods</article-title>. <source>Philos. Trans. R. Soc. B Biol. Sci</source><volume>368</volume>:<fpage>20120198</fpage>–<lpage>20120198</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0035">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2013</year>. <article-title>Birth-death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>110</volume>:<fpage>228</fpage>–<lpage>233</lpage>.<pub-id pub-id-type="pmid">23248286</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0036">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>du Plessis</surname><given-names>L.</given-names></string-name></person-group><year>2014</year>. <article-title>Insights into the early epidemic spread of Ebola in Sierra Leone provided by viral sequence data</article-title>. <source>PLoS Curr</source><volume>6</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0037">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Svanberg</surname><given-names>K.</given-names></string-name></person-group><year>2002</year>. <article-title>A class of globally convergent optimization methods based on conservative convex separable approximations</article-title>. <source>SIAM J. Optimiz</source><volume>12</volume>:<fpage>555</fpage>–<lpage>573</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0038">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2014</year>. <article-title>Ebola Virus disease in West Africa — the first 9 months of the epidemic and forward projections</article-title>. <source>N. Engl. J. Med</source>. <volume>371</volume>:<fpage>1481</fpage>–<lpage>1495</lpage>.<pub-id pub-id-type="pmid">25244186</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0039">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2015</year>. <article-title>West African ebola epidemic after one year — slowing but not yet under control</article-title>. <source>N. Engl. J. Med</source>. <volume>372</volume>:<fpage>584</fpage>–<lpage>587</lpage>.<pub-id pub-id-type="pmid">25539446</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0040">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>To</surname><given-names>T.H.</given-names></string-name>, <string-name><surname>Jung</surname><given-names>M.</given-names></string-name>, <string-name><surname>Lycett</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2016</year>. <article-title>Fast dating using least-squares criteria and algorithms</article-title>. <source>Syst. Biol</source>. <volume>65</volume>:<fpage>82</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">26424727</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0041">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Van Kerkhove</surname><given-names>M.D.</given-names></string-name>, <string-name><surname>Bento</surname><given-names>A.I.</given-names></string-name>, <string-name><surname>Mills</surname><given-names>H.L.</given-names></string-name>, <string-name><surname>Ferguson</surname><given-names>N.M.</given-names></string-name>, <string-name><surname>Donnelly</surname><given-names>C.A.</given-names></string-name></person-group><year>2015</year>. <article-title>A review of epidemiological parameters from Ebola outbreaks to inform early public health decision-making</article-title>. <source>Sci. Data</source>. <volume>2</volume>:<fpage>1</fpage>–<lpage>10</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0042">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Koelle</surname><given-names>K.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bhattacharya</surname><given-names>T.</given-names></string-name>, <string-name><surname>Delaporte</surname><given-names>E.</given-names></string-name></person-group><year>2013</year>. <article-title>Viral phylodynamics</article-title>. <source>PLoS Comput. Biol</source>. <volume>9</volume>:<fpage>e1002947</fpage>.<pub-id pub-id-type="pmid">23555203</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0043">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Kosakovsky Pond</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Ward</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Leigh Brown</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Frost</surname><given-names>S.D.</given-names></string-name></person-group><year>2009</year>. <article-title>Phylodynamics of infectious disease epidemics</article-title>. <source>Genetics</source>. <volume>183</volume>:<fpage>1421</fpage>–<lpage>1430</lpage>.<pub-id pub-id-type="pmid">19797047</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0044">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Boskova</surname><given-names>V.</given-names></string-name>, <string-name><surname>Saulnier</surname><given-names>E.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Moslonka-Lefebvre</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2022</year>. <article-title>Deep learning from phylogenies to uncover the transmission dynamics of epidemics</article-title>. <source>Nat. Commun</source>. <volume>13</volume>:<fpage>3896</fpage>.<pub-id pub-id-type="pmid">35794110</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0045">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Waskom</surname><given-names>M.L.</given-names></string-name></person-group><year>2021</year>. <article-title>seaborn: statistical data visualization</article-title>. <source>J. Open Source Software</source>. <volume>6</volume>:<fpage>3021</fpage>.</mixed-citation>
    </ref>
    <ref id="CIT0046">
      <mixed-citation publication-type="other"><collab>WHO</collab>. <year>2021</year>. <comment>Ebola virus disease [fact sheet]</comment>. Available from <ext-link xlink:href="https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease" ext-link-type="uri">https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0047">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wilks</surname><given-names>S.S.</given-names></string-name></person-group><year>1938</year>. <article-title>The large-sample distribution of the likelihood ratio for testing composite hypotheses</article-title>. <source>Ann. Math. Stat</source>. <volume>9</volume>:<fpage>60</fpage>–<lpage>62</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0048">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Williams</surname><given-names>A.</given-names></string-name></person-group><year>2012</year>. <source>C++ concurrency in action: practical multithreading</source>, <edition>1</edition>st ed. <publisher-loc>Shelter Island, NY</publisher-loc>: <publisher-name>Manning Publications</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0049">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Blassel</surname><given-names>L.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>M.</given-names></string-name>, <string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2020</year>. <article-title>Origin, evolution and global spread of SARS-CoV-2</article-title>. <source>C.R. Biol</source>. <volume>344</volume>(<issue>1</issue>):<fpage>57</fpage>–<lpage>75</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Syst Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Syst Biol</journal-id>
    <journal-id journal-id-type="publisher-id">sysbio</journal-id>
    <journal-title-group>
      <journal-title>Systematic Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1063-5157</issn>
    <issn pub-type="epub">1076-836X</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
      <publisher-loc>US</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10924745</article-id>
    <article-id pub-id-type="pmid">37703335</article-id>
    <article-id pub-id-type="doi">10.1093/sysbio/syad059</article-id>
    <article-id pub-id-type="publisher-id">syad059</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Regular Manuscripts</subject>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI00960</subject>
        <subject>AcademicSubjects/SCI01130</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Fast and Accurate Maximum-Likelihood Estimation of Multi-Type Birth–Death Epidemiological Models from Phylogenetic Trees</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2200-7935</contrib-id>
        <name>
          <surname>Zhukova</surname>
          <given-names>Anna</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Bioinformatics and Biostatistics Hub, Institut Pasteur</institution>, <addr-line>Université de Paris, 28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c1" ref-type="corresp"/>
        <!--anna.zhukova@pasteur.fr-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hecht</surname>
          <given-names>Frédéric</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Maday</surname>
          <given-names>Yvon</given-names>
        </name>
        <aff><institution>Sorbonne Université, CNRS, Université Paris Cité, Laboratoire Jacques-Louis Lions (LJLL)</institution>, <addr-line>4 place Jussieu, F-75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut Universitaire de France, 1 rue Descartes</institution>, <addr-line>75231 Paris CEDEX 05</addr-line>, <country country="FR">France</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9412-9723</contrib-id>
        <name>
          <surname>Gascuel</surname>
          <given-names>Olivier</given-names>
        </name>
        <aff><institution>Unité Bioinformatique Evolutive, Institut Pasteur, Université de Paris</institution>, <addr-line>28 rue du docteur Roux, 75015 Paris</addr-line>, <country country="FR">France</country></aff>
        <aff><institution>Institut de Systématique, Evolution</institution>, <addr-line>Biodiversité (ISYEB) - URM 7205 CNRS, Museum National d’Histoire Naturelle, SU, EPHE &amp; UA, 57 rue Cuvier, CP 50 75005 Paris</addr-line>, <country country="FR">France</country></aff>
        <xref rid="c2" ref-type="corresp"/>
        <!--olivier.gascuel@mnhn.fr-->
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="c1">Correspondence to be sent to: Anna Zhukova, Bioinformatics and Biostatistics Hub, Institut Pasteur, Universit#x00E9; de Paris, 28 rue du docteur Roux 75015 Paris, France; E-mail: <email>anna.zhukova@pasteur.fr</email>;</corresp>
      <corresp id="c2">Olivier Gascuel, Institut de Syst#x00E9;matique, Evolution, Biodiversit#x00E9; (ISYEB UMR7205–CNRS, Mus#x00E9;um National d’Histoire Naturelle, SU, EPHE, UA), 57 rue Cuvier, CP 50 75005 Paris, France; E-mail: <email>olivier.gascuel@mnhn.fr</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>11</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-09-13">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>13</day>
      <month>9</month>
      <year>2023</year>
    </pub-date>
    <volume>72</volume>
    <issue>6</issue>
    <fpage>1387</fpage>
    <lpage>1402</lpage>
    <history>
      <date date-type="received">
        <day>02</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>07</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>21</day>
        <month>10</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press on behalf of the Society of Systematic Biologists.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution-NonCommercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non.commercial re.use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re.use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="syad059.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>Multi-type birth–death (MTBD) models are phylodynamic analogies of compartmental models in classical epidemiology. They serve to infer such epidemiological parameters as the average number of secondary infections <italic toggle="yes">R<sub>e</sub></italic> and the infectious time from a phylogenetic tree (a genealogy of pathogen sequences). The representatives of this model family focus on various aspects of pathogen epidemics. For instance, the birth–death exposed-infectious (BDEI) model describes the transmission of pathogens featuring an incubation period (when there is a delay between the moment of infection and becoming infectious, as for Ebola and SARS-CoV-2), and permits its estimation along with other parameters. With constantly growing sequencing data, MTBD models should be extremely useful for unravelling information on pathogen epidemics. However, existing implementations of these models in a phylodynamic framework have not yet caught up with the sequencing speed. Computing time and numerical instability issues limit their applicability to medium data sets (≤ 500 samples), while the accuracy of estimations should increase with more data.</p>
      <p>We propose a new highly parallelizable formulation of ordinary differential equations for MTBD models. We also extend them to forests to represent situations when a (sub-)epidemic started from several cases (e.g., multiple introductions to a country). We implemented it for the BDEI model in a maximum likelihood framework using a combination of numerical analysis methods for efficient equation resolution. Our implementation estimates epidemiological parameter values and their confidence intervals in two minutes on a phylogenetic tree of 10,000 samples. Comparison to the existing implementations on simulated data shows that it is not only much faster but also more accurate. An application of our tool to the 2014 Ebola epidemic in Sierra-Leone is also convincing, with very fast calculation and precise estimates. As MTBD models are closely related to Cladogenetic State Speciation and Extinction (ClaSSE)-like models, our findings could also be easily transferred to the macroevolution domain.</p>
    </abstract>
    <kwd-group>
      <kwd>Birth–death model</kwd>
      <kwd>Ebola</kwd>
      <kwd>epidemiology</kwd>
      <kwd>mathematical modelling</kwd>
      <kwd>ordinary differential equations</kwd>
      <kwd>phylodynamics</kwd>
    </kwd-group>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>PRAIRIE</institution>
          </institution-wrap>
        </funding-source>
        <award-id>ANR-19-P3IA-0001</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000781</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>810367</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="16"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>The interaction of epidemiological and evolutionary processes leaves a footprint in pathogen genomes. Phylodynamics leverages this footprint to estimate epidemiological parameters, such as the average number of secondary infections, <inline-formula><mml:math id="m20" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> (<xref rid="CIT0013" ref-type="bibr">Grenfell et al., 2004</xref>; <xref rid="CIT0042" ref-type="bibr">Volz et al., 2013</xref>). It relies on models that bridge the gap between traditional epidemiology and sequence data. Under these models, the parameter inference is drawn from topology and branch lengths of pathogen phylogenetic trees (i.e., genealogies of the pathogen population, approximating the transmission trees) combined with metadata on the samples. This is particularly useful for emerging epidemics, for which not enough data (e.g., incidence curves) might yet be gathered for accurate estimations with classical epidemiological methods. Rapidly growing genetic data coupled with phylodynamic estimations can provide valuable insights at an early stage of the epidemic spread and help prevent it (e.g., accurate estimation of <inline-formula><mml:math id="m21" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> is crucial for adjusting potential non-pharmaceutical interventions, such as lockdowns).</p>
  <p>Phylodynamic models can be classified into two main families: coalescent (<xref rid="CIT0043" ref-type="bibr">Volz et al., 2009</xref>; <xref rid="CIT0007" ref-type="bibr">Drummond et al., 2005</xref>; <xref rid="CIT0029" ref-type="bibr">Pybus et al., 2000</xref>) and birth–death (BD) (<xref rid="CIT0021" ref-type="bibr">Kendall, 1948</xref>; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>, <xref rid="CIT0033" ref-type="bibr">2010</xref>). Coalescent models are often preferred for estimating deterministic population dynamics; however, BD models are better adapted for highly stochastic processes, such as the dynamics of emerging pathogens (<xref rid="CIT0026" ref-type="bibr">Macpherson et al., 2021</xref>). In BD models, births represent pathogen transmission events, while deaths correspond to becoming non-infectious (e.g., due to healing, self-isolation, starting a treatment, or death). Models of the BD family are phylodynamic analogies of compartmental models in classical epidemiology (e.g., SIR, Susceptible-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>). Many extensions of the classical BD model with incomplete sampling (BDS; <xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) were developed over time, including multi-type birth-death (MTBD) models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). They add a population structure to the classical birth-death process by allowing for different types of individuals. A particularly useful representative of the MTBD family is the birth–death exposed-infectious (BDEI) model (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>). It was designed for pathogens featuring an incubation period between the moments of infection and of becoming infectious, e.g., Ebola and SARS-CoV-2. It is closely related to the SEIR (Susceptible-Exposed-Infectious-Recovered; <xref rid="CIT0015" ref-type="bibr">Hethcote, 2000</xref>) model, widely used in classical epidemiology.</p>
  <p>In MTBD framework, the evolution of a transmission tree is described with a system of master differential equations with respect to global time. The model parameters can be estimated with maximum-likelihood (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) or Bayesian methods (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) by exploring the likelihood (or posterior probability) landscape of trees. However, the closed form solution of the master equations exists only for the initial BDS model (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), while for its extensions (like the BDEI model and MTBD models in general) the master equations for likelihood calculation need to be resolved with numerical methods. The complexity of the master equations and their boundary conditions (which recursively depend on the tree evolution later in time), make their numerical resolution challenging and time consuming (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>).</p>
  <p>The trade-off between the complexity of the biological questions a model can address and the computational speed for its parameter estimation is crucial in phylodynamics. On one hand, denser sampling should improve the accuracy of parameter estimations with complex models. On the other hand, denser sampling leads to larger data sets (thousands of samples), while computational issues often limit model applicability to medium or small ones (hundreds of samples). Calculations become time-consuming and numerically challenging (e.g., due to underflow issues) as tree size increases, resulting in numerical instability and inaccuracy (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>; <xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). Existing likelihood-based implementations of MTBD models (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>; <xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) can handle trees of medium size. In <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) we proposed PhyloDeep, a likelihood-free deep-learning-based solution to the numerical instability issue. While being very efficient and accurate at the prediction stage, this approach however requires a computationally heavy training stage: Millions of trees covering a wide parameter range (where the real data is expected to fall) need to be simulated for training the deep learning predictor.</p>
  <p>In the macroevolution domain, there exist several models that are closely related to the MTBD models. These are the models of the State Speciation and Extinction (SSE) family, in which the births correspond to species specifications and the deaths correspond to extinctions. The main difference is that in epidemiological models sampling happens through time, while in the macroevolution ones it usually occurs at present (at the extant species). Important representatives of the SSE model family include the Binary SSE (BiSSE; <xref rid="CIT0027" ref-type="bibr">Maddison et al., 2007</xref>) model, which introduced two compartments with a possibility of anagenetic state change between them (i.e., along the tree branches), its extension to any number of states (multiple SSE, MuSSE; <xref rid="CIT0010" ref-type="bibr">FitzJohn et al., 2009</xref>), and the cladogenetic SSE (ClaSSE; <xref rid="CIT0012" ref-type="bibr">Goldberg and Igić, 2012</xref>) model, which introduced a possibility of cladogenetic state changes (i.e., when one of the offsprings may have a different state from its parent’s one right after the speciation event). In a recent work, <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>) described a general mathematical framework for efficient likelihood calculation of these types of models, based on the “flow”, and implemented it for the MuSSE-like models but not for the ClaSSE-like ones. However, macroevolutionary analogues of the BDEI and general MTBD models belong to the ClaSSE-like family (as they permit a donor and a recipient to be in different states at the moment of transmission), and an efficient parameter estimator for these models on very large trees is currently lacking.</p>
  <p>In this study, we introduce a likelihood-based approach that intends to improve the accuracy and reduce the likelihood computation time of MTBD models. We propose a new formulation of the MTBD master equations that (i) removes the recursive dependency between child and parent nodes in the tree, hence permitting their parallel computation, and (ii) avoids numerical issues that could arise from very small boundary condition values. Under our approach, the master equations are resolved in parallel for different tree nodes, and then combined into the tree likelihood. In the general MTBD case the combination step is performed in a computationally light recursive way. However, we identified a subclass of MTBD models (including the BDEI model) whose likelihood formulae can be expressed in a non-recursive manner, thus allowing for even simpler calculations. Additionally, we extend the MTBD model-applicability from single trees to forests. Forests could correspond to multiple introductions of the epidemic to the region of interest, or to a health policy change, which led to a new epidemic stage starting with severalcases.</p>
  <p>We applied our findings to the BDEI model and implemented its parameter estimator PyBDEI, employing targeted numerical analysis methods for accurate and fast resolution of its equations. We show the accuracy and speed of PyBDEI on simulated data and compare it to the gold standard Bayesian tool BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep-learning-based tool PhyloDeep (<xref rid="CIT0044" ref-type="bibr">Voznica et al., 2022</xref>). We find that our approach outperforms the competitors and makes the BDEI model applicable to very large data sets. Lastly, we apply PyBDEI to infer the epidemiological parameters that shaped the Ebola epidemic in Sierra-Leone in 2014. Our estimator is freely available at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">https://github.com/evolbioinfo/bdei</ext-link>.</p>
  <sec id="s1">
    <title>MTBD models and their special case, the BDEI model</title>
    <p>In a pathogen transmission tree <inline-formula><mml:math id="m22" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> (approximated by a time-scaled pathogen phylogeny) the tips represent sampled pathogens, patient state transitions occur along the branches, and bifurcations (i.e., internal nodes) correspond to transmissions (<xref rid="F1" ref-type="fig">Fig. 1</xref>). The tree branch lengths are measured in units of time, where <inline-formula><mml:math id="m23" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> is the time that passed between the beginning of the (sub-)epidemic (<inline-formula><mml:math id="m24" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:math></inline-formula>, corresponding to the time of the root in <xref rid="F1" ref-type="fig">Fig. 1</xref>) and the last sampled tip.</p>
    <fig position="float" id="F1">
      <label>Figure 1</label>
      <caption>
        <p>A transmission tree <inline-formula><mml:math id="m25" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> with <inline-formula><mml:math id="m26" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula> external nodes (i.e., tips, which correspond to sampling events: <inline-formula><mml:math id="m27" display="inline" overflow="scroll"><mml:mrow><mml:mn>0000</mml:mn><mml:mo>,</mml:mo><mml:mn>0001</mml:mn><mml:mo>,</mml:mo><mml:mn>001</mml:mn><mml:mo>,</mml:mo><mml:mn>010</mml:mn><mml:mo>,</mml:mo><mml:mn>011</mml:mn></mml:mrow></mml:math></inline-formula>), <inline-formula><mml:math id="m28" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> internal nodes (which correspond to transmissions: <inline-formula><mml:math id="m29" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> (the root) and <inline-formula><mml:math id="m30" display="inline" overflow="scroll"><mml:mrow><mml:mn>00</mml:mn><mml:mo>,</mml:mo><mml:mn>01</mml:mn><mml:mo>,</mml:mo><mml:mn>000</mml:mn></mml:mrow></mml:math></inline-formula>) and <inline-formula><mml:math id="m31" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> branches (plus the root branch of zero length). Time <inline-formula><mml:math id="m32" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> starts at the beginning of the (sub-)epidemic (here represented by the root of the tree, <inline-formula><mml:math id="m33" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>) and goes till the last sampled tip. The times of the nodes are shown on the left, e.g., <inline-formula><mml:math id="m34" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mn>0001</mml:mn></mml:msub></mml:math></inline-formula> is the time of tip <inline-formula><mml:math id="m35" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula> (when <inline-formula><mml:math id="m36" display="inline" overflow="scroll"><mml:mn>0001</mml:mn></mml:math></inline-formula>’s pathogen was sampled). <inline-formula><mml:math id="m37" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula> corresponds to the end of the sampling period (when the most recent tip, <inline-formula><mml:math id="m38" display="inline" overflow="scroll"><mml:mn>0000</mml:mn></mml:math></inline-formula>, was sampled).</p>
      </caption>
      <graphic xlink:href="syad059_fig1" position="float"/>
    </fig>
    <p><bold>The basic BDS model</bold> (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>) has only one state: <italic toggle="yes">infectious</italic><inline-formula><mml:math id="m39" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. An individual in state <inline-formula><mml:math id="m40" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit their pathogen to another individual (whose state will be also <inline-formula><mml:math id="m41" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m42" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or stop being infectious at a constant average rate <inline-formula><mml:math id="m43" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (due to treatment start, healing, self-isolation or death). After stopping being infectious, the individual and their pathogen exit the study, at which point the pathogen might get sampled with a probability <inline-formula><mml:math id="m44" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. The sampling is incomplete: an infectious individual may be removed from the system without being sampled (i.e., unobserved in the transmission tree), for example due to healing. The BDS model permits inference of such important epidemiological parameters as</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">effective reproduction number</italic><inline-formula><mml:math id="m45" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mi>λ</mml:mi><mml:mi>ψ</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula>, expected number of individuals directly infected by an infectious case;</p>
      </list-item>
      <list-item>
        <p><italic toggle="yes">infectious time</italic><inline-formula><mml:math id="m46" display="inline" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>ψ</mml:mi></mml:mfrac></mml:math></inline-formula>, time during which an infectious individual can further spread the epidemic.</p>
      </list-item>
    </list>
    <p>The BDS model is asymptotically unidentifiable (see <xref rid="CIT0032" ref-type="bibr">Remark 3.4 by Stadler, 2009</xref>), but to become identifiable it requires one of the parameters to be fixed.</p>
    <p><bold>MTBD models</bold> (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>) add population structure by allowing different individual states, transmissions between them and state changes. A general MTBD model with <inline-formula><mml:math id="m47" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> individual states has <inline-formula><mml:math id="m48" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> parameters: An individual in state <inline-formula><mml:math id="m49" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m50" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be removed at a constant average rate <inline-formula><mml:math id="m51" display="inline" overflow="scroll"><mml:msub><mml:mi>ψ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> (with pathogen sampling probability <inline-formula><mml:math id="m52" display="inline" overflow="scroll"><mml:msub><mml:mi>ρ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>), change their state to state <inline-formula><mml:math id="m53" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> (<inline-formula><mml:math id="m54" display="inline" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) at a constant average rate <inline-formula><mml:math id="m55" display="inline" overflow="scroll"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (where <inline-formula><mml:math id="m56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), and transmit their pathogen to an individual in state <inline-formula><mml:math id="m57" display="inline" overflow="scroll"><mml:mi>l</mml:mi></mml:math></inline-formula> at a constant average rate <inline-formula><mml:math id="m58" display="inline" overflow="scroll"><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The time between events of the same type is hence modelled with exponential distribution.</p>
    <p><bold>The BDEI model</bold> (<xref rid="CIT0036" ref-type="bibr">Stadler et al., 2014</xref>) (<xref rid="F2" ref-type="fig">Fig. 2</xref>), for example, is a special case of MTBD models that adds a second possible state to the state <inline-formula><mml:math id="m59" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>: <italic toggle="yes">exposed</italic><inline-formula><mml:math id="m60" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>, an individual who is already infected but not yet infectious (cannot transmit), and will eventually become infectious.</p>
    <fig position="float" id="F2">
      <label>Figure 2</label>
      <caption>
        <p>The BDEI model. An individual in exposed state <inline-formula><mml:math id="m61" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> becomes infectious at a rate <inline-formula><mml:math id="m62" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>. An infectious individual <inline-formula><mml:math id="m63" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> transmits the pathogen at a rate <inline-formula><mml:math id="m64" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> (hence creating a new exposed individual <inline-formula><mml:math id="m65" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>), and gets removed at a rate <inline-formula><mml:math id="m66" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> (decreasing the number of infectious individuals <inline-formula><mml:math id="m67" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). Upon removal, the individual’s pathogen might be observed with a probability <inline-formula><mml:math id="m68" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. Note, that the BDEI model does not include a susceptible state <inline-formula><mml:math id="m69" display="inline" overflow="scroll"><mml:mi>S</mml:mi></mml:math></inline-formula> (as for example SEIR) and makes the assumption that the susceptible population is unlimited (as for example in the beginning of an epidemic, or when the removed individuals could get reinfected).</p>
      </caption>
      <graphic xlink:href="syad059_fig2" position="float"/>
    </fig>
    <p>Under the BDEI model, the only allowed transmissions are from <inline-formula><mml:math id="m70" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m71" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>: At the moment of a transmission, the transmitter is always in state <inline-formula><mml:math id="m72" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, while the recipient is in state <inline-formula><mml:math id="m73" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula>. Hence the only non-zero transmission rate is <inline-formula><mml:math id="m74" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, while the other 3 transmission rates are trivial: <inline-formula><mml:math id="m75" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. As we typically do not have the information to distinguish a transmitter from a recipient in a phylogenetic tree (which approximates the transmission tree), we have to consider both possibilities during parameter estimation. For the MTBD models where multiple states can transmit, the number of possibilities increases combinatorially.</p>
    <p>Under the BDEI model, we assume that only the individuals in state <inline-formula><mml:math id="m76" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can exit the study (at rate <inline-formula><mml:math id="m77" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>) and be detected and sampled (with a probability <inline-formula><mml:math id="m78" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:math></inline-formula>): For instance, for many pathogens with an incubation period, the detection is triggered by the onset of symptoms, which in turn happens in the infectious state. Hence all the BDEI tree tips are in state <inline-formula><mml:math id="m79" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>, and <inline-formula><mml:math id="m80" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>In addition to <inline-formula><mml:math id="m81" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> and infectious time, the BDEI model permits inference of a third epidemiological parameter:</p>
    <list list-type="bullet">
      <list-item>
        <p><italic toggle="yes">incubation period</italic><inline-formula><mml:math id="m82" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, time between the infection and becoming infectious.</p>
      </list-item>
    </list>
    <p>The incubation period can be expressed via becoming infectious rate <inline-formula><mml:math id="m83" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, corresponding to a state transition from <inline-formula><mml:math id="m84" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> to <inline-formula><mml:math id="m85" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>. The inverse state change is not allowed: <inline-formula><mml:math id="m86" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
    <p>MTBD models, as extensions of the BDS model, are asymptotically unidentifiable and require one of their parameters to be fixed in order to become identifiable. In practice, it is often the sampling probability, as it may be approximated from epidemiological data (e.g., the proportion of sampled cases among the declared ones) or the infectious time (estimated from observations of infected cases).</p>
    <sec id="s2">
      <title>Master Equations</title>
      <p>In the standard MTBD master equations proposed by <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>), time goes backward from the last sampling event (the most recent tip in the tree) till the beginning of the epidemic. These equations permit calculation of the likelihood density of the data (observed tree) given the model parameter values <inline-formula><mml:math id="m87" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula>. In the general MTBD case, the observed tree, reconstructed from sampled pathogen genomes, differs from the real transmission tree: the states of its internal nodes (corresponding to transmissions) are unknown, we cannot distinguish between the transmitter and the recipient branches, the moments of state changes are also unknown, and due to incomplete sampling some parts of the real transmission tree are unobserved in the reconstructed tree. We therefore need to integrate over all possibilities while calculating the likelihood. The BDEI model is a slightly simpler case as only infectious individuals can transmit or get sampled, hence all the node states are known (<inline-formula><mml:math id="m88" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>). For the BDEI model <inline-formula><mml:math id="m89" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>In System (1) we show the MTBD master equations for a model with <inline-formula><mml:math id="m90" display="inline" overflow="scroll"><mml:mi>d</mml:mi></mml:math></inline-formula> states (for the BDEI model <inline-formula><mml:math id="m91" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>); however, presenting them with the time <inline-formula><mml:math id="m92" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> going forward from the time of the epidemic start (<inline-formula><mml:math id="m93" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, i.e., tree root) to the time of the last sampled tip (<inline-formula><mml:math id="m94" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula>). These equations describe the likelihood density functions (LDFs) <inline-formula><mml:math id="m95" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving as in the reconstructed tree, starting at time <inline-formula><mml:math id="m96" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m97" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (for the BDEI model <inline-formula><mml:math id="m98" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) on a branch connecting a node <inline-formula><mml:math id="m99" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, and till the end of the sampling period. The boundary condition is defined at time <inline-formula><mml:math id="m100" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (i.e., at the node <inline-formula><mml:math id="m101" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>). To account for incomplete sampling, the system also includes the probabilities <inline-formula><mml:math id="m102" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of evolving unobserved till the time <inline-formula><mml:math id="m103" display="inline" overflow="scroll"><mml:mi>T</mml:mi></mml:math></inline-formula>, starting at time <inline-formula><mml:math id="m104" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> instate <inline-formula><mml:math id="m105" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula>.</p>
      <p>From now on, we use the following notation: the id of the root node is <inline-formula><mml:math id="m106" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula>; the ids of its children are <inline-formula><mml:math id="m107" display="inline" overflow="scroll"><mml:mn>00</mml:mn></mml:math></inline-formula> and <inline-formula><mml:math id="m108" display="inline" overflow="scroll"><mml:mn>01</mml:mn></mml:math></inline-formula>; and, by extension, the children of a node <inline-formula><mml:math id="m109" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> (if they exist) have ids <inline-formula><mml:math id="m110" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m111" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (as in <xref rid="F1" ref-type="fig">Fig. 1</xref>). Additionally if the state of a node <inline-formula><mml:math id="m112" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known, then we will name it <inline-formula><mml:math id="m113" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. (For example for the BDEI model <inline-formula><mml:math id="m114" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>I</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.)</p>
      <disp-formula>
        <mml:math id="m1" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>L</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>d</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, followed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolution from the new state</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>s</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">recipient subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msubsup>
                          <mml:mi>L</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>i</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmissions, where the</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">transmitter subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mn>0</mml:mn>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,      if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>ψ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:msub>
                                <mml:mi>ρ</mml:mi>
                                <mml:mi>s</mml:mi>
                              </mml:msub>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">,  if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is a sampled tip in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:munderover>
                                  <mml:mo>∑</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>k</mml:mi>
                                    <mml:mo>=</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mi>d</mml:mi>
                                </mml:munderover>
                              </mml:mstyle>
                              <mml:msub>
                                <mml:mi>λ</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>k</mml:mi>
                                </mml:mrow>
                              </mml:msub>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>s</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>1</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                                <mml:mo>+</mml:mo>
                                <mml:msubsup>
                                  <mml:mi>L</mml:mi>
                                  <mml:mi>k</mml:mi>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mrow>
                                      <mml:mi>i</mml:mi>
                                      <mml:mo>⁢</mml:mo>
                                      <mml:mn>0</mml:mn>
                                    </mml:mrow>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:msub>
                                    <mml:mi>t</mml:mi>
                                    <mml:mi>i</mml:mi>
                                  </mml:msub>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mo rspace="0.392em">×</mml:mo>
                              <mml:msubsup>
                                <mml:mi>L</mml:mi>
                                <mml:mi>s</mml:mi>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>i</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>1</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mi>i</mml:mi>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, if </mml:mtext>
                                <mml:mi>i</mml:mi>
                                <mml:mtext mathvariant="italic"> is internal, in state </mml:mtext>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>μ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>k</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:msub>
                            <mml:mi>λ</mml:mi>
                            <mml:mrow>
                              <mml:mi>s</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>k</mml:mi>
                            </mml:mrow>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>s</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">next infinitesimal time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>μ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> change of the state, folowed by</mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">unsampled evolution from the new state </mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>λ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>s</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>U</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                        <mml:mo lspace="0.558em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>←</mml:mo>
                          <mml:mtext mathvariant="italic"> transmission, then unsampled </mml:mtext>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>ψ</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:msub>
                            <mml:mi>ρ</mml:mi>
                            <mml:mi>s</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to stay unsampled over time 0 is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(1)</label>
      </disp-formula>
    </sec>
    <sec id="s3">
      <title>Tree likelihood density</title>
      <p>The likelihood density of a tree <inline-formula><mml:math id="m115" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> for given parameter values <inline-formula><mml:math id="m116" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is then calculated as the LDF at time <inline-formula><mml:math id="m117" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> on the root, whose id is <inline-formula><mml:math id="m118" display="inline" overflow="scroll"><mml:mn>0</mml:mn></mml:math></inline-formula> and whose state is <inline-formula><mml:math id="m119" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m2" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>L</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mn>0</mml:mn>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mn>0</mml:mn>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:msub>
                  <mml:mi>t</mml:mi>
                  <mml:mn>0</mml:mn>
                </mml:msub>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(2)</label>
      </disp-formula>
      <p>So far, we assumed that the epidemic started directly with the first transmission, however we can relax this assumption. The root of the tree in <xref rid="F1" ref-type="fig">Fig. 1</xref> is placed at <inline-formula><mml:math id="m120" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and does not have a branch (its length is zero). Allowing for a non-zero root branch corresponds to an epidemic start some time before the first transmission (<inline-formula><mml:math id="m121" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>). This implies that the state of the individual represented by the root branch at time <inline-formula><mml:math id="m122" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> is unknown, and all possible states should be considered (Eq. (3)). The same formula applies to cases where the root state is unknown. Assuming that the relative number of individuals in each state is at equilibrium, we can calculate the weight <inline-formula><mml:math id="m123" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> of each possible state <inline-formula><mml:math id="m124" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> (derived by <xref rid="CIT0035" ref-type="bibr">Stadler et al., 2013</xref> for the general MTBD case and in Equation (16) for the BDEI model).</p>
      <disp-formula>
        <mml:math id="m3" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mi>L</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mi>𝒯</mml:mi>
                  <mml:mo fence="false">|</mml:mo>
                  <mml:mi mathvariant="normal">Θ</mml:mi>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mi>t</mml:mi>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(3)</label>
      </disp-formula>
      <p>Root’s LDF <italic toggle="yes">recursively</italic> depends on the LDFs of the child node branches via the boundary condition <inline-formula><mml:math id="m125" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> (System 1), and hence is calculated with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>) while climbing the tree from tips till the root. Therefore when parallelized to maximum, it still requires <inline-formula><mml:math id="m126" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> consecutive steps, where <inline-formula><mml:math id="m127" display="inline" overflow="scroll"><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub></mml:math></inline-formula> stands for the height of the tree <inline-formula><mml:math id="m128" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> and depends on its topology: (balanced tree) <inline-formula><mml:math id="m129" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>𝒯</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> (ladder-like tree). At each step System (1) needs to be resolved for the corresponding nodes. Moreover, the values of <inline-formula><mml:math id="m130" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at internal nodes and their boundary conditions <inline-formula><mml:math id="m131" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> progressively become smaller as getting deeper in the tree, due to successive additions and multiplications of the LDF values. In trees with many tips, this might lead to numerical underflow, and hence such measures as rescaling need to be taken (<xref rid="CIT0001" ref-type="bibr">Berger and Stamatakis, 2009</xref>; <xref rid="CIT0006" ref-type="bibr">Defour, 2010</xref>; <xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>).</p>
    </sec>
    <sec id="s4">
      <title>Extension to Forests</title>
      <p>In some cases, the assumption that a (sub-)epidemic started with one infected individual might be too constraining. For instance, there could be multiple pathogen introductions to a country of interest (e.g., while in China the SARS-CoV-2 epidemic is commonly assumed to have started with one case, there were multiple independent introductions to other countries (<xref rid="CIT0049" ref-type="bibr">Zhukova et al., 2020</xref>)). This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3b</xref>. Another example is a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage. This scenario is depicted in <xref rid="F3" ref-type="fig">Fig. 3a</xref>. In Bayesian settings, the situations when the system behaviour (and parameters) change over time, are modeled via skyline methods. <xref rid="CIT0035" ref-type="bibr">Stadler et al. (2013</xref>) developed the one-state Bayesian birth-death skyline plot that divides the time into intervals and allows for different piece-wise constant rates on them. <xref rid="CIT0024" ref-type="bibr">Kühnert et al. (2016</xref>) combined the MTBD model with the skyline to allow for both piece-wise constant rate changes over time and multiple individual types. The skyline approach therefore relies on a single tree, but estimates a separate set of parameters for each time interval, all under the same model. As the number of parameters increases with multiple skyline intervals, MTBD-skyline models therefore require more data and computational time for their accurate estimation, and are more prone to numerical instability than the classical MTBD models.</p>
      <fig position="float" id="F3">
        <label>Figure 3</label>
        <caption>
          <p>Forest <inline-formula><mml:math id="m132" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> representing a (sub-)epidemic that started with multiple infected cases. a) The observed forest trees (<inline-formula><mml:math id="m133" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m134" display="inline" overflow="scroll"><mml:mi>c</mml:mi></mml:math></inline-formula>), corresponding to three different initial infected cases, are shown with solid lines. All the forest trees start at the same time <inline-formula><mml:math id="m135" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). This scenario can correspond to a change of health policies leading to a change in parameter values (e.g., sampling). Such a change corresponds to a new stage of the epidemic, starting from several infected cases from the previous stage (shown with dashed lines). b) The observed forest trees (<inline-formula><mml:math id="m136" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>), corresponding to two different initial infected cases, are shown with solid lines. They start at different times (<inline-formula><mml:math id="m137" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>). This scenario can correspond to multiple introduction to the same country from other countries (shown with dashed lines).</p>
        </caption>
        <graphic xlink:href="syad059_fig3" position="float"/>
      </fig>
      <p>We propose a simpler alternative, where the (sub-)epidemic starts with multiple individuals (not necessarily at the same time) and leads to a forest <inline-formula><mml:math id="m138" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> of <inline-formula><mml:math id="m139" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed trees: <inline-formula><mml:math id="m140" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>𝒯</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The forest might also include a certain number <inline-formula><mml:math id="m141" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> of unobserved trees, i.e., individuals who were infected at the beginning of the (sub-) epidemic, but whose trees stayed unobserved as none of their tips got sampled. This can be incorporated in the likelihood calculation. Forest likelihood formula hence combines the likelihoods of <inline-formula><mml:math id="m142" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> observed and <inline-formula><mml:math id="m143" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> hidden trees, and can be represented in logarithmic form (Eq. (4)). Tree likelihood formula is its special case, where <inline-formula><mml:math id="m144" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m145" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <disp-formula>
        <mml:math id="m4" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi>log</mml:mi>
                    <mml:mo lspace="0.167em">⁡</mml:mo>
                    <mml:mi>L</mml:mi>
                  </mml:mrow>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>ℱ</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Θ</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mi>u</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>u</mml:mi>
                        <mml:mo lspace="0.337em">⁢</mml:mo>
                        <mml:mrow>
                          <mml:mi>log</mml:mi>
                          <mml:mo lspace="0.167em">⁡</mml:mo>
                          <mml:msub>
                            <mml:mi>U</mml:mi>
                            <mml:mtext>hidden</mml:mtext>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi mathvariant="normal">Θ</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>+</mml:mo>
                      <mml:mrow>
                        <mml:mstyle>
                          <mml:munderover>
                            <mml:mo>∑</mml:mo>
                            <mml:mrow>
                              <mml:mi>j</mml:mi>
                              <mml:mo>=</mml:mo>
                              <mml:mn>1</mml:mn>
                            </mml:mrow>
                            <mml:mi>f</mml:mi>
                          </mml:munderover>
                        </mml:mstyle>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mi>log</mml:mi>
                            <mml:mo lspace="0.167em">⁡</mml:mo>
                            <mml:mi>L</mml:mi>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mrow>
                              <mml:msub>
                                <mml:mi>𝒯</mml:mi>
                                <mml:mi>j</mml:mi>
                              </mml:msub>
                              <mml:mo fence="false">|</mml:mo>
                              <mml:mi mathvariant="normal">Θ</mml:mi>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>,</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mtext> where </mml:mtext>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mtext>hidden</mml:mtext>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>s</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mtext>start</mml:mtext>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(4)</label>
      </disp-formula>
      <p>In Equation (4) we assumed that all the <inline-formula><mml:math id="m146" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>+</mml:mo><mml:mi>u</mml:mi></mml:mrow></mml:math></inline-formula> sub-epidemics in the forest <inline-formula><mml:math id="m147" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> started at the same time (<inline-formula><mml:math id="m148" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>). This condition can be easily relaxed by replacing zeros with the corresponding tree starting times for observed and unobserved tree evolutions. As in practice we do not know the starting times of the unobserved trees if the sub-epidemics could start at different times, we approximate the unobserved tree starting times with the mean of the observed tree starting times: <inline-formula><mml:math id="m149" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mover><mml:mi>t</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mtext>start</mml:mtext></mml:msub><mml:mo rspace="0.111em">=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>f</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo lspace="0.170em">⁢</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo symmetric="true">/</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>:</p>
      <disp-formula>
        <mml:math id="m5" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:msub>
                <mml:mi>U</mml:mi>
                <mml:mrow>
                  <mml:mi>h</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>d</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>e</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>n</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi mathvariant="normal">Θ</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo rspace="0.111em">=</mml:mo>
            <mml:mrow>
              <mml:munderover>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>d</mml:mi>
              </mml:munderover>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>U</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msub>
                    <mml:mover>
                      <mml:mi>t</mml:mi>
                      <mml:mo>~</mml:mo>
                    </mml:mover>
                    <mml:mtext>start</mml:mtext>
                  </mml:msub>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(5)</label>
      </disp-formula>
      <p>In our parameter estimator implementation for the BDEI model (see “Efficient parameter and CI estimation for the BDEI model” section), mean can be replaced with median, maximum or minimum of the observed tree times, via a user-specified parameter <inline-formula><mml:math id="m150" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">_</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>c</mml:mi><mml:mo>⁢</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
      <p>For given model parameter values <inline-formula><mml:math id="m151" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> we can estimate the number of hidden trees <inline-formula><mml:math id="m152" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> from the number of observed trees <inline-formula><mml:math id="m153" display="inline" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> as</p>
      <disp-formula>
        <mml:math id="m6" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mi>u</mml:mi>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mi>f</mml:mi>
              <mml:mo>⁢</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mi>U</mml:mi>
                    <mml:mrow>
                      <mml:mi>h</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>i</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>e</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>n</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mn>1</mml:mn>
                  <mml:mo>−</mml:mo>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mrow>
                        <mml:mi>h</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>d</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>e</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>n</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
        <label>(6)</label>
      </disp-formula>
      <p>Hence, working with forests does not add an additional parameter to likelihood estimation. Moreover, as our simulations show (see “Performance on simulated data and comparison to other tools” section), the value of <inline-formula><mml:math id="m154" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> has little impact on the parameter estimation. However, in some cases (e.g., change in health policy and thus of parameter values), it might be better to estimate <inline-formula><mml:math id="m155" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> based on external data (e.g., number of cases at <inline-formula><mml:math id="m156" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mtext>start</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>), rather than assuming that the parameter values predating the trees in the forest were the same as those in the forest. We explore both approaches in the “Application: Ebola in Sierra-Leone” section.</p>
      <p>Using forests permits estimation of the model parameters on the last skyline interval without the restriction that the epidemic followed the same model before this interval (i.e., the top part of the tree, which includes the common ancestors of the forest roots, <xref rid="F3" ref-type="fig">Fig. 3a</xref>). It reduces the number of parameters to those of the last interval. It also permits estimation of parameters for a (sub-)epidemic that started with several individuals but not at the same time (e.g., due to multiple introductions to a country, <xref rid="F3" ref-type="fig">Fig. 3b</xref>).</p>
    </sec>
  </sec>
  <sec id="s5">
    <title>Avoiding numerical problems and parallelizing calculations</title>
    <p>In this section we introduce a way to rewrite LDFs in System (1) that permits (i) obtaining simpler boundary conditions to avoid potential numerical issues during resolution of equations; and (ii) removing recursion and resolving equations for each tree node in parallel, hence speeding up the calculations.</p>
    <p>System (1) has several properties. First of all, its subsystem that defines unobserved probabilities (<inline-formula><mml:math id="m157" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) is self-defined, and hence can be calculated independently from the rest. Secondly, in the subsystem that defines observed LDFs (<inline-formula><mml:math id="m158" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>) the right-hand side of the differential equations is a sum where each element is linear with respect to one of the <inline-formula><mml:math id="m159" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m160" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and this sum does not contain any free term. This condition implies that if we rescale <inline-formula><mml:math id="m161" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> by a common factor, the differential equations will not change. Moreover, if the boundary conditions for all states but one are zero (<inline-formula><mml:math id="m162" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow><mml:mo>≠</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mo rspace="0.447em">;</mml:mo><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>), the rescaling will change the boundary condition only for <inline-formula><mml:math id="m163" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The latter is the case when tree node states are known, for example for the BDEI model, under which all nodes are in state <inline-formula><mml:math id="m164" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula>.</p>
    <p>Assuming the state of the node <inline-formula><mml:math id="m165" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is known (<inline-formula><mml:math id="m166" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>), let us define <inline-formula><mml:math id="m167" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as</p>
    <disp-formula>
      <mml:math id="m7" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>p</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>,</mml:mo>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>i</mml:mi>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>⁢</mml:mo>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>t</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mrow>
              <mml:mrow>
                <mml:msubsup>
                  <mml:mi>L</mml:mi>
                  <mml:mi>s</mml:mi>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>i</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo symmetric="true">/</mml:mo>
              <mml:msubsup>
                <mml:mi>C</mml:mi>
                <mml:mrow>
                  <mml:mi>s</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mi>i</mml:mi>
                </mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>i</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:msubsup>
            </mml:mrow>
          </mml:mrow>
          <mml:mo lspace="0em">.</mml:mo>
        </mml:mrow>
      </mml:math>
      <label>(7)</label>
    </disp-formula>
    <p>Then the differential equations for <inline-formula><mml:math id="m168" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> will only differ from those for <inline-formula><mml:math id="m169" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in the boundary condition for <inline-formula><mml:math id="m170" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, which is <inline-formula><mml:math id="m171" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (the other boundary conditions stay zero). Conceptually, <inline-formula><mml:math id="m172" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a probability of an individual evolving as on an observed branch that connects a node <inline-formula><mml:math id="m173" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> to its parent, starting at time <inline-formula><mml:math id="m174" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> in state <inline-formula><mml:math id="m175" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> on this branch and finishing at time <inline-formula><mml:math id="m176" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in state <inline-formula><mml:math id="m177" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> (without taking into account <inline-formula><mml:math id="m178" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>’s subtree and the event atnode <inline-formula><mml:math id="m179" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>).</p>
    <p>Solving the master equations for <inline-formula><mml:math id="m180" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m181" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> permits us to both (i) remove the recursive dependency between child and parent nodes (during ordinary differential equation (ODE) resolutions); and (ii) avoid numerical issues that could arise from very small values of the boundary condition of <inline-formula><mml:math id="m182" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which is particularly pertinent for large trees. The calculation of <inline-formula><mml:math id="m183" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can be done in parallel for each node <inline-formula><mml:math id="m184" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>. Hence, when parallelized to maximum, the computing time to resolve all these master equations become constant (i.e., the problem is ”embarrassingly parallelizable” following computer science terminology).</p>
    <p>In the general case, where the tree node states are unknown, all the possibilities (<inline-formula><mml:math id="m185" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) for each node <inline-formula><mml:math id="m186" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> can be considered separately and in parallel. Calculating <inline-formula><mml:math id="m187" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all the <inline-formula><mml:math id="m188" display="inline" overflow="scroll"><mml:mrow><mml:mi>d</mml:mi><mml:mo lspace="0.222em" rspace="0.222em">×</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula> possible combinations of <inline-formula><mml:math id="m189" display="inline" overflow="scroll"><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> corresponds to the flow matrix <inline-formula><mml:math id="m190" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">G</mml:mi></mml:math></inline-formula> calculation in the general formulation recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>).</p>
    <p>In the case where all node states are known (e.g., from metadata or due to model itself, as for the BDEI case), using <inline-formula><mml:math id="m191" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> instead of <inline-formula><mml:math id="m192" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> also permits us to express tree likelihood for model parameters <inline-formula><mml:math id="m193" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> in a non-recursive way, and easily transform it to a logarithmic form (Eq. (8)) (to avoid underflow issues while multiplying small numbers at the likelihood combination step). In Materials and Methods we show its equivalence to the recursive representa-tion (Eq. (2)).</p>
    <disp-formula>
      <mml:math id="m8" display="block" overflow="scroll">
        <mml:mtable>
          <mml:mtr>
            <mml:mtd>
              <mml:mrow>
                <mml:mi>l</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>o</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>g</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>L</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>𝒯</mml:mi>
                    <mml:mo fence="false">|</mml:mo>
                    <mml:mi mathvariant="normal">Θ</mml:mi>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
            <mml:mtd>
              <mml:mrow>
                <mml:mi/>
                <mml:mo>=</mml:mo>
                <mml:mrow>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mrow>
                          <mml:mi>t</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>p</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mrow>
                    <mml:mi>l</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>o</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>ψ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>⁢</mml:mo>
                        <mml:msub>
                          <mml:mi>ρ</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mi>i</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> sampling of </mml:mtext>
                      <mml:mi>n</mml:mi>
                      <mml:mtext mathvariant="italic"> tips</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo>+</mml:mo>
                <mml:mstyle>
                  <mml:munder>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                    </mml:mrow>
                  </mml:munder>
                </mml:mstyle>
                <mml:mi>l</mml:mi>
                <mml:mi>o</mml:mi>
                <mml:mi>g</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> transmission events</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mi>events</mml:mi>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mrow>
                <mml:mo rspace="0.222em">⋅</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mtd>
          </mml:mtr>
          <mml:mtr>
            <mml:mtd/>
            <mml:mtd>
              <mml:mo mathvariant="normal">←</mml:mo>
              <mml:mi>i’s child branch evolutions</mml:mi>
            </mml:mtd>
          </mml:mtr>
        </mml:mtable>
      </mml:math>
      <label>(8)</label>
    </disp-formula>
    <p>For the general case, the combination of different internal node state configurations into tree likelihood formula need to be performed with a pruning algorithm (<xref rid="CIT0009" ref-type="bibr">Felsenstein, 1973</xref>). The likelihood-combining tree traversal starts from the tips and climbs the tree till the root, while calculating a subtree LDF <inline-formula><mml:math id="m194" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for each visited node <inline-formula><mml:math id="m195" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> for each possible state <inline-formula><mml:math id="m196" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>:</p>
    <disp-formula>
      <mml:math id="m9" display="block" overflow="scroll">
        <mml:mrow>
          <mml:mrow>
            <mml:msubsup>
              <mml:mi>L</mml:mi>
              <mml:mi>k</mml:mi>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mi>i</mml:mi>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:msubsup>
            <mml:mo>⁢</mml:mo>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:msub>
                <mml:mi>t</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
          <mml:mo>=</mml:mo>
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,         if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot be in state </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>ψ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>ρ</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic">,    if </mml:mtext>
                      <mml:mi>i</mml:mi>
                      <mml:mtext mathvariant="italic"> is a tip whose state can be </mml:mtext>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mstyle>
                      <mml:munderover>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>=</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mi>d</mml:mi>
                      </mml:munderover>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>λ</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>l</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic"> if </mml:mtext>
                        <mml:mi>i</mml:mi>
                        <mml:mtext mathvariant="italic"> is an internal node whose state can be </mml:mtext>
                        <mml:mi>k</mml:mi>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.222em">⋅</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>k</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo rspace="0.055em">)</mml:mo>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mrow>
                          <mml:mi>l</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>s</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:msubsup>
                        <mml:mi>L</mml:mi>
                        <mml:mi>s</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:mrow>
                      <mml:mstyle>
                        <mml:munderover>
                          <mml:mo>∑</mml:mo>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mi>d</mml:mi>
                        </mml:munderover>
                      </mml:mstyle>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:msubsup>
                            <mml:mi>p</mml:mi>
                            <mml:mrow>
                              <mml:mi>k</mml:mi>
                              <mml:mo>⁢</mml:mo>
                              <mml:mi>s</mml:mi>
                            </mml:mrow>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mi>i</mml:mi>
                            </mml:msub>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                          <mml:mo>⁢</mml:mo>
                          <mml:msubsup>
                            <mml:mi>L</mml:mi>
                            <mml:mi>s</mml:mi>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:msubsup>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:msub>
                              <mml:mi>t</mml:mi>
                              <mml:mrow>
                                <mml:mi>i</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo rspace="0.055em">)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo rspace="0.222em">⋅</mml:mo>
                        <mml:mrow>
                          <mml:mstyle>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                          </mml:mstyle>
                          <mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>l</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mi>s</mml:mi>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mrow>
                                  <mml:mi>i</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>0</mml:mn>
                                </mml:mrow>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mi>i</mml:mi>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo rspace="0.392em">×</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>s</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd/>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:mrow>
      </mml:math>
      <label>(9)</label>
    </disp-formula>
    <p>Note that unlike the known-tree-node-state likelihood (Eq. (8)), the recursive unknown-tree-node-state likelihood (Eq. (9)) does not allow for an easy logarithmic representation, and hence is prone to underflow issues. Its calculation on large trees therefore requires additional small number rescaling techniques as recently described in (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) and common in phylogenetic inference. However, unlike in the original MTBD representation, master equation resolutions (for <inline-formula><mml:math id="m197" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m198" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo lspace="0.447em">⁢</mml:mo><mml:mrow><mml:mo rspace="0.167em">∀</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) can be performed independently, in parallel, and avoiding underflow issues for boundary conditions.</p>
    <p>Overall, the PDF reconditioning technique can be applied to any model of the MTBD family, and facilitates its parameter estimation by separating master equation resolution (non-recursive and parallelizable) from likelihood calculation (recursive, but negligible in time cost compared to equation resolution). Recursive likelihood calculation can be performed with a standard pruning algorithm and rescaling techniques to control for potential underflow. For parameter estimation on trees with known node states (e.g., from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled, like the BDEI model), tree likelihood can be calculated with a non-recursive formula in a logarithmic form (Eq. (8)), fully avoiding underflow.</p>
    <sec id="s6">
      <title>Efficient Parameter and CI Estimation for the BDEI Model</title>
      <p>We applied our theoretical findings to implement a fast and efficient parameter estimator for the BDEI model (which we called PyBDEI). It estimates the BDEI model parameters <inline-formula><mml:math id="m199" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mi>ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> for a forest <inline-formula><mml:math id="m200" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula> comprising <inline-formula><mml:math id="m201" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> observed trees in the maximum-likelihood framework, where one of the parameters in <inline-formula><mml:math id="m202" display="inline" overflow="scroll"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> is fixed (for identifiability reasons). The number of hidden trees <inline-formula><mml:math id="m203" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> can be either given by the user, or estimated from BDEI model parameters (as in Eq. (6)).</p>
      <p>Once the optimal parameter values are found, we calculate their confidence intervals (CIs) using Wilks’ method (<xref rid="CIT0047" ref-type="bibr">Wilks, 1938</xref>). For each non-fixed parameter <inline-formula><mml:math id="m204" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow></mml:math></inline-formula>, we calculate its <inline-formula><mml:math id="m205" display="inline" overflow="scroll"><mml:mrow><mml:mn>95</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>-CI as including the values <inline-formula><mml:math id="m206" display="inline" overflow="scroll"><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:math></inline-formula> such that <inline-formula><mml:math id="m207" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>&gt;</mml:mo><mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mtext>opt</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m208" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>χ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.95</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the value of chi-squared distribution with 1 degree of freedom corresponding to the significance level of <inline-formula><mml:math id="m209" display="inline" overflow="scroll"><mml:mn>0.95</mml:mn></mml:math></inline-formula> (i.e., <inline-formula><mml:math id="m210" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>3.84</mml:mn></mml:mrow></mml:math></inline-formula>). <inline-formula><mml:math id="m211" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mrow><mml:mtext>opt</mml:mtext><mml:mo fence="false">|</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:msub></mml:math></inline-formula> corresponds to the maximum-likelihood estimates for the other non-fixed parameters when <inline-formula><mml:math id="m212" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mover><mml:mi>p</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec id="s7">
      <title>Performance on Simulated Data and Comparison to Other Tools</title>
      <p>To assess the performance of our maximum-likelihood estimator PyBDEI, we used the simulated data from <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>), where we generated 100 medium trees with 200–500 tips under the BDEI model, with the parameter values sampled uniformly at random within the following boundaries: incubation period <inline-formula><mml:math id="m213" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.2</mml:mn><mml:mo>,</mml:mo><mml:mn>50</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m214" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>5</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, infectious time <inline-formula><mml:math id="m215" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>10</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, sampling probability <inline-formula><mml:math id="m216" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. These trees were evaluated with the standard Bayesian method BEAST2 (<xref rid="CIT0002" ref-type="bibr">Bouckaert et al., 2019</xref>) and the deep learning-based estimator PhyloDeep (detailed configurations are described in Materials and Methods). Additionally 100 large trees (5000–10,000 tips) were generated for the same parameter values, and assessed with PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). PhyloDeep’s maximal pre-trained tree size is 500 tips; however, for larger trees it estimates BDEI parameters by (i) extracting the largest non-intersecting set of subtrees of sizes covered by the pre-trained set (50–500 tips), (ii) estimating parameters on each of the subtrees independently, and (iii) averaging each parameter’s estimate over the subtrees (weighted by subtree sizes).</p>
      <p>To evaluate PyBDEI performance on forests, we additionally generated two types of forests for the large data set. The first type of forests was produced by cutting the oldest (i.e., closest to the root) 25% of each full tree, and keeping the forest of bottom-75% subtrees (in terms of time). We hence obtained 100 forests representing sup-epidemics that all started at the same time (<inline-formula><mml:math id="m217" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, as in <xref rid="F3" ref-type="fig">Fig. 3a</xref>). These forests contained <inline-formula><mml:math id="m218" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>114</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m219" display="inline" overflow="scroll"><mml:mrow><mml:mn>5031</mml:mn><mml:mo>−</mml:mo><mml:mn>9953</mml:mn></mml:mrow></mml:math></inline-formula> tips.</p>
      <p>The second type of forests represented epidemics that started with multiple introductions happening at different times (as in <xref rid="F3" ref-type="fig">Fig. 3b</xref>). To generate them, we used the parameter values <inline-formula><mml:math id="m220" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> corresponding to each tree <inline-formula><mml:math id="m221" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> in the large dataset (<inline-formula><mml:math id="m222" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mn>100</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), and the times <inline-formula><mml:math id="m223" display="inline" overflow="scroll"><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> between the start of the tree <inline-formula><mml:math id="m224" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> and the time of its last sampled tip. Each (potentially hidden) tree <inline-formula><mml:math id="m225" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in the forest was then generated under parameters <inline-formula><mml:math id="m226" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> till reaching the time <inline-formula><mml:math id="m227" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (drawn uniformly and independently for each tree). Trees were added to the forest till their total number of sampled tips reached at least <inline-formula><mml:math id="m228" display="inline" overflow="scroll"><mml:mn>5000</mml:mn></mml:math></inline-formula>: <inline-formula><mml:math id="m229" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>≥</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math></inline-formula>. The resulting forest <inline-formula><mml:math id="m230" display="inline" overflow="scroll"><mml:msub><mml:mi>ℱ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> included those of the trees <inline-formula><mml:math id="m231" display="inline" overflow="scroll"><mml:msub><mml:mi>𝒯</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> that contained at least one sampled tip (i.e., observed trees). These forests contained <inline-formula><mml:math id="m232" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>4582</mml:mn></mml:mrow></mml:math></inline-formula> observed trees each, with a total of <inline-formula><mml:math id="m233" display="inline" overflow="scroll"><mml:mrow><mml:mn>5000</mml:mn><mml:mo>−</mml:mo><mml:mn>9897</mml:mn></mml:mrow></mml:math></inline-formula> tips, and <inline-formula><mml:math id="m234" display="inline" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>−</mml:mo><mml:mn>10687</mml:mn></mml:mrow></mml:math></inline-formula> hidden trees.</p>
      <p>We applied PyBDEI to these data sets, and compared the results to those reported for BEAST2 and PhyloDeep in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>). For the large data set, we applied PyBDEI to full trees, but also to the two types of forests.</p>
      <p>We calculated the relative error (normalized distance between the estimated and the target values: <inline-formula><mml:math id="m235" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>) and the relative bias [(<inline-formula><mml:math id="m236" display="inline" overflow="scroll"><mml:mrow><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mo>)</mml:mo><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] for each parameter on each tree/forest. Average relative errors for PyBDEI were <inline-formula><mml:math id="m237" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>13</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the medium trees and <inline-formula><mml:math id="m238" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the large trees (hence decreasing with the data set size, as expected), and well centered around zero (i.e., unbiased), as shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. The relative 95%-CI width [<inline-formula><mml:math id="m239" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>97.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>C</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:mn>2.5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo symmetric="true">/</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>] also decreased: from <inline-formula><mml:math id="m240" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula> on the medium data set to <inline-formula><mml:math id="m241" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> on the large one. The target values of rates <inline-formula><mml:math id="m242" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m243" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> were within the estimated CIs in correspondingly 92%, 89%, and 98% of cases on the medium data set, and in 95%, 90%, and 95% of cases on the large one.</p>
      <fig position="float" id="F4">
        <label>Figure 4</label>
        <caption>
          <p>Comparison of inference accuracy of different methods on the a) medium (200-500 tips) and b) large (5000–10000 tips) 100-tree data sets. For the medium data set BEAST2 (in orange), PhyloDeep (in green) and our estimator (PyBDEI, in blue) are compared. Two (out of 100) trees of the medium data set on which BEAST2 did not converge after <inline-formula><mml:math id="m244" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps are excluded from the analysis and not shown in the figure. For large trees (<inline-formula><mml:math id="m245" display="inline" overflow="scroll"><mml:mo>&gt;</mml:mo></mml:math></inline-formula>500 tips), PhyloDeep extracts the largest non-intersecting set of subtrees of 50–500 tips, estimates parameters on each of the subtrees independently, and averages each parameter’s estimate over the subtrees (weighted by subtree sizes). We assessed our method on full trees (dark-blue), on forests obtained from the full trees by removing the oldest (closest to the root) 25% (in terms of height) of those trees (forests 1, light-blue), and on forests whose trees were generated using varying sampling period durations (forests 2, pink). We show the swarmplots (colored by method) of relative errors for each test tree/forest and parameter, which are measured as the normalized distance between the median a posteriori estimate by BEAST2 or a point estimate by PhyloDeep/PyBDEI and the real value. Average relative error (and in parentheses average relative bias) are displayed for each parameter and method below their swarmplot. The accuracy of the methods is compared by a paired <italic toggle="yes">z</italic>-test; <inline-formula><mml:math id="m246" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> are shown above each method pair; non-significant <italic toggle="yes">P</italic>-values are not shown.</p>
        </caption>
        <graphic xlink:href="syad059_fig4" position="float"/>
      </fig>
      <p>To assess method accuracy we calculated <italic toggle="yes">P</italic>-values based on two-sided z-tests for each parameter and method pair. On the medium data set for <inline-formula><mml:math id="m247" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> all the methods performed in a comparable way. For the infectious time, <inline-formula><mml:math id="m248" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was at least as accurate as PhyloDeep and more accurate than BEAST2 (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m249" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>). For the incubation period, <inline-formula><mml:math id="m250" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula>, PyBDEI was more accurate than both other methods (see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the large data set BEAST2 was inapplicable due to computation times (57 CPU hours were already required for each medium-sized tree, on average), while PyBDEI was more accurate than PhyloDeep, both using full trees and the forests of the first type (i.e., where all the trees started at the same time, <italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m251" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> for all the parameters, see <xref rid="F4" ref-type="fig">Fig. 4</xref>). On the forests of the second type (i.e., trees starting at different times) PyBDEI’s performance was comparable to the one of PhyloDeep for all the parameters. While the mean relative errors were low (<inline-formula><mml:math id="m252" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>), PyBDEI performed worse (<italic toggle="yes">P</italic>-value <inline-formula><mml:math id="m253" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula>) on forests of type 2 than on full trees or forests of type 1 for the infectious period and incubation time. This can be explained by the fact that the starting times of the hidden trees in forests of type 2 were not known and hence needed to be approximated. Moreover, forests of type 2 contained less branches (mean 13155) than forests of type 1 (14896) or full trees (14969), and hence less data for parameter inference.</p>
      <p>For two trees in the medium data set, BEAST2 did not converge after <inline-formula><mml:math id="m254" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> Markov Chain Monte Carlo (MCMC) steps: We did not include these two data points in the analysis. PyBDEI performed well on these two trees: real parameters were within estimated confidence intervals, relative errors for <inline-formula><mml:math id="m255" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>15</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, relative errors for incubation period and infectious time <inline-formula><mml:math id="m256" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mrow><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>There were also several trees where BEAST2 seems to have converged to a local optimum (estimates with relative errors close to 1). To investigate this hypothesis further, we calculated the tree likelihoods for the real parameter values and those estimated by the three methods (<xref rid="T1" ref-type="table">Table 1</xref>). Indeed, BEAST2 had a likelihood lower than the one obtained on real values for 8% of trees in the medium dataset (8 out of 98 trees on which BEAST2 converged), which corresponds to a local optimum. These 8 data points correspond to the high BEAST2 relative error values (<inline-formula><mml:math id="m257" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for infectious time and <inline-formula><mml:math id="m258" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&gt;</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula> for incubation period) shown in <xref rid="F4" ref-type="fig">Fig. 4</xref>. PyBDEI estimates had a higher or equal likelihood than any other method and real values for all the trees of both data sets, suggesting that PyBDEI reaches the global optimum of the likelihood function. On the medium dataset, PyBDEI estimates had an equal likelihood to the ones of BEAST2 for 85% of trees, and a higher likelihood for the other 15% of trees. Comparing to PhyloDeep, PyBDEI estimates had an equal likelihood for 48% of trees, and a higher likelihood for the other 52% of trees. Interestingly, PhyloDeep, while being a likelihood-free method, performed very well on the medium data set: on 81% of trees it estimated parameters with higher or equal likelihood to the one of the real parameters. On the large data set it performed worse in terms of likelihood, estimating parameters with higher or equal likelihood to the one of the real parameters only on 29% of trees. It could however be explained by the fact that PhyloDeep estimated parameters on each of the smaller (50–500 tip) subtrees selected by its subtree picker procedure, and averaged the result, instead of being retrained on large 5000–10000-tip trees.</p>
      <table-wrap position="float" id="T1">
        <label>Table 1</label>
        <caption>
          <p>Tree likelihood comparison between the real parameter values and those estimated by different methods on medium and large data sets.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th align="center" rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
              <th align="left" rowspan="1" colspan="1">Medium</th>
              <th align="left" rowspan="1" colspan="1">Large</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" colspan="2" rowspan="1">Real values</th>
              <th align="left" rowspan="1" colspan="1">BEAST2</th>
              <th align="left" colspan="2" rowspan="1">PhyloDeep</th>
              <th align="left" colspan="2" rowspan="1">PyBDEI</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">real values</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.704</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">BEAST2</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.214</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.082</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">–</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">–</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.602</td>
              <td align="left" rowspan="1" colspan="1">0.16</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PhyloDeep</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.306</td>
              <td align="left" rowspan="1" colspan="1">0.13</td>
              <td align="left" rowspan="1" colspan="1">0.541</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0.092</td>
              <td align="left" rowspan="1" colspan="1">0.71</td>
              <td align="left" rowspan="1" colspan="1">0.367</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&gt;</td>
              <td align="left" rowspan="1" colspan="1">0.827</td>
              <td align="left" rowspan="1" colspan="1">0.82</td>
              <td align="left" rowspan="1" colspan="1">0.153</td>
              <td align="left" rowspan="1" colspan="1">0.480</td>
              <td align="left" rowspan="1" colspan="1">0.94</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1">PyBDEI</td>
              <td align="center" rowspan="1" colspan="1">=</td>
              <td align="left" rowspan="1" colspan="1">0.173</td>
              <td align="left" rowspan="1" colspan="1">0.18</td>
              <td align="left" rowspan="1" colspan="1">0.847</td>
              <td align="left" rowspan="1" colspan="1">0.520</td>
              <td align="left" rowspan="1" colspan="1">0.06</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td rowspan="1" colspan="1"/>
              <td align="center" rowspan="1" colspan="1">&lt;</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td align="left" rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <td align="center" rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
              <td rowspan="1" colspan="1"/>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="T1fn01">
            <p>The value provided in row i, column j indicates the proportion of trees for which the likelihood with parameters estimated by method i is either higher (sub-row &gt;), equal (sub-row <inline-formula><mml:math id="m259" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>) or lower (sub-row &lt;) than the likelihood estimated by method j. For example, 0.847 in the row “BEAST2 <inline-formula><mml:math id="m260" display="inline" overflow="scroll"><mml:mo>=</mml:mo></mml:math></inline-formula>” and the column “PyBDEI medium” means that the estimates of BEAST2 had an equal likelihood to those of PyBDEI on 84.7% of trees of the medium data set. According to a sign test, the differences between all the pairs of methods are significant (<inline-formula><mml:math id="m261" display="inline" overflow="scroll"><mml:mi>P</mml:mi></mml:math></inline-formula>-value &lt; 0.01).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>In terms of time, on the medium data set PyBDEI needed on average <inline-formula><mml:math id="m262" display="inline" overflow="scroll"><mml:mn>4</mml:mn></mml:math></inline-formula> seconds per tree on 1 CPU, and converged in 864 iterations (including CI calculation). These times cannot be directly compared to BEAST2 times, as BEAST2 performs a Markov Chain Monte Carlo (MCMC) parameter space exploration instead of looking for the optimum (as PyBDEI does), hence requires many more steps: for <inline-formula><mml:math id="m263" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps it took on average <inline-formula><mml:math id="m264" display="inline" overflow="scroll"><mml:mn>57</mml:mn></mml:math></inline-formula> CPU hours. While the number of MCMC steps could probably be reduced for some runs, for two out of 100 trees it was not sufficient for convergence. Implementing likelihood calculation with our new MTBD formulation and targeted numerical analysis methods, could be helpful in Bayesian context as well: comparing time per iteration (which is roughly time per likelihood calculation), our optimizer required <inline-formula><mml:math id="m265" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds, while BEAST2 took one order of magnitude longer: <inline-formula><mml:math id="m266" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math></inline-formula> CPU seconds. This is probably due to the fact that BEAST2 uses the general MTBD model formulation, configured for BDEI, while our implementation uses a BDEI-tailored implementation. Moreover, the ODE reconditioning allows to avoid underflow errors (and rescaling efforts during tree pruning (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>)), which could also play a role. Using several CPUs would allow for an even larger gain (see the results on the large data set below). PhyloDeep took <inline-formula><mml:math id="m267" display="inline" overflow="scroll"><mml:mn>0.2</mml:mn></mml:math></inline-formula> CPU seconds per tree, which is faster than our method’s time but does not include the training time of deep learning predictors (hundreds of hours). To our knowledge, the only other available maximum-likelihood estimator for BDEI is implemented in the TreePar package (<xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer, 2013</xref>). However, as it suffers from underflow issues for BDEI already on trees of small size, its developers suggest using BEAST2 instead (private communication).</p>
      <p>The average time of PyBDEI convergence on the large data set was 2 min 28 s on 1 CPU, and required 960 iterations. Parallelization on 2 CPUs reduced it to 1 min and 24 s (1.8 times faster). The speed up is close to the number of cores, which shows the efficiency of parallelization of master equation resolution despite the pre- and post-processing steps (tree reading, distribution of jobs between the threads, combining their results), which are always performed on one CPU. This suggests that our estimator will be easily applicable to much largertrees.</p>
      <p>As the BDEI model requires one of the parameters to be fixed in order to become asymptomatically identifiable (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we fixed <inline-formula><mml:math id="m268" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> to the real value, both in <xref rid="CIT0044" ref-type="bibr">Voznica et al. (2022</xref>) and in the comparison described above. However, to assess PyBDEI performance with other parameters fixed, we estimated parameters for trees in the large data set under three additional settings: with (1) <inline-formula><mml:math id="m269" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula>, (2) <inline-formula><mml:math id="m270" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula>, or (3) <inline-formula><mml:math id="m271" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> fixed to its real value. The results are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S1</ext-link> (online Appendix, available at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>). Average relative errors were <inline-formula><mml:math id="m272" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for all parameters when <inline-formula><mml:math id="m273" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> was fixed to the real value, <inline-formula><mml:math id="m274" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m275" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> was fixed, <inline-formula><mml:math id="m276" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>≤</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="m277" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m278" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> were fixed. For estimates of <inline-formula><mml:math id="m279" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> we calculated absolute errors <inline-formula><mml:math id="m280" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>r</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi><mml:mo>⁢</mml:mo><mml:mi>e</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> instead of relative ones: their average was <inline-formula><mml:math id="m281" display="inline" overflow="scroll"><mml:mn>0.02</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m282" display="inline" overflow="scroll"><mml:mi>μ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m283" display="inline" overflow="scroll"><mml:mi>λ</mml:mi></mml:math></inline-formula> , and <inline-formula><mml:math id="m284" display="inline" overflow="scroll"><mml:mn>0.01</mml:mn></mml:math></inline-formula> for fixed <inline-formula><mml:math id="m285" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>. Hence, the estimations can be successfully performed with any of the parameters being fixed, but fixing <inline-formula><mml:math id="m286" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="m287" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> might be particularly useful. Moreover, these parameters are relatively easy to estimate with real data (e.g., patient observations for <inline-formula><mml:math id="m288" display="inline" overflow="scroll"><mml:mi>ψ</mml:mi></mml:math></inline-formula>, and proportion of sampled cases among the declared ones for <inline-formula><mml:math id="m289" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>).</p>
      <p>Finally, we assessed the impact of the number of hidden trees <inline-formula><mml:math id="m290" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> on the parameter estimation. We estimated parameters with <inline-formula><mml:math id="m291" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m292" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being estimated from model parameters on the two types of forests of the large dataset. For forests of type 2 (where trees started at different times), we additionally compared <inline-formula><mml:math id="m293" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> estimations using minimum, mean, median and maximum of observed tree-specific times (see Eq. (5)). Note that the minimum time and <inline-formula><mml:math id="m294" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> represent the two extremes, as the probability of a tree to stay fully unobserved decreases with time. The relative errors for different parameters are shown in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S2</ext-link> (online Appendix). While estimating <inline-formula><mml:math id="m295" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> using mean, median or maximum times seems to have a slightly smaller relative error for <inline-formula><mml:math id="m296" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> (3% vs. 4% for minimum time or <inline-formula><mml:math id="m297" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), these differences are non-significant. Overall, <inline-formula><mml:math id="m298" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> seems to have little impact on parameter estimation.</p>
      <p>The assessment of our maximum-likelihood estimator on simulated data shows that it opens new possibilities to fast and accurate analyses of extremely large data sets, while being flexible with respect to parameter settings (e.g., the parameter to be fixed). The use of forests makes it possible to focus on a specific part of a large tree, e.g., the most recent period, the subtrees corresponding to a given region or country, or the origin of the epidemic.</p>
    </sec>
  </sec>
  <sec id="s8">
    <title>Application: Ebola in Sierra-Leone</title>
    <p>Using PyBDEI, we analysed the 2014 Ebola epidemic in Sierra-Leone (SLE). Ebola virus features an incubation period (reported by the World Health Organisation (WHO) to take between 2 and 21 d (<xref rid="CIT0046" ref-type="bibr">WHO, 2021</xref>)). Using statistical methods based on time series of reported Ebola cases, the incubation period of Ebola during the 2014 SLE epidemic was previously estimated to be around 10–11 d, the infectious time around 4–5 d, and the reproduction number to decrease from around 2 in the beginning of the epidemic to values close to 1 by late 2014 (due to control measures) (<xref rid="CIT0038" ref-type="bibr">Team, 2014</xref>, <xref rid="CIT0039" ref-type="bibr">2015</xref>; <xref rid="CIT0030" ref-type="bibr">Rivers et al., 2014</xref>; see also <xref rid="CIT0041" ref-type="bibr">Van Kerkhove et al., 2015</xref> for a review).</p>
    <p>Sequence data could improve and complement these estimates. However, the existing phylodynamic study of these parameters was limited by the data set size: <xref rid="CIT0034" ref-type="bibr">Stadler and Bonhoeffer (2013</xref>) applied the BDEI model to the early spread of Ebola in SLE by analysing 72 Ebola samples from late May to mid June 2014 (sequences from <xref rid="CIT0011" ref-type="bibr">Gire et al. (2014</xref>)). They estimated the expected length of the incubation period to be 4.9 d (median; 95% HPD 2.1–23.2), and the infectious time of 2.6 d (median; 95% HPD 1.2–7).</p>
    <p>To show the power of phylodynamic analyses on larger data sets, we took the 1610-sequence alignment and metadata (sampling times and countries) that were used in the study by <xref rid="CIT0008" ref-type="bibr">Dudas et al. (2017</xref>), who analysed the factors that spread the 2014–2016 Ebola epidemic in West Africa. Using these data, we reconstructed a time-tree of the Ebola epidemic in West Africa, which we then used to extract a forest of time-subtrees representing the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in the data set). This was done to obtain a forest of subtrees with a homogenous health policy (after July 30). The details on the forest reconstruction are given in Materials and Methods. To check for robustness of the estimates, forest reconstruction was performed 10 times, obtaining slightly different forests.</p>
    <p>We estimated the BDEI parameters on these 10 forests. As the BDEI model requires one of the parameters to be fixed for identifiability (<xref rid="CIT0032" ref-type="bibr">Stadler, 2009</xref>), we performed the estimations fixing the sampling probability <inline-formula><mml:math id="m299" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>. We estimated <inline-formula><mml:math id="m300" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> as the proportion of cases represented by our forests (853–854) with respect to the total number of SLE Ebola cases reported by the Centers for Disease Control and Prevention (<xref rid="CIT0004" ref-type="bibr">CDC, 2020</xref>) between September 8, 2015 (the closest date to the last SLE sample in our data set, 13683 cases) and July 31, 2014 (the day following the quarantine measures start, 533 cases): <inline-formula><mml:math id="m301" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mrow><mml:mn>854</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>13683</mml:mn><mml:mo>−</mml:mo><mml:mn>533</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>≈</mml:mo><mml:mn>0.065</mml:mn></mml:mrow></mml:math></inline-formula> (calculated independently for each forest). To check the robustness of the predictions with respect to this estimation of <inline-formula><mml:math id="m302" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula>, we additionally estimated the parameter values assuming 20% more (15780, <inline-formula><mml:math id="m303" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.054</mml:mn></mml:mrow></mml:math></inline-formula>) and 20% less (10520, <inline-formula><mml:math id="m304" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.081</mml:mn></mml:mrow></mml:math></inline-formula>) total cases. For each of these settings we performed three estimations: (1) with the number of unobserved trees being estimated, (2) with it being fixed (via setting the parameter <inline-formula><mml:math id="m305" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>) to the difference between the total number of SLE Ebola cases reported by the CDC on July 31 (533) and the number of trees in the corresponding forest (varying between 143 and 174), and (3) with it being fixed to zero.</p>
    <p>The results for different <inline-formula><mml:math id="m306" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> values, estimated vs. fixed <inline-formula><mml:math id="m307" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula>, and different trees were compatible, with intersecting CIs (see <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Table S1</ext-link> in online Appendix). We estimated the <inline-formula><mml:math id="m308" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> value between 0.95 and 1, suggesting a contained epidemic (which is in a good agreement with the quarantine measures and the end of the epidemic in early 2016). The incubation period was estimated between 11 and 14 days. These estimates are fully compatible with the previous studies and allow to narrow down the WHO incubation period estimate (2–21 d, non-specific to the SLE epidemic). We estimated a very short infectious period <inline-formula><mml:math id="m309" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo symmetric="true">/</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>≈</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> hour. While it does not correspond to the epidemiological estimates (4–5 d) reported in previous studies, it makes sense in the setting we are looking at. The BDEI infectious period corresponds to the time interval between the moment when a person becomes infectious and the moment when they cannot transmit anymore. In the beginning of an epidemic impossibility to transmit is typically defined by biological factors, such as healing or death, and corresponds to the epidemiological definition. However, it could also be influenced by logistic reasons, such as self-isolation. As we are looking at the lock-down period, with strict surveillance, it seems likely that a person who develops symptoms (i.e., passes from the exposed to the infectious state) is immediately detected and isolated, hence having very limited time to transmit on average. Our estimate therefore corresponds to this logistic scenario.</p>
    <p>Note, that comparing the setting with <inline-formula><mml:math id="m310" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> being fixed according to the CDC-declared case count to the one when it is estimated, <inline-formula><mml:math id="m311" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula> estimates were slightly smaller with <inline-formula><mml:math id="m312" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> fixed (while the CIs intersected). As the number of cases is defined by the epidemic preceding the studied period, <inline-formula><mml:math id="m313" display="inline" overflow="scroll"><mml:mi>u</mml:mi></mml:math></inline-formula> might not correspond to the number estimated from the studied period parameters, and it might be more accurate to fix it.</p>
    <p>Overall, the analysis took <inline-formula><mml:math id="m314" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> h for the reconstruction of forests and <inline-formula><mml:math id="m315" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> min per forest for the BDEI parameter estimation.</p>
    <p>This application shows the advantages of PyBDEI not only in terms of calculation times, but also in terms of flexibility of input settings (extracting information from multiple trees).</p>
  </sec>
  <sec id="s9">
    <title>Discussion</title>
    <p>We proposed a highly parallelizable formulation of master equations for MTBD models. We also proposed an extension of the MTBD models to forests, to tackle situations where health policies change over time (providing a flexible alternative to the Bayesian skyline), as well as situations of multiple (not necessarily simultaneous) pathogen introductions to a country of interest. The extension to forests does not introduce additional model parameters; however, when available, it allows to incorporate external data on the number of infectious cases at the start of the forest.</p>
    <p>The peculiar properties of original MTBD equations permitted us to rewrite them in a branch-specific way. This representation features simple boundary conditions with 0 or 1 values, and avoids numerical and underflow problems that could occur in the original system due to very small positive values of the boundary conditions. Even more importantly, our branch-specific representation removes the recursive dependency between the equations corresponding to parent and child tree nodes, and permits their time-consuming resolution to be performed in parallel and independently. The results can then be combined into tree likelihood with a nearly standard pruning algorithm. While the likelihood-combining step in the most general MTBD case remains recursive, its time cost should be negligible in comparison with the recursive master equation resolution used in previous studies. Moreover, for cases where tree node states are known we obtained an explicit likelihood formula, which can be represented in a logarithmic form (Eq. 8) to avoid potential underflow issues during the likelihood-combining step. Tree node states could be known from metadata, or because they were generated by an MTBD process in which only one state can transmit or get sampled.</p>
    <p>We implemented our theoretical findings in a maximum likelihood parameter and CI estimator for the BDEI model, which is a special case of MTBD models. It is also one of the most useful models in epidemiology, being applicable to Ebola, Sars-CoV 1 and 2, Tuberculosis and other pathogens that feature an incubation period. Under this model tree node states are known, as only the infectious individuals can transmit their pathogen or get detected (after symptom onset). Our parameter estimator, PyBDEI, drastically increases parameter optimization performance, accuracy and speed with respect to previously available estimators.</p>
    <p>We applied our estimator to the 2014 Ebola epidemic in Sierra Leone, after the introduction of quarantine measures. The analysis took <inline-formula><mml:math id="m316" display="inline" overflow="scroll"><mml:mrow><mml:mi/><mml:mo>&lt;</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> h (the majority of which was the tree reconstruction). The obtained estimates of epidemiological parameters are in agreement with what we now know about this epidemic. In particular, the estimate of <inline-formula><mml:math id="m317" display="inline" overflow="scroll"><mml:msub><mml:mi>R</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:math></inline-formula>, slightly less than 1, suggests a contained epidemic, and indeed Sierra Leone was declared Ebola free in early 2016, a few months after the sampling date (September 7, 2015) of the most recent Ebola sequence in our data set.</p>
    <p>The accuracy of estimations improves with the data set size (as expected, see our simulations). In the world of rapidly growing sequencing data sets (<xref rid="CIT0016" ref-type="bibr">Hodcroft et al., 2021</xref>), we can gain important insights on epidemic spreads by harvesting all available information. PyBDEI is applicable to very large data sets (2 min on a 10000-tip tree), making parameter and CI estimation instantaneous with respect to phylogenetic tree reconstruction times (hours or even days). Our approach could be easily used in a Bayesian setting as well, and could potentially be implemented in BEAST2.</p>
    <p>As the MTBD models are epidemiological analogues of the ClaSSE-like models, our findings could also be easily transferred to the macroevolution domain. Our parallelizable MTBD model formulation is closely related to general matrix-based flow framework recently proposed by <xref rid="CIT0025" ref-type="bibr">Louca and Pennell (2020</xref>). Using this framework, they implemented an efficient parameter estimator <italic toggle="yes">castor</italic> for MuSSE-like models; however, this type of models does not cover cladogenetic changes possible in ClaSSE-like and MTBD models. Moreover, our approach, thanks to forests, allows for multiple introductions, for example, of an epidemic in a given country, or of species from the same clade within a given ecological realm, which could be useful in the macroevolution domain. With rapidly growing genome sequence data, castor and PyBDEI open way to fast and accurate parameter estimations for ecology and epidemiology.</p>
  </sec>
  <sec id="s10">
    <title>Materials and Methods</title>
    <sec id="s11">
      <title>Reconditioned BDEI master equations</title>
      <disp-formula>
        <mml:math id="m10" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>E</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal time </mml:mtext>
                      <mml:mrow>
                        <mml:mi mathvariant="normal">Δ</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>t</mml:mi>
                      </mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by evolution</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m11" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mover>
                          <mml:mi>p</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mi>I</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the recipient</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, where the transmitter</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">subtree stayed unsampled</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>I</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> the probability to evolve from I to I over zero time is 1</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>p</mml:mi>
                        <mml:mi>E</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mn>0</mml:mn>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> an individual in state </mml:mtext>
                      <mml:mi>E</mml:mi>
                      <mml:mtext mathvariant="italic"> cannot change their state to I</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext>𝑖𝑛𝑠𝑡𝑎𝑛𝑡𝑒𝑛𝑖𝑜𝑢𝑠𝑙𝑦</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>E</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>μ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> becoming infectious, followed by unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">evolution from state </mml:mtext>
                    <mml:mi>I</mml:mi>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mover>
                          <mml:mi>U</mml:mi>
                          <mml:mo>˙</mml:mo>
                        </mml:mover>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>λ</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>ψ</mml:mi>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:msub>
                      <mml:mi>U</mml:mi>
                      <mml:mi>I</mml:mi>
                    </mml:msub>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mi>t</mml:mi>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo lspace="0.558em">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> no event in the next infinitesimal</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mtext mathvariant="italic">time </mml:mtext>
                    <mml:mrow>
                      <mml:mi mathvariant="normal">Δ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>t</mml:mi>
                    </mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>λ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> transmission, then unsampled</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">evolutions of transmitter and recipient subtrees</mml:mtext>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:mrow>
                      <mml:mi>ψ</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mn>1</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:mi>ρ</mml:mi>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> removal without sampling</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mi/>
                  </mml:mrow>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>U</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>T</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo lspace="0.558em">⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>←</mml:mo>
                        <mml:mtext mathvariant="italic"> the probability to stay unsampled over</mml:mtext>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd/>
                <mml:mtd columnalign="left">
                  <mml:mtext mathvariant="italic">zero time is 1</mml:mtext>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(10)</label>
      </disp-formula>
    </sec>
    <sec id="s12">
      <title>Equivalence between Equations (2) and (8)</title>
      <p>The likelihood Equation (2) for a tree <inline-formula><mml:math id="m318" display="inline" overflow="scroll"><mml:mi>𝒯</mml:mi></mml:math></inline-formula> is recursive, and when using <inline-formula><mml:math id="m319" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m320" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">…</mml:mi><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) needs to be resolved with a pruning algorithm while climbing the tree. However, for a tree with known node states, we can transform it into a non-recursive Equation (8) with <inline-formula><mml:math id="m321" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, by alternating <italic toggle="yes">replacement</italic> and <italic toggle="yes">unfolding</italic> steps. A replacement step consists in replacing <inline-formula><mml:math id="m322" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="m323" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo rspace="0.055em">)</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.222em">⋅</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and is followed by an unfolding step. An unfolding step either (if <inline-formula><mml:math id="m324" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is a tip) unfolds <inline-formula><mml:math id="m325" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m326" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and stops; or (if <inline-formula><mml:math id="m327" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> is an internal node) unfolds <inline-formula><mml:math id="m328" display="inline" overflow="scroll"><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> into <inline-formula><mml:math id="m329" display="inline" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>⁢</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and proceeds with replacements. In Equation (11) we show the transformation process.</p>
      <disp-formula>
        <mml:math id="m12" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi>L</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mi>𝒯</mml:mi>
                      <mml:mo fence="false">|</mml:mo>
                      <mml:mi mathvariant="normal">Θ</mml:mi>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mn>0</mml:mn>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext>Equation (2)</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m13" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>p</mml:mi>
                          <mml:mrow>
                            <mml:mi>s</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mn>0</mml:mn>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo rspace="0.055em">)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo rspace="0.222em">⋅</mml:mo>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>0</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                    </mml:mrow>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mi>(note that</mml:mi>
                <mml:mrow>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo mathvariant="italic">⁢</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo mathvariant="normal">(</mml:mo>
                        <mml:mn mathvariant="normal">0</mml:mn>
                        <mml:mo mathvariant="normal">)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mrow>
                      <mml:mo mathvariant="normal">(</mml:mo>
                      <mml:mn mathvariant="normal">0</mml:mn>
                      <mml:mo mathvariant="normal">)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mo mathvariant="normal">=</mml:mo>
                  <mml:mn mathvariant="normal">1</mml:mn>
                </mml:mrow>
                <mml:mi>as the root branch is of length zero)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>L</mml:mi>
                      <mml:mi>k</mml:mi>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>L</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mn>0</mml:mn>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> unfolding of </mml:mtext>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>0</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:mo>+</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd/>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo rspace="0.222em">×</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mtext mathvariant="italic"> </mml:mtext>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> replacement</mml:mtext>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
      </disp-formula>
      <disp-formula>
        <mml:math id="m14" display="block" overflow="scroll">
          <mml:mtable>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:msubsup>
                      <mml:mi>C</mml:mi>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> (note that </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>00</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> and </mml:mtext>
                      <mml:msubsup>
                        <mml:mi>C</mml:mi>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mn>01</mml:mn>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:msubsup>
                      <mml:mtext mathvariant="italic"> do not depend</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mi>on k, and can be put outside of the sum)</mml:mi>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>00</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>00</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>01</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mn>01</mml:mn>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mn>0</mml:mn>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>00</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>00</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>01</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mn>01</mml:mn>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mn>0</mml:mn>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>00</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if left child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>x</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>00</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>000</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>x</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>001</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>00</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo>+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>x</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>000</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>00</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>001</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>00</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>000</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>000</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>001</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>001</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do not</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">depend on </mml:mtext>
                            <mml:mi>x</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">←</mml:mo>
                <mml:mi> unfolding of</mml:mi>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">00</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo lspace="1.122em" rspace="0.222em">⋅</mml:mo>
                  <mml:mrow>
                    <mml:mo>{</mml:mo>
                    <mml:mtable columnspacing="5pt" rowspacing="0pt">
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:msub>
                              <mml:mi>ψ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>ρ</mml:mi>
                              <mml:mrow>
                                <mml:mi>s</mml:mi>
                                <mml:mo>⁢</mml:mo>
                                <mml:mn>01</mml:mn>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mtext mathvariant="italic">,   if right child of root is a tip</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:munderover>
                              <mml:mo>∑</mml:mo>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>=</mml:mo>
                                <mml:mn>1</mml:mn>
                              </mml:mrow>
                              <mml:mi>d</mml:mi>
                            </mml:munderover>
                            <mml:msub>
                              <mml:mi>λ</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mi>y</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>01</mml:mn>
                                  </mml:mrow>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>010</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                              <mml:msubsup>
                                <mml:mi>p</mml:mi>
                                <mml:mrow>
                                  <mml:mi>y</mml:mi>
                                  <mml:mo>,</mml:mo>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mn>011</mml:mn>
                                  </mml:mrow>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:msub>
                                  <mml:mi>t</mml:mi>
                                  <mml:mn>01</mml:mn>
                                </mml:msub>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mo rspace="0.392em">+</mml:mo>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mi>y</mml:mi>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>010</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:msubsup>
                              <mml:mi>p</mml:mi>
                              <mml:mrow>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>01</mml:mn>
                                </mml:mrow>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mo>(</mml:mo>
                                <mml:mn>011</mml:mn>
                                <mml:mo>)</mml:mo>
                              </mml:mrow>
                            </mml:msubsup>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:msub>
                                <mml:mi>t</mml:mi>
                                <mml:mn>01</mml:mn>
                              </mml:msub>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi/>
                            <mml:mo lspace="1.422em" rspace="0.222em">⋅</mml:mo>
                            <mml:mrow>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>010</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>010</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:msubsup>
                                <mml:mi>C</mml:mi>
                                <mml:mrow>
                                  <mml:mi>s</mml:mi>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mn>011</mml:mn>
                                </mml:mrow>
                                <mml:mrow>
                                  <mml:mo>(</mml:mo>
                                  <mml:mn>011</mml:mn>
                                  <mml:mo>)</mml:mo>
                                </mml:mrow>
                              </mml:msubsup>
                              <mml:mo>⁢</mml:mo>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">, otherwise   (note that </mml:mtext>
                                <mml:msubsup>
                                  <mml:mi>C</mml:mi>
                                  <mml:mrow>
                                    <mml:mi>s</mml:mi>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mo>(</mml:mo>
                                    <mml:mi mathvariant="normal">…</mml:mi>
                                    <mml:mo>)</mml:mo>
                                  </mml:mrow>
                                </mml:msubsup>
                                <mml:mtext mathvariant="italic"> do</mml:mtext>
                              </mml:mrow>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                      <mml:mtr>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">not depend on </mml:mtext>
                            <mml:mi>y</mml:mi>
                            <mml:mtext mathvariant="italic">)</mml:mtext>
                          </mml:mrow>
                        </mml:mtd>
                        <mml:mtd/>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mo mathvariant="normal">← unfolding of</mml:mo>
                <mml:msubsup>
                  <mml:mi>C</mml:mi>
                  <mml:mrow>
                    <mml:mi>s</mml:mi>
                    <mml:mo mathvariant="italic">⁢</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mo mathvariant="normal">(</mml:mo>
                    <mml:mn mathvariant="normal">01</mml:mn>
                    <mml:mo mathvariant="normal">)</mml:mo>
                  </mml:mrow>
                </mml:msubsup>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mi/>
                  <mml:mo>=</mml:mo>
                  <mml:mrow>
                    <mml:mi mathvariant="normal">…</mml:mi>
                    <mml:mo>⁢</mml:mo>
                    <mml:mrow>
                      <mml:mtext mathvariant="italic"> </mml:mtext>
                      <mml:mo>←</mml:mo>
                      <mml:mtext mathvariant="italic"> keep unfolding and replacing</mml:mtext>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>=</mml:mo>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>j</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext>𝑡𝑖𝑝𝑠</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>ψ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:msub>
                    <mml:mi>ρ</mml:mi>
                    <mml:mrow>
                      <mml:mi>s</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:mi>j</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mstyle>
                    <mml:munder>
                      <mml:mo>∏</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mtext mathvariant="italic">intern. nodes</mml:mtext>
                      </mml:mrow>
                    </mml:munder>
                  </mml:mstyle>
                  <mml:mstyle>
                    <mml:munderover>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mi>d</mml:mi>
                    </mml:munderover>
                  </mml:mstyle>
                  <mml:msub>
                    <mml:mi>λ</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>k</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                        </mml:mrow>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>0</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                    <mml:msubsup>
                      <mml:mi>p</mml:mi>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>,</mml:mo>
                        <mml:mrow>
                          <mml:mi>s</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mrow>
                          <mml:mi>i</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
            <mml:mtr>
              <mml:mtd>
                <mml:mrow>
                  <mml:mo>+</mml:mo>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mi>k</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>0</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:msubsup>
                    <mml:mi>p</mml:mi>
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mrow>
                        <mml:mi>s</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>⁢</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:msubsup>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                  <mml:mrow>
                    <mml:mo>←</mml:mo>
                    <mml:mtext mathvariant="italic"> non-log Eq. (</mml:mtext>
                    <mml:mn>8</mml:mn>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mtd>
            </mml:mtr>
          </mml:mtable>
        </mml:math>
        <label>(11)</label>
      </disp-formula>
    </sec>
    <sec id="s13">
      <title>Stationary Distribution</title>
      <p>Stationary state distribution <inline-formula><mml:math id="m330" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Π</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo rspace="0.278em">}</mml:mo></mml:mrow></mml:mrow><mml:mo rspace="0.558em">:</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the ratios of states <inline-formula><mml:math id="m331" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="m332" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> at a given time <inline-formula><mml:math id="m333" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula> after these ratios stopped changing (assuming that this may happen). <inline-formula><mml:math id="m334" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m335" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the number of individuals of type <inline-formula><mml:math id="m336" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>E</mml:mi><mml:mo>,</mml:mo><mml:mi>I</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m337" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the total number of infected (infectious or not) individuals at time <inline-formula><mml:math id="m338" display="inline" overflow="scroll"><mml:mi>t</mml:mi></mml:math></inline-formula>. Hence, the derivative of the number of individuals of type <inline-formula><mml:math id="m339" display="inline" overflow="scroll"><mml:mi>s</mml:mi></mml:math></inline-formula> is proportional to the derivative of the total number of infected individuals:</p>
      <disp-formula>
        <mml:math id="m15" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:msub>
                  <mml:mi>N</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>π</mml:mi>
                  <mml:mi>s</mml:mi>
                </mml:msub>
                <mml:mo>⁢</mml:mo>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(12)</label>
      </disp-formula>
      <p>The number of individuals in state <inline-formula><mml:math id="m340" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> increases due to becoming infectious of individuals in state <inline-formula><mml:math id="m341" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> and decreases due to removal, while the number of individuals in state <inline-formula><mml:math id="m342" display="inline" overflow="scroll"><mml:mi>E</mml:mi></mml:math></inline-formula> decreases due to becoming infectious and increases due to transmissions:</p>
      <disp-formula>
        <mml:math id="m16" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi>d</mml:mi>
                      <mml:mo>⁢</mml:mo>
                      <mml:msub>
                        <mml:mi>N</mml:mi>
                        <mml:mi>E</mml:mi>
                      </mml:msub>
                      <mml:mo>⁢</mml:mo>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:mi>t</mml:mi>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mi/>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mrow>
                            <mml:mi>μ</mml:mi>
                            <mml:mo>⁢</mml:mo>
                            <mml:msub>
                              <mml:mi>N</mml:mi>
                              <mml:mi>E</mml:mi>
                            </mml:msub>
                            <mml:mo>⁢</mml:mo>
                            <mml:mrow>
                              <mml:mo>(</mml:mo>
                              <mml:mi>t</mml:mi>
                              <mml:mo>)</mml:mo>
                            </mml:mrow>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mo>+</mml:mo>
                        <mml:mrow>
                          <mml:mi>λ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>N</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                          <mml:mo>⁢</mml:mo>
                          <mml:mrow>
                            <mml:mo>(</mml:mo>
                            <mml:mi>t</mml:mi>
                            <mml:mo>)</mml:mo>
                          </mml:mrow>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(13)</label>
      </disp-formula>
      <p>Becoming infectious changes the corresponding individual’s state but does not affect the total number of infected individuals, transmissions increase the total number, and removal decreases it. Note that only individuals in state <inline-formula><mml:math id="m343" display="inline" overflow="scroll"><mml:mi>I</mml:mi></mml:math></inline-formula> can transmit or be removed:</p>
      <disp-formula>
        <mml:math id="m17" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mrow>
                <mml:mi>d</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mo>⁢</mml:mo>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>t</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>=</mml:mo>
              <mml:mrow>
                <mml:mrow>
                  <mml:mi>λ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mo>−</mml:mo>
                <mml:mrow>
                  <mml:mi>ψ</mml:mi>
                  <mml:mo>⁢</mml:mo>
                  <mml:msub>
                    <mml:mi>N</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                  <mml:mo>⁢</mml:mo>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mi>t</mml:mi>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
            </mml:mrow>
            <mml:mo lspace="0em">.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(14)</label>
      </disp-formula>
      <p>Combining [13] and [14] we rewrite [12] as a system of multivariate algebraic equations:</p>
      <disp-formula>
        <mml:math id="m18" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mrow>
              <mml:mo>{</mml:mo>
              <mml:mtable columnspacing="5pt" rowspacing="0pt">
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:mrow>
                          <mml:mi>μ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>E</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                        <mml:mo>−</mml:mo>
                        <mml:mrow>
                          <mml:mi>ψ</mml:mi>
                          <mml:mo>⁢</mml:mo>
                          <mml:msub>
                            <mml:mi>π</mml:mi>
                            <mml:mi>I</mml:mi>
                          </mml:msub>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                          <mml:mn>2</mml:mn>
                        </mml:msubsup>
                        <mml:mo>⁢</mml:mo>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mrow>
                            <mml:mi>λ</mml:mi>
                            <mml:mo>−</mml:mo>
                            <mml:mi>ψ</mml:mi>
                          </mml:mrow>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
                <mml:mtr>
                  <mml:mtd columnalign="left">
                    <mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>E</mml:mi>
                        </mml:msub>
                        <mml:mo>+</mml:mo>
                        <mml:msub>
                          <mml:mi>π</mml:mi>
                          <mml:mi>I</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:mtd>
                  <mml:mtd/>
                </mml:mtr>
              </mml:mtable>
            </mml:mrow>
            <mml:mo>,</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(15)</label>
      </disp-formula>
      <p>from which we derive a quadratic equation for <inline-formula><mml:math id="m344" display="inline" overflow="scroll"><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="m345" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mi>π</mml:mi><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>λ</mml:mi><mml:mo>−</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>ψ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, and the following stationary distribution:</p>
      <disp-formula>
        <mml:math id="m19" display="block" overflow="scroll">
          <mml:mrow>
            <mml:mo>{</mml:mo>
            <mml:mtable columnspacing="5pt" rowspacing="0pt">
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>I</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mo>{</mml:mo>
                      <mml:mtable columnspacing="5pt" rowspacing="0pt">
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mrow>
                                <mml:mstyle>
                                  <mml:mfrac>
                                    <mml:mi>μ</mml:mi>
                                    <mml:mrow>
                                      <mml:mi>μ</mml:mi>
                                      <mml:mo>+</mml:mo>
                                      <mml:mi>ψ</mml:mi>
                                    </mml:mrow>
                                  </mml:mfrac>
                                </mml:mstyle>
                                <mml:mo>,</mml:mo>
                                <mml:mrow>
                                  <mml:mtext mathvariant="italic"> if </mml:mtext>
                                  <mml:mo>⁢</mml:mo>
                                  <mml:mi>λ</mml:mi>
                                </mml:mrow>
                              </mml:mrow>
                              <mml:mo>=</mml:mo>
                              <mml:mi>ψ</mml:mi>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd columnalign="left">
                            <mml:mrow>
                              <mml:mstyle>
                                <mml:mfrac>
                                  <mml:mrow>
                                    <mml:mrow>
                                      <mml:mo>−</mml:mo>
                                      <mml:mrow>
                                        <mml:mo>(</mml:mo>
                                        <mml:mrow>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>+</mml:mo>
                                          <mml:mi>ψ</mml:mi>
                                        </mml:mrow>
                                        <mml:mo>)</mml:mo>
                                      </mml:mrow>
                                    </mml:mrow>
                                    <mml:mo>+</mml:mo>
                                    <mml:msqrt>
                                      <mml:mrow>
                                        <mml:msup>
                                          <mml:mrow>
                                            <mml:mo>(</mml:mo>
                                            <mml:mrow>
                                              <mml:mi>μ</mml:mi>
                                              <mml:mo>−</mml:mo>
                                              <mml:mi>ψ</mml:mi>
                                            </mml:mrow>
                                            <mml:mo>)</mml:mo>
                                          </mml:mrow>
                                          <mml:mn>2</mml:mn>
                                        </mml:msup>
                                        <mml:mo>+</mml:mo>
                                        <mml:mrow>
                                          <mml:mn>4</mml:mn>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>μ</mml:mi>
                                          <mml:mo>⁢</mml:mo>
                                          <mml:mi>λ</mml:mi>
                                        </mml:mrow>
                                      </mml:mrow>
                                    </mml:msqrt>
                                  </mml:mrow>
                                  <mml:mrow>
                                    <mml:mn>2</mml:mn>
                                    <mml:mo>⁢</mml:mo>
                                    <mml:mrow>
                                      <mml:mo>(</mml:mo>
                                      <mml:mrow>
                                        <mml:mi>λ</mml:mi>
                                        <mml:mo>−</mml:mo>
                                        <mml:mi>ψ</mml:mi>
                                      </mml:mrow>
                                      <mml:mo>)</mml:mo>
                                    </mml:mrow>
                                  </mml:mrow>
                                </mml:mfrac>
                              </mml:mstyle>
                              <mml:mo>⁢</mml:mo>
                              <mml:mtext mathvariant="italic">, otherwise </mml:mtext>
                            </mml:mrow>
                          </mml:mtd>
                          <mml:mtd/>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
              <mml:mtr>
                <mml:mtd columnalign="left">
                  <mml:msub>
                    <mml:mi>π</mml:mi>
                    <mml:mi>E</mml:mi>
                  </mml:msub>
                </mml:mtd>
                <mml:mtd columnalign="left">
                  <mml:mrow>
                    <mml:mi/>
                    <mml:mo>=</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo>−</mml:mo>
                      <mml:msub>
                        <mml:mi>π</mml:mi>
                        <mml:mi>I</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mtd>
              </mml:mtr>
            </mml:mtable>
          </mml:mrow>
        </mml:math>
        <label>(16)</label>
      </disp-formula>
    </sec>
    <sec id="s14">
      <title>PyBDEI, Its Code and Data Availability</title>
      <p>Parameter estimation starts with a preprocessing step of reading the input trees, calculating the time <inline-formula><mml:math id="m346" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> at each node <inline-formula><mml:math id="m347" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and memorising the association between each node and its child nodes: <inline-formula><mml:math id="m348" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This step requires one tree traversal, and its time is negligible with respect to the numerical master equation resolution performed in the next steps.</p>
      <p>The estimation then proceeds with a search for the optimal parameter set <inline-formula><mml:math id="m349" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>arg</mml:mi><mml:mo lspace="0.450em">⁢</mml:mo><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo>∈</mml:mo><mml:mi>𝒬</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m350" display="inline" overflow="scroll"><mml:mi>𝒬</mml:mi></mml:math></inline-formula> is the set of admissible parameter values. We use the globally-convergent method of moving asymptotes (<xref rid="CIT0037" ref-type="bibr">Svanberg, 2002</xref>) for the optimization. At each optimization step <inline-formula><mml:math id="m351" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> the corresponding likelihood <inline-formula><mml:math id="m352" display="inline" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ℱ</mml:mi><mml:mo fence="false">|</mml:mo><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> needs to be calculated, which implies calculating <inline-formula><mml:math id="m353" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⁢</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> for each of the <inline-formula><mml:math id="m354" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed internal nodes of <inline-formula><mml:math id="m355" display="inline" overflow="scroll"><mml:mi>ℱ</mml:mi></mml:math></inline-formula>, and combining them as in the forest likelihood formula (Eq. (4)). The reconditioned version of BDEI master equations (10) for the parameter values <inline-formula><mml:math id="m356" display="inline" overflow="scroll"><mml:msub><mml:mi mathvariant="normal">Θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> can be resolved in parallel for each of the <inline-formula><mml:math id="m357" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></inline-formula> observed forest nodes (differing in the times <inline-formula><mml:math id="m358" display="inline" overflow="scroll"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> of their boundary conditions).</p>
      <p>To resolve these master equations numerically, we start by separating the self-defined subsystem for the unknowns <inline-formula><mml:math id="m359" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m360" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from the rest of System (10), and calculate it independently. Taking into account the fact that the equations in System (10) are either linear (for <inline-formula><mml:math id="m361" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m362" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mo>⁢</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) or quadratic (for <inline-formula><mml:math id="m363" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>E</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="m364" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) the use of an implicit scheme is simple. We chose implicit schemes with an automatic computation of the time step, such that the error is less than a given tolerance. In our implementation, we used the implicit Euler scheme (<xref rid="CIT0003" ref-type="bibr">Butcher, 2016</xref>) for solving the linear equations and the Crank-Nicolson implicit scheme (<xref rid="CIT0005" ref-type="bibr">Crank and Nicolson, 1947</xref>) for the non-linear ones. This permits us to avoid possible stability time restrictions and only choose the time steps for precision.</p>
      <p>The core of our estimator is implemented in C++ and uses the NLopt library (Johnson, <xref rid="CIT0020" ref-type="bibr"> </xref>) for non-linear optimization. The parallelization is achieved with the C++ <monospace>thread_pool</monospace> tools (<xref rid="CIT0048" ref-type="bibr">Williams, 2012</xref>). To facilitate the use of our estimator in Python and perform additional validation of input trees, we wrapped the core estimator into a Python 3 library PyBDEI. PyBDEI uses ETE 3 framework for tree manipulation (<xref rid="CIT0017" ref-type="bibr">Huerta-Cepas et al., 2016</xref>) and NumPy package for array operations (<xref rid="CIT0014" ref-type="bibr">Harris et al., 2020</xref>).</p>
      <p>Our estimator is available as a command-line program and a Python 3 library via PyPi (<ext-link xlink:href="https://pypi.org/project/pybdei" ext-link-type="uri">https://pypi.org/project/pybdei</ext-link>), and via Docker/Singularity (<ext-link xlink:href="https://hub.docker.com/r/evolbioinfo/bdei" ext-link-type="uri">https://hub.docker.com/r/evolbioinfo/bdei</ext-link>). Its source code, the simulated and real data used for its assessment, as well as the Snakemake (<xref rid="CIT0022" ref-type="bibr">Köster and Rahmann, 2012</xref>) data analysis pipelines, and the installation and usage documentation are available on GitHub at <ext-link xlink:href="https://github.com/evolbioinfo/bdei" ext-link-type="uri">github.com/evolbioinfo/bdei</ext-link>. The simulated data are also available from the Dryad Digital Repository: <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
    </sec>
    <sec id="s15">
      <title>BEAST2 and PhyloDeep Settings</title>
      <p>BEAST2 (v2.6.2 with package bdmm (<xref rid="CIT0031" ref-type="bibr">Scire et al., 2022</xref>) v1.0) was configured for <inline-formula><mml:math id="m365" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps with the following priors: <inline-formula><mml:math id="m366" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.02</mml:mn><mml:mo>,</mml:mo><mml:mn>5.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m367" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>1.0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m368" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value (<inline-formula><mml:math id="m369" display="inline" overflow="scroll"><mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0.01</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>[</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, different for different trees). The initial values in the MCMC were set to the medians used in the PhyloDeep training set, namely <inline-formula><mml:math id="m370" display="inline" overflow="scroll"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>2.51</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m371" display="inline" overflow="scroll"><mml:mrow><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.55</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m372" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. The tree was fixed to the real tree. For each tree, the Effective Sample Size (ESS) on all parameters was evaluated, and the median of a posteriori values was reported, corresponding to all recorded steps (i.e., actual MCMC steps spaced by 1000) past the 10% burn-in. The simulations for which BEAST2 did not converge after <inline-formula><mml:math id="m373" display="inline" overflow="scroll"><mml:msup><mml:mn>10</mml:mn><mml:mn>6</mml:mn></mml:msup></mml:math></inline-formula> MCMC steps (2%) were discarded from the analyses.</p>
      <p>PhyloDeep (v0.2.51) was run with <inline-formula><mml:math id="m374" display="inline" overflow="scroll"><mml:mi>ρ</mml:mi></mml:math></inline-formula> fixed to the real value and Convolutional Neural Networks trained on the Compact Bijective Ladderized Vector full tree representation (CNN-CBLV).</p>
      <p>The visualizations of the analyses of simulated data were performed with the Python 3 library seaborn (v0.11.2) (<xref rid="CIT0045" ref-type="bibr">Waskom, 2021</xref>; <xref rid="CIT0018" ref-type="bibr">Hunter, 2007</xref>).</p>
    </sec>
    <sec id="s16">
      <title>Tree Reconstruction for Ebola SLE Epidemic Analysis</title>
      <p>We reconstructed a maximum-likelihood phylogeny of 1610 tips for the Ebola samples from (<xref rid="CIT0008" ref-type="bibr">Dudas et al., 2017</xref>) with RAxML-NG (v1.0.2, GTR+G4+FO+IO) (<xref rid="CIT0023" ref-type="bibr">Kozlov et al., 2019</xref>), and rooted it based on sampling dates using LSD2 (v2.4.1) (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>). As Ebola’s mutation rate is slower than its transmission rate, the initial phylogeny contained <inline-formula><mml:math id="m375" display="inline" overflow="scroll"><mml:mn>242</mml:mn></mml:math></inline-formula> polytomies (i.e., multiple transmissions, which happened faster than the virus acquired a mutation, hence making them undistinguishable in the phylogeny). The BDEI model, on the other hand, assumes a binary tree. We therefore resolved these polytomies randomly (10 times, to check for robustness of the estimates) using a coalescent approach.</p>
      <p>We then dated each of the 10 trees with LSD2 (<xref rid="CIT0040" ref-type="bibr">To et al., 2016</xref>) (v2.4.1: <ext-link xlink:href="https://github.com/tothuhien/lsd2/tree/v.2.4.1" ext-link-type="uri">https://github.com/tothuhien/lsd2/tree/v.2.4.1</ext-link>, under strict molecular clock with outlier removal) using tip sampling dates, and reconstructed the ancestral characters for country with PastML (<xref rid="CIT0019" ref-type="bibr">Ishikawa et al., 2019</xref>) (v1.9.40, MPPA+F81).</p>
      <p>Lastly, we extracted 10 SLE forests from these trees to represent the Ebola epidemic in SLE between July 30, 2014 (when the SLE government began to deploy troops to enforce quarantines (<xref rid="CIT0028" ref-type="bibr">News24, 2014</xref>)) and September 7, 2015 (the last SLE sample in our dataset) by (1) cutting each tree on July 30, 2014 to remove the more ancient part (with a different health policy); (2) among the July-31-on trees, picking those whose root’s predicted character state for country was SLE (light-green branches at the level of July 31, 2014 in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link> in online Appendix); (3) removing the non-SLE subtrees (indicated with other colors in <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">Fig. S3</ext-link>) from the selected July-31-on SLE trees to focus on the epidemic within the country, without further reintroductions.</p>
      <p>The reconstruction took 1 hour for the phylogeny, 10 minutes for tree dating, and 1 minute for country ancestral character prediction.</p>
    </sec>
  </sec>
</body>
<back>
  <ack id="a1">
    <title>Acknowledgments</title>
    <p>The authors thank Dr Jakub Voznica for valuable discussions.</p>
  </ack>
  <sec id="s17">
    <title>Supplementary Material</title>
    <p>Supplementary material, including data files and the online-only appendix, can be found in the Dryad data repository at <ext-link xlink:href="https://doi.org/10.5061/dryad.r7sqv9sgx" ext-link-type="uri">https://doi.org/10.5061/dryad.r7sqv9sgx</ext-link>.</p>
  </sec>
  <sec id="s18">
    <title>Funding</title>
    <p>O.G. was supported by PRAIRIE (ANR-19-P3IA-0001). Y.M. was supported by European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation program (grant agreement No 810367), project EMC2.</p>
  </sec>
  <sec id="s19">
    <title>Author Contributions</title>
    <p>O.G. initiated the project and provided critical assessment of project progression; A.Z. conceived the new master equation representation, extension to forests, applications to Ebola and simulated data, and coordinated the project; F.H. and Y.M. conceived the numerical approach for fast and efficient parameter optimization; F.H. implemented the numerical approach; A.Z. wrote the manuscript with input from all the authors; all authors discussed the intermediate and final results.</p>
  </sec>
  <ref-list id="r1">
    <title>REFERENCES</title>
    <ref id="CIT0001">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Berger</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2009</year>. <article-title>Accuracy and Performance of single versus double precision arithmetics for maximum likelihood phylogeny reconstruction Lecture Notes in Computer Science (including subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics)</article-title>. <volume>6068 LNCS</volume>:<fpage>270</fpage>–<lpage>279</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0002">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bouckaert</surname><given-names>R.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Duchêne</surname><given-names>S.</given-names></string-name>, <string-name><surname>Fourment</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gavryushkina</surname><given-names>A.</given-names></string-name>, <string-name><surname>Heled</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jones</surname><given-names>G.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Matschiner</surname><given-names>M.</given-names></string-name>, <string-name><surname>Mendes</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Müller</surname><given-names>N.F.</given-names></string-name>, <string-name><surname>Ogilvie</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Du Plessis</surname><given-names>L.</given-names></string-name>, <string-name><surname>Popinga</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.</given-names></string-name>, <string-name><surname>Siveroni</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C.H.</given-names></string-name>, <string-name><surname>Xie</surname><given-names>D.</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>C.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2019</year>. <article-title>BEAST 25: An advanced software platform for Bayesian evolutionary analysis</article-title>. <source>PLoS Comput. Biol</source>. <volume>15</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0003">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Butcher</surname><given-names>JC.</given-names></string-name></person-group><year>2016</year>. <source>Numerical methods for ordinary differential equations</source>. <edition>3 ed</edition>. <publisher-name>Wiley</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0004">
      <mixed-citation publication-type="other"><collab>CDC</collab>. <year>2020</year>. <comment>2014–2016 Ebola outbreak in West Africa: case counts</comment>. Available from <ext-link xlink:href="https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html" ext-link-type="uri">https://www.cdc.gov/vhf/ebola/history/2014-2016-outbreak/case-counts.html</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0005">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Crank</surname><given-names>J.</given-names></string-name>, <string-name><surname>Nicolson</surname><given-names>P.</given-names></string-name></person-group><year>1947</year>. <article-title>A practical method for numerical evaluation of solutions of partial differential equations of the heat-conduction type</article-title>. <source>Math. Proc. Camb. Philos. Soc</source>. <volume>43</volume>:<fpage>50</fpage>–<lpage>67</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0006">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Defour</surname><given-names>D.</given-names></string-name></person-group><year>2010</year>. <comment>Accuracy of a maximum likelihood phylogeny reconstruction. Technical report. LIRMM</comment>. Available from <ext-link xlink:href="https://hal.archives-ouvertes.fr/hal-00726409" ext-link-type="uri">https://hal.archives-ouvertes.fr/hal-00726409</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0007">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Shapiro</surname><given-names>B.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name></person-group><year>2005</year>. <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>. <source>Mol. Biol. Evol</source>. <volume>22</volume>:<fpage>1185</fpage>–<lpage>1192</lpage>.<pub-id pub-id-type="pmid">15703244</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0008">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Carvalho</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Tatem</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Baele</surname><given-names>G.</given-names></string-name>, <string-name><surname>Faria</surname><given-names>N.R.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Ladner</surname><given-names>J.T.</given-names></string-name>, <string-name><surname>Arias</surname><given-names>A.</given-names></string-name>, <string-name><surname>Asogun</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bielejec</surname><given-names>F.</given-names></string-name>, <string-name><surname>Caddy</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Cotten</surname><given-names>M.</given-names></string-name>, <string-name><surname>D’Ambrozio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Dellicour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Di Caro</surname><given-names>A.</given-names></string-name>, <string-name><surname>Diclaro</surname><given-names>J.W.</given-names></string-name>, <string-name><surname>Duraffour</surname><given-names>S.</given-names></string-name>, <string-name><surname>Elmore</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Fakoli</surname><given-names>L.S.</given-names></string-name>, <string-name><surname>Faye</surname><given-names>O.</given-names></string-name>, <string-name><surname>Gilbert</surname><given-names>M.L.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gire</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gladden-Young</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Haagmans</surname><given-names>B.L.</given-names></string-name>, <string-name><surname>Hiscox</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Jah</surname><given-names>U.</given-names></string-name>, <string-name><surname>Kugelman</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Liu</surname><given-names>D.</given-names></string-name>, <string-name><surname>Lu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Mate</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matthews</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Meredith</surname><given-names>L.W.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Quick</surname><given-names>J.</given-names></string-name>, <string-name><surname>Pas</surname><given-names>S.D.</given-names></string-name>, <string-name><surname>Phan</surname><given-names>M.V.T.</given-names></string-name>, <string-name><surname>Pollakis</surname><given-names>G.</given-names></string-name>, <string-name><surname>Reusken</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Sanchez-Lockhart</surname><given-names>M.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Schieffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Simon-Loriere</surname><given-names>E.</given-names></string-name>, <string-name><surname>Smits</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Stoecker</surname><given-names>K.</given-names></string-name>, <string-name><surname>Thorne</surname><given-names>L.</given-names></string-name>, <string-name><surname>Tobin</surname><given-names>E.A.</given-names></string-name>, <string-name><surname>Vandi</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Watson</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>West</surname><given-names>K.</given-names></string-name>, <string-name><surname>Whitmer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wiley</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Wölfel</surname><given-names>R.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Blyden</surname><given-names>S.O.</given-names></string-name>, <string-name><surname>Bolay</surname><given-names>F.</given-names></string-name>, <string-name><surname>Carroll</surname><given-names>M.W.</given-names></string-name>, <string-name><surname>Dahn</surname><given-names>B.</given-names></string-name>, <string-name><surname>Diallo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Formenty</surname><given-names>P.</given-names></string-name>, <string-name><surname>Fraser</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gao</surname><given-names>G.F.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Goodfellow</surname><given-names>I.</given-names></string-name>, <string-name><surname>Günther</surname><given-names>S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.T.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>B.</given-names></string-name>, <string-name><surname>Keïta</surname><given-names>S.</given-names></string-name>, <string-name><surname>Kellam</surname><given-names>P.</given-names></string-name>, <string-name><surname>Koopmans</surname><given-names>M.P.G.</given-names></string-name>, <string-name><surname>Kuhn</surname><given-names>J.H.</given-names></string-name>, <string-name><surname>Loman</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Magassouba</surname><given-names>N.</given-names></string-name>, <string-name><surname>Naidoo</surname><given-names>D.</given-names></string-name>, <string-name><surname>Nichol</surname><given-names>S.T.</given-names></string-name>, <string-name><surname>Nyenswah</surname><given-names>T.</given-names></string-name>, <string-name><surname>Palacios</surname><given-names>G.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name>, <string-name><surname>Sall</surname><given-names>A.</given-names></string-name>, <string-name><surname>Ströher</surname><given-names>U.</given-names></string-name>, <string-name><surname>Wurie</surname><given-names>I.</given-names></string-name>, <string-name><surname>Suchard</surname><given-names>M.A.</given-names></string-name>, <string-name><surname>Lemey</surname><given-names>P.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name></person-group><year>2017</year>. <article-title>Virus genomes reveal factors that spread and sustained the Ebola epidemic</article-title>. <source>Nature</source>. <volume>544</volume>:<fpage>309</fpage>–<lpage>315</lpage>.<pub-id pub-id-type="pmid">28405027</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0009">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Felsenstein</surname><given-names>J.</given-names></string-name></person-group><year>1973</year>. <article-title>Maximum likelihood and minimum-steps methods for estimating evolutionary trees from data on discrete characters</article-title>. <source>Syst. Biol</source>. <volume>22</volume>:<fpage>240</fpage>–<lpage>249</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0010">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>FitzJohn</surname><given-names>R.G.</given-names></string-name>, <string-name><surname>Maddison</surname><given-names>W.P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.P.</given-names></string-name></person-group><year>2009</year>. <article-title>Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies</article-title>. <source>Syst. Biol</source>. <volume>58</volume>:<fpage>595</fpage>–<lpage>611</lpage>.<pub-id pub-id-type="pmid">20525612</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0011">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gire</surname><given-names>S.K.</given-names></string-name>, <string-name><surname>Goba</surname><given-names>A.</given-names></string-name>, <string-name><surname>Andersen</surname><given-names>K.G.</given-names></string-name>, <string-name><surname>Sealfon</surname><given-names>R.S.</given-names></string-name>, <string-name><surname>Park</surname><given-names>D.J.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>L.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>S.</given-names></string-name>, <string-name><surname>Momoh</surname><given-names>M.</given-names></string-name>, <string-name><surname>Fullah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Dudas</surname><given-names>G.</given-names></string-name>, <string-name><surname>Wohl</surname><given-names>S.</given-names></string-name>, <string-name><surname>Moses</surname><given-names>L.M.</given-names></string-name>, <string-name><surname>Yozwiak</surname><given-names>N.L.</given-names></string-name>, <string-name><surname>Winnicki</surname><given-names>S.</given-names></string-name>, <string-name><surname>Matranga</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Malboeuf</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Qu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gladden</surname><given-names>A.D.</given-names></string-name>, <string-name><surname>Schaffner</surname><given-names>S.F.</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X.</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>P.P.</given-names></string-name>, <string-name><surname>Nekoui</surname><given-names>M.</given-names></string-name>, <string-name><surname>Colubri</surname><given-names>A.</given-names></string-name>, <string-name><surname>Coomber</surname><given-names>M.R.</given-names></string-name>, <string-name><surname>Fonnie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Moigboi</surname><given-names>A.</given-names></string-name>, <string-name><surname>Gbakie</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kamara</surname><given-names>F.K.</given-names></string-name>, <string-name><surname>Tucker</surname><given-names>V.</given-names></string-name>, <string-name><surname>Konuwa</surname><given-names>E.</given-names></string-name>, <string-name><surname>Saffa</surname><given-names>S.</given-names></string-name>, <string-name><surname>Sellu</surname><given-names>J.</given-names></string-name>, <string-name><surname>Jalloh</surname><given-names>A.A.</given-names></string-name>, <string-name><surname>Kovoma</surname><given-names>A.</given-names></string-name>, <string-name><surname>Koninga</surname><given-names>J.</given-names></string-name>, <string-name><surname>Mustapha</surname><given-names>I.</given-names></string-name>, <string-name><surname>Kargbo</surname><given-names>K.</given-names></string-name>, <string-name><surname>Foday</surname><given-names>M.</given-names></string-name>, <string-name><surname>Yillah</surname><given-names>M.</given-names></string-name>, <string-name><surname>Kanneh</surname><given-names>F.</given-names></string-name>, <string-name><surname>Robert</surname><given-names>W.</given-names></string-name>, <string-name><surname>Massally</surname><given-names>J.L.</given-names></string-name>, <string-name><surname>Chapman</surname><given-names>S.B.</given-names></string-name>, <string-name><surname>Bochicchio</surname><given-names>J.</given-names></string-name>, <string-name><surname>Murphy</surname><given-names>C.</given-names></string-name>, <string-name><surname>Nusbaum</surname><given-names>C.</given-names></string-name>, <string-name><surname>Young</surname><given-names>S.</given-names></string-name>, <string-name><surname>Birren</surname><given-names>B.W.</given-names></string-name>, <string-name><surname>Grant</surname><given-names>D.S.</given-names></string-name>, <string-name><surname>Scheiffelin</surname><given-names>J.S.</given-names></string-name>, <string-name><surname>Lander</surname><given-names>E.S.</given-names></string-name>, <string-name><surname>Happi</surname><given-names>C.</given-names></string-name>, <string-name><surname>Gevao</surname><given-names>S.M.</given-names></string-name>, <string-name><surname>Gnirke</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Garry</surname><given-names>R.F.</given-names></string-name>, <string-name><surname>Khan</surname><given-names>S.H.</given-names></string-name>, <string-name><surname>Sabeti</surname><given-names>P.C.</given-names></string-name></person-group><year>2014</year>. <article-title>Genomic surveillance elucidates Ebola virus origin and transmission during the 2014 outbreak</article-title>. <source>Science</source>. <volume>345</volume>:<fpage>1369</fpage>–<lpage>1372</lpage>.<pub-id pub-id-type="pmid">25214632</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0012">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goldberg</surname><given-names>E.E.</given-names></string-name>, <string-name><surname>Igić</surname><given-names>B.</given-names></string-name></person-group><year>2012</year>. <article-title>Tempo and mode in plant breeding system evolution</article-title>. <source>Evolution</source><volume>66</volume>:<fpage>3701</fpage>–<lpage>3709</lpage>. _eprint: <ext-link xlink:href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x" ext-link-type="uri">https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.1558-5646.2012.01730.x</ext-link><pub-id pub-id-type="pmid">23206129</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0013">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grenfell</surname><given-names>B.T.</given-names></string-name>, <string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Gog</surname><given-names>J.R.</given-names></string-name>, <string-name><surname>Wood</surname><given-names>J.L.N.</given-names></string-name>, <string-name><surname>Daly</surname><given-names>J.M.</given-names></string-name>, <string-name><surname>Mumford</surname><given-names>J.A.</given-names></string-name>, <string-name><surname>Holmes</surname><given-names>E.C.</given-names></string-name></person-group><year>2004</year>. <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source>. <volume>303</volume>(<issue>5656</issue>):<fpage>327</fpage>–<lpage>332</lpage>.<pub-id pub-id-type="pmid">14726583</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0014">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Harris</surname><given-names>C.R.</given-names></string-name>, <string-name><surname>Millman</surname><given-names>K.J.</given-names></string-name>, <string-name><surname>van der Walt</surname><given-names>S.J.</given-names></string-name>, <string-name><surname>Gommers</surname><given-names>R.</given-names></string-name>, <string-name><surname>Virtanen</surname><given-names>P.</given-names></string-name>, <string-name><surname>Cournapeau</surname><given-names>D.</given-names></string-name>, <string-name><surname>Wieser</surname><given-names>E.</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>J.</given-names></string-name>, <string-name><surname>Berg</surname><given-names>S.</given-names></string-name>, <string-name><surname>Smith</surname><given-names>N.J.</given-names></string-name>, <string-name><surname>Kern</surname><given-names>R.</given-names></string-name>, <string-name><surname>Picus</surname><given-names>M.</given-names></string-name>, <string-name><surname>Hoyer</surname><given-names>S.</given-names></string-name>, <string-name><surname>van Kerkwijk</surname><given-names>M.H.</given-names></string-name>, <string-name><surname>Brett</surname><given-names>M.</given-names></string-name>, <string-name><surname>Haldane</surname><given-names>A.</given-names></string-name>, <string-name><surname>del Río</surname><given-names>J.F.</given-names></string-name>, <string-name><surname>Wiebe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Peterson</surname><given-names>P.</given-names></string-name>, <string-name><surname>Gérard-Marchant</surname><given-names>P.</given-names></string-name>, <string-name><surname>Sheppard</surname><given-names>K.</given-names></string-name>, <string-name><surname>Reddy</surname><given-names>T.</given-names></string-name>, <string-name><surname>Weckesser</surname><given-names>W.</given-names></string-name>, <string-name><surname>Abbasi</surname><given-names>H.</given-names></string-name>, <string-name><surname>Gohlke</surname><given-names>C.</given-names></string-name>, <string-name><surname>Oliphant</surname><given-names>T.E.</given-names></string-name></person-group><year>2020</year>. <article-title>Array programming with NumPy</article-title>. <source>Nature</source>. <volume>585</volume>:<fpage>357</fpage>–<lpage>362</lpage>.<pub-id pub-id-type="pmid">32939066</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0015">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hethcote</surname><given-names>H.W.</given-names></string-name></person-group><year>2000</year>. <article-title>The mathematics of infectious diseases</article-title>. <source>SIAM Rev</source>. <volume>42</volume>:<fpage>599</fpage>–<lpage>653</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0016">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hodcroft</surname><given-names>E.B.</given-names></string-name>, <string-name><surname>De Maio</surname><given-names>N.</given-names></string-name>, <string-name><surname>Lanfear</surname><given-names>R.</given-names></string-name>, <string-name><surname>MacCannell</surname><given-names>D.R.</given-names></string-name>, <string-name><surname>Minh</surname><given-names>B.Q.</given-names></string-name>, <string-name><surname>Schmidt</surname><given-names>H.A.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name>, <string-name><surname>Goldman</surname><given-names>N.</given-names></string-name>, <string-name><surname>Dessimoz</surname><given-names>C.</given-names></string-name></person-group><year>2021</year>. <article-title>Want to track pandemic variants faster? Fix the bioinformatics bottleneck</article-title>. <source>Nature</source>. <volume>591</volume>:<fpage>30</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">33649511</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0017">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huerta-Cepas</surname><given-names>J.</given-names></string-name>, <string-name><surname>Serra</surname><given-names>F.</given-names></string-name>, <string-name><surname>Bork</surname><given-names>P.</given-names></string-name></person-group><year>2016</year>. <article-title>ETE 3: reconstruction, analysis, and visualization of phylogenomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>1635</fpage>–<lpage>1638</lpage>.<pub-id pub-id-type="pmid">26921390</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0018">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hunter</surname><given-names>J.D.</given-names></string-name></person-group><year>2007</year>. <article-title>Matplotlib: A 2D graphics environment</article-title>. <source>Comput. Sci. Eng</source>. <volume>9</volume>:<fpage>90</fpage>–<lpage>95</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0019">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ishikawa</surname><given-names>S.A.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Iwasaki</surname><given-names>W.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2019</year>. <article-title>A fast likelihood method to reconstruct and visualize ancestral scenarios</article-title>. <source>Mol. Biol. Evol</source>. <volume>36</volume>:<fpage>2069</fpage>–<lpage>2085</lpage>.<pub-id pub-id-type="pmid">31127303</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0020">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>SG.</given-names></string-name></person-group><comment>The nlopt nonlinear-optimization package</comment>. Accessed: <comment>2021-01-26</comment>.</mixed-citation>
    </ref>
    <ref id="CIT0021">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kendall</surname><given-names>D.G.</given-names></string-name></person-group><year>1948</year>. <article-title>On the generalized “birth-and-death” process</article-title>. <source>Ann. Math</source>. <volume>19</volume>:<fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0022">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Köster</surname><given-names>J.</given-names></string-name>, <string-name><surname>Rahmann</surname><given-names>S.</given-names></string-name></person-group><year>2012</year>. <article-title>Snakemake-a scalable bioinformatics workflow engine</article-title>. <source>Bioinformatics</source>. <volume>28</volume>:<fpage>2520</fpage>–<lpage>2522</lpage>.<pub-id pub-id-type="pmid">22908215</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0023">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>A.M.</given-names></string-name>, <string-name><surname>Darriba</surname><given-names>D.</given-names></string-name>, <string-name><surname>Flouri</surname><given-names>T.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>B.</given-names></string-name>, <string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group><year>2019</year>. <article-title>RAxML-NG: a fast, scalable and user-friendly tool for maximum likelihood phylogenetic inference</article-title>. <source>Bioinformatics</source>. <volume>35</volume>:<fpage>4453</fpage>–<lpage>4455</lpage>.<pub-id pub-id-type="pmid">31070718</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0024">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2016</year>. <article-title>Phylodynamics with migration: a computational framework to quantify population structure from genomic data</article-title>. <source>Mol. Biol. Evol</source>. <volume>33</volume>:<fpage>2102</fpage>–<lpage>2116</lpage>.<pub-id pub-id-type="pmid">27189573</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0025">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2020</year>. <article-title>A general and efficient algorithm for the likelihood of diversification and discrete-trait evolutionary models</article-title>. <source>Syst. Biol</source>. <volume>69</volume>:<fpage>545</fpage>–<lpage>556</lpage>.<pub-id pub-id-type="pmid">31432088</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0026">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Macpherson</surname><given-names>A.</given-names></string-name>, <string-name><surname>Louca</surname><given-names>S.</given-names></string-name>, <string-name><surname>Mclaughlin</surname><given-names>A.</given-names></string-name>, <string-name><surname>Joy</surname><given-names>J.B.</given-names></string-name>, <string-name><surname>Pennell</surname><given-names>M.W.</given-names></string-name></person-group><year>2021</year>. <article-title>Unifying phylogenetic birth-death models in epidemiology and macroevolution</article-title>. <source>Syst. Biol</source>. <volume>71</volume>(<issue>1</issue>):<fpage>172</fpage>–<lpage>189</lpage>.<pub-id pub-id-type="pmid">34165577</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0027">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maddison</surname><given-names>W.</given-names></string-name>, <string-name><surname>Midford</surname><given-names>P.</given-names></string-name>, <string-name><surname>Otto</surname><given-names>S.</given-names></string-name></person-group><year>2007</year>. <article-title>Estimating a binary character’s effect on speciation and extinction</article-title>. <source>Syst. Biol</source>. <volume>56</volume>:<fpage>701</fpage>–<lpage>710</lpage>.<pub-id pub-id-type="pmid">17849325</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0028">
      <mixed-citation publication-type="other"><collab>News24</collab>. <year>2014</year>. <comment>Sierra leone, liberia deploy troops for ebola</comment>. Available from <ext-link xlink:href="https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804" ext-link-type="uri">https://www.news24.com/Africa/News/Sierra-Leone-Liberia-deploy-troops-for-Ebola-20140804</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0029">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pybus</surname><given-names>O.G.</given-names></string-name>, <string-name><surname>Rambaut</surname><given-names>A.</given-names></string-name>, <string-name><surname>Harvey</surname><given-names>P.H.</given-names></string-name></person-group><year>2000</year>. <article-title>An integrated framework for the inference of viral population history from reconstructed genealogies</article-title>. <source>Genetics</source>. <volume>155</volume>:<fpage>1429</fpage>–<lpage>1437</lpage>.<pub-id pub-id-type="pmid">10880500</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0030">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rivers</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Lofgren</surname><given-names>E.T.</given-names></string-name>, <string-name><surname>Marathe</surname><given-names>M.</given-names></string-name>, <string-name><surname>Eubank</surname><given-names>S.</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>B.L.</given-names></string-name></person-group><year>2014</year>. <article-title>Modeling the impact of interventions on an epidemic of Ebola in Sierra Leone and Liberia</article-title>. <source>PLoS Curr</source>. <volume>6</volume>:ecurrents.outbreaks.4d41fe5d6c05e9df30ddce33c66d084c.</mixed-citation>
    </ref>
    <ref id="CIT0031">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Scire</surname><given-names>J.</given-names></string-name>, <string-name><surname>Barido-Sottani</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Vaughan</surname><given-names>T.G.</given-names></string-name>, <string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2022</year>. <article-title>Robust phylodynamic analysis of genetic sequencing data from structured populations</article-title>. <source>Viruses</source>. <volume>14</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0032">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2009</year>. <article-title>On incomplete sampling under birth-death models and connections to the sampling-based coalescent</article-title>. <source>J. Theor. Biol</source>. <volume>261</volume>:<fpage>58</fpage>–<lpage>66</lpage>.<pub-id pub-id-type="pmid">19631666</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0033">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name></person-group><year>2010</year>. <article-title>Sampling-through-time in birth-death trees</article-title>. <source>J. Theor. Biol</source>. <volume>267</volume>:<fpage>396</fpage>–<lpage>404</lpage>.<pub-id pub-id-type="pmid">20851708</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0034">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name></person-group><year>2013</year>. <article-title>Uncovering epidemiological dynamics in heterogeneous host populations using phylogenetic methods</article-title>. <source>Philos. Trans. R. Soc. B Biol. Sci</source><volume>368</volume>:<fpage>20120198</fpage>–<lpage>20120198</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0035">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Bonhoeffer</surname><given-names>S.</given-names></string-name>, <string-name><surname>Drummond</surname><given-names>A.J.</given-names></string-name></person-group><year>2013</year>. <article-title>Birth-death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>110</volume>:<fpage>228</fpage>–<lpage>233</lpage>.<pub-id pub-id-type="pmid">23248286</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0036">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stadler</surname><given-names>T.</given-names></string-name>, <string-name><surname>Kühnert</surname><given-names>D.</given-names></string-name>, <string-name><surname>Rasmussen</surname><given-names>D.A.</given-names></string-name>, <string-name><surname>du Plessis</surname><given-names>L.</given-names></string-name></person-group><year>2014</year>. <article-title>Insights into the early epidemic spread of Ebola in Sierra Leone provided by viral sequence data</article-title>. <source>PLoS Curr</source><volume>6</volume>.</mixed-citation>
    </ref>
    <ref id="CIT0037">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Svanberg</surname><given-names>K.</given-names></string-name></person-group><year>2002</year>. <article-title>A class of globally convergent optimization methods based on conservative convex separable approximations</article-title>. <source>SIAM J. Optimiz</source><volume>12</volume>:<fpage>555</fpage>–<lpage>573</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0038">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2014</year>. <article-title>Ebola Virus disease in West Africa — the first 9 months of the epidemic and forward projections</article-title>. <source>N. Engl. J. Med</source>. <volume>371</volume>:<fpage>1481</fpage>–<lpage>1495</lpage>.<pub-id pub-id-type="pmid">25244186</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0039">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Team</surname><given-names>W.E.R.</given-names></string-name></person-group><year>2015</year>. <article-title>West African ebola epidemic after one year — slowing but not yet under control</article-title>. <source>N. Engl. J. Med</source>. <volume>372</volume>:<fpage>584</fpage>–<lpage>587</lpage>.<pub-id pub-id-type="pmid">25539446</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0040">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>To</surname><given-names>T.H.</given-names></string-name>, <string-name><surname>Jung</surname><given-names>M.</given-names></string-name>, <string-name><surname>Lycett</surname><given-names>S.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2016</year>. <article-title>Fast dating using least-squares criteria and algorithms</article-title>. <source>Syst. Biol</source>. <volume>65</volume>:<fpage>82</fpage>–<lpage>97</lpage>.<pub-id pub-id-type="pmid">26424727</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0041">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Van Kerkhove</surname><given-names>M.D.</given-names></string-name>, <string-name><surname>Bento</surname><given-names>A.I.</given-names></string-name>, <string-name><surname>Mills</surname><given-names>H.L.</given-names></string-name>, <string-name><surname>Ferguson</surname><given-names>N.M.</given-names></string-name>, <string-name><surname>Donnelly</surname><given-names>C.A.</given-names></string-name></person-group><year>2015</year>. <article-title>A review of epidemiological parameters from Ebola outbreaks to inform early public health decision-making</article-title>. <source>Sci. Data</source>. <volume>2</volume>:<fpage>1</fpage>–<lpage>10</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0042">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Koelle</surname><given-names>K.</given-names></string-name>, <string-name><surname>Bedford</surname><given-names>T.</given-names></string-name>, <string-name><surname>Bhattacharya</surname><given-names>T.</given-names></string-name>, <string-name><surname>Delaporte</surname><given-names>E.</given-names></string-name></person-group><year>2013</year>. <article-title>Viral phylodynamics</article-title>. <source>PLoS Comput. Biol</source>. <volume>9</volume>:<fpage>e1002947</fpage>.<pub-id pub-id-type="pmid">23555203</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0043">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Volz</surname><given-names>E.M.</given-names></string-name>, <string-name><surname>Kosakovsky Pond</surname><given-names>S.L.</given-names></string-name>, <string-name><surname>Ward</surname><given-names>M.J.</given-names></string-name>, <string-name><surname>Leigh Brown</surname><given-names>A.J.</given-names></string-name>, <string-name><surname>Frost</surname><given-names>S.D.</given-names></string-name></person-group><year>2009</year>. <article-title>Phylodynamics of infectious disease epidemics</article-title>. <source>Genetics</source>. <volume>183</volume>:<fpage>1421</fpage>–<lpage>1430</lpage>.<pub-id pub-id-type="pmid">19797047</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0044">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Boskova</surname><given-names>V.</given-names></string-name>, <string-name><surname>Saulnier</surname><given-names>E.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Moslonka-Lefebvre</surname><given-names>M.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2022</year>. <article-title>Deep learning from phylogenies to uncover the transmission dynamics of epidemics</article-title>. <source>Nat. Commun</source>. <volume>13</volume>:<fpage>3896</fpage>.<pub-id pub-id-type="pmid">35794110</pub-id></mixed-citation>
    </ref>
    <ref id="CIT0045">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Waskom</surname><given-names>M.L.</given-names></string-name></person-group><year>2021</year>. <article-title>seaborn: statistical data visualization</article-title>. <source>J. Open Source Software</source>. <volume>6</volume>:<fpage>3021</fpage>.</mixed-citation>
    </ref>
    <ref id="CIT0046">
      <mixed-citation publication-type="other"><collab>WHO</collab>. <year>2021</year>. <comment>Ebola virus disease [fact sheet]</comment>. Available from <ext-link xlink:href="https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease" ext-link-type="uri">https://www.who.int/news-room/fact-sheets/detail/ebola-virus-disease</ext-link>.</mixed-citation>
    </ref>
    <ref id="CIT0047">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wilks</surname><given-names>S.S.</given-names></string-name></person-group><year>1938</year>. <article-title>The large-sample distribution of the likelihood ratio for testing composite hypotheses</article-title>. <source>Ann. Math. Stat</source>. <volume>9</volume>:<fpage>60</fpage>–<lpage>62</lpage>.</mixed-citation>
    </ref>
    <ref id="CIT0048">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Williams</surname><given-names>A.</given-names></string-name></person-group><year>2012</year>. <source>C++ concurrency in action: practical multithreading</source>, <edition>1</edition>st ed. <publisher-loc>Shelter Island, NY</publisher-loc>: <publisher-name>Manning Publications</publisher-name>.</mixed-citation>
    </ref>
    <ref id="CIT0049">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhukova</surname><given-names>A.</given-names></string-name>, <string-name><surname>Blassel</surname><given-names>L.</given-names></string-name>, <string-name><surname>Lemoine</surname><given-names>F.</given-names></string-name>, <string-name><surname>Morel</surname><given-names>M.</given-names></string-name>, <string-name><surname>Voznica</surname><given-names>J.</given-names></string-name>, <string-name><surname>Gascuel</surname><given-names>O.</given-names></string-name></person-group><year>2020</year>. <article-title>Origin, evolution and global spread of SARS-CoV-2</article-title>. <source>C.R. Biol</source>. <volume>344</volume>(<issue>1</issue>):<fpage>57</fpage>–<lpage>75</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
