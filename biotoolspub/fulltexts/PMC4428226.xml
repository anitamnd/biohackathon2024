<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4428226</article-id>
    <article-id pub-id-type="pmid">25943746</article-id>
    <article-id pub-id-type="publisher-id">600</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-015-0600-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methodology Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Estimation of the methylation pattern distribution from deep sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Lin</surname>
          <given-names>Peijie</given-names>
        </name>
        <address>
          <email>paul.lin@unsw.edu.au</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Forêt</surname>
          <given-names>Sylvain</given-names>
        </name>
        <address>
          <email>Sylvain.Foret@anu.edu.au</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wilson</surname>
          <given-names>Susan R</given-names>
        </name>
        <address>
          <email>Sue.Wilson@anu.edu.au</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Burden</surname>
          <given-names>Conrad J</given-names>
        </name>
        <address>
          <email>Conrad.Burden@anu.edu.au</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2180 7477</institution-id><institution-id institution-id-type="GRID">grid.1001.0</institution-id><institution>Mathematical Sciences Institute, </institution><institution>Australian National University, </institution></institution-wrap>Canberra, ACT 2601 Australia </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2180 7477</institution-id><institution-id institution-id-type="GRID">grid.1001.0</institution-id><institution>Research School of Biology, </institution><institution>Australian National University, </institution></institution-wrap>Canberra, ACT 2601 Australia </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 4902 0432</institution-id><institution-id institution-id-type="GRID">grid.1005.4</institution-id><institution>School of Mathematics and Statistics, </institution><institution>University of New South Wales, </institution></institution-wrap>2052 NSW Sydney, Australia </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>5</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2015</year>
    </pub-date>
    <volume>16</volume>
    <elocation-id>145</elocation-id>
    <history>
      <date date-type="received">
        <day>9</day>
        <month>10</month>
        <year>2014</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>4</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Lin et al.; licensee BioMed Central. 2015</copyright-statement>
      <license license-type="open-access">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p>Bisulphite sequencing enables the detection of cytosine methylation. The sequence of the methylation states of cytosines on any given read forms a methylation pattern that carries substantially more information than merely studying the average methylation level at individual positions. In order to understand better the complexity of DNA methylation landscapes in biological samples, it is important to study the diversity of these methylation patterns. However, the accurate quantification of methylation patterns is subject to sequencing errors and spurious signals due to incomplete bisulphite conversion of cytosines.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>A statistical model is developed which accounts for the distribution of DNA methylation patterns at any given locus. The model incorporates the effects of sequencing errors and spurious reads, and enables estimation of the true underlying distribution of methylation patterns.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p>Calculation of the estimated distribution over methylation patterns is implemented in the R Bioconductor package MPFE. Source code and documentation of the package are also available for download at <ext-link ext-link-type="uri" xlink:href="http://bioconductor.org/packages/3.0/bioc/html/MPFE.html">http://bioconductor.org/packages/3.0/bioc/html/MPFE.html</ext-link>.</p>
      </sec>
      <sec>
        <title>Electronic supplementary material</title>
        <p>The online version of this article (doi:10.1186/s12859-015-0600-6) contains supplementary material, which is available to authorized users.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>DNA methylation</kwd>
      <kwd>Bisulfite sequencing</kwd>
      <kwd>DNA methylation patterns</kwd>
      <kwd>Epiallele</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2015</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p>Epigenetic regulations are involved in a broad range of biological processes, including development, tissue homeostasis, learning and memory, as well as various diseases such as obesity and cancer [<xref ref-type="bibr" rid="CR1">1</xref>-<xref ref-type="bibr" rid="CR3">3</xref>].</p>
    <p>DNA methylation is one of the best studied epigenetic molecular mechanisms. It consists of the addition of a methyl group to the cytosine residues (C) of a DNA molecule. In animals, DNA methylation usually takes place in the CpG context: cytosines followed by a guanine (G) residue.</p>
    <p>DNA methylation modulates gene expression through a variety of mechanisms. In vertebrates, methylation in the promoter region usually has a repressive effect on transcription initiation. By contrast, methylation of gene bodies is generally associated with an active transcriptional state and has been shown to play an important role in the control of alternative splicing [<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref>].</p>
    <p>The diverse and subtle effects of DNA methylation enable a given genome to produce different phenotypic outputs as part of a developmental program or in response to environmental factors. This has fundamental implications at the organismal level, where DNA methylation plays an important role in phenotypic plasticity [<xref ref-type="bibr" rid="CR6">6</xref>]. This is also important at the cellular level to create diverse cell types, tissues and organs all based on the same genome. DNA methylation patterns can thus change from one cell type to another or within a cell under different conditions [<xref ref-type="bibr" rid="CR7">7</xref>].</p>
    <p>The diversity of methylation patterns in a sample can be studied with a single base pair resolution using the bisulphite sequencing technique [<xref ref-type="bibr" rid="CR8">8</xref>]. When DNA is treated with bisulphite, the unmethylated cytosines are converted to uracils with a high (albeit not complete) efficiency, whereas the methylated cytosines remain as cytosines. A library is prepared from the bisulphite treated DNA by fragmenting to lengths of approximately 200 bp and PCR amplified. During this amplification process, uracils are replicated as thymines (T). The DNA library is then sequenced and the resulting reads are mapped to a reference. Within each read, CpG dinucleotides which have been converted to TpG are recognised as unmethylated, and unconverted CpG dinucleotides are recognised as methylated.</p>
    <p>A common type of analysis carried out with this type of data is to estimate, for each cytosine, the global methylation level of a sample, namely, the average methylation level across all DNA strands in all the cells represented in that sample. This is usually done by correcting for the fact that bisulphite conversion is not a complete reaction (for instance, see [<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR9">9</xref>]).</p>
    <p>However, this type of analysis only considers the methylation level at individual positions and is oblivious to the fact that cytosines present on a given read represent a broader snapshot of the methylation landscape on a particular strand of DNA. One can therefore gain a significantly deeper insight into the complexity of DNA methylation landscapes by reconstituting the methylation patterns that are physically present on the same sequence, and thus come from the same cell. Each read can be seen as containing a small number of binary labelled CpG sites: 1 for methylated, 0 for unmethylated and represents the methylation pattern of a given strand of DNA in one particular cell. This approach is of particular interest when studying complex biological samples that contain a mixture of cell types, for instance a tumour or a whole insect brain. It gives a much more detailed picture about the diversity of DNA methylation in a sample than simply looking at the methylation level at each position.</p>
    <p>The study of the diversity and dynamics of DNA methylation patterns has recently generated a great deal of interest as it allows assessment of the methylation status in subsets of cells within a sample. Such studies have provided novel insights into the role of DNA methylation in cell differentiation and reprogramming, and the evolution of tumours (for instance [<xref ref-type="bibr" rid="CR10">10</xref>-<xref ref-type="bibr" rid="CR12">12</xref>]). It has also been proposed that the DNA methylation patterns present in heterogeneous samples could be effective tumour-specific biomarkers [<xref ref-type="bibr" rid="CR13">13</xref>].</p>
    <p>The approach of looking at methylation patterns instead of individual CpG sites can be hampered by the lack of sequencing coverage depth. For reasons of cost, most whole genome bisulphite sequencing studies have a mean genomic coverage in the 10-100 range. If the underlying sample contains hundreds of methylation patterns, they cannot be sampled representatively. Consequently, studies looking at DNA methylation diversity have focussed on short patterns (around 4 CpGs) [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
    <p>As an alternative, in order to reach a high coverage, researchers have often focussed on specific loci, either by sequencing PCR amplicons of bisulphite converted DNA, or by reduced representation bisulphite sequencing, or by using a capture assay (for review see [<xref ref-type="bibr" rid="CR14">14</xref>]). In this paper, we focus on the analysis of amplicon data, but the statistical framework introduced here could be applied to data extracted from other types of sequencing approaches such as reduced representation and capture-based sequencing.</p>
    <p>The problem of determining methylation patterns in the original sample from the observed data is non trivial. The purpose of this paper is to infer formally the probability distribution over all possible methylation profiles defined by the population of methylomes at a given locus. We show that taking into account the effect of the non-systematic errors of incomplete bisulphite conversion, as well as sequencing error, is critical as this removes a large number of spurious patterns present in the raw reads.</p>
  </sec>
  <sec id="Sec2">
    <title>Results and discussion</title>
    <sec id="Sec3">
      <title>Synthetic data</title>
      <p>The probability distribution over methylation patterns at a given locus from from bisulphite sequencing data is estimated via an algorithm described below in the Methods section. The algorithm is implemented as an R Bioconductor [<xref ref-type="bibr" rid="CR15">15</xref>] package MPFE (for <bold>M</bold>ethylation <bold>P</bold>atterns <bold>F</bold>requency <bold>E</bold>stimation).</p>
      <p>As the true distribution over methylation patterns is always unknown in the laboratory, we have constructed a number of synthetic data sets to test the effectiveness of the algorithm. For a locus with <italic>n</italic> CpG sites we prescribe a true distribution <italic>θ</italic>
<sub><italic>k</italic></sub>, <italic>k</italic>=1,…,2<sup><italic>n</italic></sup>, over the 2<sup><italic>n</italic></sup> possible methylation patterns. We simulate from these patterns a set of <italic>N</italic>
<sub>read</sub> initial reads, each labelled with its ‘true’ methylation pattern, and then redistribute the reads among patterns according to the statistical model described in the Methods section to simulate errors due to incomplete bisulphite conversion and sequencing errors.</p>
      <p>The rates of conversion and sequencing error can be estimated by spiking-in non-methylated DNA of known sequence, or by looking at positions known in advance not to be methylated [<xref ref-type="bibr" rid="CR16">16</xref>].</p>
      <p>Incomplete conversion is specified by a non-conversion rate parameter <italic>ε</italic> equal to the probability that an unmethylated cytosine will fail to convert. Its value is typically of order 10<sup>−2</sup>, and will be assumed in our simulations to be estimated independently from the rate of conversion of non-CpG cytosines. For instance, it could be calculated based on sequences known a priori not to be methylated. The sequencing error rates are specified by a vector <italic>η</italic>=(<italic>η</italic>
<sub>1</sub>,…,<italic>η</italic>
<sub><italic>n</italic></sub>), where <italic>η</italic>
<sub><italic>s</italic></sub>∼<italic>O</italic>(10<sup>−2</sup>) is the probability that site <italic>s</italic> is methylated but registers as unmethylated and vice versa. These two sources of error can generate spurious methylation patterns, that is, patterns for which the observed read count <italic>y</italic>
<sub><italic>k</italic></sub> is non-zero when the true frequency of the pattern, <italic>θ</italic>
<sub><italic>k</italic></sub>, is zero. The aim is to assess the ability of the algorithm to recover the true distribution <italic>θ</italic>
<sub><italic>k</italic></sub> from a set of observed read counts <italic>y</italic>
<sub><italic>k</italic></sub>, and, more specifically, determine whether spurious patterns can be identified.</p>
      <p>The algorithm can be run in two possible modes: a slow (exact) mode, which performs a complete calculation over all possible 2<sup><italic>n</italic></sup> methylation patterns, and an (approximate, default) fast mode which assumes <italic>θ</italic>
<sub><italic>k</italic></sub>=0 for any pattern for which the observed read count <italic>y</italic>
<sub><italic>k</italic></sub> is zero. Because of the exponential growth in the number of patterns, we find in general that use of the function in the slow mode becomes computationally prohibitive for <italic>n</italic>&gt;8. However, there is very little difference in the computed results between the two modes (see below). Furthermore, the number of realised patterns tends to be relatively small and the performance of the function is adequate even for large <italic>n</italic>.</p>
      <p>To illustrate the concept of the algorithms, we begin with a small synthetic dataset corresponding to a locus with <italic>n</italic>=6 CpG sites, and a distribution of pattern abundances <italic>θ</italic>
<sub><italic>i</italic></sub> contrived to mimic a combination of high and low abundance patterns as observed in a real dataset. Table <xref rid="Tab1" ref-type="table">1</xref> and Figure <xref rid="Fig1" ref-type="fig">1</xref> show the results of creating the dataset assuming a non-conversion rate <italic>ε</italic>=0.005, sequencing errors <italic>η</italic>=(0.008,0.006,0.006,0.006,0.006,0.008) to model a signal that degrades towards the ends of the reads, and a total number of reads <italic>N</italic>
<sub>read</sub>=2000 to generate read counts <italic>y</italic>
<sub><italic>i</italic></sub>. These data are then analysed using the same <italic>ε</italic> and <italic>η</italic> values in both the slow and fast modes to generate estimated pattern abundances <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq1.gif"/></alternatives></inline-formula>.
<fig id="Fig1"><label>Figure 1</label><caption><p>The ‘true’ distribution <italic>θ</italic>
<sub><italic>k</italic></sub> (black dots), observed read counts <italic>y</italic>
<sub><italic>k</italic></sub> (blue pluses) and estimated distribution <inline-formula id="IEq3"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k $$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq3.gif"/></alternatives></inline-formula> from the slow (purple squares) and fast (red crosses) implementations of our algorithm over methylation patterns for synthetic data with <italic>n</italic>=6 CpG sites. The non-conversion rate is set to be <italic>ε</italic>=0.005, the sequencing errors are set to be <italic>η</italic>=(0.008,0.006,0.006,0.006,0.006,0.008), the total number of reads is <italic>N</italic>
<sub>read</sub>=2000. Only patterns with non-zero reads are shown and methylation patterns are ordered lexicographically. Data for the three patterns (000000, 111101 and 111111) which are beyond the range of the plot can be found in Table <xref rid="Tab1" ref-type="table">1</xref>.</p></caption><graphic xlink:href="12859_2015_600_Fig1_HTML" id="MO1"/></fig>
<table-wrap id="Tab1"><label>Table 1</label><caption><p><bold>Comparison between estimates</bold><inline-formula id="IEq4"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M6"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq4.gif"/></alternatives></inline-formula><bold> of the true methylation distribution</bold><bold><italic>θ</italic></bold><sub><bold><italic>i</italic></bold></sub><bold> calculated with the slow and fast implementations of our algorithm for the dataset of Figure </bold><xref rid="Fig1" ref-type="fig">1</xref></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><bold>Patterns</bold></th><th align="left"><bold><italic>θ</italic></bold><sub><bold><italic>i</italic></bold></sub></th><th align="left"><bold><italic>y</italic></bold><sub><bold><italic>i</italic></bold></sub></th><th align="left"><bold><italic>y</italic></bold><sub><bold><italic>i</italic></bold></sub><bold>/</bold><bold><italic>N</italic></bold><sub><bold>read</bold></sub></th><th align="left"><inline-formula id="IEq5"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M8"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq5.gif"/></alternatives></inline-formula><bold> (slow)</bold></th><th align="left"><inline-formula id="IEq6"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq6.gif"/></alternatives></inline-formula><bold> (fast)</bold></th></tr></thead><tbody><tr><td align="left">000000</td><td align="right">0.50</td><td align="right">907</td><td align="center">0.4535</td><td align="left">0.4813</td><td align="left">0.4812</td></tr><tr><td align="left">000001</td><td align="right">0.00</td><td align="right">15</td><td align="center">0.0075</td><td align="left">0.0013</td><td align="left">0.0013</td></tr><tr><td align="left">000010</td><td align="right">0.00</td><td align="right">8</td><td align="center">0.0040</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">000100</td><td align="right">0.00</td><td align="right">7</td><td align="center">0.0035</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">001000</td><td align="right">0.04</td><td align="right">99</td><td align="center">0.0495</td><td align="left">0.0466</td><td align="left">0.0466</td></tr><tr><td align="left">001001</td><td align="right">0.00</td><td align="right">4</td><td align="center">0.0020</td><td align="left">0.0016</td><td align="left">0.0014</td></tr><tr><td align="left">001010</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">001100</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">010000</td><td align="right">0.00</td><td align="right">6</td><td align="center">0.0030</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">011000</td><td align="right">0.00</td><td align="right">2</td><td align="center">0.0010</td><td align="left">0.0007</td><td align="left">0.0004</td></tr><tr><td align="left">011011</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0.0005</td><td align="left">0.0002</td></tr><tr><td align="left">011101</td><td align="right">0.00</td><td align="right">2</td><td align="center">0.0010</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">011111</td><td align="right">0.03</td><td align="right">63</td><td align="center">0.0315</td><td align="left">0.0308</td><td align="left">0.0306</td></tr><tr><td align="left">100000</td><td align="right">0.03</td><td align="right">77</td><td align="center">0.0385</td><td align="left">0.0328</td><td align="left">0.0329</td></tr><tr><td align="left">101101</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">101111</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">110000</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0.0000</td></tr><tr><td align="left">110111</td><td align="right">0.00</td><td align="right">2</td><td align="center">0.0010</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">111001</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">111011</td><td align="right">0.00</td><td align="right">1</td><td align="center">0.0005</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">111100</td><td align="right">0.00</td><td align="right">3</td><td align="center">0.0015</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">111101</td><td align="right">0.20</td><td align="right">393</td><td align="center">0.1965</td><td align="left">0.2001</td><td align="left">0.2013</td></tr><tr><td align="left">111110</td><td align="right">0.00</td><td align="right">3</td><td align="center">0.0015</td><td align="left">0</td><td align="left">0</td></tr><tr><td align="left">111111</td><td align="right">0.20</td><td align="right">401</td><td align="center">0.2005</td><td align="left">0.2044</td><td align="left">0.2040</td></tr></tbody></table><table-wrap-foot><p><italic>y</italic><sub><italic>i</italic></sub> is the number of observed reads for pattern <italic>i</italic> and <italic>N</italic>
<sub>read</sub> is the total number of reads.</p></table-wrap-foot></table-wrap>
</p>
      <p>For this synthetic dataset we find that for any pattern for which the ‘observed’ read count <italic>y</italic>
<sub><italic>i</italic></sub> is zero, the ‘true’ abundance <italic>θ</italic>
<sub><italic>i</italic></sub> and the estimated abundance <inline-formula id="IEq7"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq7.gif"/></alternatives></inline-formula> from the slow-mode version of the algorithm are also zero. For this reason, results are only shown for patterns for which the read count <italic>y</italic>
<sub><italic>k</italic></sub> is non-zero. For completeness, the plot produced for all 64 patterns by running our package in the slow mode is given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
      <p>We observe that for almost all patterns the estimated distribution <inline-formula id="IEq8"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k $$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq8.gif"/></alternatives></inline-formula> is closer to the true distribution <italic>θ</italic>
<sub><italic>k</italic></sub> than the naive read proportion <italic>y</italic>
<sub><italic>k</italic></sub>/<italic>N</italic>
<sub>read</sub>, the only exception being a slight shift in the wrong direction for the pattern <italic>m</italic>
<sub>64</sub>(111111).</p>
      <p>We observe also that the algorithm has the effect of skewing the distribution of reads away from low-frequency, more highly methylated patterns towards the totally unmethylated pattern, thus reducing the false discovery rate. This algorithmic effect will generally be the case for any realistic dataset (see Additional file <xref rid="MOESM2" ref-type="media">2</xref>). Furthermore, our implementation of the algorithm registers whether, for any given pattern <italic>k</italic>, the estimate <inline-formula id="IEq9"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k $$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq9.gif"/></alternatives></inline-formula> is identically zero, that is, it makes a call as to whether the pattern is present or absent. In this example, no real pattern is classified as spurious. The algorithm correctly identifies 14 out of the 18 spurious patterns in the slow mode, and 13 out of the 18 in the fast mode. For the one extra pattern which was missed by the fast mode, namely pattern 110000, the estimated proportion <inline-formula id="IEq10"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i\left(\mathrm{fast}\right)&lt;1{0}^{-4} $$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mtext>(fast)</mml:mtext><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn><mml:msup><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2015_600_IEq10.gif"/></alternatives></inline-formula> is very low.</p>
      <p>In general, when the number of CpG sites <italic>n</italic> in an amplicon is large, it is expected that only a small faction of the 2<sup><italic>n</italic></sup> possible patterns will be present. Furthermore, it is rare for a true pattern with <italic>θ</italic>
<sub><italic>k</italic></sub>&gt;0 to have zero counts as a result of incomplete bisulphite conversion or sequencing errors. For instance, in the the current example none of the patterns with a positive true frequency <italic>θ</italic>
<sub><italic>k</italic></sub> had zero reads, and for the remaining patterns there is no substantial difference between the two implementations of the algorithm. From now on, the discussion focusses on the fast implementation.</p>
      <p>Figure <xref rid="Fig2" ref-type="fig">2</xref> and Additional file <xref rid="MOESM3" ref-type="media">3</xref> show the results of applying the fast implementation of the algorithm to synthetic data modelled on biological data from a PCR amplicon in the honey bee <italic>Apis mellifera</italic> genome (see <xref rid="Sec5" ref-type="sec">Biological data</xref> section). To obtain the dataset, the function was applied once to a biological dataset of <italic>N</italic>
<sub>read</sub>=730 reads from an amplicon corresponding to a locus with <italic>n</italic>=9 CpG sites. To maintain a similar number of non-zero reads the ‘true’ distribution of the synthetic dataset was taken to be
<disp-formula id="Equa"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\theta}_i=\left\{\begin{array}{ll}0&amp; \kern1em \mathrm{if}\kern6em {\widehat{\theta}}_i^{\mathrm{init}}&lt;0.005,\\ {}{\widehat{\theta}}_i^{\mathrm{init}}\kern5em &amp; \mathrm{otherwise},\end{array}\right. $$\end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mspace width="1em"/><mml:mtext>if</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mtext>init</mml:mtext></mml:mrow></mml:msubsup><mml:mo>&lt;</mml:mo><mml:mn>0.005</mml:mn><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mtext>init</mml:mtext></mml:mrow></mml:msubsup><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/></mml:mtd><mml:mtd><mml:mtext>otherwise</mml:mtext><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="12859_2015_600_Equa.gif" position="anchor"/></alternatives></disp-formula> where <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i^{\mathrm{init}} $$\end{document}</tex-math><mml:math id="M22"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mtext>init</mml:mtext></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2015_600_IEq11.gif"/></alternatives></inline-formula> is the result of the initial application of the algorithm. Here the non-conversion parameter is <italic>ε</italic>=0.01, and the sequencing error rate <italic>η</italic>=0.02 is taken to be uniform across all CpG sites.
<fig id="Fig2"><label>Figure 2</label><caption><p>Comparison between the true distribution <italic>θ</italic>
<sub><italic>i</italic></sub>, the simulated read distribution <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>N</italic>
<sub>read</sub>, and the estimated distribution <inline-formula id="IEq13"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq13.gif"/></alternatives></inline-formula> for a synthetic dataset based on amplicon data. Parameter values are <italic>n</italic>=9 CpG sites, total number of reads <italic>N</italic>
<sub>read</sub>=730, non-conversion parameter <italic>ε</italic>=0.01, and sequencing error rate <italic>η</italic>=0.02. The lower plot is an expanded version of the upper plot showing only patterns with low frequencies.</p></caption><graphic xlink:href="12859_2015_600_Fig2_HTML" id="MO2"/></fig>
</p>
      <p>Of the 46 spurious patterns in this dataset, 16 are correctly identified and no false identifications of spurious patterns are made. For the 30 failed identifications, the program estimates a lower estimate <inline-formula id="IEq14"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq14.gif"/></alternatives></inline-formula> than the read proportion <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>N</italic>
<sub>read</sub>.</p>
      <p>Given that the MPFE algorithm requires as input an estimate of the non-conversion rate <italic>ε</italic> and read error rate <italic>η</italic>, it is important to gauge the sensitivity of pattern frequency estimates to these parameters. Figure <xref rid="Fig3" ref-type="fig">3</xref> shows the variation in estimated pattern abundances for the dataset of Figure <xref rid="Fig1" ref-type="fig">1</xref> as the values of <italic>ε</italic> and <italic>η</italic> used by MPFE are perturbed from the ‘true’ values used to construct the synthetic data. We observe that the estimated abundances are relatively insensitive to <italic>ε</italic> for the actually occurring patterns, but drop rapidly with increasing <italic>ε</italic> for most of the spurious patterns. It is perhaps not surprising that <inline-formula id="IEq15"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq15.gif"/></alternatives></inline-formula> will be sensitive to the <italic>ε</italic> for those spurious patterns for which <inline-formula id="IEq16"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i&gt;0 $$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="12859_2015_600_IEq16.gif"/></alternatives></inline-formula>: As explained in Additional file <xref rid="MOESM2" ref-type="media">2</xref>, increasing <italic>ε</italic> has the effect of skewing the distribution towards the less methylated patterns, which in general tend to be the more abundantly ocurring patterns. A relevant point here is that the correction for non-conversion almost invariably moves the estimates <inline-formula id="IEq17"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq17.gif"/></alternatives></inline-formula> in the correct direction from the raw data for the spurious patterns, while leaving even the low-frequency non-spurious patterns almost unchnaged. Also, not surprisingly, the estimates <inline-formula id="IEq18"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M34"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq18.gif"/></alternatives></inline-formula> are sensitive to the read error rate <italic>η</italic> for both spurious and non-spurious patterns.
<fig id="Fig3"><label>Figure 3</label><caption><p>Estimates <inline-formula id="IEq20"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq20.gif"/></alternatives></inline-formula> of methylation pattern abundances calculated using MPFE from the synthetic dataset of Figure <xref rid="Fig2" ref-type="fig">2</xref> assuming, in panels <bold>(A)</bold> and <bold>(C)</bold>, a range of non-conversion rates <italic>ε</italic> and the correct sequencing error rate <italic>η</italic>=0.02, and, in panels <bold>(B)</bold> and <bold>(D)</bold> the correct non-conversion rate <italic>ε</italic>=0.01 and a range of sequencing error rates <italic>η</italic>. Pattern numbers in the legends correspond to the horizontal axis of Figure <xref rid="Fig2" ref-type="fig">2</xref>. In panels (A) and (B) the 10 ‘true’ patterns are highlighted on colour. Panels (C) and (D) show an expanded view of the lower part of the plot with examples of patterns occuring at low frequencies (both spurious and non-spurious) highlighted in colour: 2 real patterns (24 and 31), 3 spurious patterns which are reported as real in Figure <xref rid="Fig2" ref-type="fig">2</xref> (namely 2, 45 and 53), and 2 spurious patterns which are correctly identified in Figure <xref rid="Fig2" ref-type="fig">2</xref> (namely 9 and 42).</p></caption><graphic xlink:href="12859_2015_600_Fig3_HTML" id="MO3"/></fig>
</p>
    </sec>
    <sec id="Sec4">
      <title>Detecting spurious patterns</title>
      <p>The effectiveness of our algorithm in identifying spurious patterns can be further gauged by introducing a threshold on the estimated pattern abundance. In the following definitions we only consider methylation patterns with non-zero reads <italic>y</italic>
<sub><italic>i</italic></sub>.</p>
      <p>We set a threshold <italic>K</italic>∈[0,1] as a binary classifier and, using the estimated distribution <inline-formula id="IEq21"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq21.gif"/></alternatives></inline-formula> as a test statistic, declare pattern <italic>i</italic> to be spurious when <inline-formula id="IEq22"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i\le K $$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>K</mml:mi></mml:math><inline-graphic xlink:href="12859_2015_600_IEq22.gif"/></alternatives></inline-formula>. Patterns are defined to be true or false positives or negatives according to the rules
<disp-formula id="Equb"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{c}\mathrm{T}\mathrm{P}\ \mathrm{if}\kern2em {\widehat{\theta}}_i\le K\kern2em \mathrm{and}\kern2em {\theta}_i=0,\kern2em \mathrm{F}\mathrm{P}\ \mathrm{if}\kern2em {\widehat{\theta}}_i\le K\kern2em \mathrm{and}\kern2em {\theta}_i&gt;0,\\ {}\mathrm{T}\mathrm{N}\ \mathrm{if}\kern2em {\widehat{\theta}}_i&gt;K\kern2em \mathrm{and}\kern2em {\theta}_i&gt;0,\kern2em \mathrm{F}\mathrm{N}\ \mathrm{if}\kern2em {\widehat{\theta}}_i&gt;K\kern2em \mathrm{and}\kern2em {\theta}_i=0.\end{array} $$\end{document}</tex-math><mml:math id="M42"><mml:mrow><mml:mspace width="-15.0pt"/><mml:mtable><mml:mtr><mml:mtd><mml:mtext>TP if</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>K</mml:mi><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mtext>and</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mtext>FP if</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>K</mml:mi><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mtext>and</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>TN if</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>K</mml:mi><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mtext>and</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mtext>FN if</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>K</mml:mi><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mtext>and</mml:mtext><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mi>.</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2015_600_Equb.gif" position="anchor"/></alternatives></disp-formula> True positive rates (TPR) and false positive rates (FPR) are defined in the usual way as
<disp-formula id="Equc"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{T}\mathrm{P}\mathrm{R}=\frac{\mathrm{TP}}{\mathrm{TP}+\mathrm{F}\mathrm{N}},\kern2em \mathrm{F}\mathrm{P}\mathrm{R}=\frac{\mathrm{FP}}{\mathrm{FP}+\mathrm{T}\mathrm{N}}. $$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:mtext>TPR</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>TP</mml:mtext></mml:mrow><mml:mrow><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FN</mml:mtext></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mtext>FPR</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>FP</mml:mtext></mml:mrow><mml:mrow><mml:mtext>FP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>TN</mml:mtext></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:mrow></mml:math><graphic xlink:href="12859_2015_600_Equc.gif" position="anchor"/></alternatives></disp-formula> An analogous set of definitions applies using the raw data count proportions <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>N</italic>
<sub>read</sub> as a test statistic. Note that this classification does not constitute classical hypothesis testing per se, as the threshold does not easily translate to a p-value under a well-defined null hypothesis: patterns are not independent, and specifiying <italic>θ</italic>
<sub><italic>i</italic></sub>=0 for a given pattern does not determine the distribution of the estimator <inline-formula id="IEq23"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq23.gif"/></alternatives></inline-formula> without further assumptions about the remaining 2<sup><italic>n</italic></sup>−1 patterns.</p>
      <p>Figure <xref rid="Fig4" ref-type="fig">4</xref>A shows the TPR curves for the data of Figure <xref rid="Fig1" ref-type="fig">1</xref>. It shows that using <inline-formula id="IEq24"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M48"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq24.gif"/></alternatives></inline-formula> results in a clear improvement in detecting which methylation patterns are likely to be a spurious artefact of incomplete conversion and reading error. The FPR curves for both test statistics are constantly zero for the same threshold range in the TPR graph.
<fig id="Fig4"><label>Figure 4</label><caption><p>The TPR versus the threshold <italic>K</italic> using the test statistic <inline-formula id="IEq26"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M50"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq26.gif"/></alternatives></inline-formula> (red curve) and <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>N</italic>
<sub>read</sub> (blue curve) for the synthetic data of <bold>(A)</bold> Figure <xref rid="Fig1" ref-type="fig">1</xref> and <bold>(B)</bold> Figure <xref rid="Fig2" ref-type="fig">2</xref>.</p></caption><graphic xlink:href="12859_2015_600_Fig4_HTML" id="MO4"/></fig>
</p>
      <p>Figure <xref rid="Fig4" ref-type="fig">4</xref>B shows the TPR curves for the synthetic data based on biological data from an amplicon analysed in Figure <xref rid="Fig2" ref-type="fig">2</xref>. Again we observe a clear improvement in detecting which methylation patterns are likely to be a spurious artefact of incomplete methylation and reading error.</p>
    </sec>
    <sec id="Sec5">
      <title>Biological data</title>
      <p>Amplicons were obtained as described in [<xref ref-type="bibr" rid="CR4">4</xref>]. Briefly, genomic DNA was extracted from brains of adult honeybee workers and treated with sodium bisulphite. A region of gene GB17113 (gene ID: 724724, a 6-phosphofructokinase) was then amplified by PCR and sequenced using the 454 technology. No ethical approval was required for this work.</p>
      <p>Below we apply the fast algorithm to two examples from this dataset assuming a non-conversion rate of <italic>ε</italic>=0.01 and a global sequencing error rate of <italic>η</italic>=0.02. The first example is shown in Figure <xref rid="Fig5" ref-type="fig">5</xref> and Table <xref rid="Tab2" ref-type="table">2</xref>. The parameter values are <italic>n</italic>=8 CpG sites, 36 patterns with non-zero reads, and a total number of reads <italic>N</italic>
<sub>read</sub>=1793.
<fig id="Fig5"><label>Figure 5</label><caption><p>Estimated distribution <inline-formula id="IEq28"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M52"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq28.gif"/></alternatives></inline-formula> of the methylation patterns obtained for a honey bee amplicon. Parameter values are <italic>n</italic>=8 CpG sites, total number of reads <italic>N</italic>
<sub>read</sub>=1793, non-conversion rate <italic>ε</italic>=0.01, and sequencing error rate <italic>η</italic>=0.02. The lower plot is an expanded version of the upper plot showing only patterns with low frequencies. The 36 patterns with non-zero reads are listed in Table <xref rid="Tab2" ref-type="table">2</xref>.</p></caption><graphic xlink:href="12859_2015_600_Fig5_HTML" id="MO5"/></fig>
<table-wrap id="Tab2"><label>Table 2</label><caption><p><bold>Estimated methylation distribution</bold><inline-formula id="IEq29"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M54"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq29.gif"/></alternatives></inline-formula><bold> for the data of Figure </bold><xref rid="Fig5" ref-type="fig">5</xref></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"><bold><italic>i</italic></bold></th><th align="left"><bold><italic>m</italic></bold><sub><bold><italic>i</italic></bold></sub></th><th align="left"><bold><italic>y</italic></bold><sub><bold><italic>i</italic></bold></sub></th><th align="left"><bold><italic>y</italic></bold><sub><bold><italic>i</italic></bold></sub><bold>/</bold><bold><italic>N</italic></bold><sub><bold>read</bold></sub></th><th align="left"><inline-formula id="IEq30"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M56"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq30.gif"/></alternatives></inline-formula></th></tr></thead><tbody><tr><td align="right">1</td><td align="center">00000000</td><td align="right">1265</td><td align="center">0.7055</td><td align="left">0.8706</td></tr><tr><td align="right">2</td><td align="center">00000001</td><td align="right">52</td><td align="center">0.0290</td><td align="left">0.0059</td></tr><tr><td align="right">3</td><td align="center">00000010</td><td align="right">32</td><td align="center">0.0178</td><td align="left">0</td></tr><tr><td align="right">4</td><td align="center">00000100</td><td align="right">40</td><td align="center">0.0223</td><td align="left">0</td></tr><tr><td align="right">5</td><td align="center">00000110</td><td align="right">3</td><td align="center">0.0017</td><td align="left">0.0010</td></tr><tr><td align="right">6</td><td align="center">00001000</td><td align="right">75</td><td align="center">0.0418</td><td align="left">0.0189</td></tr><tr><td align="right">7</td><td align="center">00001001</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">8</td><td align="center">00001010</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0</td></tr><tr><td align="right">9</td><td align="center">00010000</td><td align="right">36</td><td align="center">0.0201</td><td align="left">0</td></tr><tr><td align="right">10</td><td align="center">00010100</td><td align="right">10</td><td align="center">0.0056</td><td align="left">0.0053</td></tr><tr><td align="right">11</td><td align="center">00100000</td><td align="right">31</td><td align="center">0.0173</td><td align="left">0</td></tr><tr><td align="right">12</td><td align="center">00100001</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0.0003</td></tr><tr><td align="right">13</td><td align="center">00101000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">14</td><td align="center">00110000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">15</td><td align="center">01000000</td><td align="right">20</td><td align="center">0.0112</td><td align="left">0</td></tr><tr><td align="right">16</td><td align="center">01000001</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">17</td><td align="center">01100000</td><td align="right">39</td><td align="center">0.0218</td><td align="left">0.0240</td></tr><tr><td align="right">18</td><td align="center">01100001</td><td align="right">4</td><td align="center">0.0022</td><td align="left">0.0016</td></tr><tr><td align="right">19</td><td align="center">01101000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">20</td><td align="center">01110000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">21</td><td align="center">01110100</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">22</td><td align="center">10000000</td><td align="right">84</td><td align="center">0.0468</td><td align="left">0.0282</td></tr><tr><td align="right">23</td><td align="center">10000001</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0</td></tr><tr><td align="right">24</td><td align="center">10000010</td><td align="right">5</td><td align="center">0.0028</td><td align="left">0.0013</td></tr><tr><td align="right">25</td><td align="center">10000100</td><td align="right">14</td><td align="center">0.0078</td><td align="left">0.0070</td></tr><tr><td align="right">26</td><td align="center">10001000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">27</td><td align="center">10010000</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0</td></tr><tr><td align="right">28</td><td align="center">10010100</td><td align="right">8</td><td align="center">0.0045</td><td align="left">0.0044</td></tr><tr><td align="right">29</td><td align="center">10100000</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0</td></tr><tr><td align="right">30</td><td align="center">11000100</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0.0003</td></tr><tr><td align="right">31</td><td align="center">11010000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0.0005</td></tr><tr><td align="right">32</td><td align="center">11100000</td><td align="right">1</td><td align="center">0.0006</td><td align="left">0</td></tr><tr><td align="right">33</td><td align="center">11100100</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0.0006</td></tr><tr><td align="right">34</td><td align="center">11110000</td><td align="right">2</td><td align="center">0.0011</td><td align="left">0.0007</td></tr><tr><td align="right">35</td><td align="center">11110100</td><td align="right">42</td><td align="center">0.0234</td><td align="left">0.0255</td></tr><tr><td align="right">36</td><td align="center">11110110</td><td align="right">8</td><td align="center">0.0045</td><td align="left">0.0039</td></tr></tbody></table><table-wrap-foot><p>The 36 patterns with non-zero reads are labelled <italic>m</italic>
<sub><italic>i</italic></sub>, <italic>i</italic>=1,…,36 and <italic>y</italic>
<sub><italic>i</italic></sub> are the observed read counts.</p></table-wrap-foot></table-wrap>
</p>
      <p>There are several observations:
<list list-type="simple"><list-item><label>(i)</label><p>18 patterns (50%) are identified as spurious;</p></list-item><list-item><label>(ii)</label><p>there are 11 patterns with only 1 read - our algorithm calls 9 of them as spurious, while predicts the other 2 patterns (<italic>m</italic>
<sub>30</sub> and <italic>m</italic>
<sub>31</sub>) to exist;</p></list-item><list-item><label>(iii)</label><p>patterns <italic>m</italic>
<sub>3</sub>, <italic>m</italic>
<sub>4</sub>, <italic>m</italic>
<sub>9</sub> and <italic>m</italic>
<sub>11</sub> with &gt;30 reads each has a read proportion <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>N</italic>
<sub>read</sub>≈2<italic>%</italic>, but are called as spurious.</p></list-item></list>
</p>
      <p>Observations (i) and (ii) can be explained by the fact that the edit distance between the two patterns covered by a single read and any pattern observed to be highly abundant renders it unlikely that these patterns have arisen through sequencing errors or incomplete conversion. Observation (iii) arises because the spurious patterns with &gt;30 reads are just one sequencing error or one incomplete conversion away from the most abundant pattern, <italic>m</italic>
<sub>0</sub>(00000000).</p>
      <p>Figure <xref rid="Fig6" ref-type="fig">6</xref> and Additional file <xref rid="MOESM4" ref-type="media">4</xref> show the second example, with <italic>n</italic>=14 CpG sites and 160 patterns with non-zero reads. The total number of reads is <italic>N</italic>
<sub>read</sub>=2347. In this case 47 patterns are called as spurious. Note that these data indicate that the methylation statuses of neighouring CpG loci are correlated. This correlation was also observed by Lyco et al. [<xref ref-type="bibr" rid="CR4">4</xref>] and has motivated our approach that has the advantage of being able to accommodate neighbouring spatial correlations between CpG positions without imposing any a priori structure.
<fig id="Fig6"><label>Figure 6</label><caption><p>Estimated distribution <inline-formula id="IEq32"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq32.gif"/></alternatives></inline-formula> of the methylation patterns for a second amplicon from the honey bee genome. Parameter values are <italic>n</italic>=14 CpG sites, total number of reads <italic>N</italic>
<sub>read</sub>=2347, non-conversion rate <italic>ε</italic>=0.01, and sequencing error rate <italic>η</italic>=0.02. The lower plot is an expanded version of the upper plot showing only patterns with low frequencies.</p></caption><graphic xlink:href="12859_2015_600_Fig6_HTML" id="MO6"/></fig>
</p>
    </sec>
  </sec>
  <sec id="Sec6" sec-type="conclusion">
    <title>Conclusions</title>
    <p>We have developed an algorithm for estimating the true distribution of methylation patterns in at a genomic locus containing <italic>n</italic> CpG sites. The algorithm, based on a constrained multinomial model, accounts for statistical variation due to incomplete bisulphite conversion and sequencing errors. This method can be readily applied to methylation patterns extracted from amplicon sequencing data analysed with with software such as BiQ-Analyser [<xref ref-type="bibr" rid="CR17">17</xref>]. Further work would be required to extract methylation patterns counts from whole-genome sequencing data.</p>
    <p>The analysis differs from previous treatments in that the estimated distribution is a joint probability distribution over patterns which preserves maximal information pertaining to interaction between different CpG sites, as opposed to a pointwise measure of methylation at each site. A pointwise methylation estimate can, of course, be recovered from our estimated distribution as a marginal distribution. The algorithm is implemented as the R Bioconductor package MPFE.</p>
    <p>Numerical experiments with realistic synthetic data indicate that the algorithm is able to identify the majority of the spurious observed methylation patterns, that is, patterns which are not present in the original library but are observed in the reads because of incomplete bisulphite conversion or sequencing errors. In general, our estimates are closer to the true distribution than the naive estimates given by the relative proportion of observed read counts for almost all patterns in each simulation (see Figures <xref rid="Fig1" ref-type="fig">1</xref>, <xref rid="Fig2" ref-type="fig">2</xref>, and Table <xref rid="Tab1" ref-type="table">1</xref>).</p>
    <p>Application of the algorithm to biological data consisting of bisulphite treated amplicon reads for a honeybee genomic sequence predicts that a correspondingly high proportion of observed methylation patterns in real data may indeed be spurious. However, our results also reveal an important number of real methylation patterns in this biological sample. This complexity of the methylation landscape is virtually undetectable when one only considers position-wise methylation level, but becomes apparent through our method.</p>
    <p>In the future, the statistical method presented here could be extended and refined to deal with systematic sources of errors (for instance non-homogeneous bisulfite conversion rates, differential amplification of different epialleles) and to extract information from incomplete data (reads where one or more positions of the pattern are missing, which are currently ignored).</p>
  </sec>
  <sec id="Sec7">
    <title>Methods</title>
    <sec id="Sec8">
      <title>Statistical model of bisulphite sequencing</title>
      <p>We take as the starting point of our statistical model a population of methylomes restricted to a locus containing <italic>n</italic> CpG sites. Each member of the population within a given class is represented by a vector of non-independent binary valued random variables <bold>K</bold>=(<italic>K</italic>
<sub>1</sub>,…,<italic>K</italic>
<sub><italic>n</italic></sub>), where each <italic>K</italic>
<sub><italic>s</italic></sub>∈{0,1} labels the methylation state (0 for unmethylated, 1 for methylated) at the <italic>s</italic>-th CpG site at this locus. The population defines a methylation profile represented by the probability distribution of realising the pattern <bold>k</bold>=(<italic>k</italic>
<sub>1</sub>,…,<italic>k</italic>
<sub><italic>n</italic></sub>) in a read randomly chosen from the population:
<disp-formula id="Equ1"><label>(1)</label><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\theta}_{\mathbf{k}}= Prob\kern0.3em \left(K=k\right),\kern1em k\in {\left\{0,1\right\}}^n. $$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext mathvariant="italic">Prob</mml:mtext><mml:mspace width="0.3em"/><mml:mo>(</mml:mo><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup><mml:mi>.</mml:mi></mml:math><graphic xlink:href="12859_2015_600_Equ1.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>For convenience, from here on we will label the possible methylation patterns by the integers <italic>k</italic>=1,…,2<sup><italic>n</italic></sup>, and set <italic>θ</italic>
<sub><bold>k</bold></sub>=<italic>θ</italic>
<sub><italic>k</italic></sub>, where <italic>k</italic>−1 is the integer whose binary representation is the methylation pattern <bold>k</bold>.</p>
      <p>Our aim is to estimate the distribution <italic>θ</italic>
<sub><italic>k</italic></sub> representing the relative abundance of methylation pattern <italic>k</italic> from high throughput sequencing data consisting of a set of integer valued read counts <italic>Y</italic>
<sub><italic>k</italic></sub>. In a typical experiment, the number <italic>n</italic> of CpG sites in an amplicon may be up <italic>O</italic>(10<sup>2</sup>), and the total number of read counts <inline-formula id="IEq33"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {N}_{\mathrm{read}}=\sum_{k=1}^{2^n}{Y}_k $$\end{document}</tex-math><mml:math id="M62"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mtext>read</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq33.gif"/></alternatives></inline-formula> may be up to <italic>O</italic>(10<sup>6</sup>).</p>
      <p>The model takes into account two sources of error. First, the bisulphite conversion of unmethylated cytosine to uracil is not 100% efficient. There is a probability <italic>ε</italic> that an unmethylated CpG site will register as being methylated, where <italic>ε</italic>∼<italic>O</italic>(10<sup>−2</sup>) can be estimated from the cytosines known not to be methylated (mitochondrial genome, chloroplastic genome, spike-ins, etc). The second type of error is caused by sequencing. For many applications this may be assumed for practical purposes to be site independent. However, to allow for effects such as degradation of the read quality towards the ends of the reads, we will assume there is a site-dependent probability <italic>η</italic>
<sub><italic>s</italic></sub>∼<italic>O</italic>(10<sup>−2</sup>) that if site <italic>s</italic> is unmethylated it will register as methylated and vice versa. It follows that if the true methylation pattern of any given read is <bold>K</bold>, but the read registers as being pattern <bold>L</bold>, then
<disp-formula id="Equ2"><label>(2)</label><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ Prob\kern0.3em \left(L=\ell \Big|K=k\right)={M}_{k\ell },\kern1em k,\ell =1,\dots {2}^n, $$\end{document}</tex-math><mml:math id="M64"><mml:mtext mathvariant="italic">Prob</mml:mtext><mml:mspace width="0.3em"/><mml:mo>(</mml:mo><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>|</mml:mo><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>kℓ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2015_600_Equ2.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>where, as above, we adopt the conventon that <italic>k</italic>−1 is the integer whose binary representation is the methylation pattern <bold>k</bold>=(<italic>k</italic>
<sub>1</sub>,…,<italic>k</italic>
<sub><italic>n</italic></sub>) and <italic>ℓ</italic>−1 is the integer whose binary representation is the methylation pattern <bold>l</bold>=(<italic>ℓ</italic>
<sub>1</sub>,…,<italic>ℓ</italic>
<sub><italic>n</italic></sub>), and
<disp-formula id="Equ3"><label>(3)</label><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {M}_{k\ell }={\left({E}_1\right)}_{k_1{\ell}_1}{\left({E}_2\right)}_{k_2{\ell}_2}\dots {\left({E}_n\right)}_{k_n{\ell}_n}, $$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>kℓ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>…</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2015_600_Equ3.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>where, for each <italic>s</italic>=1,…<italic>n</italic>,
<disp-formula id="Equ4"><label>(4)</label><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{lcrr}{E}_s&amp; =&amp; \left(\begin{array}{ll}1-\varepsilon &amp; \varepsilon \\ {}0&amp; 1\end{array}\right)\left(\begin{array}{ll}1-{\eta}_s&amp; {\eta}_s\\ {}{\eta}_s&amp; 1-{\eta}_s\end{array}\right)&amp; \\ {}&amp; =&amp; \left(\begin{array}{ll}1-\varepsilon -{\eta}_s+2\varepsilon {\eta}_s&amp; \varepsilon +{\eta}_s-2\varepsilon {\eta}_s\\ {}{\eta}_s&amp; 1-{\eta}_s\end{array}\right).&amp; \end{array} $$\end{document}</tex-math><mml:math id="M68"><mml:mtable class="eqnarray" columnalign="left center right"><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi></mml:mtd><mml:mtd><mml:mi>ε</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mtd><mml:mtd><mml:mtext/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mtable class="array" columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ε</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>ε</mml:mi><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mi>ε</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>ε</mml:mi><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>η</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mi>.</mml:mi></mml:mtd><mml:mtd><mml:mtext/><mml:mtext/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12859_2015_600_Equ4.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>is a 2 ×2 matrix whose rows and columns are labelled 0 (for unmethylated) and 1 (for methylated). In fact the matrix <italic>M</italic> whose elements are <italic>M</italic>
<sub><italic>k</italic><italic>ℓ</italic></sub> is the Kronecker product <italic>E</italic>
<sub>1</sub>⊗…⊗<italic>E</italic>
<sub><italic>n</italic></sub>.</p>
      <p>Eqs. (<xref rid="Equ1" ref-type="">1</xref>) and (<xref rid="Equ2" ref-type="">2</xref>) imply that the probability that a random read will be the pattern <italic>ℓ</italic> is
<disp-formula id="Equ5"><label>(5)</label><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ Prob\kern0.3em \left(L=\ell \right)=\sum_{k=1}^{2^n}{\theta}_k{M}_{k\ell }={\phi}_{\ell }, $$\end{document}</tex-math><mml:math id="M70"><mml:mtext mathvariant="italic">Prob</mml:mtext><mml:mspace width="0.3em"/><mml:mo>(</mml:mo><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>kℓ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2015_600_Equ5.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>say. Assuming each read to be independent, for an experiment with a given total number of reads <italic>N</italic>
<sub>read</sub> the observed set of read counts represented by the random variable <italic>Y</italic>
<sub><italic>ℓ</italic></sub> has a multinomial distribution:
<disp-formula id="Equ6"><label>(6)</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ Prob\kern0.3em \left({Y}_{\ell }={y}_{\ell}\Big|\phi \right)=\frac{N_{\mathrm{read}}!}{y_1!{y}_2!\dots {y}_{2^n}!}{\phi_1}^{y_1}\dots {\phi_{2^n}}^{y_{2^n}}. $$\end{document}</tex-math><mml:math id="M72"><mml:mtext mathvariant="italic">Prob</mml:mtext><mml:mspace width="0.3em"/><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mtext>read</mml:mtext></mml:mrow></mml:msub><mml:mo>!</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>!</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>!</mml:mo><mml:mo>…</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>…</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mi>.</mml:mi></mml:math><graphic xlink:href="12859_2015_600_Equ6.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>In a recent applications note, [<xref ref-type="bibr" rid="CR9">9</xref>] develop a statistical model for the distribution of the number of reads which register as being methylated in a pooled set of bisulphite-sequencing reads from CpG sites in a given region of a genome. Their model is mathematically equivalent to the <italic>n</italic>=1 version of the above model, and as such can be simplified to a single binomial distribution (see Additional file <xref rid="MOESM2" ref-type="media">2</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>Parameter estimation</title>
      <p>The parameters of the distribution over methylation profiles, <italic>θ</italic>
<sub><italic>k</italic></sub>, are estimated by maximising the log likelihood:
<disp-formula id="Equ7"><label>(7)</label><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ L\left(\theta \Big|y\right)=\sum_{k=1}^{2^n}{y}_k \log \left(\sum_{j=1}^{2^n}{\theta}_j{M}_{jk}\right), $$\end{document}</tex-math><mml:math id="M74"><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>|</mml:mo><mml:mi>y</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>log</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12859_2015_600_Equ7.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>subject to the constraint that <inline-formula id="IEq34"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \left({\theta}_1,\dots, {\theta}_{2^n}\right) $$\end{document}</tex-math><mml:math id="M76"><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="12859_2015_600_IEq34.gif"/></alternatives></inline-formula> lies in the (2<sup><italic>n</italic></sup>−1)-dimensional simplex
<disp-formula id="Equ8"><label>(8)</label><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ S=\left\{\theta :\sum_{k=1}^{2^n}{\theta}_k=1,{\theta}_k\ge 0\right\}. $$\end{document}</tex-math><mml:math id="M78"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mi>θ</mml:mi><mml:mo>:</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced><mml:mi>.</mml:mi></mml:math><graphic xlink:href="12859_2015_600_Equ8.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p>One may be tempted to use the usual formula, <inline-formula id="IEq35"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\phi}}_{\ell }={y}_{\ell }/{N}_{read} $$\end{document}</tex-math><mml:math id="M80"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">read</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq35.gif"/></alternatives></inline-formula>, for the maximum likelihood estimate of multinomial parameters, and simply invert the matrix <italic>M</italic> to recover <inline-formula id="IEq36"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k $$\end{document}</tex-math><mml:math id="M82"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq36.gif"/></alternatives></inline-formula>. However this will not work for any realistic data because the matrix <italic>M</italic> shrinks the simplex to a smaller volume. In practice many of the <italic>y</italic>
<sub><italic>ℓ</italic></sub> are zero, which leads to a naive estimate <inline-formula id="IEq37"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\phi}}_{\ell } $$\end{document}</tex-math><mml:math id="M84"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq37.gif"/></alternatives></inline-formula> on the boundary of the unshrunken simplex in <italic>ϕ</italic>-space, and this boundary is not included in the shrunken simplex (see Figure <xref rid="Fig7" ref-type="fig">7</xref> for the <italic>n</italic>=2 case, in which the simplex is tetrahedron).
<fig id="Fig7"><label>Figure 7</label><caption><p>Boundary of the allowed simplex Eq. (<xref rid="Equ8" ref-type="">8</xref>) for the parameters <italic>θ</italic>, (black wire frame) and corresponding shrunken simplex containing allowed values of <italic>ϕ</italic> (red tetrahedron) for the case <italic>n</italic>=2 CpG sites, <italic>ε</italic>=0.05, <italic>η</italic>
<sub><italic>s</italic></sub>=0.02. Numbers at the corners are the 2<sup><italic>n</italic></sup>=4 possible methylation patterns).</p></caption><graphic xlink:href="12859_2015_600_Fig7_HTML" id="MO7"/></fig>
</p>
      <p>Instead we maximise the log likelihood over the allowed domain numerically by using the R function constrOptim(). Unfortunately the performance of this function becomes prohibitively slow for <inline-formula id="IEq38"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ n\gtrsim 8 $$\end{document}</tex-math><mml:math id="M86"><mml:mi>n</mml:mi><mml:mo>≳</mml:mo><mml:mn>8</mml:mn></mml:math><inline-graphic xlink:href="12859_2015_600_IEq38.gif"/></alternatives></inline-formula> as the dimensionality of the parameter space grows exponentially. However, we have noticed in numerical simulations that if the observed counts <italic>y</italic>
<sub><italic>k</italic></sub> are zero for a subset of the possible patterns, the corresponding estimates <inline-formula id="IEq39"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k $$\end{document}</tex-math><mml:math id="M88"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq39.gif"/></alternatives></inline-formula> are zero (or in rare cases, very close to zero) for the same subset. Thus we have implemented an algorithm which only searches over that part of the boundary of <italic>S</italic> constrained by <italic>θ</italic>
<sub><italic>k</italic></sub>=0 for those <italic>k</italic> such that <italic>y</italic>
<sub><italic>k</italic></sub>=0. The algorithm remains reasonably efficient on a standard desktop computer provided the number of observed methylation patterns does not exceed about 200. This allows analysis of most realistic datasets while still addressing the biologically relevant question of identifying spurious methylation patterns which are the result of incomplete methylation.</p>
      <p>In Additional file <xref rid="MOESM2" ref-type="media">2</xref> we prove that both the exact maximum likelihood estimate, and the aproximate maximum likelihood estimate over reduced part of the boundary described above are unique. However, in both cases the function constrOptim() is of finite accuracy in locating the maximum of the log-likelihood. Thus, if the located maximum <inline-formula id="IEq40"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \widehat{\theta} $$\end{document}</tex-math><mml:math id="M90"><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12859_2015_600_IEq40.gif"/></alternatives></inline-formula> is close to the boundary of the simplex, our algorithm also calculates the value of the log-likelihood at several nearby points on the boundary. If this results in a log-likelihood bigger than or equal to the maximum reported by constrOptim(), the appropriate point on the boundary is taken as the maximum likelihood estimate, and those patterns <italic>m</italic>
<sub><italic>k</italic></sub> for which <inline-formula id="IEq41"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_k\equiv 0 $$\end{document}</tex-math><mml:math id="M92"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>≡</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="12859_2015_600_IEq41.gif"/></alternatives></inline-formula> are reported as being spurious reads.</p>
      <p>Additional file <xref rid="MOESM2" ref-type="media">2</xref> also contains an argument that for realistic datasets and parameter values, the estimated distribution <inline-formula id="IEq42"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq42.gif"/></alternatives></inline-formula> is in general skewed towards less-methlyated states relative to the naïve estimate <italic>y</italic>
<sub><italic>i</italic></sub>/<italic>n</italic>
<sub>read</sub>, and that the set of patterns reported to be present is a subset of (or the same set as) the set of patterns naïvely observed. These observations hold rigorously for any dataset if the algorithm is run with the read-error rate <italic>η</italic>
<sub><italic>s</italic></sub> set to zero for all sites <italic>s</italic>.</p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec10">
        <title>Additional files</title>
        <p>
          <media position="anchor" xlink:href="12859_2015_600_MOESM1_ESM.pdf" id="MOESM1">
            <label>Additional file 1</label>
            <caption>
              <p><bold>Estimated pattern abundances using the exact algorithm.</bold> Estimates <inline-formula id="IEq43"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq43.gif"/></alternatives></inline-formula> calculated with the exact, slow implementations of our algorithm for the synthetic dataset of Figure <xref rid="Fig1" ref-type="fig">1</xref>. Methylation patterns are labelled lexicographically from <italic>m</italic>
<sub>1</sub>=000000 to <italic>m</italic>
<sub>64</sub>=111111. Data for patterns <italic>m</italic>
<sub>1</sub>, <italic>m</italic>
<sub>62</sub>=111101, and <italic>m</italic>
<sub>64</sub> are beyond the range of the plot, but are listed in Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
            </caption>
          </media>
        </p>
        <p>
          <media position="anchor" xlink:href="12859_2015_600_MOESM2_ESM.pdf" id="MOESM2">
            <label>Additional file 2</label>
            <caption>
              <p><bold>Technical details.</bold> Analysis of the relationship of the statistical model used by Akman et al. [<xref ref-type="bibr" rid="CR9">9</xref>] to our statistical model, proof of uniqueness of maximum likelihood estimate and argument that the number of reported methylation patterns is reduced by the MPFE algorithm.</p>
            </caption>
          </media>
        </p>
        <p>
          <media position="anchor" xlink:href="12859_2015_600_MOESM3_ESM.xlsx" id="MOESM3">
            <label>Additional file 3</label>
            <caption>
              <p><bold>Table of results for the second synthetic data example.</bold> True and estimated methylation distributions <italic>θ</italic>
<sub><italic>i</italic></sub> and <inline-formula id="IEq44"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\theta}}_i $$\end{document}</tex-math><mml:math id="M98"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2015_600_IEq44.gif"/></alternatives></inline-formula> for the data of Figure <xref rid="Fig2" ref-type="fig">2</xref>. The 56 patterns with non-zero reads are labelled by their binary representation and <italic>y</italic>
<sub><italic>i</italic></sub> are the observed read counts.</p>
            </caption>
          </media>
        </p>
        <p>
          <media position="anchor" xlink:href="12859_2015_600_MOESM4_ESM.xlsx" id="MOESM4">
            <label>Additional file 4</label>
            <caption>
              <p><bold>Table of results for the second biological data example.</bold> Estimated methylation distribution <inline-formula id="IEq45"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\widehat{\boldsymbol{\theta}}}_{\boldsymbol{i}} $$\end{document}</tex-math><mml:math id="M100"><mml:mstyle mathvariant="bold-italic"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math><inline-graphic xlink:href="12859_2015_600_IEq45.gif"/></alternatives></inline-formula> for the data of Figure <xref rid="Fig6" ref-type="fig">6</xref>. The 160 patterns with non-zero reads are labelled by their binary reresentation and <italic>y</italic>
<sub><italic>i</italic></sub> are the observed read counts.</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>CpG</term>
        <def>
          <p>Cytosine-phosphate-guanine dinucleotide</p>
        </def>
      </def-item>
      <def-item>
        <term>DNA</term>
        <def>
          <p>Deoxyribonucleic acid</p>
        </def>
      </def-item>
      <def-item>
        <term>FN</term>
        <def>
          <p>False negative</p>
        </def>
      </def-item>
      <def-item>
        <term>FP</term>
        <def>
          <p>False positive</p>
        </def>
      </def-item>
      <def-item>
        <term>FPR</term>
        <def>
          <p>False positive rate</p>
        </def>
      </def-item>
      <def-item>
        <term>PCR</term>
        <def>
          <p>Polymerase chain reaction</p>
        </def>
      </def-item>
      <def-item>
        <term>TN</term>
        <def>
          <p>True negative</p>
        </def>
      </def-item>
      <def-item>
        <term>TpG</term>
        <def>
          <p>Thymine-phosphate-guanine dinucleotide</p>
        </def>
      </def-item>
      <def-item>
        <term>TPR</term>
        <def>
          <p>True positive rate</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Competing interests</bold>
      </p>
      <p>The authors declare that they have no competing interests.</p>
    </fn>
    <fn>
      <p>
        <bold>Authors’ contributions</bold>
      </p>
      <p>SF, CJB, SRW conceived and designed the project. SF prepared the datasets. PL, CJB developed the mathematical and statistical model, carried out the analysis and developed the software. PL, SF, CJB wrote the manuscript. All authors read and approved the final manuscript.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>This project is supported by Australian Research Council Discovery Grants DP120101422 and DE130101450 and National Health and Medical Research Council Grant NHMRC525453. We thank Ryszard Maleszka for sharing sequencing data.</p>
  </ack>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cantone</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Fisher</surname>
            <given-names>AG</given-names>
          </name>
        </person-group>
        <article-title>Epigenetic programming and reprogramming during development</article-title>
        <source>Nat Struct Mol Biol</source>
        <year>2013</year>
        <volume>20</volume>
        <issue>3</issue>
        <fpage>282</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/nsmb.2489</pub-id>
        <pub-id pub-id-type="pmid">23463313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Day</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Sweatt</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Dna methylation and memory formation</article-title>
        <source>Nat Neurosci</source>
        <year>2010</year>
        <volume>13</volume>
        <issue>11</issue>
        <fpage>1319</fpage>
        <lpage>23</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.2666</pub-id>
        <pub-id pub-id-type="pmid">20975755</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Feinberg</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>Phenotypic plasticity and the epigenetics of human disease</article-title>
        <source>Nature</source>
        <year>2007</year>
        <volume>447</volume>
        <issue>7143</issue>
        <fpage>433</fpage>
        <lpage>40</lpage>
        <pub-id pub-id-type="doi">10.1038/nature05919</pub-id>
        <pub-id pub-id-type="pmid">17522677</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lyko</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Foret</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kucharski</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Falckenhayn</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Maleszka</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>The honey bee epigenomes: differential methylation of brain DNA in queens and workers</article-title>
        <source>PLoS Biol</source>
        <year>2010</year>
        <volume>8</volume>
        <issue>11</issue>
        <fpage>1000506</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.1000506</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shukla</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kavak</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Gregory</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Imashimizu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Shutinoski</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ctcf-promoted rna polymerase ii pausing links dna methylation to splicing</article-title>
        <source>Nature</source>
        <year>2011</year>
        <volume>479</volume>
        <issue>7371</issue>
        <fpage>74</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/nature10442</pub-id>
        <pub-id pub-id-type="pmid">21964334</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kucharski</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Maleszka</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Foret</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Maleszka</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Nutritional control of reproductive status in honeybees via dna methylation</article-title>
        <source>Science</source>
        <year>2008</year>
        <volume>319</volume>
        <issue>5871</issue>
        <fpage>1827</fpage>
        <lpage>30</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1153069</pub-id>
        <pub-id pub-id-type="pmid">18339900</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hawkins</surname>
            <given-names>RD</given-names>
          </name>
          <name>
            <surname>Hon</surname>
            <given-names>GC</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>LK</given-names>
          </name>
          <name>
            <surname>Ngo</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Lister</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Pelizzola</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Distinct epigenomic landscapes of pluripotent and lineage-committed human cells</article-title>
        <source>Cell stem cell</source>
        <year>2010</year>
        <volume>6</volume>
        <issue>5</issue>
        <fpage>479</fpage>
        <lpage>91</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2010.03.018</pub-id>
        <pub-id pub-id-type="pmid">20452322</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Clark</surname>
            <given-names>SJ</given-names>
          </name>
          <name>
            <surname>Harrison</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Paul</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Frommer</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>High sensitivity mapping of methylated cytosines</article-title>
        <source>Nucleic Acids Res</source>
        <year>1994</year>
        <volume>22</volume>
        <issue>15</issue>
        <fpage>2990</fpage>
        <lpage>7</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/22.15.2990</pub-id>
        <pub-id pub-id-type="pmid">8065911</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Akman</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Haaf</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Gravina</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Vijg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Tresch</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Genome-wide quantitative analysis of DNA methylation from bisulphite sequencing data</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <issue>13</issue>
        <fpage>1933</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu142</pub-id>
        <pub-id pub-id-type="pmid">24618468</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>He</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Shao</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Liang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Dmeas: Dna methylation entropy analysis software</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <issue>16</issue>
        <fpage>2044</fpage>
        <lpage>5</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btt332</pub-id>
        <pub-id pub-id-type="pmid">23749987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Garrett-Bakelman</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Perl</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Luger</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>To</surname>
            <given-names>BL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dynamic evolution of clonal epialleles revealed by methclone</article-title>
        <source>Genome Biol</source>
        <year>2014</year>
        <volume>15</volume>
        <issue>9</issue>
        <fpage>472</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-014-0472-5</pub-id>
        <pub-id pub-id-type="pmid">25260792</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shao</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Deciphering the heterogeneity in dna methylation patterns during stem cell differentiation and reprogramming</article-title>
        <source>BMC Genomics</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>978</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2164-15-978</pub-id>
        <pub-id pub-id-type="pmid">25404570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mikeska</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Candiloro</surname>
            <given-names>ILM</given-names>
          </name>
          <name>
            <surname>Dobrovic</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>The implications of heterogeneous dna methylation for the accurate quantification of methylation</article-title>
        <source>Epigenomics</source>
        <year>2010</year>
        <volume>2</volume>
        <issue>4</issue>
        <fpage>561</fpage>
        <lpage>73</lpage>
        <pub-id pub-id-type="doi">10.2217/epi.10.32</pub-id>
        <pub-id pub-id-type="pmid">22121974</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>EJ</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Analyzing the cancer methylome through targeted bisulfite sequencing</article-title>
        <source>Cancer Lett</source>
        <year>2013</year>
        <volume>340</volume>
        <issue>2</issue>
        <fpage>171</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="doi">10.1016/j.canlet.2012.10.040</pub-id>
        <pub-id pub-id-type="pmid">23200671</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gentleman</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Carey</surname>
            <given-names>VJ</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Bolstad</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Dettling</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bioconductor: Open software development for computational biology and bioinformatics</article-title>
        <source>Genome Biol</source>
        <year>2004</year>
        <volume>5</volume>
        <fpage>80</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2004-5-10-r80</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>GG</given-names>
          </name>
          <name>
            <surname>Diallo</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Poujol</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Nagy</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Staffa</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Vaillancourt</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bisqc: an operational pipeline for multiplexed bisulfite sequencing</article-title>
        <source>BMC Genomics</source>
        <year>2014</year>
        <volume>15</volume>
        <fpage>290</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2164-15-290</pub-id>
        <pub-id pub-id-type="pmid">24734894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lutsik</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Feuerbach</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Arand</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lengauer</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Walter</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bock</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Biq analyzer ht: locus-specific analysis of dna methylation by high-throughput bisulfite sequencing</article-title>
        <source>Nucleic Acids Res</source>
        <year>2011</year>
        <volume>39</volume>
        <issue>Web Server issue</issue>
        <fpage>551</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkr312</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
