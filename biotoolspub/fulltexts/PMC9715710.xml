<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9715710</article-id>
    <article-id pub-id-type="pmid">36456571</article-id>
    <article-id pub-id-type="publisher-id">35094</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-022-35094-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A unified computational framework for single-cell data integration with optimal transport</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9524-4942</contrib-id>
        <name>
          <surname>Cao</surname>
          <given-names>Kai</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Gong</surname>
          <given-names>Qiyu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9505-8739</contrib-id>
        <name>
          <surname>Hong</surname>
          <given-names>Yiguang</given-names>
        </name>
        <address>
          <email>yghong@iss.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3511-0512</contrib-id>
        <name>
          <surname>Wan</surname>
          <given-names>Lin</given-names>
        </name>
        <address>
          <email>lwan@amss.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.484479.2</institution-id><institution>LSC, NCMIS, Academy of Mathematics and Systems Science, Chinese Academy of Sciences, </institution></institution-wrap>Beijing, China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.410726.6</institution-id><institution-id institution-id-type="ISNI">0000 0004 1797 8419</institution-id><institution>School of Mathematical Sciences, University of Chinese Academy of Sciences, </institution></institution-wrap>Beijing, China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.16821.3c</institution-id><institution-id institution-id-type="ISNI">0000 0004 0368 8293</institution-id><institution>Shanghai Institute of Immunology, Faculty of Basic Medicine, Shanghai Jiao Tong University School of Medicine, </institution></institution-wrap>Shanghai, China </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.24516.34</institution-id><institution-id institution-id-type="ISNI">0000000123704535</institution-id><institution>Department of Control Science and Engineering, </institution><institution>Tongji University, </institution></institution-wrap>Shanghai, China </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>1</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>13</volume>
    <elocation-id>7419</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>11</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell data integration can provide a comprehensive molecular view of cells. However, how to integrate heterogeneous single-cell multi-omics as well as spatially resolved transcriptomic data remains a major challenge. Here we introduce uniPort, a unified single-cell data integration framework that combines a coupled variational autoencoder (coupled-VAE) and minibatch unbalanced optimal transport (Minibatch-UOT). It leverages both highly variable common and dataset-specific genes for integration to handle the heterogeneity across datasets, and it is scalable to large-scale datasets. uniPort jointly embeds heterogeneous single-cell multi-omics datasets into a shared latent space. It can further construct a reference atlas for gene imputation across datasets. Meanwhile, uniPort provides a flexible label transfer framework to deconvolute heterogeneous spatial transcriptomic data using an optimal transport plan, instead of embedding latent space. We demonstrate the capability of uniPort by applying it to integrate a variety of datasets, including single-cell transcriptomics, chromatin accessibility, and spatially resolved transcriptomic data.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integrating heterogeneous single-cell multi-omics as well as spatially resolved transcriptomic data remains a major challenge. Here the authors report a unified single-cell data integration framework using an unbalanced optimal transport-based deep network.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Machine learning</kwd>
      <kwd>Chromatin</kwd>
      <kwd>Transcriptomics</kwd>
      <kwd>Sequencing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100011002</institution-id>
            <institution>National Science Foundation of China | National Natural Science Foundation of China-Yunnan Joint Fund (NSFC-Yunnan Joint Fund)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>61733018</award-id>
        <award-id>62173250</award-id>
        <award-id>12071466</award-id>
        <principal-award-recipient>
          <name>
            <surname>Hong</surname>
            <given-names>Yiguang</given-names>
          </name>
          <name>
            <surname>Wan</surname>
            <given-names>Lin</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100003399</institution-id>
            <institution>Science and Technology Commission of Shanghai Municipality (Shanghai Municipal Science and Technology Commission)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>2021SHZDZX0100</award-id>
        <principal-award-recipient>
          <name>
            <surname>Hong</surname>
            <given-names>Yiguang</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">The latest developments in high-throughput single-cell multi-omics sequencing technologies, e.g., single-cell RNA-sequencing (scRNA) and single-cell Assay for Transposase-Accessible Chromatin using sequencing (scATAC), enable comprehensive studies of heterogeneous cell populations that make up tissues, the dynamics of developmental processes, and the underlying regulatory mechanisms that control cellular functions. The computational integration of single-cell datasets is drawing heavy attention toward making advancements in machine learning and data science<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>.</p>
    <p id="Par4">Among existing single-cell integration methods, tremendous efforts<sup><xref ref-type="bibr" rid="CR4">4</xref>–<xref ref-type="bibr" rid="CR7">7</xref></sup> have been devoted to integrating multiple datasets simultaneously profiled from the same cells (e.g., paired-cell datasets generated by the cellular indexing of transcriptomes and epitopes by sequencing (CITE-seq)<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>). However, these paired datasets are technically challenging and costly to obtain. Therefore, a vast number of integrative methods have been developed for data profiled from different cells taken from the same, or similar, populations. For example, the celebrated platform Seurat<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> projected feature space into a common subspace using canonical correlation analysis (CCA), which maximizes inter-dataset correlation. LIGER<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and DC3<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> employed non-negative matrix factorization to find the shared low-dimension factors of the common features to match single-cell omics datasets. Harmony<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> iterated between maximum diversity clustering and a mixture model-based linear batch correction, providing a latent space in which batch effects are removed. However, these methods rely on linear operation, thus lacking the ability to handle nonlinear deformations across cellular modalities. In addition, they only leverage filtered common genes, while ignoring the importance of dataset-specific genes for the identification of cell populations, which usually capture cell-type heterogeneity not present in common genes<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. To address these shortcomings, manifold alignment methods are emerging and have achieved promising results in integrating single-cell multi-omics datasets<sup><xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>. However, manifold alignment methods are limited by relatively high computational complexity, and they are not scalable to large-scale datasets.</p>
    <p id="Par5">With the development of deep learning, many autoencoder-based approaches have been proposed and demonstrated their power in data integration across modalities. However, most of them require paired datasets profiled from the same cells, such as DCCA<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> and Cobolt<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, to utilize cell-paring information. When cell-paring information is unavailable, the alternative is simultaneous training of different autoencoders and aligning cells across different modalities in a latent space. However, this option still makes computation a challenging exercise. Recently, an emerging number of methods have been developed to account for unpaired data. For example, methods like scDART<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> and cross-modal autoencoders<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> attempted to learn a latent space by autoencoders and align latent representations via kernel-based or discriminator-based discrepancy. However, these methods require global alignment which is often too restrictive for integrate heterogeneous cellular populations. In addition, the transfer learning-based methods were also developed to establish a source atlas via one modality for knowledge (e.g., cell labels) transfer to another modality by learning a modality-invariant latent space<sup><xref ref-type="bibr" rid="CR22">22</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>. Although having achieved encouraging results, these methods are restricted to using source modality with annotated cell labels.</p>
    <p id="Par6">Recently published methods for single-cell genomics integration such as scMC<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and SCALEX<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> showed state-of-the-art performance on batch effect correction of one modality, but they have not been benchmarked on single-cell multi-omics data integration. GLUE<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, another state-of-the-art method for single-cell multi-omics (e.g., scATAC, scRNA) integration and integrative regulatory inference, based its development on advanced graph autoencoders. Meanwhile, many other methods are proposed for integrative analysis of spatial transcriptomics (ST) and scRNA data. Among these methods, gimVI<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> and Tangram<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> achieved the most advanced performance<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. However, to the best of our knowledge, no method has been developed for a unified integration of single-cell multi-omics as well as spatially resolved transcriptomic data.</p>
    <p id="Par7">To address this gap, we herein advance the field by developing uniPort, an accurate, robust, and efficient computational platform for integrating heterogeneous single-cell datasets with optimal transport (OT). To overcome the limitation thwarting conventional VAE for single-cell heterogeneous and/or unpaired data integration, we propose a unified computational framework by combining a coupled variational autoencoder (coupled-VAE) and Minibatch Unbalanced OT (Minibatch-UOT)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> (Fig. <xref rid="Fig1" ref-type="fig">1</xref>). This framework allows leveraging both highly variable common and dataset-specific genes for integration in order to handle the heterogeneity across datasets. Experimental results show that uniPort can accurately and robustly integrates scATAC and scRNA datasets profiled from peripheral blood mononuclear cells (PBMC) and mouse spleen. It can also accurately impute unmeasured spatially resolved multiplexed error robust fluorescence in situ hybridization (MERFISH)<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> genes through scRNA data. Moreover, with an output OT plan, we demonstrate that uniPort can accurately decipher canonical structures of the mouse brain and assist in locating tertiary lymphoid structures (TLS) in the breast cancer region, as well as reveal cancer heterogeneity in microarray-based spatial data.<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of uniPort algorithm.</title><p>uniPort integrates single-cell data by combining a coupled-VAE and Minibatch-UOT. uniPort takes as input a highly variable common gene set of single-cell datasets across different modalities or technologies. <bold>a</bold> uniPort projects input datasets into a cell-embedding latent space through a shared probabilistic encoder. Then uniPort minimizes a Minibatch-UOT loss between cell embeddings across different datasets. Finally, uniPort reconstructs two terms. The first consists of input datasets by a decoder with different DSBN layers. The second consists of highly variable gene sets corresponding to each dataset by dataset-specific decoders. <bold>b</bold> uniPort outputs a shared latent space and an optimal transport plan that can be used for downstream analysis, such as visualization, gene imputation and spots deconvolution.</p></caption><graphic xlink:href="41467_2022_35094_Fig1_HTML" id="d32e409"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>uniPort embeds and integrates datasets by coupled-VAE and Minibatch-UOT</title>
      <p id="Par8">As input, uniPort takes diverse and heterogeneous single-cell datasets across different modalities or technologies. uniPort is based on a coupled variational auto-encoder (coupled-VAE) and employs a dataset-free encoder to project highly variable common gene sets of different datasets into a generalized cell-embedding latent space. Then uniPort reconstructs two terms. One is input by a dataset-free decoder with dataset-specific batch normalization (DSBN)<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR32">32</xref></sup> layers. The other is a highly variable gene set through a dataset-specific decoder corresponding to each dataset (Fig. <xref rid="Fig1" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">1)</xref>. Some overlapping genes are often found between the two terms as some common genes are also highly variable in each dataset. However, with slight abuse of ‘specific’, we still name the second term a dataset-specific gene set in the following context. During integration, uniPort minimizes a Minibatch-UOT loss between cell embeddings in the latent space from different datasets. It is necessary to introduce the loss as it feeds back a gradient to the encoder to achieve a better alignment result, especially when dataset-specific decoders are considered that increase the heterogeneity across datasets in the latent space. Meanwhile, the minibatch strategy substantially improves the computational efficiency of OT, making it scalable to large datasets, and the unbalanced OT makes it more suitable for heterogeneous data integration.</p>
      <p id="Par9">We employed a series of scores to assess the performance of single-cell data integration. To quantify dataset mixing and cell-type separation, we computed two scores used by SCALEX: the Batch Entropy score<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> to evaluate the extent of mixing cells across datasets and the Silhouette coefficient<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> to evaluate the separation of biological distinctions. To benchmark annotation clustering accuracy, we adopted the adjusted rand index (ARI), the normalized mutual information (NMI), and the F1 scores using cell-type annotations (Methods). Then, for paired datasets, we employed the average fraction of samples closer than the true match (FOSCTTM)<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> to measure the preservation of cell–cell correspondence across datasets.</p>
    </sec>
    <sec id="Sec4">
      <title>uniPort integrates scATAC and scRNA data</title>
      <p id="Par10">We benchmarked uniPort against current state-of-the-art single-cell genomics integration methods<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR17">17</xref>,<xref ref-type="bibr" rid="CR24">24</xref>–<xref ref-type="bibr" rid="CR26">26</xref>,<xref ref-type="bibr" rid="CR35">35</xref></sup> on one dataset of paired scATAC and scRNA (the paired PBMC dataset<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>) and two datasets of unpaired scATAC and scRNA (the microfluidic-based PBMC dataset<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> and the mouse spleen dataset<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>). We employed Uniform Manifold Approximation and Projection (UMAP)<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> to visualize the integration results.</p>
      <p id="Par11">We first applied uniPort to integrate the paired PBMC dataset (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). The pairing information was only used for performance evaluation. We found that uniPort and GLUE achieved the best performance with comparable results (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c–e). Specifically, uniPort achieved the highest Silhouette coefficient of 0.64, while GLUE had the second highest Silhouette coefficient of 0.621; uniPort had the second best average FOSCTTM of 0.0694, a total score of ARI, NMI and F1 of 2.321, and the third highest Batch Entropy score of 0.64, slightly below GLUE (average FOSCTTM of 0.0441, total score of 2.514 and Batch Entropy score of 0.677). Among all compared methods, uniPort, Seurat, Harmony, SCOT, and GLUE accurately integrated most cell types in two modalities (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b and Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref>.<fig id="Fig2"><label>Fig. 2</label><caption><title>uniPort integrates paired scATAC and scRNA of the PBMC data from 10× Genomics.</title><p><bold>a</bold> UMAP visualization of PBMC data before integration colored by omics and cell annotations. <bold>b</bold> UMAP visualization of PBMC data after uniPort integration. <bold>c</bold> Comparison of total scores of ARI, NMI and F1 of different methods. <bold>d</bold> Comparison of Batch Entropy scores and Silhouette coefficients of different methods. <bold>e</bold> Comparison of average FOSCTTM of different methods.</p></caption><graphic xlink:href="41467_2022_35094_Fig2_HTML" id="d32e533"/></fig></p>
      <p id="Par12">In addition to integrating the paired PBMC dataset, we further evaluated uniPort on an unpaired microfluidic-based PBMC dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3)</xref>. As a result, uniPort accurately integrated the scATAC and scRNA data with competitive performance comparable to that of GLUE, MultiMAP and Harmony. For example, uniPort aligned most cell types well in two modalities (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>a, b), demonstrating Silhouette coefficient and Batch Entropy score of 0.68 and 0.623 (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>c, d), which were similar to GLUE (0.682 and 0.638, respectively), MultiMAP (0.648 and 0.623, respectively), and Harmony (0.636 and 0.626, respectively), but surpassing other compared methods.</p>
      <p id="Par13">We also tested uniPort on another unpaired scATAC and scRNA profiled from the mouse spleen dataset (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). uniPort, scMC, Harmony, and Seurat achieved the highest performance. Specifically, uniPort achieved the highest Silhouette coefficient of 0.709, slightly higher than scMC (0.704), Harmony (0.704), and Seurat (0.699); Harmony ranked first in Batch Entropy score of 0.676, higher than uniPort (0.632) and Seurat (0.671); scMC had the highest total score of ARI, NMI and F1 of 2.466, while uniPort (2.436), Harmony (2.416), and Seurat (2.437) followed close behind with a total score for each higher than 2.4, slightly below that of scMC.<fig id="Fig3"><label>Fig. 3</label><caption><title>uniPort integrates unpaired scATAC and scRNA of the mouse spleen data.</title><p><bold>a</bold> UMAP visualization of mouse spleen data before integration colored by omics and cell annotations. <bold>b</bold> UMAP visualization of mouse spleen data after uniPort integration. <bold>c</bold> Comparison of Batch Entropy scores and Silhouette coefficients of different methods. <bold>d</bold> Comparison of total scores of ARI, NMI and F1 of different methods.</p></caption><graphic xlink:href="41467_2022_35094_Fig3_HTML" id="d32e571"/></fig></p>
      <p id="Par14">In summary, among all methods, uniPort performed favorably when compared with recently published state-of-the-art methods, showing accurate and robust results across both paired and unpaired datasets.</p>
    </sec>
    <sec id="Sec5">
      <title>uniPort performs unbalanced matching tasks of heterogeneous datasets</title>
      <p id="Par15">uniPort minimizes a Minibatch-UOT loss, which is suitable for unbalanced matching and provides a strong guarantee for heterogeneous data integration. To evaluate the performance of uniPort on heterogeneous data integration, we conducted two unbalanced matching tasks by removing some cell types from scATAC or scRNA of mouse spleen, separately. First, we removed “DC”, “Granulocyte”, “Macrophage” and “NK” types from scATAC data, while keeping scRNA data unchanged, and denoted the integration task as ATAC unbalanced matching (“UBM-ATAC”). Second, we removed the same cell types from scRNA data, while keeping scATAC data unchanged, and denoted the integration task as RNA unbalanced matching (“UBM-RNA”). For comparison, we also defined the integration of complete mouse spleen data as balanced matching (“BM”).</p>
      <p id="Par16">uniPort accurately identified and separated the cells of “DC”, “Granulocyte”, “Macrophage” and “NK” from other cell types in the two unbalanced matching cases, while still aligning modality-shared cell types well (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a, b). We compared uniPort with GLUE, Harmony, Seurat, MultiMAP, and scMC, all of which achieved high accurate performance on the “BM” task. Among all methods, only uniPort and Seurat achieved stable performance in all three cases (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c, d). uniPort had the highest total score of 2.225 and Silhouette coefficient of 0.676, in the case of “UBM-ATAC”, and the second highest total score of 2.191 and the third highest Silhouette coefficient of 0.688, in the case of “UBM-RNA”. Therefore, compared with the case of “BM”, uniPort is more robust than the other methods when heterogeneity is presented in the datasets.<fig id="Fig4"><label>Fig. 4</label><caption><title>uniPort integrates the cell-type unbalanced mouse spleen data.</title><p><bold>a</bold> UMAP visualization of the case of “UBM-ATAC” after uniPort integration colored by omics and cell annotations. <bold>b</bold> UMAP visualization of the case of “UBM-RNA” after uniPort integration. <bold>c</bold> Comparison of total scores of ARI, NMI and F1 of different methods in the three cases. <bold>d</bold> Comparison of Batch Entropy scores and Silhouette coefficients of different methods in the three cases.</p></caption><graphic xlink:href="41467_2022_35094_Fig4_HTML" id="d32e608"/></fig></p>
    </sec>
    <sec id="Sec6">
      <title>uniPort integrates MERFISH and scRNA data</title>
      <p id="Par17">We further considered the integration of ST and scRNA data. Two main types of ST sequencing technologies are high-plex RNA imaging-based and barcoding-based. High-plex RNA imaging-based spatial sequencing has the advantage of single-cell precision with greater depth, but it is restricted to partial measurement with lower coverage. To test the performance of uniPort over high-plex RNA imaging-based data, we applied uniPort to integrate MERFISH and scRNA data<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>.</p>
      <p id="Par18">Among 155 genes in the MERFISH data, we used 153 common genes in both scRNA and MERFISH for integration. We applied UMAP to visualize the integration results of cell embeddings by uniPort, Harmony, Seurat, SCALEX, scVI, gimVI<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> and MultiMAP (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a, b and Supplementary Fig. <xref rid="MOESM1" ref-type="media">4)</xref>. As shown in the figures, uniPort and scVI outperformed other methods in identifying and separating OD Immature cells from other cell types. Besides, uniPort accurately identified ependymal cells as a MERFISH-specific cell type and separated them from other cell types in the scRNA embeddings. We again benchmarked uniPort’s integration performance against other methods<sup><xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR35">35</xref></sup> by the Silhouette coefficient and the total score (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c, d). We found that uniPort outperformed other methods with the highest Silhouette coefficient of 0.706 and the highest total score of 2.404 for ARI, NMI and F1, while scVI achieved the second highest Silhouette coefficient of 0.688, and MultiMAP ranked second in the total score of 2.37.<fig id="Fig5"><label>Fig. 5</label><caption><title>uniPort imputes MERFISH genes through scRNA data.</title><p><bold>a</bold> UMAP visualization of MERFISH and scRNA data before integration. <bold>b</bold> UMAP visualization of MERFISH and scRNA data after uniPort integration. <bold>c</bold> Comparison of Batch Entropy scores and Silhouette coefficients of different methods. <bold>d</bold> Comparison of total scores of ARI, NMI and F1 of different methods. <bold>e</bold> UMAP visualization of imputed MERFISH genes of Tangram, gimVI and uniPort. <bold>f</bold> Boxplots of average and median Pearson correlation coefficients (aPCC and mPCC) (<italic>n</italic> = 12, no statistical method was used to predetermine sample size), and average and median Spearman correlation coefficients (aSCC and mSCC) (<italic>n</italic> = 12) between real and imputed MERFISH genes. In the boxplots, the center line, box limits and whiskers denote the median, upper and lower quartiles and 1.5× interquartile range, respectively.</p></caption><graphic xlink:href="41467_2022_35094_Fig5_HTML" id="d32e687"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>uniPort imputes genes for MERFISH data</title>
      <p id="Par19">uniPort trained an encoder network to project cells with common genes across datasets into a common cell-embedding latent space and a decoder network to reconstruct cells with both common and specific genes. Therefore, once the coupled-VAE is trained well, it can be regarded as a reference atlas, in turn allowing uniPort to impute both common and specific genes in one dataset through common genes in another dataset by the atlas (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5)</xref>. The imputed genes can be used to enhance the resolution of spatial transcriptomics<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>.</p>
      <p id="Par20">To explore uniPort’s ability for gene imputation, we followed the scheme of gimVI<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> to impute missing genes in MERFISH from scRNA. To be specific, we first randomly selected 80% (i.e., 122/153) genes in MERFISH as training genes and reserved the remaining 20% (i.e., 31/153) genes as testing genes. We repeated the above steps twelve times and obtained 12 training and testing gene sets. Afterwards, we trained the uniPort network with each training gene set, and then imputed the corresponding testing gene set. We compared our results with two state-of-the-art gene-imputing methods<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>: gimVI<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> and Tangram<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. We applied uniPort, gimVI and Tangram to impute testing genes, and used UMAP to visualize both training and testing genes (Fig. <xref rid="Fig5" ref-type="fig">5</xref>e). With an imputation framework like that of gimVI, we also excepted imputed values of uniPort to carry gene-specific biases from scRNA genes<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. Therefore, for performance evaluation, we followed gimVI and reported the median and average Spearman correlation coefficients (mSCC and aSCC), as well as the median and average Pearson correlation coefficients (mPCC and aPCC) over imputed and ground truth testing genes. uniPort provided a significant improvement over the two compared methods on the MERFISH dataset. For example, uniPort separated different cell types in the UMAP visualization of imputed genes with a better result (Fig. <xref rid="Fig5" ref-type="fig">5</xref>e), and demonstrated the highest mSCC (0.259), aSCC (0.26), mPCC (0.249), and aPCC (0.294), significantly above those of gimVI (mSCC of 0.221, aSCC of 0.24, mPCC of 0.201, and aPCC of 0.242) and Tangram (mSCC of 0.188, aSCC of 0.206, mPCC of 0.202, and aPCC of 0.231) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>f).</p>
      <p id="Par21">We further explored uniPort’s ability for online imputation by training a model of scRNA and MERFISH data profiled from mouse #1, as a reference atlas, and imputing scRNA genes through MERFISH profiled from mouse #2. The result showed that the same genes in MERFISH and predicted scRNA were also significantly correlated, demonstrating the ability of uniPort to impute genes in an online manner (Supplementary Discussion <xref rid="MOESM1" ref-type="media">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6)</xref>.</p>
    </sec>
    <sec id="Sec8">
      <title>uniPort deconvolutes synthetic STARmap data</title>
      <p id="Par22">Barcoding-based ST is more accessible to transcripts and achieves higher coverage, while it is limited to the mixing spots with lower resolution<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. We next considered the deconvolution of barcoding-based ST data through transferring labels from scRNA data to spots. uniPort can provide an OT plan, which represents a cell-to-spot probabilistic correspondence between scRNA and ST data, allowing us to deconvolute the proportion of single-cell clusters for ST data according to cell annotations in scRNA data (Supplementary Method <xref rid="MOESM1" ref-type="media">2)</xref>. Here, we first applied uniPort to deconvolute synthetic STARmap data<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. To evulate performance, we benchmarked uniPort against two state-of-the-art cell-type deconvolution methods, Tangram<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> and SpaOTsc<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Tangram is a global matrix optimization method, which aims to find a mapping matrix from which to project scRNA-seq data to spots. SpaOTsc is an OT-based method that applies unbalanced and structured Gromov-Wasserstein OT to find a matching matrix between scRNA-seq data and spots.</p>
      <p id="Par23">We benchmarked the results of uniPort, Tangram, and SpaOTsc with four scores: Pearson correlation coefficient (PCC), structural similarity index (SSIM), root mean square error (RMSE), and Jensen-Shannon divergence (JSD) introduced by a recent paper that benchmarked spatial and single-cell transcriptomics integration methods<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. Higher PCC and SSIM and lower RMSE and JSD, indicate better performance. We adopted the results of Tangram and SpaOTsc directly from the benchmarking paper<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. Overall, uniPort performed competitively with the two methods: uniPort performed favorably with PCC of 0.449, RMSE of 0.157, and JSD of 0.569, which is below Tangram (PCC of 0.619, RMSE of 0.147, and JSD of 0.524) while above SpaOTsc (PCC of 0.409, RMSE of 0.197, and JSD of 0.573) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>.</p>
    </sec>
    <sec id="Sec9">
      <title>uniPort deciphers canonical structures of mouse brain</title>
      <p id="Par24">We then applied uniPort to deconvolute real-world barcoding-based ST examples. To estimate cell-type composition for each captured spot and decipher typical organizational structures, we first integrated the anterior slice of adult mouse brain ST data (10× Visium)<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>.</p>
      <p id="Par25">As clear-cut boundaries exhibited, uniPort accurately reconstructed the well-structured layers and deconvoluted 28 cell types (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a). The proportion and position of representative clusters, e.g., multiple cortical layers and region-specific cell types, are highly consistent with those of previous studies<sup><xref ref-type="bibr" rid="CR43">43</xref>,<xref ref-type="bibr" rid="CR44">44</xref></sup>. Despite the complexity of its anatomy, uniPort accurately remodeled and arranged the L2/3-L6 subclusters extending from the boundary to the central area (Fig. <xref rid="Fig6" ref-type="fig">6</xref>b). In addition, subpopulations of the L6 layer were separated with clear limits, revealing the sensitivity of our method to near-imperceptible signals. The non-neuronal neuroglia cells that provide neurons with support and protection, including astrocytes and oligodendrocytes<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, had corresponding sites paired with their marker genes (e.g., <italic>Olig1</italic> and <italic>Olig2</italic> of cluster Oligo; <italic>Atp1b2</italic> and <italic>Slc1a2</italic> of cluster Astro; <italic>Dcn</italic> and <italic>Osr1</italic> of cluster vascular and leptomeningeal cells (VLMCs)) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8)</xref>. Moreover, VLMCs that form protective sections around the pia membranes of the brain also lie in the border of the slice in harmony with anatomical structures<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. Therefore, our mapping is robust, as demonstrated by either expression of marker genes or anatomy of the brain, and can establish an agreement between gene expression-based clustering and anatomical annotation, providing a more thorough and comprehensive understanding than can be achieved through visual inspection.<fig id="Fig6"><label>Fig. 6</label><caption><title>uniPort identifies iconic structures in spatial transcriptomic data (10× Visium).</title><p><bold>a</bold> Results of mapping spatial data to single-cell data using the optimal transport plan. Spatial scatter pie plot displays the well-structured cluster composition in adult mouse brain anterior slice. <bold>b</bold> Lists of canonical cerebral cortical neuron types with scaled proportion. <bold>c</bold> Spatial deconvolution result of the HER2-positive breast cancer. <bold>d</bold> Proportion of typical clusters in tumor microenvironment. <bold>e</bold> Expression of marker genes corresponding to clusters in <bold>d</bold>. <bold>f</bold> Tertiary Lymphoid Structure (TLS) scores inferred from summing the proportion of T cells and B cells together with their colocalization.</p></caption><graphic xlink:href="41467_2022_35094_Fig6_HTML" id="d32e866"/></fig></p>
    </sec>
    <sec id="Sec10">
      <title>uniPort assists in locating TLS in breast cancer region</title>
      <p id="Par26">The genesis and progression of cancer are generally influenced by their association with the heterogeneous tumor microenvironment (TME)<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> for which ST can provide biological insights. To further demonstrate its flexible utility, we used uniPort to deconvolute spatial data of HER2-positive breast cancer, containing diffusely infiltrating cells that make it more difficult to deconvolute spots. As shown in Fig. <xref rid="Fig6" ref-type="fig">6</xref>c, nine main clusters were assigned on spatial images, primarily involving T cells and cancer epithelial cells. Moreover, we found that representative clusters scattered in their centralized enrichment region coincided with the area indicated by the expression of their marker genes (Fig. <xref rid="Fig6" ref-type="fig">6</xref>d). For example, T and B cells, which establish crucial adaptive immunity through protective immunological memory, were matched well with canonical marker genes, such as <italic>CD3D</italic> and <italic>MS4A1</italic> (Fig. <xref rid="Fig6" ref-type="fig">6</xref>d, e). Myeloid cells, as an innate part of the immune system, also displayed a distribution concordant with the expression of CD68<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. Furthermore, cancer epithelial cells protruded along the invasive ductal carcinoma region, corresponding with the expression of <italic>ERBB2</italic> as well. Overall, the above results reach concordance between pathological annotation and data-motivated labeling.</p>
      <p id="Par27">Massive research has demonstrated that an increased infiltration of immune cells is highly related to favorable breast cancer prognosis<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. TLS, a kind of ectopic lymph-like organ recently discovered at sites of tumor or inflammation, are considered as a prognostic and predictive factor for cancer patients. Although TLS are inhabited by multiple cell types, the major residents are T and B cells, implicating the TME by their joint colocalization<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>. Through decomposing cell-type proportion of each spot, we identified TLS signals via colocalization of T and B cells, rendering an identical expression intensity with T and B cells (Fig. <xref rid="Fig6" ref-type="fig">6</xref>f). In general, our approach can harmonize diverse modalities and cater to both high-resolution mapping and recognition of representative architectures across tissues and diseases.</p>
    </sec>
    <sec id="Sec11">
      <title>uniPort reveals cancer heterogeneity in microarray-based spatial data</title>
      <p id="Par28">The area of Visium-based ST data is limited to a 55 μm diameter for each captured spot, which reaches a moderate resolution that translates to 3–30 cells<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. Latent integration challenges may arise, along with the decrease of spot resolution, as an increased mix of ingredients brings more noise. To examine the performance of uniPort in this case, we employed microarray-based ST data of pancreatic ductal adenocarcinoma (PDAC) tissues for integration, the diameter of which stretches for 100 μm<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. Cell-type deconvolution was applied on 428 spots paired with 1926 single cells, measuring 19,736 genes respectively.</p>
      <p id="Par29">We decomposed 15 main clusters, which exhibit a discrete enrichment and complexity of both normal and tumor composition (Fig. <xref rid="Fig7" ref-type="fig">7</xref>a). In detail, normal pancreatic cell types were classified as ductal and acinar cells consistent with the results of previous studies<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>, preserving dramatically different distributions and genetic characteristics against those of cancer cells. As for malignant pancreatic cells, we grouped them as cancer clone A and B clusters based on genetic differences. Once again, histological annotations of normal and cancerous regions were, overall, in line with their data-driven labels (Fig. <xref rid="Fig7" ref-type="fig">7</xref>b), and essential constituents of the TME were indicated by their marker genes (Fig. <xref rid="Fig7" ref-type="fig">7</xref>c, d).<fig id="Fig7"><label>Fig. 7</label><caption><title>uniPort identifies distinct cancer subtypes in microarray-based spatial data.</title><p><bold>a</bold> Spatial deconvolution result of pancreatic ductal adenocarcinoma (PDAC). <bold>b</bold> Three manually segmented annotation of PDAC tumor cryosection on one ST slide. The red line circles the ductal epithelium region (left), and the yellow line circles the cancer region (right). <bold>c</bold> Proportion and distribution of typical clusters in PDAC. <bold>d</bold> Expression of marker genes corresponding to clusters in <bold>c</bold>. <bold>e</bold> Distribution of cancer clone subtypes. <bold>f</bold> Top enriched KEGG terms of distinct cancer subtypes. <bold>g</bold> Boxplots of significant differences of cluster composition between the cancer clone A (<italic>n</italic> = 36) and cancer clone B (<italic>n</italic> = 41) regions (two-sided <italic>t</italic>-test). In the boxplots, the center line, box limits and whiskers denote the median, upper and lower quartiles and 1.5 × interquartile range, respectively.</p></caption><graphic xlink:href="41467_2022_35094_Fig7_HTML" id="d32e983"/></fig></p>
      <p id="Par30">To gain further insight into the heterogeneity of cancer subtypes, we confirmed their identity, accounting for the maximum proportion of each spot (Fig. <xref rid="Fig7" ref-type="fig">7</xref>e). Top enrichment KEGG pathways isolated them into distinct functional assemblies (Fig. <xref rid="Fig7" ref-type="fig">7</xref>f). Cancer clone A is suspected to be an invasive phenotype attributed to the high enrichment of platelet activation and leukocyte transendothelial migration pathway. Lumps of data have proved that platelets are closely related to a high risk of metastasis in patients with pancreatic cancer<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. Furthermore, the proportion of hematogenous cells, including red blood cells (RBCs), T cells, and natural killer (NK) cells, in cancer clone A significantly increased (Fig. <xref rid="Fig7" ref-type="fig">7</xref>g), which is consistent with the results of functional analysis. Tight junction plays a critical regulatory role in the physiologic secretion of the pancreas, and its disruption contributes to the pathogenesis of progressive pancreatic cancer<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>. Furthermore, PI3K signaling can potentially modify the TME to dictate the outcome, which must be considered to have therapeutic opportunities for targeting PDAC<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>. All these beneficial signals were enriched in the cancer clone B region where endothelial cells showed a significant presence, suggesting a less malignant cluster in contrast with cancer clone A. In sum, then, our method can manipulate an extensive application spectrum of varying resolutions, revealing the subtle heterogeneous TME.</p>
    </sec>
  </sec>
  <sec id="Sec12" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par31">We introduce a unified deep learning method named uniPort for single-cell data integration and apply it to integrate transcriptomic, epigenomic, spatially resolved high-plex RNA imaging- and barcoding-based single-cell genomics. uniPort combines a coupled-VAE and Minibatch-UOT and leverages both highly variable common and dataset-specific genes for integration. It is a nonlinear method that projects all datasets into a common latent space and outputs their latent representations between datasets, enabling both visualization and downstream analysis.</p>
    <p id="Par32">Generally, uniPort tackles several computational challenges, starting with removing the constraint of paired cells required by other autoencoder-based models by the employment of Minibatch-UOT. Different from existing methods that only consider common genes across datasets, we also take advantage of genes unique to each dataset, typically capturing cell-type heterogeneity not present in common genes (Supplementary Discussion <xref rid="MOESM1" ref-type="media">2</xref> and Supplementary Figs. <xref rid="MOESM1" ref-type="media">9</xref>, <xref rid="MOESM1" ref-type="media">10)</xref>. Besides, uniPort shows its power and potential for gene imputation by constructing a reference atlas owing to the generalization ability of coupled-VAE. It is relevant to point out that uniPort can even impute unique genes in one dataset through common genes in another dataset without having to train from scratch. Moreover, uniPort can output an OT plan for downstream analysis, such as flexible label transfer learning, for deconvolution of spatial heterogeneous data.</p>
    <p id="Par33">Although many mechanisms are involved, uniPort is still computationally efficient and scalable to integrate large-scale and heterogeneous datasets, which could be computationally prohibitive for other OT-based methods. To the best of our knowledge, prevalent OT-based methods for single-cell analysis are based on global optimal transport, e.g., SCOT<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> and Pamona<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> for single-cell multi-omics data integration, SpaOTsc<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> and novoSpaRc<sup><xref ref-type="bibr" rid="CR56">56</xref></sup> for spatial positions reconstruction, and Waddington-OT<sup><xref ref-type="bibr" rid="CR57">57</xref></sup> for trajectory inference. Global optimal transport makes the computation very expensive. To resolve this drawback, our uniPort introduces a Minibatch-UOT into a VAE-based framework for single-cell genomics analysis, which only needs to solve a mini-batch transport plan at each iteration, thus significantly reducing the computational cost. Therefore, it is scalable to large datasets (Supplementary Discussion <xref rid="MOESM1" ref-type="media">3</xref>, Supplementary Figs. <xref rid="MOESM1" ref-type="media">11</xref> and <xref rid="MOESM1" ref-type="media">12)</xref>. Additionally, in general, our coupled-VAE and Minibatch-UOT-based uniPort is more accurate than other OT-based methods, such as SCOT, Pamona, and SpaOTsc in different tasks.</p>
    <p id="Par34">Given that our integration of scATAC is based on gene activity score, we also tested uniPort’s performance when gene activity score is calculated in different approaches. We employed two methods to form the gene activity score introduced by Signac<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> and MAESTRO<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, respectively. Signac defines gene activity score for scATAC as the read count in the gene body and promoter region. MAESTRO calculates gene activity score as a weighted sum of nearby cis-regulatory elements (REs), where the weight is an exponentially decreasing function of distances of REs and target genes. The integration result showed that uniPort achieved better performance on the gene activity score by MAESTRO with all evaluated scores higher than that by Signac (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13)</xref>, which demonstrated the importance of modeling the gene activity score. It is worth noting that, GLUE<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, which is developed based on a sophisticated knowledge-based graph that explicitly and accurately models regulatory signals of scATAC, instead of using gene activity score, provides an important technique for analyzing scATAC data.</p>
    <p id="Par35">We demonstrate that uniPort consistently performs favorably when compared with recently published state-of-the-art methods, and successfully deconvolutes spatial heterogeneous data using the OT plan. With the rapid development of paired datasets and various heterogeneous modalities, we also demonstrate the generalizability of uniPort to other types of single-cell data by integrating paired datasets using CITE-seq data<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup> and SNARE-seq data<sup><xref ref-type="bibr" rid="CR59">59</xref></sup> (Supplementary Discussion <xref rid="MOESM1" ref-type="media">4</xref>, Supplementary Figs. <xref rid="MOESM1" ref-type="media">14</xref>, <xref rid="MOESM1" ref-type="media">15)</xref> or datasets without aligned common genes (Supplementary Discussion <xref rid="MOESM1" ref-type="media">5</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16</xref>b). With no inherent reliance on any prior information, our framework offers the flexibility necessary to match prior information, e.g., cell-type annotations or cell-cell correspondence, when available (Supplementary Method <xref rid="MOESM1" ref-type="media">3</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">16</xref>c). We will keep updating and improving the framework in anticipation that uniPort will find a wide range of applications in the area of integrative single-cell multi-omics data analysis.</p>
  </sec>
  <sec id="Sec13">
    <title>Methods</title>
    <sec id="Sec14">
      <title>uniPort framework</title>
      <p id="Par36">uniPort inputs each dataset though a coupled variational autoencoder (coupled-VAE) framework and learns its <italic>K</italic>-dimensional features. Given a sample <bold>x</bold>, the corresponding <italic>K</italic>-dimensional latent vector <bold>z</bold> can be obtained by a variational posterior <italic>p</italic>(<bold>z</bold>∣<bold>x</bold>) approximated by a probabilistic encoder <italic>ψ</italic>(<bold>z</bold>∣<bold>x</bold>). Conversely, a probabilistic decoder <italic>ϕ</italic>(<bold>x</bold>∣<bold>z</bold>) produces a distribution over the possible corresponding values of <bold>x</bold> given <bold>z</bold>. The coupled-VAE jointly learns <italic>ψ</italic> and <italic>ϕ</italic> to maximize the evidence lower bound (ELBO) with a balanced parameter <italic>λ</italic>:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{\rm{ELBO}}}}}}}}}={{\mathbb{E}}}_{\psi ({{{{{{{\bf{z}}}}}}}}|{{{{{{{\bf{x}}}}}}}})}[\log \phi ({{{{{{{\bf{x}}}}}}}}|{{{{{{{\bf{z}}}}}}}})]-\lambda {D}_{{{{{{{{\rm{KL}}}}}}}}}(\psi ({{{{{{{\bf{z}}}}}}}}|{{{{{{{\bf{x}}}}}}}})\parallel p({{{{{{{\bf{z}}}}}}}})).$$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ELBO</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mi>ϕ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∥</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par37">The ELBO consists of a reconstruction term that encourages the output data to be similar to the input data, in addition to a Kullback-Leibeler divergence regularization term which regularizes the variational posterior to follow the prior distribution <italic>p</italic>(<bold>z</bold>). We set the prior distribution to be the centered isotropic multivariate Gaussian <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p({{{{{{{\bf{z}}}}}}}})={{{{{{{\mathcal{N}}}}}}}}({{{{{{{\bf{z}}}}}}}};{{{{{{{\bf{0}}}}}}}},\,{{{{{{{\bf{I}}}}}}}})$$\end{document}</tex-math><mml:math id="M4"><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="bold">0</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq1.gif"/></alternatives></inline-formula> and the variational posterior to be a multivariate Gaussian with a diagonal covariance structure <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\psi ({{{{{{{\bf{z}}}}}}}}|{{{{{{{\bf{x}}}}}}}})={{{{{{{\mathcal{N}}}}}}}}({{{{{{{\bf{z}}}}}}}};\,{{{{{{{\boldsymbol{\mu }}}}}}}},\,{{{{{{{{\boldsymbol{\sigma }}}}}}}}}^{2}{{{{{{{\bf{I}}}}}}}})$$\end{document}</tex-math><mml:math id="M6"><mml:mi>ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>;</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq2.gif"/></alternatives></inline-formula>, where the mean vector <bold><italic>μ</italic></bold> and standard deviation vector <bold><italic>σ</italic></bold> are outputs of the encoder. Then, the latent vector <bold>z</bold> can be obtained through reparameterization by <bold>z</bold> = <bold><italic>μ</italic></bold> + <bold><italic>σ</italic></bold> × <italic>ν</italic>, where <italic>ν</italic> is sampled from <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{N}}}}}}}}({{{{{{{\bf{0}}}}}}}},\,{{{{{{{\bf{I}}}}}}}})$$\end{document}</tex-math><mml:math id="M8"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">0</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq3.gif"/></alternatives></inline-formula>.</p>
      <p id="Par38">Here, we formulate our method for the case of two datasets, while it can be easily generated for cases of multiple single-cell datasets. Suppose there are two single-cell datasets <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{X}}}}}}}}=\{{{{{{{{{\bf{x}}}}}}}}}_{1},\ldots,\,{{{{{{{{\bf{x}}}}}}}}}_{{n}_{x}}\}$$\end{document}</tex-math><mml:math id="M10"><mml:mi mathvariant="bold">X</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq4.gif"/></alternatives></inline-formula> with <italic>n</italic><sub><italic>x</italic></sub> cells and <italic>d</italic><sub><italic>x</italic></sub> genes, and <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{Y}}}}}}}}=\{{{{{{{{{\bf{y}}}}}}}}}_{1},\ldots,\,{{{{{{{{\bf{y}}}}}}}}}_{{n}_{y}}\}$$\end{document}</tex-math><mml:math id="M12"><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq5.gif"/></alternatives></inline-formula> with <italic>n</italic><sub><italic>y</italic></sub> cells and <italic>d</italic><sub><italic>y</italic></sub> genes. We first select the top <italic>k</italic> highly variable common genes in both datasets to form <bold>X</bold><sup><italic>c</italic></sup> and <bold>Y</bold><sup><italic>c</italic></sup>, and the top <italic>k</italic><sub><italic>x</italic></sub> and <italic>k</italic><sub><italic>y</italic></sub> highly variable genes in <bold>X</bold> and <bold>Y</bold> to form <bold>X</bold><sup><italic>s</italic></sup> and <bold>Y</bold><sup><italic>s</italic></sup>, individually. We project both <bold>X</bold><sup><italic>c</italic></sup> and <bold>Y</bold><sup><italic>c</italic></sup> into a generalized cell-embedding latent space using a dataset-free probabilistic encoder <italic>ψ</italic> and a decoder <italic>ϕ</italic> with two Dataset-Specific Batch Normalization (DSBN) layers<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> corresponding to two modalities. Then, to leverage the information of dataset-specific highly variable genes, we also introduce two decoders, <italic>ϕ</italic><sub><italic>x</italic></sub> and <italic>ϕ</italic><sub><italic>y</italic></sub>, to reconstruct <bold>X</bold><sup><italic>s</italic></sup> and <bold>Y</bold><sup><italic>s</italic></sup> from the latent variables, as well. Overall, the modified ELBO<sup>*</sup> loss for coupled-VAE is given by<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{{\rm{ELBO}}}}}}}}}^{*}}=	{{\mathbb{E}}}_{\psi ({{{{{{{\bf{z}}}}}}}}|{{{{{{{\bf{x}}}}}}}})}\left\{\log \phi ({{{{{{{\bf{x}}}}}}}}|{{{{{{{\bf{z}}}}}}}})+{\lambda }_{s}\left(\log {\phi }_{x}({{{{{{{{\bf{x}}}}}}}}}^{s}|{{{{{{{\bf{z}}}}}}}})+\log {\phi }_{y}({{{{{{{{\bf{y}}}}}}}}}^{s}|{{{{{{{\bf{z}}}}}}}})\right)\right\}\\ 	 -\lambda {D}_{{{{{{{{\rm{KL}}}}}}}}}(\psi ({{{{{{{\bf{z}}}}}}}}|{{{{{{{\bf{x}}}}}}}})\parallel p({{{{{{{\bf{z}}}}}}}})),$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">ELBO</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mi>ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mfenced close="}" open="{"><mml:mrow><mml:mi>log</mml:mi><mml:mi>ϕ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="("><mml:mrow><mml:mi>log</mml:mi><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>log</mml:mi><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">KL</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∥</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>where <bold>x</bold> ∈ <bold>X</bold><sup><italic>c</italic></sup> ∪ <bold>Y</bold><sup><italic>c</italic></sup>, <bold>x</bold><sup><italic>s</italic></sup> ∈ <bold>X</bold><sup><italic>s</italic></sup>, <bold>y</bold><sup><italic>s</italic></sup> ∈ <bold>Y</bold><sup><italic>s</italic></sup>, and <italic>λ</italic><sub><italic>s</italic></sub>, <italic>λ</italic> are balanced parameters. To better integrate heterogeneous single-cell datasets in the latent space, we design an alignment term for different datasets using Minibatch Unbalanced Optimal Transport (Minibatch-UOT)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. uniPort computes the Minibatch-UOT loss between datasets <bold>X</bold> and <bold>Y</bold> described as follows. For two <italic>K</italic>-dimensional Gaussian distributions <inline-formula id="IEq6"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{{x}_{i}}={{{{{{{\mathcal{N}}}}}}}}({{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{x}_{i}},\,{{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{x}_{i}}^{2}{{{{{{{\bf{I}}}}}}}})$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq6.gif"/></alternatives></inline-formula> and <inline-formula id="IEq7"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{{y}_{j}}={{{{{{{\mathcal{N}}}}}}}}({{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{y}_{j}},\,{{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{y}_{j}}^{2}{{{{{{{\bf{I}}}}}}}})$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq7.gif"/></alternatives></inline-formula> corresponding to cell <bold>x</bold><sub><italic>i</italic></sub> and <bold>y</bold><sub><italic>j</italic></sub>, where <inline-formula id="IEq8"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{x}_{i}},\,{{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{y}_{j}}\in {{\mathbb{R}}}^{K}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq8.gif"/></alternatives></inline-formula> and <inline-formula id="IEq9"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{x}_{i}},\,{{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{y}_{j}}\in {{\mathbb{R}}}_{+}^{K}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq9.gif"/></alternatives></inline-formula> represent the output mean and standard deviation vectors by encoder <italic>ψ</italic>, respectively, the Minibatch-UOT cost between cell <bold>x</bold><sub><italic>i</italic></sub> and <bold>y</bold><sub><italic>j</italic></sub> is defined as (Supplementary Method <xref rid="MOESM1" ref-type="media">1)</xref>:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{C}}}}}}}}}_{ij}=\parallel \!{{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{x}_{i}}-{{{{{{{{\boldsymbol{\mu }}}}}}}}}_{{y}_{j}}{\!\parallel }^{2}+\parallel \!{{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{x}_{i}}-{{{{{{{{\boldsymbol{\sigma }}}}}}}}}_{{y}_{j}}{\parallel }^{2}.$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>∥</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mspace width="0.3em"/><mml:mo>∥</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo>∥</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>∥</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par39">We then compute the following optimal Minibatch-UOT plan<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> with batch size <italic>B</italic><sub><italic>x</italic></sub> and <italic>B</italic><sub><italic>y</italic></sub>:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}^{*}=\mathop{{{{{{{{\rm{argmin}}}}}}}}}\limits_{{{{{{{{\bf{T}}}}}}}}\in {{\mathbb{R}}}_{+}^{{B}_{x}\times {B}_{y}}} &lt; \,{{{{{{{\bf{C}}}}}}}},\,{{{{{{{\bf{T}}}}}}}} \, &gt; -\epsilon H({{{{{{{\bf{T}}}}}}}})+\rho {D}_{KL}({{{{{{{\bf{T}}}}}}}}{{{{{{{{\bf{1}}}}}}}}}_{{B}_{y}}\!\parallel \!{{{{{{{\bf{a}}}}}}}})+\rho {D}_{KL}({{{{{{{{\bf{T}}}}}}}}}^{\top }{{{{{{{{\bf{1}}}}}}}}}_{{B}_{x}}\!\parallel \!{{{{{{{\bf{b}}}}}}}}),$$\end{document}</tex-math><mml:math id="M26"><mml:msup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">T</mml:mi><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:munder><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold">C</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold">T</mml:mi><mml:mspace width="0.25em"/><mml:mo>&gt;</mml:mo><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">T</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mo>∥</mml:mo><mml:mspace width="0.3em"/><mml:mi mathvariant="bold">a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mo>∥</mml:mo><mml:mspace width="0.3em"/><mml:mi mathvariant="bold">b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where &lt; <bold>C</bold>, <bold>T</bold> &gt; = ∑<sub><italic>i</italic>,<italic>j</italic></sub><bold>C</bold><sub><italic>i</italic><italic>j</italic></sub><bold>T</bold><sub><italic>i</italic><italic>j</italic></sub>, entropy regularization term <inline-formula id="IEq10"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H({{{{{{{\bf{T}}}}}}}})= -{\sum }_{i,j}{{{{{{{{\bf{T}}}}}}}}}_{ij}(\log {{{{{{{{\bf{T}}}}}}}}}_{ij}-1)$$\end{document}</tex-math><mml:math id="M28"><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq10.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq11"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{a}}}}}}}}=\frac{1}{{B}_{x}}{{{{{{{{\bf{1}}}}}}}}}_{{B}_{x}},\,{{{{{{{\bf{b}}}}}}}}=\frac{1}{{B}_{y}}{{{{{{{{\bf{1}}}}}}}}}_{{B}_{y}}$$\end{document}</tex-math><mml:math id="M30"><mml:mi mathvariant="bold">a</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi mathvariant="bold">b</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq11.gif"/></alternatives></inline-formula>. <italic>ϵ</italic> and <italic>ρ</italic> are balanced parameters. We set <italic>ρ</italic> = 1 for all experiments in this paper, but uniPort is robust to different choices of <italic>ρ</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17</xref>c). Eq. (<xref rid="Equ4" ref-type="">4</xref>) is a strictly convex optimization problem and can be solved via an efficient inexact proximal point method (IPOT)<sup><xref ref-type="bibr" rid="CR60">60</xref></sup> as<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\boldsymbol{\alpha }}}}}}}}}^{(l+1)}={\left(\frac{{{{{{{{\bf{a}}}}}}}}}{{{{{{{{\bf{G}}}}}}}}{{{{{{{{\boldsymbol{\beta }}}}}}}}}^{(l)}}\right)}^{\frac{\rho }{\rho+\epsilon }},\,{{{{{{{{\boldsymbol{\beta }}}}}}}}}^{(l+1)}={\left(\frac{{{{{{{{\bf{b}}}}}}}}}{{{{{{{{{\bf{G}}}}}}}}}^{\top }{{{{{{{{\boldsymbol{\alpha }}}}}}}}}^{(l)}}\right)}^{\frac{\rho }{\rho+\epsilon }},$$\end{document}</tex-math><mml:math id="M32"><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">G</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">α</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>starting from <inline-formula id="IEq12"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\boldsymbol{\beta }}}}}}}}}^{(0)}=\frac{1}{{B}_{x}}{{{{{{{{\bf{1}}}}}}}}}_{{B}_{x}}$$\end{document}</tex-math><mml:math id="M34"><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq12.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq13"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{G}}}}}}}}}_{ij}={{{{{{{{\bf{T}}}}}}}}}_{ij}^{(l)}{e}^{-{{{{{{{{\bf{C}}}}}}}}}_{ij}/\epsilon }$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq13.gif"/></alternatives></inline-formula>. The optimal Minibatch-UOT plan <inline-formula id="IEq14"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}_{ij}^{*}={\alpha }_{i}{{{{{{{{\bf{G}}}}}}}}}_{ij}{\beta }_{j}$$\end{document}</tex-math><mml:math id="M38"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq14.gif"/></alternatives></inline-formula>. Therefore, the Minibatch-UOT loss is given by<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{{\rm{UOT}}}}}}}}}^{*}}=\mathop{\sum}\limits_{i,j}{{{{{{{{\bf{C}}}}}}}}}_{ij}\times {{{{{{{{\bf{T}}}}}}}}}_{ij}^{*}.$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">UOT</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par40">The total loss function minimized by uniPort is formulated as<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{\rm{uniPort}}}}}}}}}=-\!{{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{{\rm{ELBO}}}}}}}}}^{*}}+\gamma {{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{{\rm{UOT}}}}}}}}}^{*}}.$$\end{document}</tex-math><mml:math id="M42"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">uniPort</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">ELBO</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">UOT</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">Once <bold>T</bold><sup>*</sup> is obtained, we provide users an option to output an OT plan <bold>T</bold> for tasks which need cell-to-cell probabilistic correspondence. Specifically, we first initialize <inline-formula id="IEq15"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{T}}}}}}}}=\frac{1}{{n}_{x}{n}_{y}}{{{{{{{{\bf{1}}}}}}}}}_{{n}_{x}{n}_{y}}$$\end{document}</tex-math><mml:math id="M44"><mml:mi mathvariant="bold">T</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq15.gif"/></alternatives></inline-formula>. After each calculation of optimal Minibatch-UOT plan <bold>T</bold><sup>*</sup>, we update <bold>T</bold> by replacing rows and columns by <bold>T</bold><sup>*</sup> which is sampled by the minibatch strategy. Note that storing a dense matrix <bold>T</bold> needs more memory. Therefore, computing capacity with respect to memory should be ascertained before using this option. We also provide an option for user-guided sample weights if cells are not uniformly matched. In this case, we set vectors <bold>a</bold> and <bold>b</bold> in Minibatch-UOT as weighted vectors specified by users, instead of uniform vectors (Supplementary Method <xref rid="MOESM1" ref-type="media">4)</xref>.</p>
    </sec>
    <sec id="Sec15">
      <title>uniPort algorithm</title>
      <p id="Par42">uniPort integrates two single-cell datasets <inline-formula id="IEq16"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{X}}}}}}}}=\{{{{{{{{{\bf{x}}}}}}}}}_{1},\ldots,{{{{{{{{\bf{x}}}}}}}}}_{{n}_{x}}\}$$\end{document}</tex-math><mml:math id="M46"><mml:mi mathvariant="bold">X</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq16.gif"/></alternatives></inline-formula> and <inline-formula id="IEq17"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{Y}}}}}}}}=\{{{{{{{{{\bf{y}}}}}}}}}_{1},\ldots,{{{{{{{{\bf{y}}}}}}}}}_{{n}_{y}}\}$$\end{document}</tex-math><mml:math id="M48"><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq17.gif"/></alternatives></inline-formula>.</p>
      <p id="Par43"><bold>Input:</bold> the top <italic>k</italic> highly variable common genes in <bold>X</bold> and <bold>Y</bold>, formulated as <bold>X</bold><sup><italic>c</italic></sup> and <bold>Y</bold><sup><italic>c</italic></sup>, top <italic>k</italic><sub><italic>x</italic></sub> and <italic>k</italic><sub><italic>y</italic></sub> highly variable genes in <bold>X</bold> and <bold>Y</bold>, formulated as <bold>X</bold><sup><italic>s</italic></sup> and <bold>Y</bold><sup><italic>s</italic></sup>.</p>
      <p id="Par44"><bold>Output:</bold> aligned latent vectors <bold>z</bold><sub><italic>x</italic></sub> and <bold>z</bold><sub><italic>y</italic></sub>, and an optimal transport plan <bold>T</bold>.</p>
      <p id="Par45">uniPort performs the following steps:<list list-type="order"><list-item><p id="Par46">Initialize coupled-VAE encoder <italic>ψ</italic> and decoders <italic>ϕ</italic>, <italic>ϕ</italic><sub><italic>x</italic></sub>, <italic>ϕ</italic><sub><italic>y</italic></sub>, and an OT plan <inline-formula id="IEq18"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{T}}}}}}}}=\frac{1}{{n}_{x}{n}_{y}}{{{{{{{{\bf{1}}}}}}}}}_{{n}_{x}{n}_{y}}$$\end{document}</tex-math><mml:math id="M50"><mml:mi mathvariant="bold">T</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq18.gif"/></alternatives></inline-formula> (optional).</p></list-item><list-item><p id="Par47">For <italic>m</italic> ← 1, ⋯  , <italic>M</italic> do the following <list list-type="alpha-lower"><list-item><p id="Par48">Randomly sample an integer index set <inline-formula id="IEq19"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{I}}}}}}}}=({i}_{1},\cdots \,,{i}_{{B}_{x}})\in {[\![ {n}_{x}]\!] }^{{B}_{x}}$$\end{document}</tex-math><mml:math id="M52"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mspace width="0.25em"/><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mspace width="0.3em"/><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq19.gif"/></alternatives></inline-formula> for dataset <bold>X</bold> and <inline-formula id="IEq20"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{J}}}}}}}}=({j}_{1},\cdots \,,{j}_{{B}_{y}}) \in [\![ {n}_{y}]\!] {\,\!}^{{B}_{y}}$$\end{document}</tex-math><mml:math id="M54"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mspace width="0.25em"/><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mspace width="0.3em"/><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq20.gif"/></alternatives></inline-formula> for dataset <bold>Y</bold> without replacement, respectively.</p></list-item><list-item><p id="Par49">Initialize Minibatch-UOT plan <inline-formula id="IEq21"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}_{B}\in {{\mathbb{R}}}^{{B}_{x}\! \times \!{B}_{y}}$$\end{document}</tex-math><mml:math id="M56"><mml:msub><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mo>×</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq21.gif"/></alternatives></inline-formula> by sampling rows and columns of <bold>T</bold>, corresponding to <inline-formula id="IEq22"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{I}}}}}}}}$$\end{document}</tex-math><mml:math id="M58"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq22.gif"/></alternatives></inline-formula> and <inline-formula id="IEq23"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{J}}}}}}}}$$\end{document}</tex-math><mml:math id="M60"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq23.gif"/></alternatives></inline-formula>, or uniform distribution when <bold>T</bold> is not specified.</p></list-item><list-item><p id="Par50">Input both <inline-formula id="IEq24"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{X}}}}}}}}}_{{{{{{{{\mathcal{I}}}}}}}}}^{c}$$\end{document}</tex-math><mml:math id="M62"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq24.gif"/></alternatives></inline-formula> and <inline-formula id="IEq25"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\mathcal{J}}}}}}}}}^{c}$$\end{document}</tex-math><mml:math id="M64"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq25.gif"/></alternatives></inline-formula> through the shared probabilistic encoder <italic>ψ</italic> to obtain (<bold><italic>μ</italic></bold><sub><italic>x</italic></sub>, <bold><italic>σ</italic></bold><sub><italic>x</italic></sub>) and (<bold><italic>μ</italic></bold><sub><italic>y</italic></sub>, <bold><italic>σ</italic></bold><sub><italic>y</italic></sub>), and then reparameterize <bold>z</bold><sub><italic>x</italic></sub> and <bold>z</bold><sub><italic>y</italic></sub> by <bold>z</bold><sub><italic>x</italic></sub> = <bold><italic>μ</italic></bold><sub><italic>x</italic></sub> + <bold><italic>σ</italic></bold><sub><italic>x</italic></sub> × <italic>ν</italic> and <bold>z</bold><sub><italic>y</italic></sub> = <bold><italic>μ</italic></bold><sub><italic>y</italic></sub> + <bold><italic>σ</italic></bold><sub><italic>y</italic></sub> × <italic>ν</italic>;</p></list-item><list-item><p id="Par51">Reconstruct <inline-formula id="IEq26"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{{{{{{{{\bf{X}}}}}}}}}}_{{{{{{{{\mathcal{I}}}}}}}}}^{c}$$\end{document}</tex-math><mml:math id="M66"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq26.gif"/></alternatives></inline-formula> and <inline-formula id="IEq27"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{{{{{{{{\bf{Y}}}}}}}}}}_{{{{{{{{\mathcal{J}}}}}}}}}^{c}$$\end{document}</tex-math><mml:math id="M68"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq27.gif"/></alternatives></inline-formula> by decoder <italic>ϕ</italic>, and <inline-formula id="IEq28"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{{{{{{{{\bf{X}}}}}}}}}}_{{{{{{{{\mathcal{I}}}}}}}}}^{s}$$\end{document}</tex-math><mml:math id="M70"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq28.gif"/></alternatives></inline-formula> and <inline-formula id="IEq29"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{{{{{{{{\bf{Y}}}}}}}}}}_{{{{{{{{\mathcal{J}}}}}}}}}^{s}$$\end{document}</tex-math><mml:math id="M72"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq29.gif"/></alternatives></inline-formula> by decoders <italic>ϕ</italic><sub><italic>x</italic></sub> and <italic>ϕ</italic><sub><italic>y</italic></sub>, from <bold>z</bold><sub><italic>x</italic></sub> and <bold>z</bold><sub><italic>y</italic></sub>.</p></list-item><list-item><p id="Par52">Compute minibatch transport cost <bold>C</bold> via Eq. (<xref rid="Equ3" ref-type="">3</xref>) and obtain optimal Minibatch-UOT plan <inline-formula id="IEq30"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}_{B}^{*}$$\end{document}</tex-math><mml:math id="M74"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq30.gif"/></alternatives></inline-formula> via Eq. (<xref rid="Equ4" ref-type="">4</xref>).</p></list-item><list-item><p id="Par53">Fix <inline-formula id="IEq31"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}_{B}^{*}$$\end{document}</tex-math><mml:math id="M76"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq31.gif"/></alternatives></inline-formula> and update <italic>ψ</italic>, <italic>ϕ</italic>, <italic>ϕ</italic><sub><italic>x</italic></sub> and <italic>ϕ</italic><sub><italic>y</italic></sub> through back propagation via minimizing <inline-formula id="IEq32"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{\rm{UOT*}}}}}}}}}$$\end{document}</tex-math><mml:math id="M78"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">UOT*</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq32.gif"/></alternatives></inline-formula> and <inline-formula id="IEq33"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-{{{{{{{{\mathcal{L}}}}}}}}}_{{{{{{{{\rm{ELBO*}}}}}}}}}$$\end{document}</tex-math><mml:math id="M80"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ELBO*</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq33.gif"/></alternatives></inline-formula>.</p></list-item><list-item><p id="Par54">Update <bold>T</bold> with rows and columns as <inline-formula id="IEq34"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\bf{T}}}}}}}}}_{B}^{*}$$\end{document}</tex-math><mml:math id="M82"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq34.gif"/></alternatives></inline-formula>, corresponding to <inline-formula id="IEq35"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{I}}}}}}}}$$\end{document}</tex-math><mml:math id="M84"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">I</mml:mi></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq35.gif"/></alternatives></inline-formula> and <inline-formula id="IEq36"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{J}}}}}}}}$$\end{document}</tex-math><mml:math id="M86"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">J</mml:mi></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq36.gif"/></alternatives></inline-formula> (optional).</p></list-item></list></p></list-item></list></p>
    </sec>
    <sec id="Sec16">
      <title>Training details</title>
      <p id="Par55">uniPort consists of one encoder and three decoders for the integration of two datasets. The encoder is a two-layer neural network (1024–128) with the ReLU activation function. The decoders have no hidden layer, but directly connect the 16-dimensional latent variables to the output layers with the <italic>Sigmoid</italic> activation function. The <italic>Adam</italic> optimizer with a 5e-4 weight decay is used to maximize the ELBO. Minibatch size is 256. We set all the training with learning rate to 2e-4 and optimal transport entropy regularization parameter <italic>ϵ</italic> to 0.1. We chose parameters for training coupled-VAE and Minibatch-UOT from <italic>λ</italic> ∈ {0.5, 1.0, 5.0}, <italic>γ</italic> ∈ {0.5, 1.0}, and <italic>λ</italic><sub><italic>s</italic></sub> ∈ {0.5, 1.0} for all datasets. uniPort is robust to different choices of <italic>λ</italic>, <italic>λ</italic><sub><italic>s</italic></sub> and <italic>γ</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17</xref>a). It is also robust to the number of selected common and dataset-specific highly variable genes (HVGs) within a certain range (Supplementary Discussion <xref rid="MOESM1" ref-type="media">6</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">17</xref>b). The default maximum number of training iterations is 30,000, and an early stopping is triggered when no improvement has occurred for 30 epochs. Our experimental environment includes two AMD EPYC 7302 16-Core Processors, 128GB DDR4 memory, and a Tesla T4 NVIDIA GPU with 16GB memory.</p>
    </sec>
    <sec id="Sec17">
      <title>Data preprocessing</title>
      <p id="Par56">
        <list list-type="bullet">
          <list-item>
            <p id="Par57"><bold>Human PBMC multi-omics dataset</bold>. The paired multi-omics PBMC dataset measuring both DNA accessibility and gene expression data were downloaded from the publicly available 10× Genomic datasets<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. The raw gene expression data were processed using the Seurat package (v4.1.0)<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>. Cells and genes were filtered under default parameters. SCTransform was used for normalization. For paired scATAC-seq data, the fragment files were qualified using Signac (v1.5.0)<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> under default parameters. Peaks were called with MACS2<sup><xref ref-type="bibr" rid="CR61">61</xref></sup>. Then latent semantic indexing (LSI) was used for dimensionality reduction, resulting in the binary cell-by-bin accessibility as input for TF-IDF weighting. Consequent dimensionality reduction used Singular Value Decomposition (SVD). The gene activity count matrices were derived using MAESTRO<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. Cell types were arranged by transferring labels from an annotated PBMC reference dataset<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> using Seurat. Finally, 11,259 cells with 28,307 features in scATAC and 11,942 genes in scRNA were used for the integrative analysis.</p>
          </list-item>
          <list-item>
            <p id="Par58"><bold>microfluidic-based PBMC dataset</bold>. The unpaired microfluidic-based PBMC dataset was obtained from MAESTRO<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, including 1919 cells with 28307 genes in gene activity score of scATAC and 1985 cells with 1477 genes in scRNA. The gene activity score was processed by MAESTRO.</p>
          </list-item>
          <list-item>
            <p id="Par59"><bold>Mouse spleen dataset</bold>. The processed and annotated scRNA data of mouse spleen was directly obtained from MultiMAP<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, containing 4382 cells with 13,575 genes. The gene activity score of scATAC<sup><xref ref-type="bibr" rid="CR62">62</xref></sup> was processed by SnapATAC<sup><xref ref-type="bibr" rid="CR63">63</xref></sup>, containing 3166 cells across 19,410 genes.</p>
          </list-item>
          <list-item>
            <p id="Par60"><bold>Synthetic STARmap dataset</bold>. The synthetic STARmap dataset was obtained from the benchmarking paper<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>, containing 14249 cells with 34041 genes in scRNA data and 189 cells with 882 genes in the spot data.</p>
          </list-item>
          <list-item>
            <p id="Par61"><bold>Brain scRNA and MERFISH dataset</bold>. The scRNA-seq (10×) dataset from the preoptic region of the hypothalamus in six mice was obtained from NCBI GEO accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE113576">GSE113576</ext-link><sup><xref ref-type="bibr" rid="CR64">64</xref></sup>. The MERFISH data and annotations were downloaded from Dryad repositories [<ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.8t8s248">https://datadryad.org/stash/dataset/doi:10.5061/dryad.8t8s248</ext-link>]. Naive female mouse #1 in the MERFISH data was chosen for integration, and the mouse #2 was extracted to validate the result of online imputation. All cells labeled as ‘Ambiguous’ or ‘Unstable’ were removed from both datasets. scRNA data were qualified and processed using Seurat as above.</p>
          </list-item>
          <list-item>
            <p id="Par62"><bold>10</bold>× <bold>Visium dataset and reference</bold>. The series of 10× Visium spatial datasets, including sagittal mouse brain slice (2696 spots with 48,721 genes) and human breast cancer (2518 spots with 17,943 genes), were obtained from 10× Genomic datasets<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. Spaceranger outputs were obtained and processed with Seurat to generate the standard gene expression matrix. For the mouse brain dataset, the annotated scRNA dataset from adult mouse cortical cell taxonomy from the Allen Institute was chosen as reference, and the subset used was extracted from SPOTlight tutorial<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. The processed and labeled scRNA reference for breast cancer slice came from<sup><xref ref-type="bibr" rid="CR65">65</xref></sup>.</p>
          </list-item>
          <list-item>
            <p id="Par63"><bold>Pancreatic ductal adenocarcinoma dataset</bold>. The microarray-based spatial transcriptomic dataset of pancreatic ductal adenocarcinoma (PDAC) was acquired from NCBI GEO accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111672">GSE111672</ext-link><sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. The spatial dataset of batch A was adopted together with scRNA-seq generated from the same sample. Cell types in the scRNA reference had already been assigned. These two expression profiles were set as input for uniPort.</p>
          </list-item>
          <list-item>
            <p id="Par64"><bold>uniPort preprocessing steps</bold>. uniPort preprocessed data as follows: (1) We filtered out cells with fewer than 200 genes and filtered out genes observed in fewer than 3 cells for PBMC data. No cells or genes were filtered out for other data. (2) We normalized total counts of each cell using the <italic>scanpy.pp.normalize_total</italic> function in the scanpy package<sup><xref ref-type="bibr" rid="CR66">66</xref></sup> in Python. (3) We performed log-normalization of all datasets with an offset of 1 using the <italic>scanpy.pp.log1p</italic> function. (4) We identified <italic>k</italic> = 2000 highly variable common genes across cells of all datasets, and identified <italic>k</italic><sub><italic>x</italic></sub> = <italic>k</italic><sub><italic>y</italic></sub> = 2000 highly variable genes for each dataset using <italic>sc.pp.highly_variable_genes</italic> function, respectively. (5) We normalized values of each gene to the range of 0-1 within each dataset by the <italic>MaxAbsScaler</italic> function in the <italic>scikit-learn</italic> package in Python. The processed matrix was used as input for uniPort.</p>
          </list-item>
        </list>
      </p>
    </sec>
    <sec id="Sec18">
      <title>Settings used in comparing methods</title>
      <p id="Par65">For the integration among scATAC-seq, scRNA-seq and spatial transcriptomic datasets, we benchmarked the performance of uniPort (v1.1.1) against the following methods: Seurat (v4.1), Liger (v1.0.0), and Harmony (v1.0) in R environment (v4.0.2), SCALEX (v0.2.0), MultiMAP (v0.0.1), scVI (v0.17.1), scMC (v1.0.0), GLUE (v0.2.3), SCOT (v1.0), Pamona (v0.1.0), and Tangram (v1.0.3) in Python environment (v3.8.13). We compared their co-embedding UMAP visualization with parameters <italic>n_neighbors=15</italic> and <italic>min_dist=0.1</italic>. All methods adopted gene activity matrices derived from the above data preprocessing steps as input for scATAC-seq. Detailed parameters used in each method are as follows.<list list-type="bullet"><list-item><p id="Par66"><bold>Seurat</bold>. The Seurat package (v4.1.0) was used for all datasets. The raw gene expression profile and unnormalized gene activity matrix were set as input. The matched matrices were log-normalized using the <italic>NormalizeData</italic> function in Seurat with scaling at 10000 for cell-level normalization separately. Then the <italic>FindVariableFeatures</italic> function was used to pick the top 2000 HVGs for scRNA. The anchors between scRNA and scATAC were acquired using the <italic>FindTransferAnchors</italic> function, where ‘cca’ was set as the reduction method with features from HVGs in the scRNA dataset. The imputed scATAC data used the <italic>TransferData</italic> function, where anchors were weighted by latent semantic indexing. Then scRNA and imputed scATAC datasets were merged and reduced using PCA with the <italic>RunPCA</italic> function under default 50 principal components (PCs). UMAP was adopted for visualization at 30 PCs using the <italic>RunUMAP</italic> function. For MERFISH data, the <italic>FindIntegrationAnchors</italic> and <italic>IntegrateData</italic> functions were used for integration after common feature selection with the <italic>SelectIntegrationFeatures</italic> function. Then the integrated matrix was scaled using the <italic>ScaleData</italic> function, and PCA and UMAP were applied to all at 30 PCs. For the 10X Visium datasets, the cell-type assigning probabilities of spots were derived using the <italic>FindTransferAnchors</italic> and <italic>TransferData</italic> functions, where spatial datasets were reduced using PCA at 30 PCs.</p></list-item><list-item><p id="Par67"><bold>Liger</bold>. The R package rliger (v1.0.0) was used for integrating scATAC and MERFISH data with scRNA data. The normalization and selection of HVGs are the same as above steps in Seurat. For all datasets, the number of factors was set to 20 at default in the <italic>optimizeALS</italic> function, which was done by calling the <italic>RunOptimizeALS</italic> function in the SeuratWrappers package (v0.3), and then building a shared factor neighborhood graph and quantile normalization of corresponding clusters applied through the <italic>RunQuantileNorm</italic> function.</p></list-item><list-item><p id="Par68"><bold>Harmony</bold>.The R package harmony (v1.0) was used for integrating scATAC and MERFISH data with scRNA data. The normalization and selection of HVGs are the same as above steps in Seurat. Then PCA was performed using the <italic>RunPCA</italic> function in Seurat at 50 PCs. Harmony refined the results of PCA at top 30 PCs.</p></list-item><list-item><p id="Par69"><bold>SCALEX</bold>. The Python package scalex (v0.2.0) was used for integrating scATAC and MERFISH data with scRNA data. The data preprocessing steps are the same in uniPort and SCALEX. Therefore, we input the same preprocessed data without common genes as those in uniPort. Embedded preprocessing of the scalex package was ignored. We ran SCALEX using the <italic>SCALEX</italic> function with parameters set as default.</p></list-item><list-item><p id="Par70"><bold>MultiMAP</bold>. The Python package MultiMAP (v0.0.1) was used for integrating scATAC and MERFISH data with scRNA data. We followed the tutorials of MultiMAP on GitHub. We first applied the <italic>sc.pp.normalize_total</italic> and <italic>sc.pp.log1p</italic> functions to raw counts without scaling. We then processed data with the <italic>MultiMAP.TFIDF_LSI</italic> function for dimensionality reduction of ATAC peaks, <italic>sc.pp.scale</italic> and <italic>sc.pp.pca</italic> functions in Python package scanpy for dimensionality reduction of scRNA and MERFISH data, and the <italic>MultiMAP.Integration</italic> function for integration with all parameters set as default, as suggested in the pipeline in the GitHub repository.</p></list-item><list-item><p id="Par71"><bold>scVI</bold>. The Python package scvi-tools (v0.17.1) was used for integrating scATAC and MERFISH data with scRNA-seq data. We followed the tutorials of scVI on GitHub. We first performed <italic>sc.pp.normalize_total</italic> and <italic>sc.pp.log1p</italic> functions for input data. Then we selected the top 2000 highly variable genes using the <italic>sc.pp.highly_variable_genes</italic> functions with <italic>flavor="seurat_v3"</italic>. After that, <italic>scvi.model.SCVI</italic> and <italic>scvi.model.SCVI.setup_anndata</italic> functions were used for model initialization.</p></list-item><list-item><p id="Par72"><bold>scMC</bold>. The R package scMC (v1.0.0) was used for integrating scATAC-seq and scRNA-seq data. The normalization and selection of HVGs are the same as the above steps in Seurat. Then we scaled data by <italic>ScaleData</italic> function and performed scMC through <italic>RunscMC</italic> function. We searched parameter <italic>similarity.cutoff</italic> of <italic>RunscMC</italic> function within {0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9} for the best integration result. All other parameters were set as default.</p></list-item><list-item><p id="Par73"><bold>GLUE</bold>. The Python package scglue (v0.2.3) was used for integrating PBMC and mouse spleen examples. We followed the tutorials of GLUE on GitHub. We first performed <italic>sc.pp.normalize_total</italic>, <italic>sc.pp.log1p</italic> and <italic>sc.pp.scale</italic> functions for input data with default parameters for scRNA data. Then we used <italic>sc.tl.pca</italic> function with <italic>n_comps=100</italic> and <italic>scglue.data.lsi</italic> function with <italic>n_components=100</italic> for scRNA and scATAC data, respectively. We chose <italic>prob_model=‘ZINB’</italic> for the PBMC example and <italic>prob_model=‘Normal’</italic> for mouse spleen example in <italic>scglue.models.configure_dataset</italic> function. All other parameters were set as default.</p></list-item><list-item><p id="Par74"><bold>SCOT</bold>. We downloaded SCOT (v1.0) from <ext-link ext-link-type="uri" xlink:href="https://github.com/rsinghlab/SCOT">https://github.com/rsinghlab/SCOT</ext-link>for integrating scATAC-seq with scRNA-seq data. Because SCOT did not provide a data preprocessing tutorial, we compared different approaches and used the one with the best result. To be specific, we performed <italic>uniport.TFIDF_LSI</italic> function with default parameters for ATAC peaks, which reduced the dimension to 49. Then we performed <italic>sc.pp.normalize_total</italic>, <italic>sc.pp.log1p</italic> and <italic>sc.pp.pca</italic> functions with default parameters for RNA data. We set all parameters as default in <italic>scot.align</italic> function.</p></list-item><list-item><p id="Par75"><bold>Pamona</bold>. The Python package pamona (v0.1.0) was used for integrating scATAC-seq and scRNA-seq data. All data preprocessing was performed in the same manner as SCOT.</p></list-item><list-item><p id="Par76"><bold>Tangram</bold>. The Python package tangram-sc (v1.0.3) was used for imputing MERFISH through scRNA-seq data. We followed the tutorial of Tangram on GitHub. First, <italic>tg.pp_adatas</italic> function was applied to pre-process both training MERFISH and scRNA data. Then, we performed <italic>tg.project_genes</italic> function to find the project matrix, which was used to impute MERFISH test genes. All parameters were set as default.</p></list-item><list-item><p id="Par77"><bold>gimVI</bold>. The model gimVI in the Python package scvi-tools (v0.17.1) was used for imputing MERFISH through scRNA-seq data. We followed the tutorial of scvi-tools in GitHub, and used <italic>GIMVI.train</italic> function to train the model in 200 epochs. All parameters were set as default.</p></list-item></list></p>
    </sec>
    <sec id="Sec19">
      <title>Evaluation metrics</title>
      <p id="Par78">The accuracy of cell-type assigning was quantified by the adjusted Rand Index (ARI), Normalized Mutual Information (NMI) and F1 score. To be specific, we trained a <italic>k</italic>-Nearest-Neighbor (<italic>k</italic>NN) classifier by the <italic>sklearn.neighbors.KNeighborsClassifier</italic> function based on cell-type annotations and UMAP coordinates of reference data (e.g., scRNA) embeddings in the common latent space. Then, we applied the well-trained <italic>k</italic>NN classifier to predict cell-type annotations of query dataset (e.g., scATAC/MERFISH) embeddings, and calculated the ARI, NMI and F1 scores by real and predicted query cell type annotations. All results are based on UMAP visualization with parameters <italic>n_neighbors=15</italic> and <italic>min_dist=0.1</italic>.<list list-type="bullet"><list-item><p id="Par79"><bold>Adjusted Rand Index</bold>. Adjusted Rand Index (ARI) is introduced to determine whether real and predicted cell-type clusters are like each other. The Rand Index (RI) computes the similarity by taking all points identified within the same cell-type cluster. The Adjusted RI (ARI) is the chance-corrected version of the Rand index and calculated with RI as<disp-formula id="Equ8"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{ARI}}}}}}}}=\frac{{{{{{{{\rm{RI}}}}}}}}-{{{{{{{\rm{expected\,RI}}}}}}}}}{\max ({{{{{{{\rm{RI}}}}}}}})-{{{{{{{\rm{expected\,RI}}}}}}}}}.$$\end{document}</tex-math><mml:math id="M88"><mml:mi mathvariant="normal">ARI</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">RI</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">expected RI</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">RI</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="normal">expected RI</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>The ARI value ranges from 0 to 1, with 0 for random labeling and 1 for perfect matching.</p></list-item><list-item><p id="Par80"><bold>Normalized Mutual Information</bold>. Normalized Mutual Information (NMI) is a variant of a common measure in information theory called Mutual Information. It is calculated as<disp-formula id="Equ9"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{NMI(U,\; V)}}}}}}}}=\frac{2\times {{{{{{{\rm{I(U;\; V)}}}}}}}}}{{{{{{{{\rm{H(U),\; H(V)}}}}}}}}},$$\end{document}</tex-math><mml:math id="M90"><mml:mi mathvariant="normal">NMI(U, V)</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mi mathvariant="normal">I(U; V)</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">H(U), H(V)</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where U and V are categorical distribution for the real and predicted cell-type annotations, I is the mutual entropy function and H is the Shannon entropy function.</p></list-item><list-item><p id="Par81"><bold>F1</bold>. The F1 score combines the precision and recall of a classifier into a single metric by taking their harmonic mean. It is calculated as<disp-formula id="Equ10"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{F1}}}}}}}}=\frac{2\times {{{{{{{\rm{P}}}}}}}}*{{{{{{{\rm{R}}}}}}}}}{{{{{{{{\rm{P}}}}}}}}+{{{{{{{\rm{R}}}}}}}}},$$\end{document}</tex-math><mml:math id="M92"><mml:mi mathvariant="normal">F1</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mi mathvariant="normal">P</mml:mi><mml:mo>*</mml:mo><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">P</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>where P is the precision and R is the recall of the <italic>k</italic>-NN classifier.</p></list-item></list></p>
      <p id="Par82">To assess the separation of clusters and batch mixing, the Silhouette coefficient and Batch Entropy score were adopted. Furthermore, we employed average FOSCTTM<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> to assess cell-to-cell neighborhood preservation for paired datasets profiled from the same cells. All these systematic benchmarks were applied in scRNA-seq, scATAC-seq and MERFISH datasets. All results are based on UMAP visualization with parameters <italic>n_neighbors=15</italic> and <italic>min_dist=0.1</italic>.<list list-type="bullet"><list-item><p id="Par83"><bold>Silhouette coefficient</bold>. The Silhouette coefficient is calculated using the mean intra-cluster distance (a) and the mean nearest-cluster distance (b) for each sample. The Silhouette coefficient for a sample is calculated as<disp-formula id="Equ11"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{Silhouette}}}}}}}}=\frac{b-a}{\max (a,\,b)}.$$\end{document}</tex-math><mml:math id="M94"><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mo>−</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>By default, we scale the score between 0 and 1 by<disp-formula id="Equ12"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{Silhouette}}}}}}}}\leftarrow ({{{{{{{\rm{Silhouette}}}}}}}}+1)/2,$$\end{document}</tex-math><mml:math id="M96"><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>←</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">Silhouette</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par84"><bold>Batch Entropy score</bold>. It was derived from SCALAX<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> inspired by “entropy of batch mixing”<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. It evaluates the sum of regional mixing entropies at the location of randomly chosen cells from different datasets where a high score indicates cells from various datasets mixing well. This can be calculated as<disp-formula id="Equ13"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${p}_{i}^{{\prime} }=\frac{{p}_{i}/{P}_{i}}{\mathop{\sum }\nolimits_{i=1}^{n}{p}_{i}/{P}_{i}},$$\end{document}</tex-math><mml:math id="M98"><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ14"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E=\mathop{\sum }\limits_{i=1}^{n}{p}_{i}^{{\prime} }\log ({p}_{i}^{{\prime} }),$$\end{document}</tex-math><mml:math id="M100"><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>where <italic>P</italic><sub><italic>i</italic></sub> is the proportion of cell numbers in each batch to the total cell numbers, and <italic>p</italic><sub><italic>i</italic></sub> is the proportion of cells from batch <italic>i</italic> in a given region. We calculated the Batch Entropy score only based on cells from cell types that are common in different batches.</p></list-item><list-item><p id="Par85"><bold>average FOSCTTM</bold>. FOSCTTM refers to “fraction of samples closer than the true match”. It was used to evaluate the relationship preservation of cell-to-cell pairings’ neighborhood. It was calculated on two datasets with known cell-to-cell correspondence information. The average FOSCTTM is calculated as<disp-formula id="Equ15"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{average\,FOSCTTM}}}}}}}}=\frac{1}{2n}{{{{{{{\rm{FOSCTTM}}}}}}}},$$\end{document}</tex-math><mml:math id="M102"><mml:mi mathvariant="normal">average FOSCTTM</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">FOSCTTM</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ16"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{FOSCTTM}}}}}}}}=\mathop{\sum }\limits_{i=1}^{n}\frac{{s}^{i}}{n}+\mathop{\sum }\limits_{i=1}^{n}\frac{{t}^{i}}{n},$$\end{document}</tex-math><mml:math id="M104"><mml:mi mathvariant="normal">FOSCTTM</mml:mi><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ17"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${s}^{i}=|\{j|d({z}_{{x}_{j}},\,{z}_{{y}_{i}}) \, &lt; \, d({z}_{{x}_{i}},\,{z}_{{y}_{i}})\}|$$\end{document}</tex-math><mml:math id="M106"><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mo>∣</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∣</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>∣</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ18"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${t}^{i}=|\{j|d({z}_{{x}_{i}},\,{z}_{{y}_{j}}) \, &lt; \, d({z}_{{x}_{i}},\,{z}_{{y}_{i}})\}|$$\end{document}</tex-math><mml:math id="M108"><mml:msup><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mo>∣</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∣</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="0.25em"/><mml:mo>&lt;</mml:mo><mml:mspace width="0.25em"/><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>∣</mml:mo></mml:math><graphic xlink:href="41467_2022_35094_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of both dataset <bold>X</bold> and <bold>Y</bold>, <inline-formula id="IEq37"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${z}_{{x}_{i}}$$\end{document}</tex-math><mml:math id="M110"><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq37.gif"/></alternatives></inline-formula> and <inline-formula id="IEq38"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${z}_{{y}_{i}}$$\end{document}</tex-math><mml:math id="M112"><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2022_35094_Article_IEq38.gif"/></alternatives></inline-formula> are paired cells, <italic>s</italic><sup><italic>i</italic></sup> and <italic>t</italic><sup><italic>i</italic></sup> are the number of cells closer to the <italic>i</italic>-th cell in a dataset than its true match in another dataset. The average FOSCTTM ranges from 0 to 1, and lower values indicate higher accuracy.</p></list-item></list></p>
    </sec>
    <sec id="Sec20">
      <title>Statistics &amp; reproducibility</title>
      <p id="Par86">All statistical calculations were implemented in R (v4.0.2; <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/">https://cran.r-project.org/</ext-link>). The detailed statistical tests were indicated in figures or associated legends where applicable. No statistical method was used to predetermine sample size. No data were excluded from the analyses. Complete randomization was performed for allocating groups. Our study does not involve group allocation that requires blinding.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par87">Further information on research design is available in the <xref rid="MOESM5" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2022_35094_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2022_35094_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2022_35094_MOESM3_ESM.pdf">
            <caption>
              <p>Description of additional Supplementary File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2022_35094_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2022_35094_MOESM5_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par91">
          <media position="anchor" xlink:href="41467_2022_35094_MOESM6_ESM.xlsx" id="MOESM6">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Kai Cao, Qiyu Gong.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-022-35094-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was supported by the National Key Research and Development Program of China (No. 2019YFA0709501 to L.W.), the National Natural Science Foundation of China (Nos. 61733018, 62173250 to Y.H., and No. 12071466 to L.W.), Shanghai Municipal Science and Technology Major Project (No. 2021SHZDZX0100 to Y.H.), and the Fundamental Research Funds for the Central Universities (No. 22120200046 to Y.H.).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Y.H. and L.W. conceived and supervised the project. K.C. conceived, designed and implemented the uniPort model. Q.G. validated and analyzed the results. K.C., Q.G. and L.W. wrote the paper.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par88"><italic>Nature Communications</italic> thanks Qing Nie, and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. <xref rid="MOESM2" ref-type="media">Peer reviewer reports</xref> are available</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All data analyzed in this article are publicly available through online sources. We present links to all data sources in Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>. Source data are provided as a Source Data file. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The uniPort framework was implemented in the ‘uniport’ Python package, which can be installed through PyPI [<ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/uniport/">https://pypi.org/project/uniport/</ext-link>], and its open-source code is maintained at <ext-link ext-link-type="uri" xlink:href="https://github.com/caokai1073/uniPort">https://github.com/caokai1073/uniPort</ext-link>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par89">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>Computational methods for single-cell omics across modalities</article-title>
        <source>Nat. Methods</source>
        <year>2020</year>
        <volume>17</volume>
        <fpage>14</fpage>
        <lpage>17</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0692-4</pub-id>
        <?supplied-pmid 31907463?>
        <pub-id pub-id-type="pmid">31907463</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Argelaguet</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Cuomo</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Computational principles and challenges in single-cell data integration</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>39</volume>
        <fpage>1202</fpage>
        <lpage>1215</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00895-7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell type annotation of single-cell chromatin accessibility data via supervised bayesian embedding</article-title>
        <source>Nat. Mach. Intelligence</source>
        <year>2022</year>
        <volume>4</volume>
        <fpage>116</fpage>
        <lpage>126</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00432-w</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Argelaguet</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MOFA+: a statistical framework for comprehensive integration of multi-modal single-cell data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>111</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02015-1</pub-id>
        <?supplied-pmid 32393329?>
        <pub-id pub-id-type="pmid">32393329</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deconvolution of single-cell multi-omics layers reveals regulatory heterogeneity</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>470</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-08205-7</pub-id>
        <?supplied-pmid 30692544?>
        <pub-id pub-id-type="pmid">30692544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573–3587.e29</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gayoso</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Joint probabilistic modeling of single-cell multi-omic data with totalvi</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>272</fpage>
        <lpage>282</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-020-01050-x</pub-id>
        <?supplied-pmid 33589839?>
        <pub-id pub-id-type="pmid">33589839</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stoeckius</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous epitope and transcriptome measurement in single cells</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>865</fpage>
        <lpage>868</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4380</pub-id>
        <?supplied-pmid 28759029?>
        <pub-id pub-id-type="pmid">28759029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888–1902.e21</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1873–1887.e17</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id>
        <?supplied-pmid 31178122?>
        <pub-id pub-id-type="pmid">31178122</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>DC3 is a method for deconvolution and coupled clustering from bulk and single-cell genomics data</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>4613</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-12547-1</pub-id>
        <?supplied-pmid 31601804?>
        <pub-id pub-id-type="pmid">31601804</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jain</surname>
            <given-names>MS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multimap: Dimensionality reduction and integration of multimodal data</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>346</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02565-y</pub-id>
        <?supplied-pmid 34930412?>
        <pub-id pub-id-type="pmid">34930412</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Singh, R. et al. Unsupervised manifold alignment for single-cell multi-omics data. In <italic>Proceedings of the 11th ACM International Conference on Bioinformatics, Computational Biology and Health Informatics</italic>, 1–10 (2020).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Demetci</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Santorella</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sandstede</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Noble</surname>
            <given-names>WS</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell multiomics integration by SCOT</article-title>
        <source>J. Comput. Biol.</source>
        <year>2022</year>
        <volume>29</volume>
        <fpage>19</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2021.0477</pub-id>
        <?supplied-pmid 34985990?>
        <pub-id pub-id-type="pmid">34985990</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wan</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Unsupervised topological alignment for single-cell multi-omics integration</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>i48</fpage>
        <lpage>i56</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa443</pub-id>
        <?supplied-pmid 32657382?>
        <pub-id pub-id-type="pmid">32657382</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wan</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Manifold alignment for heterogeneous single-cell multi-omics data integration using Pamona</article-title>
        <source>Bioinformatics</source>
        <year>2021</year>
        <volume>38</volume>
        <fpage>211</fpage>
        <lpage>219</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab594</pub-id>
        <?supplied-pmid 34398192?>
        <pub-id pub-id-type="pmid">34398192</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zuo</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Dai</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Deep cross-omics cycle attention model for joint analysis of single-cell multi-omics data</article-title>
        <source>Bioinformatics</source>
        <year>2021</year>
        <volume>37</volume>
        <fpage>4091</fpage>
        <lpage>4099</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gong</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Purdom</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Cobolt: integrative analysis of multimodal single-cell sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>351</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02556-z</pub-id>
        <?supplied-pmid 34963480?>
        <pub-id pub-id-type="pmid">34963480</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Zhang, Z., Yang, C. &amp; Zhang, X. Learning latent embedding of multi-modal single cell data and cross-modality relationship simultaneously. bioRxiv (2022).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dai Yang</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multi-domain translation between single-cell imaging and sequencing data using autoencoders</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-20249-2</pub-id>
        <pub-id pub-id-type="pmid">33397893</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>scJoint integrates atlas-scale single-cell RNA-seq and ATAC-seq data with transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>703</fpage>
        <lpage>710</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01161-6</pub-id>
        <?supplied-pmid 35058621?>
        <pub-id pub-id-type="pmid">35058621</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01001-7</pub-id>
        <?supplied-pmid 34462589?>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Nie</surname>
            <given-names>Q</given-names>
          </name>
        </person-group>
        <article-title>scMC learns biological variation through the alignment of multiple single-cell genomics datasets</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>10</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02238-2</pub-id>
        <?supplied-pmid 33397454?>
        <pub-id pub-id-type="pmid">33397454</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xiong</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Online single-cell data integration through projecting heterogeneous datasets into a common cell-embedding space</article-title>
        <source>Nat. Commun.</source>
        <year>2022</year>
        <volume>13</volume>
        <fpage>6118</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-33758-z</pub-id>
        <?supplied-pmid 36253379?>
        <pub-id pub-id-type="pmid">36253379</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>Z-J</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Multi-omics single-cell data integration and regulatory inference with graph-linked embedding</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>1458</fpage>
        <lpage>1466</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-022-01284-4</pub-id>
        <?supplied-pmid 35501393?>
        <pub-id pub-id-type="pmid">35501393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Lopez, R. et al. A joint model of unpaired data from scrna-seq and spatial transcriptomics for imputing missing gene expression measurements. ICML Workshop on Computational Biology (2019).</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Biancalani</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with tangram</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1352</fpage>
        <lpage>1362</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01264-7</pub-id>
        <?supplied-pmid 34711971?>
        <pub-id pub-id-type="pmid">34711971</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>
        <source>Nature Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>662</fpage>
        <lpage>670</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-022-01480-9</pub-id>
        <?supplied-pmid 35577954?>
        <pub-id pub-id-type="pmid">35577954</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Fatras, K., Séjourné, T., Flamary, R. &amp; Courty, N. Unbalanced minibatch optimal transport; applications to domain adaptation. In <italic>International Conference on Machine Learning</italic>, 3186-3197 (PMLR, 2021).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>362</volume>
        <fpage>eaau5324</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aau5324</pub-id>
        <?supplied-pmid 30385464?>
        <pub-id pub-id-type="pmid">30385464</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Chang, W.-G., You, T., Seo, S., Kwak, S. &amp; Han, B. Domain-specific batch normalization for unsupervised domain adaptation. In <italic>Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</italic>, 7354–7362 (2019).</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell rna-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>421</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id>
        <?supplied-pmid 29608177?>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rousseeuw</surname>
            <given-names>PJ</given-names>
          </name>
        </person-group>
        <article-title>Silhouettes: a graphical aid to the interpretation and validation of cluster analysis</article-title>
        <source>J. Comput. Appl. Math.</source>
        <year>1987</year>
        <volume>20</volume>
        <fpage>53</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1016/0377-0427(87)90125-7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <mixed-citation publication-type="other">PBMCs from C57BL/6 mice (v1, 150x150), Single Cell Immune Profiling Dataset by Cell Ranger 3.1.0. 10× Genomics (2019).</mixed-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrative analyses of single-cell transcriptome and regulome using MAESTRO</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>198</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02116-x</pub-id>
        <?supplied-pmid 32767996?>
        <pub-id pub-id-type="pmid">32767996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Becht</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>38</fpage>
        <lpage>44</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Mourragui</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mahfouz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJT</given-names>
          </name>
        </person-group>
        <article-title>SpaGE: Spatial Gene Enhancement using scRNA-seq</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2020</year>
        <volume>48</volume>
        <fpage>e107</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa740</pub-id>
        <?supplied-pmid 32955565?>
        <pub-id pub-id-type="pmid">32955565</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shengquan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Boheng</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Xiaoyang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Xuegong</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Rui</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>stPlus: a reference-based method for the accurate enhancement of spatial transcriptomics</article-title>
        <source>Bioinformatics</source>
        <year>2021</year>
        <volume>37</volume>
        <fpage>i299</fpage>
        <lpage>i307</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab298</pub-id>
        <?supplied-pmid 34252941?>
        <pub-id pub-id-type="pmid">34252941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Longo</surname>
            <given-names>SK</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>MG</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Khavari</surname>
            <given-names>PA</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell and spatial transcriptomics to elucidate intercellular tissue dynamics</article-title>
        <source>Nat. Rev. Genet.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>627</fpage>
        <lpage>644</lpage>
        <pub-id pub-id-type="doi">10.1038/s41576-021-00370-8</pub-id>
        <?supplied-pmid 34145435?>
        <pub-id pub-id-type="pmid">34145435</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Nie</surname>
            <given-names>Q</given-names>
          </name>
        </person-group>
        <article-title>Inferring spatial and signaling relationships between cells from single cell transcriptomic data</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>2084</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-15968-5</pub-id>
        <?supplied-pmid 32350282?>
        <pub-id pub-id-type="pmid">32350282</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elosua-Bayes</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mereu</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Gut</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Heyn</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Spotlight: seeded nmf regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>e50</fpage>
        <lpage>e50</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab043</pub-id>
        <?supplied-pmid 33544846?>
        <pub-id pub-id-type="pmid">33544846</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Biancalani</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with tangram</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1352</fpage>
        <lpage>1362</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01264-7</pub-id>
        <?supplied-pmid 34711971?>
        <pub-id pub-id-type="pmid">34711971</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Philippot</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Astrocytes and oligodendrocytes in the thalamus jointly maintain synaptic activity by supplying metabolites</article-title>
        <source>Cell Rep.</source>
        <year>2021</year>
        <volume>34</volume>
        <fpage>108642</fpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2020.108642</pub-id>
        <?supplied-pmid 33472059?>
        <pub-id pub-id-type="pmid">33472059</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the mouse nervous system</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>999</fpage>
        <lpage>1014</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.06.021</pub-id>
        <?supplied-pmid 30096314?>
        <pub-id pub-id-type="pmid">30096314</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dart</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Cell genesis</article-title>
        <source>Nat. Rev. Cancer</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>339</fpage>
        <lpage>339</lpage>
        <pub-id pub-id-type="doi">10.1038/s41568-018-0014-7</pub-id>
        <?supplied-pmid 29692418?>
        <pub-id pub-id-type="pmid">29692418</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andersson</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial deconvolution of her2-positive breast cancer delineates tumor-associated cell type interactions</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>6012</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-26271-2</pub-id>
        <?supplied-pmid 34650042?>
        <pub-id pub-id-type="pmid">34650042</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schumacher</surname>
            <given-names>TN</given-names>
          </name>
          <name>
            <surname>Thommen</surname>
            <given-names>DS</given-names>
          </name>
        </person-group>
        <article-title>Tertiary lymphoid structures in cancer</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>375</volume>
        <fpage>eabf9419</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abf9419</pub-id>
        <?supplied-pmid 34990248?>
        <pub-id pub-id-type="pmid">34990248</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sautès-Fridman</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Petitprez</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Calderaro</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Fridman</surname>
            <given-names>WH</given-names>
          </name>
        </person-group>
        <article-title>Tertiary lymphoid structures in the era of cancer immunotherapy</article-title>
        <source>Nat. Rev. Cancer</source>
        <year>2019</year>
        <volume>19</volume>
        <fpage>307</fpage>
        <lpage>325</lpage>
        <pub-id pub-id-type="doi">10.1038/s41568-019-0144-6</pub-id>
        <?supplied-pmid 31092904?>
        <pub-id pub-id-type="pmid">31092904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moncada</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrating microarray-based spatial transcriptomics and single-cell rna-seq reveals tissue architecture in pancreatic ductal adenocarcinomas</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>333</fpage>
        <lpage>342</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0392-8</pub-id>
        <?supplied-pmid 31932730?>
        <pub-id pub-id-type="pmid">31932730</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ferreira</surname>
            <given-names>RM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Duct-and acinar-derived pancreatic ductal adenocarcinomas show distinct tumor progression and marker expression</article-title>
        <source>Cell Rep.</source>
        <year>2017</year>
        <volume>21</volume>
        <fpage>966</fpage>
        <lpage>978</lpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2017.09.093</pub-id>
        <?supplied-pmid 29069604?>
        <pub-id pub-id-type="pmid">29069604</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <mixed-citation publication-type="other">Mai, S. &amp; Inkielewicz-Stepniak, I. Pancreatic cancer and platelets crosstalk: a potential biomarker and target. <italic>Front. Cell Dev. Biol.</italic><bold>9</bold>, 749689 (2021).</mixed-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kojima</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tight junctions in human pancreatic duct epithelial cells</article-title>
        <source>Tissue Barriers</source>
        <year>2013</year>
        <volume>1</volume>
        <fpage>e24894</fpage>
        <pub-id pub-id-type="doi">10.4161/tisb.24894</pub-id>
        <?supplied-pmid 24665406?>
        <pub-id pub-id-type="pmid">24665406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Murthy</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Attri</surname>
            <given-names>KS</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>PK</given-names>
          </name>
        </person-group>
        <article-title>Phosphoinositide 3-kinase signaling pathway in pancreatic ductal adenocarcinoma progression, pathogenesis, and therapeutics</article-title>
        <source>Front. Physiol.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>335</fpage>
        <pub-id pub-id-type="doi">10.3389/fphys.2018.00335</pub-id>
        <?supplied-pmid 29670543?>
        <pub-id pub-id-type="pmid">29670543</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karaiskos</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Gene expression cartography</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>576</volume>
        <fpage>132</fpage>
        <lpage>137</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id>
        <?supplied-pmid 31748748?>
        <pub-id pub-id-type="pmid">31748748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Optimal-transport analysis of single-cell gene expression identifies developmental trajectories in reprogramming</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>928–943.e22</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.01.006</pub-id>
        <?supplied-pmid 30712874?>
        <pub-id pub-id-type="pmid">30712874</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Srivastava</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Madad</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell chromatin state analysis with signac</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1333</fpage>
        <lpage>1341</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01282-5</pub-id>
        <?supplied-pmid 34725479?>
        <pub-id pub-id-type="pmid">34725479</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous profiling of chromatin accessibility and methylation on human cell lines with nanopore sequencing</article-title>
        <source>Nat. Methods</source>
        <year>2020</year>
        <volume>17</volume>
        <fpage>1191</fpage>
        <lpage>1199</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-020-01000-7</pub-id>
        <?supplied-pmid 33230324?>
        <pub-id pub-id-type="pmid">33230324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <mixed-citation publication-type="other">Xie, Y., Wang, X., Wang, R. &amp; Zha, H. A fast proximal point method for computing exact wasserstein distance. In <italic>Uncertainty in Artificial Intelligence</italic>, 433–453 (PMLR, 2020).</mixed-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Model-based analysis of ChIP-Seq (MACS)</article-title>
        <source>Genome Biol.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>R137</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2008-9-9-r137</pub-id>
        <?supplied-pmid 18798982?>
        <pub-id pub-id-type="pmid">18798982</pub-id>
      </element-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Miragaia</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Natarajan</surname>
            <given-names>KN</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>A rapid and robust method for single cell chromatin accessibility profiling</article-title>
        <source>Nat. Commun.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>5345</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-07771-0</pub-id>
        <?supplied-pmid 30559361?>
        <pub-id pub-id-type="pmid">30559361</pub-id>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fang</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive analysis of single cell atac-seq data with snapatac</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1337</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-21583-9</pub-id>
        <?supplied-pmid 33637727?>
        <pub-id pub-id-type="pmid">33637727</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>362</volume>
        <fpage>eaau5324</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aau5324</pub-id>
        <?supplied-pmid 30385464?>
        <pub-id pub-id-type="pmid">30385464</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-021-00911-1</pub-id>
        <?supplied-pmid 34493872?>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
