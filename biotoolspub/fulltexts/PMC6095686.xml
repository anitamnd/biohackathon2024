<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6095686</article-id>
    <article-id pub-id-type="pmid">29578535</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4638</article-id>
    <article-id pub-id-type="manuscript">nihpa947830</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>NAMD goes quantum: An integrative suite for QM/MM simulations</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Melo</surname>
          <given-names>Marcelo C. R.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="author-notes" rid="FN2">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bernardi</surname>
          <given-names>Rafael C.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="author-notes" rid="FN2">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rudack</surname>
          <given-names>Till</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Scheurer</surname>
          <given-names>Maximilian</given-names>
        </name>
        <xref ref-type="aff" rid="A4">4</xref>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Riplinger</surname>
          <given-names>Christoph</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Phillips</surname>
          <given-names>James C.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Maia</surname>
          <given-names>Julio D. C.</given-names>
        </name>
        <xref ref-type="aff" rid="A7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rocha</surname>
          <given-names>Gerd B.</given-names>
        </name>
        <xref ref-type="aff" rid="A8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ribeiro</surname>
          <given-names>João V.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Stone</surname>
          <given-names>John E.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Neese</surname>
          <given-names>Frank</given-names>
        </name>
        <xref ref-type="aff" rid="A9">9</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schulten</surname>
          <given-names>Klaus</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A10">10</xref>
        <xref ref-type="author-notes" rid="FN3">+</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luthey-Schulten</surname>
          <given-names>Zaida</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A9">9</xref>
        <xref ref-type="aff" rid="A11">11</xref>
        <xref ref-type="author-notes" rid="FN1">**</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>NIH Center for Macromolecular Modeling and Bioinformatics, Beckman Institute for Advanced Science and Technology, University of Illinois at Urbana-Champaign, 61801, USA</aff>
    <aff id="A2"><label>2</label>Center for Biophysics and Computational Biology, University of Illinois at Urbana-Champaign, 61801, USA</aff>
    <aff id="A3"><label>3</label>Department of Biophysics, Ruhr-University Bochum, Germany</aff>
    <aff id="A4"><label>4</label>Biochemistry Center, Heidelberg University, Heidelberg, Germany</aff>
    <aff id="A5"><label>5</label>Interdisciplinary Center for Scientific Computing, Heidelberg, Germany</aff>
    <aff id="A6"><label>6</label>FAccTs GmbH, Köln, Germany</aff>
    <aff id="A7"><label>7</label>Center for Informatics, Federal University of Paraíba, João Pessoa, Brazil</aff>
    <aff id="A8"><label>8</label>Department of Chemistry, Federal University of Paraíba, João Pessoa, Brazil</aff>
    <aff id="A9"><label>9</label>Max Planck Institut für Kohlenforschung, Mülheim an der Ruhr, Germany</aff>
    <aff id="A10"><label>10</label>Department of Physics, University of Illinois at Urbana-Champaign, 61801, USA</aff>
    <aff id="A11"><label>11</label>Department of Chemistry, University of Illinois at Urbana-Champaign, 61801, USA</aff>
    <author-notes>
      <corresp id="FN1"><label>**</label>Corresponding author <email>zan@illinois.edu</email></corresp>
      <fn id="FN2" fn-type="equal">
        <label>*</label>
        <p id="P1">These authors contributed equally.</p>
      </fn>
      <fn id="FN3">
        <label>+</label>
        <p id="P2">In memoriam.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>12</day>
      <month>3</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>3</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>9</month>
      <year>2018</year>
    </pub-date>
    <volume>15</volume>
    <issue>5</issue>
    <fpage>351</fpage>
    <lpage>354</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4638-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use: 
<uri xlink:type="simple" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P3">Applications of hybrid QM/MM methods range from reactions in active sites of small enzymes to multiple sites in large bioenergetic complexes. By combining the widely used molecular dynamics and visualization programs NAMD/VMD with the quantum chemistry packages ORCA, and MOPAC, we provide an integrated, comprehensive, customizable, and easy-to-use suite. Through the QwikMD interface, setup, execution, visualization, and analysis are streamlined for all levels of expertise.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P4">Though molecular mechanics (MM) force-fields are based on quantum mechanical calculations and experimental observations, only quantum mechanics (QM) enables a complete and accurate understanding of many biochemical processes, particularly those involving chemical reactions or charge redistribution [<xref rid="R1" ref-type="bibr">1</xref>]. Nevertheless, even with the advanced hardware technology available today, the computational cost of studying nanosecond-long dynamics of entire systems relying solely on QM methodologies is usually prohibitive. A common route to circumvent this cost barrier is to confine the QM formalism to a subregion of a system and to include the effects of the surrounding system through MM simulations, leading to hybrid “QM/MM” simulations [<xref rid="R2" ref-type="bibr">2</xref>]. QM/MM calculations are now used broadly in enzymology [<xref rid="R3" ref-type="bibr">3</xref>], drug discovery [<xref rid="R4" ref-type="bibr">4</xref>], bioenergetic systems [<xref rid="R5" ref-type="bibr">5</xref>], as well as in combination with serial femtosecond crystallography [<xref rid="R6" ref-type="bibr">6</xref>] and other material sciences and structural biology techniques [<xref rid="R7" ref-type="bibr">7</xref>]. To deliver accurate results, these QM/MM studies require a carefully selected quantum region [<xref rid="R5" ref-type="bibr">5</xref>, <xref rid="R8" ref-type="bibr">8</xref>]. Unfortunately, most the available QM/MM implementations lack a comprehensive set of features that could make these calculations even more attractive to chemists, structural biologists, and material engineers.</p>
  <p id="P5">NAMD [<xref rid="R9" ref-type="bibr">9</xref>] is one of the most widely used software packages for molecular dynamics (MD) simulations, particularly for large biomolecular systems on supercomputers. NAMD’s scalability and large array of enhanced sampling and free energy methods [<xref rid="R10" ref-type="bibr">10</xref>], as well as a seamless integration with VMD [<xref rid="R11" ref-type="bibr">11</xref>], which provides extended setup, visualization and analysis capabilities, makes it an invaluable tool for exploring complex biological systems. Here we present a comprehensive QM/MM suite, developed to provide easy setup, visualization and analysis of QM/MM simulations through the graphical user interface QwikMD [<xref rid="R12" ref-type="bibr">12</xref>] as well as a broad range of QM methods. Our graphical interface makes our tool unique among widely employed MD codes. The QM/MM interface in NAMD supports the simulation of many independent QM regions, and smooth integration with a collection of enhanced sampling and alchemical methods, including the combination of QM/MM approaches with state-of-the-art free energy methods, such as extended adaptive biasing force (eABF) [<xref rid="R13" ref-type="bibr">13</xref>]. In addition, NAMD performs similarly to other QM/MM programs regarding energy conservation (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>), and allows scalable free-energy calculations (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1</xref>).</p>
  <p id="P6">In hybrid QM/MM simulations, NAMD offloads part of its standard force and energy calculations to a QM program, either through native interfaces to MOPAC [<xref rid="R14" ref-type="bibr">14</xref>, <xref rid="R15" ref-type="bibr">15</xref>] or ORCA [<xref rid="R16" ref-type="bibr">16</xref>], or through a flexible generic interface. Others, e.g. Amber [<xref rid="R17" ref-type="bibr">17</xref>], additionally include their own code for QM calculations. This strategy was not adopted here to ensure flexibility, allowing users to easily fine tune their simulations. Importantly, by performing file I/O in RAM, very little time is lost during communication between NAMD and the QM program. In NAMD, multiple QM-MM coupling schemes have been implemented, allowing for both mechanically and electrostatically embedded QM regions to be used (see Online Methods). Input files are the same used for classical MD, with additional options in the configuration file. Typically, QM and MM atoms that are covalently bound are treated by redistributing the MM atom’s charge over its nearest MM neighbors and by capping the QM atom with a hydrogen atom, known as the Link Atom method, as shown in <xref ref-type="fig" rid="F1">Fig. 1a</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2</xref> for a calculation using the NAMD/ORCA interface. For all Link Atom variations, see Online Methods and <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3a–b, 4, 5a and 5b</xref>.</p>
  <p id="P7">To test the QM/MM interface for accuracy, stability, and performance, we carried out standard validation simulations with both MOPAC and ORCA. NAMD achieved energy conservation for a pure QM alanine molecule (<xref ref-type="fig" rid="F1">Fig. 1b</xref>), a hybrid QM/MM tri-alanine molecule in vacuum (<xref ref-type="fig" rid="F1">Fig. 1c</xref>) and in water (<xref ref-type="fig" rid="F1">Fig. 1d</xref>), and a pure QM N-methyl acetamide (NMA) molecule, the latter for up to 100 ns with both 0.5 fs and 2.0 fs time steps (<xref ref-type="fig" rid="F1">Fig. 1e</xref>). A particle mesh Ewald (PME) treatment of long-range electrostatics was also observed to conserve energy (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 2</xref>). Compared, NAMD and Amber16 presented equally good QM/MM results (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 6</xref>). NAMD/MOPAC was shown to perform up to 10 ns/day of QM/MM simulation in a single desktop computer (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 3</xref>). In all tests NAMD was shown to perform efficiently while conserving energy.</p>
  <p id="P8">To provide a quick and easy way of setting up QM/MM simulations, we incorporated the most widely employed features of a hybrid QM/MM molecular dynamics code to VMD’s QwikMD [<xref rid="R12" ref-type="bibr">12</xref>], setting up a comprehensive QM/MM workflow (<xref ref-type="fig" rid="F2">Fig. 2a</xref>). QwikMD automates the creation of input and configuration files while checking for common mistakes, and ensures reproducibility of the result. Moreover, QwikMD allows drugs, metabolites and other molecules lacking MM parameters to be easily added to a QM region. Once prepared, QM/MM simulations can be directly performed either in real-time using “live-view” mode or by calling NAMD using local computer resources or a supercomputing center (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 7</xref>).</p>
  <p id="P9">Trajectories from classical or hybrid QM/MM simulations are easily read and analyzed by VMD, whose capabilities have been extended in this work to natively support MOPAC and ORCA outputs, which benefits not only the users of our QM/MM suite but any users of these two packages. New representation schemes were introduced to VMD allowing the selection and visualization of orbital trajectories throughout a simulation, and to allow for the chemical bonds representation to be dynamically updated. The new capabilities in VMD make it a powerful tool to visualize and analyze output from QM/MM calculations as well as outputs directly from ORCA and MOPAC (see <xref ref-type="fig" rid="F2">Fig. 2b–d</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Tables 4, 5 and 6, Supplementary Note</xref> and <xref ref-type="supplementary-material" rid="SD3">Supplementary Video 1</xref>).</p>
  <p id="P10">Combining the new QM/MM capabilities of the NAMD/MOPAC interface with existing tools for enhanced sampling and free energy calculations, we investigated the aminoacylation reaction mechanism of <italic>Thermus thermophilus</italic> glutamyl-tRNA synthetase (GluRS) and its interactions with its cognate tRNA (tRNA<sup><italic>Glu</italic></sup>), using PM7 together with the CHARMM36 force field. To establish the genetic code, GluRS reads the tRNA’s anticodon region and uses this information to rearrange its catalytic site, facilitating the transfer of an AMP-bound glutamyl to the 3’ end of the tRNA. A study of the allosteric information processing and transduction was previously conducted using classical MD [<xref rid="R18" ref-type="bibr">18</xref>]. However, because the anticodon binding domain and catalytic site of GluRS are over 50 angstroms apart, the treatment of the entire pathway, with approximately 5,000 atoms, using QM accuracy would be unfeasible. Using QwikMD to prepare a system with two independent QM regions, we were able to investigate the allosteric signaling pathway of the GluRS:tRNA<sup><italic>Glu</italic></sup> complex with an accurate QM treatment of the two most critical regions of the system (see <xref ref-type="fig" rid="F3">Fig. 3a</xref>).</p>
  <p id="P11">The communication pathways that lead to coordinated motion between functionally important QM regions were analyzed using cross-correlation based network analysis [<xref rid="R18" ref-type="bibr">18</xref>] (see Online Methods and <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 8</xref>), and found to be significantly degenerate, as previously observed using classical MD [<xref rid="R18" ref-type="bibr">18</xref>] (<xref ref-type="fig" rid="F3">Fig. 3a</xref>). The QM/MM treatment of critical regions lead to increased correlations between residues in the active site and anticodon binding site (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 9</xref>). Suboptimal communication pathways are based on the correlation of atom motion during the simulation and have been employed to calculate allosteric signaling and force propagation pathways. Tightly correlated groups of atoms are clustered into communities, indicating functional domains of biomolecules and important interfaces between multi-molecule complexes. In this work, the presence of multiple communities within a QM region and the occurrence of communities that cover both classical and quantum atoms, highlight the seamless integration of QM and MM regions (<xref ref-type="fig" rid="F3">Fig. 3b</xref>).</p>
  <p id="P12">The aminoacylation reaction mechanism was for the first time investigated to distinguish between four possible mechanisms (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 10</xref>), all based on a previously proposed concerted exchange where the 3’ or the 2’-OH oxygen attacks the carbonyl carbon of Glu-AMP while the proton shifts to the phosphate’s oxygen [<xref rid="R19" ref-type="bibr">19</xref>]. In addition, the reaction was investigated while the amine group of the adenylate was protonated or deprotonated. QM/MM steered molecular dynamics (SMD) simulations were performed to induce the possible reaction mechanisms, and intermediate states were selected from the SMD trajectories to initiate a String Method optimization [<xref rid="R20" ref-type="bibr">20</xref>]. The method utilizes groups of biased MD simulations to find the path with the smallest barrier that describes the chemical reaction. Once an optimized string was achieved, the reaction path was used to perform a parallel extended-Adaptive Biasing Force [<xref rid="R13" ref-type="bibr">13</xref>] (eABF) calculation to determine the free energy transformation of each possible mechanism (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 11, 12</xref>). The reaction charging the 3-hydroxyl group, with the amine group of the adenylate being deprotonated, was observed to be the most favorable route with a barrier of ≈20 kcal/mol and final state at ≈8 kcal/mol (<xref ref-type="fig" rid="F3">Fig. 3c–e</xref>).</p>
  <p id="P13">Initially, all possible reaction mechanisms tested were observed to be endergonic (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 13</xref>). However, closer examination of the final states revealed that the AMP’s phosphate was only 3 Å away from the charged tRNA. Dissociation of the AMP-H from the charged tRNA opens space for hydration of its phosphate group (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 14</xref>), and was investigated using ABF and classical MD simulations. As the products move apart and water enters the active site, hydrating the phosphate group of AMP-H, we observed a ≈22 kcal/mol drop in free energy, making the entire reaction-solvation process exergonic, with a ≈−15 kcal/mol free energy variation between reactants and products (<xref ref-type="fig" rid="F3">Fig. 3e–g</xref>). It is worth noting that appending QM/MM eABF and MM ABF results leads to a small imprecision in the connection between free energy values (red dashed line in <xref ref-type="fig" rid="F3">Fig. 3e–f</xref>).</p>
  <p id="P14">Hybrid QM/MM protocols have been applied to a wide range of investigations, however, a comprehensive, customizable, easy-to-use, and freely available suite was not yet available to the broader computational biology and material sciences communities. Building upon the synergy between NAMD and VMD, we developed a robust and user-friendly QM/MM suite to prepare, perform, and analyze QM/MM simulations. Test applications presented here highlight the accuracy of this implementation, while the study of the GluRS:tRNA<sup><italic>Glu</italic></sup>:Glu-AMP complex revealed sub-atomic details of its reaction mechanism. Uniting Network Analysis results for the full complex with the first combination of the string method, parallel eABF, and QM/MM simulations, we provide a unique view for essential steps in establishing the genetic code (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 15</xref>). In summary, the ease of access through QwikMD and modularity in NAMD will permit this suite to be used in a variety of applications and contexts, including as a teaching tool, a research interface, a platform for mixing-and-matching QM/MM with free-energy and enhanced sampling methods, and even as a sandbox for the development of new QM tools and QM/MM interactions schemes.</p>
  <sec sec-type="methods" id="S1">
    <title>METHODS</title>
    <p id="P15">Methods, including statements of data availability and any associated accession codes and references, are available in the online version of the paper.</p>
  </sec>
  <sec id="S2">
    <title>ONLINE METHODS</title>
    <p id="P16">In order to study the chemistry of complex biological systems, in particular using MD approaches, one needs to combine QM and MM methods to secure sub-atomic resolution within relevant time and length scales. Yet, recent advances in implementations of QM calculations and hardware improvements are continuously improving our capacity to expand the complexity and comprehensiveness of QM results [<xref rid="R21" ref-type="bibr">21</xref>]. Hybrid QM/MM simulations in NAMD divide the system into “MM” and “QM” regions, using a classical force field to treat the classical atoms (or “MM atoms”), and passing the information that describes the quantum atoms in the system (or “QM atoms”) to a quantum chemistry package, which is expected to calculate forces for all QM atoms, as well as the total energy of the QM region (and optionally partial charges). All bonded and non-bonded interactions among MM atoms are handled by NAMD’s CHARMM force field, whereas all interactions among QM atoms are handled by the quantum chemistry package in its chosen theory level.</p>
    <p id="P17">The non-bonded interactions between QM and MM atoms can be modified and regulated by the user. Lennard-Jones interactions are always calculated by NAMD, and specific parameters can be provided for QM atoms. QM-specific modifications have been proposed in order to compensate for over-polarization that these atoms may exhibit in hybrid QM/MM simulations, though the importance of such modifications has been disputed [<xref rid="R22" ref-type="bibr">22</xref>]. In all simulations presented in this work, the standard CHARMM36 Lennard-Jones parameters were used for all MM and QM atoms.</p>
    <sec id="S3">
      <title>Mechanical and electrostatic embedding</title>
      <p id="P18">It is long known that electrostatics, particularly polarization, plays a key role in many biochemical processes [<xref rid="R23" ref-type="bibr">23</xref>]. Electrostatic interactions between QM and MM atoms deserve a more detailed discussion due to the abundance and diversity of available alternatives. In the “mechanical embedding” scheme, no electrostatic influences from MM atoms are accounted for while the QM package computes forces, charge distribution and energy in the QM region. Only positions and elements of atoms in the QM region are passed on to the QM package, and QM and MM atoms interact only through NAMD-calculated Lennard-Jones and electrostatic potentials (see below for special treatment of QM-MM bonds).</p>
      <p id="P19">In the “electrostatic embedding” scheme, on the other hand, the partial charges of MM atoms surrounding all QM atoms are used to approximate the electrostatic environment of the QM atoms. The selection of classical point charges can be done automatically by NAMD, in which case the “cutoff” value is used to effectively create a shell of point charges around the QM region. This type of embedding is the most frequently used in biomolecular simulations [<xref rid="R1" ref-type="bibr">1</xref>].</p>
      <p id="P20">Classical point charges handed over to the QM program to be utilized in electrostatic embedding can be altered by NAMD in a variety of ways. First by applying a smoothing function that avoids abrupt changes in electrostatic forces due to the cutoff used in the selection of surrounding point charges. Second, partial charges can be further modified so that their sum is a whole number or so that it amounts to a complementary charge to that of the QM region, in which case the sum of charges from QM atoms and classical partial charges add to zero. In the latter, the user is also able to select, atom by atom, which classical partial charges should be used when building the electrostatic embedding, providing further flexibility to the application.</p>
      <p id="P21">Irrespective of the chosen embedding method, the calculated charge distribution for QM atoms can be used by NAMD to update the partial charges of QM atoms for the calculation of short and long range electrostatic interactions. In particular, if particle-mesh Ewald (PME) [<xref rid="R24" ref-type="bibr">24</xref>] is being used, NAMD can apply the newly determined charges for QM atoms to the calculation of long range electrostatics in both QM and MM regions of the system. In this case, the necessary corrections are calculated as to subtract from the PME forces all interactions already calculated by the QM package between QM-QM atom pairs, and by NAMD’s QM module between QM-point charge pairs.</p>
      <p id="P22">PME forces and energy calculations in NAMD are carried out using classical charges for all classical atoms and the user’s choice between classical charges or updated charges for QM atoms. The forces and energy derived from PME interactions between QM atoms, and between QM atoms and the surrounding point charges are re-calculated within the QM module and subtracted from the direct electrostatic calculations, to avoid double counting these contributions. In order to test the impact of such implementation on the simulations, an energy conservation analysis was carried out comparing the use of PME in NAMD when the QM calculations are done using PM3 [<xref rid="R25" ref-type="bibr">25</xref>, <xref rid="R26" ref-type="bibr">26</xref>], HF-3C [<xref rid="R27" ref-type="bibr">27</xref>] and DFT methods (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 2</xref>).</p>
    </sec>
    <sec id="S4">
      <title>Treatment of covalent bonds involving QM and MM atoms</title>
      <p id="P23">Hybrid QM/MM simulations of biomolecular systems often present situations where only a part of a molecule should be treated quantum mechanically, usually to save computational resources since the cost of simulating QM regions rises rapidly with the number of atoms. In order to deal with chemical bonds that have one atom in the quantum mechanical (QM) region and another in the classical (MM) region (from here on called “QM-MM bonds”), NAMD offers several methods that can be combined to alter the molecular system in order to bridge differences in simulation type (QM vs MM), and minimize errors involved in the QM/MM division of the system. Irrespective of the selected methods to treat the QM-MM bond, the bonded term (between MM1 and QM1 atoms, see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3c</xref>) will still be calculated by NAMD, along with all proper and improper dihedral terms and angle terms that cross the QM/MM barrier but still involve at least one classical atom.</p>
    </sec>
    <sec id="S5">
      <title>Link atoms</title>
      <p id="P24">The most widely used method to cap the QM regions containing QM-MM bonds is the “link atom” approach [<xref rid="R28" ref-type="bibr">28</xref>], where an atom (usually a hydrogen atom) is placed along the bond between the QM atom and the MM atom (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3c</xref>), and does not exist in the classical simulation. The user can fine-tune this process by choosing the element and which method of link atom placement will be used: either fixed (the default) or variable. The former depends on a user-defined distance, which will be used throughout the simulation as <italic>d</italic><sub>L-QM</sub> (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3c</xref>). For the latter, a user-defined fraction is used to define <italic>C<sub>L</sub></italic> (see <xref ref-type="disp-formula" rid="FD2">Equation 2</xref>), and this fixed value is used by NAMD to calculate <italic>d</italic><sub>L-QM</sub> at every step as a function of <italic>d</italic><sub>MM-QM</sub>, which in turn varies over the course of the simulation due to bond vibration.</p>
      <p id="P25">In order to conserve force and energy, the total force acting on the link atom (<italic>F⃗<sub>L</sub></italic>), as calculated by the QM code, is redistributed by NAMD over the QM1 and MM1 atoms[<xref rid="R29" ref-type="bibr">29</xref>], and added to the total forces calculated on those atoms by the QM code and NAMD, respectively. <xref ref-type="disp-formula" rid="FD1">Equations 1</xref> and <xref ref-type="disp-formula" rid="FD3">3</xref> describe the calculation of the <italic>x</italic> component of the redistributed force applied on the QM1 and MM1 atoms, respectively. Analogous equations are used for the other two axes. Here, <italic>î<sub>x</sub></italic> is the unit vector on the <italic>x</italic> axis, <italic>r̂<sub>MM−QM</sub></italic> is the unit vector in the QM-MM bond direction, and <italic>x</italic><sub>MM</sub> and <italic>x</italic><sub>QM</sub> are the <italic>x</italic> components of the positions of the MM1 and QM1 atoms, respectively.
<disp-formula id="FD1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">QM</mml:mtext><mml:msub><mml:mn>1</mml:mn><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>L</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mo stretchy="true">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>i</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>x</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mtext mathvariant="italic">MM</mml:mtext></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mtext mathvariant="italic">QM</mml:mtext></mml:msub></mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub></mml:mfrac><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="true">]</mml:mo></mml:math></disp-formula>where
<disp-formula id="FD2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula></p>
      <p id="P26">Similarly,
<disp-formula id="FD3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:msub><mml:mn>1</mml:mn><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>L</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mo stretchy="true">[</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>i</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>x</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mtext mathvariant="italic">MM</mml:mtext></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mtext mathvariant="italic">QM</mml:mtext></mml:msub></mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub></mml:mfrac><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">QM</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="true">]</mml:mo><mml:mo>.</mml:mo></mml:math></disp-formula></p>
      <p id="P27">The link atom is not the only proposed method to handle QM-MM bonds, but it is the only one that relies entirely on the classical side of a QM/MM simulation, over which we have complete control. Therefore, irrespective of which QM package is chosen to carry out the QM calculations of the simulation, NAMD’s QM/MM interface always guarantees the creation of proper conditions to simulate QM-MM bonds, which grants its great flexibility.</p>
    </sec>
    <sec id="S6">
      <title>Point charge alteration and redistribution</title>
      <p id="P28">In any system containing a QM-MM bond, the link atom will invariably be placed very near the MM1 atom, which would create very strong electrostatic repulsion forces (or attractions) in case the MM1 partial charge was sent to the QM package for its calculations. Under the “mechanical embedding” scheme, the QM package only receives the atoms in the QM region and the link atoms created to approximate QM-MM bonds, so no manipulation of partial charges is required. On the other hand, the more usual “electrostatic embedding” scheme requires special treatment of nearby classical partial charges.</p>
      <p id="P29">Several methods have been proposed to handle the conditioning of classical partial charges surrounding a QM-MM bond, and the QM/MM interface developed here offers the most widely accepted ones (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4</xref>). In all methods implemented here, the classical atom participating in the QM-MM bond (MM1 atom) does not have its partial charge passed on to the QM package, since this would create excessive repulsion (or attraction) on the Link atom. This is, in fact, the entirety of the “Z1” method: ignoring the partial charge of the MM1 atom[<xref rid="R30" ref-type="bibr">30</xref>]. Analogously, Z2 ignores the MM1 partial charge and all partial charges of atoms bound to MM1, called “MM2 atoms”, and Z3 extends the approach by ignoring all partial charges of atoms bound to MM2 atoms, called “MM3 atoms” (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4b–d</xref>).</p>
      <p id="P30">The Charge Shifting (CS) method[<xref rid="R31" ref-type="bibr">31</xref>] (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4e</xref>) is more elaborate, as it rearranges the partial charge of the MM1 atom (indicated here as <italic>q<sub>M</sub></italic><sub>1</sub>) so that the total charge of the region is maintained, while approximating the dipole moments of the bonds between MM1 and MM2 atoms. This is done by creating “virtual” point charges that are passed to the QM package as if they represented partial charges of classical atoms. In this case, the MM1 partial charge is equally distributed across the MM2 atoms, as indicated in the figure with the placement of the charge <italic>q</italic><sub>1</sub> at the position of MM2 atoms (where <italic>q</italic><sub>1</sub> = <italic>q</italic><sub><italic>M</italic>1</sub>/2), and the coefficient used in <xref ref-type="disp-formula" rid="FD4">Equations 4</xref> and <xref ref-type="disp-formula" rid="FD5">5</xref> to redistribute the force on this virtual charge is given by 
<inline-formula><mml:math id="M4" overflow="scroll"><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>Q</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>. Moreover, two virtual point charges are placed along the direction of the MM1-MM2 bond, one before the MM2 atom (<italic>q</italic><sub>+</sub> = <italic>q</italic><sub>0</sub>) and one after (<italic>q</italic><sub>−</sub> = −1 · <italic>q</italic><sub>0</sub>). In our implementation, 
<inline-formula><mml:math id="M5" overflow="scroll"><mml:msub><mml:mi>C</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mo>+</mml:mo></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mn>0.94</mml:mn></mml:math></inline-formula>, while 
<inline-formula><mml:math id="M6" overflow="scroll"><mml:msub><mml:mi>C</mml:mi><mml:mo>−</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mo>−</mml:mo></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mn>1.06</mml:mn></mml:math></inline-formula> (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4e</xref>). This method will keep the total charge of the region constant while trying to preserve the local dipoles formed by all MM1-MM2 bonds.</p>
      <p id="P31">The Redistributed Charge and Dipole (RCD) method [<xref rid="R30" ref-type="bibr">30</xref>] (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4f</xref>) follows a similar arrangement. A virtual point charge is created in the middle of all MM1-MM2 bonds (<italic>C</italic><sub>2</sub> = <italic>d</italic><sub><italic>M</italic>1−<italic>Q</italic>2</sub> /<italic>d</italic><sub><italic>M</italic>1−<italic>M</italic>2</sub> = 0.5) with a charge <italic>q</italic><sub>2</sub> = 2 · <italic>q</italic><sub><italic>M</italic>1</sub>/2, and a charge <italic>q</italic><sub>1</sub> = −1 · <italic>q</italic><sub><italic>M</italic>1</sub>/2 is placed in the positions of all MM2 atoms (<italic>C</italic><sub>1</sub> = 1). This arrangement still maintains the total charge of the region constant, while attmpting to mimic local dipoles.</p>
      <p id="P32">In all cases where a virtual charge is created, a force is calculated on it as to balance its electrostatic interactions with QM atoms. Similarly to the Link atom, the total force acting on, e.g., the virtual point charge “<italic>q</italic><sub>+</sub>” (<italic>F⃗</italic><sub><italic>q</italic><sub>+</sub></sub>) is redistributed over the MM1 and MM2 atoms that were used to define it. The fraction of the total force that is applied on the MM1 and MM2 atoms is defined, respectively, by
<disp-formula id="FD4"><label>(4)</label><mml:math id="M7" display="block" overflow="scroll"><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:msub><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mn>1</mml:mn></mml:msub></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:msub><mml:mi>q</mml:mi><mml:mo>+</mml:mo></mml:msub></mml:msub></mml:math></disp-formula>and
<disp-formula id="FD5"><label>(5)</label><mml:math id="M8" display="block" overflow="scroll"><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:msub><mml:mtext mathvariant="italic">MM</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mover><mml:mi>F</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:msub><mml:mi>q</mml:mi><mml:mo>+</mml:mo></mml:msub></mml:msub><mml:mo>.</mml:mo></mml:math></disp-formula></p>
    </sec>
    <sec id="S7">
      <title>Implementation and interaction with quantum chemistry packages</title>
      <p id="P33">The implementation of the QM/MM module in NAMD was done entirely in C/C++, making use of Charm++ message-driven load balancing tools so that simulations can be run in parallel over one or several computer nodes. All quantum mechanical calculations are offloaded to a QM package, either through hard-coded interfaces to ORCA [<xref rid="R16" ref-type="bibr">16</xref>] or MOPAC [<xref rid="R14" ref-type="bibr">14</xref>, <xref rid="R15" ref-type="bibr">15</xref>], or through a standardized interface that utilizes Python scripts (or any other tool) to wrap and convert input and output formats between NAMD and any other arbitrary QM package. A standardized interface was created for data I/O so that external wrapper scripts can be called, providing a translation layer for input and output files from any other QM package. We provide Python scripts that wrap Gaussian [<xref rid="R32" ref-type="bibr">32</xref>], TeraChem [<xref rid="R33" ref-type="bibr">33</xref>], and Q-CHEM [<xref rid="R34" ref-type="bibr">34</xref>], which also serve as templates for the development of new wrapper scripts.</p>
      <p id="P34">In general, positions and elements of QM atoms are passed on the QM package along with positions and magnitudes of partial charges representing the local MM environment. In return, NAMD expects forces, total energy, and partial charges for QM atoms, and possibly forces acting on MM partial charges due to electrostatic interactions. The exchange of information between NAMD and quantum chemistry packages is preferably done through files written to RAM, which take an insignificant amount of time (milliseconds) when compared to the time scale of QM calculations (seconds or more). By not embedding the QM code directly into NAMD, we allow users to choose their preferred quantum chemistry package and level of theory.</p>
      <p id="P35">Additionally, NAMD takes advantage of the current advanced state of quantum chemistry packages, which are prepared to be sequentially called by an external software, such as in a QM/MM context. After an SCF calculation on a given set of atoms, a “state-files” containing the result of the SCF procedure is saved. A much faster convergence is achieved in the following SCF calculation when the QM package is re-initialized using the saved state-files, as it is already initialized with a very close “guess” of what the SCF solution should be. This occurs because atom positions vary only slightly between consecutive calculations.</p>
      <p id="P36">Multiple QM regions can be simulated through simultaneous and independent executions of the chosen QM package, one per independent QM region defined in the biomolecular system.</p>
    </sec>
    <sec id="S8">
      <title>MD simulations of test systems and ttGluRS</title>
      <p id="P37">Structures for the test systems and for ttGluRS were prepared for classical and QM/MM MD simulations employing VMD’s [<xref rid="R11" ref-type="bibr">11</xref>] QwikMD [<xref rid="R12" ref-type="bibr">12</xref>] graphical interface. While QwikMD assists users in selecting QM regions residue-by-residue through a point-and-click interface, other methods have been developed to provide automated QM region selection [<xref rid="R35" ref-type="bibr">35</xref>]. The structure of the pre-transfer complex ttGluRS:tRNA<sup><italic>Glu</italic></sup>:Glu-AMP had been previously solved by means of X-ray crystallography at 2.1Å resolution and is available at the protein data bank (PDB:1N78) [<xref rid="R36" ref-type="bibr">36</xref>], with the replacement of the inert analog for the active Glu-AMP [<xref rid="R19" ref-type="bibr">19</xref>]. The simulations in the present study were performed employing the NAMD molecular dynamics package [<xref rid="R9" ref-type="bibr">9</xref>], MOPAC 2016 [<xref rid="R14" ref-type="bibr">14</xref>, <xref rid="R15" ref-type="bibr">15</xref>], using PM7 [<xref rid="R37" ref-type="bibr">37</xref>], and ORCA 4.0 [<xref rid="R16" ref-type="bibr">16</xref>]. The CHARMM36 force field [<xref rid="R38" ref-type="bibr">38</xref>] along with the TIP3P water model, for solvated tests, was used to describe all systems. All calculations involving the ttGluRS:tRNA<sup><italic>Glu</italic></sup>:Glu-AMP system, were done in the NpT ensemble. In energy conservation tests, the simulations used either the PM3 [<xref rid="R25" ref-type="bibr">25</xref>, <xref rid="R26" ref-type="bibr">26</xref>] method (using NAMD’s ORCA interface) or RM1 [<xref rid="R39" ref-type="bibr">39</xref>] (using NAMD’s MOPAC interface). Results from Amber used its SQM implementation for both PM3 and RM1.</p>
      <p id="P38">For solvated systems, the simulations were carried out under periodic boundary conditions. Simulations were performed in many steps to ensure a reasonable starting conformation for QM-based simulations: (1) First, for systems explicitly solvated, we employed classical MD in the NpT ensemble with temperature maintained at 300 K using Langevin dynamics for both pressure, kept at 1 bar, and temperature coupling. (2) Using the same parameters from classical NpT simulations, QM-based NpT simulations (either pure-QM or hybrid QM/MM) were carried out. (3) For energy conservation tests, QM-based simulations were performed in the NVE ensemble.</p>
      <p id="P39">A distance cut-off of 12.0 Å or 17.0 Å (eABF calculations) was applied to short-range, non-bonded interactions, whereas long-range electrostatic interactions were treated using the particle-mesh Ewald (PME) [<xref rid="R24" ref-type="bibr">24</xref>] method. For equilibration and classical MM simulations, the equations of motion were integrated using the r-RESPA multiple time step scheme [<xref rid="R9" ref-type="bibr">9</xref>]. For all production QM/MM simulations, the van der Waals interactions as well as electrostatic interactions were updated every time step. The time step of integration was chosen to be either 0.5 fs or 2.0 fs (see details bellow).</p>
      <p id="P40">The MonoAlanine system is composed of a single alanine residue in vacuum (gas phase). In <xref ref-type="fig" rid="F1">Fig. 1b</xref>, the simulations for verification of energy conservation were carried out as described above with 0.5 fs time step.</p>
      <p id="P41">The PolyAla system is composed of 3 Alanine residues. The same system was used in different ways, either in vacuum or in solution (TIP3 water), with either all 3 residues treated quantum mechanically, or just the central residue as a QM region, leading to the use of 2 Link atoms (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3a and b</xref>). In <xref ref-type="fig" rid="F1">Fig. 1c</xref>, the system is used in vacuum, with the middle residue being treated quantum mechanically. In <xref ref-type="fig" rid="F1">Fig. 1e</xref>, the system is used in solution, with the all three residues treated quantum mechanically, and the water molecules treated classically, as also shown in <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2a</xref> for the NAMD/ORCA interface. Simulations were performed with 0.5 fs time step and the Charge Shift treatment was used for Link Atoms. To reproduce previously reported energy conservation results in Amber, the SPC/FW water model was used in all Amber QM/MM simulations.</p>
      <p id="P42">Analogously, the N-methyl acetamide (NMA) system was simulated either in vacuum or in solution (TIP3 water), but always entirely treated with QM formalism. In <xref ref-type="fig" rid="F1">Fig. 1d</xref>, the system is used in vacuum (gas phase), with the entire molecule being treated quantum mechanically. Simulations were performed with both 0.5 fs and 2.0 fs time step, as shown in <xref ref-type="fig" rid="F1">Fig. 1d</xref>.</p>
    </sec>
    <sec id="S9">
      <title>Network Analysis</title>
      <p id="P43">Suboptimal communication pathways and communities were calculated based on Pearson cross-correlation of atom motion, using a similar protocol to the one described in [<xref rid="R18" ref-type="bibr">18</xref>]. Our calculations were based on ten QM/MM trajectories that used 2 fs time steps for a total of 100 ps, totaling 1 ns of QM/MM simulations. For this system two independent QM regions were employed, one in the anticodon domain with approximately 500 QM atoms, one in the catalytic region with approximately 200 QM atoms. Briefly, the network analysis protocol uses central atoms (alpha-carbons in amino acids, the N1/N9 in nucleic bases, and the sugar phosphate P) called “nodes” as proxy for the motion of residues, and their positions throughout MD simulations are used to calculate the Pearson cross-correlation of motion. Only nodes from residues whose non-hydrogen atoms were less than 4.5Å apart for more than 75% of the total simulated time are considered connected [<xref rid="R40" ref-type="bibr">40</xref>]. Nodes that do not fit this cutoff have their cross-correlation multiplied by zero through a mask applied on the cross-correlation matrix. The resulting set of correlations between connected nodes forms a weighted matrix that is used by the Floyd–Warshall algorithm to find shortest communication paths between nodes (called “suboptimal paths”), and by the Girvan–Newman algorithm to find optimal communities between highly interacting nodes. The suboptimal paths represent the shortest set of connected nodes that could transmit information from two distant sites, such as an allosteric regulator site and an enzyme’s active site.</p>
    </sec>
    <sec id="S10">
      <title>QM/MM Simulations</title>
      <p id="P44">To study the reaction mechanism of the ttGluRS:tRNA<sup><italic>Glu</italic></sup>:Glu-AMP system, first a 200 ps QM/MM simulation was performed with 2 fs time step, followed by a 50 ps QM/MM simulation with 0.5 fs time step. These two simulations were used to equilibrate the system in a conformation that was favorable for the reaction mechanism to be investigated. Four mechanisms were tested by inducing the reaction steps to occur (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 10</xref>). The four biased simulations were performed with 0.5 fs time step for 20 to 100 ps. All simulations were carried out using the Charge Shift method to treat Link Atoms, and a “Shift” function was applied to surrounding classical partial charges in the electrostatic embedding scheme.</p>
    </sec>
    <sec id="S11">
      <title>String Method and eABF</title>
      <p id="P45">In order to study a transformation that occurs in a biomolecular system, such as a chemical reaction or a conformational change, one defines collective variables such as distances between atoms, between centers of mass of groups of atoms, or even angles between subdomains of a molecular structure. The collective variables (colvars for short) are used to track the changes in the system as it undergoes the transformation being studied, and can be used to define a reaction coordinate.</p>
      <p id="P46">The string method is an iterative process that optimizes a reaction coordinate in order to find the path of least resistance from the initial to the final state of the system. The method uses a discretized representation of the reaction coordinate composed of “images”, where each image is a copy of the entire simulated system at different stages of the transformation. At each iteration, multiple independent MD simulations are initiated from each image, allowing the systems to explore their energy surface and drift toward local minima. Then, average values for the colvars are determined, and biases are applied to keep consecutive images approximately equidistant in colvars space, and to smooth the reaction coordinate. The iterations proceed until consecutive calculations do not produce significant changes in the mean colvar values, indicating convergence of the method.</p>
      <p id="P47">Once the string has been optimized, the images are used to define a continuous path that defines the transformation, and eABF (extended-Adaptive Biasing Force) is used to calculate free energy changes. Using the images that were optimized through the string method, new path collective variables <italic>S</italic> and <italic>Z</italic> are created, which constrain the dynamics of the system so it follows the chosen reaction coordinate. The <italic>S</italic> variable indicates progression along the path, while the <italic>Z</italic> variable indicates a perpendicular distance to the path. Taking advantage of NAMD’s outstanding scalability and NCSA’s Blue Waters supercomputer, we used a parallel strategy that initiates multiple walkers from the different images, we could conduct extensive sampling over the defined path.</p>
    </sec>
    <sec id="S12">
      <title>Code availability</title>
      <p id="P48">The reported QM/MM features are publicly available in NAMD 2.12 or later, and VMD 1.9.4 or later. See <ext-link ext-link-type="uri" xlink:href="http://www.ks.uiuc.edu/Research/qmmm">www.ks.uiuc.edu/Research/qmmm</ext-link> for more details. A Tutorial is available in the same website.</p>
      <p id="P49">ORCA is available at <ext-link ext-link-type="uri" xlink:href="https://orcaforum.cec.mpg.de">https://orcaforum.cec.mpg.de</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://www.faccts.de">https://www.faccts.de</ext-link>.</p>
    </sec>
    <sec id="S13">
      <title>Data availability</title>
      <p id="P50">The data that support the findings of this study are available from the corresponding author upon reasonable request.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS947830-supplement-1.pdf" orientation="portrait" xlink:type="simple" id="d36e1437" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS947830-supplement-2.pdf" orientation="portrait" xlink:type="simple" id="d36e1441" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>video 1</label>
      <media xlink:href="NIHMS947830-supplement-video_1.mov" orientation="portrait" xlink:type="simple" id="d36e1445" position="anchor" mimetype="video"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S14">
    <p id="P51">The authors thank M. F. Herbst, C. Chipot and G. Fiorin for helpful discussions. This work was supported by National Science Foundation (NSF) grants MCB-1616590 and MCB-1244570, and National Institutes of Health (NIH) grant P41-GM104601. Z.L.S. acknowledges support from the NSF PHY1430124. M.C.R.M. and Z.L.S. acknowledge support from the Keck Foundation (grant no. 206231). T.R. acknowledges support as a Feodor Lynen von Humboldt Postdoctoral Fellow. J.D.C.M acknowledges a fellowship from the Brazilian Coordination for Improvement of Higher Educational Personnel (CAPES). G.B.R. acknowledges support from the Brazilian National Council for Scientific and Technological Development (CNPq 305271/2013-0), and CAPES AUXPE1375/2014. F.N. and C.R. acknowledge support for the development of ORCA by the Max Planck society (MPG) and the Germans Science Foundation (DFG). This research made use of the Blue Waters sustained-petascale computing, which is supported by the state of Illinois and the NSF OCI-0725070 and ACI-1238993. This work is part of the Petascale Computational Resource (PRAC) grant, which is supported by the NSF ACI-1713784.</p>
  </ack>
  <fn-group>
    <fn id="FN4" fn-type="con">
      <p id="P52">
        <bold>AUTHOR CONTRIBUTIONS</bold>
      </p>
      <p id="P53">M.C.R.M, R.C.B., T.R., K.S. and Z.L.S. conceived the project. M.C.R.M implemented the QM/MM interface. R.C.B., T.R., M.C.R.M., G.B.R., and K.S. discussed QM/MM features. J.D.C.M., G.B.R., C.R. and F.N. provided guidance on the QM/MM interface development. J.C.P. assisted in adapting NAMD. M.C.R.M, and M.S. prepared Python scripts for the interfaces of selected QM software packages. R.C.B. and M.C.R.M performed all NAMD tests and simulations. J.D.C.M. and G.B.R. performed Amber calculations. R.C.B. and M.C.R.M performed all free energy calculations and analysis. M.S., and J.E.S. implemented the orbital visualization in VMD. J.V.R., and J.E.S. implemented QM/MM graphical interface in QwikMD. R.C.B., M.C.R.M., T.R., M.S., G.B.R., F.N., and Z.L.S. wrote and edited the manuscript. K.S., and Z.L.S. supervised the project.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN5">
      <p id="P54">
        <bold>COMPETING FINANCIAL INTERESTS</bold>
      </p>
      <p id="P55">The authors declare no competing financial interests.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Senn</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Thiel</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>QM/MM methods for biomolecular systems</article-title>
        <source>Angew. Chem. Int. Ed. Engl</source>
        <volume>48</volume>
        <fpage>1198</fpage>
        <lpage>229</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19173328</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Field</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Bash</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Karplus</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>A combined quantum mechanical and molecular mechanical potential for molecular dynamics simulations</article-title>
        <source>J. Comput. Chem</source>
        <volume>11</volume>
        <fpage>700</fpage>
        <lpage>733</lpage>
        <year>1990</year>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der Kamp</surname>
            <given-names>MW</given-names>
          </name>
          <name>
            <surname>Mulholland</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <article-title>Combined quantum mechanics/molecular mechanics (QM/MM) methods in computational enzymology</article-title>
        <source>Biochemistry</source>
        <volume>52</volume>
        <fpage>2708</fpage>
        <lpage>2728</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23557014</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bernardi</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Pascutti</surname>
            <given-names>PG</given-names>
          </name>
        </person-group>
        <article-title>Hybrid QM/MM Molecular Dynamics Study of Benzocaine in a Membrane Environment: How Does a Quantum Mechanical Treatment of Both Anesthetic and Lipids Affect Their Interaction</article-title>
        <source>J. Chem. Theor. Comp</source>
        <volume>8</volume>
        <fpage>2197</fpage>
        <lpage>2203</lpage>
        <year>2012</year>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Retegan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Neese</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Pantazis</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Convergence of QM/MM and Cluster Models for the Spectroscopic Properties of the Oxygen-Evolving Complex in Photosystem II</article-title>
        <source>J. Chem. Theory Comput</source>
        <volume>9</volume>
        <fpage>3832</fpage>
        <lpage>3842</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">26584129</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Coquelle</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Chromophore twisting in the excited state of a photoswitchable fluorescent protein captured by time-resolved serial femtosecond crystallography</article-title>
        <source>Nature Chemistry</source>
        <year>2017</year>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Truhlar</surname>
            <given-names>DG</given-names>
          </name>
        </person-group>
        <article-title>QM/MM: what have we learned, where are we, where do we go from here?</article-title>
        <source>Theor. Chim. Acta</source>
        <volume>117</volume>
        <fpage>185</fpage>
        <lpage>199</lpage>
        <year>2007</year>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jindal</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Warshel</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Exploring the dependence of QM/MM calculations of enzyme catalysis on the size of the QM region</article-title>
        <source>J. Phys. Chem. B</source>
        <volume>120</volume>
        <fpage>9913</fpage>
        <lpage>9921</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27552257</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Phillips</surname>
            <given-names>JC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scalable molecular dynamics with NAMD</article-title>
        <source>J. Comput. Chem</source>
        <volume>26</volume>
        <fpage>1781</fpage>
        <lpage>1802</lpage>
        <year>2005</year>
        <pub-id pub-id-type="pmid">16222654</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Generalized scalable multiple copy algorithms for molecular dynamics simulations in NAMD</article-title>
        <source>Comput. Phys. Commun</source>
        <volume>185</volume>
        <fpage>908</fpage>
        <lpage>916</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24944348</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Humphrey</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Dalke</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schulten</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>VMD: visual molecular dynamics</article-title>
        <source>J. Mol. Graphics</source>
        <volume>14</volume>
        <fpage>33</fpage>
        <lpage>38</lpage>
        <year>1996</year>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ribeiro</surname>
            <given-names>JV</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>QwikMD Integrative Molecular Dynamics Toolkit for Novices and Experts</article-title>
        <source>Sci. Rep</source>
        <volume>6</volume>
        <fpage>1</fpage>
        <lpage>14</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">28442746</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Shao</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Chipot</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Extended Adaptive Biasing Force Algorithm. An On-the-Fly Implementation for Accurate Free-Energy Calculations</article-title>
        <source>J. Chem. Theory Comput</source>
        <volume>12</volume>
        <fpage>3506</fpage>
        <lpage>3513</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27398726</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stewart</surname>
            <given-names>JJ</given-names>
          </name>
        </person-group>
        <article-title>MOPAC: a semiempirical molecular orbital program</article-title>
        <source>J. Comput.-Aided Mol. Des</source>
        <volume>4</volume>
        <fpage>1</fpage>
        <lpage>103</lpage>
        <year>1990</year>
        <pub-id pub-id-type="pmid">2197373</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maia</surname>
            <given-names>JDC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GPU linear algebra libraries and GPGPU programming for accelerating MOPAC semiempirical quantum chemistry calculations</article-title>
        <source>J. Chem. Theor. Comp</source>
        <volume>8</volume>
        <fpage>3072</fpage>
        <lpage>3081</lpage>
        <year>2012</year>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Neese</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Software update: the ORCA program system, version 4.0</article-title>
        <source>Wiley Interdisciplinary Reviews: Computational Molecular Science</source>
        <volume>8</volume>
        <fpage>e1327</fpage>
        <year>2018</year>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Götz</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Clark</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Walker</surname>
            <given-names>RC</given-names>
          </name>
        </person-group>
        <article-title>An extensible interface for QM/MM molecular dynamics simulations with AMBER</article-title>
        <source>J. Comput. Chem</source>
        <volume>35</volume>
        <fpage>95</fpage>
        <lpage>108</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24122798</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sethi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Eargle</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Black</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Luthey-Schulten</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Dynamical networks in tRNA:protein complexes</article-title>
        <source>Proc. Natl. Acad. Sci</source>
        <volume>106</volume>
        <fpage>6620</fpage>
        <lpage>6625</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19351898</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Black Pyrkosz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Eargle</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sethi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Luthey-Schulten</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>Exit Strategies for Charged tRNA from GluRS</article-title>
        <source>J. Mol. Biol</source>
        <volume>397</volume>
        <fpage>1350</fpage>
        <lpage>1371</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20156451</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pan</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Sezer</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Roux</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Finding Transition Pathways Using the String Method with Swarms of Trajectories</article-title>
        <source>J. Phys. Chem. B</source>
        <volume>112</volume>
        <fpage>3432</fpage>
        <lpage>3440</lpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18290641</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Riplinger</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pinski</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Becker</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Valeev</surname>
            <given-names>EF</given-names>
          </name>
          <name>
            <surname>Neese</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Sparse maps-A systematic infrastructure for reduced-scaling electronic structure methods. II. Linear scaling domain based pair natural orbital coupled cluster theory</article-title>
        <source>J. Chem. Phys</source>
        <volume>144</volume>
        <fpage>024109</fpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">26772556</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Riccardi</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Cui</surname>
            <given-names>Q</given-names>
          </name>
        </person-group>
        <article-title>Importance of van der Waals Interactions in QM/MM Simulations</article-title>
        <source>J. Phys. Chem. B</source>
        <volume>108</volume>
        <fpage>6467</fpage>
        <lpage>6478</lpage>
        <year>2004</year>
        <pub-id pub-id-type="pmid">18950136</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Warshel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Levitt</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Theoretical studies of enzymic reactions: dielectric, electrostatic and steric stabilization of the carbonium ion in the reaction of lysozyme</article-title>
        <source>J. Mol. Biol</source>
        <volume>103</volume>
        <fpage>227</fpage>
        <lpage>249</lpage>
        <year>1976</year>
        <pub-id pub-id-type="pmid">985660</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Darden</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>York</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Pedersen</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Particle mesh Ewald: An Nlog(N) method for Ewald sums in large systems</article-title>
        <source>J. Chem. Phys</source>
        <volume>98</volume>
        <fpage>10089</fpage>
        <lpage>10092</lpage>
        <year>1993</year>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stewart</surname>
            <given-names>JJP</given-names>
          </name>
        </person-group>
        <article-title>Optimization of parameters for semiempirical methods I. Method</article-title>
        <source>J. Comput. Chem</source>
        <volume>10</volume>
        <fpage>209</fpage>
        <lpage>220</lpage>
        <year>1989</year>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stewart</surname>
            <given-names>JJP</given-names>
          </name>
        </person-group>
        <article-title>Optimization of parameters for semiempirical methods II. Applications</article-title>
        <source>J. Comput. Chem</source>
        <volume>10</volume>
        <fpage>221</fpage>
        <lpage>264</lpage>
        <year>1989</year>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sure</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Grimme</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Corrected small basis set Hartree-Fock method for large systems</article-title>
        <source>J. Comput. Chem</source>
        <volume>34</volume>
        <fpage>1672</fpage>
        <lpage>1685</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23670872</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Singh</surname>
            <given-names>UC</given-names>
          </name>
          <name>
            <surname>Kollman</surname>
            <given-names>PA</given-names>
          </name>
        </person-group>
        <article-title>A combined ab initio quantum mechanical and molecular mechanical method for carrying out simulations on complex molecular systems: Applications to the CH3Cl + Cl exchange reaction and gas phase protonation of polyethers</article-title>
        <source>J. Comput. Chem</source>
        <volume>7</volume>
        <fpage>718</fpage>
        <lpage>730</lpage>
        <year>1986</year>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Walker</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Crowley</surname>
            <given-names>MF</given-names>
          </name>
          <name>
            <surname>Case</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>The implementation of a fast and accurate QM/MM potential method in Amber</article-title>
        <source>J. Comput. Chem</source>
        <volume>29</volume>
        <fpage>1019</fpage>
        <lpage>1031</lpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18072177</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Truhlar</surname>
            <given-names>DG</given-names>
          </name>
        </person-group>
        <article-title>Redistributed charge and dipole schemes for combined quantum mechanical and molecular mechanical calculations</article-title>
        <source>J. Phys. Chem. A</source>
        <volume>109</volume>
        <fpage>3991</fpage>
        <lpage>4004</lpage>
        <year>2005</year>
        <pub-id pub-id-type="pmid">16833721</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sherwood</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Computer simulation of zeolite structure and reactivity using embedded cluster methods</article-title>
        <source>Faraday Discuss</source>
        <volume>106</volume>
        <fpage>79</fpage>
        <lpage>92</lpage>
        <year>1997</year>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frisch</surname>
            <given-names>MJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gaussian 09, Revision A.02</article-title>
        <source>Gaussian Inc. Wallingford CT</source>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Titov</surname>
            <given-names>AV</given-names>
          </name>
          <name>
            <surname>Ufimtsev</surname>
            <given-names>IS</given-names>
          </name>
          <name>
            <surname>Luehr</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Martinez</surname>
            <given-names>TJ</given-names>
          </name>
        </person-group>
        <article-title>Generating Efficient Quantum Chemistry Codes for Novel Architectures</article-title>
        <source>J. Chem. Theory Comput</source>
        <volume>9</volume>
        <fpage>213</fpage>
        <lpage>221</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">26589024</pub-id>
      </element-citation>
    </ref>
    <ref id="R34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Advances in molecular quantum chemistry contained in the Q-Chem 4 program package</article-title>
        <source>Mol. Phys</source>
        <volume>113</volume>
        <fpage>184</fpage>
        <lpage>215</lpage>
        <year>2015</year>
      </element-citation>
    </ref>
    <ref id="R35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kulik</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Klinman</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Martínez</surname>
            <given-names>TJ</given-names>
          </name>
        </person-group>
        <article-title>How Large Should the QM Region Be in QM/MM Calculations? The Case of Catechol O-Methyltransferase</article-title>
        <source>J. Phys. Chem. B</source>
        <volume>120</volume>
        <fpage>11381</fpage>
        <lpage>11394</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27704827</pub-id>
      </element-citation>
    </ref>
    <ref id="R36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sekine</surname>
            <given-names>S-i</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ATP binding by glutamyl-tRNA synthetase is switched to the productive mode by tRNA binding</article-title>
        <source>EMBO J</source>
        <volume>22</volume>
        <fpage>676</fpage>
        <lpage>688</lpage>
        <year>2003</year>
        <pub-id pub-id-type="pmid">12554668</pub-id>
      </element-citation>
    </ref>
    <ref id="R37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stewart</surname>
            <given-names>JJP</given-names>
          </name>
        </person-group>
        <article-title>Optimization of parameters for semiempirical methods VI: more modifications to the NDDO approximations and re-optimization of parameters</article-title>
        <source>J. Mol. Model</source>
        <volume>19</volume>
        <fpage>1</fpage>
        <lpage>32</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23187683</pub-id>
      </element-citation>
    </ref>
    <ref id="R38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Best</surname>
            <given-names>RB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Optimization of the Additive CHARMM All-Atom Protein Force Field Targeting Improved Sampling of the Backbone <italic>φ, ψ</italic> and Side-Chain <italic>χ</italic> 1and <italic>χ</italic> 2Dihedral Angles</article-title>
        <source>J. Chem. Theor. Comp</source>
        <volume>8</volume>
        <fpage>3257</fpage>
        <lpage>3273</lpage>
        <year>2012</year>
      </element-citation>
    </ref>
    <ref id="R39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dutra</surname>
            <given-names>JDL</given-names>
          </name>
          <name>
            <surname>Filho</surname>
            <given-names>MAM</given-names>
          </name>
          <name>
            <surname>Rocha</surname>
            <given-names>GB</given-names>
          </name>
          <name>
            <surname>Simas</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Freire</surname>
            <given-names>RO</given-names>
          </name>
        </person-group>
        <article-title>RM1 Semiempirical Quantum Chemistry: Parameters for Trivalent Lanthanum, Cerium and Praseodymium</article-title>
        <source>PLoS One</source>
        <volume>10</volume>
        <fpage>e0124372</fpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26132289</pub-id>
      </element-citation>
    </ref>
    <ref id="R40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schoeler</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping mechanical force propagation through biomolecular complexes</article-title>
        <source>Nano Lett</source>
        <volume>15</volume>
        <fpage>7370</fpage>
        <lpage>7376</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26259544</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <title>Hybrid QM/MM NAMD</title>
      <p id="P56"><bold>a)</bold> Schematic of NAMD-ORCA interconnection. The contribution of MM charges beyond r<sub><italic>max</italic></sub> are calculated by NAMD (via PME), while ORCA calculates direct electrostatics. <bold>b)</bold> Energy conservation test for a pure-QM alanine molecule. All energy conservation plots display the deviation from the mean system energy. The black line indicates a running average and the gray line indicates maximal fluctuation. <bold>c)</bold> Energy conservation test for a QM/MM tri-alanine molecule. <bold>d)</bold> Energy conservation test for a QM/MM tri-alanine molecule in water. The basis set employed in ORCA tests (3-21G) serves only as a technical test. <bold>e)</bold> Energy conservation test for a pure-QM NMA molecule using NAMD/MOPAC with PM7.</p>
    </caption>
    <graphic xlink:href="nihms947830f1"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <title>Hybrid QM/MM VMD features</title>
      <p id="P57"><bold>a)</bold> QwikMD provides a graphical user interface (GUI) in VMD for performing QM/MM simulations. The image shows the workflow to prepare, run, analyze, and visualize a hybrid QM/MM molecular dynamics simulation. <bold>b)</bold> Highest occupied molecular orbital of an alanine molecule in vacuum. <bold>c)</bold> Alanine’s highest occupied molecular orbital in a solvated QM/MM tri-alanine. <bold>d)</bold> Trp-Cage protein highest occupied molecular orbital in water solution.</p>
    </caption>
    <graphic xlink:href="nihms947830f2"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <title>Mechanism of glutamyl-tRNA synthetase</title>
      <p id="P58"><bold>a)</bold> Representation of the glutamyl-tRNA synthetase allosteric pathway (red). Two independent QM regions are highlighted, indicating the active site (blue) and the anticodon binding region (green). <bold>b)</bold> Community analysis showing multiple communities involved in the active site. <bold>c)</bold> Reaction mechanism of glutamyl-tRNA synthetase. <bold>d)</bold> Intermediate state of the glutamyl-tRNA synthetase reaction showing the highest occupied molecular orbital. <bold>e)</bold> Free energy profile of the glutamyl-tRNA synthetase reaction mechanism, calculated using eABF after a string method path optimization. Both eABF and the string method were performed using QM/MM MD simulations with NAMD/MOPAC and PM7. <bold>f)</bold> Free energy profile of the distancing and solvation of AMP calculated using ABF and classical MD simulations. <bold>g)</bold> Snapshot of the minimum energy state during the release of the AMP, showing the solvation of the phosphate group. The eABF free energy profile in e corresponds to the most favorable mechanism (<bold>d</bold>). The final state of the reaction revealed that the AMP-H phosphate was very close to the glutamyl-tRNA, keeping water from entering the active site. As the AMP-H moves away from the charged tRNA, water hydrates the AMP-H, as shown in <bold>f</bold> and <bold>g</bold>. Since in the final state of the eABF calculation the distance between Glu-AMP:Carb-C and Glu-AMP:P-O was of 3Å, we used this distance as the connecting point (see red dashed line between <bold>e</bold> and <bold>f</bold>) between the free energy profiles calculated with eABF and ABF.</p>
    </caption>
    <graphic xlink:href="nihms947830f3"/>
  </fig>
</floats-group>
