<?properties open_access?>
<?subarticle report3824?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v3.0 20080202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing3.dtd?>
<?SourceDTD.Version 3.0?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">F1000Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">F1000Res</journal-id>
    <journal-id journal-id-type="pmc">F1000Research</journal-id>
    <journal-title-group>
      <journal-title>F1000Research</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2046-1402</issn>
    <publisher>
      <publisher-name>F1000Research</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3938178</article-id>
    <article-id pub-id-type="pmid">24627790</article-id>
    <article-id pub-id-type="doi">10.12688/f1000research.2-217.v2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method Article</subject>
      </subj-group>
      <subj-group>
        <subject>Articles</subject>
        <subj-group>
          <subject>Bioinformatics</subject>
        </subj-group>
        <subj-group>
          <subject>Control of Gene Expression</subject>
        </subj-group>
        <subj-group>
          <subject>Genomics</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MethylExtract: High-Quality methylation maps and SNV calling from whole genome bisulfite sequencing data</article-title>
      <fn-group content-type="pub-status">
        <fn>
          <p>v2; ref status: indexed</p>
        </fn>
      </fn-group>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Barturen</surname>
          <given-names>Guillermo</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rueda</surname>
          <given-names>Antonio</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Oliver</surname>
          <given-names>José L.</given-names>
        </name>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hackenberg</surname>
          <given-names>Michael</given-names>
        </name>
        <xref ref-type="corresp" rid="c2">b</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <aff id="a1"><label>1</label>Dpto. de Genética, Facultad de Ciencias, Universidad de Granada, Granada, 18071, Spain</aff>
      <aff id="a2"><label>2</label>Lab. de Bioinformática, Inst. de Biotecnología, Centro de Investigación Biomédica, Granada, 18016, Spain</aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email xlink:href="mailto:oliver@ugr.es">oliver@ugr.es</email>
      </corresp>
      <corresp id="c2">
        <label>b</label>
        <email xlink:href="mailto:hackenberg@ugr.es">hackenberg@ugr.es</email>
      </corresp>
      <fn fn-type="con">
        <p>GB wrote the code and carried out the experiments, AR helped with the benchmark experiments, and MH, JLO and GB designed the software and wrote the manuscript. All the authors critically read and approved the final version.</p>
      </fn>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>21</day>
      <month>2</month>
      <year>2014</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2013</year>
    </pub-date>
    <volume>2</volume>
    <elocation-id>217</elocation-id>
    <history>
      <date date-type="accepted">
        <day>19</day>
        <month>2</month>
        <year>2014</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright: © 2014 Barturen G et al.</copyright-statement>
      <copyright-year>2014</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/3.0/">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
      <license license-type="open-access" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">
        <license-p>Data associated with the article are available under the terms of the Creative Commons Zero "No rights reserved" data waiver (CC0 1.0 Public domain dedication).</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:type="simple" xlink:href="f1000research-2-3889.pdf"/>
    <abstract>
      <p>Whole genome methylation profiling at a single cytosine resolution is now feasible due to the advent of high-throughput sequencing techniques together with bisulfite treatment of the DNA. To obtain the methylation value of each individual cytosine, the bisulfite-treated sequence reads are first aligned to a reference genome, and then the profiling of the methylation levels is done from the alignments. A huge effort has been made to quickly and correctly align the reads and many different algorithms and programs to do this have been created. However, the second step is just as crucial and non-trivial, but much less attention has been paid to the final inference of the methylation states. Important error sources do exist, such as sequencing errors, bisulfite failure, clonal reads, and single nucleotide variants.</p>
      <p>We developed
<italic>MethylExtract</italic>, a user friendly tool to: i) generate high quality, whole genome methylation maps and ii) detect sequence variation within the same sample preparation. The program is implemented into a single script and takes into account all major error sources.
<italic>MethylExtract</italic> detects variation (SNVs – Single Nucleotide Variants) in a similar way to
<italic>VarScan</italic>, a very sensitive method extensively used in SNV and genotype calling based on non-bisulfite-treated reads. The usefulness of
<italic>MethylExtract</italic> is shown by means of extensive benchmarking based on artificial bisulfite-treated reads and a comparison to a recently published method, called
<italic>Bis-SNP</italic>.</p>
      <p><italic>MethylExtract</italic> is able to detect SNVs within High-Throughput Sequencing experiments of bisulfite treated DNA at the same time as it generates high quality methylation maps. This simultaneous detection of DNA methylation and sequence variation is crucial for many downstream analyses, for example when deciphering the impact of SNVs on differential methylation. An exclusive feature of
<italic>MethylExtract</italic>, in comparison with existing software, is the possibility to assess the bisulfite failure in a statistical way. The source code, tutorial and artificial bisulfite datasets are available at
<ext-link ext-link-type="uri" xlink:href="http://bioinfo2.ugr.es/MethylExtract/">http://bioinfo2.ugr.es/MethylExtract/</ext-link> and
<ext-link ext-link-type="uri" xlink:href="http://sourceforge.net/projects/methylextract/">http://sourceforge.net/projects/methylextract/</ext-link>, and also permanently accessible from
<ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5281/zenodo.7144">10.5281/zenodo.7144</ext-link>.</p>
    </abstract>
    <funding-group>
      <award-group id="fund-1">
        <funding-source>Spanish Government</funding-source>
        <award-id>BIO2008-01353</award-id>
        <award-id>BIO2010-20219</award-id>
      </award-group>
      <award-group id="fund-2">
        <funding-source>Basque country ‘AE’ grant</funding-source>
      </award-group>
      <funding-statement>This work was supported by the Spanish Government [BIO2008-01353 to JLO and BIO2010-20219 to MH], and Basque country ‘AE’ grant (GB).</funding-statement>
      <funding-statement>
        <italic>The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</italic>
      </funding-statement>
    </funding-group>
  </article-meta>
  <notes notes-type="version-changes">
    <sec>
      <label>Revised</label>
      <title>Amendments from Version 1</title>
      <p>
        <bold>This new version comprises several changes</bold>
      </p>
      <p>
        <list list-type="order">
          <list-item>
            <p>The
<italic>MethylExtract</italic> software was updated to version 1.5 including several important changes: i) compatibility to all Perl versions, ii) BAM files can be read directly (needs
<italic>samtools</italic> installed), iii) several FLAG values can be given in order to suite for paired-end design </p>
          </list-item>
          <list-item>
            <p>Several new benchmarking experiments were carried out like suggested by the referees: i) comparison of methylation profiling between
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic> using relaxed criteria (methylation values are considered as correct if they deviate only by 10% and 20% respectively from the real value), ii) analysis of artificial BS sequencing data for 5x and 35x coverage, iii) new runtime comparison which is based on the exactly same input files, iv) brief and descriptive comparison of results obtained from “real world” data (see comments to the referees)</p>
          </list-item>
          <list-item>
            <p>The tutorial was completely revised including a new figure explaining how
<italic>MethylExtract</italic> treats and indicates variant positions in the output files.</p>
          </list-item>
        </list>
      </p>
    </sec>
  </notes>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>DNA methylation at the cytosine carbon 5 position (5meC) is an important epigenetic mark in eukaryotic cells that is predominantly found in CpG or CpHpG (H = A,C,T) sequence contexts
<sup><xref rid="ref-1" ref-type="bibr">1</xref></sup>. Epigenetic modifications at the DNA level play important roles in embryonic development
<sup><xref rid="ref-2" ref-type="bibr">2</xref>,
<xref rid="ref-3" ref-type="bibr">3</xref></sup>, transcription
<sup><xref rid="ref-4" ref-type="bibr">4</xref></sup>, chromosome stability
<sup><xref rid="ref-5" ref-type="bibr">5</xref></sup>, genomic imprinting
<sup><xref rid="ref-6" ref-type="bibr">6</xref></sup> and in the silencing of transposons in plants
<sup><xref rid="ref-7" ref-type="bibr">7</xref></sup>. Furthermore, aberrant methylation is involved in the appearance of several disorders as cancer, immunodeficiency or centromere instability
<sup><xref rid="ref-8" ref-type="bibr">8</xref></sup>. The methylation pattern along the genome sequence carries biologically relevant information. For example: methylated promoter regions are generally associated with silenced transcription and DNA methylation in the gene body of transcribed genes is often increased
<sup><xref rid="ref-8" ref-type="bibr">8</xref></sup>. Given these findings, the generation of high quality whole genome methylation maps at a single cytosine resolution is an important step towards the understanding of how DNA methylation is involved in the regulation of gene expression or the generation of a pathologic phenotype. In addition, methylation maps may provide new insights into how the methylation patterns themselves are established.</p>
    <p>Several high-throughput techniques have been developed able to generate whole genome methylation maps. In general, the techniques consist of a methylation-sensitive pre-treatment and a read-out step. The pre-treatments generally consist of digestion by methyl-sensitive endonucleases, methyl-sensitive immunoprecipitation or bisulfite conversion, while the read-out of the methylation information is done by hybridization, amplification or sequencing
<sup><xref rid="ref-9" ref-type="bibr">9</xref></sup>. Recently, several promising techniques have been developed that link the bisulfite conversion with High-Throughput Sequencing (MethylC-Seq
<sup><xref rid="ref-10" ref-type="bibr">10</xref></sup>, BS-Seq
<sup><xref rid="ref-11" ref-type="bibr">11</xref></sup> or RRBS
<sup><xref rid="ref-12" ref-type="bibr">12</xref></sup>). Briefly, the bisulfite treatment converts un-methylated cytosines into uracil (converted to thymine after PCR amplification) while leaving methylcytosines unconverted. After sequencing the bisulfite-treated genomic DNA, the methylation state can be recovered from the sequence alignments. Therefore, the methylation profiling from High-Throughput Bisulfite Sequencing data can be divided into two steps: the alignment of the reads, and the read-out of the methylation levels from the alignment. The alignment of bisulfite-treated reads is highly non-trivial due to the reduced sequence complexity given that all cytosines except methylcytosines are converted to thymines. This challenge has been extensively addressed over the last years and several algorithms are available that either align the reads in a 3-letter space or adapt the alignment scoring matrix in order to account for the C/T conversions. Among these algorithms are
<italic>BSMAP</italic>
<sup><xref rid="ref-13" ref-type="bibr">13</xref></sup>,
<italic>Bismark</italic>
<sup><xref rid="ref-14" ref-type="bibr">14</xref></sup>,
<italic>MethylCoder</italic>
<sup><xref rid="ref-15" ref-type="bibr">15</xref></sup>,
<italic>NGSmethPipe</italic>
<sup><xref rid="ref-16" ref-type="bibr">16</xref></sup>,
<italic>BS Seeker</italic>
<sup><xref rid="ref-17" ref-type="bibr">17</xref></sup>,
<italic>Last</italic>
<sup><xref rid="ref-18" ref-type="bibr">18</xref></sup> and
<italic>BRAT-BW</italic>
<sup><xref rid="ref-19" ref-type="bibr">19</xref></sup>. Note that some of these tools are not just alignment programs but can, in addition, perform the profiling of the methylation levels such as
<italic>Bismark</italic> and
<italic>MethylCoder</italic>. After alignment, the methylation states can be recovered: C/T mismatches indicate un-methylated cytosines while C/C matches reveal methylcytosines. However, several error sources−like sequencing errors, clonal reads, sequence variation, bisulfite failure and mis-alignments−can lead to a wrong inference of the methylation levels
<sup><xref rid="ref-16" ref-type="bibr">16</xref>,
<xref rid="ref-18" ref-type="bibr">18</xref>,
<xref rid="ref-20" ref-type="bibr">20</xref></sup>. For example, C→T or T→C (on converted cytosines) sequencing errors would be incorrectly interpreted as un-methylated or methylated respectively biasing the results towards lower or higher methylation levels. On the other side, bisulfite failures bias the methylation levels only to higher levels; un-methylated cytosines are not converted and therefore detected as methylcytosines. The existence of sequence variation is another important error source that was traditionally disregarded in the data analysis of whole genome bisulfite sequencing (WGBS) experiments. A C/T SNV would be interpreted as un-methylated cytosine. Given that over two thirds of all Single Nucleotide Polymorphisms (SNPs) occur in a CpG context, having two alleles: C/T or G/A
<sup><xref rid="ref-21" ref-type="bibr">21</xref></sup>, sequence variation needs to be addressed as an important error source. A C/T SNV manifests on the complementary DNA strand as an adenine, while bisulfite deamination does not affect the guanine on the complementary strand (see
<xref ref-type="fig" rid="f1">Figure 1</xref>). This fact allows in principle to distinguish between sequence variation and bisulfite conversion and therefore to i) avoid wrong inference of the methylation state due to sequence variation and ii) detect sequence variation in the same sample preparation as the methylation levels. Profiling the methylation levels and the genotype of the sample from one experiment will be a very important step towards "putting the DNA back into methylation”
<sup><xref rid="ref-22" ref-type="bibr">22</xref></sup>, as the impact and importance of certain DNA sequences on the methylation levels have been recently demonstrated
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup>. To our knowledge, the first program that performed a threshold-based detection of sequence variation in bisulfite sequencing experiments was
<italic>NGSmethPipe</italic>
<sup><xref rid="ref-16" ref-type="bibr">16</xref></sup>. This program detects sequence variation mainly to avoid wrong inference of the methylation level reporting those genome positions in the output. Only recently, the first state-of-the-art SNP calling algorithm based on the
<italic>Genome Analysis Toolkit</italic> (
<italic>GATK</italic>)
<sup><xref rid="ref-24" ref-type="bibr">24</xref></sup> was implemented to detect both methylation levels and sequence variation at high precision in a single experiment (
<italic>Bis-SNP</italic>).</p>
    <fig fig-type="figure" id="f1" orientation="portrait" position="float">
      <label>Figure 1. </label>
      <caption>
        <title>SNV detection in bisulfite converted reads.</title>
        <p>Sequence variation can be detected for a cytosine position analyzing the nucleotide frequency at the same position but on the complementary strand. Bisulfite conversion does not affect the guanine on the complementary strand, therefore the presence of any other base (H=A,C,T) might indicate the existence of an SNV. The figure illustrates three different situations: (
<bold>a</bold>) a methylated cytosine in a CpG context without sequence variation (all reads that map to the position independently of the strand carry a cytosine in the corresponding position), (
<bold>b</bold>) a heterozygous SNV (genotype C/T, SNV detected on the ‘+’ strand) and (
<bold>c</bold>) a homozygous SNV (genotype T/T, SNV detected on the ‘-’ strand). The example in
<bold>b</bold>) shows a heterozygous SNV; the 6 reads with A/G mismatch from a total of 11 reads mapping the position indicate a heterozygous variation. Furthermore, we can conclude that the cytosine allele is methylated (7 reads with C/C matches to the ‘-’ strand). The case illustrated in part
<bold>c</bold>), shows 12 reads that show C/T mismatch (‘+’ strand in blue in the upper part). Without looking at the complementary strand, the inference would be a completely un-methylated cytosine. However, the 11 reads that map to the complementary strand show an A/G mismatch at the corresponding position (we would expect guanines in the case of bisulfite conversion). Note that on bisulfite treated datasets only G/A mapped on the ‘+’ strand and C/T on the ‘-’ strand (refereed to the ‘+’ strand) can be used for SNV calling purposes. The figure was generated using the UCSC Genome Browser
<sup><xref rid="ref-41" ref-type="bibr">41</xref></sup>.</p>
      </caption>
      <graphic xlink:href="f1000research-2-3889-g0000"/>
    </fig>
    <p>Here we present
<italic>MethylExtract</italic>, a multi-threaded tool for methylation profiling and sequence variation detection from alignments in standard BAM/SAM format
<sup><xref rid="ref-25" ref-type="bibr">25</xref></sup>. The tool is able to generate high quality methylation maps taking into account SNVs, putative bisulfite failures, reducing also the contribution of sequencing errors by means of the base quality PHRED score
<sup><xref rid="ref-26" ref-type="bibr">26</xref>,
<xref rid="ref-27" ref-type="bibr">27</xref></sup>. In addition, it detects sequence variation based on
<italic>VarScan</italic> methodology
<sup><xref rid="ref-28" ref-type="bibr">28</xref></sup> reporting all detected SNVs in VCF format
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup>. Therefore, from a single sequencing experiment,
<italic>MethylExtract</italic> obtains both the methylation levels and the sequence variation, which will increase the reliability of downstream analyses
<sup><xref rid="ref-23" ref-type="bibr">23</xref></sup>. We confirm its usefulness using extensive artificial BS data and a comparison to
<italic>Bis-SNP</italic>. We show that while its SNV-calling performance is slightly less specific but more sensitive compared to
<italic>Bis-SNP</italic>,
<italic>MethylExtract</italic> performs better in methylation profiling, is easier to use and over twice as fast on a typical whole genome experiment.</p>
  </sec>
  <sec>
    <title>Implementation</title>
    <sec>
      <title>Scope and workflow</title>
      <p><italic>MethylExtract</italic> is implemented in Perl and consists of one main script and two auxiliary scripts that are exclusively dedicated to the statistical assessment of the bisulfite error. In general, the program takes standard BAM/SAM file format as input (previously aligned reads) and performs methylation profiling and SNV calling taking into account several error sources like sequencing errors, clonal reads and bisulfite failures.
<italic>MethylExtract</italic> writes two output files. First, the methylation information for each cytosine including the coordinates, sequence context (CG, CHG, CHH), number of methylcytosines, read coverage and mean base quality (PHRED) score. The second output file reports the sequence variation in standard VCF format
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup>.</p>
      <p>Frequently, whole genome bisulfite experiments include the estimation of the bisulfite conversion rate through a completely un-methylated genome (lambda phage for example). If the bisulfite conversion rate is known, statistical tests can be applied to infer whether an observed methylation level might be only due to failures of bisulfite conversion. The two auxiliary scripts allow i) estimating the bisulfite conversion rate by mapping the bisulfite-treated reads from the un-methylated genome only and ii) to apply a binomial statistics based test to infer the probability that the “real” methylation value lies within a given interval of the observed value.</p>
    </sec>
    <sec>
      <title>Duplicated reads</title>
      <p>The PCR step can lead to duplicated (clonal) reads, thus causing a bias in the read coverage. This bias might lead to incorrect inference at positions with allele-specific methylation (genetic imprinting), sequence variation, hemi-methylation, sequencing errors, bisulfite failure or those that are heterogeneous over the cell population. Frequently, the start coordinates of the alignments are used to eliminate duplicates like in
<italic>SAMtools</italic>
<sup><xref rid="ref-25" ref-type="bibr">25</xref></sup>, adding a criterion to keep the best read among the duplicates. However, those approaches do not take into account that at a heterozygous locus two reads with the same start coordinate could represent two different alleles, thus not being clonal reads. The same applies for loci with genetic imprinting or hemi-methylation. To avoid the elimination of meaningful biological information,
<italic>MethylExtract</italic> groups all reads that start at the same position in the genome and that have the same seed nucleotides with Q ≥ ‘minQ’; and selects the read that has the highest number of bases with Q ≥ ‘minQ’ (by default ‘minQ’ = 20) and the longest read in case of equal number of high quality positions. Furthermore, if there are multiple reads with the same selection values, only one will be selected in a random way. Two non-identical reads that align to exactly the same position in the chromosome can represent either the existence of sequence variation or putative clonal reads with a sequencing error in at least one read (disregarding mis-alignments). To restrict the impact of sequencing errors we used only the seed region of the read, i.e. the region with the highest quality. The seed is defined as those nucleotides at the 5´ end of the read (first 26 nt by default) that have a higher PHRED score than ‘minQ’.</p>
      <p>Note that the two types of methods, the ones that use only the coordinates and our method using the coordinates and the sequence, have advantages and disadvantages. If the sequence differences are considered, biological meaningful information like sequence variation, genetic imprinting or hemi-methylation is maintained; however, our approach will be vulnerable to sequencing errors and bisulfite errors. The default option is to not perform the detection of duplicated reads, and thus any of the publically available tools can be used optionally to remove clonal reads prior to run
<italic>MethylExtract</italic>.</p>
    </sec>
    <sec>
      <title>5´ end trimming</title>
      <p>The first nucleotides can be removed from the 5´ end of the read (3 bp for the
<italic>MspI</italic> restriction sites of non-directional representation bisulfite sequencing (RRBS) protocol), as also implemented by
<italic>Bismark</italic>
<sup><xref rid="ref-14" ref-type="bibr">14</xref></sup>.</p>
    </sec>
    <sec>
      <title>Eliminating reads with putatively high bisulfite conversion failure</title>
      <p>The bisulfite conversion error probability of un-methylated cytosines is usually below 1% in modern protocols. However, even for such low values, some positions could be incorrectly profiled, i.e. some methylated cytosines are actually un-methylated.
<italic>MethylExtract</italic> implements a method proposed by Lister
<italic>et al.</italic>
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup> to detect those reads with a high number of un-converted cytosines. By default, it eliminates reads with at least 90% of (presumably) unconverted cytosines in non-CpG contexts (Lister
<italic>et al.</italic> used ≥ 3 methylated non-CpG cytosines). The default threshold is very conservative and only a rather small fraction of reads will be eliminated. Caution is needed if the user knows that the analyzed species (plants) or tissues (e.g. embryonic stem cells) contain an elevated number of DNA methylation in non-CpG contexts. In those cases, this step should be better skipped as otherwise a bias will be introduced into the analysis.</p>
    </sec>
    <sec>
      <title>Controlling sequencing errors</title>
      <p>Sequencing errors are another important cause of incorrect methylation profiling (and SNV calling). The contribution of the individual bases can be controlled by means of the assigned PHRED score (i.e. an upper limit of sequencing error contribution to the wrongly inferred methylation states). For example, when setting PHRED score ≥ 20, thus accepting bases with a probability &lt; 0.01 to be incorrectly called, the contribution of sequencing errors to the overall error would be less than 1%. By default,
<italic>MethylExtract</italic> sets the minimum PHRED score to 20 (‘minQ’ parameter) which is then used for both methylation profiling and SNV calling (see below on the determination of the default values).</p>
    </sec>
    <sec>
      <title>SNVs detection</title>
      <p>SNVs are the most disregarded error source in the analysis of whole genome bisulfite sequencing data. Most tools would interpret a C to T substitution as an un-methylated cytosine, although a certain number of them are actually SNVs, and therefore this inference would be wrong. A C/T SNV manifests on the complementary DNA strand as an adenine, while bisulfite deamination does not affect the guanine on the complementary strand
<sup><xref rid="ref-31" ref-type="bibr">31</xref></sup> (
<xref ref-type="fig" rid="f1">Figure 1</xref>). The SNVs detection algorithm implemented in
<italic>MethylExtract</italic> is an adaptation of the widely used
<italic>varScan</italic> algorithm
<sup><xref rid="ref-28" ref-type="bibr">28</xref></sup>. The main difference compared to SNV calling from non-bisulfite-treated DNA is the reduced amount of sequence information that can be used to detect sequence variation. The bisulfite treatment converts the un-methylated cytosines into thymines, and therefore, at cytosine positions nucleotides that might result from the bisulfite conversion cannot be used to detect sequence variation. For adenine and thymine, both strands can be used like in re-sequencing experiments. The algorithm works as follows: i) filter out positions that are covered by fewer reads than the minimum read depth (‘minDepthSNV’) – by default ‘minDepthSNV’ is set to 1, thus analyzing all positions that are covered by at least one read; ii) calculate the nucleotide frequencies including all base calls that pass the minimum PHRED score threshold (‘minQ’); iii) discard nucleotides with frequencies below a given threshold (‘varFraction’); iv) calculate a
<italic>p-value</italic> for the variant positions (more than two nucleotides above ‘varFraction’) by means of Fisher’s exact test, v) only those positions with a
<italic>p-value</italic> below a given threshold are considered as SNVs (‘maxPval’), and vi) the two nucleotides with the highest frequencies are determined as the putative genotype of the sample at this position. Detected sequence variation is reported in VCF output format, which can be used as input for SNP-annotation programs
<sup><xref rid="ref-32" ref-type="bibr">32</xref></sup> or
<italic>VCFtools</italic>
<sup><xref rid="ref-29" ref-type="bibr">29</xref></sup>.</p>
    </sec>
    <sec>
      <title>Statistical assessment of the bisulfite conversion error</title>
      <p>Bisulfite conversion failure has been addressed using binomial statistics for the two possible outcomes; methylated and un-methylated
<sup><xref rid="ref-33" ref-type="bibr">33</xref></sup>. However, intermediate biologically meaningful states exist like allele specific methylation (with expected methylation levels of 0.5, if both homologous chromosomes have the same sequencing depth), or the reported partial methylation levels
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>. Therefore, we developed a statistical test for the methylation levels and not for the methylation state previously proposed
<sup><xref rid="ref-30" ref-type="bibr">30</xref>,
<xref rid="ref-34" ref-type="bibr">34</xref></sup>. To apply this test, the user needs to know the bisulfite conversion rate obtained in the experiment. This rate needs to be established using an un-methylated genome (lambda phage, chloroplast, etc). We supply two additional scripts to i) estimate the bisulfite conversion rate using the appropriate experimental data, and ii) associate a
<italic>p-value</italic>, based on binomial statistics, to each of the extracted methylation levels, as well as a procedure to control the false discovery rate
<sup><xref rid="ref-35" ref-type="bibr">35</xref></sup>.</p>
      <p>In order to calculate a
<italic>p-value</italic> for a given methylation level, we first need to select an interval as we want to calculate the probability that the real methylation level lies within an interval of the observed methylation level. Once the interval is fixed, we can calculate the number of false methylcytosines that would not change the methylation level, e.g. the methylation level would stay within the error interval.</p>
      <p>Once we have detected the maximum number of false methylcytosines that would maintain the methylation level within the error interval, we can calculate the
<italic>p-value</italic> by means of the binomial distribution:</p>
      <p>
        <disp-formula>
          <mml:math id="math1">
            <mml:mrow>
              <mml:mtext>p</mml:mtext>
              <mml:mo>-</mml:mo>
              <mml:mo>value</mml:mo>
              <mml:mo>=</mml:mo>
              <mml:mo>1-</mml:mo>
              <mml:mtext/>
              <mml:mstyle displaystyle="true">
                <mml:munderover>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>k</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>0</mml:mn>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi>f</mml:mi>
                    <mml:mi>m</mml:mi>
                    <mml:mi>c</mml:mi>
                  </mml:mrow>
                </mml:munderover>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mtable>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mrow>
                              <mml:mi>m</mml:mi>
                              <mml:mi>c</mml:mi>
                            </mml:mrow>
                          </mml:mtd>
                        </mml:mtr>
                        <mml:mtr>
                          <mml:mtd>
                            <mml:mi>k</mml:mi>
                          </mml:mtd>
                        </mml:mtr>
                      </mml:mtable>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
              </mml:mstyle>
              <mml:msup>
                <mml:mi>p</mml:mi>
                <mml:mi>k</mml:mi>
              </mml:msup>
              <mml:msup>
                <mml:mrow>
                  <mml:mrow>
                    <mml:mo>(</mml:mo>
                    <mml:mrow>
                      <mml:mn>1</mml:mn>
                      <mml:mo>−</mml:mo>
                      <mml:mi>p</mml:mi>
                    </mml:mrow>
                    <mml:mo>)</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:mi>m</mml:mi>
                  <mml:mi>c</mml:mi>
                  <mml:mo>−</mml:mo>
                  <mml:mi>k</mml:mi>
                </mml:mrow>
              </mml:msup>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>being:
<italic>p</italic> the bisulfite error rate,
<italic>mc</italic> the number of observed methylcytosines at a given position and
<italic>fmc</italic> the maximum number of allowed false methylcytosines. The
<italic>p-value</italic> corresponds then to the probability to find more than
<italic>fmc</italic> false methylcytosines at this position, e.g. the probability that the real methylation level lies outside the defined error interval.</p>
      <p>To illustrate the method, let’s assume that we have a position that is covered by 21 reads with 17 methylcytosines. In this situation, we would have a methylation level of 0.81. If we fix the error interval at 0.1, we could accept up to 2 false methylcytosines. For two false methylcytosines, the methylation level would be (17–2)/21 = 0.714 which lies within the error interval of 0.81–0.1 &lt; 0.714 while 3 false methylcytosines would lead to a methylation level of 0.67 which lies outside the tolerated error interval. Note that the coverage depth of the position (number of reads) does not appear in the equation, but it does to calculate the maximum number of false methylcytosines. In this way, a higher coverage will lead to a higher number of allowed false methylcytosines and therefore to smaller
<italic>p-values</italic>. Finally, we implemented the Benjamini–Hochberg step-up procedure
<sup><xref rid="ref-35" ref-type="bibr">35</xref></sup> to control for the false discovery rate in multiple testing. This step can be optionally activated by the user.</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <sec>
      <title>General comparison to other available tools</title>
      <p><italic>MethylExtract</italic> is currently one of the programs with most implemented features related to quality control. Together with
<italic>Bis-SNP</italic> it is the only program that detects sequence variation, both to avoid incorrect methylation profiling and to assess the genotype of the used sample.
<xref ref-type="table" rid="T1">Table 1</xref> shows a comparison of the main features of all programs that allow methylation profiling from aligned reads. Apart from the used method to call the sequence variation, another important difference between
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic> is the number of scripts involved to run a full analysis.
<italic>Bis-SNP</italic> requires the execution of: i) 3 scripts to sort, add read group tags (required by
<italic>GATK</italic> tools) and mark duplicates, ii) 4 scripts to realign the reads and recalibrate the base quality score, iii) 2 scripts to obtain and sort the SNVs and number of methylcytosines and iv) an additional script to calculate the methylation levels on a standard format. In summary,
<italic>Bis-SNP</italic> needs 10 different scripts to process reads from bisulfite-treated experiments. On the other hand,
<italic>MethylExtract</italic> unifies all analysis steps into a single program which makes it especially suitable for users without a bioinformatics background. Another feature that is currently unique to
<italic>MethylExtract</italic> is the possibility to assess the bisulfite failure in a statistical way. In order to achieve this,
<italic>MethylExtract</italic> provides an auxiliary script to estimate the bisulfite conversion rate, and a second script that calculates the probability that the observed methylation level lies outside the selected interval of the real methylation level due to bisulfite conversion failures.</p>
      <table-wrap id="T1" orientation="portrait" position="anchor">
        <label>Table 1. </label>
        <caption>
          <title>Comparison of
<italic>MethylExtract</italic> with different programs for methylation profiling and SNV calling.</title>
        </caption>
        <table frame="hsides" rules="groups" content-type="article-table">
          <thead>
            <tr>
              <th align="left" rowspan="1" colspan="1">FEATURES
<sup>#</sup>/SOFTWARE</th>
              <th align="left" rowspan="1" colspan="1">MethylCoder</th>
              <th align="left" rowspan="1" colspan="1">BS_SEEKER</th>
              <th align="left" rowspan="1" colspan="1">BRAT-BW</th>
              <th align="left" rowspan="1" colspan="1">BSMAP/RRBSMAP</th>
              <th align="left" rowspan="1" colspan="1">Bismark</th>
              <th align="left" rowspan="1" colspan="1">Bis-SNP</th>
              <th align="left" rowspan="1" colspan="1">MethylExtract</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Input formats</bold>
              </td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">Sam</td>
              <td rowspan="1" colspan="1">Sam</td>
              <td rowspan="1" colspan="1">Bam</td>
              <td rowspan="1" colspan="1">Sam/Bam</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>5´ Trim</bold>
              </td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Bisulfite failure</bold>
              </td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Minimum depth</bold>
              </td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Base call errors</bold>
              </td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>SNVs calling</bold>
              </td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">No</td>
              <td rowspan="1" colspan="1">Yes</td>
              <td rowspan="1" colspan="1">Yes</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Methylation output</bold>
                <break/>
                <bold>formats</bold>
              </td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*</td>
              <td rowspan="1" colspan="1">*, bed</td>
              <td rowspan="1" colspan="1">vcf, bed, wig</td>
              <td rowspan="1" colspan="1">*, bed, wig</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">
                <bold>Variation output</bold>
                <break/>
                <bold>formats</bold>
              </td>
              <td rowspan="1" colspan="1">-</td>
              <td rowspan="1" colspan="1">-</td>
              <td rowspan="1" colspan="1">-</td>
              <td rowspan="1" colspan="1">-</td>
              <td rowspan="1" colspan="1">-</td>
              <td rowspan="1" colspan="1">vcf</td>
              <td rowspan="1" colspan="1">vcf</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p><sup>#</sup> Input formats: input formats used by each software. 5´ trim: allows the trimming of the 5´ end of the reads. Bisulfite failure: implementation of a step to discard reads where the bisulfite might have failed converting the un-methylated cytosines. Minimum depth: allows the user to discard positions with low coverage. Base call errors: discards positions that do not exceed a given minimum PHRED score value. SNVs calling: detects variation that can lead to wrong methylation levels or context estimation. Methylation output formats: available formats for the methylation results. Variation output formats: output formats for the sequence variation results. The asterisk (*) represents a non-standard input or output format, or the impossibility of extracting the methylation ratios from other alignment tools. The dash (-) represents the inexistence of SNV output format, because the software does not allow to detect them.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>Impact of SNVs on methylation levels</title>
      <p>As mentioned above, sequence variants can lead to incorrect inference of methylation values.
<xref ref-type="fig" rid="f2">Figure 2</xref> illustrates the impact of C/T variation on the methylation values (C/(C+T) ratio) within CpGs contexts. Around 470,000 SNVs within CpG contexts (affecting to 2.08% of the CpG contexts on the genome) covered by at least 10 reads have been detected by
<italic>MethylExtract</italic> in Lister’s H1 dataset
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>.
<xref ref-type="fig" rid="f2">Figure 2</xref> shows the methylation levels for non-variant positions (both alleles coincide with the reference) and for the variant sites, both in homozygosis and heterozygosis. The observed distribution of the methylation levels without variation has two maxima close to 0 and 1, which is similar to previous studies
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>. However, for heterozygous positions detected by
<italic>MethylExtract</italic>, the methylation levels present a local maximum at approximately 0.5 (the T allele on one of the parental chromosomes biases the methylation levels to intermediate values, if the C allele is methylated) and a peak at 0 (if the C allele is un-methylated). Finally, for the homozygous positions where both chromosomes present the T allele, most of the methylation values are exactly 0. However, we know that no cytosine exist at those locus in the analyzed sample and therefore these values are incorrect and should be eliminated from the analysis. The incorrectly inferred methylation values for variant positions, both in homozygosis and heterozygosis, stress the need to detect and remove them from the analysis. For example, a CpG position with C→T SNV on both homologous chromosomes is eliminated by
<italic>MethylExtract,</italic> as actually at this position no CpG exists in the sample. Furthermore,
<italic>MethylExtract</italic> outputs the detected genotype of all profiled positions and therefore heterozygotic loci can be detected easily by the user and treated apart if wished.</p>
      <fig fig-type="figure" id="f2" orientation="portrait" position="float">
        <label>Figure 2. </label>
        <caption>
          <title>Distribution of C/(C+T) ratios for cytosines within the CpG context in the H1 cell line.</title>
          <p>C/(C+T) values for cytosines at non-variant and variant (homo- and heterozygotic) positions were shown. The minimum read coverage was set to 10 reads.</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0001"/>
      </fig>
    </sec>
    <sec>
      <title>Methylation profiling and SNV calling quality</title>
      <p><italic>MethylExtract</italic> implements several quality controls and is among the programs with most implemented features. Main features of
<italic>MethylExtract</italic> are compared in
<xref ref-type="table" rid="T1">Table 1</xref> to a number of other, widely used programs. The implementation was validated in several ways.
<italic>MethylExtract</italic> takes aligned reads as input and therefore we first compared the methylation profiling quality achieved on artificial bisulfite data when using two different tools for aligning bisulfite-treated reads;
<italic>NGSmethPipe</italic>
<sup><xref rid="ref-16" ref-type="bibr">16</xref></sup> and
<italic>Bismark</italic>
<sup><xref rid="ref-36" ref-type="bibr">36</xref></sup>. Next, we quantify the correctly profiled methylation levels and SNVs as a function of the main quality parameters using
<italic>NGSmethPipe</italic> as aligner. Finally the predictive power of
<italic>MethylExtract</italic> to detect methylation levels and sequence variation was compared to
<italic>Bis-SNP</italic>
<sup><xref rid="ref-24" ref-type="bibr">24</xref></sup>, both in terms of sensitivity and positive predictive value as it was proposed for datasets for which the number of true negatives tend to be much higher than false positives
<sup><xref rid="ref-37" ref-type="bibr">37</xref></sup>.</p>
      <p><bold><italic>Generation of artificial BS data.</italic></bold> For all further comparisons we will use artificial bisulfite data. The usage of this kind of data for benchmarking has the advantage that the true methylation levels and genotypes are known for each position, which is not true when using other experimental methods like microarrays as a golden standard. Artificial sequencing data has been used before in other studies assessing the SNV prediction quality of different algorithms
<sup><xref rid="ref-38" ref-type="bibr">38</xref></sup>. To generate the artificial bisulfite data we used
<italic>DNemulator</italic>
<sup><xref rid="ref-18" ref-type="bibr">18</xref></sup>. We obtained two datasets from the human contig GL000022.1 (11.2Mb), one with all CpGs completely methylated, and the other one with all CpGs completely un-methylated.
<italic>DNemulator</italic> allows also simulating the genotypes of a diploid genome by introducing the sequence variation from a set of confirmed SNPs (dbSNP135)
<sup><xref rid="ref-39" ref-type="bibr">39</xref></sup>. Finally, we simulate a bisulfite conversion rate of 99%. The read quality scores are taken from real experimental data (Lister’s H1 dataset
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup>). All together, we generated artificial bisulfite sequencing datasets at two different coverages; 15× and 20× which corresponds to the coverage usually achieved in whole genome bisulfite sequencing experiments.</p>
      <p><bold><italic>MethylExtract with NGSmethPipe and Bismark input.</italic></bold><italic>NGSmethPipe</italic><sup><xref rid="ref-16" ref-type="bibr">16</xref></sup> is a tool to align bisulfite-treated reads which was developed by our group. It is based on the
<italic>Bowtie</italic> aligner and uses a 3-letter alphabet to map the bisulfite-treated reads. The program implements a pre-processing to improve the mapping accuracy
<sup><xref rid="ref-18" ref-type="bibr">18</xref></sup> and an alignment seed extension in order to increase the number of mapped reads.</p>
      <p>We launched both,
<italic>NGSmethPipe</italic> and the well-established
<italic>Bismark</italic> tool with default options to obtain the SAM/BAM input. Next we used
<italic>MethylExtract</italic> on both input files to obtain the number of covered CpGs and the number of correctly recovered methylation values. Note that we know the correct methylation value for each position due to the use of artificial bisulfite data. A position is considered as correctly profiled, only if the obtained methylation value is identical to the real value.
<xref ref-type="fig" rid="f3">Figure 3</xref> shows the result of this comparison. It shows that the obtained CpG coverage and number of correctly profiled positions is nearly identical both as a function of read coverage (15× and 20×) and for the methylated and un-methylated input data. The only remarkable difference is that
<italic>NGSmethPipe</italic> leads to a slightly higher CpG coverage at 20× for both data sets. Nevertheless, the main conclusion is that
<italic>MethylExtract</italic> yields nearly identical results for input sets obtained from
<italic>NGSmethPipe</italic> and
<italic>Bismark</italic>.</p>
      <fig fig-type="figure" id="f3" orientation="portrait" position="float">
        <label>Figure 3. </label>
        <caption>
          <title>CpGs methylation profiling comparison for alignment methods.</title>
          <p>The results obtained from
<italic>MethylExtract</italic> (correctly profiled methylation values and CpG coverage) using two bisulfite short read aligners,
<italic>NGSmethPipe</italic> and
<italic>Bismark</italic> are compared. The results are nearly independent of the used alignment algorithm.</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0002"/>
      </fig>
      <p><bold><italic>Analysis of the MethylExtract quality parameters.</italic></bold> Next, we aimed to assess the impact of certain quality parameters implemented in
<italic>MethylExtract</italic> on the methylation profiling and SNV calling capacity. To detect sequence variation,
<italic>MethylExtract</italic> relies on two main parameters, i) the relative nucleotide frequencies (‘varFraction’) and ii) the corresponding
<italic>p-value</italic>. The ‘varFraction’ parameter determines if a position shows putatively variation: the position is analyzed only if at least one nucleotide that differs from the reference sequence has relative frequencies higher than ‘varFraction’. Only for these positions the corresponding
<italic>p-value</italic> is calculated by means of a Fisher exact test.
<xref ref-type="fig" rid="f4">Figure 4</xref> shows the impact of these parameters on the prediction sensitivity (Sn) and positive predictive value (PPV). Sequence variation is best detected by setting the ‘varFraction’ threshold close to 0.1 (yielding around 91% Sn and only 2% of false positives at a statistical significance of 0.05). If the ‘varFraction’ threshold is increased further, the probability to eliminate heterozygous loci increases steadily for positions with high bias in the read coverage between the two homologous chromosomes. If the
<italic>p-value</italic> threshold is set to 0.01, a small increase in positive predictive value (PPV) is observed, but it causes a strong decrease in sensitivity. Therefore, we determined a ‘varFraction’ of 0.1 and a
<italic>p-value</italic> threshold of 0.05 as the best (default) parameters to detect sequence variations.</p>
      <fig fig-type="figure" id="f4" orientation="portrait" position="float">
        <label>Figure 4. </label>
        <caption>
          <title><italic>MethylExtract</italic> SNV calling as a function of the minimum relative nucleotide frequency (‘varFraction’).</title>
          <p>The figures show the sensitivity (Sn) and the positive predictive value (PPV) for SNV detection using two different p-value thresholds. The graphs are based on the methylated (top) and un-methylated (bottom) artificial bisulfite datasets at a mean 20× read coverage.</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0003"/>
      </fig>
      <p>The minimum base quality (‘minQ’) and the coverage depth (‘minDepthMeth’ for the methylation profiling) thresholds might be also important parameters to control de quality of methylation profiling and SNV calling. To analyze the impact of the minimum PHRED score parameter (‘minQ’) we fix the minimum read coverage (‘minDepthMeth’) in 3, as suggested by Laurent
<italic>et al.</italic>
<sup><xref rid="ref-40" ref-type="bibr">40</xref></sup>, ‘varFraction’ = 0.1 and ‘maxPval’ = 0.05 (default values derived above).
<xref ref-type="fig" rid="f5">Figure 5</xref> shows the fraction of correctly profiled methylation values and the PPV for SNVs. It can be seen that the correctly profiled positions increase approximately 31% (from 68% to 99%) and the SNVs around 71% (27% – 98%), when the minimum PHRED score is increased from 0 (all base calls are accepted) to 30 (0.001 error probability). The major difference between the methylated and un-methylated datasets is observed for the profiling of the methylation level for which the percentage increases only from approximately 52% to 86%. The simulated bisulfite conversion failures will affect mainly un-methylated positions which can explain the observed differences. These results confirm that the ‘minQ’ threshold is critical to obtain high quality methylation profiling and genotyping results. The default value was set to 20 as higher values will lead to a coverage reduction compromising the SNV calling sensitivity.</p>
      <fig fig-type="figure" id="f5" orientation="portrait" position="float">
        <label>Figure 5. </label>
        <caption>
          <title><italic>MethylExtract</italic> SNV calling and methylation profiling as a function of the base quality.</title>
          <p>Both graphs show the positive predictive value (PPV) for SNV calling and the fraction of correctly profiled CpG methylation values (methylation profiling) as a function of the minimum base quality (PHRED score parameter ‘minQ’). The graphs are based on the methylated (top) and un-methylated (bottom) artificial bisulfite datasets at a mean 20× read coverage. Y-axis represents SNV PPV, Fraction of correct methylation values and CpG coverage. All of them vary between 0 to 1 therefore being represented together.</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0004"/>
      </fig>
    </sec>
    <sec>
      <title>Comparison with
<italic>Bis-SNP</italic>
</title>
      <p>The comparison between
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic> needs to be based on identical alignment input files in BAM/SAM format. We obtained these files in a two-step process: First, we trim the input reads as it was done by Lister
<italic>et al.</italic>
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup> and second, we align the bisulfite treated reads to the reference genome using
<italic>Bismark</italic>
<sup><xref rid="ref-36" ref-type="bibr">36</xref></sup> with default parameters. Note that we based this comparison on
<italic>Bismark</italic>, as the realignment and recalibration steps implemented in
<italic>Bis-SNP</italic> require the read mapping quality, which is currently not available in
<italic>NGSmethPipe</italic>.</p>
      <p>Both methods were used with default parameters. We first compared the detection of sequence variation (SNVs) in terms of Sn and PPV.
<xref ref-type="fig" rid="f6">Figure 6</xref>, shows that in general
<italic>Bis-SNP</italic> is more specific (between 1.9% and 3.9% higher PPV), being
<italic>MethylExtract</italic> more sensitive (between 1% and 3.1% higher Sn). This trend can be seen for both artificial bisulfite datasets as well as for both read coverages. However, when comparing the fraction of correctly recovered methylation values, drastic differences can be seen (
<xref ref-type="fig" rid="f7">Figure 7</xref>). Furthermore, when the criteria for correctly profiled methylation values are relaxed,
<italic>MethylExtract</italic> still yields higher fractions than
<italic>Bis-SNP</italic> (
<xref ref-type="fig" rid="sf1">Supplementary Figure 1</xref>). While
<italic>Bis-SNP</italic> yields a slightly higher number of covered positions (Fraction of covered CpGs),
<italic>MethylExtract</italic> is more specific. In all four comparisons using the stringent criteria (no deviation from the real methylation values is allowed),
<italic>MethylExtract</italic> yields over 20% more correctly profiled positions compared to Bis-SNP. One explanation for this difference might be the PHRED score quality threshold implemented in
<italic>MethylExtract</italic>.</p>
      <fig fig-type="figure" id="f6" orientation="portrait" position="float">
        <label>Figure 6. </label>
        <caption>
          <title>Comparison of SNV calling between
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic>.</title>
          <p>The top graph shows the sensitivity (Sn) and the bottom graph the specificity (PPV) obtained for the methylated and un-methylated artificial bisulfite datasets at two different mean coverages (5×, 15×, 20× and 35×).</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0005"/>
      </fig>
      <fig fig-type="figure" id="f7" orientation="portrait" position="float">
        <label>Figure 7. </label>
        <caption>
          <title>Comparison of CpG methylation values between
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic>.</title>
          <p>Both methods are compared in terms of fraction of correctly profiled CpG methylation values (top) and the fraction of recovered CpG positions (bottom).</p>
        </caption>
        <graphic xlink:href="f1000research-2-3889-g0006"/>
      </fig>
    </sec>
    <sec>
      <title>Runtime comparison to
<italic>Bis-SNP</italic>
</title>
      <p>As mentioned before, only
<italic>Bis-SNP</italic> and
<italic>MethylExtract</italic> perform the detection of SNVs which constitutes an additional CPU demanding task. Therefore, we only compared these two programs in terms of CPU time using a reduced Lister’s H1 dataset
<sup><xref rid="ref-30" ref-type="bibr">30</xref></sup> on a 24 core Intel(R) Xeon(R) CPU X5650 2.67GHz machine. Available memory is crucial for both methods. In order to not bias the comparison, we limited the available memory to 15GB for both programs allowing up to 15 threads. Both programs were tested using a 11GB BAM input file. After aligning with
<italic>Bismark</italic>, we carried out the entire process for both tools (from the aligned reads to the methylation and SNV profiling).
<italic>MethylExtract</italic> needed 6 hours 2 minutes to process the entire dataset including the sorting by coordinates and the removal of duplicated reads.
<italic>Bis-SNP</italic> spend 2 hours 47 minutes sorting the file and removing putative clonal reads, 9 hours and 36 minutes realigning and recalibrating the reads, and 15 hours 54 minutes genotyping and retrieving the methylation levels. Therefore, it seems that
<italic>MethylExtract</italic> is notably faster than
<italic>Bis-SNP</italic> (approximately 4.5 times on this whole genome data set).</p>
    </sec>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>We present a user-friendly tool for methylation profiling and SNV calling in whole genome bisulfite sequencing experiments.
<italic>MethylExtract</italic> takes standardized input formats (BAM/SAM) and writes out likewise broadly used file formats like WIG, BED and VCF. To show its usefulness, we compared it to
<italic>Bis-SNP</italic>, a recently published method that is very similar in scope. Although
<italic>Bis-SNP</italic> is more specific (less false positive predictions) in the detection of SNVs,
<italic>MethylExtract</italic> is more sensitive (higher number of recovered SNVs). However, the main advantages of
<italic>MethylExtract</italic> when compared to
<italic>Bis-SNP</italic> seem to rely in the higher percentage of correctly profiled methylation values, as it reaches values over 20% higher compared to
<italic>Bis-SNP</italic>. Other aspects that favor
<italic>MethylExtract</italic> are its user-friendliness (everything is implemented into one script) and the run-time in comparison to
<italic>Bis-SNP</italic> (over 4 times faster in a whole genome bisulfite sequencing experiment).</p>
  </sec>
  <sec>
    <title>Availability and requirements</title>
    <p><italic>MethylExtract</italic> is freely available. The source code, the tutorial and artificial bisulfite datasets can be downloaded from the page
<ext-link ext-link-type="uri" xlink:href="http://bioinfo2.ugr.es/MethylExtract/">http://bioinfo2.ugr.es/MethylExtract/</ext-link> and are also permanently accessible from
<ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5281/zenodo.8351">10.5281/zenodo.8351</ext-link>
<sup><xref rid="ref-42" ref-type="bibr">42</xref></sup>.</p>
  </sec>
  <sec>
    <title>List of abbreviations used</title>
    <p>5meC: DNA methylation at cytosine carbon 5 position; SNV; Single Nucleotide Variation; WGBS: whole genome bisulfite sequencing; SNP: Single Nucleotide Polymorphism; PPV: positive predictive value; PHRED score: the quality score to each base call assigned by the program PHRED; SAM format: Sequence Alignment/Map format used for storing large nucleotide sequence alignments; BAM format: the compressed binary version of the SAM format.</p>
  </sec>
</body>
<back>
  <sec sec-type="supplementary-material">
    <title>Supplementary material</title>
    <fig fig-type="figure" id="sf1" orientation="portrait" position="float">
      <label>Supplementary Figure 1. </label>
      <caption>
        <title>Methylation profiling comparison
<italic>MethylExtract</italic> and
<italic>Bis-SNP</italic> using relaxed criterion.</title>
        <p>Both methods are compared in terms of fraction of correctly profiled CpG methylation values. The upper part of the graph shows the result allowing up to 10% deviation from the real methylation values, while the lower part shows the outcome increasing this range to 20%. The analyses were done for unmethylated and methylated datasets at four different coverages (5×, 15×, 20× and 35×).</p>
      </caption>
      <graphic xlink:href="f1000research-2-3889-g0007"/>
    </fig>
  </sec>
  <ref-list>
    <ref id="ref-1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oliveira</surname><given-names>DC</given-names></name><name><surname>Tomasz</surname><given-names>A</given-names></name><name><surname>de Lencastre</surname><given-names>H</given-names></name></person-group>:
<article-title>The evolution of pandemic clones of methicillin-resistant Staphylococcus aureus: identification of two ancestral genetic backgrounds and the associated mec elements.</article-title><source><italic>Microb Drug Resist.</italic></source><year>2001</year>;<volume>7</volume>(<issue>4</issue>):<fpage>349</fpage>–<lpage>61</lpage>.
<pub-id pub-id-type="doi">10.1089/10766290152773365</pub-id><?supplied-pmid 11822775?><pub-id pub-id-type="pmid">11822775</pub-id></mixed-citation>
    </ref>
    <ref id="ref-2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gu</surname><given-names>F</given-names></name><name><surname>Doderer</surname><given-names>MS</given-names></name><name><surname>Huang</surname><given-names>YW</given-names></name><etal/></person-group>:
<article-title>CMS: a web-based system for visualization and analysis of genome-wide methylation data of human cancers.</article-title><source><italic>PLoS One.</italic></source><year>2013</year>;<volume>8</volume>(<issue>4</issue>):<fpage>e60980</fpage>.
<pub-id pub-id-type="doi">10.1371/journal.pone.0060980</pub-id><!--<pub-id pub-id-type="pmcid">3632540</pub-id>--><?supplied-pmid 23630576?><pub-id pub-id-type="pmid">23630576</pub-id></mixed-citation>
    </ref>
    <ref id="ref-3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wasserkort</surname><given-names>R</given-names></name><name><surname>Kalmar</surname><given-names>A</given-names></name><name><surname>Valcz</surname><given-names>G</given-names></name><etal/></person-group>:
<article-title>Aberrant septin 9 DNA methylation in colorectal cancer is restricted to a single CpG island.</article-title><source><italic>BMC Cancer.</italic></source><year>2013</year>;<volume>13</volume>(<issue>1</issue>):<fpage>398</fpage>.
<pub-id pub-id-type="doi">10.1186/1471-2407-13-398</pub-id><?supplied-pmid 23988185?><pub-id pub-id-type="pmid">23988185</pub-id></mixed-citation>
    </ref>
    <ref id="ref-4">
      <label>4</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eden</surname><given-names>S</given-names></name><name><surname>Cedar</surname><given-names>H</given-names></name></person-group>:
<article-title>Role of DNA methylation in the regulation of transcription.</article-title><source><italic>Curr Opin Genet Dev.</italic></source><year>1994</year>;<volume>4</volume>(<issue>2</issue>):<fpage>255</fpage>–<lpage>9</lpage>.
<pub-id pub-id-type="doi">10.1016/S0959-437X(05)80052-8</pub-id><?supplied-pmid 8032203?><pub-id pub-id-type="pmid">8032203</pub-id></mixed-citation>
    </ref>
    <ref id="ref-5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eden</surname><given-names>A</given-names></name><name><surname>Gaudet</surname><given-names>F</given-names></name><name><surname>Waghmare</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>Chromosomal instability and tumors promoted by DNA hypomethylation.</article-title><source><italic>Science.</italic></source><year>2003</year>;<volume>300</volume>(<issue>5618</issue>):<fpage>455</fpage>.
<pub-id pub-id-type="doi">10.1126/science.1083557</pub-id><?supplied-pmid 12702868?><pub-id pub-id-type="pmid">12702868</pub-id></mixed-citation>
    </ref>
    <ref id="ref-6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>E</given-names></name><name><surname>Beard</surname><given-names>C</given-names></name><name><surname>Jaenisch</surname><given-names>R</given-names></name></person-group>:
<article-title>Role for DNA methylation in genomic imprinting.</article-title><source><italic>Nature.</italic></source><year>1993</year>;<volume>366</volume>(<issue>6453</issue>):<fpage>362</fpage>–<lpage>5</lpage>.
<pub-id pub-id-type="doi">10.1038/366362a0</pub-id><?supplied-pmid 8247133?><pub-id pub-id-type="pmid">8247133</pub-id></mixed-citation>
    </ref>
    <ref id="ref-7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kato</surname><given-names>M</given-names></name><name><surname>Miura</surname><given-names>A</given-names></name><name><surname>Bender</surname><given-names>J</given-names></name><etal/></person-group>:
<article-title>Role of CG and non-CG methylation in immobilization of transposons in Arabidopsis.</article-title><source><italic>Curr Biol.</italic></source><year>2003</year>;<volume>13</volume>(<issue>5</issue>):<fpage>421</fpage>–<lpage>6</lpage>.
<pub-id pub-id-type="doi">10.1016/S0960-9822(03)00106-4</pub-id><?supplied-pmid 12620192?><pub-id pub-id-type="pmid">12620192</pub-id></mixed-citation>
    </ref>
    <ref id="ref-8">
      <label>8</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jones</surname><given-names>PA</given-names></name></person-group>:
<article-title>Functions of DNA methylation: islands, start sites, gene bodies and beyond.</article-title><source><italic>Nat Rev Genet.</italic></source><year>2012</year>;<volume>13</volume>(<issue>7</issue>):<fpage>484</fpage>–<lpage>92</lpage>.
<pub-id pub-id-type="doi">10.1038/nrg3230</pub-id><?supplied-pmid 22641018?><pub-id pub-id-type="pmid">22641018</pub-id></mixed-citation>
    </ref>
    <ref id="ref-9">
      <label>9</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laird</surname><given-names>PW</given-names></name></person-group>:
<article-title>Principles and challenges of genomewide DNA methylation analysis.</article-title><source><italic>Nat Rev Genet.</italic></source><year>2010</year>;<volume>11</volume>(<issue>3</issue>):<fpage>191</fpage>–<lpage>203</lpage>.
<pub-id pub-id-type="doi">10.1038/nrg2732</pub-id><?supplied-pmid 20125086?><pub-id pub-id-type="pmid">20125086</pub-id></mixed-citation>
    </ref>
    <ref id="ref-10">
      <label>10</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lister</surname><given-names>R</given-names></name><name><surname>O’Malley</surname><given-names>RC</given-names></name><name><surname>Tonti-Filippini</surname><given-names>J</given-names></name><etal/></person-group>:
<article-title>Highly integrated single-base resolution maps of the epigenome in Arabidopsis.</article-title><source><italic>Cell.</italic></source><year>2008</year>;<volume>133</volume>(<issue>3</issue>):<fpage>523</fpage>–<lpage>36</lpage>.
<pub-id pub-id-type="doi">10.1016/j.cell.2008.03.029</pub-id><!--<pub-id pub-id-type="pmcid">2723732</pub-id>--><?supplied-pmid 18423832?><pub-id pub-id-type="pmid">18423832</pub-id></mixed-citation>
    </ref>
    <ref id="ref-11">
      <label>11</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cokus</surname><given-names>SJ</given-names></name><name><surname>Feng</surname><given-names>S</given-names></name><name><surname>Zhang</surname><given-names>X</given-names></name><etal/></person-group>:
<article-title>Shotgun bisulphite sequencing of the Arabidopsis genome reveals DNA methylation patterning.</article-title><source><italic>Nature.</italic></source><year>2008</year>;<volume>452</volume>(<issue>7184</issue>):<fpage>215</fpage>–<lpage>9</lpage>.
<pub-id pub-id-type="doi">10.1038/nature06745</pub-id><!--<pub-id pub-id-type="pmcid">2377394</pub-id>--><?supplied-pmid 18278030?><pub-id pub-id-type="pmid">18278030</pub-id></mixed-citation>
    </ref>
    <ref id="ref-12">
      <label>12</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meissner</surname><given-names>A</given-names></name><name><surname>Mikkelsen</surname><given-names>TS</given-names></name><name><surname>Gu</surname><given-names>H</given-names></name><etal/></person-group>:
<article-title>Genome-scale DNA methylation maps of pluripotent and differentiated cells.</article-title><source><italic>Nature.</italic></source><year>2008</year>;<volume>454</volume>(<issue>7205</issue>):<fpage>766</fpage>–<lpage>70</lpage>.
<pub-id pub-id-type="doi">10.1038/nature07107</pub-id><!--<pub-id pub-id-type="pmcid">2896277</pub-id>--><?supplied-pmid 18600261?><pub-id pub-id-type="pmid">18600261</pub-id></mixed-citation>
    </ref>
    <ref id="ref-13">
      <label>13</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lister</surname><given-names>R</given-names></name><name><surname>Ecker</surname><given-names>JR</given-names></name></person-group>:
<article-title>Finding the fifth base: genome-wide sequencing of cytosine methylation.</article-title><source><italic>Genome Res.</italic></source><year>2009</year>;<volume>19</volume>(<issue>6</issue>):<fpage>959</fpage>–<lpage>66</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.083451.108</pub-id><?supplied-pmid 19273618?><pub-id pub-id-type="pmid">19273618</pub-id></mixed-citation>
    </ref>
    <ref id="ref-14">
      <label>14</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krueger</surname><given-names>F</given-names></name><name><surname>Andrews</surname><given-names>SR</given-names></name></person-group>:
<article-title>Bismark: a flexible aligner and methylation caller for Bisulfite-Seq applications.</article-title><source><italic>Bioinformatics.</italic></source><year>2011</year>;<volume>27</volume>(<issue>11</issue>):<fpage>1571</fpage>–<lpage>2</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btr167</pub-id><!--<pub-id pub-id-type="pmcid">3102221</pub-id>--><?supplied-pmid 21493656?><pub-id pub-id-type="pmid">21493656</pub-id></mixed-citation>
    </ref>
    <ref id="ref-15">
      <label>15</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedersen</surname><given-names>B</given-names></name><name><surname>Hsieh</surname><given-names>TF</given-names></name><name><surname>Ibarra</surname><given-names>C</given-names></name><etal/></person-group>:
<article-title>MethylCoder: software pipeline for bisulfite-treated sequences.</article-title><source><italic>Bioinformatics.</italic></source><year>2011</year>;<volume>27</volume>(<issue>17</issue>):<fpage>2435</fpage>–<lpage>6</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btr394</pub-id><!--<pub-id pub-id-type="pmcid">3157921</pub-id>--><?supplied-pmid 21724594?><pub-id pub-id-type="pmid">21724594</pub-id></mixed-citation>
    </ref>
    <ref id="ref-16">
      <label>16</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hackenberg</surname><given-names>M</given-names></name><name><surname>Barturen</surname><given-names>G</given-names></name><name><surname>Oliver</surname><given-names>JL</given-names></name></person-group>:
<article-title>DNA Methylation - From Genomics to Technology.</article-title>(ed. Tatarinova, T.) (In-Tech,).<year>2012</year><pub-id pub-id-type="doi">10.5772/2159</pub-id></mixed-citation>
    </ref>
    <ref id="ref-17">
      <label>17</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>PY</given-names></name><name><surname>Cokus</surname><given-names>SJ</given-names></name><name><surname>Pellegrini</surname><given-names>M</given-names></name></person-group>:
<article-title>BS Seeker: precise mapping for bisulfite sequencing.</article-title><source><italic>BMC Bioinformatics.</italic></source><year>2010</year>;<volume>11</volume>:<fpage>203</fpage>.
<pub-id pub-id-type="doi">10.1186/1471-2105-11-203</pub-id><!--<pub-id pub-id-type="pmcid">2871274</pub-id>--><?supplied-pmid 20416082?><pub-id pub-id-type="pmid">20416082</pub-id></mixed-citation>
    </ref>
    <ref id="ref-18">
      <label>18</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frith</surname><given-names>MC</given-names></name><name><surname>Mori</surname><given-names>R</given-names></name><name><surname>Asai</surname><given-names>K</given-names></name></person-group>:
<article-title>A mostly traditional approach improves alignment of bisulfite-converted DNA.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2012</year>;<volume>40</volume>(<issue>13</issue>):<fpage>e100</fpage>.
<pub-id pub-id-type="doi">10.1093/nar/gks275</pub-id><!--<pub-id pub-id-type="pmcid">3401460</pub-id>--><?supplied-pmid 22457070?><pub-id pub-id-type="pmid">22457070</pub-id></mixed-citation>
    </ref>
    <ref id="ref-19">
      <label>19</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>EY</given-names></name><name><surname>Ponts</surname><given-names>N</given-names></name><name><surname>Le Roch</surname><given-names>KG</given-names></name><etal/></person-group>:
<article-title>BRAT-BW: efficient and accurate mapping of bisulfite-treated reads.</article-title><source><italic>Bioinformatics.</italic></source><year>2012</year>;<volume>28</volume>(<issue>13</issue>):<fpage>1795</fpage>–<lpage>6</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/bts264</pub-id><!--<pub-id pub-id-type="pmcid">3381974</pub-id>--><?supplied-pmid 22563065?><pub-id pub-id-type="pmid">22563065</pub-id></mixed-citation>
    </ref>
    <ref id="ref-20">
      <label>20</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krueger</surname><given-names>F</given-names></name><name><surname>Kreck</surname><given-names>B</given-names></name><name><surname>Franke</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>DNA methylome analysis using short bisulfite sequencing data.</article-title><source><italic>Nat Methods.</italic></source><year>2012</year>;<volume>9</volume>(<issue>2</issue>):<fpage>145</fpage>–<lpage>51</lpage>.
<pub-id pub-id-type="doi">10.1038/nmeth.1828</pub-id><?supplied-pmid 22290186?><pub-id pub-id-type="pmid">22290186</pub-id></mixed-citation>
    </ref>
    <ref id="ref-21">
      <label>21</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tomso</surname><given-names>DJ</given-names></name><name><surname>Bell</surname><given-names>DA</given-names></name></person-group>:
<article-title>Sequence context at human single nucleotide polymorphisms: overrepresentation of CpG dinucleotide at polymorphic sites and suppression of variation in CpG islands.</article-title><source><italic>J Mol Biol.</italic></source><year>2003</year>;<volume>327</volume>(<issue>2</issue>):<fpage>303</fpage>–<lpage>8</lpage>.
<pub-id pub-id-type="doi">10.1016/S0022-2836(03)00120-7</pub-id><?supplied-pmid 12628237?><pub-id pub-id-type="pmid">12628237</pub-id></mixed-citation>
    </ref>
    <ref id="ref-22">
      <label>22</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bird</surname><given-names>A</given-names></name></person-group>:
<article-title>Putting the DNA back into DNA methylation.</article-title><source><italic>Nat Genet.</italic></source><year>2011</year>;<volume>43</volume>(<issue>11</issue>):<fpage>1050</fpage>–<lpage>1</lpage>.
<pub-id pub-id-type="doi">10.1038/ng.987</pub-id><?supplied-pmid 22030606?><pub-id pub-id-type="pmid">22030606</pub-id></mixed-citation>
    </ref>
    <ref id="ref-23">
      <label>23</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lienert</surname><given-names>F</given-names></name><name><surname>Wirbelauer</surname><given-names>C</given-names></name><name><surname>Som</surname><given-names>I</given-names></name><etal/></person-group>:
<article-title>Identification of genetic elements that autonomously determine DNA methylation states.</article-title><source><italic>Nat Genet.</italic></source><year>2011</year>;<volume>43</volume>(<issue>11</issue>):<fpage>1091</fpage>–<lpage>7</lpage>.
<pub-id pub-id-type="doi">10.1038/ng.946</pub-id><?supplied-pmid 21964573?><pub-id pub-id-type="pmid">21964573</pub-id></mixed-citation>
    </ref>
    <ref id="ref-24">
      <label>24</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Siegmund</surname><given-names>KD</given-names></name><name><surname>Laird</surname><given-names>PW</given-names></name><etal/></person-group>:
<article-title>Bis-SNP: Combined DNA methylation and SNP calling for Bisulfite-seq data.</article-title><source><italic>Genome Biol.</italic></source><year>2012</year>;<volume>13</volume>(<issue>7</issue>):<fpage>R61</fpage>.
<pub-id pub-id-type="doi">10.1186/gb-2012-13-7-r61</pub-id><!--<pub-id pub-id-type="pmcid">3491382</pub-id>--><?supplied-pmid 22784381?><pub-id pub-id-type="pmid">22784381</pub-id></mixed-citation>
    </ref>
    <ref id="ref-25">
      <label>25</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Handsaker</surname><given-names>B</given-names></name><name><surname>Wysoker</surname><given-names>A</given-names></name><etal/></person-group>:
<article-title>The Sequence Alignment/Map format and SAMtools.</article-title><source><italic>Bioinformatics.</italic></source><year>2009</year>;<volume>25</volume>(<issue>16</issue>):<fpage>2078</fpage>–<lpage>9</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id><!--<pub-id pub-id-type="pmcid">2723002</pub-id>--><?supplied-pmid 19505943?><pub-id pub-id-type="pmid">19505943</pub-id></mixed-citation>
    </ref>
    <ref id="ref-26">
      <label>26</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ewing</surname><given-names>B</given-names></name><name><surname>Hillier</surname><given-names>L</given-names></name><name><surname>Wendl</surname><given-names>MC</given-names></name><etal/></person-group>:
<article-title>Base-calling of automated sequencer traces using phred. I. Accuracy assessment.</article-title><source><italic>Genome Res.</italic></source><year>1998</year>;<volume>8</volume>(<issue>3</issue>):<fpage>175</fpage>–<lpage>85</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.8.3.175</pub-id><?supplied-pmid 9521921?><pub-id pub-id-type="pmid">9521921</pub-id></mixed-citation>
    </ref>
    <ref id="ref-27">
      <label>27</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ewing</surname><given-names>B</given-names></name><name><surname>Green</surname><given-names>P</given-names></name></person-group>:
<article-title>Base-calling of automated sequencer traces using phred. II. Error probabilities.</article-title><source><italic>Genome Res.</italic></source><year>1998</year>;<volume>8</volume>(<issue>3</issue>):<fpage>186</fpage>–<lpage>94</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.8.3.186</pub-id><?supplied-pmid 9521922?><pub-id pub-id-type="pmid">9521922</pub-id></mixed-citation>
    </ref>
    <ref id="ref-28">
      <label>28</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Koboldt</surname><given-names>DC</given-names></name><name><surname>Chen</surname><given-names>K</given-names></name><name><surname>Wylie</surname><given-names>T</given-names></name><etal/></person-group>:
<article-title>VarScan: variant detection in massively parallel sequencing of individual and pooled samples.</article-title><source><italic>Bioinformatics.</italic></source><year>2009</year>;<volume>25</volume>(<issue>17</issue>):<fpage>2283</fpage>–<lpage>5</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btp373</pub-id><!--<pub-id pub-id-type="pmcid">2734323</pub-id>--><?supplied-pmid 19542151?><pub-id pub-id-type="pmid">19542151</pub-id></mixed-citation>
    </ref>
    <ref id="ref-29">
      <label>29</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Danecek</surname><given-names>P</given-names></name><name><surname>Auton</surname><given-names>A</given-names></name><name><surname>Abecasis</surname><given-names>G</given-names></name><etal/></person-group>:
<article-title>The variant call format and VCFtools.</article-title><source><italic>Bioinformatics.</italic></source><year>2011</year>;<volume>27</volume>(<issue>15</issue>):<fpage>2156</fpage>–<lpage>8</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btr330</pub-id><!--<pub-id pub-id-type="pmcid">3137218</pub-id>--><?supplied-pmid 21653522?><pub-id pub-id-type="pmid">21653522</pub-id></mixed-citation>
    </ref>
    <ref id="ref-30">
      <label>30</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lister</surname><given-names>R</given-names></name><name><surname>Pelizzola</surname><given-names>M</given-names></name><name><surname>Dowen</surname><given-names>RH</given-names></name><etal/></person-group>:
<article-title>Human DNA methylomes at base resolution show widespread epigenomic differences.</article-title><source><italic>Nature.</italic></source><year>2009</year>;<volume>462</volume>(<issue>7271</issue>):<fpage>315</fpage>–<lpage>22</lpage>.
<pub-id pub-id-type="doi">10.1038/nature08514</pub-id><!--<pub-id pub-id-type="pmcid">2857523</pub-id>--><?supplied-pmid 19829295?><pub-id pub-id-type="pmid">19829295</pub-id></mixed-citation>
    </ref>
    <ref id="ref-31">
      <label>31</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weisenberger</surname><given-names>DJ</given-names></name><name><surname>Campan</surname><given-names>M</given-names></name><name><surname>Long</surname><given-names>TI</given-names></name><etal/></person-group>:
<article-title>Analysis of repetitive element DNA methylation by MethyLight.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2005</year>;<volume>33</volume>(<issue>21</issue>):<fpage>6823</fpage>–<lpage>36</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/gki987</pub-id><!--<pub-id pub-id-type="pmcid">1301596</pub-id>--><?supplied-pmid 16326863?><pub-id pub-id-type="pmid">16326863</pub-id></mixed-citation>
    </ref>
    <ref id="ref-32">
      <label>32</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cingolani</surname><given-names>P</given-names></name><name><surname>Platts</surname><given-names>A</given-names></name><name><surname>Wang le</surname><given-names>L</given-names></name><etal/></person-group>:
<article-title>A program for annotating and predicting the effects of single nucleotide polymorphisms, SnpEff: SNPs in the genome of Drosophila melanogaster strain w1118; iso-2; iso-3.</article-title><source><italic>Fly (Austin).</italic></source><year>2012</year>;<volume>6</volume>(<issue>2</issue>):<fpage>80</fpage>–<lpage>92</lpage>.
<pub-id pub-id-type="doi">10.4161/fly.19695</pub-id><!--<pub-id pub-id-type="pmcid">3679285</pub-id>--><?supplied-pmid 22728672?><pub-id pub-id-type="pmid">22728672</pub-id></mixed-citation>
    </ref>
    <ref id="ref-33">
      <label>33</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bastone</surname><given-names>P</given-names></name><name><surname>Bravo</surname><given-names>IG</given-names></name><name><surname>Lochelt</surname><given-names>M</given-names></name></person-group>:
<article-title>Feline foamy virus-mediated marker gene transfer: identification of essential genetic elements and influence of truncated and chimeric proteins.</article-title><source><italic>Virology.</italic></source><year>2006</year>;<volume>348</volume>(<issue>1</issue>):<fpage>190</fpage>–<lpage>9</lpage>.
<pub-id pub-id-type="doi">10.1016/j.virol.2005.12.022</pub-id><?supplied-pmid 16443252?><pub-id pub-id-type="pmid">16443252</pub-id></mixed-citation>
    </ref>
    <ref id="ref-34">
      <label>34</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schultz</surname><given-names>MD</given-names></name><name><surname>Schmitz</surname><given-names>RJ</given-names></name><name><surname>Ecker</surname><given-names>JR</given-names></name></person-group>:
<article-title>‘Leveling’ the playing field for analyses of single-base resolution DNA methylomes.</article-title><source><italic>Trends Genet.</italic></source><year>2012</year>;<volume>28</volume>(<issue>12</issue>):<fpage>583</fpage>–<lpage>5</lpage>.
<pub-id pub-id-type="doi">10.1016/j.tig.2012.10.012</pub-id><!--<pub-id pub-id-type="pmcid">3523709</pub-id>--><?supplied-pmid 23131467?><pub-id pub-id-type="pmid">23131467</pub-id></mixed-citation>
    </ref>
    <ref id="ref-35">
      <label>35</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Negre</surname><given-names>V</given-names></name><name><surname>Grunau</surname><given-names>C</given-names></name></person-group>:
<article-title>The MethDB DAS server: adding an epigenetic information layer to the human genome.</article-title><source><italic>Epigenetics.</italic></source><year>2006</year>;<volume>1</volume>(<issue>2</issue>):<fpage>101</fpage>–<lpage>5</lpage>.
<pub-id pub-id-type="doi">10.4161/epi.1.2.2765</pub-id><?supplied-pmid 17965614?><pub-id pub-id-type="pmid">17965614</pub-id></mixed-citation>
    </ref>
    <ref id="ref-36">
      <label>36</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krueger</surname><given-names>F</given-names></name><name><surname>Andrews</surname><given-names>SR</given-names></name></person-group>:
<article-title>Bismark: a flexible aligner and methylation caller for Bisulfite-Seq applications.</article-title><source><italic>Bioinformatics.</italic></source><year>2011</year>;<volume>27</volume>(<issue>11</issue>):<fpage>1571</fpage>–<lpage>2</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/btr167</pub-id><!--<pub-id pub-id-type="pmcid">3102221</pub-id>--><?supplied-pmid 21493656?><pub-id pub-id-type="pmid">21493656</pub-id></mixed-citation>
    </ref>
    <ref id="ref-37">
      <label>37</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burset</surname><given-names>M</given-names></name><name><surname>Guigo</surname><given-names>R</given-names></name></person-group>:
<article-title>Evaluation of gene structure prediction programs.</article-title><source><italic>Genomics.</italic></source><year>1996</year>;<volume>34</volume>(<issue>3</issue>):<fpage>353</fpage>–<lpage>67</lpage>.
<pub-id pub-id-type="doi">10.1006/geno.1996.0298</pub-id><?supplied-pmid 8786136?><pub-id pub-id-type="pmid">8786136</pub-id></mixed-citation>
    </ref>
    <ref id="ref-38">
      <label>38</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>You</surname><given-names>N</given-names></name><name><surname>Murillo</surname><given-names>G</given-names></name><name><surname>Su</surname><given-names>X</given-names></name><etal/></person-group>:
<article-title>SNP calling using genotype model selection on high-throughput sequencing data.</article-title><source><italic>Bioinformatics.</italic></source><year>2012</year>;<volume>28</volume>(<issue>5</issue>):<fpage>643</fpage>–<lpage>50</lpage>.
<pub-id pub-id-type="doi">10.1093/bioinformatics/bts001</pub-id><!--<pub-id pub-id-type="pmcid">3338331</pub-id>--><?supplied-pmid 22253293?><pub-id pub-id-type="pmid">22253293</pub-id></mixed-citation>
    </ref>
    <ref id="ref-39">
      <label>39</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sherry</surname><given-names>ST</given-names></name><name><surname>Ward</surname><given-names>MH</given-names></name><name><surname>Kholodov</surname><given-names>M</given-names></name><etal/></person-group>:
<article-title>dbSNP: the NCBI database of genetic variation.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2001</year>;<volume>29</volume>(<issue>1</issue>):<fpage>308</fpage>–<lpage>11</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/29.1.308</pub-id><!--<pub-id pub-id-type="pmcid">29783</pub-id>--><?supplied-pmid 11125122?><pub-id pub-id-type="pmid">11125122</pub-id></mixed-citation>
    </ref>
    <ref id="ref-40">
      <label>40</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laurent</surname><given-names>L</given-names></name><name><surname>Wong</surname><given-names>E</given-names></name><name><surname>Li</surname><given-names>G</given-names></name><etal/></person-group>:
<article-title>Dynamic changes in the human methylome during differentiation.</article-title><source><italic>Genome Res.</italic></source><year>2010</year>;<volume>20</volume>(<issue>3</issue>):<fpage>320</fpage>–<lpage>31</lpage>.
<pub-id pub-id-type="doi">10.1101/gr.101907.109</pub-id><!--<pub-id pub-id-type="pmcid">2840979</pub-id>--><?supplied-pmid 20133333?><pub-id pub-id-type="pmid">20133333</pub-id></mixed-citation>
    </ref>
    <ref id="ref-41">
      <label>41</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karolchik</surname><given-names>D</given-names></name><name><surname>Kuhn</surname><given-names>RM</given-names></name><name><surname>Baertsch</surname><given-names>R</given-names></name><etal/></person-group>:
<article-title>The UCSC Genome Browser Database: 2008 update.</article-title><source><italic>Nucleic Acids Res.</italic></source><year>2008</year>;<volume>36</volume>(<issue>Database issue</issue>):<fpage>D773</fpage>–<lpage>9</lpage>.
<pub-id pub-id-type="doi">10.1093/nar/gkm966</pub-id><!--<pub-id pub-id-type="pmcid">2238835</pub-id>--><?supplied-pmid 18086701?><pub-id pub-id-type="pmid">18086701</pub-id></mixed-citation>
    </ref>
    <ref id="ref-42">
      <label>42</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barturen</surname><given-names>G</given-names></name><name><surname>Rueda</surname><given-names>A</given-names></name><name><surname>Oliver</surname><given-names>JL</given-names></name><etal/></person-group>:
<article-title>MethylExtract release 1.5.</article-title><source><italic>Zenodo.</italic></source><year>2014</year><ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5281/zenodo.8351">Data Source</ext-link></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="report3824" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.3889.r3824</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Stadler</surname>
          <given-names>Michael</given-names>
        </name>
        <xref ref-type="aff" rid="r3824a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r3824a1"><label>1</label>Friedrich-Miescher Institute for Biomedical Research, Basel, Switzerland</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>5</month>
      <year>2014</year>
    </pub-date>
    <related-article id="d35e3379" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.2-217.v2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The incompatibility with older Perl versions has been fixed, and the script (v1.7) runs now on RHEL6 (Perl v5.10.1).</p>
    <p>I agree that a ROC analysis for the results presented in Fig. 6 would require subsampling of C's to achieve a better balance between methylated and non-methylated states. It is unfortunate that the authors choose not to do that, because it limits the value of this analysis, however it should not preclude indexing of the article.</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report3823" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.3889.r3823</article-id>
    <title-group>
      <article-title>Referee response for version 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Krueger</surname>
          <given-names>Felix</given-names>
        </name>
        <xref ref-type="aff" rid="r3823a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r3823a1"><label>1</label>Babraham Bioinformatics, Babraham Institute, Babraham, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>4</month>
      <year>2014</year>
    </pub-date>
    <related-article id="d35e3429" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.2-217.v2">Version 2</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>All my comments were already satisfactorily, or will be addressed in an upcoming version of MethylExtract.</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report3164" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.2616.r3164</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Krueger</surname>
          <given-names>Felix</given-names>
        </name>
        <xref ref-type="aff" rid="r3164a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r3164a1"><label>1</label>Babraham Bioinformatics, Babraham Institute, Babraham, UK</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>1</month>
      <year>2014</year>
    </pub-date>
    <related-article id="d35e3477" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.2-217.v1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <bold>General comments </bold>
    </p>
    <p>MethylExtract is a new tool that implements several QC related steps on already aligned Bisulfite-Seq data. This includes the deduplication of clonal reads, filtering based on base call quality, identification of potential bisulfite conversion errors and most notably the detection of single nucleotide variants (SNVs) that would affect methylation calls, the latter of which is until now only being performed by Bis-SNP.</p>
    <p>After reading the documentation it was straight forward to set MethylExtract off, and it ran to completion in an acceptable time frame (~1d 7h for one lane of HiSeq data aligned against the human genome using Bismark). I liked that the deduplication tool that would potentially allow reads aligning to the same position in the genome to pass if they contain SNVs and thus originate from two distinct alleles (even though it is probably questionable whether one would expect to see this sort of reads a lot for large eukaryotic genomes at moderate read depth such as 15x).</p>
    <p>Even though I've got a few questions about how certain things are handled or documented in the current implementation of MethylExtract, I was quite impressed at how easy it was to get hold of SNV information using just one command. I am sure MethylExtract will prove a useful tool in the genuine analysis of bisulfite data.</p>
    <p>
      <bold>Handling paired-end alignments</bold>
    </p>
    <p>The only time I found mention of paired-end reads was in the explanation of the deduplication option 'delDup' in the MethylExtract Manual. One can further see that the options 'tagW' and 'tagC' for FLAG values of reads aligning to the Watson and Crick strands default to 0 and 16, respectively, which are standard FLAG values for forward or reverse mapping single-end reads. If MethylExtract currently only handles single-end experiments this is fair enough, even though it would be a serious limitation seeing that most data we generate is in fact paired-end data. Paired-end reads will have at least four different FLAG values, so it is unclear if and how one would specify these? Would the SNV detection would still work with paired-end reads? Are there options to remove overlapping parts in the reads? In any case, I think paired-end reads should be documented better, both in the manuscript and the manual.</p>
    <p>
      <bold>Handling SNV positions</bold>
    </p>
    <p>If I understood it correctly, CpG positions with a homozygous C to T SNV are eliminated by MethylExtract before reaching the final methylation output, but does this also happen for heterozygous loci? The manual mentions: "(v) SNV can be detected and removed" - can they or are they?</p>
    <p>It seems that MethylExtract reports only a single position (presumably the most 5' one?) for cytosines in CG or CHG context (this could also be mentioned in the manual). Are symmetrical cytosine positions completely eliminated from the output if SNVs are detected on at least one strand? Similarly, is the context of a cytosine determined purely by the genomic sequence or would a homozygous SNV effectively also change a C's context (e.g. would an A to G SNV from 'CAG' to 'CGG' change the context from CHG to CG?). I would find it useful to read some more information on how these cases are dealt with, maybe in the User Guide? Finally, to make it a bit more user-friendly I would welcome an option to include or exclude positions from the output specifically that were detected as homozygous or heterozygous SNVs.</p>
    <p>
      <bold>M-bias</bold>
    </p>
    <p>MethylExtract addresses several important aspects affecting the accuracy of BS-Seq experiments, however it doesn't mention the issue of methylation bias (M-bias) in the reads (described in
<ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/pubmed/23034175">Hansen
<italic>et al.,</italic> 2012</ext-link>). M-bias may have several causes, such as 5' bisulfite conversion failure (described in BSeQC -
<ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/pubmed/24064417">Lin
<italic>et al., </italic>2013</ext-link>), fill-in bias during library construction which is especially pronounced for paired-end reads (as an example see read 2 in this report:
<ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/PE_report.html">http://www.bioinformatics.babraham.ac.uk/projects/bismark/PE_report.html</ext-link>) or other technical reasons (e.g. PBAT libraries, an example report is available here:
<ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/SE_report.html">http://www.bioinformatics.babraham.ac.uk/projects/bismark/SE_report.html</ext-link>). Are there any plans to take M-bias into consideration in future versions of MethylExtract?</p>
    <p>
      <bold>5' end trimming</bold>
    </p>
    <p>Both the manuscript and the MethylExtract manual mention that there is an option to ignore bases at the 5' end of reads, e.g. "3 bp for the
<italic>MspI</italic> restriction sites of reduced representation bisulfite sequencing (RRBS) protocol". While the option is certainly useful, e.g. for the removal of M-bias in the reads, it should be noted that for standard (= directional) RRBS libraries the first 3bp should reflect the true genomic methylation state of the
<italic>MspI</italic> site and do not have to be ignored. The situation is somewhat different for non-directional reads or when reading through filled-in positions at the 3' end of reads. We have tried to illustrate this in a bit more detail in this brief RRBS guide (
<ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/RRBS_Guide.pdf">http://www.bioinformatics.babraham.ac.uk/projects/bismark/RRBS_Guide.pdf</ext-link>).</p>
    <p>
      <bold>Very minor</bold>
    </p>
    <p>The version of MethylExtract hosted on zenodo.org which I downloaded first was outdated (v1.3) and failed to run at some point. The latest version from
<ext-link ext-link-type="uri" xlink:href="http://bioinfo2.ugr.es/MethylExtract/">http://bioinfo2.ugr.es/MethylExtract/</ext-link> (v1.4) worked fine.</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report2607" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.2616.r2607</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Walter</surname>
          <given-names>Jörn</given-names>
        </name>
        <xref ref-type="aff" rid="r2607a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r2607a1"><label>1</label>Institute of Genetics/Epigenetics, University of Saarland, Saarbrücken, Germany</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>13</day>
      <month>1</month>
      <year>2014</year>
    </pub-date>
    <related-article id="d35e3602" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.2-217.v1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The mapping and calling of cytosine methylation in whole genome bisulfite sequencing is a challenging task. Following sequence alignment, the localisation and scoring of reliable and quantitative positional methylation information requires a number of control functions including the detection and high quality scoring of SNVs. So far BiSNP has been used as the major tool for these tasks. The MethylExtract tool now offers a (slightly) improveed software suite compiling state of the art (BiSNP-like) features with additional QCs. One advantage of MethylExtract is that the package can be executed in a single PERL script. Compared to BiSNP, MethylExtract reduces the error rate of false SNV calling by including an optimized PHRED score and  controlling for bisulfite conversion error rates. MethylExtract accepts SAM and BAM alignment files and cretaes an independent SNV output file (VCF). With SAM as an input MethylExtract runs about 2x faster compared to BiSNP. A performance test on 15x and 20x  artificial test alignment sets shows a better performance of MethylExtract in comparison to BiSNP but only with respect to specificity, while BiSNP has the better sensitivity. Unfortunately the authors did not run a direct comparison on real datasets. Overall MethylExtract is a nice compilation of surely useful tools for a comprehensive and quality controlled WGBS data analysis. The key features of the package are nicely documented. I only have my doubts that conversion rate errors calculated on spiked in control DNA really generates a meaningful background correction.</p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard.</p>
  </body>
</sub-article>
<sub-article id="report2103" article-type="peer-review">
  <front-stub>
    <article-id pub-id-type="doi">10.5256/f1000research.2616.r2103</article-id>
    <title-group>
      <article-title>Referee response for version 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Stadler</surname>
          <given-names>Michael</given-names>
        </name>
        <xref ref-type="aff" rid="r2103a1">1</xref>
        <role>Referee</role>
      </contrib>
      <aff id="r2103a1"><label>1</label>Friedrich-Miescher Institute for Biomedical Research, Basel, Switzerland</aff>
    </contrib-group>
    <author-notes>
      <fn fn-type="conflict">
        <p><bold>Competing interests: </bold>No competing interests were disclosed.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>25</day>
      <month>10</month>
      <year>2013</year>
    </pub-date>
    <related-article id="d35e3650" related-article-type="peer-reviewed-article" ext-link-type="doi" xlink:href="10.12688/f1000research.2-217.v1">Version 1</related-article>
    <custom-meta-group>
      <custom-meta>
        <meta-name>recommendation</meta-name>
        <meta-value>approve-with-reservations</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>The authors present the tool MethylExtract that combines extraction of methylation states and SNV calling, given alignments of bisulfite-converted reads to a reference in SAM/BAM format. Methylated CpG are mutation hotspots - dealing with SNVs is therefore an important part of any analysis of Bis-seq data.</p>
    <p>The main functions of MethylExtract are implemented in a single Perl script, which should make it easy to use - unfortunately I could not verify this because it failed to run in my environment (see below).</p>
    <p>The performance of MethylExtract is evaluated using simulated sequence data (completely methylated or completely unmethylated containing sequencing errors and SNVs) and compared to Bis-SNP, a conceptually similar tool that is based on the GATK variant calling package. The simulations cover most important aspects of the tool; however, the paper would benefit from extended simulations and a test on a real dataset. For example, the current evaluation does not cover Bis-seq datasets with very low or very high coverage or intermediate methylation levels (see minor issues below).</p>
    <p>The paper is clearly written, and the conclusions are supported by the presented results.</p>
    <p>
      <bold>Major issues:</bold>
      <list list-type="bullet">
        <list-item>
          <p>The
<bold>MethylExtract perl script</bold> (version 1.3) did not run in my environment (RHEL 6, with Kernel 2.6.32-220.7.1.el6.x86_64, perl 5.10.1 built for x86_64-linux-thread-multi). Trying to run the main script resulted in a compilation error:</p>
          <p>  &gt;perl MethylExtract_1.3.pl</p>
          <p>  Type of arg 1 to keys must be hash (not hash element) at MethylExtract_1.3.pl line 318, near "}) "</p>
          <p>  Execution of MethylExtract_1.3.pl aborted due to compilation errors.</p>
          <p>It is possible that the problem lies in the combination of the script and the test environment. However, the test environment fulfills the stated requirements and dependencies.</p>
        </list-item>
        <list-item>
          <p><bold>Figure 6</bold> and corresponding text: A single point comparison of Sn/PPV between MethylExtract and Bis-SNP, both with default parameters, is not very informative. Typically there is a trade-off between sensitivity and specificity which can be influenced by the choice of parameter values such as the score or P value cutoffs. It is possible that with slightly altered parameter values, the improved Sn/reduced PPV of MethylExtract compared to Bis-SNP turn into the opposite. The two tools should therefore be compared using varying parameter settings or cutoffs (altering the trade-off between Sn and PPV) and then relating the resulting specificity and sensitivity in an ROC analysis. The same applies in principle to the results presented in Figure 3.</p>
        </list-item>
      </list>
      <bold>Minor issues:</bold>
      <list list-type="bullet">
        <list-item>
          <p><bold>Simulations - readout:</bold> The current evaluation of "correct methylation" requires exact identity of simulated and estimated methylation states. This criterium is very stringent yet may not be able to uncover systematic problems. In practice, a very small deviation from the true methylation level may be tolerable. For illustration: A tool that produces many incorrect values that are off only by a small amount may be preferable to a tool that produces fewer incorrect values that are several-fold off. I would suggest using a continuous measure of performance (e.g. the differences between true and estimated methylation levels) or to allow for a minimum deviation.</p>
        </list-item>
        <list-item>
          <p><bold>Simulations - methylation levels:</bold> In the introduction, the authors point out the value of methylation levels as opposed to methylation states. Also, intermediate methylation is present in virtually all real world Bis-seq data sets. The simulations should take this into account and also contain C's with intermediate methylation levels (e.g. around 50% methylation).</p>
        </list-item>
        <list-item>
          <p><bold>Simulations - coverage:</bold> The current simulations are performed at 15- and 20 fold coverage and the two yield very similar results. More informative differences in performance may be observed when simulating data at even lower (~5-fold) or higher (&gt;30-fold) coverage, which are commonly found in published Bis-seq datasets.</p>
        </list-item>
        <list-item>
          <p><bold>Runtime comparison:</bold> It's surprising that even though MethylExtract supports BAM input, SAM.gz was used for runtime measurements, while Bis-SNP was reading from BAM input. Unpacking of alignments from BAM files is CPU-intensive, and I wonder if MethylExtract would take more time if it was run on the same input as Bis-SNP.</p>
        </list-item>
        <list-item>
          <p><bold>Table 1:</bold> MethylExtract is listed to support both SAM and BAM inputs. However, it does not directly read BAM files, but converts them to SAM using SAMtools. Using such a conversion, BSMAP and Bismark also support BAM input. I would suggest not to discriminate between SAM and BAM inputs in the table to avoid confusion based on this subtle difference.</p>
        </list-item>
        <list-item>
          <p><bold>Impact of parameter choice when analyzing real world data:</bold> For some parameters (e.g. "duplicated reads filter" and "elimination of bisulfite conversion failure"), it is unclear how they would impact results in a real world analysis. A comparison of the results obtained on an experimental dataset with different parameter values could identify sensitive parameters and guide users when choosing parameters for their own analysis.</p>
        </list-item>
        <list-item>
          <p><bold>Figure 5:</bold> The labels of the two y-axes are missing. In addition, CpG coverage (blue line) was probably scaled to be plotted on the same axis; if that is the case, it should be described in the legend and/or indicated in the plot.</p>
        </list-item>
      </list>
    </p>
    <p>I have read this submission. I believe that I have an appropriate level of expertise to confirm that it is of an acceptable scientific standard, however I have significant reservations, as outlined above.</p>
  </body>
</sub-article>
