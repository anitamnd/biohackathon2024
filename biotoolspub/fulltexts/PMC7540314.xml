<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with OASIS Tables with MathML3 v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archive-oasis-article1-mathml3.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jpoasis-nisons2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Magn Reson Med</journal-id>
    <journal-id journal-id-type="iso-abbrev">Magn Reson Med</journal-id>
    <journal-id journal-id-type="doi">10.1002/(ISSN)1522-2594</journal-id>
    <journal-id journal-id-type="publisher-id">MRM</journal-id>
    <journal-title-group>
      <journal-title>Magnetic Resonance in Medicine</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0740-3194</issn>
    <issn pub-type="epub">1522-2594</issn>
    <publisher>
      <publisher-name>John Wiley and Sons Inc.</publisher-name>
      <publisher-loc>Hoboken</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7540314</article-id>
    <article-id pub-id-type="doi">10.1002/mrm.28384</article-id>
    <article-id pub-id-type="publisher-id">MRM28384</article-id>
    <article-categories>
      <subj-group subj-group-type="overline">
        <subject>Full Paper</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Full Papers—Imaging Methodology</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A gradient optimization toolbox for general purpose time‐optimal MRI gradient waveform design</article-title>
      <alt-title alt-title-type="left-running-head">LOECHER et al.</alt-title>
    </title-group>
    <contrib-group>
      <contrib id="mrm28384-cr-0001" contrib-type="author" corresp="yes">
        <name>
          <surname>Loecher</surname>
          <given-names>Michael</given-names>
        </name>
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-6533-1113</contrib-id>
        <xref ref-type="aff" rid="mrm28384-aff-0001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="mrm28384-aff-0002">
          <sup>2</sup>
        </xref>
        <address>
          <email>mloecher@stanford.edu</email>
        </address>
      </contrib>
      <contrib id="mrm28384-cr-0002" contrib-type="author">
        <name>
          <surname>Middione</surname>
          <given-names>Matthew J.</given-names>
        </name>
        <xref ref-type="aff" rid="mrm28384-aff-0001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="mrm28384-aff-0002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib id="mrm28384-cr-0003" contrib-type="author">
        <name>
          <surname>Ennis</surname>
          <given-names>Daniel B.</given-names>
        </name>
        <xref ref-type="aff" rid="mrm28384-aff-0001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="mrm28384-aff-0002">
          <sup>2</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="mrm28384-aff-0001">
      <label>
        <sup>1</sup>
      </label>
      <named-content content-type="organisation-division">Department of Radiology</named-content>
      <institution>Stanford University</institution>
      <city>Stanford</city>
      <named-content content-type="country-part">CA</named-content>
      <country country="US">USA</country>
    </aff>
    <aff id="mrm28384-aff-0002">
      <label>
        <sup>2</sup>
      </label>
      <named-content content-type="organisation-division">Department of Radiology</named-content>
      <institution>Veterans Affairs Palo Alto Health Care System</institution>
      <city>Palo Alto</city>
      <named-content content-type="country-part">CA</named-content>
      <country country="US">USA</country>
    </aff>
    <author-notes>
      <corresp id="correspondenceTo"><label>*</label><bold>Correspondence</bold><break/>
Michael Loecher, Radiological Sciences Lab, Stanford University, 1201 Welch Road, Stanford, CA 94305, USA.<break/>
Email: <email>mloecher@stanford.edu</email><break/></corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>07</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>12</month>
      <year>2020</year>
    </pub-date>
    <volume>84</volume>
    <issue>6</issue>
    <issue-id pub-id-type="doi">10.1002/mrm.v84.6</issue-id>
    <fpage>3234</fpage>
    <lpage>3245</lpage>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>3</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>22</day>
        <month>5</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>26</day>
        <month>5</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <!--<copyright-statement content-type="issue-copyright"> &#x000a9; 2020 International Society for Magnetic Resonance in Medicine <copyright-statement>-->
      <copyright-statement content-type="article-copyright">© 2020 The Authors. <italic>Magnetic Resonance in Medicine</italic> published by Wiley Periodicals LLC on behalf of International Society for Magnetic Resonance in Medicine</copyright-statement>
      <license license-type="creativeCommonsBy-nc">
        <license-p>This is an open access article under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link> License, which permits use, distribution and reproduction in any medium, provided the original work is properly cited and is not used for commercial purposes.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="file:MRM-84-3234.pdf"/>
    <abstract>
      <sec id="mrm28384-sec-0001">
        <title>Purpose</title>
        <p>To introduce and demonstrate a software library for time‐optimal gradient waveform optimization with a wide range of applications. The software enables direct on‐the‐fly gradient waveform design on the scanner hardware for multiple vendors.</p>
      </sec>
      <sec id="mrm28384-sec-0002">
        <title>Methods</title>
        <p>The open‐source gradient optimization (GrOpt) toolbox was implemented in C with both Matlab and Python wrappers. The toolbox enables gradient waveforms to be generated based on a set of constraints that define the features and encodings for a given acquisition. The GrOpt optimization routine is based on the alternating direction method of multipliers (ADMM). Additional constraints enable error corrections to be added, or patient comfort and safety to be adressed. A range of applications and compute speed metrics are analyzed. Finally, the method is implemented and tested on scanners from different vendors.</p>
      </sec>
      <sec id="mrm28384-sec-0003">
        <title>Results</title>
        <p>Time‐optimal gradient waveforms for different pulse sequences and the constraints that define them are shown. Additionally, the ability to add, arbitrary motion (gradient moment) compensation or limit peripheral nerve stimulation is demonstrated. There exists a trade‐off between computation time and gradient raster time, but it was observed that acceptable gradient waveforms could be generated in 1‐40 ms. Gradient waveforms generated and run on the different scanners were functionally equivalent, and the images were comparable.</p>
      </sec>
      <sec id="mrm28384-sec-0004">
        <title>Conclusions</title>
        <p>GrOpt is an open source toolbox that enables on‐the‐fly optimization of gradient waveform design, subject to a set of defined constraints. GrOpt was presented for a range of imaging applications, analyzed in terms of computational complexity, and implemented to run on the scanner for a multi‐vendor demonstration.</p>
      </sec>
    </abstract>
    <kwd-group kwd-group-type="author-generated">
      <kwd id="mrm28384-kwd-0001">gradient waveform design</kwd>
      <kwd id="mrm28384-kwd-0002">magnetic resonance imaging</kwd>
      <kwd id="mrm28384-kwd-0003">open source software</kwd>
      <kwd id="mrm28384-kwd-0004">optimization</kwd>
    </kwd-group>
    <counts>
      <fig-count count="8"/>
      <table-count count="0"/>
      <page-count count="12"/>
      <word-count count="5923"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>source-schema-version-number</meta-name>
        <meta-value>2.0</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>cover-date</meta-name>
        <meta-value>December 2020</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>details-of-publishers-convertor</meta-name>
        <meta-value>Converter:WILEY_ML3GV2_TO_JATSPMC version:5.9.2 mode:remove_FC converted:07.10.2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <p content-type="self-citation">
      <mixed-citation publication-type="journal" id="mrm28384-cit-1001"><string-name><surname>Loecher</surname><given-names>M</given-names></string-name>, <string-name><surname>Middione</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>A gradient optimization toolbox for general purpose time‐optimal MRI gradient waveform design</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2020</year>;<volume>84</volume>:<fpage>3234</fpage>–<lpage>3245</lpage>. <pub-id pub-id-type="doi">10.1002/mrm.28384</pub-id></mixed-citation>
    </p>
  </notes>
</front>
<body id="mrm28384-body-0001">
  <sec id="mrm28384-sec-0005">
    <label>1</label>
    <title>INTRODUCTION</title>
    <p>Gradient waveforms for Magnetic Resonance Imaging (MRI) have traditionally been designed using a combination of analytical and <italic>ad hoc</italic> methods. These methods work well for specific subsets of acquisition types, but usually need to be re‐derived or re‐designed on an application‐specific basis. Additionally, as more performance or error reduction is required for an acquisition, the analytical solution can grow to become very specific, difficult to solve, or impossible to provide a single optimal solution. The determination of time‐optimal gradient waveforms can vary widely from application to application, making it difficult to be confident in the selection of a waveform generation algorithm. Additionally, even when an analytically optimal solution is achievable, it may not be used in a sequence due to implementation overhead.</p>
    <p>An alternative to this style of analytical or <italic>ad hoc</italic> methodology is to generate gradient waveforms via a numerical optimization algorithm. With this approach to gradient waveform design, the goal is to define the ideal characteristics of the target gradient waveforms and enable algorithmic generation of the rasterized gradient waveforms. Previous works have demonstrated this type of optimization with a range of solvers and applications, mostly showing the ability to generate more time‐optimal gradient waveforms than what may have been produced with a standard <italic>ad hoc</italic> implementation. These works include general usage optimizations that are primarily controlled by gradient moment constraints,<xref rid="mrm28384-bib-0001" ref-type="ref"><sup>1</sup></xref>, <xref rid="mrm28384-bib-0002" ref-type="ref"><sup>2</sup></xref>, <xref rid="mrm28384-bib-0003" ref-type="ref"><sup>3</sup></xref>, <xref rid="mrm28384-bib-0004" ref-type="ref"><sup>4</sup></xref> optimizations of flow and motion encoding waveforms,<xref rid="mrm28384-bib-0005" ref-type="ref"><sup>5</sup></xref>, <xref rid="mrm28384-bib-0006" ref-type="ref"><sup>6</sup></xref>, <xref rid="mrm28384-bib-0007" ref-type="ref"><sup>7</sup></xref> and optimizations of diffusion waveforms with different options for the reduction of coil heating,<xref rid="mrm28384-bib-0008" ref-type="ref"><sup>8</sup></xref> motion based errors,<xref rid="mrm28384-bib-0009" ref-type="ref"><sup>9</sup></xref> eddy current errors,<xref rid="mrm28384-bib-0010" ref-type="ref"><sup>10</sup></xref>, <xref rid="mrm28384-bib-0011" ref-type="ref"><sup>11</sup></xref> and errors due to concomitant fields.<xref rid="mrm28384-bib-0012" ref-type="ref"><sup>12</sup></xref>, <xref rid="mrm28384-bib-0013" ref-type="ref"><sup>13</sup></xref>, <xref rid="mrm28384-bib-0014" ref-type="ref"><sup>14</sup></xref>
</p>
    <p>These previous works have shown the capabilities of numerical optimization for gradient waveform design, demonstrating more time‐efficient waveforms, or gradients that can reduce artifacts in the resulting images. However, existing work in this field has often been difficult to translate to real‐world usage for multiple reasons. A principal reason is that these methods are often not sufficiently fast computationally to generate gradient waveforms on‐the‐fly (ie, within 10s of milliseconds). For most sequences, the optimal gradient waveform is different for every unique combination of sequence parameters, such as resolution, FOV, bandwidth, and slice orientation. Therefore, on‐the‐fly optimization enables all protocol options to remain available as the waveforms can be updated as the user is editing the sequence on the scanner. Additionally, many previous implementations were either closed source, or the source code and applications were limited in scope, so their usage was limited to a small subset of MRI problems.</p>
    <p>The goal of this work was to design an open source software package that generates time‐optimal gradient waveforms for a range of MRI protocols by providing a flexible set of input constraints to define the gradient waveforms. Additionally, constraints are made available that provide a framework to reduce imaging artifacts (eg, mitigate eddy currents) and increase patient comfort (eg, reduce peripheral nerve stimulation, PNS). These methods are also designed to solve the gradient waveform design problem using on‐the‐fly protocol realization in a clinical setting. The software is provided as the open source Gradient Optimization (GrOpt) toolbox available at <ext-link ext-link-type="uri" xlink:href="https://www.github.com/cmr-group/gropt">www.github.com/cmr-group/gropt</ext-link>.</p>
  </sec>
  <sec id="mrm28384-sec-0006">
    <label>2</label>
    <title>METHODS</title>
    <p>GrOpt is a software package that takes as input a set of constraints that define a pulse sequence, then seeks to find a feasible set of gradient waveforms that satisfies those constraints. Additional objective functions can be added to the procedure, to maximize or minimize features of the output gradient waveforms, or to find the gradient waveforms that meet the given constraints in the shortest amount of time possible. Figure <xref rid="mrm28384-fig-0001" ref-type="fig">1</xref> provides an outline of the toolbox operations, where input constraints are given, and the optimization routine seeks a gradient waveform subject to the constraints within a specified tolerance. The optimization routines are written in C for maximum compatibility on multiple scanner systems, easily compiling to C or C++ directly into sequences for vendor specific platforms. Additionally, Matlab and Python wrappers are provided for prototyping and visualizing gradient waveforms. An example of the usage with the Python wrapper is shown in Figure <xref rid="mrm28384-fig-0002" ref-type="fig">2</xref>, which shows how a diffusion encoding gradient waveform can be designed with GrOpt.</p>
    <sec id="mrm28384-sec-0007">
      <label>2.1</label>
      <title>Constraints</title>
      <p>The GrOpt toolbox uses a set of user‐defined constraints to meet the targeted purpose of the pulse sequence. The most fundamental of these constraints are on gradient hardware and gradient zeroth moment
<mml:math id="nlm-math-12"><mml:mfenced close=")" open="(" separators=""><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mfenced close="]" open="[" separators=""><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">mT</mml:mi><mml:mspace width="0.166667em"/><mml:mi mathvariant="normal">ms</mml:mi></mml:mrow><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mfenced></mml:mfenced></mml:math>. Setting a constraint on maximum allowed gradient amplitude
<mml:math id="nlm-math-13"><mml:mfenced close=")" open="(" separators=""><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:mfenced close="]" open="[" separators=""><mml:mfrac><mml:mi mathvariant="normal">mT</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mfenced></mml:mfenced></mml:math> and maximum allowed gradient slew rate
<mml:math id="nlm-math-14"><mml:mfenced close=")" open="(" separators=""><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:mfenced close="]" open="[" separators=""><mml:mfrac><mml:mi mathvariant="normal">mT</mml:mi><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mspace width="0.166667em"/><mml:mi mathvariant="normal">ms</mml:mi></mml:mrow></mml:mfrac></mml:mfenced></mml:mfenced></mml:math> ensures that any gradient waveform generated by the optimization are within scanner’s hardware limits. The gradient
<mml:math id="nlm-math-15"><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:math> represents the gradient area and is used to control the most common sequence needs, such as slice selection rewinding, readout prewinding, phase encoding, spoiling, and/or gradient balancing.</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0001" orientation="portrait" position="float">
        <label>Figure 1</label>
        <caption>
          <p>Flow chart showing the general operation of the GrOpt library. After getting user inputs, the optimization routine is run to generate acceptable waveforms. If the waveform is not possible, the routine may increase T, or change constraints as allowable to find an acceptable answer. Similarly, if a feasible answer is found, the optimization may try to lower <italic>T</italic> to find a more time optimal answer, as needed</p>
        </caption>
        <graphic id="nlm-graphic-1" xlink:href="MRM-84-3234-g001"/>
      </fig>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0002" orientation="portrait" position="float">
        <label>Figure 2</label>
        <caption>
          <p>Sample usage of the GrOpt library in Python. Parameters for the desired waveform are entered: diffusion b‐value maximization, hardware constraints,
<mml:math id="nlm-math-16"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math> nulling, and the timings related to the diffusion waveform. The optimization returns the desired waveform. The figure displays the gradient waveform, the slew rate of the waveform, and
<mml:math id="nlm-math-17"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math>,
<mml:math id="nlm-math-18"><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math>, and
<mml:math id="nlm-math-19"><mml:msub><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math> scaled to arbitrary units to compare the moment nulling properties</p>
        </caption>
        <graphic id="nlm-graphic-3" xlink:href="MRM-84-3234-g002"/>
      </fig>
      <p>Additional constraints available in the toolbox allow for further control of the output gradient waveforms. Constraints are available for any higher order gradient moment
<mml:math id="nlm-math-20"><mml:mfenced close=")" open="(" separators=""><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mfenced close="]" open="[" separators=""><mml:mfrac><mml:msup><mml:mrow><mml:mi mathvariant="normal">mT</mml:mi><mml:mspace width="0.166667em"/><mml:mi mathvariant="normal">ms</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msup><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mfenced></mml:mfenced></mml:math>, which allows for full or partial moment nulling to reduce error due to motion (such as in flow‐compensated encodings) or for motion encoding (such as in phase‐contrast MRI). It is even possible, for example, to design gradient waveforms with non‐zero
<mml:math id="nlm-math-21"><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub></mml:math> and nulled
<mml:math id="nlm-math-22"><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:math> for velocity‐sensitive and acceleration‐insensitive encoding.</p>
      <p>Minimization and maximization terms may also be added to the optimization, allowing for waveforms to be found that are optimized for these terms. For example, GrOpt implements a maximization of the diffusion b‐value, allowing for the highest b‐value to be found that fits within a given temporal footprint, while adhering to other constraints. Another example is the minimization of gradient duty cycle, allowing for waveforms to be produced that should result in the minimum possible duty cycle for a given set of constraints and sequence timings.</p>
      <p>Another included constraint can be placed on eddy currents, thereby enabling the effects of any number of eddy current time constant responses to be suppressed. This can decrease the negative effects of eddy currents on data acquisition, such as image distortions in echo planar imaging (EPI). Additionally, peripheral nerve stimulation (PNS) can be modeled with various methods such as Schulte et al<xref rid="mrm28384-bib-0015" ref-type="ref"><sup>15</sup></xref> and Hebrank et al,<xref rid="mrm28384-bib-0016" ref-type="ref"><sup>16</sup></xref> both of which are implemented in GrOpt as constraints. This PNS constraint allows the maximum gradient slew rate to be used, and derated only as necessary for patient comfort and safety. Traditionally PNS is handled with a global slew rate derating, which can be substantially less time efficient. The GrOpt approach permits more time‐optimal gradient waveform design, especially when compared to global slew rate derating. The constraints to the software are written in a modular fashion. This allows additional constraints to be easily added and appended to the optimization functions.</p>
      <p>Slice obliquity is handled using either a “rotationally invariant” approach that derates the hardware limitations by
<mml:math id="nlm-math-23"><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:math> and defines logical gradient waveforms compatible with all scan plane rotations; or using the “rotationally variant” approach that rotates the relevant constraints and solves for optimized gradient waveforms to define physical gradient waveforms that permit the full hardware limits to be used. An example of this is shown in Supporting Information Figure S1. While most sequence design problems can be designed on an axis‐by‐axis basis, the software can also optimize all three waveforms simultaneously. This is necessary for certain constraints such as PNS, which is based on a combination of all three physical gradient axes to accurately predict and constrain the solution.</p>
    </sec>
    <sec id="mrm28384-sec-0008">
      <label>2.2</label>
      <title>Optimization</title>
      <p>The optimization is initialized with a gradient waveform array of ones, with fixed size <italic>N</italic> and raster time <italic>dt</italic> determined by the user. The formulation of the problem is of the form: <disp-formula id="mrm28384-disp-0001"><label>(1)</label><mml:math id="nlm-math-24"><mml:mrow><mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="0.166667em"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:munder><mml:mspace width="1em"/><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject to</mml:mtext><mml:mspace width="1em"/><mml:mfenced close="|" open="|" separators=""><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced><mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mspace width="1em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>…</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mi>n</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where
<mml:math id="nlm-math-25"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math> is the objective function and may simply be
<mml:math id="nlm-math-26"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math> to define the optimization as a feasibility problem.
<mml:math id="nlm-math-27"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>g</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math> represents the
<mml:math id="nlm-math-28"><mml:msup><mml:mi>i</mml:mi><mml:mi mathvariant="italic">th</mml:mi></mml:msup></mml:math> constraint, which can take several forms. In most cases
<mml:math id="nlm-math-29"><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math> can be represented as a matrix or vector multiplication and may have an offset value if the target value of the constraint is not zero (
<mml:math id="nlm-math-30"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math>).
<mml:math id="nlm-math-31"><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math> represents the <italic>i</italic>th bound on the inequality constraint, thereby defining the tolerance of the solution. Smaller bounds will give a more precise solution, but may require more iterations to converge, introduce non‐time‐optimal trade‐offs, or result in the inability to minimize the objective function.</p>
      <p>The GrOpt routine is based on the alternating direction method of multipliers (ADMM),<xref rid="mrm28384-bib-0017" ref-type="ref"><sup>17</sup></xref> with modifications made to handle any number of constraints.<xref rid="mrm28384-bib-0018" ref-type="ref"><sup>18</sup></xref> This allows for quick updates of each constraint sub‐problem with proximal mappings, which is particularly efficient for inequality constraints common to the MRI problems described in this work. To speed up the algorithm further, an adaptive relaxation method is used, which updates each constraints penalty weight and over‐relaxation term every two iterations.<xref rid="mrm28384-bib-0019" ref-type="ref"><sup>19</sup></xref>, <xref rid="mrm28384-bib-0020" ref-type="ref"><sup>20</sup></xref> Stopping criteria are based on checks of feasibility of each constraint, as well as a conventional check on the convergence of the primal residual.<xref rid="mrm28384-bib-0020" ref-type="ref"><sup>20</sup></xref> If no feasible solution exists, or cannot be found by the optimization, the process is stopped after 20,000 iterations. Previous implementations of GrOpt<xref rid="mrm28384-bib-0007" ref-type="ref"><sup>7</sup></xref> used a similar optimization based on the Chambolle‐Pock primal dual algorithm<xref rid="mrm28384-bib-0021" ref-type="ref"><sup>21</sup></xref> with a re‐weighting scheme used to make sure constraints were met when possible. That solver produced similar results, but is slightly slower (Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref>A), and remains an optional solver in the software for comparison and backward compatibility with previous works.</p>
      <p>The output gradient waveforms from the optimization have a fixed duration (<italic>T</italic> = <italic>dt</italic>*<italic>N</italic>). Therefore, to determine time‐optimal gradient waveforms an outer optimization is also required. Multiple solutions in the software exist to perform this search efficiently without requiring much additional compute time. This is done by searching different temporal durations (<italic>T</italic>) in a multi‐threaded fashion and performing the initial search of <italic>T</italic> with higher <italic>dt</italic> to solve quickly, and using those high‐<italic>dt</italic> waveforms to warm start the target <italic>dt</italic> final optimization.</p>
    </sec>
    <sec id="mrm28384-sec-0009">
      <label>2.3</label>
      <title>Usage</title>
      <p>The GrOpt toolbox is run by first specifying the maximum gradient amplitude (
<mml:math id="nlm-math-32"><mml:msub><mml:mover accent="true"><mml:mi>G</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math>) and maximum slew rate (
<mml:math id="nlm-math-33"><mml:msub><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math>). A fixed gradient duration (<italic>T</italic> = <italic>N</italic>*<italic>dt</italic>) is required, so <italic>T</italic> and either <italic>dt</italic> or <italic>N</italic> must be entered as input. In practice, the user defines <italic>dt</italic> as either the scanner gradient raster time, or an integer multiple of it for easier interpolation. However, in this work <italic>N</italic> is used to investigate computational complexity more directly. Any number of gradient moment (
<mml:math id="nlm-math-34"><mml:msub><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub></mml:math>) constraints can then be added. The gradient moment constraints can limit the gradient moment of the entire waveform or any portion of the waveform. The latter is applicable when a discrete time‐optimal gradient is needed within a larger waveform, for example, when designing a spoiler gradient after readout. Fixed gradient waveform intervals can also be pre‐defined, such as with slice select gradients and readout gradients which are typically known <italic>a priori</italic>. Importantly, in these examples it is only necessary to define the gradient flat top (not the ramps). The optimization will find the time‐optimal way to connect these flat top gradients to the adjacent gradients. This avoids ramping gradient waveforms to zero unnecessarily, which costs time. These constraints are designed primarily for the gradients outside of the slice select and readout gradients, though constraints could be written to better design these gradients as well. Figure <xref rid="mrm28384-fig-0002" ref-type="fig">2</xref> shows an example use case of designing asymmetric diffusion gradients, where the code is shown to create constraints and generate a waveform. Figure <xref rid="mrm28384-fig-0003" ref-type="fig">3</xref> gives a conceptual overview of how waveforms can be defined purely based on hardware and moment constraints. Figure <xref rid="mrm28384-fig-0004" ref-type="fig">4</xref> shows an example of a gradient duty cycle minimizing waveform with a resultant gradient waveform shape that may not be obvious from conventional design approaches. The design target was a flow compensated phase encode gradient with a minimization term on gradient duty cycle
<mml:math id="nlm-math-35"><mml:mfenced close=")" open="(" separators=""><mml:mtext>Duty Cycle</mml:mtext><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:msubsup><mml:mi>G</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:mrow></mml:mfrac></mml:mfenced></mml:math>. Compared to simply derating gradient amplitude, GrOpt generates a waveform with the same temporal footprint and moments, but less gradient duty cycle.</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0003" orientation="portrait" position="float">
        <label>Figure 3</label>
        <caption>
          <p>A depiction of waveforms can be generated with constraints. Blue line represents gradients that the toolbox is generating via optimization, and red lines represent fixed slice select and readout gradients that were inputted as fixed into the toolbox. The top row shows the design of a simple bSSFP TR and moment constraints required. Bottom row shows the design of a fast spin echo train with flow compensated slice selects. The FSE echo train designed was shorter than a reference product sequence, despite the waveforms being able to be optimized analytically</p>
        </caption>
        <graphic id="nlm-graphic-5" xlink:href="MRM-84-3234-g003"/>
      </fig>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0004" orientation="portrait" position="float">
        <label>Figure 4</label>
        <caption>
          <p>A flow compensated readout prewinding gradient with
<mml:math id="nlm-math-36"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>11.74</mml:mn><mml:mfrac><mml:mi mathvariant="normal">mTms</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mrow></mml:math> and
<mml:math id="nlm-math-37"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>0</mml:mn><mml:mfrac><mml:msup><mml:mi mathvariant="normal">mTms</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mrow></mml:math>. A, Shows the fastest possible waveform. B, Shows the same waveform, but with
<mml:math id="nlm-math-38"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> derated to control the gradient duty cycle. C, Shows a GrOpt waveform with the same temporal footprint as (B), but created with a duty cycle minimization</p>
        </caption>
        <graphic id="nlm-graphic-7" xlink:href="MRM-84-3234-g004"/>
      </fig>
    </sec>
    <sec id="mrm28384-sec-0010">
      <label>2.4</label>
      <title>Computational complexity analysis</title>
      <p>Compute times were tested for a range of pulse sequence applications using a range of gradient waveform constraints. Execution times were measured while running the optimization routines in C, on a standard desktop computer (Intel Core i7‐7700k) by averaging the duration of 100 individual calls to the optimization function. The operation is single threaded and uses minimal memory (&lt;10 Mb).</p>
      <sec id="mrm28384-sec-0011">
        <label>2.4.1</label>
        <title>Diffusion</title>
        <p>Diffusion encoding gradient waveforms were optimized to eliminate gradient dead time (as can occur in spin echo EPI Diffusion Weighted Imaging (DWI) and reduce TE for higher SNR. The compute time was investigated relative to the choice of specified waveform discretization (<italic>N</italic>) and the type of gradient moment nulling (
<mml:math id="nlm-math-39"><mml:msub><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math>,
<mml:math id="nlm-math-40"><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math> and/or
<mml:math id="nlm-math-41"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math>). Compute times for designing time‐optimal diffusion encoding gradient waveforms for a range of constraints on eddy current nulling were investigated. The eddy current constraints included no nulling and nulling of eddy current time constant <italic>λ</italic> = 80 ms and nulling multiple time constants <italic>λ</italic> = 40, 80 ms.</p>
      </sec>
      <sec id="mrm28384-sec-0012">
        <label>2.4.2</label>
        <title>Phase contrast</title>
        <p>Compute times for designing time‐optimal phase‐contrast MRI slice‐selection and flow encoding gradients were also calculated. This gradient waveform design problem used a fixed and flat slice‐select gradient (excluding intermediate gradient ramps), and all other gradients were designed with GrOpt. The effect of including a PNS constraint was also evaluated.<xref rid="mrm28384-bib-0015" ref-type="ref"><sup>15</sup></xref>
</p>
      </sec>
    </sec>
    <sec id="mrm28384-sec-0013">
      <label>2.5</label>
      <title>Residual moments</title>
      <p>Defining acceptable thresholds for residual gradient moments is important when using optimization approaches. These residual moments need to be specified as a tolerance in the optimization. The optimization ends when the gradient waveform meets the target gradient moments, within a small residual moment tolerance. The choice of residual effects compute time, where a larger residual moment requires fewer iterations to reach an acceptable solution. However, a too large residual moment can cause imaging artifacts. Numerical simulations were performed to analyze the impact of residual gradient moments (due to non‐zero convergence criteria) on intravoxel phase dispersion.<xref rid="mrm28384-bib-0022" ref-type="ref"><sup>22</sup></xref> The simulation evaluated the effect of small
<mml:math id="nlm-math-42"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math>,
<mml:math id="nlm-math-43"><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math>, and
<mml:math id="nlm-math-44"><mml:msub><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math> residuals on data accuracy and apparent diffusion coefficient (ADC) in diffusion sequence. Additionally, the computational time in relation to the allowed residual moment was measured for a motion compensated diffusion gradient waveform, with different amounts of allowed residual moments.</p>
    </sec>
    <sec id="mrm28384-sec-0014">
      <label>2.6</label>
      <title>Imaging experiments</title>
      <p>In order to demonstrate multi‐vendor feasibility, GrOpt was integrated directly into diffusion pulse sequences for two vendor platforms (GE EPIC DV26.0R01 and Siemens IDEA VE11C) using their respective pulse sequence programing environments. The GE pulse sequence was also developed using the KS Foundation abstraction layer ( <ext-link ext-link-type="uri" xlink:href="http://www.ksfoundationepic.org">www.ksfoundationepic.org</ext-link>).<xref rid="mrm28384-bib-0023" ref-type="ref"><sup>23</sup></xref> Both sequences filled in all of the diffusion gradients with waveforms generated by GrOpt, while using their respective conventional RF and EPI readout waveforms. The optimization was able to be run in real‐time on the scanner, allowing for protocol parameters to be changed and the waveforms to update in a completely integrated manner. This means that waveforms are able to be regenerated as imaging protcol changes are made that effect the optimization, such as changing resolution. The number of calls to the GrOpt function was recorded within the sequence.</p>
      <p>Both sequences were used to acquire brain images in a single volunteer with IRB‐approved consent. The images were acquired with a 3T GE (MR750, GE Healthcare, Milwaukee, Wisconsin) and a 3T Siemens (Skyra, Siemens, Erlangen, Germany) using the GrOpt toolbox to design optimized diffusion encoding gradient waveforms for a scan protocol using
<mml:math id="nlm-math-45"><mml:mrow><mml:mn>2.5</mml:mn><mml:mspace width="0.166667em"/><mml:msup><mml:mtext>mm</mml:mtext><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math> in‐plane resolution, no parallel imaging, a full Fourier acquisition, and b‐value =
<mml:math id="nlm-math-46"><mml:mrow><mml:mn>1000</mml:mn><mml:mspace width="0.166667em"/><mml:msup><mml:mtext>mm</mml:mtext><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">s</mml:mi></mml:mrow></mml:math> for a six‐direction tensor diffusion encoding scheme. The waveforms and images were compared qualitatively.</p>
    </sec>
  </sec>
  <sec id="mrm28384-sec-0015">
    <label>3</label>
    <title>RESULTS</title>
    <sec id="mrm28384-sec-0016">
      <label>3.1</label>
      <title>Computational complexity analysis</title>
      <p>Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref> shows compute times for a range of fixed <italic>N</italic> and various combinations of gradient moment nulling and eddy current time constant nulling. Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref>B shows the results of a comparison of compute time with <italic>N</italic>, as well as the impact of motion compensation on the computation times. Similar compute times are seen for all levels of motion compensation, with small increases for additional motion constraints. Computation complexity ranged from
<mml:math id="nlm-math-47"><mml:mrow><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>0.90</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math> to
<mml:math id="nlm-math-48"><mml:mrow><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>1.32</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math>. Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref>C shows example gradient waveforms with different <italic>N</italic> and demonstrates that using smaller values can lead to &lt;1 ms longer gradient waveforms for the same b‐value. Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref>D expands on this and shows the minimum TE needed to achieve b‐value = 1000 
<mml:math id="nlm-math-49"><mml:msup><mml:mi mathvariant="normal">mm</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math>/s. It is seen that for <italic>N</italic> = 64 the TEs were within 1ms of the shortest TE and with <italic>N</italic> = 128 the TEs were within 0.5 ms of the shortest TE. Figure <xref rid="mrm28384-fig-0005" ref-type="fig">5</xref>E demonstrates the differences in compute times for a range of <italic>N</italic> and different eddy current nulling constraints for an
<mml:math id="nlm-math-50"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>0</mml:mn></mml:mrow></mml:math> diffusion encoding gradient waveform.</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0005" orientation="portrait" position="float">
        <label>Figure 5</label>
        <caption>
          <p>A, shows the compute time of diffusion gradient waveforms in relation to the number of computed gradient points. B, Shows the actual output waveforms from <italic>N</italic> = 512 and <italic>N</italic> = 64. C, Shows the TE that would be achieved for a given <italic>N</italic>. D, Shows the compute times in relation to <italic>N</italic> with
<mml:math id="nlm-math-51"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math> compensation and different eddy current nulling options</p>
        </caption>
        <graphic id="nlm-graphic-9" xlink:href="MRM-84-3234-g005"/>
      </fig>
      <p>Figure <xref rid="mrm28384-fig-0006" ref-type="fig">6</xref> shows several results for the GrOpt optimization of a phase‐contrast sequence with and without a PNS constraint. Figure <xref rid="mrm28384-fig-0006" ref-type="fig">6</xref>A shows the compute time in relation to <italic>N</italic>, where without a PNS constraint the computation complexity was
<mml:math id="nlm-math-52"><mml:mrow><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>1.50</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math> and with the PNS constraint the complexity was
<mml:math id="nlm-math-53"><mml:mrow><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>2.32</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math>. In all cases the choice of <italic>N</italic> had no effect on the minimum <italic>T</italic> required to meet the constraints (<italic>T</italic> = 3.42 ms for PNS constrained and <italic>T</italic> = 4.14 ms for the slew‐rate derated). Figure <xref rid="mrm28384-fig-0006" ref-type="fig">6</xref>B shows the waveforms that were generated, and Figure <xref rid="mrm28384-fig-0006" ref-type="fig">6</xref>C shows the PNS estimate for each waveform.</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0006" orientation="portrait" position="float">
        <label>Figure 6</label>
        <caption>
          <p>Flow gradient waveforms with
<mml:math id="nlm-math-54"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>11.74</mml:mn><mml:mfrac><mml:msup><mml:mi mathvariant="normal">mTms</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mrow></mml:math> corresponding to
<mml:math id="nlm-math-55"><mml:mrow><mml:mi mathvariant="normal">Venc</mml:mi><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>100</mml:mn><mml:mfrac><mml:mi mathvariant="normal">cm</mml:mi><mml:mi mathvariant="normal">s</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math>
<mml:math id="nlm-math-56"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>80</mml:mn><mml:mfrac><mml:mi mathvariant="normal">mT</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mfrac></mml:mrow></mml:math>, and
<mml:math id="nlm-math-57"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub><mml:mspace width="0.166667em"/><mml:mo>=</mml:mo><mml:mspace width="0.166667em"/><mml:mn>200</mml:mn><mml:mfrac><mml:mi>T</mml:mi><mml:mi mathvariant="normal">ms</mml:mi></mml:mfrac></mml:mrow></mml:math>. A, shows the compute time of a flow gradient waveform in relation to the number of computed gradient points, with and without a PNS constraint. B, Shows the waveforms with and without the PNS constraint. C, shows plots of the PNS of both output waveforms</p>
        </caption>
        <graphic id="nlm-graphic-11" xlink:href="MRM-84-3234-g006"/>
      </fig>
    </sec>
    <sec id="mrm28384-sec-0017">
      <label>3.2</label>
      <title>Residual moments</title>
      <p>Figure <xref rid="mrm28384-fig-0007" ref-type="fig">7</xref> compares simulated ADC values for a range of residual moments. A ≤5% increase in the measured ADC was observed when the residual
<mml:math id="nlm-math-58"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math> was on the order of
<mml:math id="nlm-math-59"><mml:mrow><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="normal">mT</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">m</mml:mi><mml:mspace width="0.166667em"/><mml:mo>×</mml:mo><mml:mspace width="0.166667em"/><mml:mtext>ms</mml:mtext></mml:mrow></mml:math>, or the residual
<mml:math id="nlm-math-60"><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math> is on the order of
<mml:math id="nlm-math-61"><mml:mrow><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup><mml:mspace width="0.166667em"/><mml:mtext>mT</mml:mtext><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">m</mml:mi><mml:mspace width="0.166667em"/><mml:mo>×</mml:mo><mml:mspace width="0.166667em"/><mml:msup><mml:mtext>ms</mml:mtext><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math>, or the residual
<mml:math id="nlm-math-62"><mml:msub><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math> is on the order of
<mml:math id="nlm-math-63"><mml:mrow><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mspace width="0.166667em"/><mml:mi mathvariant="normal">mT</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">m</mml:mi><mml:mspace width="0.166667em"/><mml:mo>×</mml:mo><mml:mspace width="0.166667em"/><mml:msup><mml:mi mathvariant="normal">ms</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math> (isocontour of Figure <xref rid="mrm28384-fig-0007" ref-type="fig">7</xref>A‐C). Figure <xref rid="mrm28384-fig-0007" ref-type="fig">7</xref>D shows the impact of the allowed residual moment on computation time, where the compute time increased with smaller residual moments. As the moment constraining operation remained the same, this difference in compute time is due to an increased number of iterations required (Figure <xref rid="mrm28384-fig-0007" ref-type="fig">7</xref>E).</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0007" orientation="portrait" position="float">
        <label>Figure 7</label>
        <caption>
          <p>Numerical simulations showing the impact on measured ADC arising from intravoxel phase dispersion (signal loss) as a function of residual
<mml:math id="nlm-math-64"><mml:msub><mml:mi>M</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math> and pixel size (A), residual
<mml:math id="nlm-math-65"><mml:msub><mml:mi>M</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math> and intravoxel velocity gradients (B), and residual
<mml:math id="nlm-math-66"><mml:msub><mml:mi>M</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math> and intravoxel acceleration gradients (C). ADC’ values that vary ≤5% compared to the simulated ADC (
<mml:math id="nlm-math-67"><mml:mrow><mml:mn>3</mml:mn><mml:mspace width="0.166667em"/><mml:mo>×</mml:mo><mml:mspace width="0.166667em"/><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mi mathvariant="normal">mm</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">s</mml:mi></mml:mrow></mml:math>) and b‐value (1000 
<mml:math id="nlm-math-68"><mml:mrow><mml:msup><mml:mi mathvariant="normal">mm</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mi mathvariant="normal">s</mml:mi></mml:mrow></mml:math>), are outlined in red. The compute time (D) and number of iterations (E) both increase with an increasing residual moment tolerance, which arises to due stricter moment convergence criteria</p>
        </caption>
        <graphic id="nlm-graphic-13" xlink:href="MRM-84-3234-g007"/>
      </fig>
    </sec>
    <sec id="mrm28384-sec-0018">
      <label>3.3</label>
      <title>Imaging experiments</title>
      <p>Figure <xref rid="mrm28384-fig-0008" ref-type="fig">8</xref> shows the GrOpt optimized diffusion encoding gradient waveforms as designed on each vendor’s scanner and the resultant diffusion encoded magnitude image for the same volunteer. The gradient waveforms show some differences due to differences in the RF pulse durations and differences in the EPI readouts implemented by each vendor. GrOpt accounts for these differences, to generate the time‐optimal gradient waveforms in both cases. The resultant images are well matched qualitatively. For reference, during typical modification of protocol parameters (resolution, FOV, and undersampling factor), the GrOpt library was called about 100 times. When designing a sequence from scratch and changing most protocol parameters, the library was called about 400 times.</p>
      <fig fig-type="Figure" xml:lang="en" id="mrm28384-fig-0008" orientation="portrait" position="float">
        <label>Figure 8</label>
        <caption>
          <p>Waveforms and magnitude images from the imaging experiments. Actual waveforms are plotted as exported from their respective Programing environments. Non‐relevant/proprietary elements of the waveform are blocked out</p>
        </caption>
        <graphic id="nlm-graphic-15" xlink:href="MRM-84-3234-g008"/>
      </fig>
    </sec>
  </sec>
  <sec id="mrm28384-sec-0019">
    <label>4</label>
    <title>DISCUSSION</title>
    <p>The GrOpt toolbox can generate waveforms for a variety of applications with computational speeds that allow for on‐the‐fly usage on the scanner. The toolbox can lead to rapid development of gradient waveform designs, and allows for cross‐vendor use. Computational times for various real‐world scenarios were investigated and it was seen that nearly time‐optimal waveforms could be generated in 1‐50 ms depending on the application. This represents a 100‐1000x increase in compute time compared to values reported in the literature.</p>
    <p>The analysis of diffusion encoding waveform compute time in relation to <italic>N</italic>, the number of moment constraints, and the number of eddy current constraints showed that diffusion gradient waveforms can be computed within 1 ms of optimal timings with <italic>N</italic> &gt; 64. With <italic>N</italic> in the range of 64‐128 this corresponds to gradient raster times of <italic>dt</italic> = 400‐800 ms. The numerical simulations provided insight into the allowable moment residual that should be used to balance image accuracy and compute times. These settings allowed for diffusion gradient waveforms to be generated in approximately 10‐50 ms.</p>
    <p>The analysis of PC‐MRI encoding gradient waveforms demonstrated that the choice of gradient raster time had very little effect on the minimum achievable gradient duration with <italic>N</italic> &gt; 32. For typical encoding gradients of duration 1‐10 ms, this corresponds to a gradient raster time <italic>dt</italic> = 10‐300 ms. These parameters allowed for the GrOpt toolbox to compute gradient waveforms within about 1‐10 ms. This choice of gradient size (<italic>N</italic>) and raster time (<italic>dt</italic>) may need to be adjusted for longer gradients waveforms that encompass multiple sets of encodings, such a multiecho turbo‐spin echo sequence.</p>
    <p>With the addition of multiple constraints on the gradient waveform design problem, the convexity of the solution space becomes difficult to prove. Initial tests to investigate this question showed that randomized starts all produced the same waveform,<xref rid="mrm28384-bib-0024" ref-type="ref"><sup>24</sup></xref> however this is not a complete proof of convexity. Additionally, multiple works have shown that the ADMM style solvers used in this software package can, in many cases, be robust to solving non‐convex problems, and will converge to the global minimum of the problem.<xref rid="mrm28384-bib-0025" ref-type="ref"><sup>25</sup></xref>, <xref rid="mrm28384-bib-0026" ref-type="ref"><sup>26</sup></xref>, <xref rid="mrm28384-bib-0027" ref-type="ref"><sup>27</sup></xref> The question of whether a waveform is truly time‐optimal is difficult to answer. Brute‐force approaches to the problem are computationally very expensive, particularly when arbitrarily shaped gradient waveforms are considered, and when more complicated measures such as eddy current response and PNS are introduced. Nevertheless, the GrOpt toolbox will produced the fastest possible gradient waveforms that it can find in its search, and at this point no waveform was seen that was not time‐optimal to our knowledge.</p>
    <p>Using GrOpt in individual sequences can involve using the toolbox to create the entire TR, or to generate specific blocks of a sequence interleaved with traditional designs. With the fast compute times, re‐designing waveforms on the scanner as the protocol is edited is feasible, with little addition latency in the user interface. The total time to design the gradient waveforms with GrOpt may include a search for the optimal timings, which typically requires multiple optimizations. GrOpt accelerates the outer‐loop search using: (a) a coarse‐to‐fine dt to quickly refine the initial gradient waveform timing; and (b) a multi‐threaded search for a feasible <italic>T</italic>. The search time can be further reduced by storing pre‐computed waveforms to warm start the optimization, particularly for protocols that are frequently modified within a narrow range of parameters.</p>
    <p>Future work for the GrOpt toolbox includes adding more constraint options to the package. This may enable limiting concomitant field terms, attenuating acoustic noise, or further constraints on gradient heating limits. Additionally, the GrOpt toolbox has not been used to optimize readout trajectories or slice‐select gradients, which would allow for even more control over the optimization of entire sequence.</p>
  </sec>
  <sec id="mrm28384-sec-0020">
    <label>5</label>
    <title>CONCLUSION</title>
    <p>GrOpt is open source toolbox that enables on‐the‐fly optimization of gradient waveform design subject to a set of defined constraints. GrOpt was presented for a range of imaging applications, analyzed in terms of computational complexity, and implemented to run on the scanner for a multi‐vendor demonstration.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="mrm28384-sup-0001">
      <caption>
        <p><bold>FIGURE S1</bold> An overview of the methods for handling slice obliquity in GrOpt. “Logical coordinates” refer to the readout, phase encode, slice select directions. “Physical coordinates” refer to the fixed <italic>x</italic>, <italic>y</italic>, <italic>z</italic> directions of the scanner gradient system. A, Shows the specific (example) constraints used to create a 2D bSSFP sequence. B, Example rotation matrix that transforms from logical coordinates to physical coordinates (in this case a
<mml:math id="nlm-math-1"><mml:msup><mml:mn>45</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:math> rotation around the <italic>y</italic>‐axis). C, Pulse sequence timing diagram used to define the constraint intervals. D, Gradient waveforms generated with
<mml:math id="nlm-math-2"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> and
<mml:math id="nlm-math-3"><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> derated by a “rotationally invariant” factor of
<mml:math id="nlm-math-4"><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:math>, which permits all rotations to remain within the full
<mml:math id="nlm-math-5"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> and
<mml:math id="nlm-math-6"><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math>. E, An example where the full
<mml:math id="nlm-math-7"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> and
<mml:math id="nlm-math-8"><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> were used, which produces a feasible waveform in logical coordinates, but after rotation
<mml:math id="nlm-math-9"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> is exceeded (red arrow), making the waveform infeasible. F, An example where the full
<mml:math id="nlm-math-10"><mml:msub><mml:mi>G</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> and
<mml:math id="nlm-math-11"><mml:msub><mml:mi>S</mml:mi><mml:mo movablelimits="true">max</mml:mo></mml:msub></mml:math> were used, and the waveform was solved directly in the physical coordinate system by applying the rotation matrix to the constraints. This allows for the full hardware limits to be used. The TRs for D, E, and F, are 6.30 ms (feasible), 5.50 ms (infeasible) and 5.70 ms (feasible)</p>
      </caption>
      <media xlink:href="MRM-84-3234-s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list content-type="cited-references" id="mrm28384-bibl-0001">
    <title>REFERENCES</title>
    <ref id="mrm28384-bib-0001">
      <label>1</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0001"><string-name><surname>Simonetti</surname><given-names>OP</given-names></string-name>, <string-name><surname>Duerk</surname><given-names>JL</given-names></string-name>, <string-name><surname>Chankong</surname><given-names>V</given-names></string-name>. <article-title>MRI gradient waveform design by numerical optimization</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>1993</year>;<volume>29</volume>:<fpage>498</fpage>‐<lpage>504</lpage>.<pub-id pub-id-type="pmid">8464366</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0002">
      <label>2</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0002"><string-name><surname>Hargreaves</surname><given-names>BA</given-names></string-name>, <string-name><surname>Nishimura</surname><given-names>DG</given-names></string-name>, <string-name><surname>Conolly</surname><given-names>SM</given-names></string-name>. <article-title>Time‐optimal multidimensional gradient waveform design for rapid imaging</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2004</year>;<volume>51</volume>:<fpage>81</fpage>‐<lpage>92</lpage>.<pub-id pub-id-type="pmid">14705048</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0003">
      <label>3</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0003"><string-name><surname>Atalar</surname><given-names>E</given-names></string-name>, <string-name><surname>McVeigh</surname><given-names>ER</given-names></string-name>. <article-title>Minimization of dead‐periods in mri pulse sequences for imaging oblique planes</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>1994</year>;<volume>32</volume>:<fpage>773</fpage>‐<lpage>777</lpage>.<pub-id pub-id-type="pmid">7869900</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0004">
      <label>4</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0004"><string-name><surname>Derbyshire</surname><given-names>JA</given-names></string-name>, <string-name><surname>Herzka</surname><given-names>DA</given-names></string-name>, <string-name><surname>McVeigh</surname><given-names>ER</given-names></string-name>, <string-name><surname>Lederman</surname><given-names>RJ</given-names></string-name>. <article-title>Efficient implementation of hardware‐optimized gradient sequences for real‐time imaging</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2010</year>;<volume>64</volume>:<fpage>1814</fpage>‐<lpage>1820</lpage>.<pub-id pub-id-type="pmid">20878764</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0005">
      <label>5</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0005"><string-name><surname>Bolster</surname><given-names>BD</given-names></string-name>, <string-name><surname>Atalar</surname><given-names>E</given-names></string-name>. <article-title>Minimizing dead‐periods in flow‐encoded or ‐compensated pulse sequences while imaging in oblique planes</article-title>. <source xml:lang="en">J Magn Reson Imaging</source>. <year>1999</year>;<volume>10</volume>:<fpage>183</fpage>‐<lpage>192</lpage>.<pub-id pub-id-type="pmid">10441023</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0006">
      <label>6</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0006"><string-name><surname>Middione</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wu</surname><given-names>HH</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>Convex gradient optimization for increased spatiotemporal resolution and improved accuracy in phase contrast MRI</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2014</year>;<volume>72</volume>:<fpage>1552</fpage>‐<lpage>1564</lpage>.<pub-id pub-id-type="pmid">24347040</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0007">
      <label>7</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0007"><string-name><surname>Loecher</surname><given-names>M</given-names></string-name>, <string-name><surname>Magrath</surname><given-names>P</given-names></string-name>, <string-name><surname>Aliotta</surname><given-names>E</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>Time‐optimized 4D phase contrast MRI with real‐time convex optimization of gradient waveforms and fast excitation methods</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2019</year>;<volume>82</volume>:<fpage>213</fpage>‐<lpage>224</lpage>.<pub-id pub-id-type="pmid">30859606</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0008">
      <label>8</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0008"><string-name><surname>Sjölund</surname><given-names>J</given-names></string-name>, <string-name><surname>Szczepankiewicz</surname><given-names>F</given-names></string-name>, <string-name><surname>Nilsson</surname><given-names>M</given-names></string-name>, <string-name><surname>Topgaard</surname><given-names>D</given-names></string-name>, <string-name><surname>Westin</surname><given-names>C‐F</given-names></string-name>, <string-name><surname>Knutsson</surname><given-names>H</given-names></string-name>. <article-title>Constrained optimization of gradient waveforms for generalized diffusion encoding</article-title>. <source xml:lang="en">J Magn Reson</source>. <year>2015</year>;<volume>261</volume>:<fpage>157</fpage>‐<lpage>168</lpage>.<pub-id pub-id-type="pmid">26583528</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0009">
      <label>9</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0009"><string-name><surname>Aliotta</surname><given-names>E</given-names></string-name>, <string-name><surname>Wu</surname><given-names>HH</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>Convex optimized diffusion encoding (CODE) gradient waveforms for minimum echo time and bulk motion‐compensated diffusion‐weighted MRI</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2017</year>;<volume>77</volume>:<fpage>717</fpage>‐<lpage>729</lpage>.<pub-id pub-id-type="pmid">26900872</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0010">
      <label>10</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0010"><string-name><surname>Aliotta</surname><given-names>E</given-names></string-name>, <string-name><surname>Moulin</surname><given-names>K</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>Eddy current‐nulled convex optimized diffusion encoding (EN‐CODE) for distortion‐free diffusion tensor imaging with short echo times</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2018</year>;<volume>79</volume>:<fpage>663</fpage>‐<lpage>672</lpage>.<pub-id pub-id-type="pmid">28444802</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0011">
      <label>11</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0011"><string-name><surname>Shrestha</surname><given-names>M</given-names></string-name>, <string-name><surname>Hok</surname><given-names>P</given-names></string-name>, <string-name><surname>Nöth</surname><given-names>U</given-names></string-name>, <string-name><surname>Lienerth</surname><given-names>B</given-names></string-name>, <string-name><surname>Deichmann</surname><given-names>R</given-names></string-name>. <article-title>Optimization of diffusion‐weighted single‐refocused spin‐echo EPI by reducing eddy‐current artifacts and shortening the echo time</article-title>. <source xml:lang="en">Magn Reson Mater Phys Biol Med</source>. <year>2018</year>;<volume>31</volume>:<fpage>585</fpage>‐<lpage>597</lpage>. <pub-id pub-id-type="doi">10.1007/s10334-018-0684-x</pub-id>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0012">
      <label>12</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0012"><string-name><surname>Yang</surname><given-names>G</given-names></string-name>, <string-name><surname>McNab</surname><given-names>JA</given-names></string-name>. <article-title>Eddy current nulled constrained optimization of isotropic diffusion encoding gradient waveforms</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2019</year>;<volume>81</volume>:<fpage>1818</fpage>‐<lpage>1832</lpage>. <pub-id pub-id-type="doi">10.1002/mrm.27539</pub-id>.<pub-id pub-id-type="pmid">30368913</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0013">
      <label>13</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0013"><string-name><surname>Peña‐Nogales</surname><given-names>Ó</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>X</given-names></string-name>, et al. <article-title>Optimized Diffusion‐Weighting Gradient Waveform Design (ODGD) formulation for motion compensation and concomitant gradient nulling</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2019</year>;<volume>81</volume>:<fpage>989</fpage>‐<lpage>1003</lpage>. <pub-id pub-id-type="doi">10.1002/mrm.27462</pub-id>.<pub-id pub-id-type="pmid">30394568</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0014">
      <label>14</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0014"><string-name><surname>Szczepankiewicz</surname><given-names>F</given-names></string-name>, <string-name><surname>Westin</surname><given-names>C‐F</given-names></string-name>, <string-name><surname>Nilsson</surname><given-names>M</given-names></string-name>. <article-title>Maxwell‐compensated waveform design for asymmetric diffusion encoding</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2019</year>;<volume>82</volume>:<fpage>1424</fpage>‐<lpage>1437</lpage>.<pub-id pub-id-type="pmid">31148245</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0015">
      <label>15</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0015"><string-name><surname>Schulte</surname><given-names>RF</given-names></string-name>, <string-name><surname>Noeske</surname><given-names>R</given-names></string-name>. <article-title>Peripheral nerve stimulation‐optimal gradient waveform design</article-title>. <source xml:lang="en">Magn Reson Med</source>. <year>2015</year>;<volume>74</volume>:<fpage>518</fpage>‐<lpage>522</lpage>.<pub-id pub-id-type="pmid">25168778</pub-id></mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0016">
      <label>16</label>
      <mixed-citation publication-type="book" id="mrm28384-cit-0016"><string-name><surname>Hebrank</surname><given-names>FX</given-names></string-name>, <string-name><surname>Gebhardt</surname><given-names>M</given-names></string-name>. <chapter-title>SAFE‐model—a new method for predicting peripheral nerve stimulations in MRI</chapter-title> In Proceedings of the 8th Annual Meeting of ISMRM, <publisher-loc>Denver, CO</publisher-loc>, <year>2000</year>. Abstract 2007.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0017">
      <label>17</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0017"><string-name><surname>Boyd</surname><given-names>S</given-names></string-name>. <article-title>Distributed optimization and statistical learning via the alternating direction method of multipliers</article-title>. <source xml:lang="en">Found Trends Mach Learn</source>. <year>2010</year>;<volume>3</volume>:<fpage>1</fpage>‐<lpage>122</lpage>. <pub-id pub-id-type="doi">10.1561/2200000016</pub-id>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0018">
      <label>18</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0018"><string-name><surname>Moolekamp</surname><given-names>F</given-names></string-name>, <string-name><surname>Melchior</surname><given-names>P</given-names></string-name>. <article-title>Block‐simultaneous direction method of multipliers: a proximal primal‐dual splitting algorithm for nonconvex problems with multiple constraints</article-title>. <source xml:lang="en">Optim Eng</source>. <year>2018</year>;<volume>19</volume>:<fpage>871</fpage>‐<lpage>885</lpage>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0019">
      <label>19</label>
      <mixed-citation publication-type="book" id="mrm28384-cit-0019"><string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Figueiredo</surname><given-names>MAT</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>X</given-names></string-name>, <string-name><surname>Studer</surname><given-names>C</given-names></string-name>, <string-name><surname>Goldstein</surname><given-names>T</given-names></string-name>. <article-title>Adaptive relaxed ADMM: convergence theory and practical implementation</article-title>. In 2017 IEEE Conference on Computer Vision and Pattern Recognition (CVPR), <publisher-loc>Honolulu, HI</publisher-loc>, <year>2017</year>:<fpage>7234</fpage>‐<lpage>7243</lpage>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0020">
      <label>20</label>
      <mixed-citation publication-type="miscellaneous" id="mrm28384-cit-0020"><string-name><surname>Peters</surname><given-names>B</given-names></string-name>, <string-name><surname>Herrmann</surname><given-names>FJ</given-names></string-name>. <article-title>Algorithms and software for projections onto intersections of convex and non‐convex sets with applications to inverse problems</article-title>. arXiv:190209699. <year>2019</year><ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1902.09699">http://arxiv.org/abs/1902.09699</ext-link>. Accessed March 7, 2019.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0021">
      <label>21</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0021"><string-name><surname>Chambolle</surname><given-names>A</given-names></string-name>, <string-name><surname>Pock</surname><given-names>T</given-names></string-name>. <article-title>A first‐order primal‐dual algorithm for convex problems with applications to imaging</article-title>. <source xml:lang="en">J Math Imaging Vision</source>. <year>2011</year>;<volume>40</volume>:<fpage>120</fpage>‐<lpage>145</lpage>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0022">
      <label>22</label>
      <mixed-citation publication-type="miscellaneous" id="mrm28384-cit-0022"><string-name><surname>Middione</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Loecher</surname><given-names>M</given-names></string-name>, <string-name><surname>Moulin</surname><given-names>K</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>Impact of residual gradient moments on diffusion weighted imaging</article-title>. In Proceedings of the 27th Annual Meeting of ISMRM, Montreal, QC, Canada; Abstract 5483, <year>2019</year>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0023">
      <label>23</label>
      <mixed-citation publication-type="book" id="mrm28384-cit-0023"><string-name><surname>Skare</surname><given-names>S</given-names></string-name>, <string-name><surname>Avventi</surname><given-names>E</given-names></string-name>, <string-name><surname>Norbeck</surname><given-names>O</given-names></string-name>, <string-name><surname>Ryden</surname><given-names>H</given-names></string-name>. <article-title>An abstraction layer for simpler epic pulse programming on ge MR systems in a clinical environment</article-title>. In Proceedings of the 25th Annual Meeting of ISMRM, <publisher-loc>Honolulu, Hawaii</publisher-loc>, <year>2017</year>. Abstract 3813.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0024">
      <label>24</label>
      <mixed-citation publication-type="book" id="mrm28384-cit-0024"><string-name><surname>Loecher</surname><given-names>M</given-names></string-name>, <string-name><surname>Middione</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Moulin</surname><given-names>K</given-names></string-name>, <string-name><surname>Ennis</surname><given-names>DB</given-names></string-name>. <article-title>A real‐time solver for convex optimization of diffusion encoding gradient waveforms</article-title>. In ISMRM 8th Scientific Meeting &amp; Exhibition in Denver, <publisher-loc>Colorado</publisher-loc>, <year>2019</year>. Abstract 3495.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0025">
      <label>25</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0025"><string-name><surname>Wang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Yin</surname><given-names>W</given-names></string-name>, <string-name><surname>Zeng</surname><given-names>J</given-names></string-name>. <article-title>Global convergence of ADMM in nonconvex nonsmooth optimization</article-title>. <source xml:lang="en">J Sci Comput</source>. <year>2019</year>;<volume>78</volume>:<fpage>29</fpage>‐<lpage>63</lpage>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0026">
      <label>26</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0026"><string-name><surname>Li</surname><given-names>G</given-names></string-name>, <string-name><surname>Pong</surname><given-names>TK</given-names></string-name>. <article-title>Global convergence of splitting methods for nonconvex composite optimization</article-title>. <source xml:lang="en">SIAM J Optim</source>. <year>2015</year>;<volume>25</volume>:<fpage>2434</fpage>‐<lpage>2460</lpage>.</mixed-citation>
    </ref>
    <ref id="mrm28384-bib-0027">
      <label>27</label>
      <mixed-citation publication-type="journal" id="mrm28384-cit-0027"><string-name><surname>Hong</surname><given-names>M</given-names></string-name>, <string-name><surname>Luo</surname><given-names>ZQ</given-names></string-name>, <string-name><surname>Razaviyayn</surname><given-names>M</given-names></string-name>. <article-title>Convergence analysis of alternating direction method of multipliers for a family of nonconvex problems</article-title>. <source xml:lang="en">SIAM J Optim</source>. <year>2016</year>;<volume>26</volume>:<fpage>337</fpage>‐<lpage>364</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
