<?DTDIdentifier.IdentifierValue article.dtd?>
<?DTDIdentifier.IdentifierType system?>
<?SourceDTD.DTDName article.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName bmc2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3224597</article-id>
    <article-id pub-id-type="publisher-id">1471-2105-11-496</article-id>
    <article-id pub-id-type="pmid">20925910</article-id>
    <article-id pub-id-type="doi">10.1186/1471-2105-11-496</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MetAssimulo:Simulation of Realistic NMR Metabolic Profiles</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="A1">
        <name>
          <surname>Muncey</surname>
          <given-names>Harriet J</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>h.muncey09@imperial.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" id="A2">
        <name>
          <surname>Jones</surname>
          <given-names>Rebecca</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>rebecca.jones03@googlemail.com</email>
      </contrib>
      <contrib contrib-type="author" id="A3">
        <name>
          <surname>De Iorio</surname>
          <given-names>Maria</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>m.deiorio@imperial.ac.uk</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes" id="A4">
        <name>
          <surname>Ebbels</surname>
          <given-names>Timothy MD</given-names>
        </name>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>t.ebbels@imperial.ac.uk</email>
      </contrib>
    </contrib-group>
    <aff id="I1"><label>1</label>Department of Epidemiology and Biostatistics, School of Public Health, Imperial College London, UK</aff>
    <aff id="I2"><label>2</label>Biomolecular Medicine, Department of Surgery and Cancer, Imperial College London, UK</aff>
    <pub-date pub-type="collection">
      <year>2010</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>10</month>
      <year>2010</year>
    </pub-date>
    <volume>11</volume>
    <fpage>496</fpage>
    <lpage>496</lpage>
    <history>
      <date date-type="received">
        <day>9</day>
        <month>6</month>
        <year>2010</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>10</month>
        <year>2010</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright ©2010 Muncey et al; licensee BioMed Central Ltd.</copyright-statement>
      <copyright-year>2010</copyright-year>
      <copyright-holder>Muncey et al; licensee BioMed Central Ltd.</copyright-holder>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="http://www.biomedcentral.com/1471-2105/11/496"/>
    <abstract>
      <sec>
        <title>Background</title>
        <p>Probing the complex fusion of genetic and environmental interactions, metabolic profiling (or metabolomics/metabonomics), the study of small molecules involved in metabolic reactions, is a rapidly expanding 'omics' field. A major technique for capturing metabolite data is <sup>1</sup>H-NMR spectroscopy and this yields highly complex profiles that require sophisticated statistical analysis methods. However, experimental data is difficult to control and expensive to obtain. Thus data simulation is a productive route to aid algorithm development.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>MetAssimulo is a MATLAB-based package that has been developed to simulate <sup>1</sup>H-NMR spectra of complex mixtures such as metabolic profiles. Drawing data from a metabolite standard spectral database in conjunction with concentration information input by the user or constructed automatically from the Human Metabolome Database, MetAssimulo is able to create realistic metabolic profiles containing large numbers of metabolites with a range of user-defined properties. Current features include the simulation of two groups ('case' and 'control') specified by means and standard deviations of concentrations for each metabolite. The software enables addition of spectral noise with a realistic autocorrelation structure at user controllable levels. A crucial feature of the algorithm is its ability to simulate both intra- and inter-metabolite correlations, the analysis of which is fundamental to many techniques in the field. Further, MetAssimulo is able to simulate shifts in NMR peak positions that result from matrix effects such as pH differences which are often observed in metabolic NMR spectra and pose serious challenges for statistical algorithms.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p>No other software is currently able to simulate NMR metabolic profiles with such complexity and flexibility. This paper describes the algorithm behind MetAssimulo and demonstrates how it can be used to simulate realistic NMR metabolic profiles with which to develop and test new data analysis techniques. MetAssimulo is freely available for academic use at <ext-link ext-link-type="uri" xlink:href="http://cisbic.bioinformatics.ic.ac.uk/metassimulo/">http://cisbic.bioinformatics.ic.ac.uk/metassimulo/</ext-link>.</p>
      </sec>
    </abstract>
  </article-meta>
</front>
<body>
  <sec>
    <title>Background</title>
    <p>In the postgenomic era there has been a massive growth in 'omics' techniques investigating different levels of biological organisation. Metabolic profiling (or metabonomics/metabolomics) is a key area of systems biology research focussing on high-throughput identification and quantification of metabolites, small molecules (≤ 1500 Da) involved in metabolism [<xref ref-type="bibr" rid="B1">1</xref>]. When trying to relate genes to the overall function of a system, the metabolome (the complete set of metabolites) more closely reflects the activities of the organism at a functional level than, for example, the transcriptome [<xref ref-type="bibr" rid="B2">2</xref>]. Metabolic fluxes are not only regulated by gene expression, but also by additional factors, which include the abundance of metabolites as substrates and products [<xref ref-type="bibr" rid="B3">3</xref>]. Therefore metabolic profiling adds another dimension to our understanding of biological systems.</p>
    <p>A commonly used form of analysis in metabolic profiling is <sup>1</sup>H Nuclear Magnetic Resonance (NMR) spectroscopy of biofluids. Metabolites in biofluids are in dynamic equilibrium with those in cells and tissues so their metabolic profile reflects changes in the state of an organism due to disease or environmental effects. <sup>1</sup>H-NMR spectroscopy gives a global metabolic profile as it has the potential to detect nearly all proton-containing metabolites. Despite relatively poor sensitivity in comparison with analytical methods such as mass spectrometry, NMR spectroscopy requires minimal sample preparation and is able to measure concentrations as low as 100 <italic>μ</italic>M [<xref ref-type="bibr" rid="B4">4</xref>] and even lower with recent techniques such as cryoprobe technology. NMR allows metabolites to be detected simultaneously without preselection. The NMR spectrum for each metabolite is comprised of a characteristic pattern of peaks or resonances, derived from three main factors:</p>
    <p>1. The chemical shift (<italic>δ</italic>) of each resonance is dependent upon the local magnetic field experienced by each nucleus. This local field is dependent on the degree to which molecular orbitals shield the influence of the external spectrometer field. Thus the chemical shift can reflect the chemical structure of the metabolite. The position of each peak is measured relative to that of an internal standard in a scale of parts per million (ppm) [<xref ref-type="bibr" rid="B5">5</xref>]. A commonly used internal standard is 3-(Trimethylsilyl)-Propionic acid-D4, sodium salt (TSP).</p>
    <p>2. Spin-spin coupling causes NMR resonances to split into multiplet patterns due to magnetic interactions between nearby nuclei.</p>
    <p>3.Integrated peak area is proportional to the number of observed <sup>1</sup>H nuclei (assuming there are no differential relaxation effects) and allows quantification of the metabolite concentrations.</p>
    <p>The NMR spectrum of a complex mixture can be well approximmated by a linear combination of the spectra of pure compounds, potentially thousands of metabolites. Biofluid spectra can be treated as <italic>K </italic>dimensional objects, in which each dimension represents the concentration of a single metabolite [<xref ref-type="bibr" rid="B6">6</xref>]. This super-posed structure is exploited in our simulation method, detailed in the 'Implementation' section.</p>
    <p>Metabolic NMR spectra are highly complex and the field benefits greatly from the application of machine learning and statistical tools to extract information. Pattern recognition analyses such as Principal Components Analysis (PCA) have long been combined with NMR to investigate normal and pathological metabolic states [<xref ref-type="bibr" rid="B7">7</xref>]. Data processing methods are being developed to extract metabolite information and concentrations from raw spectra, allowing automation of spectral processing. Development of advanced mathematical, statistical and computational methods are also essential for characterisation of the metabolic state, delineation of metabolic changes over time and the efficient identification of potential biomarkers. There are a wide variety of diseases where key changes in metabolites have been deduced e.g. cancer, diabetes, hypertension etc. [<xref ref-type="bibr" rid="B8">8</xref>-<xref ref-type="bibr" rid="B10">10</xref>]. However, as algorithms and methods are developed, they need to be refined and validated to ensure results will be biologically meaningful. It is hard to effect this without using test datasets where the true answers are known; this can be accomplished using simulation techniques. An alternative approach is to design artificial mixtures of metabolites which are prepared and analysed in identical fashion to real samples. However this is expensive in terms of man power and instrument time, and offers few advantages over in silico simulation when assessment of analytical procedures is not required. The purpose of MetAssimulo is to simulate datasets of realistic NMR spectra with <italic>known </italic>parameters in order to test data analysis techniques, hypotheses and experimental designs. Few methods for generating simulated NMR datasets have appeared in the literature to date [<xref ref-type="bibr" rid="B11">11</xref>,<xref ref-type="bibr" rid="B12">12</xref>]. Most model a limited number of metabolites, make no attempt to reproduce realistic levels of metabolites, and do not allow for between-metabolite or 'inter-metabolite' correlations ([<xref ref-type="bibr" rid="B12">12</xref>] excepted) and do not always model peak positional shifts. It is common to fit Lorentzian peak shapes in an attempt to characterize spectral peaks, e.g [<xref ref-type="bibr" rid="B11">11</xref>]. However, this ignores the fact that peak shapes in real NMR profiles are variable and can be far from ideal. Here we outline a novel approach making use of individual standard metabolite data extracted from the Human Metabolome Database (HMDB) [<xref ref-type="bibr" rid="B13">13</xref>] and a local NMR standard spectra database (NSSD). Many metabolic profiling labs host their own NSSD appropriate to the biological systems and sample types they work with and thus the simulations can be tailored to virtually any sample type or organism as required. In this work human urine is used as the example biofluid as it is one of the most widely used in the field and, in healthy subjects, has no protein or lipid content, both of which make the simulation more complex. MetAssimulo is written in MATLAB with a graphical interface allowing the user to alter processing parameters and add new standard spectra as needed. The software is freely available along with an example NSSD of 48 metabolites commonly found in normal human urine. We stress that this list of metabolites and their concentration means and standard deviations does not constitute a <italic>definitive </italic>description of human urine; such a goal is beyond the scope of this paper. It is provided for the sole purpose of demonstrating the capabilities of the software.</p>
  </sec>
  <sec>
    <title>Implementation</title>
    <p>MetAssimulo performs various functions accessed though the Graphical User Interface (GUI): pre-processing the pure spectra, simulating metabolite concentrations, incorporating peak shifts and creating the final mixture spectrum (Fig. <xref ref-type="fig" rid="F1">1</xref>). By default it produces two groups of spectra based on different metabolite mixtures; these could represent controls (normal) and cases (diseased) subjects.</p>
    <fig id="F1" position="float">
      <label>Figure 1</label>
      <caption>
        <p><bold>MetAssimulo Structure</bold>.</p>
      </caption>
      <graphic xlink:href="1471-2105-11-496-1"/>
    </fig>
    <p>Each metabolite has a characteristic pattern of peaks on a linear scale, the chemical shift, given by <italic>δ </italic>in ppm. The signal intensity, <italic>y</italic>(<italic>δ</italic>), in a spectrum of metabolites <italic>k </italic>(<italic>k </italic>= 1, .., <italic>K </italic>where <italic>K </italic>is the total number of metabolites in the mixture) at a given <italic>δ </italic>increases proportionally to the concentration of each metabolite, <italic>c<sub>k</sub></italic>, present in the sample and their number of observed protons, <italic>p<sub>k</sub></italic>. The different metabolite spectra are summed together to produce the overall mixture spectrum. Normally distributed additive noise <inline-formula><mml:math id="M1" name="1471-2105-11-496-i1" overflow="scroll"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (see 'Calculate noise standard deviation' section for estimate of <inline-formula><mml:math id="M2" name="1471-2105-11-496-i2" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>) is then added to the mixture spectrum (see Eqn.1), <italic>y</italic>(<italic>δ</italic>), which is then smoothed to simulate the conventional preprocessing technique of exponential apodization prior to Fourier Transform [<xref ref-type="bibr" rid="B14">14</xref>].</p>
    <p>
      <disp-formula id="bmcM1">
        <label>(1)</label>
        <mml:math id="M3" name="1471-2105-11-496-i3" overflow="scroll">
          <mml:mrow>
            <mml:mi>y</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mi>δ</mml:mi>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:msubsup>
              <mml:mo>∑</mml:mo>
              <mml:mrow>
                <mml:mi>k</mml:mi>
                <mml:mo>=</mml:mo>
                <mml:mn>1</mml:mn>
              </mml:mrow>
              <mml:mi>K</mml:mi>
            </mml:msubsup>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:msub>
                  <mml:mi>y</mml:mi>
                  <mml:mi>k</mml:mi>
                </mml:msub>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mi>δ</mml:mi>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:msub>
                  <mml:mi>c</mml:mi>
                  <mml:mi>k</mml:mi>
                </mml:msub>
                <mml:msub>
                  <mml:mi>p</mml:mi>
                  <mml:mi>k</mml:mi>
                </mml:msub>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>+</mml:mo>
            <mml:mi>ϵ</mml:mi>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mi>δ</mml:mi>
              <mml:mo>)</mml:mo>
            </mml:mrow>
          </mml:mrow>
        </mml:math>
      </disp-formula>
    </p>
    <p>Each individual metabolite spectrum is sampled at a series of <italic>n </italic>uniformly spaced data points. The overall spectrum is made up of pairs of data points, (<italic>x</italic>, <italic>y</italic>) = (<italic>x<sub>i</sub></italic>,<italic>y<sub>i</sub></italic>)<sub><italic>i </italic>= 1,..., <italic>n</italic></sub>, where <italic>y<sub>i </sub></italic>= <italic>y</italic>(<italic>x<sub>i</sub></italic>); <italic>n </italic>is set by the user, and <italic>x<sub>i </sub></italic>defines a point on the ppm grid.</p>
    <p>In real NMR spectra, the signal intensity is affected by the extent to which the observed nuclei are allowed to relax before each observation. In MetAssimulo we do not currently attempt to simulate the effects of differential inter-molecular relaxation. However, intra-molecular relaxation effects are accounted for by the fact that experimentally obtained pure compound spectra are used to form the mixture spectra.</p>
    <sec>
      <title>Setting Parameters</title>
      <p>Parameters can be altered either in the MetAssimulo GUI or within the parameter file 'parameters.txt'. Default values for parameters are given in the Supplementary Material. The interface provides the user with several different processing options. For example the second group ('cases') may be specified as fold change ratios of the concentrations of the first group and the user can specify whether to produce output with or without peak shifts or both. The user also chooses whether to include inter-metabolite correlation (pairwise correlations between metabolites) or not; either as a textfile whose entries can be altered using the interface or constructed from scratch in the Correlation GUI.</p>
      <sec>
        <title>Input Files</title>
        <p>The Human Metabolome Database (HMDB) [<xref ref-type="bibr" rid="B13">13</xref>] contains information about more than 2180 metabolites found in humans and includes literature data relating to normal and abnormal concentrations in biofluids. Metabocards is the flat file download of the entire database, available at <ext-link ext-link-type="uri" xlink:href="http://www.hmdb.ca">http://www.hmdb.ca</ext-link>. Also required is the HMDB set of NMR Peak Lists (containing locations of individual peaks for metabolites) which is available in a downloadable zip-file. In constructing the template of normal human urine concentrations various problems of incompleteness and/or ambiguity were encountered. For example, in many HMDB entries the metabolite concentration mean and standard deviation is unavailable, or simply a range is given. In these cases the standard deviation was estimated by dividing the mean (or 'half-range') by 1.95. There are instances where a metabolite is identified as present in urine, but a normal concentration value is not available. We have attempted to rectify as many of these discrepancies as possible in the provided concentration file by cross-checking with other sources, i.e. literature articles, but do not claim the result represents a complete description of human urine; it does, however serve to demonstrate the software.</p>
        <p>The quality of MetAssimulo simulations is also dependent on the quality and coverage of the NSSD used, as well as the peak shift settings affecting multiplet detection. By distributing an NSSD it is not our intention to provide a comprehensive NMR standard database but merely an initial set of common metabolite spectra with which users can begin to make their own simulations. Many users will wish to add their own locally acquired standard spectra for metabolites specific to their areas of interest and we have provided functionality to do this.</p>
        <p>There are a number of input files that are required for MetAssimulo.</p>
        <p><bold>Concentration files* </bold>are needed for both groups of metabolites, these detail the mean and standard deviation of the concentration for each metabolite.</p>
        <p><bold>An NMR Standard Spectral Database (NSSD) </bold>comprising standard 1D <sup>1</sup>H-NMR spectra for metabolites is essential. MetAssimulo is designed to work with any metabolite database set out in the Bruker file format. Standard spectra of 48 of the most abundant metabolites in normal human urine is distributed with MetAssimulo.</p>
        <p><bold>Experiment file </bold>identifying the experiments to use in the metabolite database, as one metabolite may have many spectra, taken at different pH for example.</p>
        <p><bold>Proton file </bold>listing the number of protons, <italic>p<sub>k </sub></italic>observed for each metabolite, <italic>k</italic>.</p>
        <p><bold>Multiplet data files* </bold>specifying the position of each peak in a multiplet for each metabolite in order to incorporate simulated peak shifts. Known pKa values and acid/base limits can also be included.</p>
        <p><bold>Inter-metabolite correlations </bold>can be input via a text file or the GUI.</p>
        <p><bold>Synonym files</bold>* that allow MetAssimulo to match metabolites in the HMDB data to those in the NSSD.</p>
        <p><bold>Parameter file </bold>containing the default values or simulation parameters (alterable in the GUI).</p>
        <p>*Can be generated automatically using 'Format HMDB Data' within MetAssimulo.</p>
        <p>Examples of all input files in the appropriate format are included with the MetAssimulo distribution. Much of the required input data can be generated using the in-built function 'Format HMDB Data' (accessed via the GUI) which should be run as an initial 'setup'. It produces the files necessary for conversion between the local database and HMDB synonyms, data required for peak shift simulation and a raw template of concentration data for 'normal' urine. The normal urine concentration file provided with the distribution has been optimized to provide realistic values and correct a number of errors found in the current version of the HMDB whilst reducing the number of metabolites used in order to decrease processing time.</p>
      </sec>
    </sec>
    <sec>
      <title>Pre-processing</title>
      <p>Initially, a set of metabolite concentrations is simulated for the case and control groups, based on the mean and standard deviations in the concentration file. Next, the required spectra from the NSSD must be loaded. Even <sup>1</sup>H-NMR spectra of standard pure compounds contain a number of complexities, such as chemical and electronic noise, phase and baseline errors, contaminants and water suppression residuals. Thus it is ususally necessary to preprocess these spectra into a form suitable for combining into the final metabolic profiles.</p>
      <sec>
        <title>Simulating Concentrations</title>
        <p>Concentrations, <italic>c<sub>k</sub></italic>, for each metabolite, <italic>k </italic>= 1, .., <italic>K</italic>, are simulated for the number of replicates specified by the user. Individual metabolite concentrations are generated from a truncated normal distribution, Eqn.2, using the inverse cdf method since negative concentrations are unphysical [<xref ref-type="bibr" rid="B15">15</xref>]. Here <italic>μ </italic>is the mean concentration and <italic>σ </italic>is the standard deviation input by the user.</p>
        <p>
          <disp-formula id="bmcM2">
            <label>(2)</label>
            <mml:math id="M4" name="1471-2105-11-496-i4" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>c</mml:mi>
                  <mml:mi>k</mml:mi>
                </mml:msub>
                <mml:mo>∼</mml:mo>
                <mml:mi>N</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>μ</mml:mi>
                    <mml:mo>,</mml:mo>
                    <mml:msup>
                      <mml:mi>σ</mml:mi>
                      <mml:mn>2</mml:mn>
                    </mml:msup>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mi>I</mml:mi>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>c</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                    <mml:mo> &gt;</mml:mo>
                    <mml:mn>0</mml:mn>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>Significant inter-metabolite correlations, here assumed to be linear pairwise correlations between metabolites, are often found within the field of metabolic profiling so were considered an important feature to incorporate into the simulation. Where inter-metabolite correlations are required, the concentrations are simulated by sampling from the appropriate multivariate normal distribution. Rejection sampling is utilised to ensure non-negative concentrations. Using the method detailed in [<xref ref-type="bibr" rid="B16">16</xref>] the nearest positive semidefinite correlation matrix is calculated given user-specified pairwise correlations. The covariance matrix is constructed using the metabolite standard deviations and specified correlations, and the diagonal entries are increased sufficiently to ensure positive-definiteness. Any necessary alterations to the correlation and covariance matrices are output for inspection.</p>
      </sec>
      <sec>
        <title>Read in spectrum</title>
        <p>After the concentrations have been simulated the standard spectra of the metabolites are read in. Each spectrum consists of chemical shift in ppm, <italic>x </italic>and intensity, <italic>y</italic>. Spectra are then linearly interpolated onto a ppm grid of user-specified resolution.</p>
      </sec>
      <sec>
        <title>Exclusion regions</title>
        <p>Exclusion regions, corresponding to the location of the internal standard peak (default &lt; 0.2 ppm [<xref ref-type="bibr" rid="B17">17</xref>]) and the residual water peak (default 4.5 ppm - 6.0 ppm [<xref ref-type="bibr" rid="B17">17</xref>]), are set to zero. In urine, the urea signal (between 5.4 ppm and 6.0 ppm [<xref ref-type="bibr" rid="B17">17</xref>]), the most abundant proton-containing metabolite [<xref ref-type="bibr" rid="B6">6</xref>], can be problematic particularly when water-suppression methods are used. Water-suppression is usually imperfect and the resulting residual peaks (near to the urea signal) are not dealt with easily by baseline correction algorithms [<xref ref-type="bibr" rid="B18">18</xref>]. Often, the urea and water peaks are combined into one exclusion region lying between 4.5 ppm and 6 ppm (default exclusion region, but can be adjusted by the user). Excluding these areas of the spectrum helps reduce sensitivity to artifacts.</p>
      </sec>
      <sec>
        <title>Baseline Correction</title>
        <p>It is easier to distinguish peaks in a spectrum when the baseline is featureless [<xref ref-type="bibr" rid="B14">14</xref>], however, spectra can have distorted baselines due to imperfections in the detection process [<xref ref-type="bibr" rid="B17">17</xref>]. Curved baselines can be a major source of error and so a correction is carried out on the raw spectrum using a moving average [<xref ref-type="bibr" rid="B19">19</xref>]. This method involves splitting the data into windows of size <italic>ω </italic>(default is 0.3125 ppm), defined by the user, then using the median within the window to estimate the baseline. In order to alter the baseline without losing metabolite peaks, a threshold is set by dividing the maximum height by a user specified parameter (default is 10). All the intensities found below this threshold are corrected by subtracting the estimated baseline.</p>
      </sec>
      <sec>
        <title>Removal of Negative Artifacts</title>
        <p>Negative artifacts, produced by baseline correction or simply inherent in the original spectrum must be removed since their presence could interfere with peaks of interest in the mixture spectrum. This is remedied by using an estimate of the noise standard deviation, <italic>σ<sub>med</sub></italic>, to calculate a limit value, <italic>l</italic>, using Eqn.3. <italic>σ<sub>med </sub></italic>is estimated by splitting the spectrum into a number of bins (given by the user, default 32) and calculating their standard deviations. The median of these standard deviations is used as the estimate of <italic>σ<sub>med</sub></italic>.</p>
        <p>
          <disp-formula id="bmcM3">
            <label>(3)</label>
            <mml:math id="M5" name="1471-2105-11-496-i5" overflow="scroll">
              <mml:mrow>
                <mml:mi>l</mml:mi>
                <mml:mo>=</mml:mo>
                <mml:mi>M</mml:mi>
                <mml:mo>−</mml:mo>
                <mml:mn>3</mml:mn>
                <mml:msub>
                  <mml:mi>σ</mml:mi>
                  <mml:mrow>
                    <mml:mi>m</mml:mi>
                    <mml:mi>e</mml:mi>
                    <mml:mi>d</mml:mi>
                  </mml:mrow>
                </mml:msub>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p><italic>M </italic>is the median of the intensities, <italic>y<sub>i</sub></italic>. All intensities appearing below this limit,<italic>l</italic>, are set equal to it.</p>
      </sec>
      <sec>
        <title>Kernel Smoothing</title>
        <p>Noise from each standard metabolite spectrum will remain in the final mixture spectrum, reducing the overall signal to noise ratio. Kernel smoothing is used to reduce the noise in each individual metabolite spectrum. This process estimates the smooth function underlying the noisy data using a weighted mean of surrounding data points with weights defined according to the choice of kernel. Whilst the default kernel type is 'Normal', the user may also choose from a number of options and also alter the bandwidth (given as number of data points), controlling the degree of smoothing required. Since smoothing the whole spectrum woiuld increase the peak widths, only intensities below a user-defined threshold (a percentage of the maximum intensity, default 0.8) are subject to kernel smoothing.</p>
      </sec>
      <sec>
        <title>Peak Shift</title>
        <p>If the user has chosen to simulate peak shifts (this is the default setting), these are then calculated for each multiplet in each metabolite spectrum. First, a peak detection process is used to identify peaks suitable for shifting. Peaks detected are cross-referenced with the HMDB multiplet data to determine those belonging to a multiplet that must be shifted together. Whether or not a peak is shifted depends on the user defined thresholds for peak detection, and also its size relative to the noise. In real samples, peak positional variation can derive from various matrix effects primarily pH differences but also due to variation in the concentration of other ionic species in the mixture. In MetAssimulo, we take account of pH variation only; this is sufficient to produce very realistic shift patterns and avoids the need for many extra parameters in the model. If pKa values and acid and base limits are not available, values are drawn from normal distributions with user-specified mean and standard deviation. If the user requires the same pH for all replicates of a mixture, the pH value is set as the user input. Otherwise, the pH values are sampled from a normal distribution with mean and standard deviation defined by the user. This information is then combined using the Henderson-Hasselbalch Equation [<xref ref-type="bibr" rid="B5">5</xref>] (Eqn.4) to calculate the peak shift (in ppm) and the peaks are shifted accordingly.</p>
        <p>
          <disp-formula id="bmcM4">
            <label>(4)</label>
            <mml:math id="M6" name="1471-2105-11-496-i6" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>η</mml:mi>
                  <mml:mrow>
                    <mml:mi>i</mml:mi>
                    <mml:mi>j</mml:mi>
                  </mml:mrow>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mfrac>
                  <mml:mrow>
                    <mml:msup>
                      <mml:mi>e</mml:mi>
                      <mml:mrow>
                        <mml:mi>p</mml:mi>
                        <mml:mi>H</mml:mi>
                        <mml:mo>−</mml:mo>
                        <mml:mi>p</mml:mi>
                        <mml:mi>K</mml:mi>
                        <mml:msub>
                          <mml:mi>a</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                    </mml:msup>
                    <mml:mo stretchy="false">(</mml:mo>
                    <mml:msub>
                      <mml:mi>a</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>−</mml:mo>
                    <mml:msub>
                      <mml:mi>δ</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo stretchy="false">)</mml:mo>
                    <mml:mo>−</mml:mo>
                    <mml:msub>
                      <mml:mi>δ</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>+</mml:mo>
                    <mml:msub>
                      <mml:mi>b</mml:mi>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:msup>
                      <mml:mi>e</mml:mi>
                      <mml:mrow>
                        <mml:mi>p</mml:mi>
                        <mml:mi>H</mml:mi>
                        <mml:mo>−</mml:mo>
                        <mml:mi>p</mml:mi>
                        <mml:mi>K</mml:mi>
                        <mml:msub>
                          <mml:mi>a</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                    </mml:msup>
                    <mml:mo>+</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                </mml:mfrac>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>where <italic>δ<sub>ij </sub></italic>is the un-shifted position of peak <italic>i </italic>of metabolite <italic>j </italic>in ppm (known),</p>
        <p><italic>η<sub>ij </sub></italic>is the amount the peak is shifted in ppm (generated by Eq.4),</p>
        <p><italic>pH </italic>is the pH of sample (simulated or input),</p>
        <p><italic>pKa<sub>j </sub></italic>is the pKa of metabolite <italic>j </italic>(simulated or input) assumed here to be the same for all peaks of a given metabolite,</p>
        <p><italic>a<sub>ij </sub></italic>is the position of peak <italic>i </italic>of metabolite <italic>j </italic>in the acid limit (ppm) (simulated or input),</p>
        <p><italic>b<sub>ij </sub></italic>is the position of peak <italic>i </italic>of metabolite <italic>j </italic>in the basic limit (ppm) (simulated or input).</p>
        <p>After this process, the spectrum is then smoothed again in order to suppress any unwanted artifacts created by the peak shift.</p>
      </sec>
    </sec>
    <sec>
      <title>Simulating Mixture Spectra</title>
      <p>To make sure that all the metabolite spectra are on a comparable scale the spectra are normalised to unit integrated intensity, using Eqn.5.</p>
      <p>
        <disp-formula id="bmcM5">
          <label>(5)</label>
          <mml:math id="M7" name="1471-2105-11-496-i7" overflow="scroll">
            <mml:mrow>
              <mml:msub>
                <mml:mi>y</mml:mi>
                <mml:mi>i</mml:mi>
              </mml:msub>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mover accent="true">
                      <mml:mi>y</mml:mi>
                      <mml:mo>˜</mml:mo>
                    </mml:mover>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:msub>
                    <mml:mover accent="true">
                      <mml:mi>y</mml:mi>
                      <mml:mo>˜</mml:mo>
                    </mml:mover>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                </mml:mrow>
              </mml:mfrac>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>where <inline-formula><mml:math id="M8" name="1471-2105-11-496-i8" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the intensity in the preprocessed, unnormalised standard spectrum.</p>
      <sec>
        <title>Calculate noise standard deviation</title>
        <p>The final mixture spectrum is constructed using Eqn.1. The standard deviation <italic>σ</italic><sub>n </sub>of noise to be added is calculated by dividing the maximum peak intensity by the signal to noise ratio required by the user, <italic>SNR</italic>, as in Eqn.6.</p>
        <p>
          <disp-formula id="bmcM6">
            <label>(6)</label>
            <mml:math id="M9" name="1471-2105-11-496-i9" overflow="scroll">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>σ</mml:mi>
                  <mml:mi>n</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mfrac>
                  <mml:mrow>
                    <mml:mi>m</mml:mi>
                    <mml:mi>a</mml:mi>
                    <mml:mi>x</mml:mi>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>y</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>δ</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi>S</mml:mi>
                    <mml:mi>N</mml:mi>
                    <mml:mi>R</mml:mi>
                  </mml:mrow>
                </mml:mfrac>
              </mml:mrow>
            </mml:math>
          </disp-formula>
        </p>
        <p>Even after preprocessing, the signal to noise levels of the individual metabolite spectra may vary, so therefore the final signal to noise ratio cannot be controlled perfectly. However, adding noise in this way allows the simulation of mixture spectra with a wide variety of signal to noise ratios. After adding the random noise, <italic>ε</italic>(<italic>δ</italic>) ~ <italic>N </italic>(0, <italic>σ<sub>n</sub></italic>), kernel smoothing is used on the composite spectrum to reproduce the effect of apodization on real spectra [<xref ref-type="bibr" rid="B14">14</xref>].</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>Results and Discussion</title>
    <p>In this section some example outputs from MetAssimulo will be shown. Simulations of normal urine were run using the optimized template with parameters set to the default values and using the NSSD consisting of 48 spectra recorded at 600 MHz <sup>1</sup>H observation frequency.</p>
    <sec>
      <title>Single Spectrum</title>
      <p>To test whether MetAssimulo's output spectra (Fig. <xref ref-type="fig" rid="F2">2(a)</xref>) seem realistic they are compared to a real normal human urine spectrum with the same exclusion regions (Fig. <xref ref-type="fig" rid="F2">2(b)</xref>). It should be noted that differences between real and simulated spectra will result not only from the simulation process, but also from incomplete knowledge of the exact molecular species giving rise to NMR signals and uncertainties in their levels. However, despite these difficulties, the simulated and real spectra show many similarities including the dominance of high abundance metabolites such as creatinine, glycine, and citric acid. The insets show how such realistic simulation extends to low intensity signals of the aromatic region such as hippurate, histidine, formate and N-methylnicotinic acid.</p>
      <fig id="F2" position="float">
        <label>Figure 2</label>
        <caption>
          <p><bold>(a) Real normal urine sample, (b) Mean simulated normal urine sample</bold>.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-2"/>
      </fig>
    </sec>
    <sec>
      <title>Simulation of Case &amp; Control Groups</title>
      <p>We now show how MetAssimulo can produce two groups of spectra with different metabolite compositions. We simulated spectra for both normal urine and a diseased state. Paraquat poisoning [<xref ref-type="bibr" rid="B20">20</xref>] was chosen as the diseased state, from several available in the HMDB, because it shows a diverse array of metabolic disregulation in comparison with normal urine. The concentrations of 4 metabolites are altered: citric acid and creatinine are decreased, whilst alanine and lactic acid are increased. Simulations were run for 50 replicates of normal and diseased without peak shifts, the mean of which are shown in Fig. <xref ref-type="fig" rid="F3">3</xref>. These spectra clearly show the expected decrease in citric acid and creatinine concentrations for Paraquat poisoning, whilst alanine and lactate concentrations are increased. The PCA scores plot in Fig. <xref ref-type="fig" rid="F4">4(a)</xref> clearly demonstrates separation in the first principal component. The largest loadings on PC1, Fig. <xref ref-type="fig" rid="F4">4(b)</xref>, correspond to the metabolites that were altered, accurately describing the difference between the two groups. The largest loading on PC2 corresponds to glycine, the metabolite with the highest with-group variance. This data could be used in disease diagnostics to help train machine learning methods in recognising disease status.</p>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>(a) Mean simulated normal urine spectrum, (b) Mean simulated spectrum of urine in paraquat poisoning</bold>.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-3"/>
      </fig>
      <fig id="F4" position="float">
        <label>Figure 4</label>
        <caption>
          <p><bold>(a) Scores plot of the first two principal components for the simulated data, (b) Loadings on PC1, (c) Loadings on PC2</bold>.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-4"/>
      </fig>
    </sec>
    <sec>
      <title>Peak Shifts</title>
      <p>We demonstrate the peak shift using histidine, a metabolite particularly prone to this kind of positional variation. Acid and base limits were estimated by inspecting spectra taken at varying pH values. Fig. <xref ref-type="fig" rid="F5">5</xref> clearly shows a shift in ppm values for this peak consistent with the non-linear mechanism described by the Henderson-Hasselbach Eqn.4.</p>
      <fig id="F5" position="float">
        <label>Figure 5</label>
        <caption>
          <p><bold>Simulated peak shift for the two aromatic singlets of histidine</bold>.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-5"/>
      </fig>
    </sec>
    <sec>
      <title>Inter-Metabolite Correlations</title>
      <p>To demonstrate the incorporation of inter-metabolite correlations, we specify the pairwise Pearson correlations of three metabolites: citrate, creatinine and 2-oxoglutarate. The following correlation matrix was used.</p>
      <p>
        <disp-formula>
          <mml:math id="M10" name="1471-2105-11-496-i10" overflow="scroll">
            <mml:mrow>
              <mml:mrow>
                <mml:mo>(</mml:mo>
                <mml:mrow>
                  <mml:mtable>
                    <mml:mtr>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mi>c</mml:mi>
                          <mml:mi>i</mml:mi>
                          <mml:mi>t</mml:mi>
                          <mml:mi>r</mml:mi>
                          <mml:mi>a</mml:mi>
                          <mml:mi>t</mml:mi>
                          <mml:mi>e</mml:mi>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mn>1</mml:mn>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow/>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow/>
                      </mml:mtd>
                    </mml:mtr>
                    <mml:mtr>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mi>c</mml:mi>
                          <mml:mi>r</mml:mi>
                          <mml:mi>e</mml:mi>
                          <mml:mi>a</mml:mi>
                          <mml:mi>t</mml:mi>
                          <mml:mi>i</mml:mi>
                          <mml:mi>n</mml:mi>
                          <mml:mi>i</mml:mi>
                          <mml:mi>n</mml:mi>
                          <mml:mi>e</mml:mi>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>0.7</mml:mn>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mn>1</mml:mn>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow/>
                      </mml:mtd>
                    </mml:mtr>
                    <mml:mtr>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                          <mml:mo>−</mml:mo>
                          <mml:mi>o</mml:mi>
                          <mml:mi>x</mml:mi>
                          <mml:mi>o</mml:mi>
                          <mml:mi>g</mml:mi>
                          <mml:mi>l</mml:mi>
                          <mml:mi>u</mml:mi>
                          <mml:mi>t</mml:mi>
                          <mml:mi>a</mml:mi>
                          <mml:mi>r</mml:mi>
                          <mml:mi>a</mml:mi>
                          <mml:mi>t</mml:mi>
                          <mml:mi>e</mml:mi>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mn>0.8</mml:mn>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>0.4</mml:mn>
                        </mml:mrow>
                      </mml:mtd>
                      <mml:mtd>
                        <mml:mn>1</mml:mn>
                      </mml:mtd>
                    </mml:mtr>
                  </mml:mtable>
                </mml:mrow>
                <mml:mo>)</mml:mo>
              </mml:mrow>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </p>
      <p>This resulted in a positive definite covariance matrix, so no adjustments were required. Fig. <xref ref-type="fig" rid="F6">6(i)</xref> visualizes the correlation matrix between all spectral intensities. Most correlations are close to zero as expected. The regions enlarged in (ii)-(v) illustrate the the correlations that were expected. The correlations can also be viewed in Fig. <xref ref-type="fig" rid="F7">7</xref> when the mean spectrum is coloured according to the correlation coefficient with respect to a specified chemical shift corresponding to a particular metabolite peak position ((a) citrate-2.65 ppm, (b) creatinine-4.08 ppm, (c) 2-oxoglutarate-2.44 ppm). Note that these analyses are similar to the commonly used STOCSY [<xref ref-type="bibr" rid="B21">21</xref>] technique which is used to analyse both inter- and intra-metabolite correlations; our simulations could be used to develop and test such methods.</p>
      <fig id="F6" position="float">
        <label>Figure 6</label>
        <caption>
          <p><bold>Inter and intra-metabolite correlations: (i) Complete correlation matrix and insets (ii)-(v) showing strong negative inter-metabolite correlation between citrate and creatinine and positive between 2-oxoglutarate and creatinine (ii), (iii) and strong positive intra-metabolite correlations for creatinine (iv) and citrate (v)</bold>. Colour scale indicates the level of Pearson correlation.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-6"/>
      </fig>
      <fig id="F7" position="float">
        <label>Figure 7</label>
        <caption>
          <p><bold>Pairwise correlation coefficients mapped as a colour code onto the mean spectrum</bold>. Correlations to (a) citrate 2.65 ppm, (b) creatinine 4.08 ppm, (c) 2-oxoglutarate 2.44 ppm.</p>
        </caption>
        <graphic xlink:href="1471-2105-11-496-7"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>Conclusions</title>
    <p>There are currently simulation programs in different areas of post-genomic science, such as SNP simulators that are being used in whole genome association studies [<xref ref-type="bibr" rid="B22">22</xref>,<xref ref-type="bibr" rid="B23">23</xref>]. MetAssimulo is a valuable addition to these tools, enabling the simulation of realistic <sup>1</sup>H NMR spectra of complex biological mixtures including group-wise variation, intermetabolite correlations and peak positional variation. However, there are areas which could be enhanced. Any simulator of this kind is limited by the sources of data available. The HMDB only contains information about metabolite concentrations in humans, therefore further user input or other metabolite databases may be needed to address other organisms. Human urine is the default setting for MetAssimulo, but given the numerous alterable parameters, it is easy to simulate profiles for other species and biofluids.</p>
  </sec>
  <sec>
    <title>Availability and requirements</title>
    <p>Project name: MetAssimulo</p>
    <p>Project home page: <ext-link ext-link-type="uri" xlink:href="http://cisbic.bioinformatics.ic.ac.uk/metassimulo/">http://cisbic.bioinformatics.ic.ac.uk/metassimulo/</ext-link></p>
    <p>Operating system(s): Platform independent</p>
    <p>Programming language: MATLAB</p>
    <p>Other requirements: MATLAB</p>
  </sec>
  <sec>
    <title>List of Abbreviations used</title>
    <p>GUI: Graphical User Interface; HMDB: Human Metabolome Database; NMR: Nuclear Magnetic Spectroscopy; NSSD: NMR Standard Spectra Database.</p>
  </sec>
  <sec>
    <title>Authors' contributions</title>
    <p>TE and MDI concieved the project and supervised the work and reviewed the manuscript. HM and RJ wrote and tested the code. HM wrote the manuscript. All authors reviewed and approved the maniscript.</p>
  </sec>
</body>
<back>
  <sec>
    <title>Acknowledgements</title>
    <p>HM and RJ acknowledge financial support from an MRC capacity building studentship. MDI and TE were partially supported by the Biotechnology and Biological Sciences Research Council (Grant Ref.BB/E20372/1).</p>
  </sec>
  <ref-list>
    <ref id="B1">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Nicholson</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Lindon</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Holmes</surname>
          <given-names>E</given-names>
        </name>
        <article-title>'Metabonomics': understanding the metabolic responses of living systems to pathophysiological stimuli via multivariate statistical analysis of biological NMR spectroscopic data</article-title>
        <source>Xenobiotica</source>
        <year>1999</year>
        <volume>29</volume>
        <issue>11</issue>
        <fpage>1181</fpage>
        <lpage>1189</lpage>
        <pub-id pub-id-type="doi">10.1080/004982599238047</pub-id>
        <pub-id pub-id-type="pmid">10598751</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Goodacre</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Vaidyanathan</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Dunn</surname>
          <given-names>W</given-names>
        </name>
        <name>
          <surname>Harrigan</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Kell</surname>
          <given-names>D</given-names>
        </name>
        <article-title>Metabolomics by numbers: acquiring and understanding global metabolite data</article-title>
        <source>Trends In Biotechnology</source>
        <year>2004</year>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>245</fpage>
        <lpage>252</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tibtech.2004.03.007</pub-id>
        <pub-id pub-id-type="pmid">15109811</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal">
        <name>
          <surname>ter Kuile</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Westerhoff</surname>
          <given-names>H</given-names>
        </name>
        <article-title>Transcriptome meets metabolome: hierarchical and metabolic regulation of the glycolytic pathway</article-title>
        <source>FEBS Letters</source>
        <year>2001</year>
        <volume>500</volume>
        <issue>3</issue>
        <fpage>169</fpage>
        <lpage>171</lpage>
        <pub-id pub-id-type="doi">10.1016/S0014-5793(01)02613-8</pub-id>
        <pub-id pub-id-type="pmid">11445079</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Robertson</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Reily</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Sigler</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Wells</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Paterson</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Braden</surname>
          <given-names>T</given-names>
        </name>
        <article-title>Metabonomics: Evaluation of nuclear magnetic resonance (NMR) and pattern recognition technology for rapid in vivo screening of liver and kidney toxicants</article-title>
        <source>Toxilogical Sciences</source>
        <year>2000</year>
        <volume>57</volume>
        <issue>2</issue>
        <fpage>326</fpage>
        <lpage>337</lpage>
        <pub-id pub-id-type="doi">10.1093/toxsci/57.2.326</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="book">
        <name>
          <surname>Hore</surname>
          <given-names>P</given-names>
        </name>
        <source>Nuclear Magnetic Resonance</source>
        <year>2004</year>
        <publisher-name>Oxford University Press Inc</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Lindon</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Nicholson</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Holmes</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Everett</surname>
          <given-names>J</given-names>
        </name>
        <article-title>Metabonomics: Metabolic processes studied by NMR spectroscopy of biofluids</article-title>
        <source>Concepts In Magnetic Resonance</source>
        <year>2000</year>
        <volume>12</volume>
        <issue>5</issue>
        <fpage>289</fpage>
        <lpage>320</lpage>
        <pub-id pub-id-type="doi">10.1002/1099-0534(2000)12:5&lt;289::AID-CMR3&gt;3.0.CO;2-W</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Anthony</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Gartland</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Beddel</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Lindon</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Nicholson</surname>
          <given-names>J</given-names>
        </name>
        <article-title>Cephaloridine-induced nephrotoxicity in the Fischer-344 Rat - Proton NMR Spectroscopic studies of urine and plasma in relation to conventional clinical chemical and histopathological assessments of nephronal damage</article-title>
        <source>Archives Of Toxicology</source>
        <year>1992</year>
        <volume>66</volume>
        <issue>8</issue>
        <fpage>525</fpage>
        <lpage>537</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01973382</pub-id>
        <pub-id pub-id-type="pmid">1463387</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="book">
        <name>
          <surname>Moolenaar</surname>
          <given-names>S</given-names>
        </name>
        <etal/>
        <source>Handbook of 1H-NMR Spectroscopy in Inborn Errors of Metabolism</source>
        <year>2002</year>
        <publisher-name>SPS Publications, Heilbronn</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Moolenaar</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Engelke</surname>
          <given-names>U</given-names>
        </name>
        <name>
          <surname>Wevers</surname>
          <given-names>R</given-names>
        </name>
        <article-title>Proton nuclear magnetic resonance spectroscopy of body fluids in the field of inborn errors of metabolism</article-title>
        <source>Annals Of Clinical Biochemistry</source>
        <year>2003</year>
        <volume>40</volume>
        <issue>Part 1</issue>
        <fpage>16</fpage>
        <lpage>24</lpage>
        <pub-id pub-id-type="doi">10.1258/000456303321016132</pub-id>
        <pub-id pub-id-type="pmid">12542907</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Holmes</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Loo</surname>
          <given-names>RL</given-names>
        </name>
        <name>
          <surname>Stamler</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Bictash</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Yap</surname>
          <given-names>IKS</given-names>
        </name>
        <name>
          <surname>Chan</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Ebbels</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>De Iorio</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Brown</surname>
          <given-names>IJ</given-names>
        </name>
        <name>
          <surname>Veselkov</surname>
          <given-names>KA</given-names>
        </name>
        <name>
          <surname>Daviglus</surname>
          <given-names>ML</given-names>
        </name>
        <name>
          <surname>Kesteloot</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Ueshima</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Zhao</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Nicholson</surname>
          <given-names>JK</given-names>
        </name>
        <name>
          <surname>Elliott</surname>
          <given-names>P</given-names>
        </name>
        <article-title>Human metabolic phenotype diversity and its association with diet and blood pressure</article-title>
        <source>Nature</source>
        <year>2008</year>
        <volume>453</volume>
        <issue>7193</issue>
        <fpage>396</fpage>
        <lpage>U50</lpage>
        <pub-id pub-id-type="doi">10.1038/nature06882</pub-id>
        <pub-id pub-id-type="pmid">18425110</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Cloarec</surname>
          <given-names>O</given-names>
        </name>
        <name>
          <surname>Dumas</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Trygg</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Craig</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Barton</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Lindon</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Nicholson</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Holmes</surname>
          <given-names>E</given-names>
        </name>
        <article-title>Evaluation of the orthogonal projection on latent structure model limitations caused by chemical shift variability and improved visualization of biomarker changes in H-1 NMR spectroscopic metabonomic studies</article-title>
        <source>Analytical Chemistry</source>
        <year>2005</year>
        <volume>77</volume>
        <issue>2</issue>
        <fpage>517</fpage>
        <lpage>526</lpage>
        <pub-id pub-id-type="doi">10.1021/ac048803i</pub-id>
        <pub-id pub-id-type="pmid">15649048</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Anderson</surname>
          <given-names>PE</given-names>
        </name>
        <name>
          <surname>Raymer</surname>
          <given-names>ML</given-names>
        </name>
        <name>
          <surname>Kelly</surname>
          <given-names>BJ</given-names>
        </name>
        <name>
          <surname>Reo</surname>
          <given-names>NV</given-names>
        </name>
        <name>
          <surname>DelRaso</surname>
          <given-names>NJ</given-names>
        </name>
        <name>
          <surname>Doom</surname>
          <given-names>TE</given-names>
        </name>
        <article-title>Characterization of H-1 NMR spectroscopic data and the generation of synthetic validation sets</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <issue>22</issue>
        <fpage>2992</fpage>
        <lpage>3000</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp540</pub-id>
        <pub-id pub-id-type="pmid">19759199</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Wishart</surname>
          <given-names>DS</given-names>
        </name>
        <name>
          <surname>Tzur</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Knox</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Eisner</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Guo</surname>
          <given-names>AC</given-names>
        </name>
        <name>
          <surname>Young</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Cheng</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Jewell</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Arndt</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Sawhney</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Fung</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Nikolai</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Lewis</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Coutouly</surname>
          <given-names>MA</given-names>
        </name>
        <name>
          <surname>Forsythe</surname>
          <given-names>I</given-names>
        </name>
        <name>
          <surname>Tang</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Shrivastava</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Jeroncic</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Stothard</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Amegbey</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Block</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Hau</surname>
          <given-names>DD</given-names>
        </name>
        <name>
          <surname>Wagner</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Miniaci</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Clements</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Gebremedhin</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Guo</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Duggan</surname>
          <given-names>GE</given-names>
        </name>
        <name>
          <surname>MacInnis</surname>
          <given-names>GD</given-names>
        </name>
        <name>
          <surname>Weljie</surname>
          <given-names>AM</given-names>
        </name>
        <name>
          <surname>Dowlatabadi</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Bamforth</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Clive</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Greiner</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Marrie</surname>
          <given-names>T</given-names>
        </name>
        <name>
          <surname>Sykes</surname>
          <given-names>BD</given-names>
        </name>
        <name>
          <surname>Vogel</surname>
          <given-names>HJ</given-names>
        </name>
        <name>
          <surname>Querengesser</surname>
          <given-names>L</given-names>
        </name>
        <article-title>HMDB: the human metabolome database</article-title>
        <source>Nucleic Acids Research</source>
        <year>2007</year>
        <volume>35</volume>
        <issue>Sp. Iss. SI</issue>
        <fpage>D521</fpage>
        <lpage>D526</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkl923</pub-id>
        <pub-id pub-id-type="pmid">17202168</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="book">
        <name>
          <surname>Hoch</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Stern</surname>
          <given-names>A</given-names>
        </name>
        <source>NMR Data Processing</source>
        <year>1996</year>
        <publisher-name>Wiley-Liss, Inc., London</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="book">
        <name>
          <surname>Robert</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Casella</surname>
          <given-names>G</given-names>
        </name>
        <source>Monte Carlo Statistical Methods</source>
        <year>1999</year>
        <publisher-name>Springer-Verlag, New York</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Higham</surname>
          <given-names>N</given-names>
        </name>
        <article-title>Computing the nearest correlation matrix - a problem from finance</article-title>
        <source>IMA Journal Of Numerical Analysis</source>
        <year>2002</year>
        <volume>22</volume>
        <issue>3</issue>
        <fpage>329</fpage>
        <lpage>343</lpage>
        <pub-id pub-id-type="doi">10.1093/imanum/22.3.329</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="book">
        <name>
          <surname>Ross</surname>
          <given-names>A</given-names>
        </name>
        <etal/>
        <person-group person-group-type="editor">Lindon, J et al</person-group>
        <source>NMR Spectroscopy Techniques for Application to Metabonomics. The Handbook of Metabonomics and Metabolomics</source>
        <year>2007</year>
        <publisher-name>Elsevier, Oxford</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Ebbels</surname>
          <given-names>TMD</given-names>
        </name>
        <name>
          <surname>Cavill</surname>
          <given-names>R</given-names>
        </name>
        <article-title>Bioinformatic methods in NMR-based metabolic profiling</article-title>
        <source>Progress In Nuclear Magnetic Resonance Spectroscopy</source>
        <year>2009</year>
        <volume>55</volume>
        <issue>4</issue>
        <fpage>361</fpage>
        <lpage>374</lpage>
        <pub-id pub-id-type="doi">10.1016/j.pnmrs.2009.07.003</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="book">
        <name>
          <surname>lun Chou</surname>
          <given-names>Y</given-names>
        </name>
        <source>Statistical Analysis</source>
        <year>1975</year>
        <publisher-name>Holt International</publisher-name>
      </mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Bairaktari</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Katopodis</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Siamopoulos</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Tsolas</surname>
          <given-names>O</given-names>
        </name>
        <article-title>Paraquat-induced renal injury studied by H-1 nuclear magnetic resonance spectroscopy of urine</article-title>
        <source>Clinical Chemistry</source>
        <year>1998</year>
        <volume>44</volume>
        <issue>6, Part 1</issue>
        <fpage>1256</fpage>
        <lpage>1261</lpage>
        <pub-id pub-id-type="pmid">9625050</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Cloarec</surname>
          <given-names>O</given-names>
        </name>
        <name>
          <surname>Dumas</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Craig</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Barton</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Trygg</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Hudson</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Blancher</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Gauguier</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Lindon</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Holmes</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Nicholson</surname>
          <given-names>J</given-names>
        </name>
        <article-title>Statistical total correlation spectroscopy: An exploratory approach for latent biomarker identification from metabolic H-1 NMR data sets</article-title>
        <source>Analytical Chemistry</source>
        <year>2005</year>
        <volume>77</volume>
        <issue>5</issue>
        <fpage>1282</fpage>
        <lpage>1289</lpage>
        <pub-id pub-id-type="doi">10.1021/ac048630x</pub-id>
        <pub-id pub-id-type="pmid">15732908</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Chadeau-Hyam</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Hoggart</surname>
          <given-names>CJ</given-names>
        </name>
        <name>
          <surname>O'Reilly</surname>
          <given-names>PF</given-names>
        </name>
        <name>
          <surname>Whittaker</surname>
          <given-names>JC</given-names>
        </name>
        <name>
          <surname>De Iorio</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Balding</surname>
          <given-names>DJ</given-names>
        </name>
        <article-title>Fregene: Simulation of realistic sequence-level data in populations and ascertained samples</article-title>
        <source>BMC Bioinformatics</source>
        <year>2008</year>
        <volume>9</volume>
        <pub-id pub-id-type="doi">10.1186/1471-2105-9-364</pub-id>
        <pub-id pub-id-type="pmid">18778480</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Dudek</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Motsinger</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Velez</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Williams</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Ritchie</surname>
          <given-names>M</given-names>
        </name>
        <article-title>Data simulation software for whole-genome association and other studies in human genetics</article-title>
        <source>Pacific Symposium on Biocomputing</source>
        <year>2006</year>
        <volume>11</volume>
        <fpage>499</fpage>
        <lpage>510</lpage>
        <comment>full_text</comment>
      </mixed-citation>
    </ref>
  </ref-list>
</back>
