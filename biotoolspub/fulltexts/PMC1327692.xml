<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-title>BMC Bioinformatics</journal-title>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">1327692</article-id>
    <article-id pub-id-type="publisher-id">1471-2105-6-294</article-id>
    <article-id pub-id-type="pmid">16336691</article-id>
    <article-id pub-id-type="doi">10.1186/1471-2105-6-294</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Harshlight: a "corrective make-up" program for microarray chips</article-title>
    </title-group>
    <contrib-group>
      <contrib id="A1" equal-contrib="yes" contrib-type="author">
        <name>
          <surname>Suárez-Fariñas</surname>
          <given-names>Mayte</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>mayte@babel.rockefeller.edu</email>
      </contrib>
      <contrib id="A2" equal-contrib="yes" contrib-type="author">
        <name>
          <surname>Pellegrino</surname>
          <given-names>Maurizio</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>mpellegri@rockefeller.edu</email>
      </contrib>
      <contrib id="A3" contrib-type="author">
        <name>
          <surname>Wittkowski</surname>
          <given-names>Knut M</given-names>
        </name>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>kmw@rockefeller.edu</email>
      </contrib>
      <contrib id="A4" corresp="yes" contrib-type="author">
        <name>
          <surname>Magnasco</surname>
          <given-names>Marcelo O</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <email>magnasco@rockefeller.edu</email>
      </contrib>
    </contrib-group>
    <aff id="I1"><label>1</label>Center for Studies in Physics and Biology, The Rockefeller University, 1230 York Ave, Box 212, New York, NY 10021, USA</aff>
    <aff id="I2"><label>2</label>General Clinical Research Center, The Rockefeller University, 1230 York Ave, Box 327, New York, NY 10021, USA</aff>
    <pub-date pub-type="collection">
      <year>2005</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>10</day>
      <month>12</month>
      <year>2005</year>
    </pub-date>
    <volume>6</volume>
    <fpage>294</fpage>
    <lpage>294</lpage>
    <ext-link ext-link-type="uri" xlink:href="http://www.biomedcentral.com/1471-2105/6/294"/>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>8</month>
        <year>2005</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>12</month>
        <year>2005</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2005 Suárez-Fariñas et al; licensee BioMed Central Ltd.</copyright-statement>
      <copyright-year>2005</copyright-year>
      <copyright-holder>Suárez-Fariñas et al; licensee BioMed Central Ltd.</copyright-holder>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0">
        <p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0"/>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</p>
        <!--<rdf xmlns="http://web.resource.org/cc/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:dc="http://purl.org/dc/elements/1.1" xmlns:dcterms="http://purl.org/dc/terms"><Work xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" rdf:about=""><license rdf:resource="http://creativecommons.org/licenses/by/2.0"/><dc:type rdf:resource="http://purl.org/dc/dcmitype/Text"/><dc:author>
               Su&#x000e1;rez-Fari&#x000f1;as
               Mayte
               
               mayte@babel.rockefeller.edu
            </dc:author><dc:title>
            Harshlight: a "corrective make-up" program for microarray chips
         </dc:title><dc:date>2005</dc:date><dcterms:bibliographicCitation>BMC Bioinformatics 6(1): 294-. (2005)</dcterms:bibliographicCitation><dc:identifier type="sici">1471-2105(2005)6:1&#x0003c;294&#x0003e;</dc:identifier><dcterms:isPartOf>urn:ISSN:1471-2105</dcterms:isPartOf><License rdf:about="http://creativecommons.org/licenses/by/2.0"><permits rdf:resource="http://web.resource.org/cc/Reproduction" xmlns=""/><permits rdf:resource="http://web.resource.org/cc/Distribution" xmlns=""/><requires rdf:resource="http://web.resource.org/cc/Notice" xmlns=""/><requires rdf:resource="http://web.resource.org/cc/Attribution" xmlns=""/><permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" xmlns=""/></License></Work></rdf>-->
      </license>
    </permissions>
    <abstract>
      <sec>
        <title>Background</title>
        <p>Microscopists are familiar with many blemishes that fluorescence images can have due to dust and debris, glass flaws, uneven distribution of fluids or surface coatings, etc. Microarray scans do show similar artifacts, which might affect subsequent analysis. Although all but the starkest blemishes are hard to find by the unaided eye, particularly in high-density oligonucleotide arrays (HDONAs), few tools are available to help with the detection of those defects.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>We develop a novel tool, <italic>Harshlight</italic>, for the automatic detection and masking of blemishes in HDONA microarray chips. <italic>Harshlight </italic>uses a combination of statistic and image processing methods to identify three different types of defects: localized blemishes affecting a few probes, diffuse defects affecting larger areas, and extended defects which may invalidate an entire chip.</p>
      </sec>
      <sec>
        <title>Conclusion</title>
        <p>We demonstrate the use of <italic>Harshlight </italic>can materially improve analysis of HDONA chips, especially for experiments with subtle changes between samples. For the widely used MAS5 algorithm, we show that compact blemishes cause an average of 8 gene expression values per chip to change by more than 50%, two of them by more than twofold; our masking algorithm restores about two thirds of this damage. Large-scale artifacts are successfully detected and eliminated.</p>
      </sec>
    </abstract>
  </article-meta>
</front>
<body>
  <sec>
    <title>Background</title>
    <p>Analysis of hybridized microarrays starts with scanning the fluorescent image. The quality of data scanned from a microarray is affected by a plethora of potential confounders, which may act during printing/manufacturing, hybridization, washing, and reading. For high-density oligonucleotide arrays (HDONAs) such as Affymetrix GeneChip<sup>® </sup>oligonucleotide (Affy) arrays, each chip contains a number of probes specifically designed to assess the overall quality of the biochemistry, whose purpose is, e.g., to indicate problems with the biotinylated B2 hybridization. Affymetrix software and packages from Bioconductor project for R [<xref ref-type="bibr" rid="B1">1</xref>] provide for a number of criteria and tools to assess overall chip quality, such as percent present calls, scaling factor, background intensity, raw Q, and degradation plots. However, these criteria and tools have little sensitivity to detect localized artifacts, like specks of dust on the face of the chip, which can substantially affect the sensitivity of detecting physiological (i.e., small) differences. In the absence of readily available safeguards to indicate potential physical blemishes, researchers are advised to carefully inspect the chip images visually [<xref ref-type="bibr" rid="B2">2</xref>,<xref ref-type="bibr" rid="B3">3</xref>]. Unfortunately, it is impossible to visually detect any but the starkest artifacts against the background of hundreds of thousands of randomly allocated probes with high variance in affinity.</p>
    <p>In [<xref ref-type="bibr" rid="B4">4</xref>] a simple method to "harshlight" blemishes in HDONAs chips was presented. The method produces an Error Image (<bold>E</bold>) for each chip, which indicates the deviation of this chip's log-intensities from the other chips in the experiment. Formally, <bold>E </bold>is calculated as <bold>E</bold><sup>(<italic>i</italic>) </sup>= <bold>L</bold><sup>(<italic>i</italic>) </sup>- <italic>median </italic><sub><italic>j</italic></sub><bold>L</bold><sup>(<italic>j</italic>) </sup>where <bold>L</bold><sup>(<italic>j</italic>) </sup>is the log-intensity matrix of chip <italic>i</italic>. Given that the intensity of each cell is highly determined by the sequence of the probe [<xref ref-type="bibr" rid="B5">5</xref>], this deviation should be near zero except for the probes belonging to the probe sets related to genes that are differentially expressed. In earlier Affymetrix chips, the probe pairs corresponding to a single probeset were located in adjacent positions on the array, but now probe pairs are randomly distributed on the chip [<xref ref-type="bibr" rid="B6">6</xref>], so that no obvious pattern should be discernable in <bold>E</bold>.</p>
    <p>In about 25% of the chips we have seen, the error image shows artifacts with strikingly obvious patterns, which often hint to the physical cause of the blemish. While this makes such blemishes visible to the human eye, manually masking the defects is impractical except for small sets of chips and introduces undesirable subjectivity. Thus, we developed an R-package with subroutines in C, to automatically spot suspicious patterns in the error image (<bold>E</bold>) using a battery of diagnostic tests based on both image processing and statistical approaches.</p>
    <p>For testing and developing purposes, several sets of chips were used, including chips from Affymetrix SpikeIn (HUG133 and HUG95) experiments [<xref ref-type="bibr" rid="B6">6</xref>] and from three other experiments undertaken at Rockefeller University facilities, for a total of 158 chips. These include a variety of experimental sets: HGU133a chips on embryonic stem cell samples [<xref ref-type="bibr" rid="B7">7</xref>], two clinical studies on psoriasis [<xref ref-type="bibr" rid="B8">8</xref>], undertaken using blood and skin samples (Haider A., personal communication), and a study on microglia cells (Kreek M.J., personal communication).</p>
  </sec>
  <sec>
    <title>Implementation</title>
    <p>In [<xref ref-type="bibr" rid="B4">4</xref>] two broad categories of common defects were identified in Affymetrix GeneChips: compact and diffuse defects. <bold>Compact defects </bold>are characterized by a small or medium size region where all the probes are blemished, often due to mechanical and optical causes, like a piece of dirt on the face of the chip (see solid circles, Figure <xref ref-type="fig" rid="F1">1A</xref>). <bold>Diffuse defects are </bold>characterized by clouds with a high density of blemished probes presumably due to defects in the hybridization stage or to uneven scanner position, illumination, as those circled in dashed lines in Figure <xref ref-type="fig" rid="F1">1A</xref>. We have found evidence that these defects are probe sequence dependent, suggesting hybridization problems (see Supplementary Information: SIprobecomposition.pdf).</p>
    <fig position="float" id="F1">
      <label>Figure 1</label>
      <caption>
        <p><bold>Three types of defects</bold>. A. Solid circles mark compact defects and dashed circles outline areas with diffuse defects. B. A chip with a large defect that invalidates its further use.</p>
      </caption>
      <graphic xlink:href="1471-2105-6-294-1"/>
    </fig>
    <p>In this manuscript we shall also deal with <bold>extended defects</bold>, usually affecting a large area of the chip, as the one showed in Figure <xref ref-type="fig" rid="F1">1B</xref>. (see Ben Bolstad's homepage for more examples [<xref ref-type="bibr" rid="B9">9</xref>]).</p>
    <p>We have developed pattern recognition methods specifically tailored to each type of defect. We will describe them and how they are deployed in the next sections.</p>
    <sec>
      <title>General structure</title>
      <p>Having a batch of chips from a single experiment, the error image <bold>E </bold>is obtained for each chip as described above. Our algorithm detects patterns of outliers in these error images, so it is important to notice that henceforth, unless otherwise noted, we shall refer exclusively to the error images. In a typical experiment, only a small number of genes are expected to be differentially expressed. Thus, most pixels in <bold>E </bold>should be close to zero. Since probes belonging to a probe set are randomly distributed over the chip, variance in gene expression should not lead to spatially correlated patterns. Therefore any discernable pattern of outliers in <bold>E </bold>signals a defect. <italic>Harshlight </italic>automatically identifies those patterns and returns the batch of masked chips. The user may choose whether the intensity values of defective probes are to be substituted by missing values or by the median of the intensity values of the other chips (default).</p>
      <p>The program's structure is outlined in Figure <xref ref-type="fig" rid="F2">2</xref>. Initially, <bold>E </bold>is scanned for the presence of an extended defect and if one is found, the chip is discarded; otherwise, the routine continues by searching for compact and diffuse defects, masking them and making sure they do not belong to a diffuse defect thought a contiguity test. Once the compact defects are recognized, they are masked and the programs proceeds looking for areas of diffuse defects.</p>
      <fig position="float" id="F2">
        <label>Figure 2</label>
        <caption>
          <p><bold><italic>Harshlight </italic>flow diagram</bold>. For each chip, an error image is obtained by subtracting the median across all chips and analyzed for the presence of extended defects. If any is found, the chip is discarded; otherwise it is searched for compact defects. Isolated compact defects are then subtracted from the error image prior to searching for diffuse defects. The expression values within compact and diffuse defects are then purged from the chip.</p>
        </caption>
        <graphic xlink:href="1471-2105-6-294-2"/>
      </fig>
    </sec>
    <sec>
      <title>Extended defects</title>
      <p>Defects covering a large area (extended defects), can cause substantial variation in the overall intensity from one region of the chip to another, thereby compromising the assumption that most cells have only a small deviation from the median. To quantify such variation, we decomposed the error image <bold>E </bold>as:</p>
      <p><bold>E </bold>= <bold>B</bold><sub><bold>E </bold></sub>+ <bold>η</bold><sub><bold>E</bold></sub></p>
      <p>where <bold>B</bold><sub><bold>E </bold></sub>and <bold>η</bold><sub><bold>E </bold></sub>represent, respectively, the background and features of the error image <bold>E. </bold>Please note that <bold>B</bold><sub><bold>E </bold></sub>is a background in an image analysis sense, and it should not be confused with the optical background of the original chip image that is addressed in background correction procedures; <bold>B</bold><sub><bold>E </bold></sub>is not related to the "dark" area of the original image and in fact can have either sign. sSimilarly, the "features" of the error image are its local spatial variations, and also can have either sign. Ideally, in an unblemished chip, the features <bold>η</bold><sub><bold>E </bold></sub>originate in differentially expressed genes, which are expected to be spatially randomly distributed with mean zero and variance <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M1" name="1471-2105-6-294-i1" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeq4TdG2aaSbaaWqaaiabhweafbqabaaaleaacqaIYaGmaaaaaa@3289@</mml:annotation></mml:semantics></mml:math></inline-formula>. Assuming background and features to be uncorrelated, this allows the variance of <bold>E </bold>to be decomposed as:</p>
      <p>
        <inline-formula>
          <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M2" name="1471-2105-6-294-i2" overflow="scroll">
            <mml:semantics definitionURL="" encoding="">
              <mml:mrow>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mstyle mathvariant="bold" mathsize="normal">
                    <mml:mi>E</mml:mi>
                  </mml:mstyle>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
                <mml:mo>=</mml:mo>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mstyle mathvariant="bold" mathsize="normal">
                    <mml:mi>B</mml:mi>
                  </mml:mstyle>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
                <mml:mo>+</mml:mo>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>η</mml:mi>
                      <mml:mi>E</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
              </mml:mrow>
              <mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCyraueabaGaeGOmaidaaOGaeyypa0Jaeq4Wdm3aa0baaSqaaiabhkeacbqaaiabikdaYaaakiabgUcaRiabeo8aZnaaDaaaleaacqaH3oaAdaWgaaadbaGaemyraueabeaaaSqaaiabikdaYaaaaaa@3C6D@</mml:annotation>
            </mml:semantics>
          </mml:math>
        </inline-formula>
      </p>
      <p>To estimate <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M3" name="1471-2105-6-294-i3" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>B</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCOqai0aaSbaaWqaaiabhweafbqabaaaleaacqaIYaGmaaaaaa@31EE@</mml:annotation></mml:semantics></mml:math></inline-formula>, the image is smoothed with a median filter[<xref ref-type="bibr" rid="B10">10</xref>], a technique commonly used in image processing to eliminate single-pixel noise. The median filtered image <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M4" name="1471-2105-6-294-i4" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>E</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mstyle><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacuWHfbqrgaacaaaa@2DD2@</mml:annotation></mml:semantics></mml:math></inline-formula>, created trough a sliding median kernel, is an estimator of the background <bold>B</bold><sub><bold>E </bold></sub>as is defined by</p>
      <p><inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M5" name="1471-2105-6-294-i5" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>E</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mstyle><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacuWHfbqrgaacamaaBaaaleaacqWGPbqAaeqaaaaa@2F59@</mml:annotation></mml:semantics></mml:math></inline-formula> = <italic>median</italic>(<bold>E</bold><sub><italic>j</italic></sub>, <italic>j </italic>∊ Θ<sub><italic>i</italic></sub>)</p>
      <p>where Θ<sub>i </sub>are the pixels in the window centered in <italic>i</italic>. In our case, the mask used is a circular window with a user defined radius (default = 10 pixels). At the edges of the image, the part of the mask that lies outside of the chip borders is filled with the image mirrored at the border.</p>
      <p>Since the background is locally constant, we have approximately:</p>
      <p>
        <inline-formula>
          <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M6" name="1471-2105-6-294-i6" overflow="scroll">
            <mml:semantics definitionURL="" encoding="">
              <mml:mrow>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mstyle mathvariant="bold" mathsize="normal">
                    <mml:mover accent="true">
                      <mml:mi>E</mml:mi>
                      <mml:mo>˜</mml:mo>
                    </mml:mover>
                  </mml:mstyle>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
                <mml:mo>=</mml:mo>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mstyle mathvariant="bold" mathsize="normal">
                        <mml:mi>B</mml:mi>
                      </mml:mstyle>
                      <mml:mstyle mathvariant="bold" mathsize="normal">
                        <mml:mi>E</mml:mi>
                      </mml:mstyle>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
                <mml:mo>+</mml:mo>
                <mml:mfrac>
                  <mml:mrow>
                    <mml:msubsup>
                      <mml:mi>σ</mml:mi>
                      <mml:mi>η</mml:mi>
                      <mml:mn>2</mml:mn>
                    </mml:msubsup>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>n</mml:mi>
                      <mml:mi>δ</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mfrac>
                <mml:munder>
                  <mml:mo>→</mml:mo>
                  <mml:mrow>
                    <mml:mi>δ</mml:mi>
                    <mml:mo>→</mml:mo>
                    <mml:mi>∞</mml:mi>
                  </mml:mrow>
                </mml:munder>
                <mml:msubsup>
                  <mml:mi>σ</mml:mi>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mstyle mathvariant="bold" mathsize="normal">
                        <mml:mi>B</mml:mi>
                      </mml:mstyle>
                      <mml:mstyle mathvariant="bold" mathsize="normal">
                        <mml:mi>E</mml:mi>
                      </mml:mstyle>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mn>2</mml:mn>
                </mml:msubsup>
              </mml:mrow>
              <mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacWaLas4Wdm3aiqjGDaaaleacucOafCyrauKbaGaaaeacucOamqjGikdaYaaakiabg2da9iabeo8aZnaaDaaaleaacqWHcbGqdaWgaaadbaGaeCyraueabeaaaSqaaiabikdaYaaakiabgUcaRmaalaaabaGaeq4Wdm3aa0baaSqaaiabeE7aObqaaiabikdaYaaaaOqaaiabd6gaUnaaBaaaleaacqaH0oazaeqaaaaakmaaoGcaleqabaGaeqiTdqMaeyOKH4QaeyOhIukakiaawkziaiabeo8aZnaaDaaaleaacqWHcbGqdaWgaaadbaGaeCyraueabeaaaSqaaiabikdaYaaaaaa@5147@</mml:annotation>
            </mml:semantics>
          </mml:math>
        </inline-formula>
      </p>
      <p>where <italic>n</italic><sub>δ </sub>is the number of pixels in the window, which is equal to 10<sup>2</sup>π ≈ 314 in the case of a circular window with radius δ = 10. Thus, <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M7" name="1471-2105-6-294-i7" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>E</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mstyle><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGafCyrauKbaGaaaeaacqaIYaGmaaGccaaMcSoaaa@3245@</mml:annotation></mml:semantics></mml:math></inline-formula> is a good approximation of the background variance.</p>
      <p>In an unblemished chip, the variance of the deviations from the median chip, <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M8" name="1471-2105-6-294-i8" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCyraueabaGaeGOmaidaaaaa@30A5@</mml:annotation></mml:semantics></mml:math></inline-formula>, is mainly due to the variance of the features η, and the background <bold>B</bold><sub><bold>E </bold></sub>should suffer small variations across the chip, i.e. <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M9" name="1471-2105-6-294-i9" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>η</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciGacaGaaeqabaqabeGadaaakeaaiiaacqWFdpWCdaqhaaWcbaGae83TdGgabaGae8Nmaidaaaaa@3133@</mml:annotation></mml:semantics></mml:math></inline-formula> &gt;&gt; <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M10" name="1471-2105-6-294-i3" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>B</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCOqai0aaSbaaWqaaiabhweafbqabaaaleaacqaIYaGmaaaaaa@31EE@</mml:annotation></mml:semantics></mml:math></inline-formula>. However, in an image such that in Figure <xref ref-type="fig" rid="F1">1B</xref> there is a large variation of the background from one region to another. Thus, the proportion of variations in <bold>E </bold>explained by the background, namely <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M11" name="1471-2105-6-294-i3" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>B</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCOqai0aaSbaaWqaaiabhweafbqabaaaleaacqaIYaGmaaaaaa@31EE@</mml:annotation></mml:semantics></mml:math></inline-formula>/<inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M12" name="1471-2105-6-294-i8" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCyraueabaGaeGOmaidaaaaa@30A5@</mml:annotation></mml:semantics></mml:math></inline-formula>, quantifies the extent of such defect. If this quantity is bigger than a certain threshold, the chip should be discarded.</p>
      <p>This kind of extended defect was rare; we only found three seriously flawed chips among the 158 chips we analyzed. The percentage of the estimated variance explained by the background <inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M13" name="1471-2105-6-294-i7" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>E</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mstyle><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGafCyrauKbaGaaaeaacqaIYaGmaaGccaaMcSoaaa@3245@</mml:annotation></mml:semantics></mml:math></inline-formula>/<inline-formula><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M14" name="1471-2105-6-294-i8" overflow="scroll"><mml:semantics definitionURL="" encoding=""><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacqaHdpWCdaqhaaWcbaGaeCyraueabaGaeGOmaidaaaaa@30A5@</mml:annotation></mml:semantics></mml:math></inline-formula> varied across chip collections; chips handled by our local facility had a median of 3% and always had &lt;9% variations. The SpikeIn experiments had substantially larger ratios, and in the case of SpikeIn95, three outlier chips at 33%, 36% and 60% (the chip in Figure <xref ref-type="fig" rid="F1">1B</xref>). No chip in our collection has ratios between 17% and 33%, so any number in that range seems a reasonable threshold given our limited statistics. Since typically σ<sub>η</sub>~0.4 in log2 units, chips with large ratios can be materially distorted; the background of the chip in Figure <xref ref-type="fig" rid="F1">1B</xref> has σ<sub>B </sub>= 0.5, so the intensities in the bright region are more than double the intensities in the dark area.</p>
      <p>We do not have enough data to ascertain what causes extended defects; since the chips are scanned by a laser-scanning system, extended defects are not caused by changes in illumination level or other simple physical causes. We therefore do not currently know what an appropriate remedy would be, so if an extended defect is detected analysis is stopped for this chip, and suggest to the user the chip should be discarded.</p>
    </sec>
    <sec>
      <title>Compact defects</title>
      <p>If the chip passed the previous test, analysis continues. First the chip is searched for compact defects, defined as small connected clusters of outliers in the error image <bold>E</bold>. As probe pairs are randomly distributed, differential gene expression leads to spatially uncorrelated variations. In good chips, the outlier pixels of <bold>E </bold>should not be connected, so connected outlier pixels indicate compact defects.</p>
      <p>Figure <xref ref-type="fig" rid="F3">3</xref> illustrates the algorithm to detect such defects. First, we declare outliers all the pixels in <bold>E </bold>with intensities smaller than the α-percentile (dark outliers) or bigger than (1 - α)-percentile (default: α = 2.5% both for bright and dark defects). Outlier Images are created as binary images where 1 represents pixels declared as outliers. Though in Figure <xref ref-type="fig" rid="F3">3B</xref> they are shown as a single image, dark and bright outliers are treated separately.</p>
      <fig position="float" id="F3">
        <label>Figure 3</label>
        <caption>
          <p><bold>Algorithm to detect compact defects</bold>. Outliers (B) are declared based on the distribution function of the <bold>E </bold>(A). Then, clusters of outliers are identified with a FloodFill algorithm (C), and a size threshold is applied to eliminate clusters made of single or only a few pixels (D).</p>
        </caption>
        <graphic xlink:href="1471-2105-6-294-3"/>
      </fig>
      <p>For each outlier image, the FloodFill algorithm[<xref ref-type="bibr" rid="B11">11</xref>] is then used to detect clusters of connected outliers. For every flagged pixel in the image, the algorithm recursively looks for other flagged pixels in its neighborhood. If any are found, the pixels are assigned to the same cluster number. The process stops when no more connected pixels can be found (see Figure <xref ref-type="fig" rid="F3">3C</xref> for the resulting image). The user can choose whether two pixels are considered connected if they share only an edge (4 -neighbours connectivity) or also a corner (8-neighbours connectivity, default).</p>
      <p>Even in a "good" chip, where the outliers are spatially randomly distributed, it is possible to find small clusters by chance. So, to guard against spurious results, the cluster size distribution under the null hypothesis of (spatially) randomly distributed outliers is obtained through simulation. Since this distribution depends on both chip size and density of outliers, simulations need to be carried out for each combination of those parameters. To reduce the computational burden at the procedure's runtime, we carried out simulations for common chips' designs (534 × 534, 640 × 640, and 712 × 712) and selected proportion of outliers (0.01, 0.02, 0.05, 0.10, 0.20, 0.25, 0.30, and 0.40). An example of this distribution is the lower curve in Figure <xref ref-type="fig" rid="F4">4</xref>. By default, if the user's chip dimensions or specified proportion of outliers are not among those tabulated, distribution values are interpolated from the table. However the user may override interpolation and run-time simulations will be executed.</p>
      <fig position="float" id="F4">
        <label>Figure 4</label>
        <caption>
          <p><bold>Number of compact clusters per chip as a function of their area</bold>. Solid curve (empirical) all chips in our collection. Dashed curve (simulation, 100000 random images) null distribution.</p>
        </caption>
        <graphic xlink:href="1471-2105-6-294-4"/>
      </fig>
      <p>After each cluster is defined, the significance of its size <italic>s </italic>can be easily computed as 1-F(<italic>s</italic>), where F is the cumulative distribution of cluster size under the null hypothesis in a chip of the same dimension and proportion of outliers. If the size significance is bigger than a user-defined threshold (default α = 0.01), the cluster is discarded and not considered as a blemish (Figure <xref ref-type="fig" rid="F3">3D</xref>). In addition, its size is also compared to the minimum cluster size accepted (user defined, default = 15 pixels): again, if the cluster is not large enough it is not considered. The collection of chips we have examined displays a large number of compact defects, many of them quite large.</p>
      <p>A histogram of the size distribution of compact defects, contrasted with the null hypothesis distribution derived from simulations, is shown in Figure <xref ref-type="fig" rid="F4">4</xref>. Within the range of a few units of area through several hundred probes, the distribution of compact defects can be approximated by a power law (similar to the Zipf law in linguistics) <italic>N</italic>(<italic>A</italic>)~A<sup>-3.1</sup>, while the null distribution falls off exponentially as <italic>N</italic>(<italic>A</italic>)~e<sup>-2.12A</sup>. Therefore for even moderately small areas the significance of such clusters is extremely high.</p>
      <p>Areas covered by compact defects are excluded from the chip before continuing with the next step.</p>
    </sec>
    <sec>
      <title>Diffuse defects</title>
      <p>Diffuse defects are defined as areas with densely distributed, although not necessarily connected outliers.</p>
      <p>In normal chips, outliers should be spatially uniformly distributed over the image, so proportion of outliers should be similar for different regions. In case of diffuse defects, we are looking for areas in which there are a large number of outliers, when compared to other regions of the image. Figure <xref ref-type="fig" rid="F5">5</xref> shows the algorithm used to detect areas with diffuse defects, which begins with the definition of the Outliers image.</p>
      <fig position="float" id="F5">
        <label>Figure 5</label>
        <caption>
          <p><bold>Algorithm to detect areas with diffuse defects</bold>. The Outlier Image is obtained as for the analysis of the compact defects. A circular kernel is then applied to each pixel in the image to detect areas in which the observed number of outliers exceeds the expected number, based on a binomial test. The defected areas thus determined undergo a round of cluster detection and size threshold, in order to eliminate small areas. The final step involves a dilation and erosion of the defects, in order to better outline the areas.</p>
        </caption>
        <graphic xlink:href="1471-2105-6-294-5"/>
      </fig>
      <p>The first step involves, as in the case of compact defects, the declaration of outliers. To avoid penalizing chips with small error variance, we declare outliers those pixels whose intensity values are higher (bright outliers) or lower (dark outliers) by a certain percentage than the expected intensity. In terms of the <bold>E</bold>, this criterion (also used in[<xref ref-type="bibr" rid="B12">12</xref>]) implies that if pixels with x% of decrease in intensities are considered dark outliers, the dark outlier image can be defined as:</p>
      <p>
        <inline-formula>
          <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M15" name="1471-2105-6-294-i10" overflow="scroll">
            <mml:semantics definitionURL="" encoding="">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>O</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mrow>
                  <mml:mo>{</mml:mo>
                  <mml:mrow>
                    <mml:mtable columnalign="left">
                      <mml:mtr columnalign="left">
                        <mml:mtd columnalign="left">
                          <mml:mn>1</mml:mn>
                        </mml:mtd>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mi>f</mml:mi>
                            <mml:mtext> </mml:mtext>
                            <mml:msub>
                              <mml:mi>E</mml:mi>
                              <mml:mi>i</mml:mi>
                            </mml:msub>
                            <mml:mo>≤</mml:mo>
                            <mml:mo>−</mml:mo>
                            <mml:msub>
                              <mml:mrow>
                                <mml:mi>log</mml:mi>
                                <mml:mo>⁡</mml:mo>
                              </mml:mrow>
                              <mml:mn>2</mml:mn>
                            </mml:msub>
                            <mml:mo stretchy="false">(</mml:mo>
                            <mml:mn>1</mml:mn>
                            <mml:mo>+</mml:mo>
                            <mml:mi>x</mml:mi>
                            <mml:mo stretchy="false">)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr columnalign="left">
                        <mml:mtd columnalign="left">
                          <mml:mn>0</mml:mn>
                        </mml:mtd>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi>o</mml:mi>
                            <mml:mi>t</mml:mi>
                            <mml:mi>h</mml:mi>
                            <mml:mi>e</mml:mi>
                            <mml:mi>r</mml:mi>
                            <mml:mi>w</mml:mi>
                            <mml:mi>i</mml:mi>
                            <mml:mi>s</mml:mi>
                            <mml:mi>e</mml:mi>
                          </mml:mrow>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
              <mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciGacaGaaeqabaqabeGadaaakeaacqWGpbWtdaWgaaWcbaGaemyAaKgabeaakiabg2da9maaceaabaqbaeaabiGaaaqaaiabigdaXaqaaiabdMgaPjabdAgaMjaaykW7ieqacqWFfbqrdaWgaaWcbaGaemyAaKgabeaakiabgsMiJkabgkHiTiGbcYgaSjabc+gaVjabcEgaNnaaBaaaleaacqaIYaGmaeqaaOGaeiikaGIaeGymaeJaey4kaSIaemiEaGNaeiykaKcabaGaeGimaadabaGaem4Ba8MaemiDaqNaemiAaGMaemyzauMaemOCaiNaem4DaCNaemyAaKMaem4CamNaemyzaugaaaGaay5Eaaaaaa@53C2@</mml:annotation>
            </mml:semantics>
          </mml:math>
        </inline-formula>
      </p>
      <p>Both Outlier Images (one for dark outliers, one for the bright ones, overlaid in Figure <xref ref-type="fig" rid="F5">5A</xref>), are scanned with a circular sliding window of user-defined radius (default radius δ = 10). The borders are duplicated as described for the extended defects. For every pixel <italic>i </italic>in the Outlier image, the proportion of outliers in the surrounding circular window Θ<sub>i </sub>is computed as:</p>
      <p>
        <inline-formula>
          <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M16" name="1471-2105-6-294-i11" overflow="scroll">
            <mml:semantics definitionURL="" encoding="">
              <mml:mrow>
                <mml:msub>
                  <mml:mi>p</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mfrac>
                  <mml:mn>1</mml:mn>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>n</mml:mi>
                      <mml:mi>δ</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mfrac>
                <mml:mstyle displaystyle="true">
                  <mml:munder>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:msub>
                        <mml:mi>Θ</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                    </mml:mrow>
                  </mml:munder>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>O</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:mstyle>
              </mml:mrow>
              <mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciaacaGaaeqabaqabeGadaaakeaacaaMcSUaemiCaa3aaSbaaSqaaiabdMgaPbqabaGccqGH9aqpdaWcaaqaaiabigdaXaqaaiabd6gaUnaaBaaaleaacqaH0oazaeqaaaaakmaaqafabaGaem4ta80aaSbaaSqaaiabdMgaPbqabaaabaGaemyAaKMaeyicI4SaeuiMde1aaSbaaWqaaiabdMgaPbqabaaaleqaniabggHiLdGccaaMcSoaaa@42B3@</mml:annotation>
            </mml:semantics>
          </mml:math>
        </inline-formula>
      </p>
      <p>A binomial test is then used to decide whether <italic>p</italic><sub><italic>i </italic></sub>is larger than the overall proportion <italic>p</italic><sub><italic>o </italic></sub>of outliers in the image, i.e. to test <italic>p</italic><sub><italic>i</italic></sub>&gt;<italic>p</italic><sub><italic>o</italic></sub><italic>vs. </italic><italic>p</italic><sub><italic>i </italic></sub>= <italic>p</italic><sub><italic>o</italic></sub>.. A new image (Figure <xref ref-type="fig" rid="F5">5B</xref>) is then created as</p>
      <p>
        <inline-formula>
          <mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" id="M17" name="1471-2105-6-294-i12" overflow="scroll">
            <mml:semantics definitionURL="" encoding="">
              <mml:mrow>
                <mml:msub>
                  <mml:mstyle mathvariant="bold" mathsize="normal">
                    <mml:mi>D</mml:mi>
                  </mml:mstyle>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mrow>
                  <mml:mo>{</mml:mo>
                  <mml:mrow>
                    <mml:mtable columnalign="left">
                      <mml:mtr columnalign="left">
                        <mml:mtd columnalign="left">
                          <mml:mn>1</mml:mn>
                        </mml:mtd>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi>i</mml:mi>
                            <mml:mi>f</mml:mi>
                            <mml:mtext> </mml:mtext>
                            <mml:msub>
                              <mml:mi>p</mml:mi>
                              <mml:mi>i</mml:mi>
                            </mml:msub>
                            <mml:mo>&gt;</mml:mo>
                            <mml:msub>
                              <mml:mi>b</mml:mi>
                              <mml:mrow>
                                <mml:mn>1</mml:mn>
                                <mml:mo>−</mml:mo>
                                <mml:mi>α</mml:mi>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo stretchy="false">(</mml:mo>
                            <mml:msub>
                              <mml:mi>p</mml:mi>
                              <mml:mi>o</mml:mi>
                            </mml:msub>
                            <mml:mo>,</mml:mo>
                            <mml:msub>
                              <mml:mi>n</mml:mi>
                              <mml:mi>δ</mml:mi>
                            </mml:msub>
                            <mml:mo stretchy="false">)</mml:mo>
                          </mml:mrow>
                        </mml:mtd>
                      </mml:mtr>
                      <mml:mtr columnalign="left">
                        <mml:mtd columnalign="left">
                          <mml:mn>0</mml:mn>
                        </mml:mtd>
                        <mml:mtd columnalign="left">
                          <mml:mrow>
                            <mml:mi>o</mml:mi>
                            <mml:mi>t</mml:mi>
                            <mml:mi>h</mml:mi>
                            <mml:mi>e</mml:mi>
                            <mml:mi>r</mml:mi>
                            <mml:mi>w</mml:mi>
                            <mml:mi>i</mml:mi>
                            <mml:mi>s</mml:mi>
                            <mml:mi>e</mml:mi>
                          </mml:mrow>
                        </mml:mtd>
                      </mml:mtr>
                    </mml:mtable>
                  </mml:mrow>
                </mml:mrow>
              </mml:mrow>
              <mml:annotation encoding="MathType-MTEF">
 MathType@MTEF@5@5@+=feaafiart1ev1aaatCvAUfKttLearuWrP9MDH5MBPbIqV92AaeXatLxBI9gBaebbnrfifHhDYfgasaacH8akY=wiFfYdH8Gipec8Eeeu0xXdbba9frFj0=OqFfea0dXdd9vqai=hGuQ8kuc9pgc9s8qqaq=dirpe0xb9q8qiLsFr0=vr0=vr0dc8meaabaqaciGacaGaaeqabaqabeGadaaakeaacqWHebardaWgaaWcbaGaemyAaKgabeaakiabg2da9maaceaabaqbaeaabiGaaaqaaiabigdaXaqaaiabdMgaPjabdAgaMjaaykW7cqWGWbaCdaWgaaWcbaGaemyAaKgabeaakiabg6da+iabdkgaInaaBaaaleaacqaIXaqmcqGHsislcqaHXoqyaeqaaOGaeiikaGIaemiCaa3aaSbaaSqaaiabd+gaVbqabaGccqGGSaalcqWGUbGBdaWgaaWcbaGaeqiTdqgabeaakiabcMcaPaqaaiabicdaWaqaaiabd+gaVjabdsha0jabdIgaOjabdwgaLjabdkhaYjabdEha3jabdMgaPjabdohaZjabdwgaLbaaaiaawUhaaiaaykW6aaa@5781@</mml:annotation>
            </mml:semantics>
          </mml:math>
        </inline-formula>
      </p>
      <p>where <italic>b</italic><sub>α</sub>(p,n) is the α-percentile of the binomial distribution. <bold>D </bold>gives a better representation of the regions with high proportion of outliers, since the disconnected pixels in the Outlier Image appear now more connected (see Figure <xref ref-type="fig" rid="F5">5B</xref>).</p>
      <p>The FloodFill algorithm is then used to detect connected flagged pixels (<bold>D</bold><sub><italic>i </italic></sub>= 1) as before, and clusters of small size are discarded. The user can set the size limit of the clusters, but the default value is three times the area of the sliding window.</p>
      <p>Finally, to better outline the area of blemishes, the image undergoes a closing procedure. This is a technique commonly used in image processing to close up breaks in the features of an image (see for example [<xref ref-type="bibr" rid="B10">10</xref>]). In our case, a circular kernel is centered in each pixel of the image (radius = radius of the kernel used to detect the diffuse defects, see later). Its centre is flagged if any of the pixels of the kernel is flagged.</p>
      <p>This procedure (dilation) causes the borders of the defects to grow, eventually filling empty spaces inside the features. However, in order to maintain the original outer borders of the features, another circular kernel is applied to the image. This time, the centre of the window is flagged only if all of the pixels inside the window are flagged. This procedure (erosion) reverses any extension beyond the compact hull of the original cluster.</p>
      <p>We suggest that all probes in the closed area should be masked, but the user can choose to mask only the outlier probes.</p>
    </sec>
    <sec>
      <title>Contiguity test</title>
      <p>It can happen that in a region with diffuse defects (as the one shown in Figure <xref ref-type="fig" rid="F6">6A</xref>) some blemished pixels can be clustered together, with sufficiently large size to be detected as compact defects (Figure <xref ref-type="fig" rid="F6">6C</xref>). If they were eliminated in the compact detection step, they could affect the recognition of diffuse regions. To avoid misrecognition of parts of diffuse defects as compact defects, a "contiguity test" is applied after the compact defects are detected. To perform the test, a "closing" procedure is applied to the binary image representing the compact defects (Figure <xref ref-type="fig" rid="F6">6D</xref>).</p>
      <fig position="float" id="F6">
        <label>Figure 6</label>
        <caption>
          <p><bold>Compact defects or part of a diffuse one?</bold>. A. <bold>E. </bold>B. Zoomed area with a diffuse defect. C defects "harshlighted" as compact. D. Region delimited by the closing procedure. C. Density of the area, more than half of the probes in the region are not defective, so the region is probably considered to contain a diffuse defect.</p>
        </caption>
        <graphic xlink:href="1471-2105-6-294-6"/>
      </fig>
      <p>Real compact defects are isolated and highly connected clusters, so that after the closing procedure their area remains substantially the same. On the contrary, probes declared as compact defects that are part of diffuse defects are close to one another, and therefore after the closing procedure the area covered by the resulting cluster is appreciably bigger than the area covered by the compact defects alone. Comparing the extension of the areas before and after the procedure gives us an idea of how many compact defects there are in a specific region. The ratio between these two areas (Figure <xref ref-type="fig" rid="F6">6C</xref> and <xref ref-type="fig" rid="F6">6D</xref>) represents the density of compact defects in the region (Figure <xref ref-type="fig" rid="F6">6E</xref>). If this value is smaller than a threshold (default = 50%), the compact defects in the region are probably part of diffuse defects and shall not be eliminated when the compact detection procedure ends.</p>
    </sec>
    <sec>
      <title>Harshlight package</title>
      <p>The package was implemented in R in compliance with the CRAN guidelines. Computationally intensive routines were implemented in C (R shared library builder 1.29 and GCC version 3.2.3) through the R interface for better efficiency.</p>
      <p>The main <italic>Harshlight </italic>function accepts a Bioconductor object from the class <italic>affyBatch</italic>. For each batch of chips analyzed, the program returns two outputs: a file report in PostScript format and a new <italic>affyBatch </italic>object. The report shows, for each chip analyzed, the number and type of defects found, the percentage of the area eliminated after the analysis, an image is produced for each kind of defect, showing the areas where the blemishes are found. The output <italic>affyBatch </italic>object is identical to the input, except that the values within defects are declared missing. If some downstream subroutine does not allow for missing data, the user may choose to have missing data be substituted with the median of the <italic>other </italic>chips' intensity values for the blemished probe; this is a neutral substitution strategy, since it sets the error image values to zero on the blemished probe without affecting any other value. In general, the efficacy of an imputation method depends on what analysis is used downstream of it; because of this, only the median substitution method has been built into <italic>Harshlight</italic>. Other imputation methods can be still used, as functions taking an <italic>Affybatch </italic>object with missing values.</p>
      <p>Other parameters to the function <italic>Harslight </italic>including in the implementation of the algorithm are summarized in Table <xref ref-type="table" rid="T1">1</xref>. The choice of the default parameter values is based on our experience, but may depend on the individual lab or chip type. Still, using a uniform set of parameters for all chips in a given experiment avoids spurious effects that might be caused by manually excluding areas on the chip from analysis. Some parameters are robust, in the sense that the results are not affected by small changes. For instance, the kernel radii are robust, and so we selected the smallest value that performs well, so as to minimize running time. Other parameters, on the other hand, define the nature of what is being found; the default values we provide work well for our chip collection, and are provided as adjustable to allow for flexibility.</p>
      <table-wrap position="float" id="T1">
        <label>Table 1</label>
        <caption>
          <p>Default values for the parameters used in the program</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <td align="center">
                <bold>Defects</bold>
              </td>
              <td align="center">
                <bold>Parameter</bold>
              </td>
              <td align="center">
                <bold>Value</bold>
              </td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">Extended</td>
              <td align="center">Radius of the median filter</td>
              <td align="center">10 pixels</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Threshold for the proportion of variance explained by the Background</td>
              <td align="center">30%</td>
            </tr>
            <tr>
              <td align="left">Compact</td>
              <td align="center">Quantile for the definition of outliers</td>
              <td align="center">5th, two tails</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Minimum size of clusters</td>
              <td align="center">15 pixels</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Connectivity definition</td>
              <td align="center">8-neighbours</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Probability value</td>
              <td align="center">0.01</td>
            </tr>
            <tr>
              <td align="left">Diffuse</td>
              <td align="center">Threshold for bright defects</td>
              <td align="center">40% more than original value</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Threshold for dark defects</td>
              <td align="center">35% more than original value</td>
            </tr>
            <tr>
              <td/>
              <td align="center">p-value threshold for binomial test.</td>
              <td align="center">0.001</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Radius of sliding window</td>
              <td align="center">10 pixels</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Connectivity definition</td>
              <td align="center">8-neighbours</td>
            </tr>
            <tr>
              <td/>
              <td align="center">Minimum size of clusters</td>
              <td align="center">3π*diff. radius</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>Results and Discussion</title>
    <p>We have built an algorithm upon a recently-developed methodology to visualize artifacts on HDONA microarrays, which automatically masks areas affected by these artifacts; we present an implementation of the algorithm in an R package, called <italic>Harshlight</italic>. The algorithm combines image analysis techniques with statistical approaches to recognize three types of defects frequent in Affymetrix microarray chips: extended, compact, and diffuse defects. The algorithm was tested on 158 chips, from 5 different experiments, including the two Affymetrix SpikeIn experiments. Output reports for all chips can be found online at[<xref ref-type="bibr" rid="B13">13</xref>].</p>
    <p>That blemishes exist in fair abundance is clear from those output reports as well as from Figure <xref ref-type="fig" rid="F4">4</xref>. We shall now demonstrate that these blemishes affect the gene expression values and that <italic>Harshlight </italic>can restore this damage.</p>
    <p>Different summarization algorithms are expected to resist blemishes differently, based on their statistical construction. We shall concentrate here on two popular algorithms, MAS5 and GCRMA. MAS5 is the "official" algorithm supplied by Affymetrix and by far the most widespread; GCRMA is an open-source method available in the Bioconductor suite, based on robust averaging techniques and sequence-dependent affinity corrections [<xref ref-type="bibr" rid="B14">14</xref>]. The robust averaging employed in GCRMA should confer strong immunity to outliers. We shall show below that MAS5 is strongly affected by blemishes, and that GCRMA is affected to a smaller, yet still relevant extent.</p>
    <p>We quantified the ability of <italic>Harshlight </italic>to apply "corrective make-up" using two distinct strategies: first, by artificially blemishing a "clean" dataset and verifying how much the values are affected and how well they are restored, and second, by using a case where nominal concentrations are known, the Affymetrix SpikeIn experiments.</p>
    <p>For the first strategy, we wrote a simple utility we dubbed "<italic>AffyPox</italic>", which pockmarks a collection of chips with simulated defects with characteristics similar to those found in the test chips (Figure <xref ref-type="fig" rid="F4">4</xref>). Compact defects were simulated as randomly located circles of radius between 4 and 6 pixels, each defect having equal probability of being "bright" or "dark". The probes within the circle are linearly compressed into the lower (upper) 20% of the intensity range for dark (bright) defects. Further information on <italic>Affypox </italic>is available on the program's vignette. For our starting point, we took the most unblemished dataset in our collection, and we then further selected from this dataset the 8 chips with the smallest number of blemishes. Then we generated 10 artificial compact defects per chip as described above, covering less than 0.2% of the overall surface area. Since for both GCRMA and MAS5 the background and normalization process couple all the genes together, all genes' expression values are affected, most of them only by a minute amount, and a few by considerable amounts: there were 20 genes' expression values per chip affected by more than twofold in MAS5, while 3 genes per chip had more than 50% change in GCRMA. <italic>Harshlight </italic>detected and excised all 80 artificial defects in addition to two "false positive" defects, and reduced the number of genes affected at high fold changes, by a factor of approximately 3 in the case of MAS5, and about 2 in the case of GCRMA, as shown in Figure <xref ref-type="fig" rid="F7">7</xref>; GCRMA appears to resist blemishes better than MAS5, but at the same time the damage appears harder to undo. As with any restoration process, a large number of genes is restored, some are untouched, and a few are changed for the worse, as shown in Figure <xref ref-type="fig" rid="F8">8</xref>.</p>
    <fig position="float" id="F7">
      <label>Figure 7</label>
      <caption>
        <p><bold>MAS5 and GCRMA analysis</bold>. After artificially blemishing a collection of chips we excised the blemishes with <italic>Harshlight </italic>using median substitution. We compare the expression values of the blemished chips vs. the original, and the expression values after restoration with <italic>Harshlight </italic>vs. the originals. Left, GCRMA shows a substantial improvement; right, MAS5 shows a dramatic improvement.</p>
      </caption>
      <graphic xlink:href="1471-2105-6-294-7"/>
    </fig>
    <fig position="float" id="F8">
      <label>Figure 8</label>
      <caption>
        <p><bold>Restoration effects</bold>. Comparing the log fold changes in the MAS5 algorithm before and after restoration. Vertical axis, log fold change between the original expression values and the restored values (Orig vs median). Horizontal axis, log fold change between the original and blemished chips (Orig vs pox). Notice three straight lines through the plot. A diagonal line represents changed expression values that were not restored by <italic>Harshlight</italic>. A vertical line shows a few cases in which <italic>Harshlight </italic>incorrectly affected the expression values. Most points lie near the horizontal axis, showing that <italic>Harshlight </italic>restored values closer to the original.</p>
      </caption>
      <graphic xlink:href="1471-2105-6-294-8"/>
    </fig>
    <p>For the second strategy, we used a well-known comparison suite, <italic>AffyComp</italic>, which was developed to quantify the performance of various summarization algorithms [<xref ref-type="bibr" rid="B15">15</xref>] on the Affymetrix SpikeIn datasets, where nominal concentrations are given for a number of genes which were "spiked in" in a Latin square experimental design. This is now an aggregate comparison, in which all defect types detected by <italic>Harshlight </italic>are excised, and the overall effect on the statistical performance of the summarization algorithm is quantified by means of Return Operator Curves (ROC). We performed this analysis for the most recent dataset, SpikeIn133, and again we compared the performance of MAS5 and GCRMA. We modified the MAS5 implementation in <italic>Bioconductor </italic>so that it accepts missing values, and compared our two substitution strategies, missing values vs. neutral replacement (i.e., substitution with the median of the other chips' values for that probe). As GCRMA is not as easily modified to allow for missing data, we could only use median substitution with GCRMA. Figure <xref ref-type="fig" rid="F9">9</xref> shows the ROC curves summarizing the false positive/true positive behavior of the algorithm. In all cases, preprocessing the SpikeIn133 dataset with <italic>Harshlight </italic>results in a significant increase of performance of the algorithm, which is actually quite substantial for the case of MAS5, where &gt;5% extra true positives are found at large false positive numbers, for both substitution methods.</p>
    <fig position="float" id="F9">
      <label>Figure 9</label>
      <caption>
        <p><bold>Receiver Operator Curves generated by the <italic>AffyComp </italic>suite for the SpikeIn133 dataset at 2-fold changes</bold>. A. The MAS5 algorithm shows noticeable improvement when <italic>Harshlight </italic>is used to excise blemishes, both for missing value substitutions as well as for median substitution: approximately 2 extra true positives per chip are discovered. B. The GCRMA algorithm shows a slight improvement of about 0.5 extra true positives per chip under median substitution.</p>
      </caption>
      <graphic xlink:href="1471-2105-6-294-9"/>
    </fig>
    <p>In earlier chips the probesets were laid contiguously in space, so it was possible to detect localized defects by observing that the probeset had an "outlier" pattern [<xref ref-type="bibr" rid="B16">16</xref>]. However, the entire probeset would have to be discarded, and the gene expression information would be lost. Correlated location in space precludes use of <italic>Harshlight </italic>on those earlier chips (e.g., HUGeneFL). The random allocation of probe pairs in newer generations of chips permits robust methods like GCRMA to partly resist damage by blemishes; and, in conjunction with a method like <italic>Harshlight</italic>, to restore the expression values for many affected genes.</p>
    <p>While we have developed this method on the basis of our error image detection of outliers, in principle the residuals of any model such as [<xref ref-type="bibr" rid="B16">16</xref>] or GCRMA could be used to identify individual probes on a chip as outliers. To facilitate the integration of various methods, <italic>Harshlight </italic>accepts error images generated by other programs; if none are provided, then the error images are computed. We have, however, not yet explored the appropriate null hypothesis for these methods.</p>
  </sec>
  <sec>
    <title>Conclusion</title>
    <p>We have presented an R package that provides a way to automatically "harshlight" artifacts on the surface of HDONA microarray chips. The algorithm is based on statistical and image processing approaches in order to safely identify blemishes of different nature and correct the intensity values of the batch of chips provided by the user. The corrections made by <italic>Harshlight </italic>improve the reliability of the expression values when the chips are further analyzed with other programs, such as GCRMA and MAS5.</p>
    <p>It has been shown that microarray results are affected if blemished chips enter the pipeline of the analysis; blemished probes may have values differing from the correct value by much more than the typical error, so blemishes are expected to have a particularly strong impact on experiments trying to discriminate subtle differences between samples or in a clinical diagnosis context. We present <italic>Harshlight </italic>in the hope it shall be a useful tool in quality assessment of microarray chips and will help improve microarray analysis.</p>
  </sec>
  <sec>
    <title>Availability and requirements</title>
    <p>• <bold>Project name: </bold>Harshlight</p>
    <p>• <bold>Project home page: </bold><ext-link ext-link-type="uri" xlink:href="http://asterion.rockefeller.edu/Harshlight"/></p>
    <p>• <bold>Operating system(s): </bold>Platform independent, tested upon Red Hat Linux and is being under testing on Windows XP systems</p>
    <p>• <bold>Programming language: </bold>R, C</p>
    <p>• <bold>Other requirements: </bold>R 1.8.0 or higher</p>
    <p>• <bold>License: </bold>GNU, GPL</p>
    <p>• <bold>Any restrictions to use by non-academics: </bold>license needed</p>
  </sec>
  <sec>
    <title>Authors' contributions</title>
    <p>MSF developed the method, designed and carried out the statistical analysis, and drafted the manuscript. MP wrote and implemented the algorithm, and helped to draft the manuscript. KMW developed the method and participated in the design of the statistical approach. MOM conceived and coordinated the study, participated in its design, and helped to draft the manuscript. All authors read and approved the final manuscript.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="S1">
      <caption>
        <title>Additional File 1</title>
        <p>SIprobecomposition. nucleotide composition analysis of unblemished and blemished probes.</p>
      </caption>
      <media xlink:href="1471-2105-6-294-S1.pdf" mimetype="application" mime-subtype="pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="S2">
      <caption>
        <title>Additional File 2</title>
        <p>Harshlight R package for Linux</p>
      </caption>
      <media xlink:href="1471-2105-6-294-S2.gz" mimetype="application" mime-subtype="x-zip-compressed">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <sec>
      <title>Acknowledgements</title>
      <p>M.S.F. acknowledges a Woman in Science fellowship from RU. K.M.W. was supported in part by GCRC grant M01-RR00102 from the National Center for Research Resources at the NIH. We would like to thank Steffen Bohn for helpful comments and discussion.</p>
    </sec>
  </ack>
  <ref-list>
    <ref id="B1">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ihaka</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>R: A language for data analysis and graphics</article-title>
        <source>Journal of Computational and Graphical Statistics</source>
        <year>1996</year>
        <volume>5</volume>
        <fpage>299</fpage>
        <lpage>314</lpage>
      </citation>
    </ref>
    <ref id="B2">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Parmigiani</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Garrett</surname>
            <given-names>ES</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Zeger</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Dietz K, Gail M, Krickeberg K, Samet J, Tsianis A</surname>
          </name>
        </person-group>
        <article-title>The analysis of gene expression data: methods and software</article-title>
        <source>Statistics for biology and health</source>
        <year>2003</year>
        <publisher-name>New York , Springer</publisher-name>
        <fpage>455</fpage>
      </citation>
    </ref>
    <ref id="B3">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Affymetrix</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>GeneChip Expression Analysis: Data Analysis Fundamentals</article-title>
        <year>2004</year>
      </citation>
    </ref>
    <ref id="B4">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suárez-Fariñas</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Haider</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wittkowski</surname>
            <given-names>KM</given-names>
          </name>
        </person-group>
        <article-title>"Harshlighting" small blemishes on microarrays</article-title>
        <source>BMC BIOINFORMATICS</source>
        <year>2005</year>
        <volume>6:65</volume>
      </citation>
    </ref>
    <ref id="B5">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Naef</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Magnasco</surname>
            <given-names>MO</given-names>
          </name>
        </person-group>
        <article-title>Solving the riddle of the bright mismatches: labeling and effective binding in oligonucleotide arrays</article-title>
        <source>Phys Rev E Stat Nonlin Soft Matter Phys</source>
        <year>2003</year>
        <volume>68</volume>
        <fpage>011906. Epub 2003 Jul 16.</fpage>
        <pub-id pub-id-type="pmid">12935175</pub-id>
      </citation>
    </ref>
    <ref id="B6">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <collab>AffyWebdata</collab>
        </person-group>
        <article-title>Affymetrix website</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://www.affymetrix.com/support/technical/sample_data/datasets.affx"/>
      </citation>
    </ref>
    <ref id="B7">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Suárez-Fariñas</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Noggle</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Heke</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hemmati-Brivanlou</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Magnasco</surname>
            <given-names>MO</given-names>
          </name>
        </person-group>
        <article-title>How to compare microarray studies: The case of human embryonic stem cells
</article-title>
        <source>Submmitted</source>
        <year>2005</year>
      </citation>
    </ref>
    <ref id="B8">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wittkowski</surname>
            <given-names>KM</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Nussbaum</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Chamian</surname>
            <given-names>FN</given-names>
          </name>
          <name>
            <surname>Krueger</surname>
            <given-names>JG</given-names>
          </name>
        </person-group>
        <article-title>Combining several ordinal measures in clinical studies</article-title>
        <source>Stat Med</source>
        <year>2004</year>
        <volume>23</volume>
        <fpage>1579</fpage>
        <lpage>1592</lpage>
        <pub-id pub-id-type="pmid">15122738</pub-id>
        <pub-id pub-id-type="doi">10.1002/sim.1778</pub-id>
      </citation>
    </ref>
    <ref id="B9">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Bolstad</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Ben Bolstad website</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://stat-www.berkeley.edu/users/bolstad/PLMImageGallery"/>
      </citation>
    </ref>
    <ref id="B10">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Russ</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <source>The Image Processing Handbook</source>
        <year>2002</year>
        <edition>4th edition (July 2002)</edition>
        <publisher-name>Boca Raton , CRC Press</publisher-name>
      </citation>
    </ref>
    <ref id="B11">
      <citation citation-type="book">
        <person-group person-group-type="author">
          <collab>Thomas H. Cormen</collab>
          <name>
            <surname>Leiserson</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Rivest</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Stein</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <source>Introduction to Algorithms</source>
        <year>2001</year>
        <edition>2nd edition</edition>
        <publisher-name>Boston , The MIT Press</publisher-name>
      </citation>
    </ref>
    <ref id="B12">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Warren</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Spencer</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Biswal</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Frank</surname>
            <given-names>BC</given-names>
          </name>
        </person-group>
        <article-title>Multiple Lab Comparisons of Microarray Platforms</article-title>
        <source>Dept of Biostatistics Working Papers, Johns Hopkins University</source>
        <year>2004</year>
      </citation>
    </ref>
    <ref id="B13">
      <citation citation-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>website</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Harshlight website</article-title>
        <ext-link ext-link-type="uri" xlink:href="http://asterion.rockefeller.edu/Harshlight"/>
      </citation>
    </ref>
    <ref id="B14">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Martinez Murillo</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Spencer</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>A Model Based Background Adjustement for Oligonucleotide Expression Arrays</article-title>
        <source>Journal of American Statistical Association</source>
        <year>2004</year>
        <volume>99</volume>
        <fpage>909</fpage>
        <lpage>917</lpage>
        <pub-id pub-id-type="doi">10.1198/016214504000000683</pub-id>
      </citation>
    </ref>
    <ref id="B15">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cope</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Jaffee</surname>
            <given-names>HA</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>ZJ</given-names>
          </name>
          <name>
            <surname>Speed</surname>
            <given-names>TP</given-names>
          </name>
        </person-group>
        <article-title>A benchmark for affymetrix GeneChip expression measures</article-title>
        <source>BIOINFORMATICS</source>
        <year>2004</year>
        <volume>20</volume>
        <fpage>323</fpage>
        <lpage>331</lpage>
        <pub-id pub-id-type="pmid">14960458</pub-id>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btg410</pub-id>
      </citation>
    </ref>
    <ref id="B16">
      <citation citation-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>WH</given-names>
          </name>
        </person-group>
        <article-title>Model-based analysis of oligonucleotide arrays: Expression index computation and outlier detection</article-title>
        <source>P NATL ACAD SCI USA P NATL ACAD SCI USA</source>
        <year>2001</year>
        <volume>98</volume>
        <fpage>31</fpage>
        <lpage>36</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.011404098</pub-id>
      </citation>
    </ref>
  </ref-list>
</back>
