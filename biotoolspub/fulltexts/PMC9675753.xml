<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Sci Rep</journal-id>
    <journal-id journal-id-type="iso-abbrev">Sci Rep</journal-id>
    <journal-title-group>
      <journal-title>Scientific Reports</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2045-2322</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9675753</article-id>
    <article-id pub-id-type="publisher-id">24139</article-id>
    <article-id pub-id-type="doi">10.1038/s41598-022-24139-z</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Artificial intelligence workflow quantifying muscle features on Hematoxylin–Eosin stained sections reveals dystrophic phenotype amelioration upon treatment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Reinbigler</surname>
          <given-names>Marie</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Cosette</surname>
          <given-names>Jérémie</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Guesmia</surname>
          <given-names>Zoheir</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jimenez</surname>
          <given-names>Simon</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Fetita</surname>
          <given-names>Catalin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Brunet</surname>
          <given-names>Elisabeth</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <name>
          <surname>Stockholm</surname>
          <given-names>Daniel</given-names>
        </name>
        <address>
          <email>stockho@genethon.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.508893.f</institution-id><institution>Télécom SudParis, Institut Polytechnique de Paris, </institution></institution-wrap>91120 Palaiseau, France </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.419946.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 0641 2700</institution-id><institution>Généthon, </institution></institution-wrap>91000 Evry, France </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.418250.a</institution-id><institution-id institution-id-type="ISNI">0000 0001 0308 8843</institution-id><institution>Centre de Recherche en Myologie, UMR-S 974, Institut de Myologie, </institution></institution-wrap>75000 Paris, France </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.424469.9</institution-id><institution-id institution-id-type="ISNI">0000 0001 2195 5365</institution-id><institution>École Pratique des Hautes Études, PSL University, </institution></institution-wrap>75000 Paris, France </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>19</day>
      <month>11</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>19</day>
      <month>11</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>12</volume>
    <elocation-id>19913</elocation-id>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>11</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Cell segmentation is a key step for a wide variety of biological investigations, especially in the context of muscle science. Currently, automated methods still struggle to perform skeletal muscle fiber quantification on Hematoxylin-Eosin (HE) stained histopathological whole slide images due to low contrast. On the other hand, the Deep Learning algorithm Cellpose offers new perspectives considering its increasing adoption for segmentation of a wide range of cells. Combining two open-source tools, Cellpose and QuPath, we developed MyoSOTHES, an automated Myofibers Segmentation wOrkflow Tuned for HE Staining. MyoSOTHES enables solving segmentation inconsistencies encountered by default Cellpose model in presence of large range size cells and provides information related to muscle Feret’s diameter distribution and Centrally Nucleated Fibers, thus depicting muscle health and treatment effects. MyoSOTHES achieves high quality segmentation compared to baseline workflow with a detection F1-score increasing from 0.801 to 0.919 and a Root Mean Square Error (RMSE) on diameter improved by 31%. MyoSOTHES was validated on an animal study featuring gene transfer in <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M2"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq1.gif"/></alternatives></inline-formula>-Sarcoglycanopathy, for which dose-response effect is visible and conclusions drawn are consistent with those previously published. MyoSOTHES thus paves the way for wide quantification of HE stained muscle sections and retrospective analysis of HE labeled slices used in laboratories for decades.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational science</kwd>
      <kwd>Diagnostic markers</kwd>
      <kwd>Image processing</kwd>
      <kwd>Machine learning</kwd>
      <kwd>Gene therapy</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Hi! PARIS Center</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par2">Muscular dystrophies are a group of genetic diseases in which the impairment or the absence of muscle proteins can lead to severe phenotype causing muscle cell death, often associated with a loss of muscle function. Muscular dystrophies also share, at various degrees, histological patterns at cellular scale. In particular, those pathologies imply a process of degeneration and regeneration of muscle fibers, that can be quantified by measuring fibers size and the Centrally Nucleated Fibers (CNF) ratio in muscle sections<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR4">4</xref></sup>. Such parameters are crucial not only for characterizing muscle dystrophy progression but also for establishing and evaluating therapeutic approaches. Those measurements have been widely carried out on immunofluorescent labeled sections because of their high contrasts, making those images suitable for segmentation by former image processing tools<sup><xref ref-type="bibr" rid="CR5">5</xref>–<xref ref-type="bibr" rid="CR12">12</xref></sup>.</p>
    <p id="Par3">Artificial intelligence greatly opens up perspectives. Beyond enhancing the exploitation of immunofluorescent labeled muscle sections, it now enables to process less contrasted standard Hematoxylin-Eosin (HE) stained sections, that is an omnipresent, easy-to-use and inexpensive labeling protocol, on future studies and on the huge unexploited archived studies banks because of manpower lack. In this paper, we present MyoSOTHES, standing for Myofibers Segmentation wOrkflow Tuned for HE Staining. MyoSOTHES is a generalist workflow tuned to quantify dystrophic markers, i.e. fiber size and CNF ratio on HE stained histology sections. For this purpose, after data preconditioning, muscle sections are segmented thanks to the state-of-the-art deep learning algorithm Cellpose<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, prior to be quantified using the QuPath bioimage analysis tool<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>.</p>
    <p id="Par4">MyoSOTHES muscle-tuned workflow precision was evaluated on a manually determined ground truth for which the F1-score is enhanced from 0.801 obtained with the generalist baseline workflow to 0.919 and the Root Mean Square Error (RMSE) on diameter is 31% lower than the best performing <italic>default</italic> model configuration. Moreover, for the sake of wide usage, the computational consumption of MyoSOTHES has been taken into consideration in terms of memory footprint and execution time. MyoSOTHES does not require more than 2 GB of memory, i.e. 2 GB of RAM (Random Access Memory) in Central Processing Unit (CPU) mode only and 2 GB of Graphics Processing Unit (GPU) memory with the combination of CPU and GPU modes. On desktop machines, it remains executable in average measured computation time of about 14 min 44 s and in 4 min 55 s on machine equipped with GPU to analyze muscle section images being on average 120MB each.</p>
    <p id="Par5">We also validated MyoSOTHES on a cohort of whole slide images (WSI) of HE stained psoas sections (muscle of pelvic belt) from mice suffering from <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M4"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq2.gif"/></alternatives></inline-formula>-Sarcoglycanopathy, and treated with different doses of gene therapy vectors. We showed that our analysis reveals the dose-effect and is consistent with the previous study conclusions<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>.</p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <p id="Par6">To conduct HE stained muscle histological image analysis, we built a baseline workflow based on two main tools: Cellpose<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, which is a generalist deep-learning algorithm for cellular segmentation, and QuPath, a visualization and analysis tool for histological images. As depicted in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S1</xref>, this baseline workflow consists in three stages. To get started, WSI can be easily visualized and selected in QuPath for analysis. They are then exported via QuPath in TIFF format, compatible with the next workflow stage. Once in TIFF format, WSI are segmented using Cellpose. Output of this stage are PNG images of masks corresponding to each cell detected in the input image. As a last step, the set of predicted masks are imported into QuPath as regions of interest, which are superimposed on corresponding section for further analysis and are processed to perform quantitative analysis. In muscle distrophy context, we target to measure phenotype parameters as the fiber Feret’s diameter distribution and CNF ratio estimation using nuclei detection plugin of QuPath.</p>
    <p id="Par7">To evaluate the reliability of the segmentation stage and finally of the overall workflow results, the segmentation detection quality is quantified by measuring the F1-score, as described in Section “<xref rid="Sec11" ref-type="sec">Methods</xref>” and depicted in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S2</xref>, by superimposing ground truth hand-made segmented images and Cellpose masks predicted on those same images. Similarly, the segmentation quality has been verified by comparing predicted mask diameter and corresponding hand-made mask diameter measuring RMSE, as referred in Section “<xref rid="Sec11" ref-type="sec">Methods</xref>”.</p>
    <p id="Par8">With a F1-score of 0.801 (see Fig. <xref rid="Fig1" ref-type="fig">1</xref>A), this baseline workflow leaves room for optimizations to reach the muscle-tuned MyoSOTHES. In this respect, we can act at several levels: before computing Cellpose segmentation by introducing a pre-processing step; at Cellpose level, by acting on its parameters and configuration; and after Cellpose segmentation, by selecting relevant produced masks. The incremental optimization strategies we explored to tune this baseline workflow in order to reach the muscle-tuned MyoSOTHES are presented hereafter.</p>
    <sec id="Sec3">
      <title>Cellpose parameters tuning</title>
      <p id="Par9">Cellpose<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> is an algorithm composed of two main building blocks. The first block is a deep learning algorithm, whose architecture is derived from the widespread U-net architecture<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. Its model has been trained as following: each ground truth cell has been intermediately represented by the topology map of a heating diffusion source starting from the center of the mask. This topological map includes horizontal and vertical gradients. Those gradients, together with the probability to belong to a cell, are the model’s predicted outputs. The second building block consists in combining horizontal and vertical gradients. The direction of the gradient is followed towards the central point common to other pixel gradients whose pixel probability to belong to a cell was predicted higher than 0.5. All pixels whose pixel gradient points to the same center constitute one cell mask. The output recovered is a PNG image where pixels belonging to the same cell mask have the same value.</p>
      <p id="Par10">In this work, Cellpose<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> is used as a black box that enables our workflow to segment the WSI. The only parameters we can control are the image color channel, initially selected to be the red one, and the estimated cell diameter, initially equal to 35 pixels. Therefore, we explored different sets of parameters by varying both the image channel and the cell diameter. To discriminate between best detecting model, we measured the diameter RMSE with respect to the ground truth to keep the model with both best quality and detection ability. As summarized in Table <xref rid="Tab1" ref-type="table">1</xref>, the best configuration turns out to be the blue channel together with a cell diameter of 45 pixels which led to a F1-score improvement from 0.801 to 0.856 for a RMSE estimated to 4.27 <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M6"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq3.gif"/></alternatives></inline-formula>m.</p>
    </sec>
    <sec id="Sec4">
      <title>Cellpose specialization</title>
      <p id="Par11">As we can see in Fig. <xref rid="Fig1" ref-type="fig">1</xref>A,B, the segmentation obtained is accurate in healthy areas where muscle fibers have well delimited and regular shapes, whereas segmentation quality drops in inflammatory areas (green arrows), in areas with a high heterogeneity in fiber size and with elongated cells (orange arrows). To address this problem, we took advantage of Cellpose 2.0<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> new feature that enables to retrain Cellpose ground model using fine-tuning techniques to specialize it to our specific dystrophic muscle dataset. The retraining was performed on nine patches extracted from our dataset with as largest diversity as possible on blue channel, as it revealed to be the most effective according to Table <xref rid="Tab1" ref-type="table">1</xref>. During the retraining process (refer to Section “<xref rid="Sec11" ref-type="sec">Methods</xref>”), there were always a trade-off to make between large cell segmentation and small fibers segmentation. Once a trade-off seemed reached for training patches, the retraining is stopped. The model was then tested on a whole slide image not used for retraining at highest resolution with input cell diameter of 45 pixels. Note that, interestingly, despite good segmentation performance of fine-tuned model achieved at patch-level during training in comparison to baseline model with previously selected set of parameters, the F1-score reached for whole slide image is 0.821, which is lower than the <italic>default</italic> model with blue channel and 45 pixels cell diameter setting. Indeed, Fig. <xref rid="Fig1" ref-type="fig">1</xref>A–C shows that the <italic>retrained</italic> model misses a lot of well delimited fibers, including areas where it performs well at patch-level. To alleviate this problem, we propose to explore the overwriting of Cellpose tiling strategy by adding an image tiling pre-processing step and a WSI segmentation reconstruction post-processing step. The efficiency of this optimization strategy will be assessed in comparison to the use of this same retrained model using only Cellpose internal tiling strategy.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Optimization of cellpose <italic>default</italic> model input parameters.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2"/><th align="left" colspan="4">Set of parameters (diameter, channel)</th></tr><tr><th align="left">(50, red)</th><th align="left">(45, blue)</th><th align="left">(60, green)</th><th align="left">(50, gray)</th></tr></thead><tbody><tr><td align="left">RMSE (<inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M8"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq4.gif"/></alternatives></inline-formula>m)</td><td align="left">4.45</td><td align="left">4.27</td><td align="left">4.35</td><td align="left">4.66</td></tr></tbody></table><table-wrap-foot><p>The RMSE of diameters with respect to the ground truth for <italic>default</italic> model is measured for models with a set of parameters leading to the best detection ability for each channel. The selected configuration is the combination of diameter 45 and blue channel.</p></table-wrap-foot></table-wrap><table-wrap id="Tab2"><label>Table 2</label><caption><p>Optimization of <italic>retrained</italic> model input parameters using tiling strategy.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2">Diameter (<inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M10"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq5.gif"/></alternatives></inline-formula>m)</th><th align="left" colspan="4">Channel</th></tr><tr><th align="left">Red</th><th align="left">Blue</th><th align="left">Green</th><th align="left">Gray</th></tr></thead><tbody><tr><td align="left" colspan="5"><bold>F1-score</bold></td></tr><tr><td align="left">30</td><td align="left">0.827</td><td align="left">0.832</td><td align="left">0.828</td><td align="left">0.844</td></tr><tr><td align="left">35</td><td align="left">0.881</td><td align="left">0.882</td><td align="left">0.879</td><td align="left">0.895</td></tr><tr><td align="left">40</td><td align="left">0.891</td><td align="left">0.908</td><td align="left">0.895</td><td align="left">0.908</td></tr><tr><td align="left">45</td><td align="left">0.899</td><td align="left">0.915</td><td align="left">0.910</td><td align="left">0.908</td></tr><tr><td align="left">50</td><td align="left">0.893</td><td align="left"><bold>0.919</bold></td><td align="left">0.914</td><td align="left">0.900</td></tr><tr><td align="left">55</td><td align="left">0.900</td><td align="left">0.912</td><td align="left">0.910</td><td align="left">0.909</td></tr><tr><td align="left">60</td><td align="left">0.896</td><td align="left">0.910</td><td align="left">0.903</td><td align="left">0.905</td></tr></tbody></table><table-wrap-foot><p>The cell diameters are varied together with channel color. The F1-score is measured for each configuration to identify the best set of parameters, highlighted in bold. Finally, a diameter of 50 pixels is selected with a channel set to blue.</p></table-wrap-foot></table-wrap></p>
      <p id="Par12">
        <fig id="Fig1">
          <label>Figure 1</label>
          <caption>
            <p>Representative results of segmentation using the different workflow advances. (<bold>A</bold>) The <italic>default</italic> model with the initial parameters gives a 0.801 F1-score. (<bold>B</bold>) The <italic>default</italic> model with tuned parameters has an increased F1-score of 0.856. (<bold>C</bold>) The <italic>retrained</italic> model has promising results in the areas where the muscle is highly damaged (green arrows), but has an unsatisfactory 0.821 F1-score, mainly due to misdetection of large fibers (orange arrows). (<bold>D</bold>) The <italic>retrained</italic> model coupled with tiling of images reaches a F1-score of 0.919, by keeping satisfactory detection in damaged area, and restoring detection of large fibers.</p>
          </caption>
          <graphic xlink:href="41598_2022_24139_Fig1_HTML" id="MO1"/>
        </fig>
      </p>
    </sec>
    <sec id="Sec5">
      <title>Segmentation pre-processing: image tiling</title>
      <p id="Par13">The segmentation by image tiling is a three-step process, which starts before applying Cellpose. The first phase consists in dividing the WSI into tiles and to analyze only those belonging to tissue bounding boxes in order to limit computation time. For now, areas containing relevant tissue are detected using a QuPath thresholder. Once this area is delimited, it is divided into patches of 712 <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\times$$\end{document}</tex-math><mml:math id="M12"><mml:mo>×</mml:mo></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq6.gif"/></alternatives></inline-formula> 712 pixels with an overlap with neighbour patches of 200 pixels to ensure no fiber mask is cut by both overlapping patch limits (see Supplementary Fig. <xref rid="MOESM1" ref-type="media">S3</xref>). Then, each tile is individually segmented by Cellpose, using the <italic>retrained</italic> model with same parameters. Once the individual tile masks obtained, the whole WSI masks are reconstructed, as described in Section “<xref rid="Sec11" ref-type="sec">Methods</xref>” and illustrated on Supplementary Fig. <xref rid="MOESM1" ref-type="media">S4</xref>.</p>
      <p id="Par14">The tiling phase enabled to enhance the F1-score from 0.821 to 0.915. To achieve the best F1-score possible using tiling strategy, the choice of the most adapted cell diameter for <italic>retrained</italic> model was evaluated using same method as for the <italic>default</italic> model and revealed to be 50 pixels coupled with blue channel (see Table <xref rid="Tab2" ref-type="table">2</xref>). This choice of cell diameter enabled to reach a F1-score of 0.919. The improvement introduced by tiling with most adapted cell diameter is clearly visible on Fig. <xref rid="Fig1" ref-type="fig">1</xref>D. Areas with regular fiber size and shapes are as well segmented while in inflammatory and heterogeneous areas, small fibers are more often detected. In addition to a detection improvement, it turns out retraining enabled to also improve segmentation quality as RMSE decreased from 4.27 <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M14"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq7.gif"/></alternatives></inline-formula>m for selected <italic>default</italic> model to 2.94 <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M16"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq8.gif"/></alternatives></inline-formula>m, meaning a 31% improvement.</p>
      <p id="Par15">All F1-score and RMSE measurements have been performed considering an Intersection over Union (IoU) threshold higher than 0.5 as commonly used in famous segmentation challenges such as the Coco Challenge<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> or the Voc Challenge<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. To ensure our good results do not come solely from a low IoU threshold, the influence of IoU threshold on F1-score and diameter RMSE was further investigated. Figure <xref rid="Fig2" ref-type="fig">2</xref> indicates that starting an IoU threshold higher than 0.71, the F1-score drops until reaching a value close to 0. In parallel, the RMSE is getting improved from about one third. By looking at the histogram, such degradation in detection ability introduces a bias in the cell population considered for analysis as diversity of cell diameter available decreases with the threshold increasing. Indeed, on test set, the number of fiber diameter classes of a range of 5 <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M18"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq9.gif"/></alternatives></inline-formula>m is 12 with an IoU of 0.71, whereas there are only 7 left with an IoU threshold of 0.91, with the removal of smallest and largest diameters, as underlined by Fig. <xref rid="Fig3" ref-type="fig">3</xref>. For IoU threshold from 0.51 to 0.71, the RMSE remains quite stable, with a degradation of 1.4%, representing 0.04 <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M20"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq10.gif"/></alternatives></inline-formula>m of difference, which is negligible in comparison to the microscope error estimated to 1 <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M22"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq11.gif"/></alternatives></inline-formula>m. On the other hand, the F1-score gets degraded by 4.3%. Consequently, selecting a IoU threshold of 0.51 enables to keep a high detection capacity, thus avoiding biasing the considered cell population, while only slightly degrading the RMSE. Following these observations, an IoU threshold of 0.51 is the one used for every other measurements and analysis performed in this paper.<fig id="Fig2"><label>Figure 2</label><caption><p>Evaluation of IoU threshold impact on F1-score, meaning model detection ability, and diameter RMSE in <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M24"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq12.gif"/></alternatives></inline-formula>m, indicative of model segmentation quality. Increasing the IoU from 0.51 to 0.71 introduces a negligible impact on detection capability of the algorithm. Similarly, an increased IoU from 0.51 to 0.81 introduces a small impact on segmentation quality. From 0.76 threshold, the F1-score decreases quickly until reaching almost 0 for an IoU higher than 0.91. From 0.86 threshold, the RMSE reduces significantly of about 30%.</p></caption><graphic xlink:href="41598_2022_24139_Fig2_HTML" id="MO2"/></fig><fig id="Fig3"><label>Figure 3</label><caption><p>Impact of IoU threshold on fiber diameters class retained. From IoU higher than 0.71, the distribution is biased: the largest and smallest fibers tend to be rejected.</p></caption><graphic xlink:href="41598_2022_24139_Fig3_HTML" id="MO3"/></fig></p>
    </sec>
    <sec id="Sec6">
      <title>Segmentation post-processing: artifacts filtering</title>
      <p id="Par16">The Cellpose output can be improved by applying a filter removing segmentation artifacts, that are the masks which do not correspond to cells. Indeed, as Cellpose consists in computing pixel gradients and reconstructing cell masks based on gradient direction convergence, it cannot differentiate between cell borders and artifact borders. Two categories of artifacts can be encountered. Some artifacts take their origin in histology processing. They can be tears in the section coming from the cutting phase, black spots corresponding to dust or bubbles. Examples are referred in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S5</xref>. The second category of artifacts corresponds to any biological element present in the muscle section that does not correspond to muscle fiber. For example, artifacts could be blood vessels, lymphatic vessels or connective tissue. In this case, there is no common shape characteristics between all those artifacts, however they differentiate from cells by their colors. Thus, a pixel classifier based on a Random Forest algorithm<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, has been built using parameters listed in Section “<xref rid="Sec11" ref-type="sec">Methods</xref>”. This ensures that the biological parameters to be measured based on segmentation will be only influenced by the fibers characteristics.</p>
    </sec>
    <sec id="Sec7">
      <title>MyoSOTHES: resulting workflow</title>
      <p id="Par17">Based on segmentation quality estimation measure detailed in Section “<xref rid="Sec11" ref-type="sec">Methods</xref>”, the configuration selected is the <italic>retrained</italic> model with an input cell diameter of 50 pixels, preceded by a tiling step, followed by a mask filter of type ‘pixel classifier’ as this configuration is the one reaching highest F1-score, low RMSE and also performing the best according to visual verification. Indeed, the <italic>retrained</italic> model has the advantage to not introduce segmentation noise, to detect less nucleus masks in inflammatory areas, and to segment less artifacts. The tuned workflow MyoSOTHES is summed up in Fig. <xref rid="Fig4" ref-type="fig">4</xref>.<fig id="Fig4"><label>Figure 4</label><caption><p>MyoSOTHES overview. After applying a pixel classifier to detect tissue edge, input WSI is tiled, and each tile is processed with Cellpose (retrained model—blue channel—50 pixels diameter). A Python custom script is then applied to the Cellpose output masks to reconstruct the total mask image of the tissue section. A final pixel classifier is then used to remove the masks corresponding to artifacts areas (fold, bubbles, dust, etc.). The masks are used to measure the fibers Feret’s diameter, and estimate the error based on ground truth manual segmentation. Segmentation masks are also combined with the position of nuclei to identify centrally nucleated fibers and measure the CNF ratio.</p></caption><graphic xlink:href="41598_2022_24139_Fig4_HTML" id="MO4"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>Computation performance assessment</title>
      <p id="Par18">We measured Cellpose computation time for two models: the <italic>default</italic> model which corresponds to the initial Cellpose 1.0 model with as input selected parameters the red channel and a cell diameter of 35 pixels—but without any retraining and tiling; and the <italic>retrained</italic> model which corresponds to the Cellpose 2.0 model retrained on our data with tiling and selected parameters as previously described.</p>
      <p id="Par19">Computation performance assessment has been conducted on three different platforms. The first computing platform, further referred to as M1-CPU, is composed of an Intel Core i7-10710U 1.10GHz processor, with 6 cores and 32 GB of RAM. The second computing platform, further referred to as M2-CPU, is equipped with an Intel Core i5-8400 2.80GHz processor with 6 cores and 32 GB of RAM. The third platform, further referred to as M3-GPU, is composed of 2 AMD EPYC 7502 2.5GHz processors with 32 cores and 512 GB de RAM and a Nvidia Quadro RTX 5000 GPU with 16 GB of memory.</p>
      <p id="Par20">For the ‘default’ version, we measured the mean Cellpose execution time over all WSIs of the dataset, each computed five times on each platform. For the ‘retrained’ tiled version, we summed the computation time of each tile to get the computation time of a WSI. As for the ‘default’ version, we averaged the computation time of all dataset WSIs of five iterations done on each platform. For sake of precision, each WSI is in average 120 MB.</p>
      <p id="Par21">The summary of results obtained is available in Fig. <xref rid="Fig5" ref-type="fig">5</xref>. Running only on CPU, whether on M1-CPU or M2-CPU, the average computation time is about 20 min per WSI for the <italic>default</italic> model and about 15 min with the <italic>retrained</italic> one. On M3-GPU machine, the average mean computation time per WSI is 5 min and 45 s for the <italic>default</italic> model, meaning four times faster than running on CPU; and of 4 min and 55 s for <italic>retrained</italic> model using tiling strategy, meaning about one third of CPU-only mode computation time. This highlights the temporal benefit introduced by using a GPU. It is also remarkable that the mean computation time per WSI remains stable for the five runs.</p>
      <p id="Par22">During our experiments, we also noted the high computation footprint of the <italic>default</italic> model workflow. Indeed, it requires at least 32 GB of RAM and 16 GB of GPU memory to execute Cellpose in CPU-mode and GPU-CPU-mode respectively for the non tiled version. On the other hand, the memory impact is drastically lowered using tiling strategy as only 2 GB of memory are now required, both for CPU and CPU-GPU modes. In addition, tiling enabled reducing computation time, especially for CPU-only executions where it has been reduced of one-third.<fig id="Fig5"><label>Figure 5</label><caption><p>Segmentation computation time using different hardware configurations. M1-CPU designates a machine composed of an Intel Core i7-10710U 1.10GHz processor, with 6 cores and 32GB of RAM. M2-CPU is equipped with an Intel Core i5-8400 2.80GHz processor with 6 cores and 32GB of RAM. M3-GPU is composed of 2 AMD EPYC 7502 2.5GHz processors with 32 cores and 512 GB de RAM and a Nvidia Quadro RTX 5000 GPU with 16 GB of memory.</p></caption><graphic xlink:href="41598_2022_24139_Fig5_HTML" id="MO5"/></fig></p>
    </sec>
    <sec id="Sec9">
      <title>MyoSOTHES validation on a dystrophic muscle treatment study</title>
      <p id="Par23">MyoSOTHES was applied to 50 WSIs of psoas sections of 50 mice captured in the biological use-case of the study on <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M26"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq13.gif"/></alternatives></inline-formula>-Sarcoglycanopathy published in 2018<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. The WSIs are classified in 5 categories: 10 WSIs corresponds to Wild Type (WT) subjects, 10 to Knockout (KO) subjects, 10 received the highest treatment dose, 10 the intermediate dose, and 10 the lowest dose. Based on resulting segmentation, we expect to detect the dose-response effect on muscle phenotype using CNF ratio and Feret’s diameter as phenotype indicators.</p>
      <p id="Par24">The analysis of Fig. <xref rid="Fig6" ref-type="fig">6</xref>A highlights the phenotype difference between WT subjects and KO subjects: the CNF ratio of the KO subjects is significantly higher, as a healthy muscle fiber has its nuclei located at its periphery. A high CNF ratio is thus a good indicator of anomaly, characteristic of myopathies<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. The effect of the dose injected is also visible, as the higher the dose, the lower the CNF ratio. The dose-response effect is also visible on Feret’s diameters diagram on Fig. <xref rid="Fig6" ref-type="fig">6</xref>B). The mean Feret’s diameter of the WT and KO subjects are significantly different with a higher diameter for healthy subjects. The mean Feret’s diameter of highest dose is close to the WT one and significantly higher than the KO one. Lowest and intermediate dose groups are not statistically different from KO group, but intermediate dose seems to show small improvement, while being missing for lowest dose.</p>
      <p id="Par25">
        <fig id="Fig6">
          <label>Figure 6</label>
          <caption>
            <p>Quantification of fibers diameters, variation coefficients and CNF ratio for 50 WSI of psoas sections. Box plot (including overlaid individual dots, each corresponding to one mouse) of CNF ratio (<bold>A</bold>) p-value = <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$6\times 10^{-4}$$\end{document}</tex-math><mml:math id="M28"><mml:mrow><mml:mn>6</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq14.gif"/></alternatives></inline-formula>, mean minimal Feret’s diameters (<bold>B</bold>) p-value = <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1 \times 10^{-4}$$\end{document}</tex-math><mml:math id="M30"><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq15.gif"/></alternatives></inline-formula>, and variance coefficient (<bold>C</bold>) p-value &lt; <inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1\times 10^{-4}$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq16.gif"/></alternatives></inline-formula>, for each treatment condition. Statistic test one-way ANOVA—with Bartlett’s test for variance equality and Bonferroni’s multiple comparison post test. As expected, wild type mice have very few centrally nucleated fibers. However, the highest dose condition has a significantly lower CNF ratio than the KO condition. The wild type and the Highest dose conditions are significantly different from the KO condition for both mean minimal Feret’s diameter, and their variance coefficient. Overall, for those three parameters, increasing dose of vectors tends towards phenotype recovery and exhibits a dose response effect. (<bold>D</bold>) Distribution of mean Feret’s diameter per condition. KO mice have a higher number of small fibers, resulting in a characteristic distortion of the distribution shape. The increasing vector dose tends to reshape the distribution towards the wild type distribution shape, as the highest dose distribution is close to the wild type distribution.</p>
          </caption>
          <graphic xlink:href="41598_2022_24139_Fig6_HTML" id="MO6"/>
        </fig>
      </p>
      <p id="Par26">The variance coefficient (VC), drawn on Fig. <xref rid="Fig6" ref-type="fig">6</xref>C, confirms response-dose effect. The difference between WT and KO phenotype is depicted by a significantly higher coefficient of variance for KO subjects. This is explained by a high number of fibers being regenerated in a dystrophic muscle and thus having smaller diameters, which induces an increased heterogeneity in fiber diameters. The dose-response effect is shed into light by a coefficient of variance of highest dose subjects significantly different from the KO one and not significantly different from the WT one. This is again the only dose that statistically shows a phenotype improvement. In parallel, the intermediate and lowest doses are not significantly different from the KO one, even if the medium dose seems to tend towards a lower variance coefficient and thus confirms the tendency towards slightly better condition.</p>
      <p id="Par27">The histogram of Feret’s diameters (see Fig. <xref rid="Fig6" ref-type="fig">6</xref>D) reinforces these observations. The KO distribution is flatter with a shift of the peak to the left compared to the WT. This is due to the increase of the small fiber population due to regeneration. This shift is reduced within the treated subjects. The flatter the distribution and the larger the standard deviation, the lower the dose injected. The KO, lowest and intermediate doses tend to have distributions with similar shapes, whereas the highest dose tends to have similar distribution as the WT. The highest dose seems to be the only dose which sufficiently improves muscle health to have a phenotype tending towards WT phenotype, while the other two dose phenotypes seem to remain close to KO one. These results show that the minimal Feret’s diameter of fibers is a better reflection of the muscle recovery compared to the CNF ratio. The highest dose gives a CNF still highly distinguishable from the WT while the minimal Feret’s diameter mean or VC is not different statistically. Such discrepancy can be explained by the fact that regenerated fibers tend to keep their nuclei at the center of the fibers for months even though the fiber is completely mature, making the CNF a long-lasting phenotype.</p>
      <p id="Par28">The conclusions drawn in this section are valid despite the diameter RMSE of about 2.94 <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M34"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq17.gif"/></alternatives></inline-formula>m. Indeed, the diameter RMSE of KO and WT subjects are similar, 2.95 and 2.93 <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M36"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq18.gif"/></alternatives></inline-formula>m respectively. In addition, their RMSE distributions according to diameter class of 5 <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M38"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq19.gif"/></alternatives></inline-formula>m from 0 to 100 <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M40"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq20.gif"/></alternatives></inline-formula>m are not significantly different in accordance to Kolmogorov–Smirnov test whose p-value is of 0.20, which is higher than 0.05.</p>
    </sec>
  </sec>
  <sec id="Sec10">
    <title>Conclusion and discussion</title>
    <p id="Par29">In this work, we describe MyoSOTHES, a tuned workflow designed for quantifying skeletal muscle fiber diameters and CNF on whole slide images of HE stained sections to assess muscle dystrophy. This workflow integrates the generalist Deep Learning algorithm Cellpose, designed for cellular segmentation, which we adapted for myofibers recognition. It is coupled with open-source analysis software QuPath for biological parameters quantification. MyoSOTHES demonstrates its improved performance compared to baseline workflow when evaluating the segmentation quality against manually determined ground truth with an F1-score increasing from 0.801 to 0.919 and RMSE improved of 31% in comparison to best performing <italic>default</italic> model configuration. In order to be widely used, a particular focus was laid on computing consumption. MyoSOTHES has a low memory footprint with no more than 2GB of RAM required and performs on desktop machines with an execution time of less than a quarter-hour for muscle section images of 120MB in average.</p>
    <p id="Par30">Moreover MyoSOTHES is a fully automated workflow, an ideal feature to manage projects with large amount of whole slide images to analyze. However, it enables the interactive check of the segmentation quality and the spatial distribution of the parameters directly within QuPath at each stage. Finally, we validated our approach on a cohort of whole slide images of HE stained sections from mice suffering from <inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M42"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq21.gif"/></alternatives></inline-formula>-Sarcoglycanopathy, and treated with different doses of gene therapy vectors. We showed that our analysis reveals the dose-effect and is consistent with the previous study conclusions. Thus, while HE stained section are usually used for a qualitative assessment of muscle health, MyoSOTHES allows going further by offering quantitative information on the dystrophic phenotype for this staining which has for a long time represented real challenge for image analysis.</p>
    <p id="Par31">In terms of short-term enhancements, first, we encountered some difficulties with the segmentation of special myofibers cross-sections that had particularly long shapes. It could be interesting to retrain the Cellpose model to make it more efficient for these types of forms. Then, some improvements could also be obtained with some image pre-processing steps. Indeed, although MyoSOTHES is really efficient to exclude regions of targeted artifacts thanks to an integrated pixel classifier of QuPath, it may be necessary for some studies to upgrade this part of workflow to include new types of artifacts. In addition, a color normalization step could improve even more Cellpose segmentation capabilities.</p>
    <p id="Par32">To go further, from a computational point of view, our tiling method enables the use of reasonable memory GPU opening the perspective of frugality and the even wider usage. From a data perspective, pre-clinical studies and clinical studies led in pharmaceutical industry often tend towards fully automated processes to reduce user dependence and increase reproducibility. MyoSOTHES is suitable with this kind of approaches as the workflow is automated and the HE staining is suitable with automated staining devices. Our MyoSOTHES workflow thus paves the way for wide quantification of HE stained muscle section, and retrospective analyses as HE staining has been used in laboratories for decades, specially when considering numerous rare diseases for which samples can be capitalized and used for further analysis beyond their lifetime.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Animal and histology procedures</title>
      <p id="Par33">The human g-Sarcoglycan gene under the control of the desmin promoter (AAV8-desm-hSGCG) was encapsulated in recombinant adeno-associated virus vector (rAAV) using the protocol described in the previous study<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. The g-Sarcoglycan KO mouse model (<inline-formula id="IEq22"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Sgcg^{-/-}$$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:mi>S</mml:mi><mml:mi>g</mml:mi><mml:mi>c</mml:mi><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mo stretchy="false">/</mml:mo><mml:mo>-</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq22.gif"/></alternatives></inline-formula>) used in this study has been previously described<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. All mice were handled according to the European guidelines for the human care and use of experimental animals, and all procedures on animals were approved by the Généthon’s ethics committee under the numbers CE10-122, CE10-123, CE10-124, CE10-127, and CE12-039. A volume of 100 <inline-formula id="IEq23"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M46"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq23.gif"/></alternatives></inline-formula>L/20 g containing the AAV vector was injected into the tail vein. Mice are divided into 5 groups: a wild type group, a knockout group and three groups with different levels of treatment at <inline-formula id="IEq24"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$4.5 \times 10^{12}$$\end{document}</tex-math><mml:math id="M48"><mml:mrow><mml:mn>4.5</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>12</mml:mn></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq24.gif"/></alternatives></inline-formula> vg/kg, 1.5 <inline-formula id="IEq25"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\times$$\end{document}</tex-math><mml:math id="M50"><mml:mo>×</mml:mo></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq25.gif"/></alternatives></inline-formula>
<inline-formula id="IEq26"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$10^{13}$$\end{document}</tex-math><mml:math id="M52"><mml:msup><mml:mn>10</mml:mn><mml:mn>13</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq26.gif"/></alternatives></inline-formula> vg/kg, and <inline-formula id="IEq27"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$4.5 \times 10^{13}$$\end{document}</tex-math><mml:math id="M54"><mml:mrow><mml:mn>4.5</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>13</mml:mn></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq27.gif"/></alternatives></inline-formula> vg/kg. Animals were euthanized one month after AAV vector administration. Skeletal muscles were dissected out and frozen in isopentane cooled in liquid nitrogen. Transverse cryosections (8 mm thickness) were prepared from frozen muscles, air dried, and stored at -80<inline-formula id="IEq28"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$^{\circ }$$\end{document}</tex-math><mml:math id="M56"><mml:msup><mml:mrow/><mml:mo>∘</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq28.gif"/></alternatives></inline-formula>C. HE staining was performed on all sampled muscles. Whole section images of HE staining were acquired on Axioscan Z1 (ZEISS, Germany), using a plan-apochromat 10 <inline-formula id="IEq29"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\times$$\end{document}</tex-math><mml:math id="M58"><mml:mo>×</mml:mo></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq29.gif"/></alternatives></inline-formula> magnitude 0.45 NA objective (ZEISS, Germany). Pyramidal images were reconstructed using ZEN software (ZEISS, Germany). The study was performed in compliance with the ARRIVE guidelines.</p>
    </sec>
    <sec id="Sec13">
      <title>Dataset and ground truth creation</title>
      <p id="Par34">The dataset used in the context of this article is constituted of WSI of 50 mice having undergone the protocol described above. It is composed of WSI of mouse right psoas sections with 10 sections coming from 10 different Wild Type subjects, 10 from Knockout subjects, 10 from subjects treated with the lowest dose, 10 from those treated with intermediate dose and last 10 treated by the highest dose.</p>
      <p id="Par35">The ground truth segmentation was performed manually on three WSI of psoas sections on an area of about 200–314 <inline-formula id="IEq30"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\upmu }$$\end{document}</tex-math><mml:math id="M60"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq30.gif"/></alternatives></inline-formula>m<inline-formula id="IEq31"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$^{2}$$\end{document}</tex-math><mml:math id="M62"><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq31.gif"/></alternatives></inline-formula> using QuPath annotation capabilities.</p>
    </sec>
    <sec id="Sec14">
      <title>Scripts description and usage</title>
      <p id="Par36">To perform automated analysis of MyoSOTHES, two python programs, several groovy QuPath-compatible and shell scripts have been implemented.</p>
      <p id="Par37">Python scripts are written in python 3.8. The first script dealing with the segmentation stage uses 2.0.4 Cellpose version with numpy version 1.21.6 and PyTorch 1.11.0. As execution parameters, the input cell diameter and the input channel vary according to configuration studied. In all models, the flow threshold is set to 0.5 and the resampling option is set to true. The second python script modifies tile masks obtained for reconstruction, as described further in “<xref rid="Sec18" ref-type="sec">Tiling and reconstruction strategy</xref>” subsection. It requires Pillow library version 8.0.1.</p>
      <p id="Par38">Concerning groovy scripts, they have been produced using 0.3.1 version of QuPath. A first script aims at performing automatically the export of histological whole slide image into TIFF images to be compatible with Cellpose input format. In case of tiling, a script is available to export tiles containing tissue. Another script enables to superimpose Cellpose predicted masks on corresponding sections and assign them the prediction class. This script is available in two versions: the one simply importing one WSI mask, and a second version importing each tile mask and placing them at the right place before removing nested masks using “intersect” function from QuPath. Then, the following script to be executed is the one filtering imported masks. It executes a binary pixel classifier, based on a random forest, trained considering Gaussian, Laplacian of Gaussian and weighted deviation features, on red, green and blue channels, at scale 1.0. Once masks filtered, their Feret’s diameter is measured using the QuPath minimum diameter function accessible via the “Adding shape characteristics” option. Once Feret’s diameter estimated, CNF ratio can be computed. To do so, the cell detection plugin with cell expansion set to 0 is applied, which detects nuclei in the entire image and stores them as a detection object. Then, for each mask, the hierarchy between regions of interests and detection is resolved, to assign which nuclei belong to which cell. The cell and nuclei boundaries are converted into polygons to measure the distance between nuclei boundary and cell boundary. If the distance is higher than a threshold of 2.2 <inline-formula id="IEq32"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M64"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq32.gif"/></alternatives></inline-formula>m, we consider that the cell is centrally nucleated. Those two operations are run using one script measuring biological parameters. To perform error estimation, a script is produced to enable the import of ground truth masks stored in a GeoJSON format, which is the one produced by QuPath to export annotations. A final script provides the tools to compute IoU for True Positive, False Positive and False Negative detection, which are then interpreted for the estimation of recall, precision and F1-score. All QuPath tools used in script can be adapted to specific cases following the well detailed QuPath user guide available online<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>.</p>
    </sec>
    <sec id="Sec15">
      <title>Computation support specification</title>
      <p id="Par39">Cellpose computation time measurements were performed using three different machines. The first one is a computer NUC10i7FNH equipped with an Intel Core i7-10710U 1.10GHz processor, with 6 cores and 32 GB of RAM (Intel, USA). It executes Linux 5.13.0 with gcc 9.4.0, glibc 2.31. The second machine is a a computer OptiPlex 7060 having an Intel Core i5-8400 2.80GHz processor with 6 cores and 32 GB of RAM (Dell Inc., USA). It runs Linux 5.4.0 with gcc 9.4.0, glibc 2.31. The last one is a server AS -2023US-TR4 embedding 2 AMD EPYC 75022.5GHz processors with 32 cores and 512 GB of RAM (Supermicro, USA) and a Nvidia Quadro RTX 5000 GPU with 16 GB of memory (NVidia, USA). Linux 5.8.0 with gcc 8.4.0, glibc 2.31 and Cuda 11.2 are installed.</p>
    </sec>
    <sec id="Sec16">
      <title>Segmentation quality measure</title>
      <p id="Par40">The measurement of the segmentation quality must be considered from two angles. Indeed, to have a good quantification of some parameters such as the diameter, it is necessary to be able to detect the largest quantity of fiber possible to avoid biasing the population of detected fiber and also to ensure that the detected fiber has good quality contours. The model detection ability is measured based on F1-score metrics and contour quality metric is based on the measured parameter Root Mean Squared Error (RMSE). Both metrics rely on a previous metric, the Intersection over Union (IoU). IoU estimates whether a predicted mask can be considered as True Positive, that is, if the predicted mask corresponds to the ground truth according to a chosen threshold. If no corresponding ground truth mask exists, the predicted mask is considered as False Positive. On the contrary, when no predicted mask corresponds to a ground truth mask, it is labeled as False Negative. Those definitions are illustrated in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S2</xref>. The IoU threshold is required to be at least strictly higher than 0.5 to ensure at most one predicted mask corresponds to ground truth. The computation of IoU proposed here is performed in three stages. First, both predicted and ground truth masks have to be imported, assigning them a different class to differentiate them. The second stage consists in iterating over masks classified as predicted. They are all initially assigned the label False Positive. For each of them, the bounding box boundaries are determined. Then, the algorithm looks for any ground truth mask bounding box intersecting our current predicted masks, using QuPath “intersect” function between regions of interest. For intersecting masks, the IoU is computed based on intersection and union between regions of interest. The highest IoU between all intersecting ground truth masks is kept. If this value is higher than the preliminary fixed threshold, the current predicted mask label is changed to True Positive. The third stage consists in iterating over ground truth masks, initially labeled as False Negative. Same operations are performed switching prediction masks and ground truth masks, except that when IoU value is higher than the threshold, the attribution of the label False Negative is removed and not replaced. In the context of this study, the threshold is set to 0.5, as often selected by famous segmentation challenges like the Coco Challenge<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> or the Voc Challenge<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Then, based on the class allocated to each mask, it is possible to measure the two other evaluation metrics. The F1-score is computed based on two indicators, precision and recall. The precision aims at estimating how many predicted masks correspond to a ground truth mask among all predicted masks, meaning how correct the predictions are. The recall estimates how many ground truth masks have a corresponding predicted mask among all ground truth masks, meaning how exhaustive the predictions are in the space of ground truth masks. The F1-score aims at embedding both dimensions by performing the harmonic mean between the two previous operators. The RMSE is computed among true positives. On each predicted and ground truth masks is performed the target parameter measurement. Then, the squared difference between corresponding predicted and ground truth parameter measurement is performed, as part of the root mean squared error formula <inline-formula id="IEq33"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$RMSE = \sqrt{(\frac{1}{n})\sum _{i=1}^{n}(\hat{p}_{i} - p_{i})^{2}}$$\end{document}</tex-math><mml:math id="M66"><mml:mrow><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:mi>S</mml:mi><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq33.gif"/></alternatives></inline-formula> with <inline-formula id="IEq34"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{p}$$\end{document}</tex-math><mml:math id="M68"><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq34.gif"/></alternatives></inline-formula> the measurement of target parameter on predicted masks, p the measurement of target parameter on ground truth masks and n the number of true positives.</p>
    </sec>
    <sec id="Sec17">
      <title>Cellpose retraining strategy</title>
      <p id="Par41">The retraining strategy is the one described in<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. In total, 9 tiles extracted from different whole slide images were used, each containing the highest diversity as possible of HE specific artifacts and characteristics, such as inflammatory areas. Each tile contained about a hundred cells segmented. The extracted tiles used for training belong to different whole slide images than the ones used for segmentation quality estimation.</p>
    </sec>
    <sec id="Sec18">
      <title>Tiling and reconstruction strategy</title>
      <p id="Par42">The tiling strategy consists in dividing the WSI in patches and analyzing only patches containing tissues. The selection of tile containing tissue is done in QuPath using a thresholder, which turns out to be a subcategory of a pixel classifier. The classifier was trained with the following parameters: the resolution was set to low, meaning 7 <inline-formula id="IEq35"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\upmu$$\end{document}</tex-math><mml:math id="M70"><mml:mi mathvariant="normal">μ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq35.gif"/></alternatives></inline-formula>m/pixel, the Gaussian prefilter was selected, the channel considered was the maximum of all channels and the threshold was set to 190, with 0 as smoothing sigma parameter. The region delimited by the thresholder is converted to an annotation. Then, the annotation itself is split into tiles, using the tiling tools offered by QuPath, embedding tile position in the extracted tile name. However, tiling induces side effects: fibers cut by tile limit are segmented less precisely and corresponding masks contain a straight edge. To alleviate this problem, tiling is performed extracting overlapped tiles. The overlapping size is set to 200 pixels to ensure no fibers are cut on image in the overlapping area they belong to. The detailed process is represented in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S3</xref>.</p>
      <p id="Par43">As a consequence, the reconstruction strategy is not trivial. The resulting Cellpose masks are retrieved in a PNG image format where each pixel, belonging to the same masks, has the same specific value. Consequently, to reconstruct the WSI masks without overlapping masks, we propose a python script which modifies tile masks as presented in Supplementary Fig. <xref rid="MOESM1" ref-type="media">S4</xref>: <list list-type="order"><list-item><p id="Par44">All masks belonging to upper and left 200 pixels width stripe will be removed by setting all pixel values to 0, except for those intersecting with lines x = 200 pixels and y = 200 pixels.</p></list-item><list-item><p id="Par45">All masks cut by right and lower tile border are removed by replacing their pixel values by 0.</p></list-item></list>The final step is to place each mask at the corresponding position on the WSI using the position stored in image name, which is made available in a QuPath script. Then, in some marginal cases, two masks are nested due to side effects. To avoid overrepresentation of one mask, the largest of the two nested masks is kept. The detection is performed thanks to the QuPath “intersect” function between annotations.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec19">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41598_2022_24139_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Marie Reinbigler, Jérémie Cosette, Catalin Fetita, Elisabeth Brunet and Daniel Stockholm.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary Information</title>
    <p>The online version contains supplementary material available at 10.1038/s41598-022-24139-z.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The authors acknowledge the financial support of Hi! PARIS Center (<ext-link ext-link-type="uri" xlink:href="https://www.hi-paris.fr">https://www.hi-paris.fr</ext-link>). Some of authors are Genopole’s members, first French biocluster dedicated to genetic, biotechnologies and biotherapies. They are grateful to the “Imaging and Cytometry Core Facility” of Genethon for technical support, to Ile-de-France Region, INSERM and GIP Genopole, Evry for the purchase of the equipment.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>Z.G. gave first insights on the workflow. S.J. prepared sections and realized ground truth annotations. J.C. and S.J. performed data acquisition. M.R. led all workflow design, its implementation and conducted experiments. M.R and J.C. drafted the manuscript. M.R., J.C., C.F., E.B. and D.S. conceived experiments, analyzed results and reviewed the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Code available on GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/brunettsp/myosothes">https://github.com/brunettsp/myosothes</ext-link>. The dataset used and analysed during the current study is available from the corresponding author on reasonable request.</p>
  </notes>
  <notes id="FPar1" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par46">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <mixed-citation publication-type="other">Miller, M. S., Bedrin, N. G., Ades, P. A., Palmer, B. M. &amp; Toth, M. J. Molecular determinants of force production in human skeletal muscle fibers: effects of myosin isoform expression and cross-sectional area. Am. J. Physiol. Cell Physiol. <bold>308</bold>, C473–C484. 10.1152/ajpcell.00158.2014 (2015).</mixed-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Briguet, A., Courdier-Fruh, I., Foster, M., Meier, T. &amp; Magyar, P., J. Histological parameters for the quantitative assessment of muscular dystrophy in the mdx-mouse. Neuromus. Disord. <bold>14</bold>, 675–682. 10.1016/j.nmd.2004.06.008 (2004).</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duddy</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Muscular dystrophy in the mdx mouse is a severe myopathy compounded by hypotrophy, hypertrophy and hyperplasia</article-title>
        <source>Skeletal Muscle</source>
        <year>2015</year>
        <volume>5</volume>
        <fpage>1</fpage>
        <lpage>18</lpage>
        <pub-id pub-id-type="doi">10.1186/s13395-015-0041-y</pub-id>
        <pub-id pub-id-type="pmid">25664165</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <mixed-citation publication-type="other">Ripolone, M. et al. Muscle histological changes in a large cohort of patients affected with becker muscular dystrophy. Acta Neuropathol. Commun. <bold>10</bold>. 10.1186/s40478-022-01354-3 (2022).</mixed-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rahmati</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rashno</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Automated image segmentation method to analyse skeletal muscle cross section in exercise-induced regenerating myofibers</article-title>
        <source>Sci. Rep.</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>1</fpage>
        <lpage>16</lpage>
        <pub-id pub-id-type="doi">10.1038/s41598-021-00886-3</pub-id>
        <pub-id pub-id-type="pmid">33414495</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Waisman</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Norris</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Costa</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Kopinke</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Automatic and unbiased segmentation and quantification of myofibers in skeletal muscle</article-title>
        <source>Sci. Rep.</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>11793</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-021-91191-6</pub-id>
        <?supplied-pmid 34083673?>
        <pub-id pub-id-type="pmid">34083673</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Encarnacion-Rivera</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Foltz</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hartzell</surname>
            <given-names>HC</given-names>
          </name>
          <name>
            <surname>Choo</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Myosoft: An automated muscle histology analysis tool using machine learning algorithm utilizing fiji/imagej software</article-title>
        <source>PLoS ONE</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>1</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0229041</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Desgeorges</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Open-csam, a new tool for semi-automated analysis of myofiber cross-sectional area in regenerating adult skeletal muscle</article-title>
        <source>Skelet. Musc.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>12</fpage>
        <pub-id pub-id-type="doi">10.1186/s13395-018-0186-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sardone</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A novel high-throughput immunofluorescence analysis method for quantifying dystrophin intensity in entire transverse sections of duchenne muscular dystrophy muscle biopsy samples</article-title>
        <source>PLoS ONE</source>
        <year>2018</year>
        <volume>13</volume>
        <fpage>1</fpage>
        <lpage>21</lpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0194540</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mayeuf-Louchart</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MuscleJ: A high-content analysis method to study skeletal muscle with a new Fiji tool</article-title>
        <source>Skelet. Musc.</source>
        <year>2018</year>
        <volume>8</volume>
        <fpage>25</fpage>
        <pub-id pub-id-type="doi">10.1186/s13395-018-0171-0</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">Lau, Y. S., Xu, L., Gao, Y. &amp; Han, R. Automated muscle histopathology analysis using cellprofiler. Skelet. Musc. <bold>8</bold> (2018).</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smith</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Barton</surname>
            <given-names>ER</given-names>
          </name>
        </person-group>
        <article-title>SMASH -semi-automatic muscle analysis using segmentation of histology: a MATLAB application</article-title>
        <source>Skelet. Musc.</source>
        <year>2014</year>
        <volume>4</volume>
        <fpage>21</fpage>
        <pub-id pub-id-type="doi">10.1186/2044-5040-4-21</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stringer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Michaelos</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pachitariu</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Cellpose: A generalist algorithm for cellular segmentation</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>100</fpage>
        <lpage>106</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-020-01018-x</pub-id>
        <?supplied-pmid 33318659?>
        <pub-id pub-id-type="pmid">33318659</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Bankhead, P. et al. Qupath: Open source software for digital pathology image analysis. Sci. Rep. <bold>7</bold>. 10.1038/s41598-017-17204-5 (2017).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Israeli</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An AAV-SGCG dose-response study in a <inline-formula id="IEq37"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma$$\end{document}</tex-math><mml:math id="M72"><mml:mi>γ</mml:mi></mml:math><inline-graphic xlink:href="41598_2022_24139_Article_IEq37.gif"/></alternatives></inline-formula>-Sarcoglycanopathy mouse model in the context of mechanical stress</article-title>
        <source>Mol. Ther. Methods Clin. Dev.</source>
        <year>2019</year>
        <volume>13</volume>
        <fpage>494</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1016/j.omtm.2019.04.007</pub-id>
        <?supplied-pmid 31194043?>
        <pub-id pub-id-type="pmid">31194043</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <mixed-citation publication-type="other">Ronneberger, O., Fischer, P. &amp; Brox, T. U-Net: convolutional networks for biomedical image segmentation. In: Navab, N., Hornegger, J., Wells, W. M. &amp; Frangi, A. F. (eds.) Medical image computing and computer-assisted intervention—MICCAI 2015, 234–241 (Springer International Publishing, Cham, 2015).</mixed-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Pachitariu, M. &amp; Stringer, C. Cellpose 2.0: How to train your own model. <italic>Nature Methods</italic>. 10.1101/2022.04.01.486764 (2022).</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Lin, T.-Y. et al. Microsoft coco: Common objects in context. In European conference on computer vision, 740–755 (Springer, 2014).</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Everingham</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gool</surname>
            <given-names>LV</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>CKI</given-names>
          </name>
          <name>
            <surname>Winn</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Zisserman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>The pascal visual object classes (voc) challenge</article-title>
        <source>Int. J. Comput. Vis.</source>
        <year>2010</year>
        <volume>88</volume>
        <fpage>303</fpage>
        <lpage>338</lpage>
        <pub-id pub-id-type="doi">10.1007/s11263-009-0275-4</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Ho, T. K. Random decision forests. In Proceedings of 3rd international conference on document analysis and recognition, vol. 1, 278–282 (IEEE, 1995).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Karpati, G., Carpenter, S. &amp; Prescott, S. Small–caliber skeletal muscle fibers do not suffer necrosis in mdx mouse dystrophy. Musc. Nerve <bold>11</bold> (1988).</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Bankhead, P., Gelbard, M., Kurtaev, D. &amp; Luis Cano Rodríguez, J. Welcome to QuPath! <ext-link ext-link-type="uri" xlink:href="https://qupath.readthedocs.io/en/stable/">https://qupath.readthedocs.io/en/stable/</ext-link> (2021).
</mixed-citation>
    </ref>
  </ref-list>
</back>
