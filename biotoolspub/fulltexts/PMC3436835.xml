<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3436835</article-id>
    <article-id pub-id-type="pmid">22962451</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bts408</article-id>
    <article-id pub-id-type="publisher-id">bts408</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Sequencing and Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Accurate estimation of short read mapping quality for next-generation genome sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ruffalo</surname>
          <given-names>Matthew</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">
          <sup>*</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Koyutürk</surname>
          <given-names>Mehmet</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ray</surname>
          <given-names>Soumya</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>LaFramboise</surname>
          <given-names>Thomas</given-names>
        </name>
        <xref ref-type="aff" rid="AFF2">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="AFF3">
          <sup>3</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Department of Electrical Engineering &amp; Computer Science</aff>
    <aff id="AFF2"><sup>2</sup>Department of Genetics</aff>
    <aff id="AFF3"><sup>3</sup>Center for Proteomics and Bioinformatics, Case Western Reserve University, Cleveland, OH 44106, USA</aff>
    <author-notes>
      <corresp id="COR1">* To whom correspondence should be addressed.</corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>3</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>3</day>
      <month>9</month>
      <year>2012</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>28</volume>
    <issue>18</issue>
    <issue-title>ECCB 2012 PROCEEDINGS PAPERS COMMITTEE SEPTEMBER 9 TO SEPTEMBER 12, 2012, CONFERENCE CENTER BASEL, SWITZERLAND</issue-title>
    <fpage>i349</fpage>
    <lpage>i355</lpage>
    <permissions>
      <copyright-statement>© The Author(s) (2012). Published by Oxford University Press.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/3.0">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/3.0">http://creativecommons.org/licenses/by/3.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> Several software tools specialize in the alignment of short next-generation sequencing reads to a reference sequence. Some of these tools report a mapping quality score for each alignment—in principle, this quality score tells researchers the likelihood that the alignment is correct. However, the reported mapping quality often correlates weakly with actual accuracy and the qualities of many mappings are underestimated, encouraging the researchers to discard correct mappings. Further, these low-quality mappings tend to correlate with variations in the genome (both single nucleotide and structural), and such mappings are important in accurately identifying genomic variants.</p>
      <p><bold>Approach:</bold> We develop a machine learning tool, LoQuM (LOgistic regression tool for calibrating the Quality of short read mappings, to assign reliable mapping quality scores to mappings of Illumina reads returned by any alignment tool. LoQuM uses statistics on the read (base quality scores reported by the sequencer) and the alignment (number of matches, mismatches and deletions, mapping quality score returned by the alignment tool, if available, and number of mappings) as features for classification and uses simulated reads to learn a logistic regression model that relates these features to actual mapping quality.</p>
      <p><bold>Results:</bold> We test the predictions of LoQuM on an independent dataset generated by the ART short read simulation software and observe that LoQuM can ‘resurrect’ many mappings that are assigned zero quality scores by the alignment tools and are therefore likely to be discarded by researchers. We also observe that the recalibration of mapping quality scores greatly enhances the precision of called single nucleotide polymorphisms.</p>
      <p><bold>Availability:</bold> LoQuM is available as open source at <ext-link ext-link-type="uri" xlink:href="http://compbio.case.edu/loqum/">http://compbio.case.edu/loqum/</ext-link>.</p>
      <p><bold>Contact:</bold><email>matthew.ruffalo@case.edu</email>.</p>
    </abstract>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Next-generation genome sequencing (NGS) has quickly become very popular in life sciences because of its utility in efficiently generating high-quality sequence data (<xref ref-type="bibr" rid="B12">Meyerson <italic>et al.</italic>, 2010</xref>). Applications of NGS include analysis of gene expression and alternative splicing (RNA-seq) (<xref ref-type="bibr" rid="B17">Wang <italic>et al.</italic>, 2009</xref>), DNA–protein interactions (chromatin immunoprecipitation sequencing) (<xref ref-type="bibr" rid="B15">Schmidt <italic>et al.</italic>, 2009</xref>), <italic>d</italic>e novo genome sequencing (<xref ref-type="bibr" rid="B9">Li <italic>et al.</italic>, 2009b</xref>), metagenomics and identification of genetic variants within and across populations (<xref ref-type="bibr" rid="B1">Alkan <italic>et al.</italic>, 2009</xref>). Many computational methods are already available for analyzing genetic variants using NGS data. These variants include single-nucleotide polymorphisms (SNPs) and structural variants such as copy numbers, insertions, deletions, tandem duplications, inversions and translocations. Characterization of such variants is useful in many applications, including genome-wide association studies (<xref ref-type="bibr" rid="B11">Mardis, 2008</xref>), identification of driver mutations in cancer (<xref ref-type="bibr" rid="B12">Meyerson <italic>et al.</italic>, 2010</xref>) and comparative genomics (<xref ref-type="bibr" rid="B6">Hudson, 2008</xref>).</p>
    <sec id="SEC1.1">
      <title>1.1 Short read alignment is an important problem</title>
      <p>The first step in the detection and analysis of genetic variants is usually the alignment of short NGS reads from an individual's (donor) genome to a reference genome. This task poses significant computational challenges due to the large number of reads (sometimes tens of millions) and the size of many reference genomes (generally on the order of billions). Furthermore, because of sequencing errors, repeats in the reference genome and differences between the donor and reference genomes, accurate mapping of the reads to the genome is not straightforward. In recent years, many software tools have been developed to address these challenges and efficiently and accurately align short reads to the reference genome (<xref ref-type="bibr" rid="B14">Ruffalo <italic>et al.</italic>, 2011</xref>). These tools include BWA (<xref ref-type="bibr" rid="B7">Li and Durbin, 2009</xref>), SOAP (<xref ref-type="bibr" rid="B10">Li <italic>et al.</italic>, 2009c</xref>), Novoalign (<xref ref-type="bibr" rid="B13">Novocraft, 2010</xref>) and mr(s)FAST (<xref ref-type="bibr" rid="B1">Alkan <italic>et al.</italic>, 2009</xref>; <xref ref-type="bibr" rid="B3">Hach <italic>et al.</italic>, 2010</xref>).</p>
    </sec>
    <sec id="SEC1.2">
      <title>1.2 Current alignment tools do not return reliable mapping quality scores</title>
      <p>As the mapping of a read to a location in the reference genome may not be accurate, many alignment tools report a mapping quality score as an indicator of the likelihood that the mapping is accurate. This score is generally estimated by considering various factors, such as the number of base mismatches and the sizes of inserted or deleted regions in the alignment. In principle, the mapping quality score <italic>Q</italic><sub>m</sub> reflects the log-scaled probability that the mapping is inaccurate and ranges from 0 (Pr{mapping is inaccurate} = 1, i.e. the mapping is most likely inaccurate) to 40 (40= −10log<sub>10</sub> Pr{mapping is inaccurate} → Pr{mapping is inaccurate} &lt; 10<sup>−4</sup>, i.e. the mapping is most likely accurate). However, for almost all the state-of-the-art alignment tools, the mapping quality scores do not correlate well with the actual likelihood that a mapping is accurate and is therefore not very useful (<xref ref-type="bibr" rid="B14">Ruffalo <italic>et al.</italic>, 2011</xref>). This is illustrated in <xref ref-type="fig" rid="F1">Figure 1</xref>. In the figure, for several alignment tools, the relationship between the mapping quality reported by the alignment tool and the actual mapping accuracy (the fraction of accurate mappings among those that are assigned the respective quality score) is shown. As seen in the figure, alignment tools generally report many accurate mappings with quality 0, and many inaccurate mappings with high-quality scores. We also see that there is very little dynamic range in the mapping qualities; even when tools provide many distinct quality scores, there is little difference in actual mapping accuracy between, e.g. mappings with quality score 15 and mappings with quality score 30. Underestimated mapping quality scores might cause the user to discard many accurate mappings because of the conservative estimate provided by the alignment tool. Overestimated mapping quality scores, conversely, may contribute to false-positive results in variant calling and other types of downstream analysis. These observations call for more accurate assessment of mapping quality for the mappings provided by these tools. Furthermore, some methods, e.g. mr- and mrsFAST, do not report any mapping quality scores, they rather report all possible mappings for a read. For such tools, assessment of mapping quality would be useful as well, as a means for choosing from the multiple possible mappings.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Direct comparison of the theoretical accuracy at each quality score <italic>Q</italic><sub>m</sub> against each tool's actual accuracy. The mapping quality <italic>Q</italic><sub>m</sub> is defined as the log-scaled probability <italic>P</italic> that the mapping is incorrect: <italic>Q</italic><sub>m</sub> = −10log<sub>10</sub>
<italic>P</italic>, giving a theoretical accuracy <italic>A</italic> for each quality score: <italic>A</italic> = 1 − <italic>P</italic> = 1−10<sup>−Q<sub>m</sub>/10</sup></p></caption><graphic xlink:href="bts408f1"/></fig>
</p>
    </sec>
    <sec sec-type="methods" id="SEC1.3">
      <title>1.3 Contributions of this study</title>
      <p>In this article, we use a machine learning approach to assess the quality of the short read mappings more accurately than available alignment tools. For this purpose, we first identify the features that are potentially useful in assessing the likelihood that a mapping is accurate. These features consist of read statistics provided by an Illumina sequencer (e.g. base quality) and alignment statistics provided by the aligner (e.g. number of matches, mismatches, deletions, insertions, number of possible mappings and mapping quality score). Subsequently, we simulate NGS runs to generate reads that accurately reflect the characteristics of available sequencers. We use these simulated reads and the mappings provided by the aligner for these reads as training data to fit a logistic regression model that represents the relationship between read and alignment statistics and mapping accuracy. We implement this computational pipeline into a software package, LoQ<sc>u</sc>M (LOgistic regression tool for calibrating the QUality of short read Mappings), which is available as open source at <ext-link ext-link-type="uri" xlink:href="http://compbio.case.edu/loqum/">http://compbio.case.edu/loqum/</ext-link>. LoQ<sc>u</sc>M can work with a wide range of alignment tools to run the aligner for the user, compile the mappings returned by the aligner, calibrate the quality of these mappings and return the list of mappings with more reliable mapping quality scores. We test LoQ<sc>u</sc>M by comprehensive cross-validation studies on the human genome. The cross-validation studies are conducted by using different simulators to generate the training and testing data. Namely, we first simulate training reads using the S<sc>eal</sc> (<xref ref-type="bibr" rid="B14">Ruffalo <italic>et al.</italic>, 2011</xref>) sequencing simulation software, and we use validation reads generated by the ART (<xref ref-type="bibr" rid="B5">Huang <italic>et al.</italic>, 2012</xref>) software. We also investigate the utility of recalibrating mapping quality scores in improving genomic variant detection in the context of detecting SNPs. For this purpose, we implant SNPs into the human genome and use the SAMtools (<xref ref-type="bibr" rid="B8">Li <italic>et al.</italic>, 2009a</xref>) software to compare the effect of raw and recalibrated mapping quality scores to the performance of SAMtools in calling these implanted SNPs. Previous work such as SRMA (<xref ref-type="bibr" rid="B4">Homer and Nelson, 2010</xref>) focused on local re-alignment of short reads to improve the accuracy of SNP calls; LoQ<sc>u</sc>M's broader focus also makes it suitable for improving the accuracy of other types of variant calls.</p>
      <p>The results of our experimental studies can be summarized as follows:
<list list-type="bullet"><list-item><p>For most aligners, the mapping quality scores estimated by LoQ<sc>u</sc>M strongly correlate with actual mapping accuracy.</p></list-item><list-item><p>The quality scores computed by LoQ<sc>u</sc>M provide a reliable criterion for selecting the high-quality mappings among those that are assigned zero quality scores or not scored at all by the aligner.</p></list-item><list-item><p>The features that are most useful in assessing mapping quality are the raw mapping qualities provided by the alignment tools and (except for Novoalign) the rate of degradation of base quality for a read. For tools that report multiple mappings for reads (e.g. mrFAST), the number of mappings for a read is also highly informative.</p></list-item><list-item><p>Mapping quality scores computed by LoQ<sc>u</sc>M greatly improve the precision of SNP calling at the cost of moderately lower recall.</p></list-item></list></p>
    </sec>
    <sec id="SEC1.4">
      <title>1.4 Outline</title>
      <p>In the next section, we describe our classification framework for calibrating the quality of short read mappings. Subsequently, in <xref ref-type="sec" rid="SEC3">Section 3</xref>, we present the results of comprehensive cross-validation studies performed on three different aligners (BWA, SOAP2 and Novoalign) using the human genome and the impact of these results on SNP calling. In <xref ref-type="sec" rid="SEC4">Section 4</xref>, we interpret our findings, discuss how LoQ<sc>u</sc>M can be useful in a range of applications and outline avenues for future research.</p>
    </sec>
  </sec>
  <sec id="SEC2">
    <title>2 METHODS</title>
    <p>The proposed machine learning framework is shown in <xref ref-type="fig" rid="F2">Figure 2</xref>. As seen in the figure, the reads are generated by the sequencer from the donor genome and are aligned to the reference genome using an available alignment tool. Both the sequencer and the aligner provide certain statistics on the read and the alignment, which are used by LoQ<sc>u</sc>M to recalibrate the mapping quality scores.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>The machine learning framework for recalibrating mapping quality scores. Rectangles represent data, blue rounded rectangles represent available hardware and software and green ellipses represent computational methods implemented within LoQ<sc>u</sc>M</p></caption><graphic xlink:href="bts408f2"/></fig>
</p>
    <p>In the proposed framework, we first derive features for each read-mapping pair from the read statistics provided by the sequencer and the alignment statistics provided by the aligner. Subsequently, we generate a large set of reads for training, by simulating reads from the reference genome. We then feed these reads to the aligner to generate a set of training mappings. We derive classification features for the training read-mapping pairs based on the model used for generating reads and the alignment statistics. As we know exactly where each simulated read is supposed to be mapped on the reference genome, we label each read-mapping pair in the training set as ‘accurate’ or ‘not accurate’. Using this training data set, we fit a logistic regression model that represents the relationship between the accuracy of a mapping and the features derived from the read and alignment statistics. Finally, we use this logistic regression model to predict the accuracy of each mapping in the test dataset. As logistic regression makes a quantitative prediction for mapping accuracy between 0 and 1, we use this figure directly as a measure of mapping quality.</p>
    <p>In this section, we first discuss the features that are used in assessing the quality of short read mappings. Subsequently, we describe the proposed classification framework for recalibrating mapping quality scores using these features.</p>
    <sec id="SEC2.1">
      <title>2.1 Selection of Features</title>
      <p>We classify the features we use into three categories: (i) alignment-independent features, (ii) alignment statistics and (iii) aligner-specific features. We discuss the features in each category later.</p>
      <sec id="SEC2.1.1">
        <title>2.1.1 Alignment-independent features</title>
        <p>These features consist of read statistics reported by the sequencer. In particular, most types of sequencing hardware provide a quality score <italic>Q</italic><sub>b</sub> for each base call in the read. In other words, the hardware reports its confidence in assigning a specific nucleotide to each base (e.g. the base is a G with 99.9% confidence or a C with 80% confidence). The raw quality value, also called Phred score, is the log-scaled probability that the base call is incorrect:
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="bts408m1"/></disp-formula></p>
        <p>The base quality scores reported by sequencers range from 0 (least reliable) to 40 (most reliable).</p>
        <p><xref ref-type="fig" rid="F3">Figure 3</xref> shows base quality statistics for a real RNA-seq data set. In the figure, the distribution of base quality across a random sample of 33 million reads is shown as a function of the position of the base on the read. As seen in the figure, mean base quality decreases in an almost linear fashion as more bases are read.
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>Boxplots of per-base quality statistics provided by the FastQC tool (<xref ref-type="bibr" rid="B2">Andrews, 2010</xref>) for the MDAMB468 cell line (<xref ref-type="bibr" rid="B16">Sun <italic>et al.</italic>, 2011</xref>) across a random sample of the 33 million reads. The <italic>x</italic>-axis is the base position in each read, and the <italic>y</italic>-axis is the base quality score <italic>Q</italic><sub>b</sub>. The blue line shows the mean base quality</p></caption><graphic xlink:href="bts408f3"/></fig>
</p>
        <p>If we use base quality scores directly as features for classification, we would have <italic>k</italic> base quality features for a read of length <italic>k</italic>, causing problems with high dimensionality. An alternate approach is to use the mean base quality for a read; however, the mean does not capture the base position-dependent nature of base quality scores. For these reasons, we fit a linear regression model to each read's quality scores and use the regression parameters as features for classification:
<list list-type="bullet"><list-item><p>Intercept: The quality of the first base in the read.</p></list-item><list-item><p>Slope: The rate of decline of base quality as more bases are sequenced on the read.</p></list-item><list-item><p><italic>R</italic> value (correlation coefficient): How well a line fits the read's base quality scores. A low <italic>R</italic> value may signify, e.g. a read whose base quality values show a very sharp drop and then ‘bottom out’ at 0 for the remainder of the read.</p></list-item></list></p>
        <p>Another potentially useful alignment-independent feature is the number of bases that could not be called (<italic>N</italic> count) in each read. When the sequencing hardware cannot identify the base at a certain position, it reports an <italic>N</italic> (instead of A, C, G and T) for that base, along with a zero base quality score. The <italic>N</italic> count should correlate with base quality statistics, but this may not be completely captured in the linear regression parameters described earlier. An <italic>N</italic> in the middle of a read should cause a sharp downward spike in base quality, with quality scores more-or-less resuming their previous value immediately afterward.</p>
      </sec>
      <sec sec-type="results" id="SEC2.1.2">
        <title>2.1.2 Alignment statistics</title>
        <p>Alignment tools report a few standard values, including the number of matches, mismatches, insertions and deletions in a mapping. These statistics together provide a direct measure of how well a read is aligned to a position in the reference genome. We use the raw counts of each of these values as classification features.</p>
      </sec>
      <sec id="SEC2.1.3">
        <title>2.1.3 Aligner-specific features</title>
        <p>Alignment tools typically report their output in the standard SAM (<xref ref-type="bibr" rid="B8">Li <italic>et al.</italic>, 2009a</xref>) file format, which defines a mapping quality field that aligners can use to signify whether an alignment is likely to be correct. The SAM format defines this mapping quality <italic>Q</italic><sub>m</sub> to be analogous to the base quality <italic>Q</italic><sub>b</sub>
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="bts408m2"/></disp-formula></p>
        <p>However, as discussed in the previous section, these mapping quality scores do not accurately characterize the reliability of a mapping. Among popular modern alignment tools, BWA and Novoalign provide the most meaningful quality scores (<xref ref-type="bibr" rid="B14">Ruffalo <italic>et al.</italic>, 2011</xref>), though we see that these tools still assign quality 0 to many accurate mappings (<xref ref-type="fig" rid="F1">Fig. 1</xref>). As these quality scores are informative to a certain extent, we expect them to be useful as features for classification. However, we seek to improve on the false negatives—the accurate mappings that have low quality—and the false positives—the inaccurate mappings that have high quality.</p>
        <p>Furthermore, some alignment tools (e.g. mrFAST and mrsFAST) may return multiple possible mappings for a read. The number of possible mappings for a read may be an indicator of the reliability of each of these mappings, as at most one of the mappings can correspond to the read's position in the genome. For this reason, for these tools, we also use the number of mappings returned for each read as a feature for classification.</p>
      </sec>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Classification</title>
      <p>We choose logistic regression as a classifier to learn the relationship between accuracy of mapping and the features derived in the previous section, for multiple reasons. First, as we are interested in accurately calculating the likelihood that a mapping is correct, a probabilistic classifier is a natural choice. Second, logistic regression makes no assumptions about the independence between features, which is appropriate in this setting. Many of the features described in <xref ref-type="sec" rid="SEC2.1">Section 2.1</xref> are not likely to be statistically independent of each other; at the very least, the mapping quality returned by the aligner should have some correlation with the other features. Finally, logistic regression is a simple classifier that provides insights on which features are most useful in predicting the dependent variable (here, accuracy of mapping), facilitating interpretation of how each feature affects mapping quality.</p>
      <p>We seek to accurately model the probability <italic>p</italic> that a mapping is correct. Logistic regression represents this in terms of the log odds ratio <inline-formula><inline-graphic xlink:href="bts408i1.jpg"/></inline-formula> and models this quantity as a linear combination of numeric features <italic>x</italic><sub>i</sub> and coefficients <italic>β<sub>i</sub></italic> (with a constant intercept term <italic>β<sub>0</sub></italic>):
<disp-formula id="M3"><label>(3)</label><graphic xlink:href="bts408m3"/></disp-formula></p>
      <p>Our <italic>x<sub>i</sub></italic> values are the features described earlier, e.g. mapping quality score, base quality slope and number of mappings.</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Simulation of Reads</title>
      <p>Our evaluation of LoQ<sc>u</sc>M uses simulated 50 bp reads from the human genome, provided by the ART (<xref ref-type="bibr" rid="B5">Huang <italic>et al.</italic>, 2012</xref>) sequencing simulation package. ART uses empirical base quality profiles to accurately mimic the characteristics of Illumina hardware, and we use these base quality values to calibrate the machine learning framework. Each read is annotated with its original position in the reference genome, which allows for easy evaluation of whether an alignment tool mapped it to the correct location.</p>
    </sec>
    <sec id="SEC2.4">
      <title>2.4 Cross-validation framework</title>
      <p>We perform a standard 5-fold cross-validation procedure: we build the classifier on 80% of the training set and evaluate the accuracy on the remaining 20%. For demonstration purposes, figures in this document represent one of the five training/validation folds.</p>
    </sec>
    <sec id="SEC2.5">
      <title>2.5 SNP calling evaluation</title>
      <p>Our evaluation of SNP calling used 100 artificial SNPs inserted into random locations in human chromosome 1. We created a new reference sequence containing these SNPs, then simulated reads from the altered sequence with ART. We then aligned these reads to chromosome 1 with BWA and adjusted these reads' mapping quality scores with LoQ<sc>u</sc>M. We identified significant SNPs with the SAMtools mpileupvariant calling program, both with BWA's original mapping quality scores and with LoQ<sc>u</sc>M's recalibrated scores. Using the locations of the artificial SNPs, we evaluated the number of true-positive, false-positive and false-negative SNP calls with each set of mapping quality scores.</p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 RESULTS</title>
    <p>We evaluate our classification framework by considering the relationship between precision and recall as one varies a threshold on prediction output. In calculating these measures, we consider a true positive (TP) as a read that is correctly mapped and whose score exceeds this threshold. A false positive (FP) is a read that is incorrectly mapped but whose score exceeds this threshold, and a false negative (FN) is a read that is correctly mapped but is discarded because its score is less than the threshold. We then use the standard definition of precision as <inline-formula><inline-graphic xlink:href="bts408i2.jpg"/></inline-formula>. Similarly, recall is defined as <inline-formula><inline-graphic xlink:href="bts408i3.jpg"/></inline-formula>.</p>
    <p>We evaluate the performance of LoQ<sc>u</sc>M on multiple alignment tools and compare the classifier output with the raw mapping quality (if provided). We then examine the relationship between our prediction scores and actual mapping accuracy and the effect of these recalibrated mapping quality scores on SNP calling with the SAMtools (<xref ref-type="bibr" rid="B8">Li <italic>et al.</italic>, 2009a</xref>) mpileupvariant caller.</p>
    <sec id="SEC3.1">
      <title>3.1 BWA</title>
      <p><xref ref-type="fig" rid="F4">Figure 4</xref> shows precision versus recall for the BWA alignment tool, with <xref ref-type="fig" rid="F4">Figure 4a</xref> showing the raw mapping qualities and <xref ref-type="fig" rid="F4">Figure 4b</xref> showing the output of LoQ<sc>u</sc>M. We see that the raw mapping qualities provide relatively little information about reads that are incorrectly mapped—even at the highest mapping quality of 25, BWA provides high recall and precision of ≈ 0.5. LoQ<sc>u</sc>M, however, identifies these high-quality incorrect mappings and provides much higher precision at comparable recall values.
<fig id="F4" position="float"><label>Fig. 4.</label><caption><p>Precision versus recall for the alignment tool BWA, using the raw mapping qualities in (<bold>a</bold>), and the output of LoQ<sc>u</sc>M in (<bold>b</bold>). The color of the curve denotes a threshold on mapping quality or prediction output; decreasing this threshold typically increases recall but decreases precision</p></caption><graphic xlink:href="bts408f4"/></fig>
</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 SOAP</title>
      <p><xref ref-type="fig" rid="F5">Figure 5</xref> shows SOAP2's precision and recall as a function of a threshold on mapping quality or logistic regression output. From the raw mapping quality precision/recall in <xref ref-type="fig" rid="F5">Figure 5a</xref>, we see that SOAP's quality scores have very low dynamic range and discriminative power. In fact, SOAP only reports mapping qualities of 0 or 30, and all quality-30 mappings are at the top of the red line (precision≈ 0.5) with all quality-0 mappings represented as an invisible blue dot under the red line at precision 0.45. Nonetheless, this logistic regression framework can accurately classify reads as correctly or incorrectly mapped. This is shown in <xref ref-type="fig" rid="F5">Figure 5b</xref>—LoQ<sc>u</sc>M provides higher area under the precision/recall curve, and a score threshold of 0.5 sits at the ‘elbow’ of the curve (the point at which mappings become less trustworthy).
<fig id="F5" position="float"><label>Fig. 5.</label><caption><p>Precision versus recall for the alignment tool SOAP2, using the raw mapping qualities in (<bold>a</bold>), and the output of LoQ<sc>u</sc>M in (<bold>b</bold>). The color of the curve denotes a threshold on mapping quality or prediction output; decreasing this threshold typically increases recall but decreases precision</p></caption><graphic xlink:href="bts408f5"/></fig>
</p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Novoalign</title>
      <p>Again, <xref ref-type="fig" rid="F6">Figure 6</xref> shows precision versus recall for Novoalign's mapping qualities and LoQ<sc>u</sc>M's output. From <xref ref-type="fig" rid="F6">Figure 6a</xref>, we see that Novoalign provides the most dynamic range in its mapping quality, though still with a maximum precision of ≈ 0.5. This logistic regression model produces a great accuracy improvement on the output of Novoalign; we see a smoothly decreasing curve in <xref ref-type="fig" rid="F6">Figure 6b</xref>. This suggests that LoQ<sc>u</sc>M captures a significant amount of information about Novoalign's mappings beyond what is represented in its quality scores.
<fig id="F6" position="float"><label>Fig. 6.</label><caption><p>Precision versus recall for the alignment tool Novoalign, using the raw mapping qualities in (<bold>a</bold>) and the output of LoQ<sc>u</sc>M in (<bold>b</bold>). The color of the curve denotes a threshold on mapping quality or prediction output; decreasing this threshold typically increases recall but decreases precision</p></caption><graphic xlink:href="bts408f6"/></fig>
</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Overall</title>
      <p><xref ref-type="fig" rid="F7">Figure 7</xref> shows similar data as 1 but uses the output of LoQ<sc>u</sc>M instead of the raw mapping quality. Mappings are divided into 10 groups based on their prediction score, and the average accuracy for each group is plotted against the theoretical accuracy at that score. We see that LoQ<sc>u</sc>M's output generally matches the theoretical accuracy much better than the raw mapping quality shown in <xref ref-type="fig" rid="F1">Figure 1</xref>.
<fig id="F7" position="float"><label>Fig. 7.</label><caption><p>Comparison of reported accuracy versus theoretical accuracy for ART's simulated reads. The <italic>x</italic>-axis is the output of the logistic regression classifier <italic>p</italic> after inversion and negative log-scaling: <italic>Q</italic> = −10log<sub>10</sub>(1 − <italic>p</italic>). This corresponds to the mapping quality score <italic>Q</italic><sub>m</sub> in <xref ref-type="disp-formula" rid="M2">Equation (2)</xref></p></caption><graphic xlink:href="bts408f7"/></fig>
</p>
    </sec>
    <sec id="SEC3.5">
      <title>3.5 SNP calling</title>
      <p>Our SNP calling results are listed in <xref ref-type="table" rid="T1">Table 1</xref>. We see that the SAMtools mpileup variant calls are dominated by false positives; raw mapping qualities provide a recall score of 0.83 but precision of only 0.163. The recalibrated mapping quality scores provided by LoQ<sc>u</sc>M result in lower recall (0.63) but a substantially higher precision of 0.589. These results are consistent with the precision/recall curves shown above—alignment tools report many incorrect mappings with high mapping quality, and LoQ<sc>u</sc>M's more conservative quality scores indeed reduce false-positive SNP calls.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>SNP calling results for 100 artificial SNPs inserted into human chromosome 1</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">Raw Map. Qual.</th><th rowspan="1" colspan="1">LoQ<sc>u</sc>M scores</th></tr></thead><tbody><tr><td rowspan="1" colspan="1">True positives</td><td rowspan="1" colspan="1">83</td><td rowspan="1" colspan="1">63</td></tr><tr><td rowspan="1" colspan="1">False positives</td><td rowspan="1" colspan="1">427</td><td rowspan="1" colspan="1">44</td></tr><tr><td rowspan="1" colspan="1">False negatives</td><td rowspan="1" colspan="1">17</td><td rowspan="1" colspan="1">37</td></tr><tr><td rowspan="1" colspan="1">Precision</td><td rowspan="1" colspan="1">0.163</td><td rowspan="1" colspan="1">0.589</td></tr><tr><td rowspan="1" colspan="1">Recall</td><td rowspan="1" colspan="1">0.83</td><td rowspan="1" colspan="1">0.63</td></tr><tr><td rowspan="1" colspan="1"><italic>F</italic> score</td><td rowspan="1" colspan="1">0.136</td><td rowspan="1" colspan="1">0.304</td></tr></tbody></table><table-wrap-foot><fn><p>The <italic>F</italic> score is defined as the harmonic mean of precision and recall: <italic>F</italic> = 1/(1/prec + 1/rec).</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="SEC4">
    <title>4 DISCUSSION</title>
    <p>As shown in the above figures, this logistic regression model provides higher precision at various recall values. This framework also provides better dynamic range than the raw mapping quality values provided by most tools, suggesting that it may be valuable for researchers who desire more granularity in their data analysis.</p>
    <p>Most importantly, LoQ<sc>u</sc>M correctly identifies many correctly mapped reads with lower mapping quality. This is evident in the precision/recall plots; a classifier output threshold of 0.5 sits exactly at the ‘elbow’ of each curve (the point at which precision starts to significantly decrease). LoQ<sc>u</sc>M's scores therefore provide a reliable way to discriminate between correct and incorrect mappings across different alignment tools—one may consistently use 0.5 as a quality score threshold. This suggests that researchers can use a tool of this type to use more of their data and get better yields out of sequencing experiments.</p>
    <p>The differences in feature significance between alignment tool classifiers also highlight the characteristics of these tools and the information that is likely to be represented in their existing quality scores.</p>
  </sec>
  <sec id="SEC5">
    <title>5 CONCLUSION</title>
    <p>In this article, we show that a machine learning framework that uses a combination of read and alignment statistics as classification features and simulated reads as training data to predict mapping accuracy can improve on mapping quality scores reported by available tools. These improved mapping quality scores might be particularly useful in improving the identification of genomic variants, since they can ‘save’ potentially informative mappings that would be conservatively assigned low-quality scores by the assignment tools. Additionally, LoQ<sc>u</sc>M's recalibrated mapping quality scores can reduce false-positive variant calls due to overestimated mapping accuracy. Assessment of the effect of mapping quality scores on identification of more genomic variants remains an important and interesting problem for future studies.</p>
    <p><italic>Funding</italic>: This work was supported by <funding-source>National Science Foundation Award</funding-source><award-id>IIS-0916102</award-id> and <funding-source>National Cancer Institute</funding-source> Grant No. <award-id>R01CA131341</award-id>.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
</body>
<back>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alkan</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Personalized copy number and segmental duplication maps using next-generation sequencing</article-title>
        <source>Nat. Genet.</source>
        <year>2009</year>
        <volume>41</volume>
        <fpage>1061</fpage>
        <lpage>1067</lpage>
        <pub-id pub-id-type="pmid">19718026</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <element-citation publication-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Andrews</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>FastQC: a quality control tool for high throughput sequence data</article-title>
        <year>2010</year>
        <comment>Available at <ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.bbsrc.ac.uk/projects/fastqc/">http://www.bioinformatics.bbsrc.ac.uk/projects/fastqc/</ext-link>. (last accessed date September 12, 2011)</comment>
      </element-citation>
    </ref>
    <ref id="B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hach</surname>
            <given-names>F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>mrsFAST: a cache-oblivious algorithm for short-read mapping</article-title>
        <source>Nat. Methods</source>
        <year>2010</year>
        <volume>7</volume>
        <fpage>576</fpage>
        <lpage>577</lpage>
        <pub-id pub-id-type="pmid">20676076</pub-id>
      </element-citation>
    </ref>
    <ref id="B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Homer</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Nelson</surname>
            <given-names>S. F.</given-names>
          </name>
        </person-group>
        <article-title>Improved variant discovery through local realignment of short-read next-generation sequencing data using SRMA</article-title>
        <source>Genome Biol.</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R99</fpage>
        <pub-id pub-id-type="pmid">20932289</pub-id>
      </element-citation>
    </ref>
    <ref id="B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>W.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ART: a next-generation sequencing read simulator</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>593</fpage>
        <lpage>594</lpage>
        <pub-id pub-id-type="pmid">22199392</pub-id>
      </element-citation>
    </ref>
    <ref id="B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hudson</surname>
            <given-names>M. E.</given-names>
          </name>
        </person-group>
        <article-title>Sequencing breakthroughs for genomic ecology and evolutionary biology</article-title>
        <source>Mol. Ecol. Resources</source>
        <year>2008</year>
        <volume>8</volume>
        <fpage>3</fpage>
        <lpage>17</lpage>
      </element-citation>
    </ref>
    <ref id="B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Durbin</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate short read alignment with Burrows-Wheeler transform</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1754</fpage>
        <lpage>1760</lpage>
        <pub-id pub-id-type="pmid">19451168</pub-id>
      </element-citation>
    </ref>
    <ref id="B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The sequence alignment/map format and SAMtools</article-title>
        <source>Bioinformatics</source>
        <year>2009a</year>
        <volume>25</volume>
        <fpage>2078</fpage>
        <lpage>2079</lpage>
        <pub-id pub-id-type="pmid">19505943</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>De novo assembly of human genomes with massively parallel short read sequencing</article-title>
        <source>Genome Res.</source>
        <year>2009b</year>
        <volume>20</volume>
        <fpage>265</fpage>
        <lpage>272</lpage>
        <pub-id pub-id-type="pmid">20019144</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SOAP2: an improved ultrafast tool for short read alignment</article-title>
        <source>Bioinformatics</source>
        <year>2009c</year>
        <volume>25</volume>
        <fpage>1966</fpage>
        <lpage>1967</lpage>
        <pub-id pub-id-type="pmid">19497933</pub-id>
      </element-citation>
    </ref>
    <ref id="B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mardis</surname>
            <given-names>E. R.</given-names>
          </name>
        </person-group>
        <article-title>The impact of next-generation sequencing technology on genetics</article-title>
        <source>Trends Genet.</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>133</fpage>
        <lpage>41+</lpage>
        <pub-id pub-id-type="pmid">18262675</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Meyerson</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Advances in understanding cancer genomes through second-generation sequencing</article-title>
        <source>Nat Rev Genet</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>685</fpage>
        <lpage>696</lpage>
        <pub-id pub-id-type="pmid">20847746</pub-id>
      </element-citation>
    </ref>
    <ref id="B13">
      <element-citation publication-type="other">
        <collab>Novocraft</collab>
        <year>2010</year>
        <comment><ext-link ext-link-type="uri" xlink:href="http://www.novocraft.com/">http://www.novocraft.com/</ext-link>. (last accessed date October 16, 2011)</comment>
      </element-citation>
    </ref>
    <ref id="B14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ruffalo</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comparative analysis of algorithms for next-generation sequencing read alignment</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>2790</fpage>
        <lpage>2796</lpage>
        <pub-id pub-id-type="pmid">21856737</pub-id>
      </element-citation>
    </ref>
    <ref id="B15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schmidt</surname>
            <given-names>D.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Chip-seq: using high-throughput sequencing to discover protein-dna interactions</article-title>
        <source>Methods</source>
        <year>2009</year>
        <volume>48</volume>
        <fpage>240</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="pmid">19275939</pub-id>
      </element-citation>
    </ref>
    <ref id="B16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of gene expression, cpg island methylation, and gene copy number in breast cancer cells by deep sequencing</article-title>
        <source>PLoS One</source>
        <year>2011</year>
        <volume>6</volume>
        <fpage>e17490</fpage>
        <pub-id pub-id-type="pmid">21364760</pub-id>
      </element-citation>
    </ref>
    <ref id="B17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNA-Seq: a revolutionary tool for transcriptomics</article-title>
        <source>Nat. Rev. Genet.</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>57</fpage>
        <lpage>63</lpage>
        <pub-id pub-id-type="pmid">19015660</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
