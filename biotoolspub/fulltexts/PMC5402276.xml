<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NPG//DTD XML Article//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName NPG_XML_Article.dtd?>
<?SourceDTD.Version 2.7.10?>
<?ConverterInfo.XSLTName nature2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Sci Rep</journal-id>
    <journal-id journal-id-type="iso-abbrev">Sci Rep</journal-id>
    <journal-title-group>
      <journal-title>Scientific Reports</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2045-2322</issn>
    <publisher>
      <publisher-name>Nature Publishing Group</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5402276</article-id>
    <article-id pub-id-type="pii">srep46769</article-id>
    <article-id pub-id-type="doi">10.1038/srep46769</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>PathoSpotter-K: A computational tool for the automatic identification of glomerular lesions in histological images of kidneys</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Barros</surname>
          <given-names>George O.</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Navarro</surname>
          <given-names>Brenda</given-names>
        </name>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Duarte</surname>
          <given-names>Angelo</given-names>
        </name>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>dos-Santos</surname>
          <given-names>Washington L. C.</given-names>
        </name>
        <xref ref-type="aff" rid="a2">2</xref>
      </contrib>
      <aff id="a1"><label>1</label><institution>Universidade Estadual de Feira de Santana (UEFS) - Programa de Pos-Graduacao em Computacao Aplicada, Feira de Santana</institution>, Bahia, <country>Brazil</country></aff>
      <aff id="a2"><label>2</label><institution>Fundacao Oswaldo Cruz (FIOCRUZ) - Instituto Gonçalo Moniz</institution>, Salvador, Bahia, <country>Brazil</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email>angeloduarte@uefs.br</email>
      </corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>04</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2017</year>
    </pub-date>
    <volume>7</volume>
    <elocation-id>46769</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>01</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>03</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2017, The Author(s)</copyright-statement>
      <copyright-year>2017</copyright-year>
      <copyright-holder>The Author(s)</copyright-holder>
      <license xmlns:xlink="http://www.w3.org/1999/xlink" license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <!--author-paid-->
        <license-p>This work is licensed under a Creative Commons Attribution 4.0 International License. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in the credit line; if the material is not included under the Creative Commons license, users will need to obtain permission from the license holder to reproduce the material. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p>PathoSpotter is a computational system designed to assist pathologists in teaching about and researching kidney diseases. PathoSpotter-K is the version that was developed to detect nephrological lesions in digital images of kidneys. Here, we present the results obtained using the first version of PathoSpotter-K, which uses classical image processing and pattern recognition methods to detect proliferative glomerular lesions with an accuracy of 88.3 ± 3.6%. Such performance is only achieved by similar systems if they use images of cell in contexts that are much less complex than the glomerular structure. The results indicate that the approach can be applied to the development of systems designed to train pathology students and to assist pathologists in determining large-scale clinicopathological correlations in morphological research.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p>Pathology is a medical specialty that diagnoses diseases using the morphology of cell and tissue lesions observed in cytology smears and in histological slides. Cytology smears contain dispersed cells obtained from body secretions, aspiration biopsies, or scraped surfaces. Histological slides are tissue sections of 2–4 μm in thickness that are stained using techniques designed to highlight different structures<xref ref-type="bibr" rid="b1">1</xref><xref ref-type="bibr" rid="b2">2</xref>. Experienced pathologists can integrate clinical, laboratory and morphological data to generate an anatomopathological diagnosis, which supports the treatment and provision of prognosis of diseases. Although the anatomopathological diagnosis is complex, its morphological component is built upon elementary lesions associated with various diseases in a variety of ways<xref ref-type="bibr" rid="b1">1</xref><xref ref-type="bibr" rid="b3">3</xref>. For instance, glomerular hypercellularity (an elementary lesion) may be present in several types of kidney diseases, such as post-infectious glomerulonephritis, membranoproliferative glomerulonephritis associated with systemic lupus erythematous, or diabetic glomerulopathy<xref ref-type="bibr" rid="b4">4</xref>. Elementary lesions can be objectively defined and constitute the basis of the most precise and effective communication between pathologists regarding anatomopathological diagnosis criteria<xref ref-type="bibr" rid="b3">3</xref>. They also form the basis for teaching young pathologists.</p>
  <p>Since the 1950s, several researchers have devoted their time to finding automatized classification techniques that monitor cell changes in cytology smears<xref ref-type="bibr" rid="b5">5</xref>. Although cytology classification systems still require further study, their use has contributed to decreasing the subjectivity and workload in cytology analysis<xref ref-type="bibr" rid="b6">6</xref>. Advances in cytology automation have stimulated developments in the analysis of tissue sections<xref ref-type="bibr" rid="b7">7</xref>. Cytology analysis mainly relies on the characteristics of dispersed or partially dispersed cells. The analysis of tissue sections relies on changes in cell morphology and the relationship between the cells and extracellular components. In the 1990s, advances in radiological digital imaging enabled the digital analysis of biomedical structures<xref ref-type="bibr" rid="b8">8</xref>. Hence, automated or semi-automated computer-assisted measurements have become common practice in pathology. Most of the development in the computational analysis of biological tissue imaging in pathology has occurred for cancer classification, where cell changes are predominant<xref ref-type="bibr" rid="b9">9</xref>. These developments are usually an extension of the process that extracts cell chromatin characteristics, as used in cytology, or analyses of the color and texture of images obtained from tissue sections stained via immunohistochemistry. Little development has occurred for the histological analysis of non-neoplastic lesions; cell changes in this case may be subtle, while the cell–extracellular matrix relationship is increasingly relevant. There are even fewer advances with respect to nephrological diseases, for which the diagnosis relies on multiple elementary lesions and strong clinical-pathological correlations<xref ref-type="bibr" rid="b10">10</xref>.</p>
  <p>The translation of elementary nephrological lesions into some form of computational language would enable large-scale clinical-pathological associations via a large database and contribute to the training of young pathologists. In this study, we present the early results related to the ability of PathoSpotter-K to identify elementary glomerular lesions. PathoSpotter-K is a branch of the PathoSpotter project, which is an interdisciplinary research project that joins pathologists and computer scientists with the aim of generating computational systems that support research and training in pathology.</p>
  <sec disp-level="1">
    <title>Materials and Methods</title>
    <p>The standard method used to diagnose glomerular hypercellularity is to visually inspect histological sections from the glomeruli, searching for the presence of clusters formed by four or more cell nuclei in the mesangial area or by cell aggregates that fill the capillary lumen<xref ref-type="bibr" rid="b1">1</xref><xref ref-type="bibr" rid="b3">3</xref>; this change is the key to distinguishing proliferative glomerulopathy. As an example, in <xref ref-type="fig" rid="f1">Fig. 1a</xref>, the enlarged circle highlights a cell cluster in the mesangial area and a glomerular capillary lumen filled with nucleated cells in the case of proliferative glomerulonephritis. <xref ref-type="fig" rid="f1">Figure 1b</xref> illustrates a normal glomerulus, with no significant clusters in the mesangial area or in the capillary lumen. In both figures, the nuclei are distinguished as structures with a strong dark blue color.</p>
    <p>There are no standard or robust criteria for nuclear segmentation that would allow for defining a cluster of nuclei; therefore, the identification of clusters of nuclei is subjective and highly dependent on a pathologist’s experience. This subjectivity makes standardization of this method via computational techniques particularly challenging to implement because modeling the expertise of a pathologist is very difficult<xref ref-type="bibr" rid="b11">11</xref>. Therefore, as in any conventional pattern recognition system, our first task was to identify a set of attributes (features) from the images to build a feature vector that effectively differentiates normal glomeruli from glomeruli with cell proliferation. After performing preliminary analyses and experiments, we realized that the ratio between the number of nuclei and the number of clusters could be a good discriminant feature. At this point, we focused on finding a way to automatically extract this ratio to perform automatic image classification. The next sections describe the methods used to achieve this goal. PathoSpotter-K was developed with Python 2.7 using algorithms from the Scikit-image library (image processing functions) and from the Scikit-learn library (machine learning functions)<xref ref-type="bibr" rid="b12">12</xref><xref ref-type="bibr" rid="b13">13</xref>.</p>
    <sec disp-level="2">
      <title>Renal biopsy</title>
      <p>Small kidney fragments were obtained either by percutaneous needle puncture or surgically and processed according to the recommended guidelines<xref ref-type="bibr" rid="b2">2</xref>. Briefly, the biopsies were fixed in formalin (to preserve their histological structure), embedded in paraffin, cut into 2–3 μm thick sections, and finally stained using one of the following techniques: hematoxylin and eosin (H&amp;E) and periodic acid–Schiff (PAS), periodic acid-methenamine silver stain (PAMS), Mallory’s trichrome (AZAN) or picrosirius red stain. The images used in this study were from renal tissue sections stained with H&amp;E and PAS according to the following protocol:</p>
      <p>For H&amp;E staining, the sections of renal tissue were immersed for 1 minute in Harris’ hematoxylin, rinsed for 5 minutes under running water, dipped in 1% eosin for 30 seconds and placed in a 1% acetic acid solution for 10 seconds. For PAS staining, the kidney tissue sections were dipped in 1% periodic acid for 10 minutes, washed under running water and submerged in Schiff’s reagent for 30 minutes. They were washed again for 2 minutes under running water, dipped in Harris’ hematoxylin for 1 minute and washed under running water for 5 minutes. After staining, the sections were dehydrated in alcohol, clarified in xylol and mounted using Canada balsam.</p>
    </sec>
    <sec disp-level="2">
      <title>Digital image library</title>
      <p>The digital image library was built by Dr. Washington LC dos-Santos (MD) and includes images of all the kidney biopsies performed for the diagnosis of glomerular diseases in referral nephrology services of the public hospitals of Bahia State, Brazil; the images were examined at the Gonçalo Moniz Institute – Fiocruz (IGM-FIOCRUZ) between 2003 and 2015. The image library contains approximately 80,000 digital images of various types of renal disease. Only slides with high technical staining quality were used for producing the images included in the library. The general characteristics of the patients whose renal biopsies were used to produce the image library are shown in <xref ref-type="table" rid="t1">Table 1</xref>.</p>
    </sec>
    <sec disp-level="2">
      <title>Data set</title>
      <p>The digital images of glomeruli used in this work were selected from the digital image library described above. They were captured using an Olympus QColor 3 digital camera attached to a Nikon E600 optical microscope (using x200 magnification). The dataset images differed based on various features, such as the type of dye used to stain the tissue sections (either H&amp;E or PAS) and morphological differences inherent to a patient’s age, type of disease, glomerulus position, and section plane. In this work, we used 811 images, including 300 images of normal glomeruli and 511 images of glomeruli from kidneys with proliferative glomerulopathies. Some of these images are presented in <xref ref-type="fig" rid="f2">Fig. 2</xref>.</p>
    </sec>
    <sec disp-level="2">
      <title>System Architecture</title>
      <p>As shown in <xref ref-type="fig" rid="f3">Fig. 3</xref>, PathoSpotter-K follows the typical architecture of a conventional image pattern recognition system<xref ref-type="bibr" rid="b14">14</xref>. The system consists of four sequential stages: preprocessing, segmentation, feature extraction and classification.</p>
    </sec>
    <sec disp-level="2">
      <title>Preprocessing</title>
      <p>In this stage, two operations are performed: the areas of interest are highlighted, and noise is reduced. The first operation changes the images’ color space to facilitate the segmentation process to be performed in the next stage. Such changes were made using the color deconvolution method proposed by Ruifrok and Johnston, which was successfully used as a digital pathology method that segments different types of structures in biological tissues<xref ref-type="bibr" rid="b15">15</xref><xref ref-type="bibr" rid="b16">16</xref><xref ref-type="bibr" rid="b17">17</xref>. The color deconvolution is an image-processing algorithm that provides a robust and flexible method for representing a glomerulus image in channels, separating the dyes that were used to acquire it. The image processing library Scikit-image, developed by Van der Walt and colleagues<xref ref-type="bibr" rid="b12">12</xref>, contains a method for converting the color space from RGB to HED. The HED color space stores the information from hematoxylin, eosin, and DAB as three separate images. We chose the hematoxylin color channel, represented by a matrix <bold>H</bold> (in which each element is in the range [0, 255]), herein referred to as the H-matrix, because the nuclei were stained using hematoxylin and thus yield the brightness information in the <bold>H</bold>-matrix. Consequentially, the H-matrix can be interpreted as an image containing only the areas in the original image that are stained by hematoxylin.</p>
      <p>The H-image is contaminated by noise related to textural information, which complicates the segmentation process before the feature extraction. For instance, nuclei fragments may produce noise. The nuclei fragments interfere in the segmentation phase because a fragment may be misclassified as a whole nucleus. To minimize this interference without having to tackle an increase in the computational complexity to differentiate the fragments, we treated the nuclei fragments that are large enough to pass through the noise reduction filter as whole nuclei.</p>
      <p>To reduce such noise, we applied a smoothing filter based on the median filter, with a window of 3 × 3 pixels, which eliminates the noise interference while preserving the borders of the nuclei, which is crucial for accurate segmentation. <xref ref-type="fig" rid="f4">Figure 4</xref> depicts the operations result of the preprocessing stage. Since we transformed the images to black and white mode before segmenting the nuclei, and since the color separation method used works regardless whether sections were stained using the H&amp;E or PAS technique, PathoSpotter-K is not sensitive to the dye at the moment.</p>
    </sec>
    <sec disp-level="2">
      <title>Segmentation</title>
      <p>The segmentation method used to separate the nuclei in the image was inspired by the work of Miranda and colleagues (2012), who isolated structures from cervical cell images; the work of Mathur and colleagues (2013), who isolated structures from blood white cell images; and the work of Schochlin and colleagues, who isolated structures from skin cancer cell images<xref ref-type="bibr" rid="b18">18</xref><xref ref-type="bibr" rid="b19">19</xref><xref ref-type="bibr" rid="b20">20</xref>.</p>
      <p>We used the morphological operations of closing for reconstruction, together with the Otsu method to segment the cell nuclei. Initially, we performed a closing morphological operation using the top-hat operator to highlight the cell nuclei in the images. After using the closing morphological operation, we applied the Otsu method to generate binary images (only black and white pixels). Finally, we performed the closing morphological operation again to improve the representation of the nuclei and to reduce the noise introduced by the binarization. <xref ref-type="fig" rid="f5">Figure 5</xref> shows the steps performed in the segmentation stage.</p>
      <p>The image produced via the Otsu method is a binary image that depicts nuclei in white and everything else in black. After binarization, we used the method of growing by pixel-aggregation to identify nuclei and clusters. This method begins by searching for pixel-seeds that satisfy specific properties. These seeds serve as starting points to identify surrounding pixels to build a region. After identifying a seed pixel (we used the pixel brightness as a property), the area around this pixel grows by including neighboring pixels with similar properties until there are no pixels left to attach. Once the region is created, it receives a unique identifier, and the algorithm searches for other regions in the image. The identification of regions via edge and neighborhood analysis was performed using the “regionprops” method from the Scikit-image library. The resulting array contained information specific to each identified region.</p>
    </sec>
    <sec disp-level="2">
      <title>Feature Extraction</title>
      <p>This stage extracts quantitative information required to differentiate images with or without proliferative glomerular lesions. We tested three image metrics as candidates for discriminants: 1) the number of regions with nuclei, 2) the agglomeration of nuclei and 3) the pixel density. These metrics were correlated with the proliferation that occurs in a glomerulus resulting from proliferative lesions. The number of regions with nuclei was counted using the “regionprops” property in the Scikit-image library, which uses edge detection and region growth methods. Each region was characterized by a group of pixels with the same brightness. The number of agglomerations was extracted using the Laplacian of Gaussian (LoG) method – also implemented from the library – which works as a bubble detection method. The LoG method was used to identify the number of nuclei from neighboring cells that were close enough, but not necessarily bound to each other, to form a cluster. Finally, the last characteristic, pixel density, was computed by dividing the number of white pixels (pxW) by the number of black pixels (pxB).</p>
      <p>To analyze if the metrics were sufficiently able to indicate a lesion, we compared them using histograms. Each histogram plots the distribution of images for each specific metric. A good metric must clearly differentiate the images of normal glomeruli from the images of lesioned glomeruli. <xref ref-type="fig" rid="f6">Figure 6</xref> shows the distribution of the images relative to the combination of metrics.</p>
    </sec>
    <sec disp-level="2">
      <title>Classification and Validation</title>
      <p>PathoSpotter-K uses a binary classifier based on the kNN (k-Nearest Neighbor) algorithm. The classifier was adjusted using 90% of the images from the dataset as the generalization set. The remaining 10% was separated for assessing the classifier performance (validation set). We used the k-fold cross validation method to split the generalization set into 10 subsets to parametrize the classifier. This number of subsets was chosen based on the literature<xref ref-type="bibr" rid="b21">21</xref><xref ref-type="bibr" rid="b22">22</xref><xref ref-type="bibr" rid="b23">23</xref>. To parameterize the kNN classifier, we adjusted the distance metrics and the k-parameter (nearest neighbors). We also tested the Euclidean, Manhattan and Minkowski distance metrics with values of k ranging from 3 to 80. The maximum value of k corresponded to the total number of samples in each fold, and the minimum values corresponded to the number of classes plus 1. We evaluated the classifier’s model and the parametrization by assessing the error rate<xref ref-type="bibr" rid="b24">24</xref>. <xref ref-type="fig" rid="f7">Figure 7</xref> depicts the relation between the three distances and the k-parameter. The yellow dot indicates the configuration for the lowest error, which corresponds to the Manhattan distance using k = 11. The precision, recall, accuracy and standard deviation were obtained using the scheme depicted in <xref ref-type="fig" rid="f8">Fig. 8</xref>.</p>
    </sec>
    <sec disp-level="2">
      <title>Ethical considerations</title>
      <p>The study was conducted in accordance with resolution No. 466/12 of the National Health Council. To preserve confidentiality, the images (including those shown in the paper) were separated from the other patient data. No data presented herein allows patient identification. All the procedures were approved by the Ethics Committee for Research Involving Human Subjects of the Gonçalo Moniz Institute from the Oswald Cruz Foundation (CPqGM/FIOCRUZ), Protocols No. 188/09 and No. 1.817.574.</p>
    </sec>
  </sec>
  <sec disp-level="1">
    <title>Results and Discussion</title>
    <p>The classifier’s performance was evaluated using the metrics derived from the confusion matrix<xref ref-type="bibr" rid="b25">25</xref>. Using the generalization set, the system yielded 92.3% precision, 88.0% recall and 88.3 ± 3.6% accuracy. Using the validation set, we obtained 88% precision, 88% recall and 85% accuracy. Compared to similar work in the digital pathology literature, the 88% accuracy achieved by PathoSpotter-K is equivalent to the results obtained by Kothari and colleagues (77%)<xref ref-type="bibr" rid="b26">26</xref>, Sirinukunwattana and colleagues (77%)<xref ref-type="bibr" rid="b23">23</xref>, Schochlin and colleagues (88.9%)<xref ref-type="bibr" rid="b20">20</xref>, and Mathur and colleagues (92%)<xref ref-type="bibr" rid="b18">18</xref>.</p>
    <p>Although the results of PathoSpotter-K can be compared to similar works performed using cytological smears and images of cell changes that are much less complex than images from histological sections, we believe that the imbalance between the number of glomeruli images with and without lesions has mostly influenced the parametrization and, as a consequence, the final performance of the classification. The reason for this imbalance is that the original dataset images were obtained with the intention to teach others regarding the diagnosis of kidney diseases and not to build a classification system. Currently, this dataset is being populated with images of normal glomeruli so that we can reparametrize the system to improve its performance in the near future.</p>
  </sec>
  <sec disp-level="1">
    <title>Concluding Remarks</title>
    <p>In this paper, we presented PathoSpotter-K, a computational system that assists pathologists in teaching and researching nephrology using digital images of glomeruli. We used a combination of classical image processing and machine learning methods to create a pattern classification system for kidney pathology, an understudied area in digital pathology. A web service is under construction so that we can simplify the access to our system and increase the number of pathologists and computational science professionals who can help to improve the system. We intend on improving the accuracy of PathoSpotter-K by searching for better image metrics and using additional classification algorithms. We will also increase the number of samples in the dataset to better parametrize the data while improving robustness. Additionally, we want to expand the capabilities of PathoSpotter-K to classify additional classes of glomerular lesions.</p>
  </sec>
  <sec disp-level="1">
    <title>Additional Information</title>
    <p><bold>How to cite this article:</bold> Barros, G. O. <italic>et al</italic>. PathoSpotter-K: A computational tool for the automatic identification of glomerular lesions in histological images of kidneys. <italic>Sci. Rep.</italic>
<bold>7</bold>, 46769; doi: 10.1038/srep46769 (2017).</p>
    <p><bold>Publisher's note:</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
  </sec>
</body>
<back>
  <ack>
    <p>George Barros received a grant from the Coordination for the Improvement of Higher Education Personnel of Brazil (CAPES). The image dataset used in this work was built with support from the Support Program for the Diagnosis of Hepatic and Renal Diseases, founded by the Gonçalo Moniz Institute, from the Oswaldo Cruz Foundation, Ministry of Health, Brazil.</p>
  </ack>
  <ref-list>
    <ref id="b1">
      <mixed-citation publication-type="journal"><name><surname>Churg</surname><given-names>J.</given-names></name>, <name><surname>Bernstein</surname><given-names>J.</given-names></name> &amp; <name><surname>Glassock</surname><given-names>R. J.</given-names></name>
<source>Renal disease: classification and atlas of glomerular diseases</source>. 2 edn (Igaku-Shoin, <year>1995</year>).</mixed-citation>
    </ref>
    <ref id="b2">
      <mixed-citation publication-type="journal"><name><surname>Walker</surname><given-names>P. D.</given-names></name>, <name><surname>Cavallo</surname><given-names>T.</given-names></name> &amp; <name><surname>Bonsib</surname><given-names>S. M.</given-names></name>
<article-title>Practice guidelines for the renal biopsy</article-title>. <source>Mod Pathol</source>
<volume>17</volume>, <fpage>1555</fpage>–<lpage>1563</lpage> (<year>2004</year>).<pub-id pub-id-type="pmid">15272280</pub-id></mixed-citation>
    </ref>
    <ref id="b3">
      <mixed-citation publication-type="journal"><name><surname>Fogo</surname><given-names>A. B.</given-names></name><article-title>Approach to renal biopsy</article-title>. <source>Am J Kidney Dis</source><volume>42</volume>, <fpage>826</fpage>–<lpage>836</lpage>, doi: S0272638603010540 (<year>2003</year>).<pub-id pub-id-type="pmid">14520635</pub-id></mixed-citation>
    </ref>
    <ref id="b4">
      <mixed-citation publication-type="journal"><name><surname>Chang</surname><given-names>A.</given-names></name><etal/>. <article-title>A position paper on standardizing the nonneoplastic kidney biopsy report</article-title>. <source>Hum Pathol</source>, doi: <pub-id pub-id-type="doi">10.1016/j.humpath.2012.04.009</pub-id> (<year>2012</year>).</mixed-citation>
    </ref>
    <ref id="b5">
      <mixed-citation publication-type="journal"><name><surname>Tolles</surname><given-names>W. E.</given-names></name><article-title>The cytoanalyzer-an example of physics in medical research</article-title>. <source>Trans N Y Acad Sci</source><volume>17</volume>, <fpage>250</fpage>–<lpage>256</lpage> (<year>1955</year>).<pub-id pub-id-type="pmid">14359408</pub-id></mixed-citation>
    </ref>
    <ref id="b6">
      <mixed-citation publication-type="journal"><name><surname>Wilbur</surname><given-names>D. C.</given-names></name><article-title>Digital cytology: current state of the art and prospects for the future</article-title>. <source>Acta Cytol</source><volume>55</volume>, <fpage>227</fpage>–<lpage>238</lpage>, doi: <pub-id pub-id-type="doi">10.1159/000324734</pub-id> (<year>2011</year>).<pub-id pub-id-type="pmid">21525733</pub-id></mixed-citation>
    </ref>
    <ref id="b7">
      <mixed-citation publication-type="journal"><name><surname>Pantanowitz</surname><given-names>L.</given-names></name><article-title>Digital images and the future of digital pathology</article-title>. <source>J Pathol Inform</source><volume>1</volume>, doi: <pub-id pub-id-type="doi">10.4103/2153-3539.68332</pub-id> (<year>2010</year>).</mixed-citation>
    </ref>
    <ref id="b8">
      <mixed-citation publication-type="journal"><name><surname>Ratib</surname><given-names>O.</given-names></name><article-title>Imaging informatics: from image management to image navigation</article-title>. <source>Yearb Med Inform</source><fpage>172</fpage> (<year>2009</year>).</mixed-citation>
    </ref>
    <ref id="b9">
      <mixed-citation publication-type="journal"><name><surname>Gurcan</surname><given-names>M. N.</given-names></name><etal/>. <article-title>Histopathological image analysis: a review</article-title>. <source>IEEE Rev Biomed Eng</source><volume>2</volume>, <fpage>147</fpage>–<lpage>171</lpage>, doi: <pub-id pub-id-type="doi">10.1109/RBME.2009.2034865</pub-id> (<year>2009</year>).<pub-id pub-id-type="pmid">20671804</pub-id></mixed-citation>
    </ref>
    <ref id="b10">
      <mixed-citation publication-type="journal"><name><surname>Rosenberg</surname><given-names>A. Z.</given-names></name><etal/>. <article-title>The Application of Digital Pathology to Improve Accuracy in Glomerular Enumeration in Renal Biopsies</article-title>. <source>PLoS One</source><volume>11</volume>, <fpage>e0156441</fpage>, doi: <pub-id pub-id-type="doi">10.1371/journal.pone.0156441</pub-id> (<year>2016</year>).<pub-id pub-id-type="pmid">27310011</pub-id></mixed-citation>
    </ref>
    <ref id="b11">
      <mixed-citation publication-type="journal"><name><surname>He</surname><given-names>L.</given-names></name>, <name><surname>Long</surname><given-names>L. R.</given-names></name>, <name><surname>Antani</surname><given-names>S.</given-names></name> &amp; <name><surname>Thoma</surname><given-names>G. R.</given-names></name>
<article-title>Histology image analysis for carcinoma detection and grading</article-title>. <source>Comput Methods Programs Biomed</source>
<volume>107</volume>, <fpage>538</fpage>–<lpage>556</lpage>, doi: <pub-id pub-id-type="doi">10.1016/j.cmpb.2011.12.007</pub-id> (<year>2012</year>).<pub-id pub-id-type="pmid">22436890</pub-id></mixed-citation>
    </ref>
    <ref id="b12">
      <mixed-citation publication-type="journal"><name><surname>van der Walt</surname><given-names>S.</given-names></name><etal/>. <article-title>scikit-image: image processing in Python</article-title>. <source>PeerJ</source><volume>2</volume>, <fpage>e453</fpage>, doi: <pub-id pub-id-type="doi">10.7717/peerj.453</pub-id> (<year>2014</year>).<pub-id pub-id-type="pmid">25024921</pub-id></mixed-citation>
    </ref>
    <ref id="b13">
      <mixed-citation publication-type="journal"><name><surname>Hackeling</surname><given-names>G.</given-names></name><source>Mastering Machine Learning with scikit-learn</source>. <fpage>238</fpage> (Packt Publishing, <year>2014</year>).</mixed-citation>
    </ref>
    <ref id="b14">
      <mixed-citation publication-type="journal"><name><surname>Gonzalez</surname><given-names>R. C.</given-names></name> &amp; <name><surname>Woods</surname><given-names>R. E.</given-names></name>
<source>Digital image processing</source>. <volume>3</volume> edn <fpage>954</fpage> (Prentice Hall, <year>2008</year>).</mixed-citation>
    </ref>
    <ref id="b15">
      <mixed-citation publication-type="journal"><name><surname>Ruifrok</surname><given-names>A. C.</given-names></name> &amp; <name><surname>Johnston</surname><given-names>D. A.</given-names></name>
<article-title>Quantification of histochemical staining by color deconvolution</article-title>. <source>Anal Quant Cytol Histol</source>
<volume>23</volume>, <fpage>291</fpage>–<lpage>299</lpage> (<year>2001</year>).<pub-id pub-id-type="pmid">11531144</pub-id></mixed-citation>
    </ref>
    <ref id="b16">
      <mixed-citation publication-type="journal"><name><surname>Veillard</surname><given-names>A.</given-names></name>, <name><surname>Kulikova</surname><given-names>M. S.</given-names></name> &amp; <name><surname>Racoceanu</surname><given-names>D.</given-names></name>
<article-title>Cell nuclei extraction from breast cancer histopathologyimages using colour, texture, scale and shape information</article-title>. <source>Diagnostic Pathology</source>
<volume>8</volume>, <fpage>1</fpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23298385</pub-id></mixed-citation>
    </ref>
    <ref id="b17">
      <mixed-citation publication-type="journal"><name><surname>Wang</surname><given-names>C. W.</given-names></name>, <name><surname>Fennell</surname><given-names>D.</given-names></name>, <name><surname>Paul</surname><given-names>I.</given-names></name>, <name><surname>Savage</surname><given-names>K.</given-names></name> &amp; <name><surname>Hamilton</surname><given-names>P.</given-names></name>
<article-title>Robust automated tumour segmentation on histological and immunohistochemical tissue images</article-title>. <source>PLoS One</source>
<volume>6</volume>, <fpage>e15818</fpage>, doi: <pub-id pub-id-type="doi">10.1371/journal.pone.0015818</pub-id> (<year>2011</year>).<pub-id pub-id-type="pmid">21386898</pub-id></mixed-citation>
    </ref>
    <ref id="b18">
      <mixed-citation publication-type="journal"><name><surname>Mathur</surname><given-names>A.</given-names></name>, <name><surname>Tripathi</surname><given-names>A. S.</given-names></name> &amp; <name><surname>Kuse</surname><given-names>M.</given-names></name>
<article-title>Scalable system for classification of white blood cells from Leishman stained blood stain images</article-title>. <source>J Pathol Inform</source>
<volume>4</volume>, <fpage>S15</fpage>, doi: <pub-id pub-id-type="doi">10.4103/2153-3539.109883</pub-id> (<year>2013</year>).<pub-id pub-id-type="pmid">23766937</pub-id></mixed-citation>
    </ref>
    <ref id="b19">
      <mixed-citation publication-type="journal"><name><surname>Miranda</surname><given-names>G. H. B.</given-names></name>, <name><surname>Barrera</surname><given-names>J.</given-names></name>, <name><surname>Soares</surname><given-names>E. G.</given-names></name> &amp; <name><surname>Felipe</surname><given-names>J. C.</given-names></name>
<article-title>Structural analysis of histological images to aid diagnosis of cervical cancer</article-title>. In <source>Proceedings of the 25th SIBGRAPI Conference on Graphics, Patterns and Images (SIBGRAPI), Ouro Preto, MG, Brazil</source>
<fpage>316</fpage>–<lpage>323</lpage> (<year>2012</year>).</mixed-citation>
    </ref>
    <ref id="b20">
      <mixed-citation publication-type="journal"><name><surname>Schochlin</surname><given-names>M.</given-names></name><etal/>. <article-title>A nuclear circularity-based classifier for diagnostic distinction of desmoplastic from spindle cell melanoma in digitized histological images</article-title>. <source>J Pathol Inform</source><volume>5</volume>, <fpage>40</fpage>, doi: <pub-id pub-id-type="doi">10.4103/2153-3539.143335</pub-id> (<year>2014</year>).<pub-id pub-id-type="pmid">25379346</pub-id></mixed-citation>
    </ref>
    <ref id="b21">
      <mixed-citation publication-type="journal"><name><surname>James</surname><given-names>G.</given-names></name>, <name><surname>Witten</surname><given-names>D.</given-names></name>, <name><surname>Hastie</surname><given-names>T.</given-names></name> &amp; <name><surname>Tibshirani</surname><given-names>R.</given-names></name>
<source>An Introduction to Statistical Learning with Applications in R</source>
<volume>Vol. 103</volume> (Springer: New York, <year>2013</year>).</mixed-citation>
    </ref>
    <ref id="b22">
      <mixed-citation publication-type="journal"><name><surname>Japkowicz</surname><given-names>N.</given-names></name> &amp; <name><surname>Shah</surname><given-names>M.</given-names></name>
<source>Evaluating learning algorithms: a classification perspective</source>. <bold>1</bold> edn <fpage>424</fpage> (Cambridge University Press, <year>2011</year>).</mixed-citation>
    </ref>
    <ref id="b23">
      <mixed-citation publication-type="journal"><name><surname>Sirinukunwattana</surname><given-names>K.</given-names></name>, <name><surname>Khan</surname><given-names>A. M.</given-names></name> &amp; <name><surname>Rajpoot</surname><given-names>N. M.</given-names></name>
<article-title>Cell words: Modelling the visual appearance of cells in histopathology images</article-title>. <source>Computerized Medical Imaging and Graphics</source>
<volume>42</volume>, <fpage>16</fpage>–<lpage>24</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25498246</pub-id></mixed-citation>
    </ref>
    <ref id="b24">
      <mixed-citation publication-type="journal"><name><surname>Kirk</surname><given-names>M.</given-names></name><source>Thoughtful Machine Learning: A Test-Driven Approach</source>. <bold>1</bold> edn <fpage>236</fpage> (O’Reilly Media, <year>2014</year>).</mixed-citation>
    </ref>
    <ref id="b25">
      <mixed-citation publication-type="journal"><name><surname>Theodoridis</surname><given-names>S.</given-names></name> &amp; <name><surname>Koutroumbas</surname><given-names>K.</given-names></name>
<source>Pattern Recognition</source>. <bold>4</bold> edn <fpage>984</fpage> (Academic Press, <year>2009</year>).</mixed-citation>
    </ref>
    <ref id="b26">
      <mixed-citation publication-type="journal"><name><surname>Kothari</surname><given-names>S.</given-names></name>, <name><surname>Phan</surname><given-names>J. H.</given-names></name>, <name><surname>Young</surname><given-names>A. N.</given-names></name> &amp; <name><surname>Wang</surname><given-names>M. D.</given-names></name>
<article-title>Histological image classification using biologically interpretable shape-based features</article-title>. <source>BMC medical imaging</source>
<volume>13</volume>, <fpage>1</fpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23289431</pub-id></mixed-citation>
    </ref>
  </ref-list>
  <fn-group>
    <fn fn-type="COI-statement">
      <p>The authors declare no competing financial interests.</p>
    </fn>
    <fn>
      <p><bold>Author Contributions</bold> Designed the experiment: W.L.C.S., A.A.D. Built the image dataset: W.L.C.S. Selected the images: B.N., W.L.C.S. System architecture design: G.B., A.A.D. System development: G.B., A.A.D. Validation tests: G.B., A.A.D., W.L.C.S. Analysis of the results: G.B., A.A.D., W.L.C.S.</p>
    </fn>
  </fn-group>
</back>
<floats-group>
  <fig id="f1">
    <label>Figure 1</label>
    <caption>
      <title>Two images of glomeruli.</title>
      <p>(<bold>a</bold>) Glomerulus with a proliferative glomerulopathy. (<bold>b</bold>) Normal glomerulus. The enlarged areas (<bold>a</bold>’,<bold>b</bold>’) emphasize cell clusters and highlight proliferative vs non-proliferative areas, respectively. Stained with hematoxylin and eosin. Magnification bar = 60 μm.</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f1"/>
  </fig>
  <fig id="f2">
    <label>Figure 2</label>
    <caption>
      <title>Representative images from the dataset.</title>
      <p>Images (<bold>a–d</bold>) represent glomeruli with proliferative lesions. Images (<bold>e–h</bold>) represent normal glomeruli. Stained with hematoxylin and eosin. Magnification bar = 60 μm.</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f2"/>
  </fig>
  <fig id="f3">
    <label>Figure 3</label>
    <caption>
      <title>PathoSpotter-K system architecture.</title>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f3"/>
  </fig>
  <fig id="f4">
    <label>Figure 4</label>
    <caption>
      <p>Operation for separating the hematoxylin information (<bold>b</bold>) from the original colored image (<bold>a</bold>).</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f4"/>
  </fig>
  <fig id="f5">
    <label>Figure 5</label>
    <caption>
      <title>Segmentation stages.</title>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f5"/>
  </fig>
  <fig id="f6">
    <label>Figure 6</label>
    <caption>
      <title>Distribution of the images into the feature space.</title>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f6"/>
  </fig>
  <fig id="f7">
    <label>Figure 7</label>
    <caption>
      <title>Error rates for the different kNN models tested.</title>
      <p>The yellow dot indicates the better configuration (Manhattan with k = 11).</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f7"/>
  </fig>
  <fig id="f8">
    <label>Figure 8</label>
    <caption>
      <title>Organization of the datasets used to configure the kNN classifier.</title>
      <p>The generalization set yielded 10 different subsets according to the k-fold method.</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="srep46769-f8"/>
  </fig>
  <table-wrap position="float" id="t1">
    <label>Table 1</label>
    <caption>
      <title>General characteristics of the patients submitted to renal biopsies for diagnostic purposes and used to produce the image library.</title>
    </caption>
    <table frame="hsides" rules="groups" border="1">
      <colgroup>
        <col align="left"/>
        <col align="center"/>
        <col align="center"/>
        <col align="center"/>
      </colgroup>
      <thead valign="bottom">
        <tr>
          <th rowspan="2" align="left" valign="top" charoff="50">Parameter</th>
          <th colspan="2" align="center" valign="top" charoff="50">Cell Proliferation<hr/></th>
          <th rowspan="2" align="center" valign="top" charoff="50">Total</th>
        </tr>
        <tr>
          <th align="center" valign="top" charoff="50">Yes</th>
          <th align="center" valign="top" charoff="50">No</th>
        </tr>
      </thead>
      <tbody valign="top">
        <tr>
          <td align="left" valign="top" charoff="50">N</td>
          <td align="center" valign="top" charoff="50">869 (100%)</td>
          <td align="center" valign="top" charoff="50">439 (100%)</td>
          <td align="center" valign="top" charoff="50">1308 (100%)</td>
        </tr>
        <tr>
          <td colspan="4" align="left" valign="top" charoff="50">Sex:</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Female</td>
          <td align="center" valign="top" charoff="50">486 (56%)</td>
          <td align="center" valign="top" charoff="50">203 (46%)</td>
          <td align="center" valign="top" charoff="50">689 (53%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Male</td>
          <td align="center" valign="top" charoff="50">382 (44%)</td>
          <td align="center" valign="top" charoff="50">236 (54%)</td>
          <td align="center" valign="top" charoff="50">618 (47%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Age</td>
          <td align="center" valign="top" charoff="50">29 ± 16</td>
          <td align="center" valign="top" charoff="50">31 ± 17</td>
          <td align="center" valign="top" charoff="50">30 ± 16</td>
        </tr>
        <tr>
          <td colspan="4" align="left" valign="top" charoff="50">Most frequent diseases:</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Focal and segmental glomerulosclerosis</td>
          <td align="center" valign="top" charoff="50">167 (19%)</td>
          <td align="center" valign="top" charoff="50">161 (37%)</td>
          <td align="center" valign="top" charoff="50">328 (25%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Lupus nephritis</td>
          <td align="center" valign="top" charoff="50">255 (29%)</td>
          <td align="center" valign="top" charoff="50">33 (8%)</td>
          <td align="center" valign="top" charoff="50">288 (22%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Membranous glomerulonephritis</td>
          <td align="center" valign="top" charoff="50">63 (7%)</td>
          <td align="center" valign="top" charoff="50">52 (12%)</td>
          <td align="center" valign="top" charoff="50">115 (9%¨)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Membranoproliferative glomerulonephritis</td>
          <td align="center" valign="top" charoff="50">80 (9%)</td>
          <td align="center" valign="top" charoff="50">0 (0%)</td>
          <td align="center" valign="top" charoff="50">80 (6%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Minimal change disease</td>
          <td align="center" valign="top" charoff="50">24 (3%)</td>
          <td align="center" valign="top" charoff="50">56 (13%)</td>
          <td align="center" valign="top" charoff="50">80 (6%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> Diffuse proliferative glomerulonephritis</td>
          <td align="center" valign="top" charoff="50">68 (8%)</td>
          <td align="center" valign="top" charoff="50">2 (1%)</td>
          <td align="center" valign="top" charoff="50">70 (5%)</td>
        </tr>
        <tr>
          <td align="left" valign="top" charoff="50"> IgA nephropathy</td>
          <td align="center" valign="top" charoff="50">45 (5%)</td>
          <td align="center" valign="top" charoff="50">14 (3%)</td>
          <td align="center" valign="top" charoff="50">59 (4%)</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</floats-group>
